<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>VPCFlowlogè§£æ</title>
    <url>/2023/07/05/AWS/AWS_VPC%20Flowlog%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h1><h2 id="VPC-Flow-Log-æ€ä¹ˆçœ‹"><a href="#VPC-Flow-Log-æ€ä¹ˆçœ‹" class="headerlink" title="VPC Flow Log æ€ä¹ˆçœ‹"></a>VPC Flow Log æ€ä¹ˆçœ‹</h2><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/flow-logs.html#flow-log-records">https://docs.amazonaws.cn/vpc/latest/userguide/flow-logs.html#flow-log-records</a><br><a href="https://docs.amazonaws.cn/vpc/latest/userguide/flow-logs-records-examples.html#flow-log-example-tcp-flag">https://docs.amazonaws.cn/vpc/latest/userguide/flow-logs-records-examples.html#flow-log-example-tcp-flag</a>  </p>
<p>vpc flow logé‡Œçš„tcp-flagsè®°å½•çš„ä¸æ˜¯æŸä¸ªå•ä¸ªtcpåŒ…å¤´é‡Œçš„flagï¼Œè€Œæ˜¯å•æ¬¡è§‚å¯Ÿçš„æ—¶é—´çª—å£é‡Œè¿™æ¡flowçš„æ‰€æœ‰tcpåŒ…å‡ºç°è¿‡çš„tcp flagçš„åˆè®¡ã€‚  </p>
<p>TCP flags can be OR-ed during the aggregation interval. For short connections, the flags might be set on the same line in the flow log record, for example, 19 for SYN-ACK and FIN, and 3 for SYN and FIN. For an example, see TCP flag sequence.<br>For general information about TCP flags (such as the meaning of flags like FIN, SYN, and ACK), see TCP segment structure<br>on <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#TCP_segment_structure">[Wikipedia]</a>.</p>
<p>è¿™ä¸ªè®°å½•é‡Œé¢çš„å€¼ï¼Œ æ˜¯è¿™æ ·è®¡ç®—å‡ºæ¥çš„ï¼Œ ä»å³å‘å·¦ ï¼Œ ä» 0 æ¬¡æ–¹å¼€å§‹è®¡ç®—ã€‚</p>
<blockquote>
<p>FIN  2^0</p>
<p>SYN 2^1 </p>
<p>RST 2^2</p>
<p>PSH 2^3</p>
<p>ACK 2^4</p>
<p>URG 2^5</p>
<p>ECE 2^6</p>
<p>CWR 2^7</p>
</blockquote>
]]></content>
      <categories>
        <category>AWS</category>
      </categories>
      <tags>
        <tag>AWS, VPC, FLowLog</tag>
      </tags>
  </entry>
  <entry>
    <title>Cilium è¸©å‘æ€»ç»“</title>
    <url>/2022/08/19/AWS/EKS_CiliumInstallation&amp;Summary/</url>
    <content><![CDATA[<h1 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h1><ul>
<li><p><strong>KVM</strong>  - hayden@HaydenArchDesktop ~&gt; virsh version</p>
<blockquote>
<p> Compiled against library: libvirt 8.6.0<br> Using library: libvirt 8.6.0<br> Using API: QEMU 8.6.0<br> Running hypervisor: QEMU 7.0.0</p>
</blockquote>
</li>
<li><p><strong>VM OS</strong>ï¼š root@fedora ~# cat &#x2F;etc&#x2F;os-release</p>
<blockquote>
<p> NAME&#x3D;â€Fedora Linuxâ€<br> VERSION&#x3D;â€36 (Thirty Six)â€<br> ID&#x3D;fedora<br> VERSION_ID&#x3D;36</p>
</blockquote>
</li>
<li><p><strong>KVM</strong> è™šæ‹Ÿæœºä¸¤å°</p>
<blockquote>
<ul>
<li>Masterï¼š hostname: fedora</li>
<li>Nodeï¼š hostname: knode1</li>
</ul>
</blockquote>
</li>
<li><p><strong>kubernetes ç‰ˆæœ¬</strong>ï¼š v1.24.3</p>
</li>
<li><p><strong>kubernetes å®‰è£…æ–¹å¼</strong>ï¼š kubeadm </p>
</li>
<li><p><strong>dockerç‰ˆæœ¬</strong>:  docker:&#x2F;&#x2F;20.10.17 </p>
<blockquote>
<p>NOTE: (å°è¯•ä½¿ç”¨Containerdï¼Œ ä½†æ˜¯ç¿»è½¦äº†ï¼Œ æ§åˆ¶å¹³é¢çš„Podå¯åŠ¨ä¸äº†ï¼Œ æ‰€ä»¥æ”¾å¼ƒäº†ï¼Œé‚ä½¿ç”¨CRI-Dockerdï¼Œé…ç½®äº†Docker runtimeï¼Œ Containerdä½¿ç”¨é»˜è®¤çš„å‚æ•°æ— æ³•æ­£å¸¸çš„å¯åŠ¨ï¼Œ çœ‹èµ·æ¥å³ä½¿çœŸçš„å‡çº§åˆ°äº†1.24 è¿ç§»è¿˜æ˜¯ä¸€ä¸ªé—®é¢˜)</p>
</blockquote>
</li>
<li><p><strong>Kernel Version</strong>: 5.17.5-300.fc36.x86_64</p>
</li>
</ul>
<h1 id="Helmå‚æ•°"><a href="#Helmå‚æ•°" class="headerlink" title="Helmå‚æ•°"></a>Helmå‚æ•°</h1><p>å¦‚æœæ˜¯åœ¨KVMå¯åŠ¨çš„è™šæ‹Ÿæœºï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå®‰è£…å‚æ•°æ¥å¼€å¯æ›´å¤šåŠŸèƒ½ï¼Œä½†æ˜¯å—é™äºæˆ‘çš„KVMè™šæ‹Ÿç½‘å¡é©±åŠ¨ä¸èƒ½attach xdp ç¨‹åºï¼Œ æ‰€ä»¥ã€‚ã€‚ã€‚ã€‚xdp åŠ é€Ÿæ— æ³•å¯ç”¨ï¼Œä½†æ˜¯å…¶ä»–çš„é«˜çº§ç‰¹æ€§å‡å¯å¼€å¯ï¼Œ é›†ç¾¤çŠ¶æ€æ­£å¸¸ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">helm upgrade <span class="token parameter variable">-i</span> cilium cilium/cilium <span class="token punctuation">\</span>
  <span class="token parameter variable">--namespace</span> kube-system <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">tunnel</span><span class="token operator">=</span>disabled <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">autoDirectNodeRoutes</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">loadBalancer.mode</span><span class="token operator">=</span>dsr <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">kubeProxyReplacement</span><span class="token operator">=</span>strict <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">enableIPv4Masquerade</span><span class="token operator">=</span>false <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">loadBalancer.algorithm</span><span class="token operator">=</span>maglev <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">devices</span><span class="token operator">=</span>enp1s0 <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">k8sServiceHost</span><span class="token operator">=</span><span class="token number">192.168</span>.31.100 <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">k8sServicePort</span><span class="token operator">=</span><span class="token number">6443</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">hubble.relay.enabled</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
  <span class="token parameter variable">--set</span> <span class="token assign-left variable">hubble.ui.enabled</span><span class="token operator">=</span>true</code></pre>
<h1 id="Cilium-Cli"><a href="#Cilium-Cli" class="headerlink" title="Cilium Cli"></a>Cilium Cli</h1><p>touch .&#x2F;install_cilium_cli.sh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">CILIUM_CLI_VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt<span class="token variable">)</span></span>
<span class="token assign-left variable">CLI_ARCH</span><span class="token operator">=</span>amd64
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token operator">=</span> <span class="token string">"aarch64"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">CLI_ARCH</span><span class="token operator">=</span>arm64<span class="token punctuation">;</span> <span class="token keyword">fi</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">--fail</span> --remote-name-all https://github.com/cilium/cilium-cli/releases/download/<span class="token variable">$&#123;CILIUM_CLI_VERSION&#125;</span>/cilium-linux-<span class="token variable">$&#123;CLI_ARCH&#125;</span>.tar.gz<span class="token punctuation">&#123;</span>,.sha256sum<span class="token punctuation">&#125;</span>
sha256sum <span class="token parameter variable">--check</span> cilium-linux-<span class="token variable">$&#123;CLI_ARCH&#125;</span>.tar.gz.sha256sum
<span class="token function">sudo</span> <span class="token function">tar</span> xzvfC cilium-linux-<span class="token variable">$&#123;CLI_ARCH&#125;</span>.tar.gz /usr/local/bin
<span class="token function">rm</span> cilium-linux-<span class="token variable">$&#123;CLI_ARCH&#125;</span>.tar.gz<span class="token punctuation">&#123;</span>,.sha256sum<span class="token punctuation">&#125;</span></code></pre>
<h1 id="Hubble-Cli"><a href="#Hubble-Cli" class="headerlink" title="Hubble Cli"></a>Hubble Cli</h1><p>touch .&#x2F;install_hubble_client.sh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">HUBBLE_VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> https://raw.githubusercontent.com/cilium/hubble/master/stable.txt<span class="token variable">)</span></span>
<span class="token assign-left variable">HUBBLE_ARCH</span><span class="token operator">=</span>amd64
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token operator">=</span> <span class="token string">"aarch64"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">HUBBLE_ARCH</span><span class="token operator">=</span>arm64<span class="token punctuation">;</span> <span class="token keyword">fi</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">--fail</span> --remote-name-all https://github.com/cilium/hubble/releases/download/<span class="token variable">$HUBBLE_VERSION</span>/hubble-linux-<span class="token variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz<span class="token punctuation">&#123;</span>,.sha256sum<span class="token punctuation">&#125;</span>
sha256sum <span class="token parameter variable">--check</span> hubble-linux-<span class="token variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz.sha256sum
<span class="token function">sudo</span> <span class="token function">tar</span> xzvfC hubble-linux-<span class="token variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz /usr/local/bin
<span class="token function">rm</span> hubble-linux-<span class="token variable">$&#123;HUBBLE_ARCH&#125;</span>.tar.gz<span class="token punctuation">&#123;</span>,.sha256sum<span class="token punctuation">&#125;</span></code></pre>

<h2 id="Cilium-Cli-å®‰è£…æ’ä»¶å‘½ä»¤"><a href="#Cilium-Cli-å®‰è£…æ’ä»¶å‘½ä»¤" class="headerlink" title="Cilium Cli å®‰è£…æ’ä»¶å‘½ä»¤"></a>Cilium Cli å®‰è£…æ’ä»¶å‘½ä»¤</h2><pre class="language-bash" data-language="bash"><code class="language-bash">cilium upgrade <span class="token comment"># åŸåœ°å‡çº§</span>

<span class="token comment"># å®‰è£…å¹¶ç›´æ¥æ›¿æ¢kubeproxy</span>
cilium <span class="token function">install</span> <span class="token parameter variable">--version</span> <span class="token number">1.14</span>.1 <span class="token parameter variable">--set</span> <span class="token assign-left variable">kubeProxyReplacement</span><span class="token operator">=</span>true <span class="token parameter variable">--set</span><span class="token operator">=</span>ipam.operator.clusterPoolIPv4PodCIDRList<span class="token operator">=</span><span class="token string">"10.42.0.0/16"</span> <span class="token parameter variable">--set</span> <span class="token assign-left variable">k8sServiceHost</span><span class="token operator">=</span>kube3s.liarlee.site <span class="token parameter variable">--set</span> <span class="token assign-left variable">k8sServicePort</span><span class="token operator">=</span><span class="token number">6443</span>


<span class="token comment"># å‡çº§</span>
hayden@arch ~<span class="token operator">></span> cilium upgrade
ğŸ”® Auto-detected Kubernetes kind: K3s
â„¹ï¸  Using Cilium version <span class="token number">1.14</span>.2
ğŸ”® Auto-detected cluster name: default

<span class="token comment"># çœ‹çŠ¶æ€</span>
cilium status
<span class="token comment"># ä½¿ç”¨hubble</span>
cilium hubble port-forward <span class="token operator">&amp;</span>

cilium hubble <span class="token builtin class-name">enable</span> <span class="token parameter variable">--ui</span>

hubble observe <span class="token parameter variable">--since</span><span class="token operator">=</span>1m <span class="token parameter variable">-t</span> l7 -

</code></pre>
<hr>
<h1 id="ç‰¹æ€§ä»¥åŠçŠ¶æ€æ£€æŸ¥"><a href="#ç‰¹æ€§ä»¥åŠçŠ¶æ€æ£€æŸ¥" class="headerlink" title="ç‰¹æ€§ä»¥åŠçŠ¶æ€æ£€æŸ¥"></a>ç‰¹æ€§ä»¥åŠçŠ¶æ€æ£€æŸ¥</h1><p>é»˜è®¤çš„å®‰è£…å®Œæˆä¹‹åå¼€å¯ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ol>
<li>Kubeproxy Bypass</li>
<li>Iptables Bypass</li>
<li>LoadBalancer ç®—æ³•ï¼š Meglav</li>
<li>LoadBalancer ç‰¹æ€§ï¼š DSR</li>
<li>æŠ¥æ–‡Masquerade å°è£…ï¼š Disabled</li>
<li>Hubble ï¼š Enable</li>
<li>éš§é“å°åŒ…ï¼š Disabled</li>
</ol>
<hr>
<p>ä¸‹é¢æ˜¯ CIlium Statusçš„å‘½ä»¤è¿”å›ç»“æœï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@fedora ~<span class="token comment"># cilium status</span>
    /Â¯Â¯<span class="token punctuation">\</span>
 /Â¯Â¯<span class="token punctuation">\</span>__/Â¯Â¯<span class="token punctuation">\</span>    Cilium:         OK
 <span class="token punctuation">\</span>__/Â¯Â¯<span class="token punctuation">\</span>__/    Operator:       OK
 /Â¯Â¯<span class="token punctuation">\</span>__/Â¯Â¯<span class="token punctuation">\</span>    Hubble:         OK
 <span class="token punctuation">\</span>__/Â¯Â¯<span class="token punctuation">\</span>__/    ClusterMesh:    disabled
    <span class="token punctuation">\</span>__/

Deployment        cilium-operator    Desired: <span class="token number">2</span>, Ready: <span class="token number">2</span>/2, Available: <span class="token number">2</span>/2
Deployment        hubble-relay       Desired: <span class="token number">1</span>, Ready: <span class="token number">1</span>/1, Available: <span class="token number">1</span>/1
DaemonSet         cilium             Desired: <span class="token number">2</span>, Ready: <span class="token number">2</span>/2, Available: <span class="token number">2</span>/2
Deployment        hubble-ui          Desired: <span class="token number">1</span>, Ready: <span class="token number">1</span>/1, Available: <span class="token number">1</span>/1
Containers:       hubble-relay       Running: <span class="token number">1</span>
                  hubble-ui          Running: <span class="token number">1</span>
                  cilium             Running: <span class="token number">2</span>
                  cilium-operator    Running: <span class="token number">2</span>
Cluster Pods:     <span class="token number">14</span>/14 managed by Cilium
Image versions    hubble-ui          quay.io/cilium/hubble-ui:v0.9.0@sha256:0ef04e9a29212925da6bdfd0ba5b581765e41a01f1cc30563cef9b30b457fea0: <span class="token number">1</span>
                  hubble-ui          quay.io/cilium/hubble-ui-backend:v0.9.0@sha256:000df6b76719f607a9edefb9af94dfd1811a6f1b6a8a9c537cba90bf12df474b: <span class="token number">1</span>
                  cilium             quay.io/cilium/cilium:v1.12.0@sha256:079baa4fa1b9fe638f96084f4e0297c84dd4fb215d29d2321dcbe54273f63ade: <span class="token number">2</span>
                  cilium-operator    quay.io/cilium/operator-generic:v1.12.0@sha256:bb2a42eda766e5d4a87ee8a5433f089db81b72dd04acf6b59fcbb445a95f9410: <span class="token number">2</span>
                  hubble-relay       quay.io/cilium/hubble-relay:v1.12.0@sha256:ca8033ea8a3112d838f958862fa76c8d895e3c8d0f5590de849b91745af5ac4d: <span class="token number">1</span></code></pre>

<p>ds&#x2F;cilium ä¸­çš„å‘½ä»¤è¿”å›ç»“æœï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@fedora:/home/cilium<span class="token comment"># cilium status</span>
KVStore:                 Ok   Disabled
Kubernetes:              Ok   <span class="token number">1.24</span> <span class="token punctuation">(</span>v1.24.3<span class="token punctuation">)</span> <span class="token punctuation">[</span>linux/amd64<span class="token punctuation">]</span>
Kubernetes APIs:         <span class="token punctuation">[</span><span class="token string">"cilium/v2::CiliumClusterwideNetworkPolicy"</span>, <span class="token string">"cilium/v2::CiliumEndpoint"</span>, <span class="token string">"cilium/v2::CiliumNetworkPolicy"</span>, <span class="token string">"cilium/v2::CiliumNode"</span>, <span class="token string">"core/v1::Namespace"</span>, <span class="token string">"core/v1::Node"</span>, <span class="token string">"core/v1::Pods"</span>, <span class="token string">"core/v1::Service"</span>, <span class="token string">"discovery/v1::EndpointSlice"</span>, <span class="token string">"networking.k8s.io/v1::NetworkPolicy"</span><span class="token punctuation">]</span>
KubeProxyReplacement:    Strict   <span class="token punctuation">[</span>enp1s0 <span class="token number">192.168</span>.31.100 <span class="token punctuation">(</span>Direct Routing<span class="token punctuation">)</span><span class="token punctuation">]</span>
Host firewall:           Disabled
CNI Chaining:            none
Cilium:                  Ok   <span class="token number">1.12</span>.0 <span class="token punctuation">(</span>v1.12.0-9447cd1<span class="token punctuation">)</span>
NodeMonitor:             Listening <span class="token keyword">for</span> events on <span class="token number">4</span> CPUs with 64x4096 of shared memory
Cilium health daemon:    Ok
IPAM:                    IPv4: <span class="token number">3</span>/254 allocated from <span class="token number">10.0</span>.0.0/24,
BandwidthManager:        Disabled
Host Routing:            BPF
Masquerading:            Disabled
Controller Status:       <span class="token number">23</span>/23 healthy
Proxy Status:            OK, <span class="token function">ip</span> <span class="token number">10.0</span>.0.78, <span class="token number">0</span> redirects active on ports <span class="token number">10000</span>-20000
Global Identity Range:   min <span class="token number">256</span>, max <span class="token number">65535</span>
Hubble:                  Ok   Current/Max Flows: <span class="token number">283</span>/4095 <span class="token punctuation">(</span><span class="token number">6.91</span>%<span class="token punctuation">)</span>, Flows/s: <span class="token number">1.62</span>   Metrics: Disabled
Encryption:              Disabled
Cluster health:          <span class="token number">2</span>/2 reachable   <span class="token punctuation">(</span><span class="token number">2022</span>-08-23T01:57:33Z<span class="token punctuation">)</span></code></pre>

<p>Cilium verboseçš„è¯¦ç»†ç»“æœï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@fedora:/home/cilium<span class="token comment"># cilium status --verbose</span>
KVStore:                Ok   Disabled
Kubernetes:             Ok   <span class="token number">1.24</span> <span class="token punctuation">(</span>v1.24.3<span class="token punctuation">)</span> <span class="token punctuation">[</span>linux/amd64<span class="token punctuation">]</span>
Kubernetes APIs:        <span class="token punctuation">[</span><span class="token string">"cilium/v2::CiliumClusterwideNetworkPolicy"</span>, <span class="token string">"cilium/v2::CiliumEndpoint"</span>, <span class="token string">"cilium/v2::CiliumNetworkPolicy"</span>, <span class="token string">"cilium/v2::CiliumNode"</span>, <span class="token string">"core/v1::Namespace"</span>, <span class="token string">"core/v1::Node"</span>, <span class="token string">"core/v1::Pods"</span>, <span class="token string">"core/v1::Service"</span>, <span class="token string">"discovery/v1::EndpointSlice"</span>, <span class="token string">"networking.k8s.io/v1::NetworkPolicy"</span><span class="token punctuation">]</span>
KubeProxyReplacement:   Strict   <span class="token punctuation">[</span>enp1s0 <span class="token number">192.168</span>.31.100 <span class="token punctuation">(</span>Direct Routing<span class="token punctuation">)</span><span class="token punctuation">]</span>
Host firewall:          Disabled
CNI Chaining:           none
Cilium:                 Ok   <span class="token number">1.12</span>.0 <span class="token punctuation">(</span>v1.12.0-9447cd1<span class="token punctuation">)</span>
NodeMonitor:            Listening <span class="token keyword">for</span> events on <span class="token number">4</span> CPUs with 64x4096 of shared memory
Cilium health daemon:   Ok
IPAM:                   IPv4: <span class="token number">3</span>/254 allocated from <span class="token number">10.0</span>.0.0/24,
Allocated addresses:
  <span class="token number">10.0</span>.0.11 <span class="token punctuation">(</span>kube-system/coredns-6d4b75cb6d-tbgrr<span class="token punctuation">)</span>
  <span class="token number">10.0</span>.0.201 <span class="token punctuation">(</span>health<span class="token punctuation">)</span>
  <span class="token number">10.0</span>.0.78 <span class="token punctuation">(</span>router<span class="token punctuation">)</span>
BandwidthManager:       Disabled
Host Routing:           BPF
Masquerading:           Disabled
Clock Source <span class="token keyword">for</span> BPF:   ktime
Controller Status:      <span class="token number">23</span>/23 healthy
  Name                                  Last success   Last error   Count   Message
  cilium-health-ep                      29s ago        never        <span class="token number">0</span>       no error
  dns-garbage-collector-job             34s ago        never        <span class="token number">0</span>       no error
  endpoint-1313-regeneration-recovery   never          never        <span class="token number">0</span>       no error
  endpoint-2868-regeneration-recovery   never          never        <span class="token number">0</span>       no error
  endpoint-2945-regeneration-recovery   never          never        <span class="token number">0</span>       no error
  endpoint-gc                           3m34s ago      never        <span class="token number">0</span>       no error
  ipcache-inject-labels                 3m30s ago      3m33s ago    <span class="token number">0</span>       no error
  k8s-heartbeat                         4s ago         never        <span class="token number">0</span>       no error
  link-cache                            15s ago        never        <span class="token number">0</span>       no error
  metricsmap-bpf-prom-sync              4s ago         never        <span class="token number">0</span>       no error
  resolve-identity-1313                 3m29s ago      never        <span class="token number">0</span>       no error
  resolve-identity-2868                 3m29s ago      never        <span class="token number">0</span>       no error
  resolve-identity-2945                 3m30s ago      never        <span class="token number">0</span>       no error
  sync-endpoints-and-host-ips           30s ago        never        <span class="token number">0</span>       no error
  sync-lb-maps-with-k8s-services        3m30s ago      never        <span class="token number">0</span>       no error
  sync-node-with-ciliumnode <span class="token punctuation">(</span>fedora<span class="token punctuation">)</span>    3m32s ago      3m33s ago    <span class="token number">0</span>       no error
  sync-policymap-1313                   26s ago        never        <span class="token number">0</span>       no error
  sync-policymap-2868                   26s ago        never        <span class="token number">0</span>       no error
  sync-policymap-2945                   26s ago        never        <span class="token number">0</span>       no error
  sync-to-k8s-ciliumendpoint <span class="token punctuation">(</span><span class="token number">1313</span><span class="token punctuation">)</span>     9s ago         never        <span class="token number">0</span>       no error
  sync-to-k8s-ciliumendpoint <span class="token punctuation">(</span><span class="token number">2868</span><span class="token punctuation">)</span>     9s ago         never        <span class="token number">0</span>       no error
  sync-to-k8s-ciliumendpoint <span class="token punctuation">(</span><span class="token number">2945</span><span class="token punctuation">)</span>     0s ago         never        <span class="token number">0</span>       no error
  template-dir-watcher                  never          never        <span class="token number">0</span>       no error
Proxy Status:            OK, <span class="token function">ip</span> <span class="token number">10.0</span>.0.78, <span class="token number">0</span> redirects active on ports <span class="token number">10000</span>-20000
Global Identity Range:   min <span class="token number">256</span>, max <span class="token number">65535</span>
Hubble:                  Ok   Current/Max Flows: <span class="token number">377</span>/4095 <span class="token punctuation">(</span><span class="token number">9.21</span>%<span class="token punctuation">)</span>, Flows/s: <span class="token number">1.67</span>   Metrics: Disabled
KubeProxyReplacement Details:
  Status:                 Strict
  Socket LB:              Enabled
  Socket LB Protocols:    TCP, UDP
  Devices:                enp1s0 <span class="token number">192.168</span>.31.100 <span class="token punctuation">(</span>Direct Routing<span class="token punctuation">)</span>
  Mode:                   DSR
  Backend Selection:      Maglev <span class="token punctuation">(</span>Table Size: <span class="token number">16381</span><span class="token punctuation">)</span>
  Session Affinity:       Enabled
  Graceful Termination:   Enabled
  NAT46/64 Support:       Disabled
  XDP Acceleration:       Disabled
  Services:
  - ClusterIP:      Enabled
  - NodePort:       Enabled <span class="token punctuation">(</span>Range: <span class="token number">30000</span>-32767<span class="token punctuation">)</span>
  - LoadBalancer:   Enabled
  - externalIPs:    Enabled
  - HostPort:       Enabled
BPF Maps:   dynamic sizing: on <span class="token punctuation">(</span>ratio: <span class="token number">0.002500</span><span class="token punctuation">)</span>
  Name                          Size
  Non-TCP connection tracking   <span class="token number">65536</span>
  TCP connection tracking       <span class="token number">131072</span>
  Endpoint policy               <span class="token number">65535</span>
  Events                        <span class="token number">4</span>
  IP cache                      <span class="token number">512000</span>
  IP masquerading agent         <span class="token number">16384</span>
  IPv4 fragmentation            <span class="token number">8192</span>
  IPv4 <span class="token function">service</span>                  <span class="token number">65536</span>
  IPv6 <span class="token function">service</span>                  <span class="token number">65536</span>
  IPv4 <span class="token function">service</span> backend          <span class="token number">65536</span>
  IPv6 <span class="token function">service</span> backend          <span class="token number">65536</span>
  IPv4 <span class="token function">service</span> reverse NAT      <span class="token number">65536</span>
  IPv6 <span class="token function">service</span> reverse NAT      <span class="token number">65536</span>
  Metrics                       <span class="token number">1024</span>
  NAT                           <span class="token number">131072</span>
  Neighbor table                <span class="token number">131072</span>
  Global policy                 <span class="token number">16384</span>
  Per endpoint policy           <span class="token number">65536</span>
  Session affinity              <span class="token number">65536</span>
  Signal                        <span class="token number">4</span>
  Sockmap                       <span class="token number">65535</span>
  Sock reverse NAT              <span class="token number">65536</span>
  Tunnel                        <span class="token number">65536</span>
Encryption:            Disabled
Cluster health:        <span class="token number">2</span>/2 reachable    <span class="token punctuation">(</span><span class="token number">2022</span>-08-23T01:59:33Z<span class="token punctuation">)</span>
  Name                 IP               Node        Endpoints
  fedora <span class="token punctuation">(</span>localhost<span class="token punctuation">)</span>   <span class="token number">192.168</span>.31.100   reachable   reachable
  knode1               <span class="token number">192.168</span>.31.101   reachable   reachable</code></pre>

<p>cilium-health status â€“probe ä¹‹åçš„ç»“æœï¼Œ å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è”é€šæ€§æ­£å¸¸ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@fedora:/home/cilium<span class="token comment"># cilium-health status --probe</span>
Probe time:   <span class="token number">2022</span>-08-23T02:01:04Z
Nodes:
  fedora <span class="token punctuation">(</span>localhost<span class="token punctuation">)</span>:
    Host connectivity to <span class="token number">192.168</span>.31.100:
      ICMP to stack:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">140.825</span>Âµs
      HTTP to agent:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">199.54</span>Âµs
    Endpoint connectivity to <span class="token number">10.0</span>.0.201:
      ICMP to stack:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">128.2</span>Âµs
      HTTP to agent:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">263.034</span>Âµs
  knode1:
    Host connectivity to <span class="token number">192.168</span>.31.101:
      ICMP to stack:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">235.981</span>Âµs
      HTTP to agent:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">330.706</span>Âµs
    Endpoint connectivity to <span class="token number">10.0</span>.1.251:
      ICMP to stack:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">177.807</span>Âµs
      HTTP to agent:   OK, <span class="token assign-left variable">RTT</span><span class="token operator">=</span><span class="token number">275.869</span>Âµs</code></pre>

<p>æ²¡æœ‰æ‰§è¡ŒCilium connectivity Testï¼Œ è¿™ä¸ªæµ‹è¯•å’Œ 1.1.1.1:443 çš„æµ‹è¯•åœ¨åŸºæœ¬ä¸Šæ¯æ¬¡éƒ½æ˜¯å¤±è´¥çš„ã€‚ç›®å‰åŸå› è¿˜ä¸æ¸…æ¥šï¼Œ æ²¡è°ƒæŸ¥ï¼Œä½†æ˜¯é›†ç¾¤å†…çš„Podè®¿é—®å¤–éƒ¨çš„ç½‘ç»œæ˜¯å®Œå…¨æ­£å¸¸çš„ã€‚ </p>
<p>åŸºäºAWS EC2 æµ‹è¯•çš„ç»“æœï¼ˆæ— æ³•å…³é—­ Masquerade ä»¥åŠ ç»•è¿‡ Iptablesï¼‰ï¼Œ ä¸flannelç›¸æ¯”ï¼ŒCiliumå½“å‰çš„æ€§èƒ½è¿˜æ˜¯å°‘å°‘å·®ä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯è·¨è¶Šå…¬ç½‘è®¿é—®çš„ç¨³å®šæ€§æ›´å¼ºï¼ŒHTTPå®Œå…¨æ²¡æœ‰Failedè¯·æ±‚ã€‚</p>
<p>æ²¡æœ‰å¼€å¯XDPï¼Œ åŸå› æ˜¯æˆ‘ä½¿ç”¨çš„æ˜¯KVMçš„è™šæ‹Ÿæœº ï¼Œä½¿ç”¨çš„é©±åŠ¨ç¨‹åºæ˜¯VirtIOï¼Œ çœ‹èµ·æ¥è¿™ä¸ªé©±åŠ¨åœ¨æˆ‘å½“å‰ç‰ˆæœ¬çš„è™šæ‹ŸåŒ–é‡Œé¢å¯èƒ½éœ€è¦åšä¸€äº›ç‰¹æ®Šçš„è®¾ç½®æ‰èƒ½å¼€å¯ï¼Œ æˆ‘æ²¡æœ‰ç»§ç»­è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>ç›®å‰ä¹Ÿæ²¡æ³•å¯¹æ€§èƒ½åšä»»ä½•çš„å¯¹æ¯”æµ‹è¯•ï¼Œ  æ²¡æœ‰æ¡ä»¶å¯åŠ¨ä¸¤ä¸ªé›†ç¾¤åšå¯¹æ¯”ï¼Œå¯ä»¥æƒ³è§å› ä¸ºåº•å±‚çš„å“åº”æ—¶é—´æå¿«ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•çœ‹å‡ºå·®è·ï¼› è¦ä¹ˆå°±æ˜¯èµ„æºçš„æŠ¢å å¯¼è‡´æœ¬èº«çš„æµ‹è¯•ç»“æœä¸å¤Ÿç¨³å®šã€‚</p>
<p>æˆ‘ç›®å‰è¿˜åœ¨ EC2 ä»¥åŠ EKS ä¸­è°ƒè¯•ï¼š</p>
<ol>
<li><p>EKSï¼šAWS CNIæ›¿æ¢æ‰ä¹‹åæœ‰è‡ªå·±çš„é—®é¢˜ï¼Œ ä¸èƒ½å¼€å¯å®Œå…¨çš„Iptables Bypassï¼Œ ç”±äºå¯ç”¨äº†ENI MODE å°±ä¼šæä¾› EndpointRouteï¼Œ æ„Ÿè§‰è¿™å·²ç»æ˜¯BypassIptablesï¼Œ ä½†æ˜¯æ²¡èƒ½éªŒè¯ï¼Œä¸ç¡®å®šã€‚</p>
</li>
<li><p>EC2 éƒ¨ç½²çš„ Kubernetesï¼š é›†ç¾¤ä¸èƒ½å¼€å¯HostRoutingï¼Œ å¼€å¯ä¹‹åcilium-health status æ— æ³•å®Œæˆå¯¹ç«¯èŠ‚ç‚¹ä¸Šé¢Endpointçš„æ£€æŸ¥ï¼Œ Connection Timeoutã€‚ä¹Ÿä¸èƒ½å®Œå…¨workã€‚</p>
</li>
</ol>
<h1 id="å…¶ä»–èµ„æ–™"><a href="#å…¶ä»–èµ„æ–™" class="headerlink" title="å…¶ä»–èµ„æ–™"></a>å…¶ä»–èµ„æ–™</h1><blockquote>
<p>å…¶ä»–å…¬å¸ä¸šåŠ¡çš„é…ç½®ä»¥åŠæµ‹è¯•ã€‚</p>
<p><a href="https://www.ebpf.top/post/cilium-standalone-L4LB-XDP-zh/">https://www.ebpf.top/post/cilium-standalone-L4LB-XDP-zh/</a></p>
<p>æŒ‰ç…§LinuxåŸºé‡‘ä¼šçš„PPTä¸­æè¿°ï¼Œ KVM è™šæ‹ŸåŒ–æ¡ä»¶ä¸‹ä¹Ÿæ˜¯å¯ä»¥å¼€å¯XDPçš„ï¼Œä½†æ˜¯æˆ‘åªæ˜¯æµ‹è¯•ï¼Œ å°±ä¸æŠ˜è…¾äº†ï¼Œ æˆ‘è‡ªå·±çš„PC æ•ˆæœä¸ä¸€å®šæ˜æ˜¾ã€‚</p>
<p><a href="https://events19.linuxfoundation.cn/wp-content/uploads/2017/11/Accelerating-VM-Networking-through-XDP_Jason-Wang.pdf">https://events19.linuxfoundation.cn/wp-content/uploads/2017/11/Accelerating-VM-Networking-through-XDP_Jason-Wang.pdf</a> </p>
<p><a href="https://lore.kernel.org/bpf/b41ab0f0-4537-74b5-d7c3-b20ce082bdd6@redhat.com/T/">https://lore.kernel.org/bpf/b41ab0f0-4537-74b5-d7c3-b20ce082bdd6@redhat.com/T/</a></p>
<p><a href="https://lwn.net/Articles/841755/">https://lwn.net/Articles/841755/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, Cilium, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•é…ç½®kubeletçš„èŠ‚ç‚¹è‡ªåŠ¨å›æ”¶èµ„æº</title>
    <url>/2022/04/19/AWS/EKS_ConfigureNodeGC/</url>
    <content><![CDATA[<h1 id="é…ç½®NodeèŠ‚ç‚¹æŒ‰ç…§ç£ç›˜é˜ˆå€¼å›æ”¶ç©ºé—´"><a href="#é…ç½®NodeèŠ‚ç‚¹æŒ‰ç…§ç£ç›˜é˜ˆå€¼å›æ”¶ç©ºé—´" class="headerlink" title="é…ç½®NodeèŠ‚ç‚¹æŒ‰ç…§ç£ç›˜é˜ˆå€¼å›æ”¶ç©ºé—´"></a>é…ç½®NodeèŠ‚ç‚¹æŒ‰ç…§ç£ç›˜é˜ˆå€¼å›æ”¶ç©ºé—´</h1><blockquote>
<p><a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/eks-worker-nodes-image-cache/">https://aws.amazon.com/cn/premiumsupport/knowledge-center/eks-worker-nodes-image-cache/</a></p>
</blockquote>
<span id="more"></span>

<h1 id="ä¿®æ”¹Kubeletå‚æ•°"><a href="#ä¿®æ”¹Kubeletå‚æ•°" class="headerlink" title="ä¿®æ”¹Kubeletå‚æ•°"></a>ä¿®æ”¹Kubeletå‚æ•°</h1><ol>
<li>Kubeleté»˜è®¤æä¾›äº†GCçš„å‚æ•°  <pre class="language-bash" data-language="bash"><code class="language-bash">--image-gc-high-threshold å‚æ•°ç”¨äºå®šä¹‰è§¦å‘æ˜ åƒåƒåœ¾æ”¶é›†çš„ç£ç›˜ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚é»˜è®¤å€¼ä¸º <span class="token number">85</span>%ã€‚
--image-gc-low-threshold å‚æ•°ç”¨äºå®šä¹‰æ˜ åƒåƒåœ¾æ”¶é›†å°è¯•é‡Šæ”¾çš„ç£ç›˜ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚é»˜è®¤å€¼ä¸º <span class="token number">80</span>%ã€‚  </code></pre></li>
<li>å¦‚æœæ˜¯è‡ªå·±ç®¡ç†çš„Nodeï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ç›´æ¥é…ç½®kubeletå‘½ä»¤è¡Œçš„å‚æ•°ï¼Œå°†ä¸Šé¢çš„å‚æ•°æŒ‡å®šéœ€è¦çš„é˜ˆå€¼ï¼Œç„¶åé‡å¯kubeletå³å¯ã€‚<br>é…ç½®æ–‡ä»¶ä¸€èˆ¬åœ¨ ï¼š &#x2F;etc&#x2F;kubernetes&#x2F;kubelet.config<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token string">"imageGCHighThresholdPercent"</span><span class="token builtin class-name">:</span> <span class="token number">70</span>, 
<span class="token string">"imageGCLowThresholdPercent"</span><span class="token builtin class-name">:</span> <span class="token number">50</span>,  </code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>serviceAccount è·å– Token ä»¥åŠæƒé™çš„æ–¹å¼</title>
    <url>/2023/08/05/AWS/EKS_ServiceAccountToken/</url>
    <content><![CDATA[<p>æ‰‹åŠ¨è·å–Token å¹¶å‘é€è¯·æ±‚ç»™å®¹å™¨æ¥å£ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/var/run/secrets/kubernetes.io/serviceaccount $ <span class="token builtin class-name">pwd</span>


/var/run/secrets/kubernetes.io/serviceaccount $ <span class="token function">cat</span> ./token
eyJhbGciOiJSUzI1NiIsImtpZCI6ImE3N2JhOGMwY2FjYWEwNDk0MWU4MWM0ODk1Y2JiZjBiOTU2NTA1OTYifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIl0sImV4cCI6MTcyMTk3ODkxOCwiaWF0IjoxNjkwNDQyOTE4LCJpc3MiOiJodHRwczovL29pZGMuZWtzLmNuLW5vcnRoLTEuYW1hem9uYXdzLmNvbS5jbi9pZC9DMEE5NzJGNERCMThBOTMxN0RBMzk0Q0MwRDMzMjU3RiIsImt1YmVybmV0ZXMuaW8iOnsibmFtZXNwYWNlIjoibW9uaXRvcmluZyIsInBvZCI6eyJuYW1lIjoicHJvbWV0aGV1cy1rOHMtMCIsInVpZCI6ImE4YzdkMGY2LWUyMmEtNGY2Ny04NzYzLWNiNGQwYzM5MWFlMCJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoicHJvbWV0aGV1cy1rOHMiLCJ1aWQiOiJmN2M3YWMzZC1iZmY4LTRmODctYTlkNy04MjJjYWM4ZDVjMjkifSwid2FybmFmdGVyIjoxNjkwNDQ2NTI1fSwibmJmIjoxNjkwNDQyOTE4LCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bW9uaXRvcmluZzpwcm9tZXRoZXVzLWs4cyJ9.D3a7b93ZnBrmM-hjFrklce8upr8gUhUYYwmjGzZKOKb4EWUCoQXY1p197UoViUmYzbiOhchbehKosFcOjiL2GVGXqDRIXPmFU9p8l80Z9fuilB2TmexB6uBavuEF6blKHkH0VjyVQ3Kg39WzjD0Atrw-G6N4QZ_m0TOcKFfqRPebbH-Q-vzz5UuNPUYRKF4XZIT84QqYLYiBOkkeFIS_abo18YddMbn2AZQcbWamxQV2XPXjNKKwHeQvP1Xdr4hZLt0oGudE2XZtQp60ZCrfDmQteh-KhMWRvsZpoNvE4n8HieAhTTrFq_TjjX9IHlXrPmcONAkQ33jVgRIaw_r_0g


<span class="token builtin class-name">export</span> <span class="token assign-left variable">TOKEN</span><span class="token operator">=</span><span class="token string">"Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImE3N2JhOGMwY2FjYWEwNDk0MWU4MWM0ODk1Y2JiZjBiOTU2NTA1OTYifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIl0sImV4cCI6MTcyMTk3ODkxOCwiaWF0IjoxNjkwNDQyOTE4LCJpc3MiOiJodHRwczovL29pZGMuZWtzLmNuLW5vcnRoLTEuYW1hem9uYXdzLmNvbS5jbi9pZC9DMEE5NzJGNERCMThBOTMxN0RBMzk0Q0MwRDMzMjU3RiIsImt1YmVybmV0ZXMuaW8iOnsibmFtZXNwYWNlIjoibW9uaXRvcmluZyIsInBvZCI6eyJuYW1lIjoicHJvbWV0aGV1cy1rOHMtMCIsInVpZCI6ImE4YzdkMGY2LWUyMmEtNGY2Ny04NzYzLWNiNGQwYzM5MWFlMCJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoicHJvbWV0aGV1cy1rOHMiLCJ1aWQiOiJmN2M3YWMzZC1iZmY4LTRmODctYTlkNy04MjJjYWM4ZDVjMjkifSwid2FybmFmdGVyIjoxNjkwNDQ2NTI1fSwibmJmIjoxNjkwNDQyOTE4LCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bW9uaXRvcmluZzpwcm9tZXRoZXVzLWs4cyJ9.D3a7b93ZnBrmM-hjFrklce8upr8gUhUYYwmjGzZKOKb4EWUCoQXY1p197UoViUmYzbiOhchbehKosFcOjiL2GVGXqDRIXPmFU9p8l80Z9fuilB2TmexB6uBavuEF6blKHkH0VjyVQ3Kg39WzjD0Atrw-G6N4QZ_m0TOcKFfqRPebbH-Q-vzz5UuNPUYRKF4XZIT84QqYLYiBOkkeFIS_abo18YddMbn2AZQcbWamxQV2XPXjNKKwHeQvP1Xdr4hZLt0oGudE2XZtQp60ZCrfDmQteh-KhMWRvsZpoNvE4n8HieAhTTrFq_TjjX9IHlXrPmcONAkQ33jVgRIaw_r_0g"</span>

<span class="token function">curl</span> <span class="token parameter variable">-k</span> <span class="token parameter variable">-H</span> <span class="token string">"<span class="token variable">$TOKEN</span>"</span> https://127.0.0.1:10250/metrics</code></pre>

]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ é™¤æ‰€æœ‰éRunningçŠ¶æ€çš„Pod</title>
    <url>/2023/03/23/AWS/EKS_%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E9%9D%9ERunning%E7%8A%B6%E6%80%81%E7%9A%84Pod/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p> å¦‚æœæ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šé¢éƒ½æœ‰Taintï¼Œ ç„¶åè¿™ä¸ªæ²¡æœ‰Taintçš„èŠ‚ç‚¹ç£ç›˜æ»¡äº†ï¼Œ ä¼šå¯¼è‡´å½“å‰çš„èŠ‚ç‚¹ä¸Šé¢ç•™ä¸‹è®¸å¤šçŠ¶æ€ä¸æ­£å¸¸çš„Podï¼Œ è¿™äº›Podå¤§æ¦‚ç‡æ˜¯åœç•™åœ¨äº†EvictedçŠ¶æ€ï¼Œ æˆ–è€…æ˜¯Completed, ç”šè‡³æ˜¯ Unknown ã€‚ </p>
<p>è¿™ç§çŠ¶æ€çš„Pod Deploymenté»˜è®¤çš„æƒ…å†µä¸‹ä¸ä¼šè‡ªåŠ¨å›æ”¶ï¼Œ æ‰€ä»¥éœ€è¦äººå·¥æ“ä½œä¸€ä¸‹ã€‚ </p>
<p><a href="https://gist.github.com/ipedrazas/9c622404fb41f2343a0db85b3821275d">Knowledge Source</a></p>
<h2 id="å¤„ç†æ–¹æ³•"><a href="#å¤„ç†æ–¹æ³•" class="headerlink" title="å¤„ç†æ–¹æ³•"></a>å¤„ç†æ–¹æ³•</h2><p>è®°å½•ä¸€ä¸ªå‘½ä»¤æ¥å¤„ç†è¿™ä¸ªç±»å‹çš„Podã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubectl delete pod --field-selector<span class="token operator">=</span><span class="token string">"status.phase==Failed"</span></code></pre>

<h2 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h2><ol>
<li>é›†ç¾¤å†…ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹Taint  <pre class="language-bash" data-language="bash"><code class="language-bash">kubectl taint nodes ip-172-31-60-181.cn-north-1.compute.internal <span class="token assign-left variable">app</span><span class="token operator">=</span>grafana:NoSchedule</code></pre></li>
<li>å¯åŠ¨30ä¸ªGrafana</li>
<li>ç™»å½•åˆ°èŠ‚ç‚¹ä¸Šé¢ï¼Œ åˆ›å»ºä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œ è§¦å‘DiskPressureã€‚  <pre class="language-bash" data-language="bash"><code class="language-bash">fallocate <span class="token parameter variable">-l</span> 72G ./large.file</code></pre></li>
<li>ç­‰å¾…èŠ‚ç‚¹çš„DiskPressureè¢«è¯†åˆ«ï¼Œ ç„¶åè§¦å‘é©±é€ã€‚<br>  <img src="https://s2.loli.net/2023/03/24/FhKR1VcmTykOQHM.png" alt="Snipaste_2023-03-23_23-49-57.png"></li>
<li>åˆ é™¤æ–‡ä»¶ï¼Œ å–æ¶ˆDiskPressureçŠ¶æ€ï¼Œ ç­‰å¾… 30 ä¸ªæ–°çš„Pod Readyã€‚<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> ./large.file</code></pre></li>
<li>ä½¿ç”¨å‘½ä»¤æ¸…é™¤æ‰€æœ‰ä¸æ˜¯RunningçŠ¶æ€çš„Podã€‚<pre class="language-bash" data-language="bash"><code class="language-bash">~$ kubectl delete pod --field-selector<span class="token operator">=</span><span class="token string">"status.phase==Failed"</span></code></pre></li>
<li>Over.<br>  <img src="https://s2.loli.net/2023/03/24/r268vuJj9fFncae.png" alt="38298320d5dbfe6c1c7763c4784d2e9.png"></li>
</ol>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>å°†ArchLinuxä½œä¸ºèŠ‚ç‚¹åŠ å…¥EKS UnmanagedNode</title>
    <url>/2023/04/20/AWS/EKS_%E6%B7%BB%E5%8A%A0ArchLinux%E5%88%B0EKS%E4%BD%9C%E4%B8%BA%E8%8A%82%E7%82%B9/</url>
    <content><![CDATA[<h2 id="æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹"></a>æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹</h2><p>æ·»åŠ è¿™ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹æ˜¯ç›´æ¥æ·»åŠ è¿›å…¥é›†ç¾¤çš„ï¼Œ å¹¶æœªä½¿ç”¨EKSèŠ‚ç‚¹ç»„çš„æ¦‚å¿µï¼Œ æ‰€ä»¥è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¯ä»¥è¢«é‡å¯ï¼Œ æˆ–è€…å¥åº·æ£€æŸ¥å¤±è´¥çš„ï¼Œ å¹¶ä¸å…·æœ‰ä»»ä½•çš„æ‰©å±•æˆ–è€…å¼¹æ€§ç®¡ç†çš„èƒ½åŠ›ã€‚</p>
<ol>
<li><p>åˆ›å»ºé›†ç¾¤ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ EC2ï¼Œ ç™»å½•åˆ°å·²ç»å¯åŠ¨çš„ EKS ä¼˜åŒ– OS å†…ï¼Œå‡†å¤‡å¤åˆ¶ä¸€äº›è„šæœ¬è¿‡æ¥ã€‚</p>
</li>
<li><p>æ·»åŠ EC2çš„æ ‡ç­¾ï¼š kubernetes.io&#x2F;cluster&#x2F;clusterName  owned</p>
</li>
<li><p>é…ç½®EC2çš„Instance Profile</p>
</li>
<li><p>æ§åˆ¶å°è·å– Kubernetes APIServerçš„Endpoint URL</p>
</li>
<li><p>è·å– apiserver b64 CA : <code>cat ~/.kube/config</code> è¿™ä¸ªæ–‡ä»¶é‡Œé¢å¯ä»¥æ‰¾åˆ° ï¼Œæˆ–è€…æ˜¯é€šè¿‡EKSçš„æ§åˆ¶å°ä¸Šé¢ï¼Œ æ‰¾åˆ° Base64 çš„ CAã€‚</p>
</li>
<li><p>ç¼–è¾‘ userdataï¼Œ æˆ–è€… ssh ç™»å½•åˆ°ec2ä¸Šé¢åˆ›å»ºä¸€ä¸ªbashè„šæœ¬ç”¨æ¥è°ƒç”¨ bootstrap.sh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/eks<span class="token punctuation">;</span> <span class="token function">touch</span> ~/eks/start.sh
---
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-ex</span>

<span class="token assign-left variable">B64_CLUSTER_CA</span><span class="token operator">=</span>
<span class="token assign-left variable">API_SERVER_URL</span><span class="token operator">=</span>
<span class="token assign-left variable">K8S_CLUSTER_DNS_IP</span><span class="token operator">=</span><span class="token number">10.100</span>.0.10

/etc/eks/bootstrap.sh <span class="token variable">$&#123;ClusterName&#125;</span> --b64-cluster-ca <span class="token variable">$&#123;B64_CLUSTER_CA&#125;</span> --apiserver-endpoint <span class="token variable">$&#123;API_SERVER_URL&#125;</span></code></pre>
</li>
<li><p>é›†ç¾¤é‡Œé¢<strong>æ²¡æœ‰èŠ‚ç‚¹ç»„ ï¼Œ ä¹Ÿä¸ä¼šåˆ›å»ºaws-auth configmap</strong> æ‰€ä»¥èŠ‚ç‚¹æ— æ³•æ­£å¸¸çš„åŠ å…¥é›†ç¾¤ï¼Œ éœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapRoles</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    - groups:
      - system:bootstrappers
      - system:nodes
      rolearn: [CLUSTER_ROLE]
      username: system:node:&#123;&#123;EC2PrivateDNSName&#125;&#125;</span>
  <span class="token key atrule">mapUsers</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    []</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws<span class="token punctuation">-</span>auth
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system</code></pre></li>
</ol>
<h2 id="éœ€è¦å¤åˆ¶çš„æ–‡ä»¶"><a href="#éœ€è¦å¤åˆ¶çš„æ–‡ä»¶" class="headerlink" title="éœ€è¦å¤åˆ¶çš„æ–‡ä»¶"></a>éœ€è¦å¤åˆ¶çš„æ–‡ä»¶</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> containerd <span class="token comment"># å®‰è£…Containerd</span>
<span class="token function">scp</span> /etc/eks/bootstrap.sh root@54.222.253.235:/etc/eks/bootstrap.sh <span class="token comment"># å¤åˆ¶bootstrap</span>
<span class="token function">scp</span> /usr/bin/imds root@54.222.253.235:/usr/bin/imds <span class="token comment"># shell è„šæœ¬ï¼Œ ç”¨æ¥å¸®å¿™è°ƒç”¨ec2 metadata è·å–å®ä¾‹å’ŒVPCå­ç½‘çš„ä¿¡æ¯</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/eks/ root@54.222.253.235:/etc/eks/ <span class="token comment"># ç›´æ¥å¤åˆ¶äº†eksçš„ç›¸å…³è„šæœ¬å’Œé…ç½®æ¨¡æ¿</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /var/lib/kubelet/kubeconfig root@54.222.253.235:/var/lib/kubelet/kubeconfig <span class="token comment"># å¤åˆ¶kubeletconfigé…ç½®æ–‡ä»¶æ¨¡æ¿</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/kubernetes/ root@54.222.253.235:/etc/kubernetes/ <span class="token comment"># å¤åˆ¶ kubernetes çš„é…ç½®æ–‡ä»¶</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/kubernetes/kubelet/ root@54.222.253.235:/etc/kubernetes/kubelet/ <span class="token comment"># ä¸Šé¢çš„å‘½ä»¤æ²¡æœ‰é€’å½’å¤åˆ¶ï¼Œ æ‰€ä»¥éœ€è¦æŒ‡å®š</span>

<span class="token comment"># è®¾ç½®å¯¹åº”çš„å†…æ ¸å‚æ•°ï¼Œ å¦‚æœä¸åškubelet ä¼šæŠ¥é”™æç¤º è¿™äº›å‚æ•°ä¸ç¬¦åˆè¦æ±‚ã€‚</span>
kernel.panic <span class="token operator">=</span> <span class="token number">10</span>
kernel.panic_on_oops <span class="token operator">=</span> <span class="token number">1</span>
vm.overcommit_memory <span class="token operator">=</span> <span class="token number">1</span></code></pre>

<h3 id="Bootstrap-è„šæœ¬å†…å®¹åˆ†æ"><a href="#Bootstrap-è„šæœ¬å†…å®¹åˆ†æ" class="headerlink" title="Bootstrap è„šæœ¬å†…å®¹åˆ†æ"></a>Bootstrap è„šæœ¬å†…å®¹åˆ†æ</h3><p>è®°å½•ä¸€ä¸‹è„šæœ¬è‡ªåŠ¨é…ç½®çš„å†…å®¹ï¼Œ å¤§æ¦‚å°±æ˜¯ è·å–å˜é‡ï¼Œ awsçš„æœåŠ¡åœ°å€ï¼Œ ec2 å…ƒæ•°æ®åœ°å€ï¼Œ æ›¿æ¢æ¨¡æ¿ä¸­çš„å˜é‡ç”ŸæˆKubeleté…ç½®æ–‡ä»¶ å’Œ Containerd çš„é…ç½®æ–‡ä»¶ï¼ˆè¿™ä¸ªæ›¿æ¢æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œ bootstrapåªèƒ½å˜æ›´æ¨¡æ¿ä¸­çš„å˜é‡ä¸€æ¬¡ï¼Œ ç¬¬äºŒæ¬¡æ‰§è¡Œåªä¼šç”Ÿæˆåˆ·æ–°ä¸€æ¬¡é›†ç¾¤çš„ä¿¡æ¯ï¼Œ ä»¥åŠé‡å¯æœåŠ¡ï¼‰ã€‚</p>
<ol>
<li>è¯»å–bootstrapåé¢ç»™å‡ºçš„å‚æ•°ï¼Œè®¾ç½®å˜é‡ï¼Œ ä¾‹å¦‚ï¼š ClusterName etc.</li>
<li>æŸ¥çœ‹Kubeletçš„ç‰ˆæœ¬ï¼Œ å†³å®šRuntimeï¼Œ containerd | dockerd, åˆ¤æ–­æ¡ä»¶æ˜¯ kubelet ç‰ˆæœ¬ å¤§äº 1.24<pre class="language-bash" data-language="bash"><code class="language-bash">++ kubelet <span class="token parameter variable">--version</span>
++ <span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">'[0-9]\.[0-9]+\.[0-9]+'</span>
+ <span class="token assign-left variable">KUBELET_VERSION</span><span class="token operator">=</span><span class="token number">1.24</span>.9
---
+ <span class="token assign-left variable">IS_124_OR_GREATER</span><span class="token operator">=</span>true
+ <span class="token assign-left variable">DEFAULT_CONTAINER_RUNTIME</span><span class="token operator">=</span>containerd</code></pre></li>
<li>è®¾ç½®ECRä»¥åŠPauseå®¹å™¨åœ°å€<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è·å–regionä»¥åŠaws service domain</span>
+ <span class="token assign-left variable">AWS_DEFAULT_REGION</span><span class="token operator">=</span>cn-north-1
+ <span class="token assign-left variable">AWS_SERVICES_DOMAIN</span><span class="token operator">=</span>amazonaws.com.cn

<span class="token comment"># è°ƒç”¨è„šæœ¬ /etc/eks/get-ecr-uri.sh cn-north-1 amazonaws.com.cn ''</span>
+ <span class="token assign-left variable">ECR_URI</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn
+ <span class="token assign-left variable">PAUSE_CONTAINER_IMAGE</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause
+ <span class="token assign-left variable">PAUSE_CONTAINER</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5
+ <span class="token assign-left variable">CA_CERTIFICATE_DIRECTORY</span><span class="token operator">=</span>/etc/kubernetes/pki
+ <span class="token assign-left variable">CA_CERTIFICATE_FILE_PATH</span><span class="token operator">=</span>/etc/kubernetes/pki/ca.crt</code></pre></li>
<li>åˆ›å»ºè¯ä¹¦ç›®å½•ï¼š<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/pki
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,MASTER_ENDPOINT,https://CE0253A94B6B14215AE3282580CFA5E3.yl4.cn-north-1.eks.amazonaws.com.cn,g /var/lib/kubelet/kubeconfig
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,AWS_REGION,cn-north-1,g /var/lib/kubelet/kubeconfig
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,CLUSTER_NAME,NewClusterForManualJoin,g /var/lib/kubelet/kubeconfig</code></pre></li>
<li>è·å– VPC CIDR<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># imds shell script help to get metadata.</span>
imds: /usr/bin/imds
++ imds latest/meta-data/local-ipv4
++ imds latest/meta-data/network/interfaces/macs/02:66:06:2e:48:08/vpc-ipv4-cidr-blocks</code></pre></li>
<li>åˆ›å»ºkubelet é…ç½®, è®¡ç®—é¢„ç•™çš„èµ„æº å’Œ MaxPod ç­‰ç­‰å‚æ•°çš„æ•°å€¼ã€‚<pre class="language-bash" data-language="bash"><code class="language-bash">/etc/kubernetes/kubelet/kubelet-config.json
+ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/kubelet.service.d
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/containerd
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/cni/net.d
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/containerd.service.d</code></pre></li>
<li>åˆ›å»ºcontainerd é…ç½®æ–‡ä»¶<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token builtin class-name">printf</span> <span class="token string">'[Service]\nSlice=runtime.slice\n'</span>
+ <span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/containerd.service.d/00-runtime-slice.conf
+ <span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,SANDBOX_IMAGE,918309763551.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5,g /etc/eks/containerd/containerd-config.toml</code></pre></li>
<li>kubeleté…ç½®å’Œå¯åŠ¨ã€‚<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-v</span> /etc/eks/containerd/kubelet-containerd.service /etc/systemd/system/kubelet.service
+ <span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/systemd/system/kubelet.service
+ <span class="token function">sudo</span> containerd config dump
+ systemctl <span class="token builtin class-name">enable</span> kubelet
+ systemctl start kubelet</code></pre></li>
</ol>
<h2 id="åˆ¶ä½œ-NodeTemplate-AMI"><a href="#åˆ¶ä½œ-NodeTemplate-AMI" class="headerlink" title="åˆ¶ä½œ NodeTemplate AMI"></a>åˆ¶ä½œ NodeTemplate AMI</h2><ol>
<li><p>å¦‚æœä½¿ç”¨å·²ç»åŠ å…¥è¿‡é›†ç¾¤çš„å®ä¾‹ç›´æ¥åˆ¶ä½œAMIï¼Œ èŠ‚ç‚¹ä¼šæ— æ³•åŠ å…¥ï¼Œ kubeletæŠ¥é”™æ˜¯APIserveræ‹’ç»è¿™ä¸ªèŠ‚ç‚¹çš„åŠ å…¥ã€‚</p>
<pre class="language-none"><code class="language-none">2023-04-19T15:10:13Z kubelet-eks.daemon[11577]: E0419 15:10:13.325154   11577 event.go:267] Server rejected event &#39;&amp;v1.Event&#123;TypeMeta:v1.TypeMeta&#123;Kind:&quot;&quot;, APIVersion:&quot;&quot;&#125;, ObjectMeta:v1.ObjectMeta&#123;Name:&quot;ip-10-0-1-249.cn-northwest-1.compute.internal.17575e9c08aefd8d&quot;, GenerateName:&quot;&quot;, Namespace:&quot;default&quot;, SelfLink:&quot;&quot;, UID:&quot;&quot;, ResourceVersion:&quot;&quot;, Generation:0, CreationTimestamp:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), DeletionTimestamp:&lt;nil&gt;, DeletionGracePeriodSeconds:(*int64)(nil), Labels:map[string]string(nil), Annotations:map[string]string(nil), OwnerReferences:[]v1.OwnerReference(nil), Finalizers:[]string(nil), ZZZ_DeprecatedClusterName:&quot;&quot;, ManagedFields:[]v1.ManagedFieldsEntry(nil)&#125;, InvolvedObject:v1.ObjectReference&#123;Kind:&quot;Node&quot;, Namespace:&quot;&quot;, Name:&quot;ip-10-0-1-249.cn-northwest-1.compute.internal&quot;, UID:&quot;ip-10-0-1-249.cn-northwest-1.compute.internal&quot;, APIVersion:&quot;&quot;, ResourceVersion:&quot;&quot;, FieldPath:&quot;&quot;&#125;, Reason:&quot;NodeHasNoDiskPressure&quot;, Message:&quot;Node ip-10-0-1-249.cn-northwest-1.compute.internal status is now: NodeHasNoDiskPressure&quot;, Source:v1.EventSource&#123;Component:&quot;kubelet&quot;, Host:&quot;ip-10-0-1-249.cn-northwest-1.compute.internal&quot;&#125;, FirstTimestamp:time.Date(2023, time.April, 19, 15, 10, 10, 99764621, time.Local), LastTimestamp:time.Date(2023, time.April, 19, 15, 10, 13, 272025156, time.Local), Count:6, Type:&quot;Normal&quot;, EventTime:time.Date(1, time.January, 1, 0, 0, 0, 0, time.UTC), Series:(*v1.EventSeries)(nil), Action:&quot;&quot;, Related:(*v1.ObjectReference)(nil), ReportingController:&quot;&quot;, ReportingInstance:&quot;&quot;&#125;&#39;: &#39;Unauthorized&#39; (will not retry!)</code></pre>
</li>
<li><p>æ’æŸ¥æ‰€æœ‰çš„åœ°æ–¹ä¹‹åï¼Œæƒé™éƒ½æ˜¯æ­£ç¡®çš„ï¼Œ ä¾æ—§æ²¡å‘ç°åˆ°åº•å“ªé‡Œçš„æƒé™æœ‰é—®é¢˜ã€‚</p>
</li>
<li><p>å‘ç”Ÿé—®é¢˜çš„åŸå› æ˜¯ å·²ç»å¯åŠ¨çš„èŠ‚ç‚¹ï¼Œ æœ‰äº›é…ç½®æ–‡ä»¶å·²ç»è¢«æ›´æ”¹è¿‡äº†ï¼Œ å†™å…¥äº†å›ºå®šçš„ä¿¡æ¯ï¼Œ  ä¾‹å¦‚apiserverçš„caè¯ä¹¦ï¼Œ ä»¥åŠèŠ‚ç‚¹çš„Endpointåœ°å€ï¼Œ è¿™äº›æ–‡ä»¶éœ€è¦è¢«åˆ é™¤ æˆ–è€… é‡æ–°é…ç½®ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å½±å“ æ˜¯ &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å·²ç»è¢«æ›¿æ¢çš„å˜é‡ï¼Œ è¿˜æœ‰æ§åˆ¶å¹³é¢é”™è¯¯çš„CAè¯ä¹¦ä»¥åŠä¿¡æ¯ã€‚</p>
</li>
<li><p>æ‰€éœ€å¤„ç†çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-10-0-1-249:/var/lib/kubelet<span class="token comment"># ll /var/lib/kubelet/</span>
total <span class="token number">44</span>
drwxr-xr-x  <span class="token number">8</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 ./
drwxr-xr-x <span class="token number">38</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:40 <span class="token punctuation">..</span>/
-rw-------  <span class="token number">1</span> root root   <span class="token number">62</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 cpu_manager_state
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:50 device-plugins/
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">575</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 kubeconfig <span class="token comment"># è¿™ä¸ªç›®å½•ä¸­å”¯ä¸€å­˜åœ¨çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢åº”è¯¥æ˜¯ä¸ºé…ç½®çš„å˜é‡ï¼Œä¸èƒ½è¢«æ›¿æ¢ä¸ºç¡®å®šçš„å€¼ã€‚</span>
-rw-------  <span class="token number">1</span> root root   <span class="token number">61</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 memory_manager_state
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 pki/
drwxr-x---  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 plugins/
drwxr-x---  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 plugins_registry/
drwxr-x---  <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 pod-resources/
drwxr-x---  <span class="token number">8</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:50 pods/

root@ip-10-0-1-249:/etc/kubernetes/pki<span class="token comment"># ll /etc/kubernetes/pki/</span>
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:38 ./
drwxr-xr-x <span class="token number">4</span> root root <span class="token number">4096</span> Apr <span class="token number">19</span> <span class="token number">15</span>:33 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1099</span> Apr <span class="token number">19</span> <span class="token number">15</span>:41 ca.crt</code></pre>

<p>åˆ é™¤ä¸Šé¢ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œ å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ <code>touch /var/lib/kubelet/kubeconfig</code>ï¼Œ å†™å…¥å†…å®¹å¦‚ä¸‹ï¼Œ ä¿ç•™å…¶ä¸­çš„å˜é‡å€¼ï¼Œ è¿™ä¸ªéƒ¨åˆ†çš„å˜é‡ä¼šåœ¨bootstrapçš„æ—¶å€™æ›¿æ¢æ‰ï¼š </p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Config
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority</span><span class="token punctuation">:</span> /etc/kubernetes/pki/ca.crt
    <span class="token key atrule">server</span><span class="token punctuation">:</span> MASTER_ENDPOINT 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> kubernetes
    <span class="token key atrule">user</span><span class="token punctuation">:</span> kubelet
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubelet
<span class="token key atrule">current-context</span><span class="token punctuation">:</span> kubelet
<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubelet
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">exec</span><span class="token punctuation">:</span>
      <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> client.authentication.k8s.io/v1beta1
      <span class="token key atrule">command</span><span class="token punctuation">:</span> /usr/bin/aws<span class="token punctuation">-</span>iam<span class="token punctuation">-</span>authenticator
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"token"</span>
        <span class="token punctuation">-</span> <span class="token string">"-i"</span>
        <span class="token punctuation">-</span> <span class="token string">"CLUSTER_NAME"</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>region
        <span class="token punctuation">-</span> <span class="token string">"AWS_REGION"</span></code></pre>
</li>
<li><p>å°†ä¸Šé¢çš„æ­¥éª¤åšå®Œä¹‹åå…³é—­å®ä¾‹ï¼Œ å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„AMIå³å¯ã€‚ </p>
</li>
<li><p>å½“AMIè¢«åˆ›å»ºä¸ºå®ä¾‹ï¼Œ å¹¶å®Œæˆè¿è¡ŒBootstrapè„šæœ¬ä¹‹åï¼Œ æ‰€æœ‰çš„èŠ‚ç‚¹ä¿¡æ¯ä¼šè¢«é‡æ–°é…ç½®ï¼Œ è¿™æ ·èŠ‚ç‚¹æ‰èƒ½æ­£ç¡®çš„åŠ å…¥é›†ç¾¤ä¸­ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè¿æ¥æ•°æ®åº“æŠ¥é”™No subject alternative names present</title>
    <url>/2020/11/16/Database/Databases_Mongo_JavaException-MangoDB-ssl/</url>
    <content><![CDATA[<p>é…ç½®ç›‘æ§çš„æ—¶å€™éœ€è¦é…ç½®å’Œè·å–MongoDBçš„ä¿¡æ¯ï¼Œä½¿ç”¨åä¸ºäº‘çš„MongoDBPaaSæœåŠ¡ï¼Œå¦‚æœå¼€å¯äº†SSLå°±æ— æ³•æ­£å¸¸è¿æ¥ã€‚</p>
<p>æŠ¥é”™å¦‚ä¸‹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Timed out after <span class="token number">30000</span> ms <span class="token keyword">while</span> waiting to connect. Client view of cluster state is <span class="token punctuation">&#123;</span>type<span class="token operator">=</span>UNKNOWN, <span class="token assign-left variable">servers</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>address<span class="token operator">=</span><span class="token number">192.168</span>.1.1:8635, <span class="token assign-left variable">type</span><span class="token operator">=</span>UNKNOWN, <span class="token assign-left variable">state</span><span class="token operator">=</span>CONNECTING, <span class="token assign-left variable">exception</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>com.mongodb.MongoSocketWriteException: Exception sending message<span class="token punctuation">&#125;</span>, caused by <span class="token punctuation">&#123;</span>javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No subject alternative names present<span class="token punctuation">&#125;</span>, caused by <span class="token punctuation">&#123;</span>java.security.cert.CertificateException: No subject alternative names present<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></code></pre>

<p>ç½‘ä¸Šæœç´¢åˆ°çš„ç»“æœåŸºæœ¬ä¸Šéƒ½æ˜¯ä»å¼€å‘çš„è§’åº¦è§£å†³è¿™ä¸ªé”™è¯¯ï¼Œ å¦‚æœæ˜¯ä»è¿ç»´çš„æ–¹å‘ä¸Š ï¼Œ æ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ä¹ˆï¼Ÿæ¯”å¦‚é€šè¿‡ä¸€äº›å‚æ•°æˆ–è€…è®¾ç½®ã€‚</p>
<p>æœ‰çš„ ï¼š </p>
<blockquote>
<p>åœ¨è¿æ¥ä¸²é‡ŒåŠ ä¸Šsslinvalidhostnameallowed&#x3D;trueå³å¯, è®¾ç½®æ˜¯ç›´æ¥å…è®¸æ— æ•ˆçš„hostnameè¯ä¹¦ï¼Œ ç®—æ˜¯ä¸è§£å†³è¯ä¹¦é—®é¢˜ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå§ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ æœ€åçš„è¿æ¥å‚æ•°å˜æˆï¼š </p>
<pre class="language-zsh" data-language="zsh"><code class="language-zsh">mongodb:&#x2F;&#x2F;192.168.1.1:8635&#x2F;test?authSource&#x3D;admin&amp;ssl&#x3D;true&amp;sslinvalidhostnameallowed&#x3D;true</code></pre>

]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>MongoDB, JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®åº“å•è¡¨çš„æµ‹è¯•</title>
    <url>/2023/05/19/Database/Databases_MySQL-why-2000w/</url>
    <content><![CDATA[<p>åŸºäºè¿™ä¸ªé—®é¢˜çš„æµ‹è¯•<a href="https://articles.zsxq.com/id_szzdrtss5t7o.html">ä¸ºä»€ä¹ˆMySQLå•è¡¨ä¸è¦è¶…è¿‡2000wè¡Œï¼Ÿ</a></p>
<h2 id="æµ‹è¯•è¿‡ç¨‹ï¼š"><a href="#æµ‹è¯•è¿‡ç¨‹ï¼š" class="headerlink" title="æµ‹è¯•è¿‡ç¨‹ï¼š"></a>æµ‹è¯•è¿‡ç¨‹ï¼š</h2><pre class="language-none"><code class="language-none">CREATE TABLE test(
id int NOT NULL AUTO_INCREMENT PRIMARY KEY comment &#39;ä¸»é”®&#39;,
person_id int not null comment &#39;ç”¨æˆ·id&#39;,
person_name VARCHAR(200) comment &#39;ç”¨æˆ·åç§°&#39;,
gmt_create datetime comment &#39;åˆ›å»ºæ—¶é—´&#39;,
gmt_modified datetime comment &#39;ä¿®æ”¹æ—¶é—´&#39;
) comment &#39;äººå‘˜ä¿¡æ¯è¡¨&#39;;

æ’å…¥æ•°æ®ï¼š
insert into test values(1,1,&#39;user_1&#39;, NOW(), now());

insert into test (person_id, person_name, gmt_create, gmt_modified)
select (@i:&#x3D;@i+1) as rownum, person_name, now(), now() from test, (select @i:&#x3D;100) as init;
set @i&#x3D;1;

&#x2F;&#x2F;æµ‹è¯• SQL,è®°å½•ä»–ä»¬çš„è¿è¡Œæ—¶é—´
select count(*) from test;
select count(*) from test where id&#x3D;XXX;

æŸ¥çœ‹è¿™ä¸ªè¡¨æ ¼çš„æ•°æ®é‡å¤§å°ï¼š 
show table status like &#39;test&#39;\G</code></pre>

<p>200wè¡Œè¡¨ï¼š </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; describe table test;
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
|  1 | SIMPLE      | test  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 2092640 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
1 row in set, 1 warning (0.00 sec)

MySQL [test]&gt; select count(*) from test;
1 row in set (0.045 sec)
1 row in set (0.050 sec)
1 row in set (0.050 sec)</code></pre>

<p>400wï¼š</p>
<pre class="language-none"><code class="language-none">mysql&gt; describe table test;
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
|  1 | SIMPLE      | test  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 4185280 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
1 row in set, 1 warning (0.00 sec)

MySQL [test]&gt; select count(*) from test;
1 row in set (0.126 sec)
1 row in set (0.120 sec)
1 row in set (0.119 sec)</code></pre>

<p>800wï¼š</p>
<pre class="language-none"><code class="language-none">mysql&gt; describe table test;
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
|  1 | SIMPLE      | test  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 8370120 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------+
1 row in set, 1 warning (0.00 sec)

MySQL [test]&gt; select count(*) from test;
1 row in set (0.266 sec)
1 row in set (0.266 sec)
1 row in set (0.253 sec)</code></pre>

<p>1600wï¼š</p>
<pre class="language-none"><code class="language-none">mysql&gt; describe table test;
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
|  1 | SIMPLE      | test  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 16337090 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
1 row in set, 1 warning (0.00 sec)

MySQL [test]&gt; select count(*) from test;
1 row in set (0.544 sec)
1 row in set (0.524 sec)
1 row in set (0.523 sec)</code></pre>

<p>3200wï¼š</p>
<pre class="language-none"><code class="language-none">mysql&gt; describe table test;
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
|  1 | SIMPLE      | test  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 32665301 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------+
1 row in set, 1 warning (0.00 sec)

MySQL [test]&gt; select count(*) from test;
1 row in set (1.068 sec)
1 row in set (1.057 sec)
1 row in set (1.044 sec)</code></pre>

<p>è¿™ä¸ªç»“æœåŸºæœ¬ä¸Šéƒ½æ˜¯çº¿æ€§çš„ï¼Œ æ„Ÿè§‰æ•°æ®é‡å®åœ¨æ˜¯å¤ªå°äº†ã€‚</p>
<pre class="language-none"><code class="language-none">mysql&gt; show table status like &#39;test&#39;\G
*************************** 1. row ***************************
           Name: test
         Engine: InnoDB
        Version: 10
     Row_format: Dynamic
           Rows: 4182365
 Avg_row_length: 48
    Data_length: 202063872
Max_data_length: 0
   Index_length: 0
      Data_free: 6291456
 Auto_increment: 4652971
    Create_time: 2023-05-19 07:56:46
    Update_time: 2023-05-19 07:57:50
     Check_time: NULL
      Collation: utf8mb4_0900_ai_ci
       Checksum: NULL
 Create_options:
        Comment: äººå‘˜ä¿¡æ¯è¡¨
1 row in set (0.00 sec)</code></pre>

<hr>
<h2 id="æ¢ä¸ªæ–¹æ¡ˆï¼ˆ-ä»å¤§ä½¬é‚£è¾¹ä¼¸æ‰‹æ‹¿æ¥çš„"><a href="#æ¢ä¸ªæ–¹æ¡ˆï¼ˆ-ä»å¤§ä½¬é‚£è¾¹ä¼¸æ‰‹æ‹¿æ¥çš„" class="headerlink" title="æ¢ä¸ªæ–¹æ¡ˆï¼ˆ ä»å¤§ä½¬é‚£è¾¹ä¼¸æ‰‹æ‹¿æ¥çš„"></a>æ¢ä¸ªæ–¹æ¡ˆï¼ˆ ä»å¤§ä½¬é‚£è¾¹ä¼¸æ‰‹æ‹¿æ¥çš„</h2><pre class="language-none"><code class="language-none">CREATE TABLE tt1(
id int NOT NULL AUTO_INCREMENT PRIMARY KEY,
person_id tinyint not null ,
person_name1 VARCHAR(3000) ,
person_name2 VARCHAR(3000) ,
person_name3 VARCHAR(3000) ,
person_name4 VARCHAR(3000) ,
person_name5 VARCHAR(3000) ,
gmt_create datetime ,
gmt_modified datetime
) ;	

insert into tt1 (person_id, person_name1, person_name2, person_name3, person_name4, person_name5, gmt_create, gmt_modified)
values (1, lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), now(), now());

insert into tt1 (person_id, person_name1, person_name2, person_name3, person_name4, person_name5, gmt_create, gmt_modified)
select person_id, person_name1, person_name2, person_name3, person_name4, person_name5, now(), now() from tt1;

show table status like &#39;tt1&#39;\G

rename user &#39;root&#39;@&#39;localhost&#39;  to &#39;root&#39;@&#39;%&#39;;

select user,host from mysql.user;
</code></pre>

<p>è¿™æ¬¡çš„è¯ï¼Œ æ·»åŠ æ•°æ®çš„æ—¶é—´å®åœ¨æ˜¯å¤ªä¹…äº†ï¼Œ è®°å½•ä¸€ä¸‹ä¸­é—´ç»“æœçš„å˜åŒ–å§ï¼š </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">MySQL [test]&gt; select count(*) from tt1;
+----------+
| count(*) |
+----------+
|    32768 |
+----------+
1 row in set (0.097 sec)

MySQL [test]&gt; select count(*) from tt1;
+----------+
| count(*) |
+----------+
|    32768 |
+----------+
1 row in set (0.096 sec)

MySQL [test]&gt; select count(*) from tt1;
+----------+
| count(*) |
+----------+
|    65536 |
+----------+
1 row in set (0.199 sec)

MySQL [test]&gt; select count(*) from tt1;
+----------+
| count(*) |
+----------+
|    65536 |
+----------+
1 row in set (0.198 sec)

Query OK, 32768 rows affected (1 min 29.31 sec)
Query OK, 65536 rows affected (2 min 57.96 sec)
Query OK, 131072 rows affected (6 min 6.59 sec)
Query OK, 262144 rows affected (13 min 42.06 sec)

# æŸ¥tableçš„Page_NO
SELECT b.name, a.name, index_id, TYPE, a.SPACE, a.PAGE_NO FROM information_schema.INNODB_INDEXES a, information_schema.INNODB_TABLES b WHERE a.TABLE_ID &#x3D; b.table_id AND a.SPACE &lt;&gt; 0 AND b.NAME &#x3D; &#39;tt1&#39;;

mysql&gt; SELECT b.name, a.name, index_id, type, a.space, a.PAGE_NO FROM information_schema.INNODB_INDEXES a, information_schema.INNODB_TABLES b WHERE a.table_id &#x3D; b.table_id AND a.space &lt;&gt; 0;

| cap&#x2F;sbtest24                            | PRIMARY                   |      356 |    3 |   129 |       4 |
| test&#x2F;test                               | PRIMARY                   |      359 |    3 |   131 |       4 |
| test&#x2F;tt1                                | PRIMARY                   |      360 |    3 |   132 |       4 |
+-----------------------------------------+---------------------------+----------+------+-------+---------+

è®¡ç®—å¯¹åº”éœ€è¦æŸ¥çœ‹çš„ä½ç½®ï¼Œ å­—èŠ‚æ•°: 16 * 1024 * page_no + 64
# ä½¿ç”¨hexdump æŸ¥çœ‹è¡¨æ ¼æ‰€åœ¨çš„b+æ ‘æœ‰å‡ å±‚ã€‚
hexdump -s 49216 -n 10 .&#x2F;tt1.ibd

# åˆ›å»ºtt2å®Œå…¨å¤åˆ¶tt1çš„å†…å®¹ã€‚
create table tt2 as select * from tt1;</code></pre>

<blockquote>
<p>å¯¹äºMySQLçš„å†…å­˜ä½¿ç”¨ï¼Œåœ¨æ•°æ®åº“å¯åŠ¨åï¼Œä¸ä¼šç«‹å³å°†buffer poolå¯¹åº”çš„å†…å­˜å ç”¨ï¼Œè€Œæ˜¯éšç€ä½¿ç”¨é€æ­¥å ç”¨ã€‚</p>
<p>åœ¨5æœˆ19æ—¥çœ‹åˆ°æ‚¨çš„å®ä¾‹æœ‰è¿æ¥æ•°è¾¾åˆ°1200ï¼Œå¹¶æŒç»­äº†ä¸€æ®µæ—¶é—´ï¼Œå†…å­˜éšä¹‹ä¸‹é™ã€‚æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹ Innodb_buffer_pool_size çš„å€¼æ¥ç¡®å®š buffer pool çš„æœ€å¤§å€¼ã€‚<br>ç„¶åæ ¹æ®å…¬å¼æ¥è®¡ç®—é¢„æœŸçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼š<br>Maximum MySQL Memory Usage &#x3D; innodb_buffer_pool_size + key_buffer_size + ((read_buffer_size + read_rnd_buffer_size + sort_buffer_size + join_buffer_size) X max_connections)</p>
<p>æˆ‘æŒ‰ç…§æ‚¨çš„é…ç½®ï¼Œåˆ›å»ºäº†mysql 5.7.41 ç‰ˆæœ¬ï¼Œå®ä¾‹ç±»å‹ä¸º db.m5.xlarge ï¼Œå…¬å¼ä¸­çš„å‚æ•°å‡ä¸ºé»˜è®¤å€¼ï¼Œè®¡ç®—ç»“æœå¦‚ä¸‹ï¼š<br>Maximum MySQL Memory Usage<br>&#x3D; innodb_buffer_pool_size + key_buffer_size + ((read_buffer_size + read_rnd_buffer_size + sort_buffer_size + join_buffer_size) X max_connections)<br>&#x3D; 11811160064 + 16777216 + (262144 + 524288 + 262144 + 262144 ) * 1200<br>&#x3D; 13400801280 å³ 12.48GB</p>
<p>æ€»å†…å­˜ä¸º 16 GB ï¼Œå‡å» 12.48 GBï¼Œè¿˜å‰©ä¸‹ 3.52 GBã€‚å†é™¤å»ä¸€äº›SQLæ‰§è¡Œä¸­æ¶ˆè€—çš„å†…å­˜ä»¥åŠæ“ä½œç³»ç»Ÿç­‰æ¶ˆè€—çš„å†…å­˜ï¼Œç›®å‰æŒ‡æ ‡ä¸Šæ˜¾ç¤ºå‰©ä½™1.5GBå·¦å³ã€‚</p>
<p>åœ¨5æœˆ19æ—¥è¿æ¥æ•°å¢åŠ å‰ï¼ŒæŒ‰300è¿æ¥æ•°ç®—ï¼Œä¸Šè¿°å…¬å¼è®¡ç®—ç»“æœä¸º 11.38 GBï¼Œç„¶è€Œå¯ç”¨å†…å­˜æŒ‡æ ‡æ˜¾ç¤ºä¸º 7 GBï¼Œç›¸åŠ èµ·æ¥æ˜¯å¤§äº 16 GB çš„ã€‚ç”±æ­¤ä¹Ÿèƒ½è¯´æ˜æ˜¯ MySQL å¹¶æœªç›´æ¥å°†å‚æ•°è®¾ç½®çš„æ‰€æœ‰å¯ç”¨å†…å­˜éƒ½å ç”¨ï¼Œè€Œæ˜¯éšç€ä½¿ç”¨é€æ­¥å¢åŠ çš„ã€‚<br>å½“è¿æ¥æ•°å¢åŠ åï¼ŒMySQLçœŸæ­£ä½¿ç”¨äº†è¿™éƒ¨åˆ†å†…å­˜(å¦‚buffer pool)ï¼Œä¸ä¼šä¸»åŠ¨é‡Šæ”¾ã€‚</p>
<p>å› æ­¤ç›®å‰å¯ç”¨å†…å­˜çŠ¶å†µç¬¦åˆé¢„æœŸï¼Œå¦‚æœæ‚¨å¸Œæœ›å›æ”¶ MySQL å ç”¨çš„å†…å­˜ï¼Œå¯ä»¥è€ƒè™‘é‡å¯æ•°æ®åº“ï¼Œä½†ä¹‹åä¸šåŠ¡é‡è¾ƒå¤§æ—¶ï¼Œè¿˜ä¼šé‡æ–°å ç”¨è¿™äº›å†…å­˜ã€‚</p>
</blockquote>
<h3 id="Mysql80é‡ç½®å¯†ç "><a href="#Mysql80é‡ç½®å¯†ç " class="headerlink" title="Mysql80é‡ç½®å¯†ç "></a>Mysql80é‡ç½®å¯†ç </h3><pre class="language-mysql" data-language="mysql"><code class="language-mysql">echo &quot;skip-grant-tables&quot; &gt;&gt; &#x2F;etc&#x2F;my.cnf
sudo systemctl restart mysqld

mysql -uroot -p

SET PASSWORD &#x3D; &#39;root&#39;;

rename user &#39;root&#39;@&#39;localhost&#39;  to &#39;root&#39;@&#39;%&#39;;

select user,host from mysql.user;</code></pre>

<h3 id="MySQLVersion-8-0-ä¿®æ”¹å¯†ç ç­–ç•¥ï¼š"><a href="#MySQLVersion-8-0-ä¿®æ”¹å¯†ç ç­–ç•¥ï¼š" class="headerlink" title="MySQLVersion 8.0 ä¿®æ”¹å¯†ç ç­–ç•¥ï¼š"></a>MySQLVersion 8.0 ä¿®æ”¹å¯†ç ç­–ç•¥ï¼š</h3><pre class="language-none"><code class="language-none">mysql -u wordpress -p -h mysql.liarlee.site

MySQL [(none)]&gt; SHOW VARIABLES LIKE &#39;validate_password%&#39;;
+--------------------------------------+--------+
| Variable_name                        | Value  |
+--------------------------------------+--------+
| validate_password.check_user_name    | ON     |
| validate_password.dictionary_file    |        |
| validate_password.length             | 8      |
| validate_password.mixed_case_count   | 1      |
| validate_password.number_count       | 1      |
| validate_password.policy             | MEDIUM |
| validate_password.special_char_count | 1      |
+--------------------------------------+--------+
7 rows in set (0.010 sec)

MySQL [(none)]&gt; set global validate_password.policy&#x3D;0;
Query OK, 0 rows affected (0.000 sec)

MySQL [(none)]&gt; set global validate_password.length&#x3D;4;
Query OK, 0 rows affected (0.001 sec)

MySQL [(none)]&gt; set password&#x3D;&#39;123123&#39;;
Query OK, 0 rows affected (0.005 sec)
</code></pre>

<p>å¦‚æœæ·»åŠ äº† skip-grant-tables å‚æ•°çš„è¯ï¼Œ é»˜è®¤éœ€è¦å…ˆflush priviledges; ç„¶åæ‰èƒ½æ›´æ”¹å¯†ç ï¼Œ å¦åˆ™çš„è¯ä¼šæŠ¥é”™ï¼š</p>
<blockquote>
<p>ERROR 1290 (HY000): The MySQL server is running with the â€“skip-grant-tables option so it cannot execute this statement</p>
</blockquote>
<p>è§£å†³åŠæ³•æ˜¯ ï¼š </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;123123&#39;;
ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;123123&#39;;
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements

mysql&gt; set global validate_password.policy&#x3D;0;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; set global validate_password.length&#x3D;4;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; set password&#x3D;&#39;123123&#39;;
ERROR 1133 (42000): Can&#39;t find any matching row in the user table

mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;123123&#39;;
Query OK, 0 rows affected (0.00 sec)</code></pre>

]]></content>
      <categories>
        <category>Database</category>
      </categories>
      <tags>
        <tag>MySQL, Database</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨EC2å®ä¾‹æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™éƒ½è¿è¡ŒUserdata</title>
    <url>/2023/09/06/Linux/Linux_AlwaysRunUserdata/</url>
    <content><![CDATA[<p>ä½¿ç”¨Cloud-initæä¾›è¯»å–Userdataçš„åŠŸèƒ½ã€‚ </p>
<p>éœ€è¦åœ¨Userdataä¸­æ·»åŠ ä¸€ä¸ª MIME çš„å¤´éƒ¨ï¼Œ è¦†ç›–é»˜è®¤çš„è¡Œä¸ºã€‚</p>
<blockquote>
<p><a href="https://cloudinit.readthedocs.io/en/latest/topics/format.html#mime-multi-part-archive">https://cloudinit.readthedocs.io/en/latest/topics/format.html#mime-multi-part-archive</a><br><a href="https://repost.aws/zh-Hans/knowledge-center/execute-user-data-ec2">https://repost.aws/zh-Hans/knowledge-center/execute-user-data-ec2</a></p>
</blockquote>
<p>å…·ä½“éœ€è¦æ·»åŠ çš„MIME éƒ¨åˆ†ï¼š </p>
<pre class="language-mime" data-language="mime"><code class="language-mime">Content-Type: multipart&#x2F;mixed; boundary&#x3D;&quot;&#x2F;&#x2F;&quot;
MIME-Version: 1.0

--&#x2F;&#x2F;
Content-Type: text&#x2F;cloud-config; charset&#x3D;&quot;us-ascii&quot;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename&#x3D;&quot;cloud-config.txt&quot;

#cloud-config
cloud_final_modules:
- [scripts-user, always]

--&#x2F;&#x2F;
Content-Type: text&#x2F;x-shellscript; charset&#x3D;&quot;us-ascii&quot;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename&#x3D;&quot;userdata.txt&quot;</code></pre>

<p>ä¹‹åé‡æ–°å¯åŠ¨è¿™ä¸ªEC2 å°±å¯ä»¥äº†ã€‚ </p>
<h2 id="Troubleshooting-Guide"><a href="#Troubleshooting-Guide" class="headerlink" title="Troubleshooting Guide"></a>Troubleshooting Guide</h2><ul>
<li>é¦–å…ˆå¯ä»¥çš„æŸ¥çœ‹Userdata ï¼Œ åœ¨æ§åˆ¶å° æˆ–è€… AWScli</li>
<li>æŸ¥çœ‹å®ä¾‹å†…éƒ¨æ—¥å¿— æˆ–è€… Consoleçš„æ—¥å¿—ï¼š<br>&#x2F;var&#x2F;log&#x2F;cloud-init.log<br>&#x2F;var&#x2F;log&#x2F;cloud-init-output.log</li>
<li>æŸ¥çœ‹userdata æ³¨å…¥çš„è„šæœ¬å†…å®¹ï¼š<br>&#x2F;var&#x2F;lib&#x2F;cloud&#x2F;instances&#x2F;i-09e08d362af7fa401&#x2F;scripts åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚<br>æ–‡ä»¶æ ‘ ï¼š <pre class="language-none"><code class="language-none">[root@ip-172-31-50-3 i-09e08d362af7fa401]# tree
.
â”œâ”€â”€ boot-finished
â”œâ”€â”€ cloud-config.txt
â”œâ”€â”€ datasource
â”œâ”€â”€ handlers
â”œâ”€â”€ obj.pkl
â”œâ”€â”€ scripts  # è¿™ä¸ª
â”‚Â Â  â”œâ”€â”€ part-001
â”‚Â Â  â””â”€â”€ part-002
â”œâ”€â”€ sem
â”‚Â Â  â”œâ”€â”€ config_amazonlinux_repo_https
â”‚Â Â  â”œâ”€â”€ config_disk_setup
â”‚Â Â  â”œâ”€â”€ config_keys_to_console
â”‚Â Â  â”œâ”€â”€ config_locale
â”‚Â Â  â”œâ”€â”€ config_mounts
â”‚Â Â  â”œâ”€â”€ config_phone_home
â”‚Â Â  â”œâ”€â”€ config_power_state_change
â”‚Â Â  â”œâ”€â”€ config_resolv_conf
â”‚Â Â  â”œâ”€â”€ config_rsyslog
â”‚Â Â  â”œâ”€â”€ config_runcmd
â”‚Â Â  â”œâ”€â”€ config_scripts_per_instance
â”‚Â Â  â”œâ”€â”€ config_scripts_user
â”‚Â Â  â”œâ”€â”€ config_set_hostname
â”‚Â Â  â”œâ”€â”€ config_set_passwords
â”‚Â Â  â”œâ”€â”€ config_ssh
â”‚Â Â  â”œâ”€â”€ config_ssh_authkey_fingerprints
â”‚Â Â  â”œâ”€â”€ config_timezone
â”‚Â Â  â”œâ”€â”€ config_users_groups
â”‚Â Â  â”œâ”€â”€ config_write_files
â”‚Â Â  â”œâ”€â”€ config_write_metadata
â”‚Â Â  â”œâ”€â”€ config_yum_add_repo
â”‚Â Â  â”œâ”€â”€ config_yum_configure
â”‚Â Â  â””â”€â”€ consume_data
â”œâ”€â”€ user-data.txt
â”œâ”€â”€ user-data.txt.i
â”œâ”€â”€ vendor-data.txt
â””â”€â”€ vendor-data.txt.i

3 directories, 33 files</code></pre></li>
</ul>
<p>å¦‚æœéœ€è¦ä¸´æ—¶çš„æ”¹ä¸€äº›å†…å®¹ï¼Œ å¯ä»¥å†™åœ¨Userdataé‡Œé¢ï¼Œ å®Œæˆæ“ä½œä¹‹ååˆ é™¤Userdata å°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansibleç¬”è®°-1</title>
    <url>/2019/06/26/Linux/Linux_Ansible-Note-1/</url>
    <content><![CDATA[<p>Ansibleçš„å­¦ä¹ ç¬”è®°ã€‚<br>Ansibleç®¡ç†æ–¹å¼æ˜¯èµ„æºåœ¨ç›®æ ‡ä¸»æœºä¸Šï¼Œå®šä¹‰æ‰€æœŸæœ›çš„ç›®æ ‡çŠ¶æ€çš„æ–¹å¼ï¼›æ¯ä¸€ä¸ªæ“ä½œå¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼ˆå¯é‡å¤æ“ä½œä½†ç»“æœä¸å˜çš„ï¼‰ã€‚ansibleé‡‡ç”¨sshé“¾æ¥æ‰€ç®¡ç†çš„æœåŠ¡å™¨ï¼Œå› æ­¤å…·æœ‰agentlessçš„ä¼˜åŠ¿ã€‚</p>
<h1 id="Ansibleçš„å®‰è£…"><a href="#Ansibleçš„å®‰è£…" class="headerlink" title="Ansibleçš„å®‰è£…"></a>Ansibleçš„å®‰è£…</h1><p>Ansibleåœ¨Redhatçš„ä»“åº“ä¸­å°±æœ‰äºŒè¿›åˆ¶åŒ…ï¼Œç›´æ¥dnfæˆ–yumå®‰è£…å°±å¯ä»¥äº†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> Ansible</code></pre>

<h1 id="Ansibleçš„é…ç½®æ–‡ä»¶"><a href="#Ansibleçš„é…ç½®æ–‡ä»¶" class="headerlink" title="Ansibleçš„é…ç½®æ–‡ä»¶"></a>Ansibleçš„é…ç½®æ–‡ä»¶</h1><p>Ansibleçš„é…ç½®æ–‡ä»¶å¸¸ç”¨çš„æœ‰ï¼š</p>
<ol>
<li>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg  <strong>Ansibleçš„é…ç½®æ–‡ä»¶</strong></li>
<li>&#x2F;etc&#x2F;ansible&#x2F;hosts       <strong>Ansibleå…è®¸æ§åˆ¶çš„ä¸»æœºåˆ—è¡¨ï¼Œå¯åœ¨hostsæ–‡ä»¶ä¸­å¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç»„</strong></li>
</ol>
<h1 id="Ansibleçš„ç»„ä»¶"><a href="#Ansibleçš„ç»„ä»¶" class="headerlink" title="Ansibleçš„ç»„ä»¶"></a>Ansibleçš„ç»„ä»¶</h1><ol>
<li>ansible</li>
<li>ansible-playbook</li>
<li>ansible-doc</li>
</ol>
<h1 id="Ansibleçš„é…ç½®å’Œä½¿ç”¨"><a href="#Ansibleçš„é…ç½®å’Œä½¿ç”¨" class="headerlink" title="Ansibleçš„é…ç½®å’Œä½¿ç”¨"></a>Ansibleçš„é…ç½®å’Œä½¿ç”¨</h1><h2 id="Ansibleå‘½ä»¤æ¨¡å¼"><a href="#Ansibleå‘½ä»¤æ¨¡å¼" class="headerlink" title="Ansibleå‘½ä»¤æ¨¡å¼"></a>Ansibleå‘½ä»¤æ¨¡å¼</h2><blockquote>
<p>ansible [HOST_PARTTEN] -m [MODUELS] -a â€œ[ARGS]â€ -f [Forks] -C -u [USERNAME] -c [CONNTECTION]</p>
</blockquote>
<h2 id="åŸºäºå¯†é’¥è®¤è¯ansible"><a href="#åŸºäºå¯†é’¥è®¤è¯ansible" class="headerlink" title="åŸºäºå¯†é’¥è®¤è¯ansible"></a>åŸºäºå¯†é’¥è®¤è¯ansible</h2><p>ansibleæ”¯æŒä½¿ç”¨sshç”¨æˆ·å‘½åå¯†ç çš„è®¤è¯æ–¹å¼ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨sshå¯†é’¥è®¤è¯çš„æ–¹å¼è¿›è¡Œé“¾æ¥ã€‚sshå¯†é’¥çš„æ–¹å¼å¯ä»¥ä¿è¯å®‰å…¨æ€§ï¼ŒåŒæ—¶å…å»è¾“å…¥å¯†ç çš„éº»çƒ¦ã€‚</p>
<ol>
<li>ç”Ÿæˆansibleçš„å¯†é’¥ <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-P</span> <span class="token string">""</span></code></pre></li>
<li>å¤åˆ¶ansibleçš„å…¬é’¥åˆ°éœ€è¦è¿æ¥æ§åˆ¶çš„hostä¸Š   <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id-rsa.pub root@<span class="token punctuation">[</span>host1-IP<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id-rsa.pub root@<span class="token punctuation">[</span>host2-IP<span class="token punctuation">]</span></code></pre></li>
<li>åœ¨ansibleçš„hostsæ–‡ä»¶ä¸­è®°å½•éœ€è¦æ§åˆ¶çš„ä¸»æœºåæˆ–è€…IP <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"[host1-IP]"</span> <span class="token operator">>></span> /etc/ansible/hosts
<span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"[host2-IP]"</span> <span class="token operator">>></span> /etc/ansible/hosts</code></pre></li>
<li>ä½¿ç”¨ansibleè¿›è¡Œæ§åˆ¶æµ‹è¯• <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">ping</span>       <span class="token comment"># è¿›è¡Œè¿é€šæµ‹è¯•</span>
<span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">ping</span> --list-hosts      <span class="token comment"># åˆ—ä¸¾æ‰€æœ‰å—å½±å“çš„ä¸»æœºï¼Œä½†æ˜¯ä¸æ‰§è¡Œæ“ä½œ</span>
<span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">ping</span> <span class="token parameter variable">-C</span>        <span class="token comment"># è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯ä¸å¯¹æ§åˆ¶çš„ä¸»æœºä½œæ›´æ”¹</span></code></pre></li>
</ol>
<h2 id="Ansibleä½¿ç”¨ç¤ºä¾‹"><a href="#Ansibleä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="Ansibleä½¿ç”¨ç¤ºä¾‹"></a>Ansibleä½¿ç”¨ç¤ºä¾‹</h2><p>Ansibleé»˜è®¤å°†æ‰€æœ‰çš„æ“ä½œé€šè¿‡æ¨¡å—çš„æ–¹å¼å®šä¹‰ï¼Œè¿™é‡Œåˆ—ä¸¾äº†ä¸€äº›å¸¸ç”¨çš„æ¨¡å—ï¼š</p>
<h3 id="Ansibleç®¡ç†æŸ¥è¯¢å‘½ä»¤"><a href="#Ansibleç®¡ç†æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="Ansibleç®¡ç†æŸ¥è¯¢å‘½ä»¤"></a>Ansibleç®¡ç†æŸ¥è¯¢å‘½ä»¤</h3><p>ä½¿ç”¨ansible-docå‘½ä»¤æ¥è¿›è¡Œæ¨¡å—çš„æ–‡æ¡£æŸ¥çœ‹, <em>&#x2F;var&#x2F;log&#x2F;messages</em> ä¸­ä¼šè®°å½•æ“ä½œæ—¥å¿—ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible-doc <span class="token parameter variable">-l</span>      <span class="token comment"># åˆ—ä¸¾æ‰€æœ‰å½“å‰å¯ç”¨çš„æ¨¡å—å’Œç®€å•è¯´æ˜</span>
<span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible-doc <span class="token parameter variable">-s</span> <span class="token punctuation">[</span>MODULES_NAME<span class="token punctuation">]</span>     <span class="token comment"># æŸ¥çœ‹æŒ‡å®šæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•å’Œè¯´æ˜</span></code></pre>
<h3 id="Useræ¨¡å—"><a href="#Useræ¨¡å—" class="headerlink" title="Useræ¨¡å—"></a>Useræ¨¡å—</h3><p>è®¾å®šä¸»æœºçš„ç”¨æˆ·çŠ¶æ€ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œåˆ›å»ºåˆ é™¤ï¼Œæ›´æ”¹ä¿¡æ¯ä»¥åŠå‚æ•°ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®æ‰€æœ‰ä¸»æœºåˆ›å»ºç”¨æˆ·user,è®¾ç½®å†…å®¹æœ‰uid,groups,shell</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> user <span class="token parameter variable">-a</span> <span class="token string">"name=user1 uid=3000 state=present groups=testgrp shell=/bin/zsh"</span></code></pre>
<h3 id="Groupæ¨¡å—"><a href="#Groupæ¨¡å—" class="headerlink" title="Groupæ¨¡å—"></a>Groupæ¨¡å—</h3><p>è®¾ç½®ä¸»æœºçš„ç»„çŠ¶æ€ï¼Œå¯¹ç»„çŠ¶æ€è¿›è¡Œç¼–è¾‘ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ§åˆ¶æ‰€æœ‰ä¸»æœºåˆ›å»ºç»„testgrp,è®¾ç½®å†…å®¹æœ‰gid,éç³»ç»Ÿç»„</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> group <span class="token parameter variable">-a</span> <span class="token string">"gid=3000 name=testgrp state=present system=no"</span>
<span class="token comment"># æ§åˆ¶æ‰€æœ‰ä¸»æœºåˆ é™¤testgrp</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> group <span class="token parameter variable">-a</span> <span class="token string">"gid=3000 name=testgrp state=absent"</span></code></pre>
<h3 id="Copyæ¨¡å—"><a href="#Copyæ¨¡å—" class="headerlink" title="Copyæ¨¡å—"></a>Copyæ¨¡å—</h3><p>ä»æœ¬åœ°å¤åˆ¶å†…å®¹åˆ°æ§åˆ¶çš„æ‰€æœ‰ä¸»æœº,æŒ‡å®šæºåœ°å€å’Œç›®çš„åœ°å€ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¤åˆ¶æœ¬åœ°/etc/fstabåˆ°æ‰€æœ‰ä¸»æœºçš„/tmp/fstab.ansible,åŒæ—¶è®¾ç½®æƒé™ä¸º755</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">"src=/etc/fstab dest=/tmp/fstab.ansible mode=755"</span>
<span class="token comment"># é€šè¿‡é”®ç›˜è¾“å…¥çš„æ–‡æœ¬å†…å®¹ä¼ è¾“åˆ°ç›®çš„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å¯ä¸å­˜åœ¨ï¼Œå¯åŒæ—¶è®¾ç½®æ–‡ä»¶çš„å±ä¸»å±ç»„</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">"content='hello,world<span class="token entity" title="\n">\n</span>' dest=/tmp/test.txt owner=liarlee group=liarlee"</span>
<span class="token comment"># é€’å½’å¤åˆ¶ç›®å½•åŠå…¶å­æ–‡ä»¶åˆ°æ‰€æœ‰ä¸»æœºçš„/tmp/ä¸‹</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">"src=/etc/httpd dest=/tmp/"</span>
<span class="token comment"># å¤åˆ¶ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°æ‰€æœ‰ä¸»æœºçš„/tmp/ä¸‹ï¼Œä¸åˆ›å»ºå¯¹åº”çš„ç›®å½•</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">"src=/etc/httpd/ dest=/tmp/"</span>
<span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºçš„ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">"content='' dest=/tmp/testfile"</span></code></pre>
<h3 id="Fetchæ¨¡å—"><a href="#Fetchæ¨¡å—" class="headerlink" title="Fetchæ¨¡å—"></a>Fetchæ¨¡å—</h3><p>å¯ä»è¿œç¨‹ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä»æŸä¸ªä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ç›®å½•ï¼Œæ–‡ä»¶ä¸å­˜åœ¨é€€å‡º</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible <span class="token punctuation">[</span>HOST1<span class="token punctuation">]</span> <span class="token parameter variable">-m</span> fetch <span class="token parameter variable">-a</span> <span class="token string">"src=/etc/fstab dest=/tmp/fstab.host1 fail-on-missing=yes"</span></code></pre>
<h3 id="Commandæ¨¡å—"><a href="#Commandæ¨¡å—" class="headerlink" title="Commandæ¨¡å—"></a>Commandæ¨¡å—</h3><p>commandæ¨¡å—ä¸è°ƒç”¨shellå»è§£æå‘½ä»¤ï¼Œä»…ä»…è¯»å–ç¬¬ä¸€ä¸ªå‘½ä»¤è¿›è¡Œç®€å•æ‰§è¡Œ,å› æ­¤ä¸æ”¯æŒç®¡é“ä¼ é€’å‚æ•°ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œifconfig</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-a</span> <span class="token string">"ifconfig"</span></code></pre>
<h3 id="Shellæ¨¡å—"><a href="#Shellæ¨¡å—" class="headerlink" title="Shellæ¨¡å—"></a>Shellæ¨¡å—</h3><p>ä½¿ç”¨shellæ‰§è¡Œä¼ é€’çš„å‘½ä»¤ï¼Œæ”¯æŒç®¡é“ä¼ é€’å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰§è¡Œshellå‘½ä»¤ä¿®æ”¹ç”¨æˆ·çš„å¯†ç </span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">"echo PASSWORD | passwd --stdin user1"</span></code></pre>
<h3 id="Fileæ¨¡å—"><a href="#Fileæ¨¡å—" class="headerlink" title="Fileæ¨¡å—"></a>Fileæ¨¡å—</h3><p>ç”¨äºè®¾å®šæ–‡ä»¶çš„çŠ¶æ€ä»¥åŠå±æ€§</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šå»ºç«‹ç›®å½•</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">"path=/tmp/testdir state=directory"</span>
<span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šå¯¹æ–‡ä»¶å»ºç«‹ç¬¦å·é“¾æ¥</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">"src=/tmp/testfile path=/tmp/testfile.link state=link"</span>
<span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šè®¾ç½®æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">"path=/tmp/testfile mode=0755"</span></code></pre>
<h3 id="Cronæ¨¡å—"><a href="#Cronæ¨¡å—" class="headerlink" title="Cronæ¨¡å—"></a>Cronæ¨¡å—</h3><p>ç”¨äºè®¾ç½®è®¡åˆ’ä»»åŠ¡</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®æ¯ä¸‰åˆ†é’Ÿè¿è¡Œä¸€æ¬¡åŒæ­¥æ—¶é—´çš„è„šæœ¬</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">cron</span> <span class="token parameter variable">-a</span> <span class="token string">"miniute=*/3 name=synctime job='usr/sbin/update 172.16.0.1 &amp;> /dev/null'state=present"</span>
<span class="token comment"># åˆ é™¤è®¾ç½®çš„è®¡åˆ’ä»»åŠ¡</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">cron</span> <span class="token parameter variable">-a</span> <span class="token string">"miniute=*/3 name=synctime job='usr/sbin/update 172.16.0.1 &amp;> /dev/null'state=absent"</span></code></pre>
<h3 id="Yumæ¨¡å—"><a href="#Yumæ¨¡å—" class="headerlink" title="Yumæ¨¡å—"></a>Yumæ¨¡å—</h3><p>ç”¨äºè°ƒç”¨yumè¿›è¡Œè½¯ä»¶åŒ…çš„å®‰è£…å¸è½½ç­‰ï¼Œå®šä¹‰ä¸»æœºå®‰è£…è½¯ä»¶åŒ…çš„çŠ¶æ€</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºå®‰è£…nginx</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> yum <span class="token parameter variable">-a</span> <span class="token string">"name=nginx state=install"</span></code></pre>
<h3 id="Serviceæ¨¡å—"><a href="#Serviceæ¨¡å—" class="headerlink" title="Serviceæ¨¡å—"></a>Serviceæ¨¡å—</h3><p>ç”¨äºå®šä¹‰ç®¡ç†ç›®æ ‡ä¸»æœºçš„æœåŠ¡çŠ¶æ€</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰€æœ‰çš„ä¸»æœºä¸Šå¯åŠ¨nginxæœåŠ¡</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">service</span> <span class="token parameter variable">-a</span> <span class="token string">"name=nginx state=startd"</span>
<span class="token comment"># åœ¨æ‰€æœ‰çš„ä¸»æœºä¸Šè®¾ç½®nginxå¼€æœºå¯åŠ¨</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">service</span> <span class="token parameter variable">-a</span> <span class="token string">"name=nginx enabled"</span>
<span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šåœæ­¢nginxæœåŠ¡</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">service</span> <span class="token parameter variable">-a</span> <span class="token string">"name=nginx state=stoppd"</span>
<span class="token comment"># åœ¨æ‰€æœ‰çš„ä¸»æœºä¸Šé‡è½½nginxçš„é…ç½®æ–‡ä»¶</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">service</span> <span class="token parameter variable">-a</span> <span class="token string">"name=nginx state=reloaded"</span>
<span class="token comment"># åœ¨æ‰€æœ‰ä¸»æœºä¸Šé‡å¯nginxæœåŠ¡</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> <span class="token function">service</span> <span class="token parameter variable">-a</span> <span class="token string">"name=nginx state=restarted"</span></code></pre>
<h3 id="Scriptsæ¨¡å—"><a href="#Scriptsæ¨¡å—" class="headerlink" title="Scriptsæ¨¡å—"></a>Scriptsæ¨¡å—</h3><p>ç”¨äºåœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œè®¾ç½®å¥½çš„è„šæœ¬</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœ¨æ‰€æœ‰çš„ä¸»æœºä¸Šæ‰§è¡Œtest.sh</span>
    <span class="token punctuation">[</span>root@localhost Liarlee<span class="token punctuation">]</span>$ ansible all <span class="token parameter variable">-m</span> scripts <span class="token parameter variable">-a</span> <span class="token string">"/tmp/test.sh"</span></code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansibleç¬”è®°-2</title>
    <url>/2019/07/07/Linux/Linux_Ansible-Note-2/</url>
    <content><![CDATA[<p>è¿™ä»½ç¬”è®°ä»‹ç»çš„æ˜¯Ansible playbookçš„æ ¼å¼åŠç›¸å…³çš„å†…å®¹ã€‚</p>
<h1 id="Ansibleç¬”è®°"><a href="#Ansibleç¬”è®°" class="headerlink" title="Ansibleç¬”è®°"></a>Ansibleç¬”è®°</h1><h2 id="Ansible-Playbook"><a href="#Ansible-Playbook" class="headerlink" title="Ansible Playbook"></a>Ansible Playbook</h2><h3 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h3><blockquote>
<p>YAMLï¼ˆ&#x2F;ËˆjÃ¦mÉ™l&#x2F;ï¼Œå°¾éŸ³ç±»ä¼¼ camel ) æ˜¯â€œYAMLä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€â€çš„å¤–è¯­ç¼©å†™ï¼ˆè§å‰æ–¹å‚è€ƒèµ„æ–™åŸæ–‡å†…å®¹ï¼‰ï¼›ä½†ä¸ºäº†å¼ºè°ƒè¿™ç§è¯­è¨€ä»¥æ•°æ®åšä¸ºä¸­å¿ƒï¼Œè€Œä¸æ˜¯ä»¥ç½®æ ‡è¯­è¨€ä¸ºé‡ç‚¹ï¼Œè€Œç”¨è¿”ç’è¯é‡æ–°å‘½åã€‚å®ƒæ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œæ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜å¹¶ä¸”å®¹æ˜“è¢«äººç±»é˜…è¯»ï¼Œå®¹æ˜“å’Œè„šæœ¬è¯­è¨€äº¤äº’ï¼Œç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„ç¼–ç¨‹è¯­è¨€ã€‚<br><strong>æ•°æ®ç»“æ„</strong>å¯ä»¥ç”¨ç±»ä¼¼<strong>å¤§çº²çš„ç¼©æ’æ–¹å¼</strong>å‘ˆç°ï¼Œ<strong>ç»“æ„é€šè¿‡ç¼©è¿›æ¥è¡¨ç¤º</strong>ï¼Œ<strong>è¿ç»­çš„é¡¹ç›®é€šè¿‡å‡å·â€œ-â€æ¥è¡¨ç¤º</strong>ï¼Œ<strong>mapç»“æ„é‡Œé¢çš„key&#x2F;valueå¯¹ç”¨å†’å·â€œ:â€æ¥åˆ†éš”</strong>ã€‚<br>YAMLæ–‡ä»¶ä¸€èˆ¬çš„æ–‡ä»¶åä¸º.yaml æˆ– .yml,æ–‡æœ¬ç»“æ„ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
</blockquote>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">house</span><span class="token punctuation">:</span>
  <span class="token key atrule">family</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Doe
    <span class="token key atrule">parents</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> John
      <span class="token punctuation">-</span> Jane
    <span class="token key atrule">children</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> Paul
      <span class="token punctuation">-</span> Mark
      <span class="token punctuation">-</span> Simone
  <span class="token key atrule">address</span><span class="token punctuation">:</span>
    <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">34</span>
    <span class="token key atrule">street</span><span class="token punctuation">:</span> Main Street
    <span class="token key atrule">city</span><span class="token punctuation">:</span> Nowheretown
    <span class="token key atrule">zipcode</span><span class="token punctuation">:</span> <span class="token number">12345</span></code></pre>
<h3 id="Ansible-Playbookçš„å…³é”®å­—"><a href="#Ansible-Playbookçš„å…³é”®å­—" class="headerlink" title="Ansible Playbookçš„å…³é”®å­—"></a>Ansible Playbookçš„å…³é”®å­—</h3><p>å†…å®¹ä¸å‘½ä»¤çš„å†…å®¹åŸºæœ¬ä¸€è‡´ï¼Œæœ‰å¦‚ä¸‹çš„å‡ ä¸ªå…³é”®å­—ï¼š</p>
<ol>
<li><strong>- hosts</strong>  ç”¨æ¥æŒ‡å®šæ§åˆ¶ä¸»æœºçš„èŒƒå›´,<strong>æ³¨æ„çŸ­æ¨ªçº¿åç©ºæ ¼æ¥å­—ç¬¦</strong></li>
<li><strong>remote_user</strong> ç”¨æ¥æŒ‡å®šä½¿ç”¨çš„ç”¨æˆ·</li>
<li><strong>tasks</strong> å¯åœ¨å­—æ®µä¸‹æ–¹ç¼©è¿›æŒ‡å®šéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡,<strong>æ³¨æ„ç¼©è¿›</strong><ol>
<li><strong>- name</strong> ç”¨æ¥å®šä¹‰ä»»åŠ¡çš„åç§°æˆ–æè¿°,<strong>æ³¨æ„çŸ­æ¨ªçº¿åç©ºæ ¼æ¥å­—ç¬¦</strong></li>
<li><strong>yum</strong>: name&#x3D;httpd state&#x3D;latest å®šä¹‰ä½¿ç”¨çš„æ¨¡å—åŠŸèƒ½ï¼šåé¢è·Ÿæ“ä½œå‚æ•°</li>
<li><strong>tags</strong>: å¯¹ä»»åŠ¡è¿›è¡Œæ ‡è®°ï¼Œå¯é€šè¿‡å‘½ä»¤è°ƒç”¨æ ‡è®°æ‰§è¡Œæˆ–æ’é™¤æŸäº›ä»»åŠ¡</li>
<li><strong>when</strong>: åˆ¤æ–­ï¼Œæ»¡è¶³whenåé¢çš„æ¡ä»¶æ‰æ‰§è¡Œä»»åŠ¡</li>
<li><strong>notify</strong>: è§¦å‘handlerçš„æ ‡å¿—</li>
</ol>
</li>
<li><strong>handlers</strong>: å®šä¹‰è§¦å‘ä»»åŠ¡çš„å†…å®¹<ol>
<li><strong>- name</strong>: ä»»åŠ¡çš„åç§°,<strong>æ³¨æ„çŸ­æ¨ªçº¿åç©ºæ ¼æ¥å­—ç¬¦</strong></li>
<li><strong>service</strong>: name&#x3D;httpd state&#x3D;restarted å®šä¹‰ä½¿ç”¨çš„æ¨¡å—ï¼šåé¢è·Ÿæ“ä½œå‚æ•°</li>
</ol>
</li>
</ol>
<h3 id="Ansible-Playbookç¤ºä¾‹"><a href="#Ansible-Playbookç¤ºä¾‹" class="headerlink" title="Ansible Playbookç¤ºä¾‹"></a>Ansible Playbookç¤ºä¾‹</h3><p>å…ˆçœ‹ä¸€ä¸ªå·²ç»å†™å¥½çš„playbookï¼Œé’ˆå¯¹å†™å¥½çš„æ¥è§£é‡Šplaybookå¦‚ä½•ä¹¦å†™ã€‚</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>		<span class="token comment"># é»˜è®¤çš„å¼€å¤´</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all 		<span class="token comment"># å…ˆå®šä¹‰æ§åˆ¶çš„èŒƒå›´ï¼Œallè¡¨ç¤ºæ‰€æœ‰ä¸»æœºï¼Œåˆ†ç»„å¯å®šä¹‰åœ¨/etc/ansible/hostsæ–‡ä»¶ä¸­ï¼›</span>
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root	<span class="token comment"># å®šä¹‰æ‰§è¡Œä¸‹é¢æ“ä½œçš„ç”¨æˆ·ï¼Œæ§åˆ¶æƒé™</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>		<span class="token comment"># taskså­—æ®µè´Ÿè´£å®šä¹‰ä»»åŠ¡</span>
  <span class="token comment"># å¦‚æœæ˜¯Redhatç³»ï¼Œæ‰§è¡Œå®‰è£…httpd</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install httpd CentOS
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> latest
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> install_httpd
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_os_family == "RedHat"
  <span class="token comment"># å¦‚æœæ˜¯Debainç³»ï¼Œæ‰§è¡Œå®‰è£…apache</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install httpd Ubuntu
      <span class="token key atrule">apt</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> apache
        <span class="token key atrule">state</span><span class="token punctuation">:</span> latest
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_os_family == "Ubuntu" 
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> install_httpd
  <span class="token comment"># æ‰§è¡Œç½‘ç«™ä¸»é¡µçš„æ›¿æ¢ï¼Œå¦‚æœå˜æ›´è§¦å‘handlerå­—æ®µå®šä¹‰çš„é‡å¯æœåŠ¡ä»»åŠ¡</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> set the homepage
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> 
        <span class="token key atrule">src</span><span class="token punctuation">:</span> ./index.html
        <span class="token key atrule">dest</span><span class="token punctuation">:</span> /var/www/html/index.html
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> restart_the_service
  <span class="token comment"># æ‰§è¡Œå¯åŠ¨æœåŠ¡</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start httpd
      <span class="token key atrule">service</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">service</span><span class="token punctuation">:</span> started
  <span class="token comment"># æ‰§è¡Œæ¸…ç©ºé˜²ç«å¢™</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> empty firewalld
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> iptables <span class="token punctuation">-</span>F
  <span class="token comment"># ç§»é™¤apacheè½¯ä»¶åŒ…</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> remove httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> absent
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> remove_httpd
  <span class="token comment"># åˆ é™¤é¢„è®¾çš„apacheç½‘ç«™æ–‡ä»¶</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> clean stuff
      <span class="token key atrule">file</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> /var/www/html/
        <span class="token key atrule">state</span><span class="token punctuation">:</span> absent
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> clean_stuff
  <span class="token comment">#  handlerè§¦å‘åéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span>
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
  <span class="token comment"># é‡å¯httpdæœåŠ¡</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart_the_service
      <span class="token key atrule">service</span><span class="token punctuation">:</span> 
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> restarted</code></pre>
<h3 id="Ansible-Playbookæ‰§è¡Œå‘½ä»¤"><a href="#Ansible-Playbookæ‰§è¡Œå‘½ä»¤" class="headerlink" title="Ansible Playbookæ‰§è¡Œå‘½ä»¤"></a>Ansible Playbookæ‰§è¡Œå‘½ä»¤</h3><pre class="language-bash" data-language="bash"><code class="language-bash">ä½¿ç”¨æ ¼å¼ï¼š
  ansible-playbook <span class="token punctuation">[</span>options<span class="token punctuation">]</span> playbook.yml <span class="token punctuation">[</span>playbook2 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
å‘½ä»¤ä½œç”¨ï¼š
  Runs Ansible playbooks, executing the defined tasks on the targeted hosts.
  <span class="token comment"># è¿è¡Œansibleçš„playbookï¼Œåœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œå·²ç»å®šä¹‰å¥½çš„ä»»åŠ¡ã€‚</span>

å‘½ä»¤ç¤ºä¾‹ï¼š
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook --syntax-check install_httpd.yaml
<span class="token comment"># å¯¹playbookè¿›è¡Œè¯­æ³•æ£€æŸ¥</span>
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook <span class="token parameter variable">-C</span> install_httpd.yaml
<span class="token comment"># å¯¹playbookè¿›è¡Œè¿è¡Œæµ‹è¯•ï¼Œä¸æ”¹å˜ç»“æœï¼Œä»…ä»…è¿›è¡Œæµ‹è¯•</span>
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook install_httpd.yaml
<span class="token comment"># å¯¹playbookè¿›è¡Œè¿è¡Œï¼Œå¹¶ç”Ÿæˆè¿è¡Œçš„ç»“æœ</span>
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook <span class="token parameter variable">-t</span> <span class="token string">"install_httpd"</span> install-httpd.yaml
<span class="token comment"># åªè¿è¡Œå…·æœ‰â€œinstall_httpdâ€æ ‡ç­¾çš„ä»»åŠ¡</span>
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook --skip-tags <span class="token string">"install_httpd"</span> install-httpd.yaml
<span class="token comment"># è·³è¿‡install_httpdæ ‡ç­¾çš„ä»»åŠ¡</span>
<span class="token punctuation">[</span>root@Hayden ~<span class="token punctuation">]</span>$ ansible-playbook --skip-tags <span class="token string">"install_httpd clean_stuff"</span> install-httpd.yaml
<span class="token comment"># è·³è¿‡å¤šä¸ªæ ‡ç­¾çš„ä»»åŠ¡ç¤ºä¾‹</span></code></pre>

<h2 id="é»˜è®¤æ–‡ä»¶ä½ç½®"><a href="#é»˜è®¤æ–‡ä»¶ä½ç½®" class="headerlink" title="é»˜è®¤æ–‡ä»¶ä½ç½®"></a>é»˜è®¤æ–‡ä»¶ä½ç½®</h2><p>sudo pacman -Ql ansible | grep hosts æŸ¥çœ‹hostsæ–‡ä»¶çš„èŒƒä¾‹æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå…¶ä»–æ–‡ä»¶æ“ä½œç±»ä¼¼.</p>
<p>å¦‚æœæœ‰ä¸æ˜ç™½çš„å‘½ä»¤å¯é€šè¿‡ansible-docå‘½ä»¤ç›´æ¥æŸ¥çœ‹å†…ç½®çš„è¯´æ˜æ–‡ä»¶ï¼Œé’ˆå¯¹æ¨¡å—çš„<br>ansible-doc -l ä¸ºåˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡å—</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>Archlinuxå®‰è£…è¿‡ç¨‹è®°å½•</title>
    <url>/2019/05/17/Linux/Linux_Archlinux-Installation/</url>
    <content><![CDATA[<p>è‡ªå·±å°è¯•å®‰è£…äº†archlinuxåœ¨è™šæ‹Ÿæœºé‡Œï¼Œè®°å½•å®‰è£…è¿‡ç¨‹ï¼Œä¸è¿‡ç°åœ¨archlinuxçš„WIKIæ˜¯æè¿°æ¸…æ™°çš„ï¼Œç›´æ¥æŸ¥çœ‹å’Œå‚è€ƒå³å¯ã€‚  </p>
<h2 id="Pacmanå¸¸ç”¨å‘½ä»¤"><a href="#Pacmanå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Pacmanå¸¸ç”¨å‘½ä»¤"></a>Pacmanå¸¸ç”¨å‘½ä»¤</h2><p>pacmanå‘½ä»¤çš„å¸¸ç”¨è¯´æ˜ï¼š  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee ~]# pacman -Sg gnome  æŸ¥çœ‹gnomeè½¯ä»¶åŒ…ç»„ä¸‹é¢çš„æ‰€æœ‰è½¯ä»¶åŒ…  
[root@LiarLee ~]# pacman -Qe openssh  æŸ¥è¯¢å·²ç»å®‰è£…çš„è½¯ä»¶åŒ…  
[root@LiarLee ~]# pacman -Qs openssh  æ­£åˆ™æŸ¥è¯¢è½¯ä»¶åŒ…
[root@LiarLee ~]# pacman -Rs $(pacman -Qtdq) é€’å½’åˆ é™¤å­¤ç«‹è½¯ä»¶åŒ…
[root@LiarLee ~]# pacman -Ss å…³é”®å­—ï¼šåœ¨ä»“åº“ä¸­æœç´¢å«å…³é”®å­—çš„åŒ…
[root@LiarLee ~]# pacman -Qs å…³é”®å­—ï¼š æœç´¢å·²å®‰è£…çš„åŒ…
[root@LiarLee ~]# pacman -Qi åŒ…åï¼šæŸ¥çœ‹æœ‰å…³åŒ…çš„è¯¦å°½ä¿¡æ¯
[root@LiarLee ~]# pacman -Ql åŒ…åï¼šåˆ—å‡ºè¯¥åŒ…çš„æ–‡ä»¶
[root@LiarLee ~]# pacman -Syyu ä¸‹è½½å·²ç»æ›´æ–°æœ¬åœ°çš„æ‰€æœ‰è½¯ä»¶åŒ…</code></pre>

<h2 id="å®‰è£…Archlinux"><a href="#å®‰è£…Archlinux" class="headerlink" title="å®‰è£…Archlinux"></a>å®‰è£…Archlinux</h2><h3 id="1-è·å–Archlinuxé•œåƒ"><a href="#1-è·å–Archlinuxé•œåƒ" class="headerlink" title="1. è·å–Archlinuxé•œåƒ"></a>1. è·å–Archlinuxé•œåƒ</h3><p>ä»è¿™ä¸ªé¡µé¢è·å–é•œåƒï¼š <a href="https://www.archlinux.org/download/">LINK HERE</a></p>
<h3 id="2-å¯åŠ¨åˆ°Archlinux-Liveç¯å¢ƒ"><a href="#2-å¯åŠ¨åˆ°Archlinux-Liveç¯å¢ƒ" class="headerlink" title="2. å¯åŠ¨åˆ°Archlinux Liveç¯å¢ƒ"></a>2. å¯åŠ¨åˆ°Archlinux Liveç¯å¢ƒ</h3><p>åœ¨VMwareä¸­ä½¿ç”¨é•œåƒæ–‡ä»¶ç›´æ¥å¼•å¯¼Archlinux Liveç¯å¢ƒã€‚  </p>
<h3 id="3-è®¾ç½®Archlinuxçš„é”®ç›˜å¸ƒå±€"><a href="#3-è®¾ç½®Archlinuxçš„é”®ç›˜å¸ƒå±€" class="headerlink" title="3. è®¾ç½®Archlinuxçš„é”®ç›˜å¸ƒå±€"></a>3. è®¾ç½®Archlinuxçš„é”®ç›˜å¸ƒå±€</h3><p>é»˜è®¤ä¸ºUSé”®ç›˜å¸ƒå±€ï¼Œæ­¤å¤„æœªä½œä¿®æ”¹ã€‚    </p>
<h3 id="4-è¿æ¥åˆ°Internet"><a href="#4-è¿æ¥åˆ°Internet" class="headerlink" title="4. è¿æ¥åˆ°Internet"></a>4. è¿æ¥åˆ°Internet</h3><p>ä½¿ç”¨ip linkå‘½ä»¤æŸ¥çœ‹ç›®å‰ç½‘å¡çš„çŠ¶æ€  </p>
<pre class="language-none"><code class="language-none">root@archiso ~ # ip link show
  1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
  2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; dmtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link&#x2F;ether 00:0c:29:5e:ea:d5 brd ff:ff:ff:ff:ff:ff
  
root@archiso ~ # ifconfig
  ens33: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
      inet 192.168.229.129  netmask 255.255.255.0  broadcast 192.168.229.255
      inet6 fe80::9888:f57a:5c25:9cf9  prefixlen 64  scopeid 0x20&lt;link&gt;
      inet6 fd15:4ba5:5a2b:1008:6e02:ff6:feeb:c250  prefixlen 64  scopeid 0x0&lt;global&gt;
      ether 00:0c:29:5e:ea:d5  txqueuelen 1000  (Ethernet)
      RX packets 199  bytes 18652 (18.2 KiB)
      RX errors 0  dropped 0  overruns 0  frame 0
      TX packets 186  bytes 23144 (22.6 KiB)
      TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

  lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
      inet 127.0.0.1  netmask 255.0.0.0
      inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
      loop  txqueuelen 1000  (Local Loopback)
      RX packets 0  bytes 0 (0.0 B)
      RX errors 0  dropped 0  overruns 0  frame 0
      TX packets 0  bytes 0 (0.0 B)
      TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
    
root@archiso ~ # ping baidu.com   
  PING baidu.com (123.125.114.144) 56(84) bytes of data.
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;1 ttl&#x3D;128 time&#x3D;14.8 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;2 ttl&#x3D;128 time&#x3D;13.6 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;3 ttl&#x3D;128 time&#x3D;17.1 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;4 ttl&#x3D;128 time&#x3D;14.1 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;5 ttl&#x3D;128 time&#x3D;13.9 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;6 ttl&#x3D;128 time&#x3D;14.7 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;7 ttl&#x3D;128 time&#x3D;13.5 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;8 ttl&#x3D;128 time&#x3D;16.2 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;9 ttl&#x3D;128 time&#x3D;16.9 ms
  64 bytes from 123.125.114.144 (123.125.114.144): icmp_seq&#x3D;10 ttl&#x3D;128 time&#x3D;14.1 ms
  ^C
  --- baidu.com ping statistics ---
  10 packets transmitted, 10 received, 0% packet loss, time 26ms
  rtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 13.543&#x2F;14.895&#x2F;17.105&#x2F;1.278 ms</code></pre>
<p>ç½‘ç»œè¿æ¥åˆ°æ­¤ä¸ºæ­¢æ— éœ€é…ç½®ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ç½‘ç»œã€‚</p>
<h3 id="5-æ›´æ–°ç³»ç»Ÿæ—¶é—´ï¼Œç¡¬ä»¶æ—¶é—´åŒæ­¥"><a href="#5-æ›´æ–°ç³»ç»Ÿæ—¶é—´ï¼Œç¡¬ä»¶æ—¶é—´åŒæ­¥" class="headerlink" title="5. æ›´æ–°ç³»ç»Ÿæ—¶é—´ï¼Œç¡¬ä»¶æ—¶é—´åŒæ­¥"></a>5. æ›´æ–°ç³»ç»Ÿæ—¶é—´ï¼Œç¡¬ä»¶æ—¶é—´åŒæ­¥</h3><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´ä»¥åŠç¡¬ä»¶æ—¶é—´ï¼Œå°†åŒæ­¥çš„å½“å‰æ—¶é—´å†™å…¥ç¡¬ä»¶ï¼š  </p>
<pre class="language-none"><code class="language-none">root@archiso ~ # timedatectl status
      Local time: Wed 2019-04-24 08:55:39 UTC
    Universal time: Wed 2019-04-24 08:55:39 UTC
        RTC time: Wed 2019-04-24 08:55:40
        Time zone: UTC (UTC, +0000)
System clock synchronized: yes
      NTP service: active
    RTC in local TZ: no

root@archiso ~ # timedatectl set-ntp true</code></pre>

<h3 id="6-å»ºç«‹ç³»ç»Ÿçš„ç¡¬ç›˜åˆ†åŒº"><a href="#6-å»ºç«‹ç³»ç»Ÿçš„ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="6. å»ºç«‹ç³»ç»Ÿçš„ç¡¬ç›˜åˆ†åŒº"></a>6. å»ºç«‹ç³»ç»Ÿçš„ç¡¬ç›˜åˆ†åŒº</h3><p>å»ºç«‹ç¡¬ç›˜åˆ†åŒºï¼Œæˆ‘å»ºç«‹äº†ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ ¹åˆ†åŒºå’Œä¸€ä¸ªäº¤æ¢åˆ†åŒºã€‚  </p>
<pre class="language-none"><code class="language-none">root@archiso ~ # fdisk -l 
  Disk &#x2F;dev&#x2F;sda: 50 GiB, 53687091200 bytes, 104857600 sectors
  Disk model: VMware Virtual S
  Units: sectors of 1 * 512 &#x3D; 512 bytes
  Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes
  I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes
  Disklabel type: dos
  Disk identifier: 0xba00941d

  Device     Boot   Start       End   Sectors  Size Id Type
  &#x2F;dev&#x2F;sda1          2048   1050623   1048576  512M 82 Linux swap &#x2F; Solaris
  &#x2F;dev&#x2F;sda2       1050624 104857599 103806976 49.5G 83 Linux


  Disk &#x2F;dev&#x2F;loop0: 491.2 MiB, 515084288 bytes, 1006024 sectors
  Units: sectors of 1 * 512 &#x3D; 512 bytes
  Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes
  I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes</code></pre>
<h3 id="7-å·²ç»å»ºç«‹åˆ†åŒºçš„æ ¼å¼åŒ–"><a href="#7-å·²ç»å»ºç«‹åˆ†åŒºçš„æ ¼å¼åŒ–" class="headerlink" title="7. å·²ç»å»ºç«‹åˆ†åŒºçš„æ ¼å¼åŒ–"></a>7. å·²ç»å»ºç«‹åˆ†åŒºçš„æ ¼å¼åŒ–</h3><ol>
<li>æ ¼å¼åŒ–ext4åˆ†åŒº<pre class="language-none"><code class="language-none">root@archiso ~ # mkfs.ext4 &#x2F;dev&#x2F;sda2</code></pre></li>
<li>æ ¼å¼åŒ–swapåˆ†åŒº<pre class="language-none"><code class="language-none">root@archiso ~ # mkswap &#x2F;dev&#x2F;sda1  # å°†&#x2F;dev&#x2F;sda1æ ¼å¼åŒ–ä¸ºswapåˆ†åŒº
root@archiso ~ # swapon &#x2F;dev&#x2F;sda1  # å°†&#x2F;dev&#x2F;sda1å¯ç”¨ä¸ºswapåˆ†åŒº</code></pre></li>
</ol>
<h3 id="8-æŒ‚è½½åˆ†åŒº"><a href="#8-æŒ‚è½½åˆ†åŒº" class="headerlink" title="8. æŒ‚è½½åˆ†åŒº"></a>8. æŒ‚è½½åˆ†åŒº</h3><p>ä½¿ç”¨ç³»ç»ŸæŒ‚è½½ç‚¹&#x2F;mntï¼Œå°†&#x2F;dev&#x2F;sda2ä½œä¸ºç³»ç»Ÿçš„æ ¹ç›®å½•æŒ‚è½½åˆ°&#x2F;mntä¸Šã€‚ </p>
<pre class="language-none"><code class="language-none">root@archiso ~ # mount &#x2F;dev&#x2F;sda2 &#x2F;mnt</code></pre>
<h3 id="9-å®šä¹‰å®‰è£…æ‰€éœ€çš„Mirrorlist"><a href="#9-å®šä¹‰å®‰è£…æ‰€éœ€çš„Mirrorlist" class="headerlink" title="9. å®šä¹‰å®‰è£…æ‰€éœ€çš„Mirrorlist"></a>9. å®šä¹‰å®‰è£…æ‰€éœ€çš„Mirrorlist</h3><h3 id="10-å®‰è£…åŸºç¡€çš„Archlinuxç³»ç»Ÿç»„ä»¶"><a href="#10-å®‰è£…åŸºç¡€çš„Archlinuxç³»ç»Ÿç»„ä»¶" class="headerlink" title="10. å®‰è£…åŸºç¡€çš„Archlinuxç³»ç»Ÿç»„ä»¶"></a>10. å®‰è£…åŸºç¡€çš„Archlinuxç³»ç»Ÿç»„ä»¶</h3><p>éƒ¨ç½²å®‰è£…linuxçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®‰è£…ç³»ç»ŸåŸºç¡€ç»„å»ºçš„è½¯ä»¶åŒ…ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# pacstrap &#x2F;mnt base</code></pre>
<h3 id="11-æ–°ç³»ç»Ÿçš„ç›¸å…³é…ç½®"><a href="#11-æ–°ç³»ç»Ÿçš„ç›¸å…³é…ç½®" class="headerlink" title="11. æ–°ç³»ç»Ÿçš„ç›¸å…³é…ç½®"></a>11. æ–°ç³»ç»Ÿçš„ç›¸å…³é…ç½®</h3><h4 id="1-Fstab"><a href="#1-Fstab" class="headerlink" title="1. Fstab"></a>1. Fstab</h4><p>æ ¹æ®è‡ªå·±å»ºç«‹çš„åˆ†åŒºè‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿçš„åˆ†åŒºè¡¨ã€‚<br>    <pre class="language-none"><code class="language-none">  [root@LiarLee &#x2F;]# genfstab -U &#x2F;mnt &gt;&gt; &#x2F;mnt&#x2F;etc&#x2F;fstab		# ç”Ÿæˆæ–°çš„fstabï¼Œå†™å…¥å®‰è£…ç¡¬ç›˜çš„&#x2F;etc&#x2F;fstab  
  [root@LiarLee ~]# cat &#x2F;etc&#x2F;fstab		#  æŸ¥çœ‹æ–°çš„åˆ†åŒºè¡¨
# Static Information about the Filesystems.
# See fstab(5) for Details.

    # &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;
    # &#x2F;dev&#x2F;sda2
    UUID&#x3D;3b61b364-b9eb-4e31-b65a-55fdcf09c614	&#x2F;         	ext4      	rw,relatime	0 1
  
    # &#x2F;dev&#x2F;sda1
    UUID&#x3D;91987ac9-fa6b-4ac5-a9c5-014169dcf058	none      	swap      	defaults  	0 0</code></pre></p>
<h4 id="2-Chroot"><a href="#2-Chroot" class="headerlink" title="2. Chroot"></a>2. Chroot</h4><p>ä½¿ç”¨chrootå‘½ä»¤åˆ‡æ¢æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# arch-chroot &#x2F;mnt</code></pre>
<h4 id="3-Timezone"><a href="#3-Timezone" class="headerlink" title="3. Timezone"></a>3. Timezone</h4><p>chrootå‘½ä»¤ç›¸å½“äºç›´æ¥å°†å½“å‰çš„shellåˆ‡æ¢åˆ°äº†æ–°å®‰è£…çš„ç³»ç»Ÿä¸­ã€‚<br>è®¾ç½®æ–°çš„ç³»ç»Ÿçš„æ—¶é—´åŠåŒæ­¥ç¡¬ä»¶æ—¶é—´ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime
[root@LiarLee &#x2F;]# hwclock --systohc</code></pre>
<h4 id="4-æœ¬åœ°è®¾ç½®"><a href="#4-æœ¬åœ°è®¾ç½®" class="headerlink" title="4. æœ¬åœ°è®¾ç½®"></a>4. æœ¬åœ°è®¾ç½®</h4><h4 id="5-ç½‘ç»œè®¾ç½®"><a href="#5-ç½‘ç»œè®¾ç½®" class="headerlink" title="5. ç½‘ç»œè®¾ç½®"></a>5. ç½‘ç»œè®¾ç½®</h4><p>é…ç½®hostnameä»¥åŠæœ¬åœ°è§£æhostsæ–‡ä»¶çš„è§£ææ¡ç›®ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# vim &#x2F;etc&#x2F;hostname
  YOUR_HOSTNAME.YOUR_DOMAIN

[root@LiarLee &#x2F;]# vim &#x2F;etc&#x2F;hosts
  127.0.0.1	localhost
  ::1		localhost
  IP_ADDRESS 	YOUR_HOSTNAME.YOUR_DOMAIN YOUR_HOSTNAME</code></pre>

<h4 id="6-ç”Ÿæˆinitramfs"><a href="#6-ç”Ÿæˆinitramfs" class="headerlink" title="6. ç”Ÿæˆinitramfs"></a>6. ç”Ÿæˆinitramfs</h4><p>ä¸ºæ–°çš„ç³»ç»Ÿç”Ÿæˆramfsã€‚<br>ramfsçš„ä½œç”¨æ˜¯ï¼Œåˆ©ç”¨ramfsçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¿«é€Ÿé©±åŠ¨å‘¨è¾¹çš„ç³»ç»Ÿè®¾å¤‡ã€‚åœ¨ramfsçš„ä½¿å‘½ç»“æŸåï¼Œè‡ªåŠ¨chrootåˆ°æ–°ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# mkinitcpio -p linux</code></pre>
<h4 id="7-è®¾ç½®rootå¯†ç "><a href="#7-è®¾ç½®rootå¯†ç " class="headerlink" title="7. è®¾ç½®rootå¯†ç "></a>7. è®¾ç½®rootå¯†ç </h4><p>ä¿®æ”¹rootå¯†ç ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# passwd </code></pre>
<h4 id="8-å®‰è£…grub2"><a href="#8-å®‰è£…grub2" class="headerlink" title="8. å®‰è£…grub2"></a>8. å®‰è£…grub2</h4><p>è¿™é‡Œpacmanå‘½ä»¤å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼Œå› æ­¤ç›´æ¥åœ¨è¿™ä¸ªå®‰è£…grub2ï¼Œè¿™æ ·æ‰å¯ä»¥åœ¨åé¢æ­£ç¡®çš„é‡å¯åˆ°æ–°å®‰è£…å¥½çš„ç³»ç»Ÿã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# pacman -S grub2 
[root@LiarLee &#x2F;]# grub-mkconfig </code></pre>
<h3 id="12-é‡å¯å¼•å¯¼æ–°ç³»ç»Ÿ"><a href="#12-é‡å¯å¼•å¯¼æ–°ç³»ç»Ÿ" class="headerlink" title="12. é‡å¯å¼•å¯¼æ–°ç³»ç»Ÿ"></a>12. é‡å¯å¼•å¯¼æ–°ç³»ç»Ÿ</h3><p>å°†å·²ç»å®‰è£…å®Œæˆçš„é‚£ä¸ªæ ¹åˆ†åŒºå¸è½½ï¼Œä¹‹åå°±å¯ä»¥é‡å¯äº†ã€‚  </p>
<pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# umount -R &#x2F;mnt  # umount æ¥è§¦æŒ‚è½½æ–°çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ  
[root@LiarLee &#x2F;]# fuser &#x2F;mnt		# fuser æŸ¥çœ‹å ç”¨æ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹ï¼Œå¦‚æœç¡®è®¤çš„è¯å¯ä»¥ç›´æ¥-kç»“æŸæ‰€æœ‰å ç”¨çš„è¿›ç¨‹
[root@LiarLee &#x2F;]# reboot 		# é‡å¯</code></pre>
<h3 id="13-å®‰è£…å›¾å½¢åŒ–ç•Œé¢"><a href="#13-å®‰è£…å›¾å½¢åŒ–ç•Œé¢" class="headerlink" title="13. å®‰è£…å›¾å½¢åŒ–ç•Œé¢"></a>13. å®‰è£…å›¾å½¢åŒ–ç•Œé¢</h3><h4 id="1-å®‰è£…Xorg"><a href="#1-å®‰è£…Xorg" class="headerlink" title="1. å®‰è£…Xorg"></a>1. å®‰è£…Xorg</h4><p>å®‰è£…å¦‚ä¸‹çš„æ‰€æœ‰ç»„ä»¶ï¼Œé‡å¯å°±å¯ä»¥è¿›å…¥å›¾å½¢åŒ–ç¯å¢ƒäº†ã€‚<br>    1. è¿è¡Œé”™è¯¯ xterm:command not found<br>        <code>[root@LiarLee /]# pacman -S xterm zlib</code><br>    1. è¿è¡ŒæŠ¥é”™ twm:command not found<br>        <code>[root@LiarLee /]# pacman -S xorg-twm xorg-xclock</code><br>    1. å®‰è£…é¼ æ ‡é©±åŠ¨<br>        <code>[root@LiarLee /]# pacman -S xf86-input-mouse</code><br>    1. å®‰è£…VMwareå›¾å½¢é©±åŠ¨<br>        <code>[root@LiarLee /]# pacman -S xf86-video-vmware</code><br>    1. å®‰è£…XorgæœåŠ¡æœ¬ä½“<br>        <code>[root@LiarLee /]# pacman -S xorg-server xorg-xinit </code><br>    1. å®‰è£…Gnomeæ¡Œé¢ç¯å¢ƒ<br>        <code>[root@LiarLee /]# pacman -S gnome</code><br>    1. å®‰è£…GDM - Gnomeæ¡Œé¢ç®¡ç†å·¥å…·ï¼Œä¹Ÿå¯ç”¨å…¶ä»–æ›¿æ¢<br>        [<code>root@LiarLee /]# pacman -S gdm</code></p>
<h4 id="2-å®‰è£…å›¾å½¢åŒ–ä¹‹åæµ‹è¯•å¯åŠ¨é€Ÿåº¦"><a href="#2-å®‰è£…å›¾å½¢åŒ–ä¹‹åæµ‹è¯•å¯åŠ¨é€Ÿåº¦" class="headerlink" title="2. å®‰è£…å›¾å½¢åŒ–ä¹‹åæµ‹è¯•å¯åŠ¨é€Ÿåº¦"></a>2. å®‰è£…å›¾å½¢åŒ–ä¹‹åæµ‹è¯•å¯åŠ¨é€Ÿåº¦</h4><p>systemdæä¾›äº†å‘½ä»¤æ£€æµ‹å¯åŠ¨çš„é€Ÿåº¦ï¼ŒåŒ…æ‹¬å†…æ ¸å¯åŠ¨é€Ÿåº¦ä»¥åŠç”¨æˆ·ç©ºé—´çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>
<ol>
<li>systemd-analyze  </li>
<li>systemd-analyze blame</li>
</ol>
<pre class="language-none"><code class="language-none">[root@LiarLee ~]# systemd-analyze 
Startup finished in 1.892s (kernel) + 1.182s (userspace) &#x3D; 3.075s 
graphical.target reached after 1.182s in userspace</code></pre>
<h4 id="3-åˆ·æ–°å›½å†…çš„é•œåƒæº"><a href="#3-åˆ·æ–°å›½å†…çš„é•œåƒæº" class="headerlink" title="3. åˆ·æ–°å›½å†…çš„é•œåƒæº"></a>3. åˆ·æ–°å›½å†…çš„é•œåƒæº</h4><pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# cd &#x2F;etc&#x2F;pacman.d&#x2F;
[root@LiarLee pacman.d]#  mv mirrorlist mirrorlist.bak
[root@LiarLee pacman.d]#  wget -O &#x2F;etc&#x2F;pacman.d&#x2F;mirrorlist https:&#x2F;&#x2F;www.archlinux.org&#x2F;mirrorlist&#x2F;?country&#x3D;CN
[root@LiarLee pacman.d]#  mv mirrorlist mirrorlist.rank 
[root@LiarLee pacman.d]#  rankmirrors mirrorlist.rank &gt;&gt; mirrorlist
[root@LiarLee pacman.d]# sed &#39;s&#x2F;^Server&#x2F;#Server&#x2F;g&#39; .&#x2F;mirrorlist &gt;&gt; .&#x2F;mirrorlist
[root@LiarLee pacman.d]# s[root@LiarLee pacman.d]# spacman -Syyu</code></pre>
<h3 id="14-è‡ªè¡Œç¼–è¯‘å†…æ ¸æ“ä½œ"><a href="#14-è‡ªè¡Œç¼–è¯‘å†…æ ¸æ“ä½œ" class="headerlink" title="14. è‡ªè¡Œç¼–è¯‘å†…æ ¸æ“ä½œ"></a>14. è‡ªè¡Œç¼–è¯‘å†…æ ¸æ“ä½œ</h3><pre class="language-none"><code class="language-none">[root@LiarLee &#x2F;]# pacman -S base-devel bc xmlto kmod inetutils
[root@LiarLee &#x2F;]# useradd -d &#x2F;home&#x2F;admin -p admin admin  
[root@LiarLee &#x2F;]# chown -R admin:admin &#x2F;home&#x2F;admin
[root@LiarLee &#x2F;]# mkdir &#x2F;home&#x2F;admin&#x2F;mk-new-kernel&#x2F;
[root@LiarLee &#x2F;]# su - admin 
[root@LiarLee &#x2F;]# cd &#x2F;home&#x2F;admin&#x2F;mk-new-kernel&#x2F;
[root@LiarLee &#x2F;]# wget https:&#x2F;&#x2F;cdn.kernel.org&#x2F;pub&#x2F;linux&#x2F;kernel&#x2F;v5.x&#x2F;linux-5.0.8.tar.xz
[root@LiarLee &#x2F;]# tar xvf linux-5.0.8.tar.xz 
[root@LiarLee &#x2F;]# cd linux-5.0.8&#x2F;
[root@LiarLee &#x2F;]# make clean &amp;&amp; make mrproper
[root@LiarLee &#x2F;]# make localmodconfig
[root@LiarLee &#x2F;]# make nconfig
[root@LiarLee &#x2F;]# make </code></pre>
<h3 id="15-éƒ¨åˆ†é—®é¢˜"><a href="#15-éƒ¨åˆ†é—®é¢˜" class="headerlink" title="15. éƒ¨åˆ†é—®é¢˜"></a>15. éƒ¨åˆ†é—®é¢˜</h3><ol>
<li><p>é‡å¯ä¹‹åæ²¡æœ‰DHCPè·å–IPåœ°å€çš„è§£å†³æ–¹æ³•ï¼š  </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@LiarLee /<span class="token punctuation">]</span><span class="token comment"># systemctl enable dhcpcd</span>
<span class="token punctuation">[</span>root@LiarLee /<span class="token punctuation">]</span><span class="token comment"># systemctl start dhcpcd </span>
<span class="token punctuation">[</span>root@LiarLee /<span class="token punctuation">]</span><span class="token comment"># pacman -S net-tools</span></code></pre>
</li>
<li><p>Wayland + Sway + Hypeland. ï¼ˆè®¡åˆ’ä¸­ï¼Œ ç­‰æˆ‘é—²çš„ä¸è¡Œäº†â€¦..</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¯åŠ¨æµç¨‹ç®€è¿°</title>
    <url>/2019/07/13/Linux/Linux_Boot-sequence/</url>
    <content><![CDATA[<p>è®°å½•Linuxå¯åŠ¨æµç¨‹ã€‚</p>
<h1 id="Linuxå¯åŠ¨çš„ç®€è¦æµç¨‹"><a href="#Linuxå¯åŠ¨çš„ç®€è¦æµç¨‹" class="headerlink" title="Linuxå¯åŠ¨çš„ç®€è¦æµç¨‹"></a>Linuxå¯åŠ¨çš„ç®€è¦æµç¨‹</h1><h2 id="Linux-MBRå¯åŠ¨æµç¨‹"><a href="#Linux-MBRå¯åŠ¨æµç¨‹" class="headerlink" title="Linux-MBRå¯åŠ¨æµç¨‹"></a>Linux-MBRå¯åŠ¨æµç¨‹</h2><p>POST â€“ GRUB(Bootloader-MBR) â€“ Kernel â€“ init</p>
<h2 id="è¯¦ç»†æè¿°åŠè¯´æ˜"><a href="#è¯¦ç»†æè¿°åŠè¯´æ˜" class="headerlink" title="è¯¦ç»†æè¿°åŠè¯´æ˜"></a>è¯¦ç»†æè¿°åŠè¯´æ˜</h2><ol>
<li>åœ¨è§¦å‘å¼€æœºé€šç”µä¹‹åï¼Œè®¡ç®—æœºè¯»å–BIOSä¸­CMOSèŠ¯ç‰‡çš„å·²ç»å†™å¥½çš„ç¨‹åºè¿›è¡Œä¸»æ¿è®¾å¤‡çš„é€šç”µè‡ªæ£€.</li>
<li>åœ¨è‡ªæ£€å®Œæˆåå°†è¯»å–ç¡¬ç›˜ä¸Šçš„å‰512ä¸ªå­—èŠ‚ï¼Œé€šè¿‡å‰é¢çš„446ä¸ªå­—èŠ‚è½½å…¥grubçš„bootloaderåŠç¡¬ç›˜ç›¸å…³é©±åŠ¨.</li>
<li>åŒæ—¶å¼•å¯¼grubè¿›å…¥stage1.5,stage1.5æŒ‡å‘äº†å®šä¹‰åœ¨bootåˆ†åŒºä¸‹çš„grub.cfgï¼ŒåŠç›¸å…³çš„grubå›¾å½¢æ–‡ä»¶.</li>
<li>grubçš„stage2è¿›è¡Œäº†grubçš„èœå•å±•ç¤ºåŠå†…æ ¸é€‰æ‹©çš„ç•Œé¢.</li>
<li>é€šè¿‡grubçš„å¼•å¯¼ï¼Œè®¡ç®—æœºæŒ‚è½½å†…æ ¸ï¼Œè¯†åˆ«çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ.</li>
<li>å¯åŠ¨initè¿›ç¨‹ï¼Œé€šè¿‡SysVç®¡ç†å…¶ä»–è¿›ç¨‹çš„å¯åŠ¨åŠæ‰§è¡Œ.</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>RPMåˆ¶ä½œçš„ç¬”è®°</title>
    <url>/2018/07/03/Linux/Linux_BuildRPMs/</url>
    <content><![CDATA[<p>å…³äºåˆ¶ä½œRPMåŒ…çš„ç¬”è®°ï½</p>
<h2 id="ä¸€-åˆ¶ä½œRPMåŒ…æ•™ç¨‹"><a href="#ä¸€-åˆ¶ä½œRPMåŒ…æ•™ç¨‹" class="headerlink" title="ä¸€. åˆ¶ä½œRPMåŒ…æ•™ç¨‹"></a>ä¸€. åˆ¶ä½œRPMåŒ…æ•™ç¨‹</h2><p>æºç åŒ…çš„åˆ¶ä½œæ•™ç¨‹åŸºäºRHEL 5 &amp; 6,å½“æˆ‘å†™è¿™ä¸ªçš„æ—¶å€™è¿˜æ²¡æœ‰7ç‰ˆæœ¬, æˆ‘ä¼šåœ¨åç»­æ›´æ–°æ–°ç‰ˆæœ¬çš„è·¯æ•°ï¼ˆå¤§åŠå¤œç¿»åˆ°è¿™ä¸ªç ´é˜²äº†ï¼Œ æ¥è‡ª18å¹´çš„flag ï¼Œ ç°åœ¨æ˜¯æ—¶é—´æ˜¯ 2023 - 08 - 18 ï¼Œ è¿‡äº†ã€‚</p>
<h3 id="1-RpmåŒ…çš„åˆ¶ä½œæµç¨‹ç®€è¿°"><a href="#1-RpmåŒ…çš„åˆ¶ä½œæµç¨‹ç®€è¿°" class="headerlink" title="1. RpmåŒ…çš„åˆ¶ä½œæµç¨‹ç®€è¿°"></a>1. RpmåŒ…çš„åˆ¶ä½œæµç¨‹ç®€è¿°</h3><ol>
<li>æ”¾ç½®æºç è¿›å…¥SOURCESæ–‡ä»¶å¤¹</li>
<li>å†™å¥½SPECæ–‡ä»¶</li>
<li>è¿è¡Œrpmbuildå‘½ä»¤,è‡ªåŠ¨æ‰§è¡Œå®‰è£…å’Œæ¸…ç†</li>
<li>è‡ªåŠ¨å°†æ‰€æœ‰çš„æºç è§£å‹åˆ°BUILDç›®å½•</li>
<li>è‡ªåŠ¨å®‰è£…æ‰€æœ‰çš„æºç ç¨‹åºåˆ°BUILDROOTç›®å½•</li>
<li>è‡ªåŠ¨æ ¹æ®SPECæ–‡ä»¶é‡Œé¢çš„fileç¨‹åºæ®µæ‰“åŒ…åˆ°rpmåŒ…ä¸­</li>
<li>è‡ªåŠ¨è¿›è¡Œåç»­çš„æ¸…ç†</li>
<li>ç”Ÿæˆå®Œæ•´çš„RPMåŒ…</li>
<li>æ‰‹åŠ¨è¿›è¡Œå®‰è£…æµ‹è¯•</li>
</ol>
<h3 id="2-å¦‚ä½•åšå‡†å¤‡"><a href="#2-å¦‚ä½•åšå‡†å¤‡" class="headerlink" title="2. å¦‚ä½•åšå‡†å¤‡"></a>2. å¦‚ä½•åšå‡†å¤‡</h3><p>éœ€è¦æ˜ç¡®çš„å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªä»€ä¹ˆæ ·çš„RPMåŒ…ï¼Œè¿™ä¸ªRPMåŒ…ä½¿ç”¨æ¥åšä»€ä¹ˆçš„ï¼ŒRPMsä¸ä¸€å®šåŒ…å«çš„æ˜¯äºŒè¿›åˆ¶çš„å†…å®¹ï¼Œä¸ä¸€å®šéœ€è¦ç¼–è¯‘ã€‚</li>
<li>è‡³å°‘æˆ‘ä»¬éœ€è¦æºç ï¼Œæ³¨æ„åŸææ–™çš„æ”¶é›†ã€‚</li>
<li>å®˜æ–¹å»ºè®®ä½¿ç”¨å¹²å‡€çš„æºç ï¼Œå¦‚æœæœ‰è¡¥ä¸éœ€è¦åœ¨åˆ¶ä½œçš„è¿‡ç¨‹ä¸­æ‰“ä¸Šè¡¥ä¸ã€‚</li>
<li>åŒä¸€ä¸ªè½¯ä»¶ï¼Œä¸åŒç‰ˆæœ¬çš„RPMï¼Œæ–°ç‰ˆæœ¬æ˜¯å¦å¯ä»¥æ”¯æŒå‡çº§æ—§ç‰ˆæœ¬ã€‚éœ€ä¸éœ€è¦æ¸…ç†æ—§ç‰ˆæœ¬çš„æ–‡ä»¶ã€‚å‡çº§æ˜¯å¦ä¼šé€ æˆå†²çªã€‚</li>
<li>ä¾èµ–å…³ç³»ã€‚</li>
<li>æ¯ä¸€ä¸ªPRMåŒ…éƒ½æä¾›ä¸€ç§åŠŸèƒ½ï¼ŒCapabilityï¼Œå¯ä»¥è¢«å…¶ä»–çš„PRMåŒ…ä¾èµ–ã€‚RPMåŒ…çš„åå­—å’Œæ‰€å®‰è£…çš„æ–‡ä»¶éƒ½å¯ä»¥ç»™å…¶ä»–çš„è½¯ä»¶æä¾›ä¾èµ–ã€‚</li>
<li>è‡ªèº«åå­—çš„æ„ä¹‰ï¼Œæä¾›çš„æ¯ä¸€æ–‡ä»¶ä¹Ÿå¯ä»¥è¢«ä¾èµ–ï¼Œ</li>
<li>ä»–çš„å®‰è£…å’Œè¿è¡Œéœ€è¦ä¾èµ–äºå…¶ä»–çš„RPMåŒ…æœ¬èº«æˆ–è€…æ‰€å…·æœ‰çš„æ–‡ä»¶ï¼Œå«åšä¾èµ–å…³ç³»ã€‚  </li>
<li>ä¸¤ç±»ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘ä¾èµ–å’Œå®‰è£…ä¾èµ–ã€‚</li>
<li>è§„åˆ’ä¾èµ–å…³ç³»ï¼Œå†™SPECæ–‡ä»¶ã€‚</li>
<li>åˆ¶ä½œRPMsã€‚</li>
<li>ç®€å•æµ‹è¯•RPMsã€‚</li>
</ol>
<h3 id="3-RPMsçš„è§„åˆ’"><a href="#3-RPMsçš„è§„åˆ’" class="headerlink" title="3. RPMsçš„è§„åˆ’"></a>3. RPMsçš„è§„åˆ’</h3><ol>
<li>æ˜¯å¦æ˜¯åº”ç”¨ç¨‹åºï¼Œæ˜¯å¦éœ€è¦è¡¥ä¸ï¼Œæ˜¯å¦éœ€è¦æ–°çš„åŠŸèƒ½ã€‚</li>
<li>æ˜¯ä¸€ä¸ªç¨‹åºçš„åº“æ–‡ä»¶</li>
<li>æ˜¯ä¸€ä¸ªç³»ç»Ÿé…ç½®æ–‡ä»¶é›†</li>
<li>æ˜¯ä¸€ä¸ªæ–‡æ¡£æ–‡ä»¶åŒ…</li>
<li>æ˜¯å¦æ‹†åˆ†å®Œæ•´çš„è½¯ä»¶ï¼Œä¾‹å¦‚ï¼šMySQL-5.5.22.tar.gzï¼Œåœ¨åˆ¶ä½œRPMåŒ…çš„æ—¶å€™è¢«æ‹†åˆ†ä¸ºMySQLï¼Œmysql-serverï¼Œmysql-develï¼Œç­‰ç­‰ã€‚</li>
<li>æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶è¿˜æ˜¯æºç ï¼Œå½“æ—¶éƒ½æœ‰ã€‚ä¾‹å¦‚:src.rpm,é‡Œé¢åŒ…æ‹¬äº† source.tar.gz å’Œ spec,éœ€è¦ä½¿ç”¨è€…å®‰è£…å®Œæˆä¹‹åç¼–è¯‘å†å®‰è£…ã€‚</li>
</ol>
<h3 id="4-åˆ¶ä½œè¿‡ç¨‹"><a href="#4-åˆ¶ä½œè¿‡ç¨‹" class="headerlink" title="4. åˆ¶ä½œè¿‡ç¨‹"></a>4. åˆ¶ä½œè¿‡ç¨‹</h3><h4 id="1-è®¾è®¡ç›®å½•ç»“æ„-set-Up-the-Directory-structure"><a href="#1-è®¾è®¡ç›®å½•ç»“æ„-set-Up-the-Directory-structure" class="headerlink" title="1. è®¾è®¡ç›®å½•ç»“æ„(set Up the Directory structure)"></a>1. è®¾è®¡ç›®å½•ç»“æ„(set Up the Directory structure)</h4><p><strong>åˆ¶ä½œRPMè¿‡ç¨‹ä¸­åƒä¸‡ä¸èƒ½ç”¨rootç”¨æˆ·</strong><br>æ¯ä¸ªç‰ˆæœ¬å¯¹äºç›®å½•çš„è¦æ±‚ä¸åŒï¼Œäº”ä¸ªä¸åŒçš„ç›®å½•ï¼š  </p>
<ol>
<li><strong>BUILD</strong>ï¼šä¸éœ€è¦æ”¾ä»»ä½•çš„å†…å®¹ï¼Œè¿™ä¸ªç›®å½•æ˜¯çœŸæ­£å·¥ä½œçš„ç›®å½•ã€‚ç”¨äºè§£å‹ç¼–è¯‘æºç ã€‚  </li>
<li><strong>RPMS</strong>ï¼šåˆ¶ä½œå®Œæˆçš„RPMåŒ…æ”¾åœ¨è¿™ä¸ªé‡Œé¢ï¼Œé‡Œé¢çš„ç›®å½•çš„åå­—å’Œç»“æ„ä¸ç‰¹å®šå¹³å°æ¶æ„æœ‰å…³ï¼Œå¯ä»¥äº¤å‰å¹³å°ç¼–è¯‘ã€‚  </li>
<li><strong>SOURCES</strong>:æ‰€æœ‰æ”¶é›†çš„æºç éƒ½åœ¨è¿™ä¸ªç›®å½•é‡Œé¢ã€‚  </li>
<li><strong>SPECS</strong>:æ”¾ç½®SPECæ–‡ä»¶ï¼Œä½œä¸ºåˆ¶ä½œè¿‡ç¨‹çš„æŒ‡å¯¼è¯´æ˜ã€‚ä»¥è½¯ä»¶åŒ…çš„åå­—å‘½åï¼Œä»¥.specç»“å°¾ã€‚  </li>
<li><strong>SRPMS</strong>:æ”¾ç½®äº†SRC(source)æ ¼å¼çš„RPMåŒ…ã€‚<br>çº¢å¸½æä¾›äº†é»˜è®¤çš„åˆ¶ä½œç›®å½•ï¼Œåœ¨&#x2F;usr&#x2F;src&#x2F;redhat.</li>
</ol>
<pre><code><pre class="language-none"><code class="language-none">[LiarLee@localhost ~] tree &#x2F;usr&#x2F;src&#x2F;redhat</code></pre>
</code></pre>
<h4 id="2-æ”¾ç½®æ–‡ä»¶åˆ°æ­£ç¡®çš„æŒ‡å®šçš„ç›®å½•-Place-The-Sources-in-the-Right-dirctory-ã€‚"><a href="#2-æ”¾ç½®æ–‡ä»¶åˆ°æ­£ç¡®çš„æŒ‡å®šçš„ç›®å½•-Place-The-Sources-in-the-Right-dirctory-ã€‚" class="headerlink" title="2. æ”¾ç½®æ–‡ä»¶åˆ°æ­£ç¡®çš„æŒ‡å®šçš„ç›®å½•(Place The Sources in the Right dirctory)ã€‚"></a>2. æ”¾ç½®æ–‡ä»¶åˆ°æ­£ç¡®çš„æŒ‡å®šçš„ç›®å½•(Place The Sources in the Right dirctory)ã€‚</h4><p>  æˆ‘ä»¬é¦–å…ˆéœ€è¦è‡ªå·±åˆ¶å®šè‡ªå·±çš„åˆ¶ä½œæºç ç›®å½•ï¼Œåœ¨ä¸ä½¿ç”¨rootç”¨æˆ·çš„å‰æä¸‹è¿›è¡Œåˆ¶ä½œ,éœ€è¦ä¿®æ”¹ç³»ç»Ÿçš„å®ï¼Œæ¥åˆ¶å®šæ–°çš„å·¥ä½œç›®å½•ã€‚ä¿®æ”¹å·¥ä½œç›®å½•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹é»˜è®¤çš„å®ï¼š <pre class="language-none"><code class="language-none">[LiarLee@localhost ~] rpmbuild --showrc   \\ æ˜¾ç¤ºæ‰€æœ‰çš„ç›¸å…³å®å®šä¹‰
_buildâ€”â€”è¡¨ç¤ºç›®å½•; __rmâ€”â€”è¡¨ç¤ºå‘½ä»¤</code></pre></li>
<li>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼š <pre class="language-none"><code class="language-none">[LiarLee@localhost ~] rpmbuild --showrc | grep macrofiles    \\ æ˜¾ç¤ºé…ç½®æ–‡ä»¶çš„å…¨å±€è·¯å¾„å’Œæ–‡ä»¶å  
\\ æƒé™ç”±å°åˆ°å¤§ï¼Œåä¸€ä¸ªæ–‡ä»¶çš„å‚æ•°è¦†ç›–å‰é¢æ‰€æœ‰çš„å®šä¹‰  
\\ æ‰€ä»¥æˆ‘ä»¬åœ¨å®¶ç›®å½•ä¸‹åˆ›å»ºéšè—æ–‡ä»¶.rpmmacroså¯ä»¥ç›´æ¥é…ç½®è‡ªå®šä¹‰çš„è®¾ç½®ã€‚</code></pre></li>
<li>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹é»˜è®¤çš„å·¥ä½œç›®å½•å®šä¹‰ï¼š <pre class="language-none"><code class="language-none">[LiarLee@localhost ~] rpmbuild --showrc | grep _topdir   \\ æ˜¾ç¤ºé»˜è®¤çš„å·¥ä½œç›®å½•å®å®šä¹‰  
\\ ä»¥ç›¸åŒçš„æ¨¡å¼åœ¨.rpmmacrosä¸­ç›´æ¥è¦†ç›–é…ç½®ï¼Œå¯ä»¥æ›´æ”¹å·¥ä½œç›®å½•  </code></pre></li>
<li>æ›´æ”¹topdirçš„å®ï¼Œä½¿ç”¨rpmbuilderçš„ç”¨æˆ·ï¼Œåˆ›å»º.rpmmacros,æ·»åŠ å†…å®¹é…ç½®å®:   <pre class="language-none"><code class="language-none">[LiarLee@localhost ~] vim .rpmmacros         \\ Create .rpmmacros file  
    %_topdir    &#x2F;home&#x2F;rpmbuilder&#x2F;rpmbild&#x2F;  
[LiarLee@localhost ~] mkdir -pv rpmbuild&#x2F;&#123;BUILD,RPMS,SOURCES,SPEC,SRPMS&#125;  
[LiarLee@localhost ~] rpmbuild --showrc | grep _topdir      \\ Review the Result  </code></pre></li>
</ol>
<h4 id="3-åˆ›å»ºä¸€ä¸ªspecæ–‡ä»¶-Create-A-Spec-File-that-Tells-the-Rpmbuild-Command-what-to-do-ã€‚"><a href="#3-åˆ›å»ºä¸€ä¸ªspecæ–‡ä»¶-Create-A-Spec-File-that-Tells-the-Rpmbuild-Command-what-to-do-ã€‚" class="headerlink" title="3. åˆ›å»ºä¸€ä¸ªspecæ–‡ä»¶(Create A Spec File that Tells the Rpmbuild Command what to do)ã€‚"></a>3. åˆ›å»ºä¸€ä¸ªspecæ–‡ä»¶(Create A Spec File that Tells the Rpmbuild Command what to do)ã€‚</h4><ol>
<li>specæ–‡ä»¶ä½¿ç”¨è½¯ä»¶çš„åå­—ç‰ˆæœ¬ä½œä¸ºæ–‡ä»¶åï¼›.specä½œä¸ºæ‰©å±•åã€‚  </li>
<li>rpm -qi mysql &amp; rpm -qpi mysql,å‘½ä»¤æŸ¥çœ‹rpmä¿¡æ¯ï¼Œä¿¡æ¯ä»specæ–‡ä»¶ä¸­å®šä¹‰ï¼Œè½¯ä»¶åŒ…ä¿¡æ¯è¯´æ˜æ®µè½å®šä¹‰ã€‚</li>
<li>specæ–‡ä»¶æœ‰å¦‚ä¸‹å‡ ä¸ªæ®µè½ï¼š<ol>
<li>The introduction section<br>è®¾ç½®è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯<pre class="language-none"><code class="language-none">Summary:  \\ ç®€å•æè¿°
Name:     \\ è½¯ä»¶åå­—
Version:  \\ ç‰ˆæœ¬å·
Release:  \\ å‘è¡Œå·
License:  \\ åè®®
Group:    \\ GROUPèŒƒå›´åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æè¿° &#x2F;usr&#x2F;share&#x2F;doc&#x2F;rpm-*&#x2F;GROUPS
URL:      \\ ä»ä½•å¤„è·å–çš„ç«™ç‚¹é“¾æ¥ï¼Œä¸‹è½½è·¯å¾„
Packager:  \\ åˆ¶ä½œè€…&lt;åˆ¶ä½œè€…é‚®ç®±&gt;
Vendorï¼š   \\ åˆ¶ä½œè€…çš„å…¬å¸æˆ–è€…æœ¬äººåå­—      
Source:      \\ æºæ–‡ä»¶åœ°å€ï¼Œä¸€ä¸ªé“¾æ¥åœ°å€
BuildRoot:   \\ åˆ¶ä½œRPMåŒ…çš„æ—¶å€™çš„è™šæ‹ŸRootç›®å½•
BuildRequires:   \\ åˆ¶ä½œè¿‡ç¨‹ä¾èµ–äºå“ªäº›è½¯ä»¶åŒ…çš„åå­—</code></pre>
<ol start="2">
<li>The prep section<br>è§£å‹æºç åŒ…åˆ°BUILDç›®å½•çš„æ®µï¼Œcdåˆ°éœ€è¦çš„ç›®å½•ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ã€‚<pre class="language-none"><code class="language-none">%prep
%setup</code></pre></li>
<li>The build section<br>è¿™æ˜¯æºç åŒ…å®‰è£…çš„makeè¿‡ç¨‹.<pre class="language-none"><code class="language-none">%build
.&#x2F;configure  OR   %configure
.&#x2F;make       OR   %&#123;__make&#125;
make % &#123;?_smp_mflags&#125;    \\ å¤šå¯¹ç§°å¤„ç†å™¨åŠ é€Ÿç¼–è¯‘</code></pre></li>
<li>The install section<br>è¿™é‡Œæ˜¯å®‰è£…make installè¿‡ç¨‹ã€‚ç³»ç»Ÿä¸­æœ‰installå‘½ä»¤,installæ–¹å¼ç±»ä¼¼äºCOPYæ¨¡å¼.<pre class="language-none"><code class="language-none">%install
%&#123;__rm&#125;
%&#123;__make&#125; install DESTDIR&#x3D;&quot;%&#123;buildroot&#125;&quot;
%find_lang %&#123;name&#125;</code></pre></li>
</ol>
</li>
</ol>
</li>
</ol>
<pre><code>5. The script section
     è¿™é‡Œæ˜¯å®šä¹‰æ‰§è¡Œéœ€è¦çš„è„šæœ¬ï¼Œç”¨æ¥é…ç½®ç¯å¢ƒã€‚ä¾‹å¦‚:æ·»åŠ Apacheç”¨æˆ·.    
        %pre        Note:å®‰è£…å‰æ‰§è¡Œ
        %post       Note:å®‰è£…åæ‰§è¡Œ
        %preun      Note:å¸è½½å‰æ‰§è¡Œ
        %postun     Note:å¸è½½åæ‰§è¡Œ
 
6. The clean section
    æ¸…ç†ä¹‹å‰æ‰€ç”¨åˆ°çš„BuildRootç›®å½•çš„ã€‚
    <pre class="language-none"><code class="language-none">%clean
%&#123;__rm&#125;</code></pre>
7. The files section
    å¯¹å®‰è£…çš„è½¯ä»¶çš„ç¨‹åºè¿›è¡Œè§„åˆ’,å“ªäº›æ–‡ä»¶å®‰è£…åˆ°é‚£ä¸ªæ–‡ä»¶å¤¹,**BUILDROOTä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¿…é¡»åœ¨è¿™ä¸ªæ®µä¸­å­˜åœ¨**
    <pre class="language-none"><code class="language-none">%files
%config(noreplace)  \\ ä¸æ›¿æ¢æ—§çš„é…ç½®</code></pre>
 
 8. The changelog section  
     è®°å½•ç‰ˆæœ¬è¿­ä»£  
 
    <pre class="language-none"><code class="language-none">* Wed Apr 11 2012 Liarlee.site &lt;Liarlee@site.com&gt; - ReleaseNumber æ›´æ”¹æ—¶é—´

- Comments
- Comments</code></pre>
 
</code></pre>
<h4 id="4-å¼€å§‹ç¼–è¯‘-Build-The-Source-and-Binary-RPMs"><a href="#4-å¼€å§‹ç¼–è¯‘-Build-The-Source-and-Binary-RPMs" class="headerlink" title="4. å¼€å§‹ç¼–è¯‘(Build The Source and Binary RPMs)"></a>4. å¼€å§‹ç¼–è¯‘(Build The Source and Binary RPMs)</h4><ol>
<li>rpmbuildå‘½ä»¤è¯´æ˜:    <pre class="language-none"><code class="language-none">rpmbuild -bp        \\ æ‰§è¡Œåˆ°prep section
rpmbuild -bc        \\ æ‰§è¡Œåˆ°build section
rpmbuild -bi        \\ æ‰§è¡Œåˆ°install section

rpmbuild -bs        \\ åˆ¶ä½œæºç æ ¼å¼çš„åˆ¶ä½œ
rpmbuild -bb        \\ åˆ¶ä½œäºŒè¿›åˆ¶æ ¼å¼çš„rpmåŒ…
rpmbuild -ba        \\ æ‰§è¡Œå…¨éƒ¨æ ¼å¼,BOTHäºŒè¿›åˆ¶å’Œæºç 

rpmbuild -bl        \\ BUILDROOTå­˜åœ¨ä½†æ˜¯æ²¡æœ‰åœ¨FILESæ®µä¸­ä¸ºåŒ…å«è¿›å»çš„æ–‡ä»¶çš„CHECKå‘½ä»¤</code></pre></li>
<li>å…³äºå®‰è£…é”™è¯¯çš„è¯´æ˜:<br>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœæœ‰æŠ¥é”™æˆ‘ä»¬åªéœ€è¦å»æŒ‰ç…§æç¤ºä¿®æ­£é”™è¯¯å³å¯,åœ¨æ‰§è¡Œç»“æŸä¹‹åä¼šåœ¨RPMSç›®å½•ä¸‹ç”Ÿæˆéœ€è¦çš„<em>RPMåŒ…</em>å’Œ<em>RPM-DEBUGåŒ…</em>.æˆ‘ä»¬åªéœ€è¦RPMåŒ…å³å¯,ä½¿ç”¨rpm -ivhè¿›è¡Œå®‰è£…æµ‹è¯•.<pre class="language-none"><code class="language-none">[LiarLee@localhost ~] rpmbuild -ba SoftwareName.spec   \\å¼€å§‹åˆ¶ä½œçš„å‘½ä»¤</code></pre></li>
</ol>
<h4 id="rpm2cpioå‘½ä»¤çš„è¯´æ˜"><a href="#rpm2cpioå‘½ä»¤çš„è¯´æ˜" class="headerlink" title="rpm2cpioå‘½ä»¤çš„è¯´æ˜"></a>rpm2cpioå‘½ä»¤çš„è¯´æ˜</h4><p>  src-rpmåŒ…åªæ˜¯å°†æºç æ‰“åŒ…æˆRPMæ ¼å¼,å½“æˆ‘ä»¬å®‰è£…src.rpmæ ¼å¼çš„å®‰è£…åŒ…çš„æ—¶å€™ä¼šæŠŠåŒ…å«çš„æ–‡ä»¶,è§£å‹åˆ°ç”¨æˆ·é»˜è®¤çš„å·¥ä½œç›®å½•ä¸‹,æ‰€ä»¥è¿™ç§æ ¼å¼çš„RPMåŒ…æˆ‘ä»¬ä¸ç”¨å®‰è£…,ç›´æ¥åˆ¶ä½œRPMåŒ…å³å¯.è¿›è¡Œrebuild OR recompile.<br>  <pre class="language-none"><code class="language-none">[LiarLee@localhost ~] rpm2cpio mysql.src.rpm &gt; mysql.cpio  
[LiarLee@localhost ~] rpm2cpio mysql.src.rpm | cpio -t  </code></pre><br>  <strong>ä¸¤ä¸ªç½‘ç«™çš„æ¨è(æœç´¢SRC-RPMåŒ…çš„ç«™ç‚¹):</strong><br>    rpmfind.net<br>    rpm.pbone.net  </p>
<h2 id="äºŒ-ä»å¤´å¼€å§‹å†™æ–°çš„SPEC-Files"><a href="#äºŒ-ä»å¤´å¼€å§‹å†™æ–°çš„SPEC-Files" class="headerlink" title="äºŒ. ä»å¤´å¼€å§‹å†™æ–°çš„SPEC Files"></a>äºŒ. ä»å¤´å¼€å§‹å†™æ–°çš„SPEC Files</h2><p>åˆ¶ä½œRPMåŒ…çš„æ ¸å¿ƒæ˜¯å†™SPEC filesï¼Œéš¾ä»¥æŒæ¡çš„åœ°æ–¹<br>ä»‹ç»SPECæ–‡ä»¶çš„åŸºæœ¬è¯­æ³•å’Œç®€å•ç”¨æ³•</p>
<h3 id="1-Spec-Files-Overview"><a href="#1-Spec-Files-Overview" class="headerlink" title="1. Spec Files Overview"></a>1. Spec Files Overview</h3><p>SPEC fileé‡Œé¢éƒ½æ˜¯æŒ‡ä»¤ï¼Œå‘Šè¯‰RPMBuildå‘½ä»¤å¦‚ä½•ä¸€æ­¥ä¸€æ­¥è§£å‹ï¼Œç¼–è¯‘ï¼Œåšæˆä¸åŒçš„RPMåŒ…ï¼Œä¾èµ–å…³ç³»ã€‚  Macroæ˜¯æŒ‡çš„å˜é‡<br>å¤§å¤šæ•°çš„å­—æ®µç”±tag+valueç»„æˆ,tagæ˜¯æ ‡ç­¾â€“Directives,ä¸åŒºåˆ†å¤§å°å†™;valueæ˜¯åŒºåˆ†å¤§å°å†™çš„.    </p>
<h4 id="1-1-å®çš„è‡ªå®šä¹‰"><a href="#1-1-å®çš„è‡ªå®šä¹‰" class="headerlink" title="1.1 å®çš„è‡ªå®šä¹‰"></a>1.1 å®çš„è‡ªå®šä¹‰</h4><p><strong>ç”¨æˆ·è‡ªå®šä¹‰å®</strong> : %define macro_name value<br><strong>å¼•ç”¨æ–¹å¼</strong> : %{macro_name} OR %macro_name  </p>
<h4 id="1-2-æ³¨é‡Šçš„æ–¹å¼"><a href="#1-2-æ³¨é‡Šçš„æ–¹å¼" class="headerlink" title="1.2 æ³¨é‡Šçš„æ–¹å¼"></a>1.2 æ³¨é‡Šçš„æ–¹å¼</h4><p>ä½¿ç”¨#æ¥è¿›è¡Œæ³¨é‡Š<br>%â€“ä¸èƒ½åœ¨æ³¨é‡Šä¸­ä½¿ç”¨,å¦‚æœå¿…é¡»ä½¿ç”¨éœ€è¦åŒå†™%%  </p>
<pre class="language-none"><code class="language-none">%prep  
\#this is a comment for %%prep  </code></pre>

<h3 id="2-Defining-Package-Infomation"><a href="#2-Defining-Package-Infomation" class="headerlink" title="2. Defining Package Infomation"></a>2. Defining Package Infomation</h3><p>å¦‚ä½•å®šä¹‰SPECæ–‡ä»¶å†…çš„å­—æ®µ  </p>
<h4 id="2-1-è½¯ä»¶åŒ…çš„ä¿¡æ¯"><a href="#2-1-è½¯ä»¶åŒ…çš„ä¿¡æ¯" class="headerlink" title="2.1 è½¯ä»¶åŒ…çš„ä¿¡æ¯"></a>2.1 è½¯ä»¶åŒ…çš„ä¿¡æ¯</h4><ul>
<li>Name - è½¯ä»¶åŒ…åç§° - ä¸èƒ½æœ‰çŸ­æ¨ªçº¿  </li>
<li>Version - ç‰ˆæœ¬å· - ä¸èƒ½æœ‰çŸ­æ¨ªçº¿  </li>
<li>Release - å‘è¡Œç‰ˆæœ¬å·  </li>
<li>Group - &#x2F;usr&#x2F;src&#x2F;doc&#x2F;rpm-version&#x2F;GROUPSæ–‡ä»¶ä¸­æœ‰è¯¦ç»†çš„æè¿°è¯´æ˜æœ‰å“ªäº›ç»„å¯ä»¥ä½¿ç”¨</li>
</ul>
<h4 id="2-2-åˆ¶ä½œæ–¹ä¿¡æ¯"><a href="#2-2-åˆ¶ä½œæ–¹ä¿¡æ¯" class="headerlink" title="2.2 åˆ¶ä½œæ–¹ä¿¡æ¯"></a>2.2 åˆ¶ä½œæ–¹ä¿¡æ¯</h4><ul>
<li>Vendor - å…¬å¸æˆ–è€…ç»„ç»‡åˆ¶ä½œçš„RPM  </li>
<li>URL - ä¸€ä¸ªä¸»é¡µé“¾æ¥  </li>
<li>Packager - åå­—&lt;é‚®ç®±åœ°å€&gt;  </li>
<li>License - è®¸å¯,GPLv2,â€¦.etc.</li>
</ul>
<h4 id="2-3-æè¿°ä¿¡æ¯"><a href="#2-3-æè¿°ä¿¡æ¯" class="headerlink" title="2.3 æè¿°ä¿¡æ¯"></a>2.3 æè¿°ä¿¡æ¯</h4><ul>
<li>Summary - ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦,çŸ­æè¿°  </li>
<li>%description section - å…¨é¢æè¿°,å¦‚æœå­—ç¬¦è¿‡å¤šå¯ä»¥æå‰æ¢è¡Œ.</li>
</ul>
<h4 id="2-4-å®šä¹‰ä¾èµ–å…³ç³»"><a href="#2-4-å®šä¹‰ä¾èµ–å…³ç³»" class="headerlink" title="2.4 å®šä¹‰ä¾èµ–å…³ç³»"></a>2.4 å®šä¹‰ä¾èµ–å…³ç³»</h4><ul>
<li>Requires : Capability - å®šä¹‰è½¯ä»¶åŒ…çš„èƒ½åŠ›,å¦‚æœæœªå®šä¹‰æ˜¾ç¤ºåŒ…å.  </li>
<li>Provides : Capability - å®šä¹‰å¯¹å¤–æä¾›çš„èƒ½åŠ›  </li>
<li>BuildRequires : Capability - å¯ä»¥å‡ºç°å¤šæ¬¡,ç›´æ¥å†™å‡ºéœ€è¦çš„è½¯ä»¶åŒ…å</li>
</ul>
<h4 id="2-5-è®¾å®šBuildç›®å½•"><a href="#2-5-è®¾å®šBuildç›®å½•" class="headerlink" title="2.5 è®¾å®šBuildç›®å½•"></a>2.5 è®¾å®šBuildç›®å½•</h4><ul>
<li>build - ç”¨äºè§£å‹å®‰è£…æºç   </li>
<li>buildroot : ${_tmppath}&#x2F;%{name}-%{version}-root<br>ä½¿ç”¨$RPM_BUILD_ROOT æˆ–è€… %{buildroot}</li>
</ul>
<h4 id="2-6-å‘½åSourceæ–‡ä»¶"><a href="#2-6-å‘½åSourceæ–‡ä»¶" class="headerlink" title="2.6 å‘½åSourceæ–‡ä»¶"></a>2.6 å‘½åSourceæ–‡ä»¶</h4><p>ä½¿ç”¨Sourceså­—æ®µ å’Œ patchå­—æ®µ,æŒ‡å®šæºæ–‡ä»¶å’Œè¡¥ä¸  </p>
<ul>
<li>Source0: https:&#x2F;&#x2F; OR ç›¸å¯¹è·¯å¾„, httpsä¸ä¼šä¸‹è½½, è‡ªåŠ¨æœ¬åœ°å¯»å€  </li>
<li>Source1: sourcefiles_name  </li>
<li>Source2: sourcefiles_name  </li>
<li>Patch1: patchfiles_name  </li>
<li>Patch2: patchfiles_name  </li>
<li>Patch3: patchfiles_name<br>è¡¥ä¸å®šä¹‰åå¯ä»¥ç›´æ¥ä½¿ç”¨patchå‘½ä»¤è¿›è¡Œè¡¥ä¸çš„å®‰è£…,æ‰€ä»¥ä½¿ç”¨patchå­—æ®µ</li>
</ul>
<h3 id="3-Controlling-the-Build"><a href="#3-Controlling-the-Build" class="headerlink" title="3. Controlling the Build"></a>3. Controlling the Build</h3><p>å¦‚ä½•æ§åˆ¶ç¼–è¯‘</p>
<pre class="language-none"><code class="language-none">%prep                 \\ æŠŠSourceå†…çš„è§£å‹æºç åŒ…åˆ°BUILDç›®å½•,cdåˆ°æºç ç›®å½•,é…ç½®ç¯å¢ƒ  

%setup -q             \\ æ§åˆ¶è§£å‹çš„æµç¨‹  
%setup -n name        \\ ç›®å½•åå­—  
%setup -q             \\ é™é»˜æ¨¡å¼  
%setup -a number      \\ AFTER,cdåˆ°ç›®å½•ä¹‹åè§£å‹ç¼©     
%setup -b number      \\ BEFORE,å…ˆè§£å‹ä¹‹åcdåˆ°ç›®å½•é‡Œ  
%setup -c             \\ è§£å‹å‰åˆ›å»ºç›®å½•  
%setup -T             \\ ä¸å±•å¼€ ç›´æ¥å¤åˆ¶  

%patch1               \\ æ‰“è¡¥ä¸    
%patch2               \\ æ‰“ç¬¬äºŒä¸ªè¡¥ä¸        

%build                \\ Cç±»ç¨‹åºçš„configure &amp; makeè¿‡ç¨‹   
.&#x2F;configure --prefix&#x3D;&#x2F;usr \  
  --sysconfdir&#x3D;&#x2F;etc&#x2F;nginx  
make %&#123;?_smp_mflags&#125;    

%build                \\Perlçš„ä¸åŒ
perl Mailfile PL  
make  

%install                            \\ make install è¿‡ç¨‹  
rm -rf %&#123;buildroot&#125;                 \\ Clean Stuff  
make install DESTDIR&#x3D;%&#123;buildroot&#125;             \\ make install å‘½ä»¤ç¼–è¯‘å®‰è£…  
%&#123;__install&#125; -p -D -m 0644 %&#123;SOURCE5&#125; \     
  %&#123;buildroot&#125;%&#123;_sysconfdir&#125;&#x2F;sysconfig&#x2F;%&#123;name&#125;            \\ installå‘½ä»¤ç›´æ¥å®‰è£…æ–‡ä»¶åˆ°ç›®å½•  
%&#123;__install&#125; -p -d -m 0755 %&#123;buildroot&#125;&#x2F;var&#x2F;log&#x2F;nginx     \\ installå‘½ä»¤ç›´æ¥å®‰è£…æ–‡ä»¶åˆ°æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„  

%clean              \\ æ¸…ç†BUILDç›®å½•,æ¸…ç©ºä¸ºä¸‹æ¬¡åšå‡†å¤‡; rpmbuild --clean mysql.spec  
rm -rf %&#123;buildroot&#125;     \\æ¸…ç†BUILDç›®å½•  

%prep  
%post  
%prepun  
%postun  
ä½¿ç”¨IFå¯ä»¥å¯¹å¦‚ä¸‹å‚æ•°è¿›è¡Œåˆ¤æ–­  
$1            \\ ç¬¬ä¸€æ¬¡å®‰è£…  
$2 OR $2+     \\ å‡çº§  
$0            \\ å¸è½½  </code></pre>
<h3 id="4-Filling-the-List-of-Files"><a href="#4-Filling-the-List-of-Files" class="headerlink" title="4. Filling the List of Files"></a>4. Filling the List of Files</h3><p>å¡«å……æ–‡ä»¶åˆ—è¡¨</p>
<h3 id="5-Adding-Change-Log-Entries"><a href="#5-Adding-Change-Log-Entries" class="headerlink" title="5. Adding Change Log Entries"></a>5. Adding Change Log Entries</h3><p>æ·»åŠ æ›´æ–°æ—¥å¿—</p>
<h2 id="ä¸‰-CentOS7æ‰“åŒ…Nginxè¿‡ç¨‹è®°å½•"><a href="#ä¸‰-CentOS7æ‰“åŒ…Nginxè¿‡ç¨‹è®°å½•" class="headerlink" title="ä¸‰. CentOS7æ‰“åŒ…Nginxè¿‡ç¨‹è®°å½•"></a>ä¸‰. CentOS7æ‰“åŒ…Nginxè¿‡ç¨‹è®°å½•</h2><ol>
<li>useradd rpmbuilder -p rpmbuilder</li>
<li>yum install -y rpmdevtools rpmbuild</li>
<li>cd &#x2F;home&#x2F;rpmbuilder&#x2F;</li>
<li>rpmdev-setuptree</li>
<li>cd .&#x2F;rpmbuilder</li>
<li>tree .&#x2F;</li>
<li>mv nginx-1.16.1.tar.gz .&#x2F;rpmbuild&#x2F;SOURCES&#x2F;</li>
<li>vim .&#x2F;rpmbuilder&#x2F;SPECS&#x2F;nginx.spec</li>
<li>vim nginx.service</li>
<li>mv nginx.service &#x2F;rpmbuild&#x2F;SOURCES&#x2F;nginx.service  <pre class="language-none"><code class="language-none">%define nginx_user nginx
%define nginx_group nginx

Name:		nginx	
Version:	1.16.1
Release:	1%&#123;?dist&#125;
Summary:	make rpm for nginx, version 1.16.1

Group:		System Environment&#x2F;Daemons
License:	GPLv2	
URL:		http:&#x2F;&#x2F;liarlee.site
Source0:	%&#123;name&#125;-%&#123;version&#125;.tar.gz
Source1:	nginx.service	
BuildRoot: 	$_topdir&#x2F;BUILDROOT

BuildRequires:	gcc
BuildRequires:	gcc-c++
BuildRequires:	openssl
BuildRequires:  openssl-devel
BuildRequires:	pcre
BuildRequires:	pcre-devel
BuildRequires:	systemd
Requires:	openssl
Requires:	openssl-devel
Requires:	pcre
Requires:	pcre-devel
Requires:	systemd

%description
For online Ean portal, make by Hayden Lee, and take some personal option.

%prep
%setup -q


%build
.&#x2F;configure \
  --prefix&#x3D;&#x2F;data&#x2F;web-server&#x2F;nginx \
  --user&#x3D;%&#123;nginx_user&#125; \
  --group&#x3D;%&#123;nginx_group&#125; \
  --with-threads \
  --with-http_ssl_module \
  --with-http_stub_status_module \
  --with-http_realip_module \
  --with-http_gzip_static_module
make %&#123;?_smp_mflags&#125;


%install
%&#123;__rm&#125; -rf %&#123;buildroot&#125;
make install DESTDIR&#x3D;%&#123;buildroot&#125;
# install systemd-specific files
%&#123;__mkdir&#125; -p $RPM_BUILD_ROOT%&#123;_unitdir&#125;
%&#123;__install&#125; -m644 %SOURCE1 \
    $RPM_BUILD_ROOT%&#123;_unitdir&#125;&#x2F;nginx.service

%files
%defattr(-,root,root)
&#x2F;data&#x2F;web-server&#x2F;nginx&#x2F;
%config(noreplace) &#x2F;data&#x2F;web-server&#x2F;nginx&#x2F;conf&#x2F;nginx.conf
%config(noreplace) &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service
%attr(0644,root,root) &#x2F;data&#x2F;web-server&#x2F;nginx&#x2F;conf&#x2F;nginx.conf
%pre
    getent group %&#123;nginx_group&#125; &gt;&#x2F;dev&#x2F;null || groupadd -r %&#123;nginx_group&#125;
    getent passwd %&#123;nginx_user&#125; &gt;&#x2F;dev&#x2F;null || \
        useradd -r -g %&#123;nginx_group&#125; -s &#x2F;sbin&#x2F;nologin \
        -d %&#123;nginx_home&#125; -c &quot;nginx user&quot;  %&#123;nginx_user&#125;
    exit 0
%post
    &#x2F;usr&#x2F;bin&#x2F;systemctl preset nginx.service &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 ||:
    &#x2F;usr&#x2F;bin&#x2F;systemctl preset nginx-debug.service &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 ||:
    # print site info
    cat &lt;&lt;BANNER
    ----------------------------------------------------------------------

    Thanks for using nginx!

    Please find the official documentation for nginx here:
    * http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;
    
    Commercial subscriptions for nginx are available on:
    * http:&#x2F;&#x2F;nginx.com&#x2F;products&#x2F;
    
    ----------------------------------------------------------------------
    BANNER
%preun
    &#x2F;usr&#x2F;bin&#x2F;systemctl --no-reload disable nginx.service &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 ||:
    &#x2F;usr&#x2F;bin&#x2F;systemctl stop nginx.service &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 ||:

%postun
    &#x2F;usr&#x2F;bin&#x2F;systemctl daemon-reload &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 ||:
    %&#123;__rm&#125; -rf &#x2F;data&#x2F;web-server&#x2F;nginx
</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, RPM</tag>
      </tags>
  </entry>
  <entry>
    <title>Cactiçš„å®‰è£…æ•™ç¨‹</title>
    <url>/2018/04/01/Linux/Linux_Cacti-installation/</url>
    <content><![CDATA[<p>å½“æ—¶è®°å½•Cactiçš„å®‰è£…è®°å½•ã€‚</p>
<h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><p>OS : CentOS 7 Server Everything â€“ Minimal Version<br>Required Packages : LAMP, RRDTool</p>
<h2 id="éƒ¨ç½²åŸºç¡€ç»„ä»¶"><a href="#éƒ¨ç½²åŸºç¡€ç»„ä»¶" class="headerlink" title="éƒ¨ç½²åŸºç¡€ç»„ä»¶"></a>éƒ¨ç½²åŸºç¡€ç»„ä»¶</h2><ol>
<li><p>å®‰è£…Apache<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">yum install -y httpd httpd-devel  
dnf install -y httpd httpd-devel  </code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
</li>
<li><p>å®‰è£…MySQL<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">yum install -y mysql mysql-server   
dnf install -y mysql mysql-server  </code></pre>
<p>OR</p>
</li>
</ol>
<pre class="language-none"><code class="language-none">yum install -y Mariadb-server  
dnf install -y Mariadb-server</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
<ol start="3">
<li><p>å®‰è£…PHP<br>å‘½ä»¤å¦‚ä¸‹ï¼š  </p>
<pre class="language-none"><code class="language-none">yum install -y php-mysql php-pear php-common php-gd php-devel php php-mbstring php-cli  
dnf install -y php-mysql php-pear php-common php-gd php-devel php php-mbstring php-cli  </code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
</li>
<li><p>å®‰è£…PHP-SNMP<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">yum install -y php-snmp  
dnf install -y php-snmp  </code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
</li>
<li><p>å®‰è£…NET-SNMP<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">yum install -y net-snmp-utils net-snmp-libs net-snmp   
dnf install -y net-snmp-utils net-snmp-libs net-snmp  </code></pre>
<p>å¦‚æœéœ€è¦å®‰è£…Spineï¼Œéœ€è¦å®‰è£…net-snmp-devel  </p>
<pre class="language-none"><code class="language-none">yum install -y net-snmp-devel
dnf install -y net-snmp-devel</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚</p>
</li>
<li><p>å®‰è£…RRDTool<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">yum install -y rrdtool  
dnf install -y rrdtool  </code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
</li>
<li><p>å¼€å§‹æ‰€æœ‰çš„æœåŠ¡ï¼š<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">service httpd start  
service mysqld start OR service mariadb start
service snmpd start</code></pre>
<p>OR</p>
<pre class="language-none"><code class="language-none">systemctl start httpd.service
systemctl start mariadb.service
systemctl start snmpd.service</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚  </p>
</li>
<li><p>è°ƒæ•´æœåŠ¡å¼€æœºå¯åŠ¨ï¼š</p>
<pre class="language-none"><code class="language-none">chkconfig httpd on  
chkconfig mysqld on
chkconfig snmpd on</code></pre>
<p>OR</p>
<pre class="language-none"><code class="language-none">systemctl enable httpd.service
systemctl enable mariadb.service
systemctl enable snmpd.service</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚</p>
</li>
<li><p>å¼€å¯EPEL REPO &amp; å®‰è£…Cacti</p>
<pre class="language-none"><code class="language-none">wget http:&#x2F;&#x2F;dl.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;epel-release-latest-7.noarch.rpm  
rpm -ivh epel-release-latest-7.noarch.rpm
yum makecache</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚<br><strong>æ‰€æœ‰çš„å®‰è£…å†…å®¹å·²ç»éƒ¨ç½²å®Œæ¯•ã€‚</strong></p>
</li>
</ol>
<h2 id="è¿›è¡Œé…ç½®"><a href="#è¿›è¡Œé…ç½®" class="headerlink" title="è¿›è¡Œé…ç½®"></a>è¿›è¡Œé…ç½®</h2><ol>
<li><p>é…ç½®MySQLçš„rootå¯†ç   </p>
<pre class="language-none"><code class="language-none">mysqladmin -u root password YOURSELF_PASSWORD</code></pre>
</li>
<li><p>åˆ›å»ºCactiçš„æ•°æ®åº“  </p>
<pre class="language-none"><code class="language-none">mysql -u root -p
mysql&gt; create database cacti;
mysql&gt; GRANT ALL ON cacti.* TO cacti@localhost IDENTITFIED BY &#39;YOURSELF_PASSWORD&#39;;
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; quit;</code></pre>
<p>å®‰è£…å®Œæ¯•ã€‚</p>
</li>
<li><p>MySQL-æ•°æ®åº“åˆå§‹åŒ–  </p>
<pre class="language-none"><code class="language-none">rpm -ql cacti | grep cacti.sql
mysql -u cacti -p cacti &lt; &#x2F;usr&#x2F;share&#x2F;doc&#x2F;cacti&#x2F;cacti.sql</code></pre>
<p>å‘½ä»¤å‘èµ·åéœ€è¦è¿›è¡Œå¯†ç çš„è¾“å…¥</p>
</li>
<li><p>Cacti-è¯»å–æ•°æ®åº“é…ç½®</p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;cacti&#x2F;db.php</code></pre>
<p>éœ€è¦ç¼–è¾‘çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">$database_type &#x3D; &quot;mysql&quot;;
$database_default &#x3D; &quot;cacti&quot;;
$database_hostname &#x3D; &quot;localhost&quot;;
$database_username &#x3D; &quot;cacti&quot;;
$database_password &#x3D; &quot;YOURSELF_PASSWORD&quot;;
$database_port &#x3D; &quot;3306&quot;;
$database_ssl &#x3D; false;</code></pre>
</li>
<li><p>Firewall-é…ç½®æ”¾è¡Œé˜²ç«å¢™</p>
<pre class="language-none"><code class="language-none">iptables -A INPUT -p udp -m state --state NEW --dport 80 -j ACCEPT
iptables -A INPUT -p tcp -m state --state NEW --dport 80 -j ACCEPT
iptables save</code></pre>
<p>OR  </p>
<pre class="language-none"><code class="language-none">firewall-cmd --permanent --zone&#x3D;public --add-service&#x3D;http
firewall-cmd --reload</code></pre>
</li>
<li><p>Apache- é…ç½®Cactiæ ¹ç›®å½•</p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;cacti.conf</code></pre>
<p>é…ç½®æ–‡ä»¶å†…çš„å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š  </p>
<pre class="language-none"><code class="language-none">&lt;Directory &#x2F;usr&#x2F;share&#x2F;cacti&#x2F;&gt;
Order Deny,Allow
Deny from all
Allow from all
&lt;&#x2F;Directory&gt;</code></pre>
<p>é‡å¯æœåŠ¡ï¼š</p>
<pre class="language-none"><code class="language-none">service httpd restart</code></pre>
<p>OR</p>
<pre class="language-none"><code class="language-none">systemctl restart httpd.service</code></pre>
</li>
<li><p>Crond-é…ç½®Pollerçš„è®¡åˆ’ä»»åŠ¡  </p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;cron.d&#x2F;cacti
*&#x2F;5 * * * *    cacti   &#x2F;usr&#x2F;bin&#x2F;php &#x2F;usr&#x2F;share&#x2F;cacti&#x2F;poller.php &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1      \\ å»æ‰æ³¨é‡Š</code></pre>
</li>
<li><p>å¯åŠ¨Broswerï¼Œè¿›å…¥Cactiå®‰è£…ç•Œé¢ï¼Œ<a href="http://ipaddress/Cacti">http://IPADDRESS/Cacti</a>, ä¹‹åæŒ‰ç…§è¯´æ˜ç»§ç»­å³å¯ã€‚</p>
</li>
</ol>
<p>Default Username : <strong>admin</strong><br>Default Password : <strong>admin</strong></p>
<h2 id="è¡¥å……å®‰è£…SPINEè¿‡ç¨‹"><a href="#è¡¥å……å®‰è£…SPINEè¿‡ç¨‹" class="headerlink" title="è¡¥å……å®‰è£…SPINEè¿‡ç¨‹"></a>è¡¥å……å®‰è£…SPINEè¿‡ç¨‹</h2><ol>
<li>ä¸‹è½½æºæ–‡ä»¶ï¼Œå®‰è£…ç¨‹åºã€‚   </li>
<li>å®‰è£…CentOS,Development Toolï¼Œyum group installã€‚   </li>
<li>åœ¨Spineçš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ.&#x2F;configure &amp;&amp; make &amp;&amp; make installã€‚<br><strong>NOTEï¼š</strong> è¿™é‡Œå‡ºç°äº†çš„é—®é¢˜ï¼Œæç¤ºæ‰¾ä¸åˆ°net-snmp header fileâ€”&gt;æ²¡æœ‰å®‰è£…net-snmp-devel</li>
<li>è¿›å…¥æ§åˆ¶å°è¿›è¡ŒSpineæ˜¯å¦å®‰è£…æˆåŠŸã€‚</li>
</ol>
<h2 id="å¾…ç»­"><a href="#å¾…ç»­" class="headerlink" title="å¾…ç»­"></a>å¾…ç»­</h2>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Application, Cacti</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”± CPU Steal Time æŒ‡æ ‡è§£é‡Š</title>
    <url>/2022/04/19/Linux/Linux_CalcStealtime/</url>
    <content><![CDATA[<p>è§‚å¯Ÿvmstatå‘½ä»¤è¾“å‡ºçš„å†…å®¹ï¼Œ æˆ–è€… top å‘½ä»¤ æœ€ä¸Šé¢è¾“å‡ºçš„å†…å®¹ã€‚å¯ä»¥çœ‹åˆ°Stealtimeå¢åŠ ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯å› ä¸ºè™šæ‹Ÿæœºçš„è¶…å–ï¼Œ æ€»ç»“æ¥è¯´stæŒ‡ç¤ºäº†vCPUçš„ç¹å¿™ç¨‹åº¦ã€‚</p>
<h2 id="è¿›ç¨‹ç›¸å…³å‚æ•°çš„è¯´æ˜"><a href="#è¿›ç¨‹ç›¸å…³å‚æ•°çš„è¯´æ˜" class="headerlink" title="è¿›ç¨‹ç›¸å…³å‚æ•°çš„è¯´æ˜"></a>è¿›ç¨‹ç›¸å…³å‚æ•°çš„è¯´æ˜</h2><p><a href="https://www.kernel.org/doc/html/latest/scheduler/sched-stats.html">https://www.kernel.org/doc/html/latest/scheduler/sched-stats.html</a></p>
<blockquote>
<p>schedstats also adds a new &#x2F;proc&#x2F;<pid>&#x2F;schedstat file to include some of the same information on a per-process level. There are three fields in this file correlating for that process to:<br>1 time spent on the cpu<br>2 time spent waiting on a runqueue<br>3 # of timeslices run on this cpu  </p>
</blockquote>
<h2 id="æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºç»“æœ"><a href="#æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºç»“æœ" class="headerlink" title="æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºç»“æœ"></a>æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºç»“æœ</h2><pre class="language-bash" data-language="bash"><code class="language-bash">hayden@VM-16-6-ubuntu /p/372047<span class="token operator"><span class="token file-descriptor important">5</span>></span> <span class="token function">cat</span> schedstat
<span class="token number">2236062</span> <span class="token number">223986</span> <span class="token number">22</span></code></pre>

<p>å‘½ä»¤ä¸­çš„ä¸‰ä¸ªæ•°å€¼è¯´æ˜:  </p>
<ul>
<li>2236062 è¿›ç¨‹åœ¨CPUçš„æ—¶é—´</li>
<li>223986 è¿›ç¨‹åœ¨CPUè°ƒåº¦ä¸Šé¢ç­‰å¾…çš„æ—¶é—´</li>
<li>22 åœ¨è¿™ä¸ªCPUè¿è¡Œçš„æ—¶é—´ç‰‡æ•°é‡<br>NOTE: æœ‰ä¸€ä¸ªåšå®¢å†™è¿™ä¸ªæ˜¯ ä¸Šä¸‹æ–‡äº¤æ¢çš„æ¬¡æ•° ï¼Œ å’Œsched æ–‡ä»¶ä¸­çš„ nr_switches æ•°é‡ç›¸åŒï¼Œ ä¸èƒ½ç¡®å®šæ˜¯å¦æ­£ç¡®ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, CPU, EC2</tag>
      </tags>
  </entry>
  <entry>
    <title>lesså‘½ä»¤å ç”¨å†…å­˜è¿‡é«˜</title>
    <url>/2020/04/06/Linux/Linux_Cat-and-less/</url>
    <content><![CDATA[<p>åœ¨åä¸ºçš„æœˆåº¦æŠ¥å‘Šä¸­ï¼Œ å‘ç°äº†å¥‡æ€ªçš„é—®é¢˜ï¼Œæœ‰ä¸€å°æœºå™¨åœ¨æ¯å¤©éƒ½ä¼šå†…å­˜ä½¿ç”¨ç‡é£™åˆ°100%ï¼Œå¶å°”çš„å‡ æ¬¡è¿˜ä¼šå‡ºç°OOMçš„è®°å½•ã€‚åœ¨è¿½è¸ªé—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœºå™¨ä¸Šæ¯å¤©çš„2ï¼Œ4ï¼Œ6ï¼Œ8ç‚¹ä¼šè‡ªåŠ¨è¿è¡Œå¤„ç†æ—¥å¿—çš„è„šæœ¬ï¼Œå¹¶ç»Ÿè®¡å…³é”®å­—çš„æ•°é‡ã€‚</p>
<p>è¿™ä¸ªè„šæœ¬çš„è¿‡æ»¤æ—¥å¿—æ€è·¯æ˜¯ï¼Œ ä½¿ç”¨ less å‘½ä»¤æ‰“å¼€æ˜¨å¤©çš„æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”è¯»å–å†…å®¹ï¼Œè¿‡æ»¤å…¶ä¸­çš„å…³é”®å­—ï¼Œå‘½ä»¤ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">less</span> yesterday*.log.gz <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> <span class="token string">"xxxxx"</span> <span class="token parameter variable">-e</span> <span class="token string">"xxxxx"</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></code></pre>
<h2 id="å…³äºLess-More-Cat-Zcat"><a href="#å…³äºLess-More-Cat-Zcat" class="headerlink" title="å…³äºLess, More, Cat, Zcat"></a>å…³äºLess, More, Cat, Zcat</h2><p>è¿™ä¸ªå››ä¸ªå‘½ä»¤å¯ä»¥åˆ†æˆä¸¤ç»„:</p>
<ul>
<li>less &#x2F; more çš„å‘½ä»¤æ˜¯ä¸ºäº†ä¸ªäººç±»æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹è®¾è®¡çš„ç¨‹åºï¼›</li>
<li>cat &#x2F; zcat æ˜¯ä¸€æ¬¡æ€§è¾“å‡ºå†…å®¹åˆ°å±å¹•çš„ï¼›</li>
</ul>
<p>ä¸¤ç»„å‘½ä»¤çš„å”¯ä¸€åŒºåˆ«æ˜¯æ˜¯å¦æä¾›å‰ååå¤æŸ¥çœ‹çš„åŠŸèƒ½ã€‚ä½†æ˜¯å°±æ˜¯è¿™ä¸ªåŠŸèƒ½ï¼Œå¯¼è‡´äº†å‘½ä»¤æ‰§è¡Œçš„é€»è¾‘å…¶å®æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>
<p>lesså‘½ä»¤çš„æ‰§è¡Œæ–¹å¼å°†æŸ¥çœ‹åˆ°çš„æ•°æ®æ”¾å…¥å†…å­˜ä¸­ï¼ˆUSEDï¼‰ï¼Œæ‰€ä»¥ å¦‚æœæ˜¯ä¸€ä¸ª10Gçš„æ—¥å¿—ï¼Œå°±ä¼šå ç”¨10Gçš„å†…å­˜ï¼Œ å¦‚æœä¸å¤Ÿï¼Œç³»ç»Ÿå°±ä¼šè¿›è¡Œäº¤æ¢å’Œå°†æ—§æ•°æ®æ¢å‡ºçš„æ“ä½œã€‚<br>catçš„æ‰§è¡Œæ¨¡å¼æ˜¯å°†æ•°æ®ç›´æ¥è¾“å‡ºåˆ°&#x2F;dev&#x2F;stdoutï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿä¼šå°†æ•°æ®å­˜å‚¨åˆ°Cacheä¸­ï¼Œä¸ä¼šè§¦å‘å†…å­˜çš„å‘Šè­¦ï¼Œ ç”±äºæ—¥å¿—ä¸­çš„æ•°æ®å…¶å®åªæ˜¯è¿›è¡Œä¸€æ¬¡è¿‡æ»¤ï¼Œ æ‰€ä»¥ä¸éœ€è¦é•¿æœŸçš„ä¿ç•™ï¼Œ è¿™ä¹Ÿæé«˜äº†bashå¤„ç†æ—¥å¿—æ–‡æœ¬çš„é€Ÿåº¦ã€‚ </p>
<p>è¡¥å……ä¸€ä¸‹ï¼Œ Vimä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ Vimä¼šå°½å¯èƒ½çš„å°†æ–‡ä»¶è½½å…¥åˆ°å†…å­˜é‡Œï¼Œ æ‰€ä»¥<strong>æ—¥å¿—ç±»çš„æ–‡ä»¶</strong>æ˜¯ä¸éœ€è¦ï¼Œ ä¹Ÿ<strong>ä¸èƒ½ä½¿ç”¨Vimçš„</strong>.</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ç”±äºä¸¤ä¸ªå‘½ä»¤çš„å¤„ç†æ–¹å¼ä¸åŒ,å› æ­¤ç›´æ¥å°†å‘½ä»¤ä¸­è¾“å‡ºgzæ—¥å¿—çš„å‘½ä»¤æ¢æˆäº†zcatï¼Œå³å¯ä¿è¯å†…å­˜çš„ä½¿ç”¨ä¸ä¼šå˜å¤š, è¿™é‡ŒåŒæ—¶æé«˜çš„å¤„ç†æ–‡æœ¬å‘½ä»¤çš„æ•ˆç‡ï¼Œè¿™ä¸ªæœºå™¨ä¸“é—¨ç”¨æ¥åšè¿™ä¸€ä»¶äº‹æƒ…ï¼Œ æ‰€ä»¥ä¸éœ€è¦è€ƒè™‘å…¶ä»–è¿›ç¨‹ä¼šå½±å“æ—¥å¿—å¤„ç†ï¼Œ é€ æˆæ•°æ®çš„ä¸ä¸€è‡´ã€‚<br>æ‰€ä»¥åœ¨è„šæœ¬ä¸­ä¸€å®šä¸€å®šä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤å’Œæ–¹å¼å¤„ç†æ•°æ®ï¼Œæ‰èƒ½ä¿éšœæ€§èƒ½å’Œæ•ˆç‡çš„å…¼é¡¾ã€‚</p>
<p>æœ€åï¼Œä¼˜åŒ–è¿‡çš„å‘½ä»¤ä¸ºï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">zcat yesterday*.log.gz <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-e</span> <span class="token string">"xxxx"</span> <span class="token parameter variable">-e</span> <span class="token string">"xxxx"</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-u</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></code></pre>
<p>æœ€åçš„æ‰§è¡Œæ—¶é—´ï¼Œä»åŸæ¥çš„åŠä¸ªå°æ—¶èµ·æ­¥ï¼Œå˜æˆäº†10åˆ†é’Ÿå³å®Œæˆã€‚</p>
<h2 id="åç»­çš„å¤„ç†"><a href="#åç»­çš„å¤„ç†" class="headerlink" title="åç»­çš„å¤„ç†"></a>åç»­çš„å¤„ç†</h2><p>å·²çŸ¥æˆ‘ä»¬çš„é—®é¢˜æ˜¯ä¸éœ€è¦ç³»ç»Ÿè‡ªåŠ¨cacheä½æˆ‘ä»¬è¿‡æ»¤çš„æ—¥å¿—æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨é‡Šæ”¾ä¸€ä¸‹å·²ç»æ— ç”¨çš„cacheå†…å®¹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sync</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token number">3</span> <span class="token operator">></span> /proc/sys/vm/drop_caches</code></pre>
<p>åé¢è¿˜æ·»åŠ äº†å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†å‘½ä»¤ï¼Œ ä½†æ˜¯è¿™ä¸ªå¹¶è¡Œæ‰§è¡Œçš„è„šæœ¬ç¡®å®å†™çš„éå¸¸çš„åƒåœ¾ã€‚ å¦å¤–æ·»åŠ äº†ä½¿ç”¨python è‡ªåŠ¨å¡«å†™è¿‡æ»¤çš„ç»“æœåˆ° Excel è¡¨æ ¼ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Bash</tag>
      </tags>
  </entry>
  <entry>
    <title>è™šæ‹Ÿæœºåˆ¶ä½œæ¨¡æ¿çš„æ­¥éª¤åŠè®¾ç½®</title>
    <url>/2019/09/18/Linux/Linux_CentOS7-VM-Template/</url>
    <content><![CDATA[<p>æ¢äº†å·¥ä½œä¹‹åæ¥ç®¡äº†è¿™è¾¹æ—§çš„ESXiå’Œä¸Šé¢çš„è™šæ‹Ÿæœºï¼Œä¹‹å‰çš„æ¨¡æ¿ä¸æ˜¯ç‰¹åˆ«çš„åˆé€‚ï¼Œè‡ªå·±å¼€å§‹åŠ¨æ‰‹åšæ¨¡æ¿ã€‚æœ€ç»ˆæœŸæœ›çš„ç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li>ä¿®æ”¹IPåœ°å€</li>
<li>yum install æ”¶å·¥</li>
</ol>
<h2 id="CentOSè™šæ‹Ÿæœºæ¨¡æ¿åˆ¶ä½œæµç¨‹"><a href="#CentOSè™šæ‹Ÿæœºæ¨¡æ¿åˆ¶ä½œæµç¨‹" class="headerlink" title="CentOSè™šæ‹Ÿæœºæ¨¡æ¿åˆ¶ä½œæµç¨‹"></a>CentOSè™šæ‹Ÿæœºæ¨¡æ¿åˆ¶ä½œæµç¨‹</h2><h3 id="ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®"><a href="#ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®" class="headerlink" title="ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®"></a>ç³»ç»Ÿçš„ç¡¬ä»¶é…ç½®</h3><p>ç³»ç»Ÿçš„ç¡¬ä»¶è§„æ ¼</p>
<ul>
<li>4cpu </li>
<li>8G-RAM</li>
</ul>
<h3 id="OSçš„ç‰ˆæœ¬"><a href="#OSçš„ç‰ˆæœ¬" class="headerlink" title="OSçš„ç‰ˆæœ¬"></a>OSçš„ç‰ˆæœ¬</h3><p>ç³»ç»Ÿçš„ç‰ˆæœ¬</p>
<ul>
<li>CentOS 7.6 1810 x64</li>
</ul>
<h3 id="å®‰è£…VMwareTools"><a href="#å®‰è£…VMwareTools" class="headerlink" title="å®‰è£…VMwareTools"></a>å®‰è£…VMwareTools</h3><pre class="language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> epel <span class="token function">vim</span> <span class="token function">wget</span> <span class="token function">curl</span> net-tools open-vm-tools <span class="token function">htop</span> iotop iftop tree atop sysstat</code></pre>
<h3 id="å®‰è£…Zabbix-agent"><a href="#å®‰è£…Zabbix-agent" class="headerlink" title="å®‰è£…Zabbix-agent"></a>å®‰è£…Zabbix-agent</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> zabbix-agent-<span class="token variable">$version</span>.rpm </code></pre>
<h3 id="å…³é—­SELinux"><a href="#å…³é—­SELinux" class="headerlink" title="å…³é—­SELinux"></a>å…³é—­SELinux</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s@SELINUX=enforcing@SELINUX=disabled@g'</span> /etc/selinux/config</code></pre>
<h3 id="æ›´æ”¹hostname"><a href="#æ›´æ”¹hostname" class="headerlink" title="æ›´æ”¹hostname"></a>æ›´æ”¹hostname</h3><p>hostnameæœ‰ä¸€äº›æœ‰è¶£çš„é—®é¢˜ï¼ŒCentOS6.8 ä¸­çš„hostnameå¯ä»¥å®šä¹‰åœ¨<code>/etc/sysconfig/network</code>æ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™å…ˆè¯»å–<code>/etc/sysconfig/network</code>æ–‡ä»¶ä¸­çš„å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¯»å–<code>/etc/hosts</code>æ–‡ä»¶ä¸­çš„å®šä¹‰.å’Œæˆ‘è‡ªå·±çš„ä¹‹å‰çš„è®°å¿†ä¸ä¸€æ ·ã€‚<br>æˆ‘ä¹‹å‰ä¸€ç›´éƒ½æ˜¯ä¹‹é—´ç¼–è¾‘<code>/etc/hostname</code>ï¼Œç›´æ¥å°†ä¸»æœºåechoåˆ°è¿™ä¸ªæ–‡ä»¶ä¸­å°±å¯ä»¥äº†ï¼Œä¸è¿‡æƒ³æ¥è¿™äº›åŒºåˆ«éƒ½ä¸å¤§ï¼Œå…ˆè¿™æ ·å§ã€‚</p>
<h3 id="æ¸…é™¤ç¡¬ä»¶åŠç½‘å¡çš„ä¿¡æ¯"><a href="#æ¸…é™¤ç¡¬ä»¶åŠç½‘å¡çš„ä¿¡æ¯" class="headerlink" title="æ¸…é™¤ç¡¬ä»¶åŠç½‘å¡çš„ä¿¡æ¯"></a>æ¸…é™¤ç¡¬ä»¶åŠç½‘å¡çš„ä¿¡æ¯</h3><p>å°†ç½‘å¡é…ç½®æ–‡ä»¶ä¸­çš„UUIDå’Œ HWADDRç›´æ¥åˆ é™¤æˆ–è€…æ˜¯æ³¨é‡Šæ‰ï¼ŒIPADDRç•™ç©ºã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/etc/sysconfig/network-scripts/ifcfg-eth0</code></pre>
<h3 id="åˆ é™¤udev"><a href="#åˆ é™¤udev" class="headerlink" title="åˆ é™¤udev"></a>åˆ é™¤udev</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/udev/rules.d/70-*
``<span class="token variable"><span class="token variable">`</span>  
NOTEï¼šå‘½ä»¤çš„æ•ˆæœè²Œä¼¼å’Œ sys-unconfig çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚
<span class="token comment">### å…³é—­é˜²ç«å¢™</span>
<span class="token variable">`</span></span>``bash
systemctl disable firewalld
iptables <span class="token parameter variable">-F</span>
iptables <span class="token parameter variable">-X</span>
iptables <span class="token parameter variable">-Z</span></code></pre>
<h3 id="æ›´æ”¹Grubçš„ç­‰å¾…æ—¶é—´"><a href="#æ›´æ”¹Grubçš„ç­‰å¾…æ—¶é—´" class="headerlink" title="æ›´æ”¹Grubçš„ç­‰å¾…æ—¶é—´"></a>æ›´æ”¹Grubçš„ç­‰å¾…æ—¶é—´</h3><p>è™šæ‹Ÿæœºä¸­çš„æ¨¡æ¿å¤§éƒ¨åˆ†æ˜¯ä¸éœ€è¦ç­‰å¾…grubç»™å‡ºçš„æ“ä½œé€‰å•æ—¶é—´çš„ï¼Œç­‰å¾…æ“ä½œçš„æ—¶é—´æ˜¯5ç§’ï¼Œæˆ‘ä»¬ç»™å‡º1ç§’å°±å¤Ÿäº†ã€‚</p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;default&#x2F;grub
GRUB_TIMEOUT&#x3D;1</code></pre>
<h3 id="æ¸…ç†å·¥ä½œ"><a href="#æ¸…ç†å·¥ä½œ" class="headerlink" title="æ¸…ç†å·¥ä½œ"></a>æ¸…ç†å·¥ä½œ</h3><pre class="language-none"><code class="language-none">rm -rf &#x2F;etc&#x2F;ssh&#x2F;*key*.
rm -rf &#x2F;root&#x2F;.ssh&#x2F;
systemctl stop rsyslog
systemctl stop auditd
&#x2F;usr&#x2F;bin&#x2F;yum clean all
logrotate -f &#x2F;etc&#x2F;logrotate.conf 
rm -f &#x2F;var&#x2F;log&#x2F;dmesg.old 
rm -rf &#x2F;var&#x2F;log&#x2F;anaconda*
cat &#x2F;dev&#x2F;null &gt; &#x2F;var&#x2F;log&#x2F;audit&#x2F;audit.log 
cat &#x2F;dev&#x2F;null &gt; &#x2F;var&#x2F;log&#x2F;wtmp 
cat &#x2F;dev&#x2F;null &gt; &#x2F;var&#x2F;log&#x2F;lastlog 
cat &#x2F;dev&#x2F;null &gt; &#x2F;var&#x2F;log&#x2F;grubby </code></pre>
<h3 id="æ¸…é™¤ç³»ç»Ÿçš„å”¯ä¸€ID"><a href="#æ¸…é™¤ç³»ç»Ÿçš„å”¯ä¸€ID" class="headerlink" title="æ¸…é™¤ç³»ç»Ÿçš„å”¯ä¸€ID"></a>æ¸…é™¤ç³»ç»Ÿçš„å”¯ä¸€ID</h3><pre class="language-none"><code class="language-none">&gt; &#x2F;etc&#x2F;machine-id</code></pre>
<h3 id="æ¸…é™¤ç³»ç»Ÿå‘½ä»¤å†å²è®°å½•"><a href="#æ¸…é™¤ç³»ç»Ÿå‘½ä»¤å†å²è®°å½•" class="headerlink" title="æ¸…é™¤ç³»ç»Ÿå‘½ä»¤å†å²è®°å½•"></a>æ¸…é™¤ç³»ç»Ÿå‘½ä»¤å†å²è®°å½•</h3><pre class="language-none"><code class="language-none">unset HISTFILE
history -c &amp;&amp; rm -rf &#x2F;root&#x2F;.bash_histroy</code></pre>
<h3 id="Sys-unconfigå…³æœº"><a href="#Sys-unconfigå…³æœº" class="headerlink" title="Sys-unconfigå…³æœº"></a>Sys-unconfigå…³æœº</h3><p>æ‰§è¡Œ<code>sys-unconfig</code>ç­‰å¾…å…³æœºï¼Œç„¶åè½¬æ¢ä¸ºæ¨¡æ¿ã€‚</p>
]]></content>
      <categories>
        <category>ESXi</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Ceph Cluster 01 - Installation</title>
    <url>/2021/08/21/Linux/Linux_Ceph01/</url>
    <content><![CDATA[<p>Ceph çš„å­¦ä¹ ç¬”è®°å’Œè®°å½•ã€‚</p>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><h2 id="éƒ¨ç½²ä¿¡æ¯"><a href="#éƒ¨ç½²ä¿¡æ¯" class="headerlink" title="éƒ¨ç½²ä¿¡æ¯"></a>éƒ¨ç½²ä¿¡æ¯</h2><p>OS Version: Fedora 34 Server<br>CEPH Version: v15.2.0 (Octopus) +<br>DOCKER Version: 20.10.8</p>
<h2 id="é…ç½®å®ä¾‹çš„-Hostname-å’Œç½‘ç»œ"><a href="#é…ç½®å®ä¾‹çš„-Hostname-å’Œç½‘ç»œ" class="headerlink" title="é…ç½®å®ä¾‹çš„ Hostname å’Œç½‘ç»œ"></a>é…ç½®å®ä¾‹çš„ Hostname å’Œç½‘ç»œ</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/hosts
  <span class="token number">192.168</span>.122.121 ceph01 ceph01.liarlee.site
  <span class="token number">192.168</span>.122.122 ceph02 ceph02.liarlee.site
  <span class="token number">192.168</span>.122.123 ceph03 ceph03.liarlee.site
  <span class="token number">192.168</span>.122.124 ceph04 ceph04.liarlee.site

<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> <span class="token number">192.168</span>.122.121 <span class="token builtin class-name">echo</span> <span class="token string">"ceph01.liarlee.site"</span> <span class="token operator">></span> /etc/hostname
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> <span class="token number">192.168</span>.122.122 <span class="token builtin class-name">echo</span> <span class="token string">"ceph02.liarlee.site"</span> <span class="token operator">></span> /etc/hostname
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> <span class="token number">192.168</span>.122.123 <span class="token builtin class-name">echo</span> <span class="token string">"ceph03.liarlee.site"</span> <span class="token operator">></span> /etc/hostname
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> <span class="token number">192.168</span>.122.124 <span class="token builtin class-name">echo</span> <span class="token string">"ceph04.liarlee.site"</span> <span class="token operator">></span> /etc/hostname

<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.address <span class="token number">192.168</span>.122.121/24
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.address <span class="token number">192.168</span>.122.122/24
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.address <span class="token number">192.168</span>.122.123/24
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.address <span class="token number">192.168</span>.122.124/24

<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.gateway <span class="token number">192.168</span>.122.1
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.dns <span class="token number">192.168</span>.122.1
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn mod enp1s0 ipv4.method manual
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ nmcli conn up enp1s0

<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl stop firewalld <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl disable firewalld
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">vim</span> /etc/config/selinux <span class="token comment"># change it to disabled</span></code></pre>

<h3 id="CONFIG-Dnf-Repo"><a href="#CONFIG-Dnf-Repo" class="headerlink" title="CONFIG Dnf Repo"></a>CONFIG Dnf Repo</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># config docker</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/fedora/docker-ce.repo
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo
<span class="token comment"># Add GPG Key.</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">rpm</span> <span class="token parameter variable">--import</span> <span class="token string">'https://mirrors.tuna.tsinghua.edu.cn/ceph/keys/release.asc'</span>
<span class="token comment"># update cache and install cephadm.</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ dnf makecache <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> dnf <span class="token function">install</span> <span class="token function">curl</span> <span class="token function">wget</span> <span class="token function">htop</span> <span class="token parameter variable">-y</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ dnf <span class="token function">install</span> cephadm <span class="token parameter variable">-y</span></code></pre>

<h3 id="INSTALL-Docker"><a href="#INSTALL-Docker" class="headerlink" title="INSTALL Docker"></a>INSTALL Docker</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> dnf remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-selinux <span class="token punctuation">\</span>
                  docker-engine-selinux <span class="token punctuation">\</span>
                  docker-engine
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> dnf <span class="token function">install</span> docker-ce docker-ce-cli containerd.io <span class="token parameter variable">-y</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl start <span class="token function">docker</span> containerd
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> containerd

<span class="token comment"># Config proxy for docker daemon.</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> /etc/systemd/system/docker.service.d/
<span class="token punctuation">[</span>root@ceph01 docker.service.d<span class="token punctuation">]</span>$ <span class="token function">cat</span> http-proxy.conf
  <span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
  <span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">"HTTP_PROXY=http://192.168.31.199:7890/"</span>
  <span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token string">"HTTPS_PROXY=http://192.168.31.199:7890/"</span></code></pre>

<h2 id="INSTALL-CEPH"><a href="#INSTALL-CEPH" class="headerlink" title="INSTALL CEPH"></a>INSTALL CEPH</h2><p>Cephadm tools were default in Fedora Repo, No need to change the repo to tsinghua or aliyun. Just install. WOW ~ Fedora YYDS.</p>
<h3 id="å¯åŠ¨ä¸€ä¸ªcephé›†ç¾¤"><a href="#å¯åŠ¨ä¸€ä¸ªcephé›†ç¾¤" class="headerlink" title="å¯åŠ¨ä¸€ä¸ªcephé›†ç¾¤"></a>å¯åŠ¨ä¸€ä¸ªcephé›†ç¾¤</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ cephadm bootstrap --mon-ip <span class="token number">192.168</span>.122.121 --allow-fqdn-hostname</code></pre>
<p>Please notice the output, context include username and password and dashboard address.</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">Ceph Dashboard is now available at</span><span class="token punctuation">:</span>

       <span class="token key atrule">URL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//localhost.localdomain<span class="token punctuation">:</span>8443/
      <span class="token key atrule">User</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">Password</span><span class="token punctuation">:</span> 20jrekw4ko

Enabling client.admin keyring and conf on hosts with "admin" label
<span class="token key atrule">You can access the Ceph CLI with</span><span class="token punctuation">:</span>

  sudo /usr/sbin/cephadm shell <span class="token punctuation">-</span><span class="token punctuation">-</span>fsid e8997974<span class="token punctuation">-</span>029f<span class="token punctuation">-</span>11ec<span class="token punctuation">-</span>a59a<span class="token punctuation">-</span>525400c06f36 <span class="token punctuation">-</span>c /etc/ceph/ceph.conf <span class="token punctuation">-</span>k /etc/ceph/ceph.client.admin.keyring</code></pre>

<h3 id="ä½¿ç”¨-Ceph-Shell-å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤èŠ‚ç‚¹"><a href="#ä½¿ç”¨-Ceph-Shell-å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="ä½¿ç”¨ Ceph Shell å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤èŠ‚ç‚¹"></a>ä½¿ç”¨ Ceph Shell å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤èŠ‚ç‚¹</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># temprary use</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ cephadm shell -- ceph <span class="token parameter variable">-s</span>

<span class="token comment"># start a interactive shell</span>
<span class="token punctuation">[</span>root@ceph01 ~<span class="token punctuation">]</span>$ cephadm shell

<span class="token comment"># check the ceph status </span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph <span class="token parameter variable">-s</span>

<span class="token comment"># list ceph hosts</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ceph orch <span class="token function">host</span> <span class="token function">ls</span> <span class="token parameter variable">--format</span> yaml

<span class="token comment"># general a new ssh key for cephadm</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ cephadm get-pub-key <span class="token operator">></span> /etc/ceph/ceph.pub

<span class="token comment"># copy new key to hosts</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-f</span> <span class="token parameter variable">-i</span> /etc/ceph/ceph.pub root@192.168.122.122
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-f</span> <span class="token parameter variable">-i</span> /etc/ceph/ceph.pub root@192.168.122.123
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-f</span> <span class="token parameter variable">-i</span> /etc/ceph/ceph.pub root@192.168.122.124</code></pre>

<h2 id="ç»´æŠ¤é›†ç¾¤"><a href="#ç»´æŠ¤é›†ç¾¤" class="headerlink" title="ç»´æŠ¤é›†ç¾¤"></a>ç»´æŠ¤é›†ç¾¤</h2><h3 id="ADD-Hosts"><a href="#ADD-Hosts" class="headerlink" title="ADD Hosts"></a>ADD Hosts</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ceph orch <span class="token function">host</span> <span class="token function">add</span> ceph02.liarlee.site <span class="token number">192.168</span>.122.122
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ceph orch <span class="token function">host</span> <span class="token function">add</span> ceph03.liarlee.site <span class="token number">192.168</span>.122.123
<span class="token punctuation">[</span>ceph: root@ceph01 ceph<span class="token punctuation">]</span>$ ceph orch <span class="token function">host</span> <span class="token function">add</span> ceph04.liarlee.site <span class="token number">192.168</span>.122.124

<span class="token comment"># set mon sub-network </span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph config <span class="token builtin class-name">set</span> mon public_network <span class="token number">192.168</span>.122.0/24</code></pre>

<h3 id="ADD-Osd"><a href="#ADD-Osd" class="headerlink" title="ADD Osd"></a>ADD Osd</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># auto-detect available devices (need time to sync the status 1 by 1)</span>
<span class="token comment"># NOTE: Strangely enough, the command automatically recognizes all devices, including the ZRAM!  QAQ.....</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch apply osd --all-available-devices

<span class="token comment"># list devices</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch device <span class="token function">ls</span>
Hostname             Path        Type  Serial  Size   Health   Ident  Fault  Available
ceph01.liarlee.site  /dev/vdb    hdd           <span class="token number">21</span>.4G  Unknown  N/A    N/A    Yes
ceph01.liarlee.site  /dev/vdc    hdd           <span class="token number">21</span>.4G  Unknown  N/A    N/A    Yes
ceph01.liarlee.site  /dev/vdd    hdd           <span class="token number">21</span>.4G  Unknown  N/A    N/A    Yes
ceph01.liarlee.site  /dev/zram0  ssd           2071M  Unknown  N/A    N/A    No

<span class="token comment"># MANUAL ADD OSD</span>
<span class="token comment"># It is not necessary. </span>
<span class="token comment"># INIT DISK in MON node</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch daemon <span class="token function">add</span> osd ceph01.liarlee.site:/dev/vdb
Created osd<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token number">0</span> on <span class="token function">host</span> <span class="token string">'ceph01.liarlee.site'</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch daemon <span class="token function">add</span> osd ceph01.liarlee.site:/dev/vdc
Created osd<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token number">1</span> on <span class="token function">host</span> <span class="token string">'ceph01.liarlee.site'</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch daemon <span class="token function">add</span> osd ceph01.liarlee.site:/dev/vdd
Created osd<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token number">2</span> on <span class="token function">host</span> <span class="token string">'ceph01.liarlee.site'</span>

<span class="token comment"># MANUAL DELETE OSD</span>
<span class="token comment"># It is not necessary. </span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch osd <span class="token function">rm</span> <span class="token number">0</span>
Scheduled OSD<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> removal
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch osd <span class="token function">rm</span> <span class="token number">1</span>
Scheduled OSD<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> removal
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch osd <span class="token function">rm</span> <span class="token number">2</span>
Scheduled OSD<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> removal

<span class="token comment"># Enable the device scan enhencement, show the infomation about Health, Ident, Fault. </span>
ceph config <span class="token builtin class-name">set</span> mgr mgr/cephadm/device_enhanced_scan <span class="token boolean">true</span>

<span class="token comment"># OSD memory auto tune, for performance maybe.</span>
ceph config <span class="token builtin class-name">set</span> osd osd_memory_target_autotune <span class="token boolean">true</span>

<span class="token comment"># mark the auto manage to true.</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch apply osd --all-available-devices <span class="token parameter variable">--unmanaged</span><span class="token operator">=</span>true
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch device <span class="token function">ls</span> <span class="token parameter variable">--wide</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph osd status

<span class="token comment"># Check Deleting Status</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch osd <span class="token function">rm</span> status
OSD_ID  HOST                 STATE                    PG_COUNT  REPLACE  FORCE  DRAIN_STARTED_AT
<span class="token number">0</span>       ceph01.liarlee.site  done, waiting <span class="token keyword">for</span> purge  <span class="token number">0</span>         False    False  None
<span class="token number">1</span>       ceph01.liarlee.site  started                  <span class="token number">0</span>         False    False  None
<span class="token number">2</span>       ceph01.liarlee.site  started                  <span class="token number">0</span>         False    False  None

<span class="token comment"># remove the devices and reuse in cluster.</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch apply osd --all-available-devices <span class="token parameter variable">--unmanaged</span><span class="token operator">=</span>true
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch device zap ceph01.liarlee.site /dev/vdb <span class="token parameter variable">--force</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch device zap ceph01.liarlee.site /dev/vdc <span class="token parameter variable">--force</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch device zap ceph01.liarlee.site /dev/vdd <span class="token parameter variable">--force</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch apply osd --all-available-devices <span class="token parameter variable">--unmanaged</span><span class="token operator">=</span>false</code></pre>

<h3 id="MANAGE-æœåŠ¡"><a href="#MANAGE-æœåŠ¡" class="headerlink" title="MANAGE æœåŠ¡"></a>MANAGE æœåŠ¡</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># reduce mon instance to 3</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch <span class="token function">ls</span> mon
NAME                       PORTS        RUNNING  REFRESHED  AGE  PLACEMENT
mon                                         <span class="token number">4</span>/5  2m ago     10h  count:5

<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch apply mon <span class="token number">3</span>
Scheduled mon update<span class="token punctuation">..</span>.

<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch <span class="token function">ls</span> mon
mon                                         <span class="token number">4</span>/3  4m ago     39s  count:3

<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch redeploy mon
Scheduled to redeploy mon.ceph01.liarlee.site on <span class="token function">host</span> <span class="token string">'ceph01.liarlee.site'</span>
Scheduled to redeploy mon.ceph02 on <span class="token function">host</span> <span class="token string">'ceph02.liarlee.site'</span>
Scheduled to redeploy mon.ceph03 on <span class="token function">host</span> <span class="token string">'ceph03.liarlee.site'</span></code></pre>

<h2 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph orch <span class="token function">ls</span>
NAME                       PORTS        RUNNING  REFRESHED  AGE  PLACEMENT
alertmanager               ?:9093,9094      <span class="token number">1</span>/1  0s ago     10h  count:1
crash                                       <span class="token number">4</span>/4  9m ago     10h  *
grafana                    ?:3000           <span class="token number">1</span>/1  0s ago     10h  count:1
mgr                                         <span class="token number">2</span>/2  9m ago     10h  count:2
mon                                         <span class="token number">3</span>/3  9m ago     5m   count:3
node-exporter              ?:9100           <span class="token number">4</span>/4  9m ago     10h  *
osd.all-available-devices                 <span class="token number">12</span>/16  9m ago     20m  *
prometheus                 ?:9095           <span class="token number">1</span>/1  0s ago     10h  count:1

<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph pg <span class="token function">stat</span>
<span class="token number">1</span> pgs: <span class="token number">1</span> active+clean<span class="token punctuation">;</span> <span class="token number">0</span> B data, <span class="token number">82</span> MiB used, <span class="token number">240</span> GiB / <span class="token number">240</span> GiB avail

<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span>$ ceph osd status
ID  HOST                  USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE
 <span class="token number">0</span>  ceph01.liarlee.site  7364k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">1</span>  ceph01.liarlee.site  7364k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">2</span>  ceph01.liarlee.site  7300k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">3</span>  ceph02.liarlee.site  7364k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">4</span>  ceph03.liarlee.site  6980k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">5</span>  ceph04.liarlee.site  6532k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">6</span>  ceph02.liarlee.site  7236k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">7</span>  ceph03.liarlee.site  6596k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">8</span>  ceph04.liarlee.site  6404k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
 <span class="token number">9</span>  ceph02.liarlee.site  7108k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
<span class="token number">10</span>  ceph04.liarlee.site  6596k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up
<span class="token number">11</span>  ceph03.liarlee.site  7172k  <span class="token number">19</span>.9G      <span class="token number">0</span>        <span class="token number">0</span>       <span class="token number">0</span>        <span class="token number">0</span>   exists,up</code></pre>

<h2 id="æˆæœæˆªå›¾"><a href="#æˆæœæˆªå›¾" class="headerlink" title="æˆæœæˆªå›¾"></a>æˆæœæˆªå›¾</h2><p><img src="https://i.loli.net/2021/08/22/qViGPvDdZ8wco6U.png" alt="2021-08-22_12-05_2.png"><br><img src="https://i.loli.net/2021/08/22/d5RtTisZ9X86uKF.png" alt="2021-08-22_12-05_1.png"><br><img src="https://i.loli.net/2021/08/22/EhgBwruF394AWRd.png" alt="2021-08-22_12-03.png"><br><img src="https://i.loli.net/2021/08/22/OCrDxyGzqc1n43K.png" alt="2021-08-22_12-05.png"><br><img src="https://i.loli.net/2021/08/22/2DLJcrTbnNxVSaw.png" alt="2021-08-22_12-04.png"><br><img src="https://i.loli.net/2021/08/22/PU1EL8bZASpq3XH.png" alt="2021-08-22_12-02_1.png"><br><img src="https://i.loli.net/2021/08/22/Hmkdnbtx3Ijw1Ah.png" alt="2021-08-22_12-02.png"></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ceph, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Ceph Cluster 02 - OSD/RBD</title>
    <url>/2021/08/23/Linux/Linux_Ceph02/</url>
    <content><![CDATA[<p>Cephçš„ä½¿ç”¨ç¬”è®°ã€‚</p>
<p>åˆ›å»ºå­˜å‚¨æ± </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ªPGä¸º64 ï¼ŒPGPä¸º64çš„å­˜å‚¨æ± ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph osd pool create test-64 64 64</span>
pool <span class="token string">'test-64'</span> created

<span class="token comment"># åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨è¯†åˆ«çš„å¤§å°çš„å­˜å‚¨æ± ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph osd pool create test</span>
pool <span class="token string">'test'</span> created

<span class="token comment"># æŸ¥çœ‹å·²ç»å­˜åœ¨çš„å­˜å‚¨æ± ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph osd pool ls</span>
device_health_metrics
<span class="token builtin class-name">test</span>
test-64

<span class="token comment"># æŸ¥çœ‹å­˜å‚¨æ± çš„PG å’Œ PGP çš„ä¿¡æ¯å’Œå…³ç³»ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph pg ls-by-pool test</span>

<span class="token comment"># æŸ¥çœ‹OSDçš„çŠ¶æ€ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph osd tree</span>
ID  CLASS  WEIGHT   TYPE NAME        STATUS  REWEIGHT  PRI-AFF
<span class="token parameter variable">-1</span>         <span class="token number">0.58557</span>  root default
<span class="token parameter variable">-5</span>         <span class="token number">0.14639</span>      <span class="token function">host</span> ceph01
 <span class="token number">2</span>    hdd  <span class="token number">0.04880</span>          osd.2        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">7</span>    hdd  <span class="token number">0.04880</span>          osd.7        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
<span class="token number">11</span>    hdd  <span class="token number">0.04880</span>          osd.11       up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
<span class="token parameter variable">-7</span>         <span class="token number">0.14639</span>      <span class="token function">host</span> ceph02
 <span class="token number">3</span>    hdd  <span class="token number">0.04880</span>          osd.3        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">6</span>    hdd  <span class="token number">0.04880</span>          osd.6        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
<span class="token number">10</span>    hdd  <span class="token number">0.04880</span>          osd.10       up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
<span class="token parameter variable">-9</span>         <span class="token number">0.14639</span>      <span class="token function">host</span> ceph03
 <span class="token number">1</span>    hdd  <span class="token number">0.04880</span>          osd.1        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">5</span>    hdd  <span class="token number">0.04880</span>          osd.5        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">9</span>    hdd  <span class="token number">0.04880</span>          osd.9        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
<span class="token parameter variable">-3</span>         <span class="token number">0.14639</span>      <span class="token function">host</span> ceph04
 <span class="token number">0</span>    hdd  <span class="token number">0.04880</span>          osd.0        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">4</span>    hdd  <span class="token number">0.04880</span>          osd.4        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>
 <span class="token number">8</span>    hdd  <span class="token number">0.04880</span>          osd.8        up   <span class="token number">1.00000</span>  <span class="token number">1.00000</span>

<span class="token comment"># æµ‹è¯•ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”æŸ¥çœ‹æ–‡ä»¶çš„çŠ¶æ€å’Œä¿¡æ¯ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/var/lib/rpm
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># ls -lh ./Packages</span>
-rw-r--r-- <span class="token number">1</span> root root 20M Jul  <span class="token number">8</span> <span class="token number">17</span>:56 ./Packages

<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados put msg1 ./Packages --pool=test</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados put msg1 ./Packages --pool=test-64</span>

<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados ls --pool=test</span>
msg1

<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># ceph osd map test msg1</span>
osdmap e68 pool <span class="token string">'test'</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> object <span class="token string">'msg1'</span> -<span class="token operator">></span> pg <span class="token number">2</span>.c833d430 <span class="token punctuation">(</span><span class="token number">2.10</span><span class="token punctuation">)</span> -<span class="token operator">></span> up <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9,3</span>,0<span class="token punctuation">]</span>, p9<span class="token punctuation">)</span> acting <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9,3</span>,0<span class="token punctuation">]</span>, p9<span class="token punctuation">)</span>

<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># ceph osd map test-64 msg1</span>
osdmap e68 pool <span class="token string">'test-64'</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> object <span class="token string">'msg1'</span> -<span class="token operator">></span> pg <span class="token number">3</span>.c833d430 <span class="token punctuation">(</span><span class="token number">3.30</span><span class="token punctuation">)</span> -<span class="token operator">></span> up <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2,0</span>,3<span class="token punctuation">]</span>, p2<span class="token punctuation">)</span> acting <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2,0</span>,3<span class="token punctuation">]</span>, p2<span class="token punctuation">)</span>

<span class="token comment"># åˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados rm msg1 --pool=test</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados rm msg1 --pool=test-64</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados ls --pool=test</span>
<span class="token punctuation">[</span>ceph: root@ceph01 rpm<span class="token punctuation">]</span><span class="token comment"># rados ls --pool=test-64</span>

<span class="token comment"># åˆ é™¤åˆšåˆšæ·»åŠ çš„å­˜å‚¨æ± ã€‚(ä¸´æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ï¼Œ æ°¸ä¹…ç”Ÿæ•ˆçš„é…ç½®å†™å…¥ /etc/ceph/ceph.conf)</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># ceph tell mon.* injectargs '--mon-allow-pool-delete=true'</span>
mon.ceph01: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
mon.ceph01: mon_allow_pool_delete <span class="token operator">=</span> <span class="token string">'true'</span>
mon.ceph02: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
mon.ceph02: mon_allow_pool_delete <span class="token operator">=</span> <span class="token string">'true'</span>
mon.ceph03: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
mon.ceph03: mon_allow_pool_delete <span class="token operator">=</span> <span class="token string">'true'</span>

<span class="token comment"># æ‰§è¡Œåˆ é™¤å‘½ä»¤å°±ä¸ä¼šæŠ¥é”™äº†ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># ceph osd pool rm test test --yes-i-really-really-mean-it</span>
pool <span class="token string">'test'</span> removed
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># ceph osd pool rm test-64 test-64 --yes-i-really-really-mean-it</span>
pool <span class="token string">'test-64'</span> removed

<span class="token comment"># åˆ›å»ºä¸€ä¸ªKVMçš„å—è®¾å¤‡æ± ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># ceph osd pool create kvm 256 256</span>
pool <span class="token string">'kvm'</span> created

<span class="token comment"># è®¾ç½®Application enable flag</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># ceph osd pool application enable kvm rbd</span>
enabled application <span class="token string">'rbd'</span> on pool <span class="token string">'kvm'</span>
<span class="token comment"># åˆå§‹åŒ–æ± ã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># rbd pool init -p kvm</span>
<span class="token comment"># åˆ›å»ºä¸€ä¸ªå¯æŒ‚è½½çš„é•œåƒã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># rbd create disk01 --size 5G --pool kvm</span>
<span class="token comment"># æŸ¥çœ‹é•œåƒçš„ç›¸å…³ä¿¡æ¯</span>
<span class="token punctuation">[</span>ceph: root@ceph01 ~<span class="token punctuation">]</span><span class="token comment"># rbd ls --pool kvm</span>
disk01
  size <span class="token number">5</span> GiB <span class="token keyword">in</span> <span class="token number">1280</span> objects
  order <span class="token number">22</span> <span class="token punctuation">(</span><span class="token number">4</span> MiB objects<span class="token punctuation">)</span>
  snapshot_count: <span class="token number">0</span>
  id: 1703d21a8f2ba
  block_name_prefix: rbd_data.1703d21a8f2ba
  format: <span class="token number">2</span>
  features: layering, exclusive-lock, object-map, fast-diff, deep-flatten
  op_features:
  flags:
  create_timestamp: Mon Aug <span class="token number">23</span> 09:13:58 <span class="token number">2021</span>
  access_timestamp: Mon Aug <span class="token number">23</span> 09:13:58 <span class="token number">2021</span>
  modify_timestamp: Mon Aug <span class="token number">23</span> 09:13:58 <span class="token number">2021</span>

<span class="token comment"># å®‰è£…Cephçš„å®¢æˆ·ç«¯ä»¥åŠrbdå‘½ä»¤ã€‚</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop hayden<span class="token punctuation">]</span><span class="token comment"># sudo pacman -S ceph</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop hayden<span class="token punctuation">]</span><span class="token comment"># rbd -p kvm map disk01</span>
/dev/rbd0
<span class="token punctuation">[</span>root@HaydenArchDesktop hayden<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
rbd0        <span class="token number">254</span>:0    <span class="token number">0</span>     5G  <span class="token number">0</span> disk

<span class="token comment"># æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿã€‚ </span>
<span class="token punctuation">[</span>root@HaydenArchDesktop test<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs /dev/rbd0</span>
<span class="token comment"># æŒ‚è½½ã€‚</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop test<span class="token punctuation">]</span><span class="token comment"># mount /dev/rbd0 /opt/test/</span>
<span class="token comment"># ç§»é™¤æŒ‚è½½</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop test<span class="token punctuation">]</span><span class="token comment"># umount /opt/test</span>
<span class="token comment"># å–æ¶ˆè¿™ä¸ªæ˜ å°„å…³ç³»ã€‚</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop test<span class="token punctuation">]</span><span class="token comment"># rbd unmap /dev/rbd0</span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ceph, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Ceph Cluster 03 - CephFS</title>
    <url>/2021/08/24/Linux/Linux_Ceph03/</url>
    <content><![CDATA[<p>cephç¬”è®°03</p>
<h1 id="Cephfsçš„ä½¿ç”¨"><a href="#Cephfsçš„ä½¿ç”¨" class="headerlink" title="Cephfsçš„ä½¿ç”¨"></a>Cephfsçš„ä½¿ç”¨</h1><h2 id="Cephfsçš„ä½¿ç”¨æ¡ä»¶"><a href="#Cephfsçš„ä½¿ç”¨æ¡ä»¶" class="headerlink" title="Cephfsçš„ä½¿ç”¨æ¡ä»¶"></a>Cephfsçš„ä½¿ç”¨æ¡ä»¶</h2><ol>
<li>å½“æˆ‘ä»¬éœ€è¦å¤šä¸ªæœåŠ¡æ¥æŒ‚è½½å’Œå®æ—¶çš„åŒæ­¥çš„æ—¶å€™ï¼Œ ä½¿ç”¨åˆ°CEPHFSï¼Œå¯ä»¥å®ç°æ–‡ä»¶ç³»ç»Ÿçš„å…±äº«ã€‚å†…æ ¸é‡Œé¢ç°åœ¨è¿™ä¸ªæ—¶é—´å·²ç»å†…ç½®cephfsçš„æŒ‚è½½æ¨¡å—ï¼Œ å¯ä»¥ç›´æ¥æŒ‚è½½ä¸éœ€è¦å®‰è£…ã€‚</li>
<li>cephfsè¿è¡Œéœ€è¦MDSæœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨ç¼“å­˜çš„æ–‡ä»¶ä¿¡æ¯ã€‚æ€»ä½“éœ€è¦åˆ›å»ºä¸¤ä¸ªå­˜å‚¨æ± ï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ªå­˜å‚¨MDSä¿¡æ¯çš„å­˜å‚¨æ± ï¼Œ åŒæ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®æ± æ¥æä¾›å­˜å‚¨ç©ºé—´ã€‚</li>
<li>å¯ç”¨mdsçš„æœåŠ¡ <pre class="language-bash" data-language="bash"><code class="language-bash">ceph orch mds <span class="token number">2</span></code></pre></li>
<li>åˆ›å»ºcephçš„å­˜å‚¨æ± <pre class="language-bash" data-language="bash"><code class="language-bash">ceph mds <span class="token function">stat</span>
<span class="token comment"># åˆ›å»ºä¸€ä¸ªcephfsçš„metadataæ± </span>
ceph osd pool create metadata <span class="token number">32</span> <span class="token number">32</span> 
<span class="token comment"># åˆ›å»ºä¸€ä¸ªcephfsçš„dataæ± </span>
ceph osd pool create cephfsdata <span class="token number">64</span> <span class="token number">64</span> 
<span class="token comment"># åˆ›å»ºcephçš„çŠ¶æ€</span>
ceph osd pool <span class="token function">ls</span> 
ceph <span class="token parameter variable">-s</span> 
<span class="token comment"># åˆ›å»ºcephfsçš„æ–‡ä»¶ç³»ç»Ÿ</span>
ceph fs new defaultfs metadata cephfsdata

<span class="token comment"># æ–°çš„ç‰ˆæœ¬é‡Œé¢å·²ç»ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºmdså’Œä¸¤ä¸ªå¯¹åº”çš„å­˜å‚¨æ± äº†ï¼Œ åªæ˜¯éœ€è¦ä¸€æ¡å‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨åˆ›å»ºã€‚</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph fs volume create test</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph fs volume ls</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph mds stat</span>
<span class="token comment"># éœ€è¦æå‰è·å–æŒ‚è½½çš„Tokenï¼š </span>
<span class="token punctuation">[</span>root@HaydenArchDesktop ceph<span class="token punctuation">]</span><span class="token comment"># sudo scp root@ceph01:/etc/ceph/ceph.client.admin.keyring /etc/ceph/</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop ceph<span class="token punctuation">]</span><span class="token comment"># mount -t ceph :/ /mnt -o name=admin</span>
<span class="token punctuation">[</span>root@HaydenArchDesktop mnt<span class="token punctuation">]</span><span class="token comment"># mount | grep ceph</span>
<span class="token number">192.168</span>.31.11:6789,192.168.31.12:6789,192.168.31.13:6789:/ on /mnt <span class="token builtin class-name">type</span> ceph <span class="token punctuation">(</span>rw,relatime,name<span class="token operator">=</span>admin,secret<span class="token operator">=</span><span class="token operator">&lt;</span>hidden<span class="token operator">></span>,acl<span class="token punctuation">)</span>

<span class="token comment">#</span>
<span class="token comment"># journalctl -f > /mnt/journal.log   </span>
<span class="token comment"># æŸ¥çœ‹cephfsçš„å†™å…¥æ–‡ä»¶çš„åŠ¨ä½œè¿‡ç¨‹ã€‚ </span>
<span class="token comment"># åŒæ—¶ä½¿ç”¨ tail -f åœ¨å¦ä¸€ä¸ªçª—å£ä¸­æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ã€‚ æµ‹è¯•å†™å…¥å’ŒæŸ¥çœ‹å†…å®¹çš„å·®è·ã€‚ </span>
</code></pre></li>
</ol>
<h2 id="ç”¨æˆ·æƒé™"><a href="#ç”¨æˆ·æƒé™" class="headerlink" title="ç”¨æˆ·æƒé™"></a>ç”¨æˆ·æƒé™</h2><p>MDSå¯ä»¥å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œå¤šä¸ªå®ä¾‹ä¼šè‡ªåŠ¨æ¥è´Ÿè½½ä¸åŒèµ„æºçš„æ–‡ä»¶å…ƒæ•°æ®çš„ç¼“å­˜ã€‚<br>å®¢æˆ·ç«¯é€šè¿‡MONèŠ‚ç‚¹è¿›è¡Œæˆæƒ å’Œ è·å–MDSçš„çš„ä½ç½®ã€‚<br>MDSç°åœ¨æœ€æ–°çš„ç‰ˆæœ¬é»˜è®¤å·²ç»æ˜¯ä¸€ä¸»ä¸€å¤‡ï¼Œ è‡ªåŠ¨ä¼šç”Ÿæˆé«˜å¯ç”¨çš„æ¨¡å¼ã€‚ï¼ˆä¹‹å‰çš„æ‰‹åŠ¨éƒ¨ç½²å¤šä¸ªMDSæœåŠ¡å™¨ï¼Œ ç„¶åæŒ‡å®šMDSçš„è§’è‰²ï¼‰</p>
<h3 id="åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥è¿›è¡Œèº«ä»½çš„éªŒè¯"><a href="#åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥è¿›è¡Œèº«ä»½çš„éªŒè¯" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥è¿›è¡Œèº«ä»½çš„éªŒè¯"></a>åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ¥è¿›è¡Œèº«ä»½çš„éªŒè¯</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºä¸€ä¸ªæµ‹è¯•çš„ç”¨æˆ·</span>
ceph auth <span class="token function">add</span> client.testuser mon <span class="token string">'allow r'</span> mds <span class="token string">'allow rw'</span> osd <span class="token string">'allow rwx pool=cephfsdata'</span>
<span class="token comment"># æµ‹è¯•æ‰€å»ºç«‹çš„ç”¨æˆ·çš„æƒé™ï¼Œè·å–è®¤è¯çš„keyring</span>
ceph auth get client.testuser
<span class="token comment"># å¯¼å‡ºç”¨æˆ·çš„Keyringï¼Œ ç”¨æ¥åšé›†ç¾¤çš„æ ¡éªŒ</span>
ceph auth get client.testuser <span class="token parameter variable">-o</span> ceph.client.testuser.keyring
<span class="token comment"># å¯¼å‡ºç”¨æˆ·çš„key ï¼Œ Kubernetesçš„æŒ‚è½½ä¼šä½¿ç”¨åˆ°</span>
ceph auth print-key client.testuser <span class="token operator">></span> testuser.key
<span class="token comment"># éªŒè¯ç”¨æˆ·æ˜¯å¦å¯ä»¥è·å–åˆ°é›†ç¾¤çš„çŠ¶æ€</span>
ceph <span class="token parameter variable">--user</span> testuser <span class="token parameter variable">-s</span> 

<span class="token comment"># å°†æŒ‚è½½ç‚¹æ·»åŠ åˆ°fstabè‡ªåŠ¨å¼€æœºæŒ‚è½½</span>
MON01:6789,MON02:6789,<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.:/ /mnt ceph defaults,name<span class="token operator">=</span>testuser,secretfile<span class="token operator">=</span>/etc/ceph/testuser.key,_netdev <span class="token number">0</span> <span class="token number">0</span></code></pre>
<h3 id="Dashboardæƒé™"><a href="#Dashboardæƒé™" class="headerlink" title="Dashboardæƒé™"></a>Dashboardæƒé™</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ç”¨æˆ–è€…ç¦ç”¨è´¦æˆ·</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph dashboard ac-user-enable admin</span>

<span class="token comment"># é‡ç½®Dashboardç”¨æˆ·çš„å¯†ç </span>
<span class="token comment"># Old Version</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph dashboard set-login-credentials admin -i /etc/ceph/dashboard_password</span>

<span class="token comment"># New version command.</span>
<span class="token punctuation">[</span>ceph: root@ceph01 /<span class="token punctuation">]</span><span class="token comment"># ceph dashboard -h | grep ac-user</span>
dashboard ac-user-add-roles <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>roles<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>         Add roles to user
dashboard ac-user-create <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>rolename<span class="token operator">></span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>name<span class="token operator">></span><span class="token punctuation">]</span>   Create a user. Password <span class="token builtin class-name">read</span> from <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>
dashboard ac-user-del-roles <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>roles<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>         Delete roles from user
dashboard ac-user-delete <span class="token punctuation">[</span><span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">]</span>                       Delete user
dashboard ac-user-disable <span class="token punctuation">[</span><span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">]</span>                      Disable a user
dashboard ac-user-enable <span class="token punctuation">[</span><span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">]</span>                       Enable a user
dashboard ac-user-set-info <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token operator">&lt;</span>name<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>email<span class="token operator">></span><span class="token punctuation">]</span>      Set user info
dashboard ac-user-set-password <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span>--force-         Set user password from <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>
dashboard ac-user-set-password-hash <span class="token operator">&lt;</span>username<span class="token operator">></span>              Set user password bcrypt <span class="token builtin class-name">hash</span> from <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>
dashboard ac-user-set-roles <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>roles<span class="token operator">></span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>         Set user roles
dashboard ac-user-show <span class="token punctuation">[</span><span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">]</span>                         Show user info</code></pre>

<h3 id="MDS-é«˜å¯ç”¨"><a href="#MDS-é«˜å¯ç”¨" class="headerlink" title="MDS é«˜å¯ç”¨"></a>MDS é«˜å¯ç”¨</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æå‡é»˜è®¤çš„ä¸»èŠ‚ç‚¹çš„æ•°é‡ï¼Œ æ¥æé«˜MDSæœåŠ¡çš„ååé‡</span>
ceph fs <span class="token builtin class-name">set</span> defaultfs max_mds <span class="token number">2</span> 
ceph fs get defaultfs
<span class="token comment"># å˜æˆä¸¤ä¸»ä¸¤å¤‡ï¼Œ ï¼ˆè®¾ç½®Rankï¼‰</span>
<span class="token comment"># å‚æ•°ï¼š mds_standby_replay true </span>
         mds_standby_for_name: MDS_NAME
         mds_standby_for_rank: å¤‡ä»½æŒ‡å®šçº§åˆ«çš„mds
         mds_standby_for_fscid: æŒ‡å®šæ–‡ä»¶ç³»ç»ŸIDï¼Œä¼šè”åˆranké…ç½®ç”Ÿæ•ˆï¼Œå¦‚æœæŒ‡å®šäº†rankå°±æ˜¯æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„rankä¼šè¿›è¡Œä¸»å¤‡ï¼Œå¦‚æœæœªæŒ‡å®šå°±æ˜¯æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰Rankã€‚</code></pre>
<ol>
<li>å¦‚æœæ˜¯ä¸€å¯¹ä¸€çš„é«˜å¯ç”¨ ï¼Œ éœ€è¦å¯¹æ¯ä¸ªmdsè¿›è¡Œç‹¬ç«‹çš„é…ç½®ã€‚<br>é…ç½®æ ·ä¾‹ï¼š <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®çš„ç»“æœæ˜¯mds1ä¸»ï¼Œ mds2 å¤‡ï¼› mds3 ä¸»ï¼Œ mds4 å¤‡.</span>
<span class="token punctuation">[</span>mds.ceph-mds1<span class="token punctuation">]</span>
mds_standby_replay <span class="token operator">=</span> <span class="token boolean">true</span> 
mds_standby_for_name <span class="token operator">=</span> ceph-mds2
mds_standby_for_fscid <span class="token operator">=</span> defaultfs 

<span class="token punctuation">[</span>mds.ceph-mds3<span class="token punctuation">]</span>
mds_standby_replay <span class="token operator">=</span> <span class="token boolean">true</span>
mds_standby_for_name <span class="token operator">=</span> ceph-mds4</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ceph, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Ceph Cluster 04 - CRUSHç®—æ³•</title>
    <url>/2021/09/01/Linux/Linux_Ceph04/</url>
    <content><![CDATA[<p>cephç¬”è®°04</p>
<h1 id="ä¿®æ”¹CRUSHç®—æ³•çš„åˆ†é…æ–¹å¼"><a href="#ä¿®æ”¹CRUSHç®—æ³•çš„åˆ†é…æ–¹å¼" class="headerlink" title="ä¿®æ”¹CRUSHç®—æ³•çš„åˆ†é…æ–¹å¼"></a>ä¿®æ”¹CRUSHç®—æ³•çš„åˆ†é…æ–¹å¼</h1><h2 id="åŸºç¡€æ¦‚å¿µï¼š"><a href="#åŸºç¡€æ¦‚å¿µï¼š" class="headerlink" title="åŸºç¡€æ¦‚å¿µï¼š"></a>åŸºç¡€æ¦‚å¿µï¼š</h2><h3 id="äº”ç§è¿è¡Œå›¾ï¼š-MONæœåŠ¡ç»´æŠ¤"><a href="#äº”ç§è¿è¡Œå›¾ï¼š-MONæœåŠ¡ç»´æŠ¤" class="headerlink" title="äº”ç§è¿è¡Œå›¾ï¼š MONæœåŠ¡ç»´æŠ¤"></a>äº”ç§è¿è¡Œå›¾ï¼š MONæœåŠ¡ç»´æŠ¤</h3><ol>
<li>Monitor Map - ç›‘æ§çš„è¿è¡Œå›¾ MONçš„çŠ¶æ€</li>
<li>OSD Map - OSDçš„çŠ¶æ€ï¼Œ æ¯éš”å…­ç§’é’Ÿæ±‡æŠ¥ä¸€æ¬¡çŠ¶æ€</li>
<li>PG Map - PGçš„è¿è¡Œå›¾ï¼Œ PGçš„çŠ¶æ€å’Œæ˜ å°„å…³ç³»</li>
<li>CRUSH Map - ä¸€è‡´æ€§hashç®—æ³•ï¼Œå’Œæ•°æ®å—å’Œosdçš„åˆ†é…å…³ç³»ï¼Œ åŠ¨æ€æ›´æ–°ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šé€šè¿‡CRUSHç®—æ³•ä¼šæ ¹æ®osdçš„mapåˆ›å»ºPGç»„åˆçš„æ¥å¯¹æ–‡ä»¶çš„å­˜å‚¨è¿›è¡Œè´Ÿè½½å’Œåˆ†é…ã€‚å‡å¦‚æœ‰20ä¸ªosdï¼Œåˆ›å»º32é‡ç»„åˆåˆ†é…å¯¹åº”çš„pgå’Œosdçš„å¯¹åº”å…³ç³»ï¼Œé€‰ä¸»ä»ï¼Œé€‰åˆ†å¸ƒæ–¹å¼å’ŒèŠ‚ç‚¹çš„åŒæ­¥å…³ç³»ï¼Œå«åšCRUSH Mapã€‚</li>
<li>MDS Map - Metadata Map ï¼Œå…ƒæ•°æ®å’Œæ•°æ®æ–‡ä»¶çš„æ˜ å°„å…³ç³»ã€‚</li>
</ol>
<h3 id="5ç§ç®—æ³•å¯¹èŠ‚ç‚¹çš„é€‰æ‹©æ–¹å¼"><a href="#5ç§ç®—æ³•å¯¹èŠ‚ç‚¹çš„é€‰æ‹©æ–¹å¼" class="headerlink" title="5ç§ç®—æ³•å¯¹èŠ‚ç‚¹çš„é€‰æ‹©æ–¹å¼"></a>5ç§ç®—æ³•å¯¹èŠ‚ç‚¹çš„é€‰æ‹©æ–¹å¼</h3><ol>
<li>Uniform</li>
<li>List </li>
<li>Tree</li>
<li>Straw - æ—©æœŸçš„ç‰ˆæœ¬ï¼Œåˆ†å¸ƒä¸æ˜¯ç‰¹åˆ«çš„å‡è¡¡ï¼ŒæŠ½ç­¾ç®—æ³•</li>
<li>Straw2 - ç›®å‰å·²ç»å‘å±•ä¸­çš„ç‰ˆæœ¬ï¼Œ æŠ½ç­¾ç®—æ³• ï¼ˆDefaultï¼‰</li>
</ol>
<h2 id="å¯¹PGçš„åŠ¨æ€è°ƒæ•´"><a href="#å¯¹PGçš„åŠ¨æ€è°ƒæ•´" class="headerlink" title="å¯¹PGçš„åŠ¨æ€è°ƒæ•´"></a>å¯¹PGçš„åŠ¨æ€è°ƒæ•´</h2><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯åŠ¨æ€è°ƒæ•´çš„ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨è°ƒæ•´ä¸ºç»™äºˆæƒé‡ï¼Œè®¾ç½®PGåˆ†é…çš„å€¾å‘ï¼Œä¾‹å¦‚1Tæƒé‡æ˜¯1ï¼Œç­‰ç­‰ç­‰ç­‰</p>
<h3 id="æŸ¥çœ‹çŠ¶æ€ä»¥åŠè°ƒæ•´æ–¹å¼"><a href="#æŸ¥çœ‹çŠ¶æ€ä»¥åŠè°ƒæ•´æ–¹å¼" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€ä»¥åŠè°ƒæ•´æ–¹å¼"></a>æŸ¥çœ‹çŠ¶æ€ä»¥åŠè°ƒæ•´æ–¹å¼</h3><p>ceph osd df<br>éœ€è¦å…³æ³¨çš„å€¼æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>weight - æ ¹æ®ç£ç›˜çš„ç©ºé—´è¿›è¡Œçš„è°ƒæ•´ï¼Œé»˜è®¤è‡ªåŠ¨è®¡ç®—ï¼Œ å¯è°ƒã€‚</li>
<li>reweight - ç£ç›˜çš„æ‰€æœ‰æƒé‡ç›¸åŠ ä¹‹åï¼Œ å•ä¸ªosdæ‰€å ç”¨çš„æ¯”ä¾‹ï¼Œç”±äºé»˜è®¤çš„åˆ†é…æ˜¯ç›¸å¯¹æ¦‚ç‡çš„å¹³è¡¡ï¼Œæ‰€ä»¥åˆ†é…å¯èƒ½è¿˜æ˜¯ä¼šæœ‰ä¸€äº›ä¸å‡è¡¡ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥è¿›è¡Œå†æ¬¡çš„å¹³è¡¡ã€‚</li>
</ul>
<p>è°ƒæ•´çš„æ•ˆæœå°±æ˜¯å¸Œæœ›ç«‹åˆ»é‡æ–°å¹³è¡¡PGçš„æ•°é‡(éœ€è¦æ³¨æ„åœ¨ä¸šåŠ¡è´Ÿè½½ä½çš„æ—¶å€™æ‰§è¡Œ) æ•°æ®å‡è¡¡åˆ†é…ã€‚è¿«ä½¿ç®—æ³•åŠ¨æ€çš„æ›´æ–°PGçš„ä½ç½®ã€‚</p>
<ol>
<li><p>è°ƒæ•´WEIGHTçš„å€¼<br>ceph osd crush reweight osd.10 {WEIGHT} # è°ƒæ•´weightå€¼ï¼Œ è¶Šå¤§æƒé‡è¶Šé«˜ï¼Œåˆ†é…çš„PGæ•°é‡è¶Šå¤§ã€‚</p>
</li>
<li><p>è°ƒæ•´REWEIGHT<br>ceph osd crush reweight {OSD_ID} {REWEIGHT} # èŒƒå›´æ˜¯ 0 - 1ï¼Œ ä¹Ÿæ˜¯è¶Šå¤§æƒé‡è¶Šé«˜ã€‚</p>
</li>
</ol>
<h3 id="å¯¹è¿è¡Œå›¾è¿›è¡Œæ“ä½œ"><a href="#å¯¹è¿è¡Œå›¾è¿›è¡Œæ“ä½œ" class="headerlink" title="å¯¹è¿è¡Œå›¾è¿›è¡Œæ“ä½œ"></a>å¯¹è¿è¡Œå›¾è¿›è¡Œæ“ä½œ</h3><ol>
<li>åˆ›å»ºä¸€ä¸ªä¿å­˜è¿è¡Œå›¾çš„ç›®å½•<br>mkdir &#x2F;cephmap&#x2F;ceph -p<br>ceph osd getcrushmap -o &#x2F;cephmap&#x2F;ceph&#x2F;crushmap  # åŒæ—¶å¯ä»¥åšå¤‡ä»½ä½¿ç”¨ï¼Œå°†è¿è¡Œå›¾å¯¼å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œå½“éœ€è¦çš„æ—¶å€™å¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿˜åŸã€‚</li>
<li>è½¬æ¢mapçš„äºŒè¿›åˆ¶æ ¼å¼ä¸ºæ–‡æœ¬ï¼ŒUbuntu éœ€è¦å®‰è£… crushbase åŒ…ã€‚<br>crushtool -d &#x2F;cephmap&#x2F;ceph &gt; &#x2F;cephmap&#x2F;ceph&#x2F;crushmap.txt</li>
<li>ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶<br>ä¸»è¦ç¼–è¾‘typeéƒ¨åˆ†ï¼Œ æŒ‰ç…§ä¸åŒçš„è°ƒåº¦éœ€æ±‚ï¼Œ<br>æŒ‰ç…§ä¸åŒçš„osdï¼Œä¸åŒä¸»æœºè°ƒåº¦ï¼Œä¸åŒçš„æœºæ¶ï¼Œä¸åŒçš„æœºæŸœï¼Œä¸åŒçš„PDUï¼Œä¸åŒçš„æˆ¿é—´ï¼Œä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œ ä¸åŒçš„åŒºåŸŸåŸå¸‚ï¼Œ é¡¶å±‚ã€‚<br>ä¸‹é¢æ˜¯ä¸»æœºçš„é…ç½®éƒ¨åˆ†ã€‚æ¯ä¸ªä¸»æœºçš„ç®—æ³•ï¼Œosdçš„åˆ†é…æƒ…å†µï¼Œæƒé‡ã€‚<br>Rules å‰¯æœ¬æ± çš„è§„åˆ™é‡Œé¢å®šä¹‰äº†<br>step take default  åŸºäºdefaulté…ç½®ç«¯é‡Œé¢çš„è§„åˆ™æ¥è¿›è¡Œosdçš„åˆ†é…ã€‚<br>step chooseleaf firstn 0(æŒ‰ç…§é¡ºåºé€‰æ‹©ï¼Œå…ˆé€‰åˆ°çš„å°±æ˜¯) type hostï¼ˆæŒ‰ç…§ä»€ä¹ˆç±»åˆ«è¿›è¡Œé€‰æ‹©é«˜å¯ç”¨çš„ç±»å‹ï¼‰<br>max_size å‰¯æœ¬æ± é…ç½®æ–‡ä»¶ä¹‹ä¸­å¯ä»¥å®šä¹‰å‰¯æœ¬æ•°</li>
<li>è½¬æ¢æˆäºŒè¿›åˆ¶æ–‡ä»¶<br>crushtool -c &#x2F;cephmap&#x2F;ceph&#x2F;crushmap.txt -o &#x2F;cephmap&#x2F;ceph&#x2F;crushmap_new </li>
<li>å¯¼å…¥æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ<br>ceph osd setcrushmap -i &#x2F;cephmap&#x2F;ceph&#x2F;crushmap_new</li>
<li>æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ<br>ceph osd crush rule dump</li>
<li>åˆ›å»ºä¸€ä¸ªå­˜å‚¨æ± <br>ceph osd pool create magedu-ssdpool 32 32 magedu_ssd_rule<br>ceph pg ls-by-pool  magedu-ssdpool | awk â€˜{print $1,$2,$15}â€™</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ceph, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>i3wmçš„ç®€å•é…ç½®</title>
    <url>/2019/10/22/Linux/Linux_ChangeGnometoi3wm/</url>
    <content><![CDATA[<p>å°†è‡ªå·±çš„æ¡Œé¢ç¯å¢ƒè¿ç§»åˆ°äº†i3ã€‚Gnomeå¥½ç”¨æ˜¯å¥½ç”¨çš„ï¼Œä½†æ˜¯ä½“é‡è¿˜æ˜¯æœ‰ç‚¹å„¿å¤§äº†ï¼Œåƒèµ„æºæœ‰ç‚¹å¤šã€‚</p>
<p>è¿™ä¸ªç°åœ¨å·²ç»æ›´æ–°åˆ° DWMä¸Šé¢äº†ï¼Œ å¯¹äºè¿™é‡Œé¢è¿˜æœ‰å…¶ä»–çš„å·¥å…·æ˜¯ä¸€ç›´åœ¨ç”¨çš„ ï¼Œ æ¯”å¦‚ picom ç­‰ç­‰ã€‚ </p>
<h1 id="å®‰è£…i3-gaps"><a href="#å®‰è£…i3-gaps" class="headerlink" title="å®‰è£…i3-gaps"></a>å®‰è£…i3-gaps</h1><p>å®‰è£…çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•,pacman å°±å®Œäº‹å„¿äº†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pacman <span class="token parameter variable">-Syyu</span> 
pacman <span class="token parameter variable">-S</span> i3-gaps
  è¿™é‡Œæœ‰ä¸¤ä¸ªå¯ä»¥é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯i3-wm,  è¿˜æœ‰ä¸€ä¸ªæ˜¯i3-gaps, æˆ‘ç”¨äº†i3gapsï¼Œ å¥½çœ‹ä¸€äº›ã€‚
pacman <span class="token parameter variable">-S</span> alacritty 
pacman <span class="token parameter variable">-S</span> polybar
pacman <span class="token parameter variable">-S</span> compton <span class="token punctuation">(</span>æœ€æ–°çš„è½¯ä»¶æ”¹åäº†ï¼Œå«picom,ä½†æ˜¯å®‰è£…çš„æ–¹å¼ä¸å˜çš„ã€‚<span class="token punctuation">)</span>
pacman <span class="token parameter variable">-S</span> picom
pacman <span class="token parameter variable">-S</span> dmenu
pacman <span class="token parameter variable">-S</span> rofi
pacman <span class="token parameter variable">-S</span> feh 
pacman <span class="token parameter variable">-S</span> variety
pacman <span class="token parameter variable">-S</span> unzip-natspec  
<span class="token comment">#unzip-natspecè²Œä¼¼æ˜¯åœ¨archlinuxcné‡Œé¢çš„ï¼Œå¯ä»¥å¤„ç†zipè§£å‹çš„æ—¶å€™ä¹±ç çš„é—®é¢˜ï¼Œä¸ç”¨è€ƒè™‘æ‰‹åŠ¨æŒ‡å®šè§£å‹çš„-Oäº†ã€‚</span></code></pre>

<h1 id="é…ç½®i3"><a href="#é…ç½®i3" class="headerlink" title="é…ç½®i3"></a>é…ç½®i3</h1><p>åœ¨å·²ç»æœ‰Gnomeç¯å¢ƒçš„æ¡ä»¶ä¸‹ï¼Œi3 çš„é…ç½®è¿˜æ˜¯æ¯”è¾ƒè½»æ¾çš„ã€‚</p>
<h2 id="I3çš„ä½¿ç”¨è¯´æ˜"><a href="#I3çš„ä½¿ç”¨è¯´æ˜" class="headerlink" title="I3çš„ä½¿ç”¨è¯´æ˜"></a>I3çš„ä½¿ç”¨è¯´æ˜</h2><p>i3é»˜è®¤çš„æ“ä½œæ˜¯<strong>ä½¿ç”¨Windows&#x2F;Super&#x2F;Mod</strong>è¿™ä¸ªæŒ‰é”®(æˆ–è€…éšä¾¿æ€ä¹ˆå«å§ï¼Œåé¢éƒ½è¯´<strong>Super</strong>ï¼Œå’ŒGnomeçš„å£å¾„ä¸€è‡´)ï¼Œç®€å•åˆ—ä¸¾ä¸€ä¸‹é¢‘ç‡è¾ƒé«˜çš„<strong>ä½¿ç”¨æ–¹å¼</strong></p>
<ol>
<li>å…ˆè¯´<strong>é‡è½½é…ç½®æ–‡ä»¶</strong>ï¼Œä½¿ç”¨ Super + Shift + r </li>
<li><strong>é€€å‡ºåˆ°DM</strong>ï¼Œä½¿ç”¨Super + Shift + eï¼Œ DMå°±æ˜¯ä½ çš„ç™»å½•ç•Œé¢ã€‚</li>
<li>i3æä¾›äº†10ä¸ªè™šæ‹Ÿæ¡Œé¢ï¼Œ<strong>åˆ‡æ¢è™šæ‹Ÿæ¡Œé¢æ–¹å¼</strong>æ˜¯å¯ä»¥é€šè¿‡Super + 1 - 10 å¿«é€Ÿåˆ‡æ¢</li>
<li>åœ¨é»˜è®¤çš„<strong>Tilingæ’åˆ—æ¨¡å¼</strong>ä¸­<strong>åˆ‡æ¢æ’åˆ—ä½ç½®</strong>Verticalå’ŒHorizontal. é€šè¿‡Super V æˆ–è€… Super H</li>
<li><strong>è°ƒæ•´å®¹å™¨å¸ƒå±€</strong>ï¼š<ol>
<li><strong>ä½¿ç”¨Stacking</strong> â€“ Super + s æ‰€æœ‰çš„æ ‡ç­¾å †å æ˜¾ç¤ºæœ€ä¸Šæ–¹æä¾›æ ‡ç­¾è¿›è¡Œåˆ‡æ¢</li>
<li><strong>ä½¿ç”¨Tabbed</strong> â€“ Super + w æ ‡ç­¾é¡µæ–¹å¼æ˜¾ç¤ºæ‰€æœ‰çª—å£</li>
<li><strong>ä½¿ç”¨Toggle</strong> â€“ Super + e å¹³é“ºçª—å£æ¨¡å¼ï¼Œå¯åˆ‡æ¢ä¸åŒçš„å¸ƒå±€æ–¹å¼</li>
</ol>
</li>
<li><strong>æ‰“å¼€ç¨‹åº</strong>å¯ä»¥é€šè¿‡terminalå¼€å¯ï¼Œæˆ–è€…Super + d ä½¿ç”¨dmenuå¼€å¯ï¼ˆå¯å°† dmenu æ›¿æ¢æˆ rofiï¼‰</li>
<li><strong>å…³é—­ç¨‹åº</strong>å¯ä»¥é€šè¿‡Super + Shift + qå…³é—­ï¼Œæˆ–è€…é¼ æ ‡ç‚¹å‡»xï¼Œä¸æ˜¯æ‰€æœ‰çš„çª—å£éƒ½æœ‰x</li>
<li>åœ¨<strong>çª—å£é—´ç§»åŠ¨</strong>å¯ä½¿ç”¨ Super + {jkl;}å››ä¸ªæŒ‰é”®ï¼›æˆ–è€…ä½¿ç”¨Super + {up,down,left,right}çš„arrowkey</li>
<li>å¯å°†<strong>çª—å£å˜æ›´ä¸ºFloating</strong>ï¼Œ ä½¿ç”¨Super + Shift + Space</li>
<li><strong>Floatingçª—å£è°ƒæ•´ä½ç½®</strong>å¯é•¿æŒ‰Super ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨è°ƒæ•´ä½ç½®</li>
<li><strong>å…¨å±ç¨‹åº</strong>ä½¿ç”¨ Super + f</li>
</ol>
<h2 id="i3çš„è‡ªå®šä¹‰é…ç½®"><a href="#i3çš„è‡ªå®šä¹‰é…ç½®" class="headerlink" title="i3çš„è‡ªå®šä¹‰é…ç½®"></a>i3çš„è‡ªå®šä¹‰é…ç½®</h2><h3 id="é…ç½®æ–‡ä»¶çš„ä½ç½®"><a href="#é…ç½®æ–‡ä»¶çš„ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶çš„ä½ç½®"></a>é…ç½®æ–‡ä»¶çš„ä½ç½®</h3><p>é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼š $HOME&#x2F;.config&#x2F;i3&#x2F;config,<strong>æ‰€æœ‰çš„é…ç½®åœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹ä¿®æ”¹</strong></p>
<h3 id="è‡ªå®šä¹‰ç•Œé¢çš„è®¾ç½®"><a href="#è‡ªå®šä¹‰ç•Œé¢çš„è®¾ç½®" class="headerlink" title="è‡ªå®šä¹‰ç•Œé¢çš„è®¾ç½®"></a>è‡ªå®šä¹‰ç•Œé¢çš„è®¾ç½®</h3><p>é»˜è®¤çš„i3å¯åŠ¨çš„æ—¶å€™è¿˜æ˜¯æŒºä¸‘çš„ï¼Œæˆ‘æœ‰å››ä¸ªè®¾ç½®ï¼š</p>
<pre class="language-none"><code class="language-none">gaps inner 5  # è®¾ç½®i3çª—å£é—´çš„ç©ºéš™å¤§å°ï¼Œå•ä½æ˜¯åƒç´ ã€‚
new_window 1pixel # è®¾ç½®æ–°çš„çª—å£çš„è¾¹ç•Œå®½åº¦ï¼Œæ•ˆæœæ˜¯ä¸æ˜¾ç¤ºçª—å£çš„titleã€‚
new_float 1pixel	# æ–°çš„æµ®åŠ¨çª—å£çš„è¾¹ç•Œå®½åº¦ï¼ŒåŒä¸Šã€‚
smart_borders on 	# åœ¨åªæœ‰ä¸€ä¸ªçª—å£çš„æƒ…å†µä¸‹è‡ªåŠ¨æœ€å¤§åŒ–å½“å‰çš„çª—å£ï¼Œä¸å¤„ç†çª—å£çš„Gapã€‚</code></pre>

<h3 id="é»˜è®¤terminalç¨‹åºæ›´æ”¹"><a href="#é»˜è®¤terminalç¨‹åºæ›´æ”¹" class="headerlink" title="é»˜è®¤terminalç¨‹åºæ›´æ”¹"></a>é»˜è®¤terminalç¨‹åºæ›´æ”¹</h3><p>è®¾ç½®é»˜è®¤ä½¿ç”¨ Super + Enter æ‰“å¼€alacritty</p>
<pre class="language-none"><code class="language-none">bindsym $mod+Return exec --no-startup-id alacritty</code></pre>

<p>alacritty æ˜¯ä¸€ä¸ªä½¿ç”¨GPUè¿›è¡Œæ¸²æŸ“çš„terminalæ¨¡æ‹Ÿå™¨ï¼Œå®ƒæœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘çš„<strong>é…ç½®æ–‡ä»¶è·¯å¾„</strong>åœ¨:$HOME&#x2F;.config&#x2F;alacritty&#x2F;alacritty.conf</p>
<p>*NOTEï¼š å…³äºAlacrittyçš„é—®é¢˜ç›®å‰å·²ç»è§£å†³çš„å·®ä¸å¤šäº†ã€‚ è¿˜æœ‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯å…³äºsshè¿‡å»ä¹‹åä¸èƒ½æ­£ç¡®çš„è¯†åˆ«ç»ˆç«¯ç±»å‹çš„BUGï¼Œè§£å†³æ–¹æ¡ˆåœ¨åé¢ã€‚</p>
<h3 id="é»˜è®¤æ‰“å¼€Firefox"><a href="#é»˜è®¤æ‰“å¼€Firefox" class="headerlink" title="é»˜è®¤æ‰“å¼€Firefox"></a>é»˜è®¤æ‰“å¼€Firefox</h3><p>æˆ‘çš„è®¾ç½®æ˜¯Super + p</p>
<pre class="language-none"><code class="language-none">bindsym $mod+p exec --no-startup-id firefox</code></pre>

<h3 id="å¼€æœºå¯åŠ¨ä¸€äº›ç¨‹åº"><a href="#å¼€æœºå¯åŠ¨ä¸€äº›ç¨‹åº" class="headerlink" title="å¼€æœºå¯åŠ¨ä¸€äº›ç¨‹åº"></a>å¼€æœºå¯åŠ¨ä¸€äº›ç¨‹åº</h3><p>æˆ‘çš„å¼€æœºå¯åŠ¨äº† Compton, Variety, Remmina,Aria2c, Polybar, ibus-daemonï¼Œå‰©ä¸‹çš„çœ‹è‡ªå·±å–œæ¬¢ä»€ä¹ˆå°±å®‰è£…ä»€ä¹ˆå°±OKäº†ã€‚</p>
<pre class="language-none"><code class="language-none">exec_always --no-startup-id compton --config &#x2F;home&#x2F;liarlee&#x2F;.config&#x2F;compton&#x2F;compton.conf -b
exec_always --no-startup-id variety 
exec_always --no-startup-id remmina
exec_always --no-startup-id aria2c --conf-path&#x3D;&#x2F;home&#x2F;liarlee&#x2F;.aria2&#x2F;aria2.conf
exec_always --no-startup-id sh &#x2F;home&#x2F;liarlee&#x2F;.config&#x2F;polybar&#x2F;polybar_startup.sh
exec_always --no-startup-id ibus-daemon -dr</code></pre>

<h3 id="æˆªå±åŠŸèƒ½å¿«æ·é”®"><a href="#æˆªå±åŠŸèƒ½å¿«æ·é”®" class="headerlink" title="æˆªå±åŠŸèƒ½å¿«æ·é”®"></a>æˆªå±åŠŸèƒ½å¿«æ·é”®</h3><p>é»˜è®¤çš„i3ä¸èƒ½ç”¨PrintScreenæˆ‘è§‰å¾—æœ‰ç‚¹å„¿éš¾å—ï¼Œæ‰€ä»¥è‡ªå·±æ·»åŠ äº†å¿«æ·é”®å’Œä¿å­˜ä½ç½®</p>
<pre class="language-none"><code class="language-none">bindsym --release Print exec &quot;scrot -b -m &#x2F;home&#x2F;liarlee&#x2F;Pictures&#x2F;Scort_ScreenShot&#x2F;screenshot.png&quot;</code></pre>

<hr>
<p><strong>æ›´æ–°</strong>ï¼š</p>
<p>ä¹‹å‰çš„è¿™ä¸ªæ–¹å¼å¯ä»¥ä½œä¸ºæˆªå›¾çš„å¿«æ·æ–¹å¼ï¼Œä½†æ˜¯å½“ä½ éœ€è¦è¿ç»­çš„æˆªå›¾çš„æ—¶å€™å°±ä¼šç‰¹åˆ«çš„éš¾å—ï¼Œå› ä¸ºæ–°æˆªå›¾ä¼šè‡ªåŠ¨è¦†ç›–æ‰æ—§çš„æˆªå›¾ã€‚æ›´æ–°ä¸€ä¸‹æ–°çš„æ–¹å¼ï¼Œå†™ä¸€ä¸ªè„šæœ¬ï¼Œå½“æˆ‘ä»¬æŒ‰ä¸‹PrintScçš„æ—¶å€™è§¦å‘è¿™ä¸ªè„šæœ¬ï¼Œå°±å¯ä»¥å¯¹æ–‡ä»¶é‡å‘½åäº†ã€‚</p>
<ol>
<li>ä¹Ÿè®¸è„šæœ¬åç§°å¯ä»¥å« - screenshot.sh</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">snapdate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">"+%Y%m%d_%H%M%S"</span><span class="token variable">`</span></span>
gnome-screenshot <span class="token parameter variable">-f</span> /home/hayden/screenshot/Screenshot-<span class="token variable">$snapdate</span>.png</code></pre>

<ol start="2">
<li>æ›´æ–°i3çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¿«æ·é”®çš„ç®¡ç†ã€‚</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash">bindsym <span class="token parameter variable">--release</span> Print <span class="token builtin class-name">exec</span> <span class="token string">"/home/liarlee/Scripts/System/screenshot.sh"</span></code></pre>

<ol start="3">
<li>è¿™æ ·å†æˆªå›¾å°±ä¼šä¿å­˜åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œå¹¶ä¸”ç”¨æ—¶é—´å‘½ååŒºåˆ†å¼€ä¸åŒçš„æˆªå›¾ï¼Œä¸ä¼šè¦†ç›–äº†ã€‚</li>
</ol>
<h3 id="è°ƒèŠ‚éŸ³é‡å¿«æ·é”®"><a href="#è°ƒèŠ‚éŸ³é‡å¿«æ·é”®" class="headerlink" title="è°ƒèŠ‚éŸ³é‡å¿«æ·é”®"></a>è°ƒèŠ‚éŸ³é‡å¿«æ·é”®</h3><p>ç”±äºå·²ç»æœ‰äº†PulseAudioï¼Œ æ‰€ä»¥i3è‡ªåŠ¨å¢åŠ äº†ç¬”è®°æœ¬Func-keyçš„è°ƒæ•´ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰åŠŸèƒ½é”®çš„è¯ï¼Œè¿˜æ˜¯è¦æŒ‰ç…§å¦‚ä¸‹è‡ªå®šä¹‰çš„ã€‚æˆ‘<strong>è°ƒæ•´éŸ³é‡</strong>ç”¨çš„Super + F2&#x2F;F3, ä¹Ÿå¯ä»¥æ”¹å…¶ä»–çš„</p>
<pre class="language-none"><code class="language-none"># Use pactl to adjust volume in PulseAudio.
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% &amp;&amp; $refresh_i3status
bindsym $mod+F3 exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% &amp;&amp; $refresh_i3status
bindsym $mod+F2 exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% &amp;&amp; $refresh_i3status
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% &amp;&amp; $refresh_i3status
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle &amp;&amp; $refresh_i3status
bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle &amp;&amp; $refresh_i3status</code></pre>

<h3 id="æ‹¼éŸ³è¾“å…¥æ³•"><a href="#æ‹¼éŸ³è¾“å…¥æ³•" class="headerlink" title="æ‹¼éŸ³è¾“å…¥æ³•"></a>æ‹¼éŸ³è¾“å…¥æ³•</h3><p>æˆ‘åœ¨Gnomeä¸‹ä½¿ç”¨çš„æ˜¯Ibus-rimeæ¡†æ¶çš„å°é¹¤åŒæ‹¼ï¼ŒGnomeä¸‹å¼€ç®±å³ç”¨ï¼Œä½†æ˜¯i3éœ€è¦åšä¸€äº›ç®€å•çš„é…ç½®ï¼Œæ›´æ”¹ä¸€äº›ç¯å¢ƒå˜é‡ã€‚</p>
<ol>
<li><p>åœ¨è‡ªå·±çš„å®¶ç›®å½• : <code>touch .xprofile</code></p>
</li>
<li><p>æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GTK_IM_MODULE</span><span class="token operator">=</span>ibus
<span class="token builtin class-name">export</span> <span class="token assign-left variable">QT_IM_MODULE</span><span class="token operator">=</span>ibus
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">XMODIFIERS</span></span><span class="token operator">=</span>@im<span class="token operator">=</span>ibus</code></pre>
</li>
<li><p>ä½¿ç”¨sourceè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚å°è¯•è¾“å‡º<code>echo $XMODIFIER</code>æŸ¥çœ‹æ˜¯å¦å·²ç»ç”Ÿæ•ˆï¼Œè¾“å‡ºç©ºå€¼çš„è¯ibusè¿˜æ˜¯æ— æ³•ä½¿ç”¨ã€‚</p>
</li>
<li><p>ç»“åˆä¸Šé¢çš„i3é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ibus-daemon -drå¯åŠ¨ï¼Œ<strong>ä¸è¦XIM</strong>ã€‚å¦‚æœä½ ä½¿ç”¨äº†-xå¯åŠ¨ï¼Œåœ¨æµ®åŠ¨çš„è¾“å…¥æ³•å·¥å…·æ ä¸­ä¼šæ˜¾ç¤ºä¸€ä¸ªç¦æ­¢çš„æ ‡å¿—ï¼Œè¯´æ˜æ‹¼éŸ³æœªæ­£å¸¸å·¥ä½œã€‚</p>
</li>
</ol>
<h3 id="é…ç½®Polybar"><a href="#é…ç½®Polybar" class="headerlink" title="é…ç½®Polybar"></a>é…ç½®Polybar</h3><p>æˆ‘åŸºæœ¬ä¸Šä½¿ç”¨çš„æ˜¯é»˜è®¤çš„Baré…ç½®æ–‡ä»¶ï¼Œè¿˜æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<ol>
<li><p>å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„æ¨¡æ¿åˆ°å®¶ç›®å½•çš„æ–‡ä»¶å¤¹ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /usr/share/doc/ploybar/config .config/polybar/config</code></pre>
</li>
<li><p>ç¼–è¾‘ä¸€ä¸ªå¯åŠ¨è„šæœ¬</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> polybar_startup.sh</code></pre>
</li>
<li><p>å†™å…¥å¦‚ä¸‹å†…å®¹</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">## kill all old process of ploybar</span>
<span class="token function">killall</span> <span class="token parameter variable">-q</span> polybar
<span class="token keyword">while</span> pgrep <span class="token parameter variable">-u</span> <span class="token environment constant">$UID</span> <span class="token parameter variable">-x</span> polybar <span class="token operator">></span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">sleep</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">"---"</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /tmp/polybar.log
polybar example <span class="token operator">&amp;</span> /tmp/polybar.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Polybar launched"</span></code></pre>

<p>ç»“åˆä¸Šé¢çš„<strong>i3é…ç½®è¿›è¡Œå¼€æœºè‡ªåŠ¨è¿è¡Œ</strong>å³å¯ã€‚æˆ‘è§‰å¾—é»˜è®¤çš„è¿™ä¸ªè¿˜è¡Œï¼Œå¯ä»¥æ—¥å¸¸ä½¿ç”¨äº†ï¼Œä¸è°ƒæ•´äº†ï¼Œå¤ªè´¹åŠ²äº†ã€‚</p>
</li>
</ol>
<h1 id="ç›®å‰è¿˜æœªè§£å†³çš„é—®é¢˜"><a href="#ç›®å‰è¿˜æœªè§£å†³çš„é—®é¢˜" class="headerlink" title="ç›®å‰è¿˜æœªè§£å†³çš„é—®é¢˜"></a>ç›®å‰è¿˜æœªè§£å†³çš„é—®é¢˜</h1><h2 id="æ— æ³•åœ¨terminalä¸­è¾“å…¥ä¸­æ–‡"><a href="#æ— æ³•åœ¨terminalä¸­è¾“å…¥ä¸­æ–‡" class="headerlink" title="æ— æ³•åœ¨terminalä¸­è¾“å…¥ä¸­æ–‡"></a>æ— æ³•åœ¨terminalä¸­è¾“å…¥ä¸­æ–‡</h2><p>ç›®å‰ä¸­æ–‡çš„è¾“å…¥æ³•è¿˜æ˜¯æœ‰äº›é—®é¢˜ï¼Œ<strong>æ— æ³•åœ¨alacrittyä¸­è¾“å…¥ä¸­æ–‡</strong>ï¼Œå¯èƒ½å’Œibusçš„å…³ç³»æ¯”è¾ƒå¤§ï¼Œæˆ‘å°è¯•ä½¿ç”¨fctixå®Œå…¨æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ‰€æœ‰çš„åœ°æ–¹éƒ½å¯ä»¥è¾“å…¥ä¸­æ–‡ï¼Œæ‰€ä»¥é€‰æ‹©ä»€ä¹ˆæ–¹å¼è¾“å…¥ä¸­æ–‡ï¼Œå„æœ‰æ‰€å¥½å§ã€‚ä½†æ˜¯ï¼ŒGnomeç¯å¢ƒå’Œi3çš„ç¯å¢ƒæ˜¯ä¼šå†²çªçš„ï¼Œæ‰€ä»¥åŒæ—¶å®‰è£…ibuså’Œfcitxè¦è€ƒè™‘ä¸€ä¸‹ã€‚</p>
<hr>
<p>Alacrittyä¸­æ— æ³•è¾“å…¥ä¸­æ–‡çš„é—®é¢˜å·²ç»è§£å†³äº†ï¼</p>
<blockquote>
<p>é‚£ä¹ˆè§£å†³çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>â€‹	åœ¨&#x2F;etc&#x2F;profileæ–‡ä»¶ä¸­ï¼ˆæˆ–è€….zshrcä¸­ï¼‰ï¼Œæ·»åŠ å¦‚ä¸‹çš„ç¯å¢ƒå˜é‡</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GTK_IM_MODULE</span><span class="token operator">=</span>ibus
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">XMODIFIERS</span></span><span class="token operator">=</span>@im<span class="token operator">=</span>ibus
<span class="token builtin class-name">export</span> <span class="token assign-left variable">QT_IM_MODULES</span><span class="token operator">=</span>ibus</code></pre>

<p>ä¹‹å ï¼Œ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/profile
<span class="token builtin class-name">source</span> ~/.zshrc </code></pre>

<p>é‡æ–°å¯åŠ¨alacrittyå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p>æˆ‘æƒ³root causeæ˜¯ï¼šæˆ‘çš„alacrittyå¯åŠ¨çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯zshrcçš„å˜é‡ï¼Œè€Œæ²¡æœ‰è¯»å–ç³»ç»Ÿçš„å˜é‡ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œä½†æ˜¯ç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼Œå®Œç¾ã€‚</p>
</blockquote>
<hr>
<h2 id="SSHä¹‹åä¸èƒ½æ­£ç¡®çš„è¯†åˆ«Alacrittyçš„ç»ˆç«¯ç±»å‹"><a href="#SSHä¹‹åä¸èƒ½æ­£ç¡®çš„è¯†åˆ«Alacrittyçš„ç»ˆç«¯ç±»å‹" class="headerlink" title="SSHä¹‹åä¸èƒ½æ­£ç¡®çš„è¯†åˆ«Alacrittyçš„ç»ˆç«¯ç±»å‹"></a>SSHä¹‹åä¸èƒ½æ­£ç¡®çš„è¯†åˆ«Alacrittyçš„ç»ˆç«¯ç±»å‹</h2><p>sshç™»å½•å…¶ä»–æœºå™¨çš„æ—¶å€™ä¼šæŠ¥é”™ï¼š <strong>Error opening terminal: alacritty.</strong></p>
<blockquote>
<p>è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯å› ä¸ºAlacrittyæ¯•ç«Ÿæ˜¯å°ä¼—çš„Terminal Emulatorï¼Œ æ‰€ä»¥ å¤§éƒ¨åˆ†çš„æœºå™¨é‡Œé¢å¹¶æ²¡æœ‰è¿™ä¸ªç±»å‹çš„ç»ˆç«¯çš„ä¿¡æ¯ï¼Œ SSHåœ¨ç™»å½•ä¹‹åä¼šè¯•å›¾æŠŠç™»å½•ç”¨æˆ·çš„Terminalè®¾ç½®ä¸ºAlacrittyï¼Œè¿™ä¸ªé—®é¢˜å…¶å®é…ç½®æ–‡ä»¶ä¸­å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œç›´æ¥æ³¨é‡Šé…ç½®æ–‡ä»¶çš„å¦‚ä¸‹éƒ¨åˆ†ï¼Œå°±å¯ä»¥æ¢å¤SSHæ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<pre class="language-YAML" data-language="YAML"><code class="language-YAML">env:
    TERM: xterm-256color</code></pre>

<p>è§£å†³~</p>
</blockquote>
<h1 id="æ”¾å‡ å¼ æœ€åçš„ç»“æœå›¾"><a href="#æ”¾å‡ å¼ æœ€åçš„ç»“æœå›¾" class="headerlink" title="æ”¾å‡ å¼ æœ€åçš„ç»“æœå›¾"></a>æ”¾å‡ å¼ æœ€åçš„ç»“æœå›¾</h1><p>å¤§çº¦å°±æ˜¯è¿™ä¸ªæ ·å­å•¦ï½ã€€ã€€æ”¶å·¥ï¼</p>
<hr>
<p><img src="https://i.loli.net/2019/10/22/rl7UziNqj1dwuLf.png" alt="screenshot_002.png"><br><img src="https://i.loli.net/2019/10/22/HzgEw4v81hlqxSp.png" alt="screenshot_001.png"><br><img src="https://i.loli.net/2019/10/22/xR4gi9FpCoN2qhl.png" alt="screenshot.png"></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux_Cobbleræ­å»ºæœ¬åœ°YUMæºåŒæ­¥k8sé˜¿é‡Œäº‘</title>
    <url>/2019/09/30/Linux/Linux_Cobbler-k8s-reposync/</url>
    <content><![CDATA[<p>æ˜¨å¤©æ™šä¸Šå°è¯•ä½¿ç”¨é˜¿é‡Œäº‘çš„æ—¶å€™å‡ºç°é—®é¢˜ ï¼Œé˜¿é‡Œäº‘çš„k8sæºå®‰è£…çš„æ—¶å€™æŠ¥é”™ï¼Œæ— æ³•æ­£å¸¸é€šè¿‡yumå®‰è£…ã€‚å†…ç½‘æ­£å¥½æ”¾äº†ä¸€å°Cobblerï¼Œæ‰€ä»¥ç›´æ¥ä»CobbleråŒæ­¥é˜¿é‡Œçš„repoè¿‡æ¥æ”¾åˆ°å†…ç½‘ï¼Œé˜²æ­¢è¿™ä¸ªäº‹æƒ…å†æ¬¡å‘ç”Ÿã€‚</p>
<h1 id="Cobbleræ˜¯ä»€ä¹ˆ"><a href="#Cobbleræ˜¯ä»€ä¹ˆ" class="headerlink" title="Cobbleræ˜¯ä»€ä¹ˆ"></a>Cobbleræ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>Cobbleræ˜¯ä¸€ä¸ªå…è´¹å¼€æºç³»ç»Ÿå®‰è£…éƒ¨ç½²è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç½‘ç»œå®‰è£…æ“ä½œç³»ç»Ÿã€‚ Cobbler é›†æˆäº† DNS, DHCP,[1][2]è½¯ä»¶åŒ…æ›´æ–°ï¼Œ å¸¦å¤–ç®¡ç†ä»¥åŠé…ç½®ç®¡ç†ï¼Œ æ–¹ä¾¿æ“ä½œç³»ç»Ÿå®‰è£…è‡ªåŠ¨åŒ–ã€‚Cobbler å¯ä»¥æ”¯æŒPXEå¯åŠ¨, æ“ä½œç³»ç»Ÿé‡æ–°å®‰è£…, ä»¥åŠè™šæ‹ŸåŒ–å®¢æˆ·æœºåˆ›å»ºï¼ŒåŒ…æ‹¬Xen, KVM or VMware. Cobbleré€è¿‡koanç¨‹åºä»¥æ”¯æŒè™šæ‹ŸåŒ–å®¢æˆ·æœºå®‰è£…ã€‚Cobbler å¯ä»¥æ”¯æŒç®¡ç†å¤æ‚ç½‘è·¯ç¯å¢ƒï¼Œå¦‚åˆ›å»ºåœ¨é“¾è·¯èšåˆä»¥å¤ªç½‘çš„æ¡¥æ¥ç¯å¢ƒã€‚ <a href="https://en.wikipedia.org/wiki/Cobbler_(software)">FROM Wikipedia</a></p>
</blockquote>
<h1 id="Cobbler-Repoçš„å»ºç«‹"><a href="#Cobbler-Repoçš„å»ºç«‹" class="headerlink" title="Cobbler Repoçš„å»ºç«‹"></a>Cobbler Repoçš„å»ºç«‹</h1><p>k8sçš„æºï¼ŒCobblerç›´æ¥å»ºç«‹çš„åŒæ­¥ä¸å¯ä»¥æ˜¯å› ä¸ºk8sçš„ç›®å½•ç»“æ„å’Œä¸€èˆ¬è½¯ä»¶æºçš„ç»“æ„ä¸åŒã€‚ï¼ˆå¼€å§‹ä»¥ä¸ºé˜¿é‡Œäº‘ä¼šä¸€ç›´ä¿æŒå¸¦æœ‰Poolæ–‡ä»¶å¤¹çš„é‚£ä¸ªç»“æ„ï¼Œ ä»Šå¤©æ—©ä¸Šçœ‹åˆ°ç»“æ„å·²ç»å’Œæ™®é€šçš„yumrepoä¸€æ ·äº†ï¼Œè®°å½•ä¸€ä¸‹å‡ºç°è¿™ç§é—®é¢˜æ€ä¹ˆåŠå¥½äº†ã€‚ï¼‰å…¶å®è§£å†³çš„æ–¹æ¡ˆå°±æ˜¯æ‰‹åŠ¨åŒæ­¥ï¼Œä½¿ç”¨Cobblerè¿›è¡Œæºçš„å‘å¸ƒã€‚å…¶å®ä¹Ÿå°±æ˜¯httpdå‘å¸ƒå‡ºå»ã€‚</p>
<hr>
<h2 id="å»ºç«‹é˜¿é‡Œäº‘çš„æº"><a href="#å»ºç«‹é˜¿é‡Œäº‘çš„æº" class="headerlink" title="å»ºç«‹é˜¿é‡Œäº‘çš„æº"></a>å»ºç«‹é˜¿é‡Œäº‘çš„æº</h2><pre class="language-none"><code class="language-none">[root@cobbler &#x2F;]# cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo
[kubernetes]
name&#x3D;Kubernetes
baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64&#x2F;
enabled&#x3D;1
gpgcheck&#x3D;1
repo_gpgcheck&#x3D;1
gpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg
EOF
[root@cobbler &#x2F;]# mv kubernetes.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo
[root@cobbler &#x2F;]# yum clean all
[root@cobbler &#x2F;]# yum makecache
[root@cobbler &#x2F;]# yum repolist
# åœ¨repolistä¸­è®°å½•repoid</code></pre>
<h2 id="æ‰‹åŠ¨åŒæ­¥æº"><a href="#æ‰‹åŠ¨åŒæ­¥æº" class="headerlink" title="æ‰‹åŠ¨åŒæ­¥æº"></a>æ‰‹åŠ¨åŒæ­¥æº</h2><pre class="language-none"><code class="language-none">[root@cobbler &#x2F;]# reposync -n --repoid&#x3D;kubernetes -p &#x2F;var&#x2F;www&#x2F;cobbler&#x2F;repo_mirror&#x2F; --allow-path-traversal</code></pre>
<h2 id="æ‰‹åŠ¨å°†å·²ç»åŒæ­¥å¥½çš„ç›®å½•åˆ›å»ºä¸ºrepo"><a href="#æ‰‹åŠ¨å°†å·²ç»åŒæ­¥å¥½çš„ç›®å½•åˆ›å»ºä¸ºrepo" class="headerlink" title="æ‰‹åŠ¨å°†å·²ç»åŒæ­¥å¥½çš„ç›®å½•åˆ›å»ºä¸ºrepo"></a>æ‰‹åŠ¨å°†å·²ç»åŒæ­¥å¥½çš„ç›®å½•åˆ›å»ºä¸ºrepo</h2><pre class="language-none"><code class="language-none">[root@cobbler &#x2F;]# createrepo &#x2F;var&#x2F;www&#x2F;cobbler&#x2F;repo_mirror&#x2F;kubernetes&#x2F;</code></pre>
<p>æœ€åç¼–è¾‘ä¸€ä¸‹è‡ªå·±çš„kubernetes.repoæºæ–‡ä»¶ï¼ŒåªæŒ‡å‘æœ¬åœ°çš„æºå°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Repo, Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>DockeråŸºç¡€çŸ¥è¯†äºŒå‘¨ç›®</title>
    <url>/2021/09/04/Linux/Linux_Docker-again/</url>
    <content><![CDATA[<p>Docker Container åŸºç¡€ ã€‚ again â€¦.. </p>
<h2 id="Dockerä½¿ç”¨çš„å…­ä¸ªåç§°ç©ºé—´"><a href="#Dockerä½¿ç”¨çš„å…­ä¸ªåç§°ç©ºé—´" class="headerlink" title="Dockerä½¿ç”¨çš„å…­ä¸ªåç§°ç©ºé—´"></a>Dockerä½¿ç”¨çš„å…­ä¸ªåç§°ç©ºé—´</h2><ol>
<li>MNT Namespace - æä¾›æ–‡ä»¶çš„æŒ‚è½½å’Œæ–‡ä»¶ç³»ç»Ÿçš„éš”ç¦»</li>
<li>IPC Namespace - æä¾›è¿›ç¨‹é—´é€šä¿¡</li>
<li>UTS Namespace - æä¾›ä¸»æœºåéš”ç¦»</li>
<li>PID Namespace - æä¾›è¿›ç¨‹ä»¥åŠè¿›ç¨‹å·éš”ç¦»</li>
<li>Net Namespace - æä¾›ç½‘ç»œéš”ç¦»</li>
<li>User Namespace - æä¾›ç”¨æˆ·ä»¥åŠç”¨æˆ·idçš„éš”ç¦»</li>
</ol>
<h2 id="å®¹å™¨çš„è¿›ç¨‹IDå…³ç³»"><a href="#å®¹å™¨çš„è¿›ç¨‹IDå…³ç³»" class="headerlink" title="å®¹å™¨çš„è¿›ç¨‹IDå…³ç³»"></a>å®¹å™¨çš„è¿›ç¨‹IDå…³ç³»</h2><pre class="language-bash" data-language="bash"><code class="language-bash">Host -------------------------------- <span class="token operator">|</span> container ------------------------<span class="token operator">|</span>
systemd -- containerd -- container-shim -- <span class="token operator">|</span> nginx-master -- nginx-worker
               <span class="token variable"><span class="token variable">`</span>      -- container-shim -- <span class="token operator">|</span> nginx-master -- nginx-worker
               <span class="token variable">`</span></span>      -- container-shim -- <span class="token operator">|</span> mysql-master -- mysql-worker
           dockerd -- docker-proxy -- <span class="token operator">|</span> docker-proxy
               <span class="token variable"><span class="token variable">`</span>   -- docker-proxy -- <span class="token operator">|</span> docker-proxy
               <span class="token variable">`</span></span>   -- docker-proxy -- <span class="token operator">|</span> docker-proxy</code></pre>

<p>containerdè´Ÿè´£æ§åˆ¶å®¹å™¨çš„è¿›ç¨‹ï¼Œä¸»æœºï¼Œç”¨æˆ·ï¼ŒæŒ‚è½½çš„éš”ç¦»ã€‚<br>dockerd å¯åŠ¨çš„docker-proxyç”¨æ¥ç®¡ç†iptablesè¿›è¡Œç½‘ç»œçš„éš”ç¦»ã€‚<br>docker.service é‡Œé¢æŒ‡å®šäº†è°ƒç”¨Containerdçš„socket<br>ç”Ÿæˆå®¹å™¨çš„è¿‡ç¨‹é’Ÿï¼ŒAPIè°ƒç”¨è¿‡ç¨‹ä½¿ç”¨çš„æ˜¯grpcã€‚<br>æ— è®ºdockerdè¿˜æ˜¯containerdæœ€ç»ˆä½¿ç”¨çš„éƒ½æ˜¯runcï¼ˆcontainer runtimeï¼‰ ï¼Œä¸€ä¸ªåŸºäºGoè¯­è¨€çš„å®¹å™¨åˆ›å»ºå·¥å…·ï¼Œ æ ¹æ®OCIæ ‡å‡†æ¥åˆ›å»ºå®¹å™¨ã€‚</p>
<p>docker-daemon é™åˆ¶å¯ä»¥é™åˆ¶ç”Ÿæˆæ—¥å¿—çš„å¤§å°</p>
<ul>
<li>é™åˆ¶æ—¥å¿—çš„å¤§å°ä½¿ç”¨çš„æ˜¯ dockerçš„daemon configï¼Œ é’ˆå¯¹çš„æ—¥å¿—çš„èŒƒå›´ï¼Œæ˜¯docker Container é‡Œé¢çš„æ ‡å‡†è¾“å…¥è¾“å‡ºçš„æ—¥å¿—ï¼Œ è¿™éƒ¨åˆ†æ—¥å¿—çš„å­˜å‚¨æ˜¯åœ¨æœºå™¨çš„ç¡¬ç›˜ä¸Šï¼Œ ä½ç½®æ˜¯ï¼ˆ&#x2F;opt&#x2F;docker-storage&#x2F;containers ï¼Œ ä¹Ÿå°±æ˜¯&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;[CONTAINER_ID]&#x2F;*.jsonï¼‰ï¼Œ</li>
</ul>
<p> cpu å¤§çº¦å¯ä»¥åˆ†é… 1:4  ï¼Œ memä¸å»ºè®®è¶…è¿‡ç‰©ç†å†…å­˜çš„åˆ†é…</p>
<p>å‹æµ‹é•œåƒï¼š lorel&#x2F;docker-stress-ng </p>
<h2 id="Dockerçš„ç½‘ç»œç»“æ„"><a href="#Dockerçš„ç½‘ç»œç»“æ„" class="headerlink" title="Dockerçš„ç½‘ç»œç»“æ„"></a>Dockerçš„ç½‘ç»œç»“æ„</h2><p>ä½¿ç”¨çš„æ˜¯å®¿ä¸»æœºçš„docker0æ¡¥ï¼ŒåŒæ—¶åœ¨Hostä¸Šé¢ç”Ÿæˆè™šæ‹Ÿç½‘å¡vethå¤šä¸ªæ¥å£ ï¼Œ åœ¨å®¹å™¨ä¸­ç”Ÿæˆeth0çš„è™šæ‹Ÿç½‘å¡å¯¹ï¼Œ è™šæ‹Ÿæœºä¸­çš„ä¸¤ä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„æ˜¯ç‰©ç†åœ°å€è¿›è¡Œå¯»å€è®¿é—®ï¼Œæ‰€ä»¥è¿™ä¸ªéƒ¨åˆ†å¯ä»¥é€šè¿‡arpå‘½ä»¤æ¥è¿›è¡ŒéªŒè¯ã€‚</p>
<h2 id="Dockerå®¹å™¨çš„èµ„æºé™åˆ¶-Cgroup"><a href="#Dockerå®¹å™¨çš„èµ„æºé™åˆ¶-Cgroup" class="headerlink" title="Dockerå®¹å™¨çš„èµ„æºé™åˆ¶ - Cgroup"></a>Dockerå®¹å™¨çš„èµ„æºé™åˆ¶ - Cgroup</h2><p>å¯ä»¥é™åˆ¶ CPUï¼ŒMEMï¼ŒDISKIOï¼ŒNETIO, PRIï¼ŒPAUSE&#x2F;RESUMEã€‚ å¯¹äºKuberneteså¯ä»¥å¯¹é›†ç¾¤çš„Namespaceæ¥è¿›è¡Œé™åˆ¶èµ„æºçš„è§„åˆ’ã€‚</p>
<p>æŸ¥çœ‹å†…æ ¸å¯ä»¥æ”¯æŒçš„cgroup Flag. </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">â”Œâ”€<span class="token punctuation">[</span>hayden@HaydenArchDesktop<span class="token punctuation">]</span> - <span class="token punctuation">[</span>~<span class="token punctuation">]</span> - <span class="token punctuation">[</span>Sun Sep 05, 00:14<span class="token punctuation">]</span>
â””â”€<span class="token punctuation">[</span>$<span class="token punctuation">]</span> <span class="token operator">&lt;></span> zcat /proc/config.gz <span class="token operator">|</span> <span class="token function">grep</span> CGROUP
<span class="token assign-left variable">CONFIG_CGROUPS</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_BLK_CGROUP</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_WRITEBACK</span><span class="token operator">=</span>y 
<span class="token assign-left variable">CONFIG_CGROUP_SCHED</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_PIDS</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_RDMA</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_FREEZER</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_HUGETLB</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_DEVICE</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_CPUACCT</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_PERF</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_BPF</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_MISC</span><span class="token operator">=</span>y
<span class="token comment"># CONFIG_CGROUP_DEBUG is not set</span>
<span class="token assign-left variable">CONFIG_SOCK_CGROUP_DATA</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_BLK_CGROUP_RWSTAT</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_BLK_CGROUP_IOLATENCY</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_BLK_CGROUP_IOCOST</span><span class="token operator">=</span>y
<span class="token comment"># CONFIG_BFQ_CGROUP_DEBUG is not set</span>
<span class="token assign-left variable">CONFIG_NETFILTER_XT_MATCH_CGROUP</span><span class="token operator">=</span>m
<span class="token assign-left variable">CONFIG_NET_CLS_CGROUP</span><span class="token operator">=</span>m
<span class="token assign-left variable">CONFIG_CGROUP_NET_PRIO</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_CGROUP_NET_CLASSID</span><span class="token operator">=</span>y

â”Œâ”€<span class="token punctuation">[</span>hayden@HaydenArchDesktop<span class="token punctuation">]</span> - <span class="token punctuation">[</span>~<span class="token punctuation">]</span> - <span class="token punctuation">[</span>Sun Sep 05, 00:14<span class="token punctuation">]</span>
â””â”€<span class="token punctuation">[</span>$<span class="token punctuation">]</span> <span class="token operator">&lt;></span> zcat /proc/config.gz <span class="token operator">|</span> <span class="token function">grep</span> MEM <span class="token operator">|</span> <span class="token function">grep</span> CG
<span class="token assign-left variable">CONFIG_MEMCG</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_MEMCG_SWAP</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_MEMCG_KMEM</span><span class="token operator">=</span>y</code></pre>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>Kubernetes é™åˆ¶æ˜¯1&#x2F;1000Core ï¼ŒDockeræ˜¯1&#x2F;10Core, åªéœ€è¦é€šè¿‡ â€“cpus é€‰é¡¹æŒ‡å®šå®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU ä¸ªæ•°å°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æŒ‡å®šå¦‚ 1.5 ä¹‹ç±»çš„å°æ•°ã€‚</p>
<p>CPU OverCommit 1:8</p>
<h3 id="MEM"><a href="#MEM" class="headerlink" title="MEM"></a>MEM</h3><p>MEMçš„é™åˆ¶å•ä½æ˜¯Mï¼› åŒæ—¶å¯ä»¥é™åˆ¶Swapçš„ä½¿ç”¨ï¼Œä½†æ˜¯é™åˆ¶Swapçš„ä½¿ç”¨éœ€è¦å†…æ ¸çš„æ”¯æŒï¼Œå¤§éƒ¨åˆ†æ—¶å€™è¿˜æ˜¯ä¼šå…³é—­æ‰SWAPï¼Œ è™½ç„¶é¿å…äº†OOMï¼Œä½†æ˜¯ä¼šå½±å“æœåŠ¡çš„è´¨é‡ã€‚</p>
<p>MEM ä¸å»ºè®®OverCommit</p>
<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ ï¼š åˆ†é…0.5&#x2F;1ä¸ªCPUï¼Œmem 2G&#x2F;4Gï¼› æ ¹æ®ä¸šåŠ¡çš„ä¸åŒï¼Œ ä¸€èˆ¬ä¼šæ˜¯é«˜å¯ç”¨çš„éƒ¨ç½²ï¼Œä¸¤ä¸ªä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼›æ‰€ä»¥ä¼šå¯åŠ¨ä¸¤ä¸ªå®¹å™¨ï¼Œä¸éœ€è¦æä¾›å¤ªé«˜çš„ç¡¬ä»¶ï¼Œç¬¦åˆè¦æ±‚å³å¯ã€‚</p>
</blockquote>
<p>å…³äºOOMçš„é—®é¢˜å’Œå¯ä»¥è°ƒæ•´çš„å‚æ•°(&#x2F;proc&#x2F;[PID]&#x2F;)ï¼š</p>
<ol>
<li>oom_adj å–å€¼èŒƒå›´ -17 to +15 ï¼Œ ä¸ºäº†å…¼å®¹æ—§ç¨‹åºä¿ç•™çš„æ–¹å¼</li>
<li>oom_score ä¸€èˆ¬æ˜¯è‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„ç»“æœï¼Œ<strong>ç»¼åˆè®¡ç®—çš„ç»“æœ, å‚è€ƒ ï¼š CPUæ—¶é—´ï¼Œå­˜æ´»æ—¶é—´ï¼Œoom_adjè®¡ç®—ä¹‹åçš„ç»“æœã€‚</strong></li>
<li>oom_score_adj OOMåˆ†æ•°çš„åç§»é‡ï¼Œ-1000 to +1000, å¯ä»¥è®¾ç½®-1000è¡¨ç¤ºæ°¸è¿œä¸ä¼šè¢«Kill</li>
</ol>
<h3 id="DISKIO"><a href="#DISKIO" class="headerlink" title="DISKIO"></a>DISKIO</h3><p>Disk OverCommit : 1:1.2</p>
<h3 id="PAUSE-RESUME"><a href="#PAUSE-RESUME" class="headerlink" title="PAUSE\RESUME"></a>PAUSE\RESUME</h3>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DockeråŸºæœ¬å‘½ä»¤è¯´æ˜</title>
    <url>/2018/05/28/Linux/Linux_DockerCommands/</url>
    <content><![CDATA[<p>dockeråŸºç¡€å‘½ä»¤çš„è¯´æ˜ã€‚</p>
<span id="more"></span>

<h2 id="Dockerå¸¸ç”¨å‘½ä»¤çš„è¯´æ˜"><a href="#Dockerå¸¸ç”¨å‘½ä»¤çš„è¯´æ˜" class="headerlink" title="Dockerå¸¸ç”¨å‘½ä»¤çš„è¯´æ˜"></a>Dockerå¸¸ç”¨å‘½ä»¤çš„è¯´æ˜</h2><h3 id="Docker-Pull"><a href="#Docker-Pull" class="headerlink" title="Docker Pull"></a>Docker Pull</h3><p>\ ä¸‹è½½ä¸€ä¸ªImage  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker pull nginx:lastest  
Using default tag: latest  
Trying to pull repository docker.io&#x2F;library&#x2F;nginx ...   
sha256:0fb320e2a1b1620b4905facb3447e3d84ad36da0b2c8aa8fe3a5a81d1187b884: Pulling from docker.io&#x2F;library&#x2F;nginx
Digest: sha256:0fb320e2a1b1620b4905facb3447e3d84ad36da0b2c8aa8fe3a5a81d1187b884
Status: Image is up to date for docker.io&#x2F;nginx:latest</code></pre>

<h3 id="Docker-Push"><a href="#Docker-Push" class="headerlink" title="Docker Push"></a>Docker Push</h3><p>\ ä¸Šä¼ ä¸€ä¸ªImage  </p>
<h3 id="Docker-Run"><a href="#Docker-Run" class="headerlink" title="Docker Run"></a>Docker Run</h3><p>\ å¯åŠ¨ä¸€ä¸ªContainer  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker run nginx</code></pre>

<h3 id="Docker-Kill"><a href="#Docker-Kill" class="headerlink" title="Docker Kill"></a>Docker Kill</h3><p>\ ç»“æŸä¸€ä¸ªContainer  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker kill flamboyant_thompson  </code></pre>

<h3 id="Docker-System-Prune"><a href="#Docker-System-Prune" class="headerlink" title="Docker System Prune"></a>Docker System Prune</h3><p>\ æ¸…ç†Dockerçš„æ— ç”¨æ–‡ä»¶,åŒ…æ‹¬æœªä½¿ç”¨çš„å®¹å™¨å’Œä¸å…·æœ‰Danglingçš„é•œåƒ(ä¸å…·æœ‰å¯åŠ¨èƒ½åŠ›çš„Image)  </p>
<h3 id="Docker-Images"><a href="#Docker-Images" class="headerlink" title="Docker Images"></a>Docker Images</h3><p>\ åˆ—å‡ºæ‰€æœ‰çš„docker images</p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker images
ONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                    NAMES
1cca834eb80c        nginx                      &quot;nginx -g &#39;daemon ...&quot;   57 seconds ago      Up 56 seconds       80&#x2F;tcp                   flamboyant_thompson
769aefe85e29        achabill&#x2F;lh-toolkit        &quot;dockerize -wait t...&quot;   3 hours ago         Up 3 hours          0.0.0.0:8080-&gt;8080&#x2F;tcp   sad_payne
93431e5f2f66        achabill&#x2F;lh-mysql:latest   &quot;docker-entrypoint...&quot;   3 hours ago         Up 3 hours          0.0.0.0:3308-&gt;3306&#x2F;tcp   brave_mcclintock</code></pre>

<h3 id="Docker-search"><a href="#Docker-search" class="headerlink" title="Docker search"></a>Docker search</h3><p>\ æœç´¢ç‰¹å®šåç§°çš„image  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker search nginx
INDEX        NAME                                                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
docker.io    docker.io&#x2F;nginx                                                  Official build of Nginx.                        8564      [OK]       
docker.io    docker.io&#x2F;nginx                                                  Official build of Nginx.                        8564      [OK]       
docker.io    docker.io&#x2F;jwilder&#x2F;nginx-proxy                                    Automated Nginx reverse proxy for docker c...   1334                 [OK]
docker.io    docker.io&#x2F;jwilder&#x2F;nginx-proxy                                    Automated Nginx reverse proxy for docker c...   1334                 [OK]
docker.io    docker.io&#x2F;richarvey&#x2F;nginx-php-fpm                                Container running Nginx + PHP-FPM capable ...   547                  [OK]
docker.io    docker.io&#x2F;richarvey&#x2F;nginx-php-fpm                                Container running Nginx + PHP-FPM capable ...   547                  [OK]
docker.io    docker.io&#x2F;jrcs&#x2F;letsencrypt-nginx-proxy-companion                 LetsEncrypt container to use with nginx as...   367                  [OK]
docker.io    docker.io&#x2F;jrcs&#x2F;letsencrypt-nginx-proxy-companion                 LetsEncrypt container to use with nginx as...   367                  [OK]
docker.io    docker.io&#x2F;kong                                                   Open-source Microservice &amp; API Management ...   187       [OK]       
docker.io    docker.io&#x2F;kong                                                   Open-source Microservice &amp; API Management ...   187       [OK]       
docker.io    docker.io&#x2F;webdevops&#x2F;php-nginx                                    Nginx with PHP-FPM                              103                  [OK]
docker.io    docker.io&#x2F;webdevops&#x2F;php-nginx                                    Nginx with PHP-FPM                              103                  [OK]
docker.io    docker.io&#x2F;kitematic&#x2F;hello-world-nginx                            A light-weight nginx container that demons...   98                   
docker.io    docker.io&#x2F;kitematic&#x2F;hello-world-nginx                            A light-weight nginx container that demons...   98                   
docker.io    docker.io&#x2F;bitnami&#x2F;nginx                                          Bitnami nginx Docker Image                      50                   [OK]
docker.io    docker.io&#x2F;bitnami&#x2F;nginx                                          Bitnami nginx Docker Image                      50                   [OK]
docker.io    docker.io&#x2F;zabbix&#x2F;zabbix-web-nginx-mysql                          Zabbix frontend based on Nginx web-server ...   50                   [OK]
docker.io    docker.io&#x2F;zabbix&#x2F;zabbix-web-nginx-mysql                          Zabbix frontend based on Nginx web-server ...   50                   [OK]
docker.io    docker.io&#x2F;1and1internet&#x2F;ubuntu-16-nginx-php-phpmyadmin-mysql-5   ubuntu-16-nginx-php-phpmyadmin-mysql-5          35                   [OK]
docker.io    docker.io&#x2F;1and1internet&#x2F;ubuntu-16-nginx-php-phpmyadmin-mysql-5   ubuntu-16-nginx-php-phpmyadmin-mysql-5          35                   [OK]
docker.io    docker.io&#x2F;linuxserver&#x2F;nginx                                      An Nginx container, brought to you by Linu...   35                   
docker.io    docker.io&#x2F;linuxserver&#x2F;nginx                                      An Nginx container, brought to you by Linu...   35                   
docker.io    docker.io&#x2F;tobi312&#x2F;rpi-nginx                                      NGINX on Raspberry Pi &#x2F; armhf                   19                   [OK]
docker.io    docker.io&#x2F;tobi312&#x2F;rpi-nginx                                      NGINX on Raspberry Pi &#x2F; armhf                   19                   [OK]
docker.io    docker.io&#x2F;nginxdemos&#x2F;nginx-ingress                               NGINX Ingress Controller for Kubernetes . ...   11                   
docker.io    docker.io&#x2F;nginxdemos&#x2F;nginx-ingress                               NGINX Ingress Controller for Kubernetes . ...   11                   
docker.io    docker.io&#x2F;blacklabelops&#x2F;nginx                                    Dockerized Nginx Reverse Proxy Server.          9                    [OK]
docker.io    docker.io&#x2F;blacklabelops&#x2F;nginx                                    Dockerized Nginx Reverse Proxy Server.          9                    [OK]
docker.io    docker.io&#x2F;wodby&#x2F;drupal-nginx                                     Nginx for Drupal container image                9                    [OK]
docker.io    docker.io&#x2F;wodby&#x2F;drupal-nginx                                     Nginx for Drupal container image                9                    [OK]
docker.io    docker.io&#x2F;webdevops&#x2F;nginx                                        Nginx container                                 8                    [OK]
docker.io    docker.io&#x2F;webdevops&#x2F;nginx                                        Nginx container                                 8                    [OK]
docker.io    docker.io&#x2F;centos&#x2F;nginx-18-centos7                                Platform for running nginx 1.8 or building...   6                    
docker.io    docker.io&#x2F;centos&#x2F;nginx-18-centos7                                Platform for running nginx 1.8 or building...   6                    
docker.io    docker.io&#x2F;nginxdemos&#x2F;hello                                       NGINX webserver that serves a simple page ...   6                    [OK]
docker.io    docker.io&#x2F;nginxdemos&#x2F;hello                                       NGINX webserver that serves a simple page ...   6                    [OK]
docker.io    docker.io&#x2F;1science&#x2F;nginx                                         Nginx Docker images that include Consul Te...   4                    [OK]
docker.io    docker.io&#x2F;1science&#x2F;nginx                                         Nginx Docker images that include Consul Te...   4                    [OK]
docker.io    docker.io&#x2F;centos&#x2F;nginx-112-centos7                               Platform for running nginx 1.12 or buildin...   3                    
docker.io    docker.io&#x2F;behance&#x2F;docker-nginx                                   Provides base OS, patches and stable nginx...   2                    [OK]
docker.io    docker.io&#x2F;behance&#x2F;docker-nginx                                   Provides base OS, patches and stable nginx...   2                    [OK]
docker.io    docker.io&#x2F;pebbletech&#x2F;nginx-proxy                                 nginx-proxy sets up a container running ng...   2                    [OK]
docker.io    docker.io&#x2F;pebbletech&#x2F;nginx-proxy                                 nginx-proxy sets up a container running ng...   2                    [OK]
docker.io    docker.io&#x2F;toccoag&#x2F;openshift-nginx                                Nginx reverse proxy for Nice running on sa...   1                    [OK]
docker.io    docker.io&#x2F;toccoag&#x2F;openshift-nginx                                Nginx reverse proxy for Nice running on sa...   1                    [OK]
docker.io    docker.io&#x2F;travix&#x2F;nginx                                           NGinx reverse proxy                             1                    [OK]
docker.io    docker.io&#x2F;travix&#x2F;nginx                                           NGinx reverse proxy                             1                    [OK]
docker.io    docker.io&#x2F;ansibleplaybookbundle&#x2F;nginx-apb                        An APB to deploy NGINX                          0                    [OK]
docker.io    docker.io&#x2F;mailu&#x2F;nginx                                            Mailu nginx frontend                            0                    [OK]
docker.io    docker.io&#x2F;mailu&#x2F;nginx                                            Mailu nginx frontend                            0                    [OK]
redhat.com   registry.access.redhat.com&#x2F;3scale-amp20-beta&#x2F;apicast-gateway     3scale&#39;s API gateway (APIcast) is an OpenR...   0                    
redhat.com   registry.access.redhat.com&#x2F;3scale-amp20&#x2F;apicast-gateway          3scale&#39;s API gateway (APIcast) is an OpenR...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhamp10&#x2F;apicast-gateway               3scale&#39;s API gateway (APIcast) is an OpenR...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhmap43&#x2F;wildcard-proxy                RHMAP Docker image that provides mapping a...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhmap44&#x2F;wildcard-proxy                RHMAP Docker image that provides mapping a...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhmap45&#x2F;wildcard-proxy                RHMAP image that provides mapping and prox...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhmap46&#x2F;wildcard-proxy                RHMAP image that provides mapping and prox...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhscl&#x2F;nginx-110-rhel7                 Nginx container image that delivers an ngi...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhscl&#x2F;nginx-112-rhel7                 Nginx is a web server and a reverse proxy ...   0                    
redhat.com   registry.access.redhat.com&#x2F;rhscl&#x2F;nginx-16-rhel7                  Nginx 1.6 server and a reverse proxy server     0                    
redhat.com   registry.access.redhat.com&#x2F;rhscl&#x2F;nginx-18-rhel7                  Nginx 1.8 server and a reverse proxy server     0                    </code></pre>

<h3 id="Docker-Ps"><a href="#Docker-Ps" class="headerlink" title="Docker Ps"></a>Docker Ps</h3><p>\ åˆ—å‡ºdockeræ­£åœ¨è¿è¡Œçš„Container  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker ps 
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                    NAMES
1cca834eb80c        nginx                      &quot;nginx -g &#39;daemon ...&quot;   57 seconds ago      Up 56 seconds       80&#x2F;tcp                   flamboyant_thompson
769aefe85e29        achabill&#x2F;lh-toolkit        &quot;dockerize -wait t...&quot;   3 hours ago         Up 3 hours          0.0.0.0:8080-&gt;8080&#x2F;tcp   sad_payne
93431e5f2f66        achabill&#x2F;lh-mysql:latest   &quot;docker-entrypoint...&quot;   3 hours ago         Up 3 hours          0.0.0.0:3308-&gt;3306&#x2F;tcp   brave_mcclintock</code></pre>

<h3 id="Docker-Container-Ls"><a href="#Docker-Container-Ls" class="headerlink" title="Docker Container Ls"></a>Docker Container Ls</h3><p>\ åˆ—å‡ºæ‰€æœ‰å­˜åœ¨çš„Container,åŒ…æ‹¬ä¸ºè¿è¡Œçš„å’Œæœªä½¿ç”¨çš„  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker container ls
CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                    NAMES
1cca834eb80c        nginx                      &quot;nginx -g &#39;daemon ...&quot;   57 seconds ago      Up 56 seconds       80&#x2F;tcp                   flamboyant_thompson
769aefe85e29        achabill&#x2F;lh-toolkit        &quot;dockerize -wait t...&quot;   3 hours ago         Up 3 hours          0.0.0.0:8080-&gt;8080&#x2F;tcp   sad_payne
93431e5f2f66        achabill&#x2F;lh-mysql:latest   &quot;docker-entrypoint...&quot;   3 hours ago         Up 3 hours          0.0.0.0:3308-&gt;3306&#x2F;tcp   brave_mcclintock</code></pre>

<h3 id="Docker-Run-dt"><a href="#Docker-Run-dt" class="headerlink" title="Docker Run -dt"></a>Docker Run -dt</h3><p>\ è¿è¡Œä¸€ä¸ªimage,ç»™äºˆä¸€ä¸ªTerminal,æ”¾å…¥åå°,è¿”å›ä¸€ä¸ªContainerID  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker run -dt -p 80:80 nginx
1cca834eb80cd8467dec6d103bf9072adfb55d8cfb2fdc257af548dc25917868</code></pre>

<h3 id="Docker-Run-it"><a href="#Docker-Run-it" class="headerlink" title="Docker Run -it"></a>Docker Run -it</h3><p>\ è¿è¡Œä¸€ä¸ªimage,ç»™äºˆä¸€ä¸ªTerminal,ç›´æ¥è¿›å…¥Container  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker run -it -p 80:80 nginx</code></pre>

<h3 id="Docker-Run-1"><a href="#Docker-Run-1" class="headerlink" title="Docker Run"></a>Docker Run</h3><p>\ è¿è¡Œä¸€ä¸ªimage,å¦‚æœæœ¬åœ°æ²¡æœ‰è‡ªåŠ¨åˆ°dockerä»“åº“æ£€ç´¢  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker run nginx</code></pre>

<h3 id="Docker-Run-p"><a href="#Docker-Run-p" class="headerlink" title="Docker Run -p"></a>Docker Run -p</h3><p>\ è¿è¡Œä¸€ä¸ªimage,æŒ‡å®športçš„æ˜ å°„å…³ç³»  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker run -p 80:80 nginx </code></pre>

<h3 id="Docker-Attach"><a href="#Docker-Attach" class="headerlink" title="Docker Attach"></a>Docker Attach</h3><p>\ è¿›å…¥åˆ°æŸä¸€ä¸ªContainerå†…éƒ¨,å¦‚æœæ²¡æœ‰shell,æ— æ³•æ“ä½œ, è¾“å‡ºä¸€ç‰‡ç©ºç™½  </p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# docker attach flamboyant_thompson
[root@d4a75f165ce6 &#x2F;]#</code></pre>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DockerFileç¬”è®°</title>
    <url>/2019/04/24/Linux/Linux_DockerFile-Note/</url>
    <content><![CDATA[<p>Dockerfileçš„ä¹¦å†™è§„åˆ™åŠDockerfileçš„æŒ‡ä»¤è¯´æ˜ã€‚</p>
<p>Dockerçš„é•œåƒå­˜å‚¨åˆ°Overlay2  </p>
<pre class="language-none"><code class="language-none">Docker images ls
    # æŸ¥çœ‹æ‰€æœ‰çš„Docker Images  
Docker exec -it Container_Name &#x2F;bin&#x2F;sh  
    # å°†å®¹å™¨å¯åŠ¨å¹¶æ‰§è¡Œshellå‘½ä»¤è¡Œ  </code></pre>

<h1 id="Docker-Images"><a href="#Docker-Images" class="headerlink" title="Docker Images"></a>Docker Images</h1><ol>
<li>Docker Imagesä¸­æœ‰å¯åŠ¨å®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶ç³»ç»ŸåŠå†…å®¹ï¼Œç”¨äºå¯åŠ¨å¹¶åˆ›å»ºDockerå®¹å™¨,é‡‡ç”¨åˆ†å±‚æœºåˆ¶ï¼Œæœ€åº•å±‚ä¸ºbootfsï¼Œä¹‹ä¸Šæ˜¯rootfs  <ul>
<li>rootfs:Dockerçš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œç”±KernelæŒ‚è½½ä¸ºâ€œReadOnlyâ€æ¨¡å¼ï¼Œè€Œåé€šè¿‡è”åˆæŒ‚è½½æŠ€æœ¯é¢å¤–æŒ‚åœ¨ä¸€ä¸ªå¯å†™å±‚ </li>
<li>bootfs:ç”¨äºç³»ç»Ÿå¼•å¯¼çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬bootloaderåŠkernelï¼Œå®¹å™¨å¯åŠ¨ä¹‹åè‡ªåŠ¨å¸è½½</li>
</ul>
</li>
<li>Docker Images Layerä¸‹å±‚çš„é•œåƒç§°ä¸ºçˆ¶é•œåƒï¼Œæœ€åº•å±‚çš„å«åšBase Images  </li>
<li>Aufs - Advanced multi-layered unification filesystem  </li>
<li>Overlayfs - 3.18ç‰ˆæœ¬è¢«åˆå¹¶åˆ°Linuxå†…æ ¸   </li>
<li>Dockerçš„åˆ†å±‚é•œåƒï¼Œé™¤äº†Aufsï¼Œè¿˜æ”¯æŒbtrfsï¼Œdevicemapperå’Œvfs  </li>
<li>Docker Registry - Docker daemonè‡ªåŠ¨è§†å›¾ä»DockerHubæ‹‰å–é•œåƒæ–‡ä»¶  </li>
<li>Docker Registryçš„åˆ†ç±» <ul>
<li>Sponsor Registryï¼šç¬¬ä¸‰æ–¹ï¼Œæä¾›ç»™å®¢æˆ·æˆ–Dockerç¤¾åŒº  </li>
<li>Mirror Registryï¼šç¬¬ä¸‰æ–¹ï¼Œåªç»™å®¢æˆ·ä½¿ç”¨ </li>
<li>Vendor Registryï¼šç”±å‘å¸ƒDockeré•œåƒçš„ä¾›åº”å•†æä¾›  </li>
<li>Private Regisryï¼šé€šè¿‡è®¾æœ‰é˜²ç«å¢™åŠé¢å¤–çš„å®‰å…¨å±‚çš„ç§æœ‰å®ä½“æä¾›</li>
</ul>
</li>
<li>äº‘åŸç”Ÿ - é¢å‘äº‘ç¯å¢ƒçš„è¿è¡Œäº†äº‘ç³»ç»Ÿæœ¬èº«çš„è°ƒç”¨çš„ç¨‹åºã€‚é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®  </li>
<li>Webhooks - è‡ªåŠ¨åˆ›å»ºé•œåƒ  </li>
<li>Quay.io é™¤äº†DockerHubå…¶ä»–çš„é•œåƒä»“åº“  <ul>
<li>docker pull quay.io&#x2F;coreos&#x2F;flannel:latest</li>
</ul>
</li>
</ol>
<h2 id="Dockeré•œåƒçš„ä¿å­˜ä¸æ¢å¤"><a href="#Dockeré•œåƒçš„ä¿å­˜ä¸æ¢å¤" class="headerlink" title="Dockeré•œåƒçš„ä¿å­˜ä¸æ¢å¤"></a>Dockeré•œåƒçš„ä¿å­˜ä¸æ¢å¤</h2><pre class="language-none"><code class="language-none">docker save -o myimages.gz IMAGE_NAME1 IMAGE_NAME2 
    # å°†å¤šä¸ªé•œåƒä¿å­˜åˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶  
scp myimages.gz 
    # ä¼ è¾“é•œåƒåˆ°å…¶ä»–èŠ‚ç‚¹  
docker load -i myimages.gz  
    # åœ¨æ–°çš„èŠ‚ç‚¹åŠ è½½é•œåƒ  </code></pre>
<h1 id="Docker-File"><a href="#Docker-File" class="headerlink" title="Docker File"></a>Docker File</h1><h2 id="DockerFileå­˜åœ¨çš„æ„ä¹‰"><a href="#DockerFileå­˜åœ¨çš„æ„ä¹‰" class="headerlink" title="DockerFileå­˜åœ¨çš„æ„ä¹‰"></a>DockerFileå­˜åœ¨çš„æ„ä¹‰</h2><p>docker exec CONTAINER â€“&gt; vi â€“&gt; RELOAD<br>Dockerçš„å®¹å™¨ä¸åˆ©äºæˆ‘ä»¬å¯¹éœ€è¦åå¤è°ƒè¯•çš„æœåŠ¡è¿›è¡Œæ›´æ”¹ï¼Œé€šè¿‡Dockerfileçš„ä¿®æ”¹å¯å¿«é€Ÿè°ƒæ•´å®¹å™¨çš„é…ç½®ã€‚</p>
<h2 id="è‡ªå®šä¹‰é•œåƒçš„æ–¹æ³•"><a href="#è‡ªå®šä¹‰é•œåƒçš„æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰é•œåƒçš„æ–¹æ³•"></a>è‡ªå®šä¹‰é•œåƒçš„æ–¹æ³•</h2><h3 id="åŸºäºDockerå®¹å™¨åˆ¶ä½œé•œåƒ"><a href="#åŸºäºDockerå®¹å™¨åˆ¶ä½œé•œåƒ" class="headerlink" title="åŸºäºDockerå®¹å™¨åˆ¶ä½œé•œåƒ"></a>åŸºäºDockerå®¹å™¨åˆ¶ä½œé•œåƒ</h3><ol>
<li>åˆ›å»ºä½ éœ€è¦çš„å®¹å™¨ï¼ŒDocker commitå‘½ä»¤è¿›è¡Œé•œåƒçš„åˆ¶ä½œ </li>
<li>docker run â€“name b1 -it busybox  </li>
<li>mkdir -p &#x2F;data&#x2F;html  </li>
<li>vi &#x2F;data&#x2F;html&#x2F;index.html  </li>
<li>docker commit -p b1 </li>
<li>docker tag IMAGE_ID REPOSITORY:TAG  </li>
<li>docker image ls  </li>
<li>docker image rm IMAGE_TAG</li>
<li>docker imspect â€“ cmdå­—æ®µè‡ªåŠ¨æ ‡å¿—å¯åŠ¨è‡ªåŠ¨è¿è¡Œçš„å‘½ä»¤  </li>
<li>æ›´æ”¹dockerçš„é»˜è®¤è¿è¡Œå‘½ä»¤  </li>
<li>docker commit -p -a â€˜Liarleeâ€™ -c â€˜CMD [â€œ&#x2F;bin&#x2F;httpdâ€,â€-fâ€,â€-hâ€,â€&#x2F;data&#x2F;htmlâ€]â€™ b1 hayden&#x2F;httpd:v0.2 </li>
<li>docker login -u USERNAME ç™»å½•åˆ°æœåŠ¡å™¨  </li>
<li>docker push Liarlee&#x2F;httpd</li>
</ol>
<h3 id="åŸºäºDockerFileåˆ¶ä½œDockerImage"><a href="#åŸºäºDockerFileåˆ¶ä½œDockerImage" class="headerlink" title="åŸºäºDockerFileåˆ¶ä½œDockerImage"></a>åŸºäºDockerFileåˆ¶ä½œDockerImage</h3><p>Dockerfile Format  </p>
<ol>
<li># å¼€å¤´çš„ä¸ºæ³¨é‡Šæ–‡å­—   </li>
<li>INSTRUCTION argumentsï¼Œé‡‡ç”¨æŒ‡ä»¤+å‚æ•°çš„æ ¼å¼   </li>
<li>Dockerfileæ‰§è¡Œçš„æ—¶å€™æ˜¯ä»ä¸Šè‡³ä¸‹æ‰§è¡Œçš„  </li>
<li>ç¬¬ä¸€ä¸ªéæ³¨é‡Šè¡Œå¿…é¡»æ˜¯FROMæŒ‡ä»¤</li>
</ol>
<p>.dockerignoreæ–‡ä»¶è·¯å¾„è®°å½•ï¼Œå¯ä»¥é€šé…ï¼Œæ‰“åŒ…æ—¶å¿½ç•¥listä¸­çš„æ–‡ä»¶<br>å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢<br>BASH SHELL:<br>echo ${NAME:-tom} ç»™ä¸€ä¸ªå˜é‡è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼<br>echo ${NAME:+tom} å¦‚æœå˜é‡æœ‰æ•°å€¼ï¼Œå¼ºè¡Œæ”¹ä¸ºé»˜è®¤å€¼   </p>
<h3 id="FROM"><a href="#FROM" class="headerlink" title="- FROM"></a>- FROM</h3><p>FROMæŒ‡å®šçš„é•œåƒå°†è‡ªåŠ¨æ‹‰å–ä½œä¸ºåº•å±‚çš„é•œåƒè¿›è¡Œåˆ¶ä½œ;  </p>
<pre class="language-none"><code class="language-none">FROM &lt;repository&gt;[:tag]  
FROM &lt;repository&gt;@&lt;HASH number&gt;  

EXAMPLE:   
FROM centos:latest
    # ä½¿ç”¨Centosçš„æœ€æ–°å‘è¡Œé•œåƒä½œä¸ºåº•å±‚é•œåƒ</code></pre>

<h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="- MAINTAINER"></a>- MAINTAINER</h3><p>æä¾›åˆ¶ä½œäººçš„ä¿¡æ¯ï¼ŒåºŸå¼ƒä¸ç”¨äº†ï¼Œç°åœ¨ä½¿ç”¨LABEL  </p>
<pre class="language-none"><code class="language-none">MAINTAINER &quot;LiarLee&lt;Test@LiarLee.com&gt;&quot;</code></pre>

<h3 id="LABEL"><a href="#LABEL" class="headerlink" title="- LABEL"></a>- LABEL</h3><p>LABELæ˜¯ç»™é•œåƒæŒ‡å®šå…ƒæ•°æ®çš„å‘½ä»¤  </p>
<pre class="language-none"><code class="language-none">LABEL maintainer&#x3D;&quot;LiarLee&lt;Test@LiarLee.com&gt;&quot;</code></pre>

<h3 id="COPY"><a href="#COPY" class="headerlink" title="- COPY"></a>- COPY</h3><p>å¤åˆ¶æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•åˆ°é•œåƒæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚  </p>
<pre class="language-none"><code class="language-none">COPY \&lt;src&gt; ... \&lt;dest&gt;  
COPY [&quot;\&lt;src&gt;&quot; ... &quot;\&lt;dest&gt;&quot;]  
\&lt;src&gt; -- ç›¸å¯¹è·¯å¾„    
\&lt;dest&gt; -- ç»å¯¹è·¯å¾„   

- æŒ‡å®šçš„srcç›®å½•ï¼Œä¼šå°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°ç›®çš„åœ°ï¼Œä½†æ˜¯ä¸ä¼šå°†srcå¤åˆ¶ã€‚
- å¦‚æœä½¿ç”¨äº†å¤šä¸ªsrcï¼Œæˆ–è€…srcä½¿ç”¨äº†é€šé…ï¼Œç›®çš„å¿…é¡»æ˜¯ä¸ªç›®å½•  
- å¦‚æœdestä¸å­˜åœ¨ä¼šè¢«è‡ªåŠ¨åˆ›å»º  

COPY &#x2F;etc&#x2F;passwd &#x2F;etc&#x2F;passwd
    # ä¸cpå‘½ä»¤ç›¸ä¼¼ï¼Œå¤åˆ¶æœ¬åœ°ç›®æ ‡æ–‡ä»¶åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­
COPY &#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx&#x2F;* &#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx&#x2F;
    # å¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨éœ€è¦å…ˆè¡Œåˆ›å»º</code></pre>

<h3 id="Docker-Buildå‘½ä»¤"><a href="#Docker-Buildå‘½ä»¤" class="headerlink" title="Docker Buildå‘½ä»¤"></a>Docker Buildå‘½ä»¤</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@Hayden test<span class="token punctuation">]</span><span class="token comment"># docker build -h</span>
Flag shorthand <span class="token parameter variable">-h</span> has been deprecated, please use <span class="token parameter variable">--help</span>
Usage:	<span class="token function">docker</span> build <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token environment constant">PATH</span> <span class="token operator">|</span> URL <span class="token operator">|</span> -
Build an image from a Dockerfile
Options:
      --add-host list           Add a custom host-to-IP mapping <span class="token punctuation">(</span>host:ip<span class="token punctuation">)</span>
      --build-arg list          Set build-time variables
      --cache-from strings      Images to consider as cache sources
      --cgroup-parent string    Optional parent cgroup <span class="token keyword">for</span> the container
      <span class="token parameter variable">--compress</span>                Compress the build context using <span class="token function">gzip</span>
      --cpu-period int          Limit the CPU CFS <span class="token punctuation">(</span>Completely Fair Scheduler<span class="token punctuation">)</span> period
      --cpu-quota int           Limit the CPU CFS <span class="token punctuation">(</span>Completely Fair Scheduler<span class="token punctuation">)</span> <span class="token function">quota</span>
  -c, --cpu-shares int          CPU shares <span class="token punctuation">(</span>relative weight<span class="token punctuation">)</span>
      --cpuset-cpus string      CPUs <span class="token keyword">in</span> <span class="token function">which</span> to allow execution <span class="token punctuation">(</span><span class="token number">0</span>-3, <span class="token number">0,1</span><span class="token punctuation">)</span>
      --cpuset-mems string      MEMs <span class="token keyword">in</span> <span class="token function">which</span> to allow execution <span class="token punctuation">(</span><span class="token number">0</span>-3, <span class="token number">0,1</span><span class="token punctuation">)</span>
      --disable-content-trust   Skip image verification <span class="token punctuation">(</span>default <span class="token boolean">true</span><span class="token punctuation">)</span>
  -f, <span class="token parameter variable">--file</span> string             Name of the Dockerfile <span class="token punctuation">(</span>Default is <span class="token string">'PATH/Dockerfile'</span><span class="token punctuation">)</span>
      --force-rm                Always remove intermediate containers
      <span class="token parameter variable">--iidfile</span> string          Write the image ID to the <span class="token function">file</span>
      <span class="token parameter variable">--isolation</span> string        Container isolation technology
      <span class="token parameter variable">--label</span> list              Set metadata <span class="token keyword">for</span> an image
  -m, <span class="token parameter variable">--memory</span> bytes            Memory limit
      --memory-swap bytes       Swap limit equal to memory plus swap: <span class="token string">'-1'</span> to <span class="token builtin class-name">enable</span>
                                unlimited swap
      <span class="token parameter variable">--network</span> string          Set the networking mode <span class="token keyword">for</span> the RUN instructions
                                during build <span class="token punctuation">(</span>default <span class="token string">"default"</span><span class="token punctuation">)</span>
      --no-cache                Do not use cache when building the image
      <span class="token parameter variable">--pull</span>                    Always attempt to pull a newer version of the image
  -q, <span class="token parameter variable">--quiet</span>                   Suppress the build output and print image ID on success
      <span class="token parameter variable">--rm</span>                      Remove intermediate containers after a successful
                                build <span class="token punctuation">(</span>default <span class="token boolean">true</span><span class="token punctuation">)</span>
      --security-opt strings    Security options
      --shm-size bytes          Size of /dev/shm
  -t, <span class="token parameter variable">--tag</span> list                Name and optionally a tag <span class="token keyword">in</span> the <span class="token string">'name:tag'</span> <span class="token function">format</span>
      <span class="token parameter variable">--target</span> string           Set the target build stage to build.
      <span class="token parameter variable">--ulimit</span> <span class="token builtin class-name">ulimit</span>           Ulimit options <span class="token punctuation">(</span>default <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>åˆ¶ä½œä¸€ä¸ªå®¹å™¨ï¼ŒCOPYæœ¬åœ°çš„HTMLæ–‡ä»¶åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­  </p>
<pre class="language-none"><code class="language-none">[root@Hayden test]# docker build -t busybox-httpd:v0.1-1 .&#x2F;  
Sending build context to Docker daemon  3.072kB  
Step 1&#x2F;3 : FROM busybox:latest  
 ---&gt; d8233ab899d4  
Step 2&#x2F;3 : MAINTAINER &quot;HAYDEN&lt;HAYDEN@lee.com&gt;&quot;  
 ---&gt; Running in d581bd9c9aba  
Removing intermediate container d581bd9c9aba  
 ---&gt; 8137f8096ce4  
Step 3&#x2F;3 : COPY index.html &#x2F;data&#x2F;web&#x2F;html&#x2F;  
 ---&gt; bced33a9e4a4
Successfully built bced33a9e4a4
Successfully tagged busybox-httpd:v0.1-1</code></pre>
<p>æŸ¥çœ‹å·²ç»åˆ¶ä½œå®Œæˆçš„é•œåƒ</p>
<pre class="language-none"><code class="language-none">[root@Hayden test]# docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
busybox-httpd       v0.1-1              bced33a9e4a4        17 seconds ago      1.2MB
nginx               latest              881bd08c0b08        3 weeks ago         109MB
busybox             latest              d8233ab899d4        6 weeks ago         1.2MB</code></pre>
<p>è¿è¡Œå®¹å™¨æŸ¥çœ‹ç»“æœ</p>
<pre class="language-none"><code class="language-none">[root@Hayden test]# docker run --name t1 --rm busybox-httpd:v0.1-1 cat &#x2F;data&#x2F;web&#x2F;html&#x2F;index.html
&lt;h1&gt;Busybox httpd server.&lt;&#x2F;h1&gt;</code></pre>

<h3 id="ADD"><a href="#ADD" class="headerlink" title="- ADD"></a>- ADD</h3><p>ç”¨äºæ·»åŠ URLé“¾æ¥æˆ–æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒä¸­ï¼Œæ”¯æŒtaråŒ…çš„è‡ªåŠ¨è§£å‹ã€‚  </p>
<pre class="language-none"><code class="language-none">ADD &lt;src&gt; ... &lt;dest&gt;  
ADD [&quot;&lt;src&gt;&quot; ... &quot;&lt;dest&gt;&quot;]  
ADDå‘½ä»¤å¯ä»¥æ”¯æŒURLï¼Œåœ¨æ‰“åŒ…é•œåƒçš„æ—¶å€™ä¸‹è½½å¹¶æ‰“åŒ…è¿›å»
ADDå‘½ä»¤æ”¯æŒå¯¹æœ¬åœ°çš„taræ–‡ä»¶æ‰“åŒ…è¿›é•œåƒçš„æ—¶å€™è¿›è¡Œè§£å‹  

EXAMPLE:  
ADD nginx.org&#x2F;download&#x2F;nginx-1.15.12.tar.gz  
    # æŒ‡ä»¤è‡ªåŠ¨æ‰“åŒ…è¿›å…¥é•œåƒï¼Œå¹¶åŒæ—¶è§£å‹taråŒ…</code></pre>

<h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="- WORKDIR"></a>- WORKDIR</h3><pre class="language-none"><code class="language-none">WORKDIR &lt;dirpath&gt;  
æŒ‡å®šå½“å‰çš„å·¥ä½œç›®å½•

EXAMPLE:
WORKDIR &#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx
    # åˆ¶å®šåç»­æ“ä½œçš„å·¥ä½œç›®å½•ï¼Œä»¥è°ƒæ•´æŒ‡ä»¤ä¸­çš„ç›¸å¯¹è·¯å¾„</code></pre>

<h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="- VOLUME"></a>- VOLUME</h3><pre class="language-none"><code class="language-none">VOLUME \&lt;mountpoint&gt;  
VOLUME [&quot;\&lt;mountpoint&gt;&quot;]  
VOLUMEæŒ‡å®šæŒ‚è½½çš„å·  
åªèƒ½è®¾ç½®å®¹å™¨ä¸­çš„å·ç›®å½•ï¼Œä¸èƒ½åˆ¶å®šå®¿ä¸»æœºçš„ç›®å½•ï¼Œåªèƒ½ä½¿ç”¨Dockerè‡ªåŠ¨ç®¡ç†çš„å· </code></pre>

<h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="- EXPOSE"></a>- EXPOSE</h3><pre class="language-none"><code class="language-none">EXPOSE &lt;port&gt;[&#x2F;&lt;protocol&gt;]   
æŒ‡å®šçš„åè®®ä¸ºtcp or udp , defaults option is TCP  
å¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šä¸ªç«¯å£  </code></pre>

<h3 id="ENV"><a href="#ENV" class="headerlink" title="- ENV"></a>- ENV</h3><pre class="language-none"><code class="language-none">ENV &lt;key&gt; &lt;value1&gt; &lt;value2&gt; &lt;value3&gt; &lt;value4&gt;   
ENV &lt;key&gt;&#x3D;&lt;value&gt; &lt;key&gt;&#x3D;&lt;value&gt;...  
åœ¨Dockerfileä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œå¯å°†æŒ‡å®šçš„å˜é‡åœ¨Docker runçš„æ—¶å€™è¿›è¡Œæ‰‹åŠ¨çš„æŒ‡å®šï¼Œ
å½±å“è¿è¡Œå®¹å™¨æ—¶å€™çš„å‘½ä»¤æ‰§è¡Œç»“æœï¼Œä½†æ˜¯ä¸å½±å“docker buildçš„è¿è¡Œç»“æœ  </code></pre>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>EC2 è·¯ç”±è¡¨ä»¥åŠå¤šç½‘å¡ç›¸å…³é—®é¢˜</title>
    <url>/2023/07/25/Linux/Linux_EC2MultiNetworkCase/</url>
    <content><![CDATA[<p>åœ¨EC2å®ä¾‹ä¸­ï¼Œ å¯ä»¥ä½¿ç”¨å¤šä¸ªä¸åŒçš„ç½‘å¡ï¼Œ ä½†æ˜¯è™šæ‹Ÿç½‘å¡å…¶å®æ˜¯å…±äº«å®ä¾‹æ•´ä½“å¸¦å®½çš„ã€‚ å‡å¦‚EC2å®ä¾‹æœ¬èº«æœ‰10Gbpsçš„å¸¦å®½ï¼Œ é‚£ä¹ˆæ— è®ºå¤šå°‘ä¸ªç½‘å¡éƒ½åº”è¯¥åªèƒ½æœ‰10Gbpsçš„å¸¦å®½ï¼Œ å…¶å®æ·»åŠ äº†å¤šä¸ªä¹Ÿä¸ä¼šæ‰©å±•ç½‘ç»œä¸Šé™ã€‚ </p>
<p>ä½†æ˜¯æŸäº›å¤§è§„æ ¼çš„å®ä¾‹ä¼šæœ‰è¿™ç§æƒ…å†µï¼Œ éœ€è¦æ·»åŠ å¤šä¸ªç½‘å¡ï¼Œå¹¶ä¸”åº•å±‚å…¶å®æä¾›äº†å¤šä¸ªNetworkCardã€‚ è¿™ç§æƒ…å†µå°‘è§ï¼Œ ä½†æ˜¯ç¡®å®æœ‰ã€‚ </p>
<p>å¦‚æœæ˜¯ç‰©ç†çš„æœºå™¨ï¼Œ é‚£ä¹ˆæœ€å¥½çš„åŠæ³•å°±æ˜¯é“¾è·¯èšåˆï¼Œ å°†å¤šä¸ªç½‘å¡åˆå¹¶ä½¿ç”¨æ¥æ‰©å……è¿™ä¸ªç‰©ç†æœåŠ¡å™¨çš„ç½‘ç»œèƒ½åŠ›ã€‚ </p>
<p>è¿™æ ·çš„å®ä¾‹æ·»åŠ ç½‘å¡ä¹‹åå…¶å®ä¼šæœ‰ä¸€å®šçš„éš¾åº¦ï¼Œæè¿°ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š </p>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ä¸€å°ec2 ï¼Œ ä¸‰å¼ ç½‘å¡ï¼Œ OSæ˜¯ Ubuntu 18.04 ï¼Œ ä¸‰å¼ ç½‘å¡åˆ†åˆ«æ˜¯ ens5 ens6 ens7 , å®ä¾‹ä¸­å‘½ä»¤å±•ç¤ºç½‘å¡å¦‚ä¸‹ ï¼š </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip ad
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1&#x2F;8 scope host lo
       valid_lft forever preferred_lft forever
2: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:4d:73:35:16:8a brd ff:ff:ff:ff:ff:ff
    inet 172.31.43.121&#x2F;20 brd 172.31.47.255 scope global dynamic ens5
       valid_lft 1957sec preferred_lft 1957sec
3: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:5d:02:b4:37:fa brd ff:ff:ff:ff:ff:ff
    inet 172.31.37.95&#x2F;20 brd 172.31.47.255 scope global dynamic ens6
       valid_lft 1955sec preferred_lft 1955sec
4: ens7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:cf:10:d8:12:80 brd ff:ff:ff:ff:ff:ff
    inet 172.31.40.130&#x2F;20 brd 172.31.47.255 scope global dynamic ens7
       valid_lft 1956sec preferred_lft 1956sec</code></pre>

<p>ä¸‰å¼ ç½‘å¡ä¸­ï¼Œ ens5ä¸Šé¢æœ‰ä¸€ä¸ªå…¬ç½‘ipåœ°å€çš„ç»‘å®šï¼Œ elastic ip , æ“ä½œç³»ç»Ÿçœ‹ä¸åˆ°ï¼Œ ä½†æ˜¯ens5 èƒ½æ‰¾åˆ°å…¬ç½‘IPåœ°å€ï¼Œ å…¶ä»–ç½‘å¡éƒ½ä¸èƒ½ã€‚</p>
<h2 id="å¤šç½‘å¡è·¯ç”±ç­–ç•¥é…ç½®"><a href="#å¤šç½‘å¡è·¯ç”±ç­–ç•¥é…ç½®" class="headerlink" title="å¤šç½‘å¡è·¯ç”±ç­–ç•¥é…ç½®"></a>å¤šç½‘å¡è·¯ç”±ç­–ç•¥é…ç½®</h2><p>å¤šç½‘å¡çš„æƒ…å†µä¸‹ï¼Œ<strong>æ‰‹åŠ¨é…ç½®äº†æ‰€æœ‰ç½‘å¡çš„è·¯ç”±ç­–ç•¥ä¹‹å</strong>ï¼Œå…¬ç½‘è®¿é—®æ²¡äº†ï¼Œ çœ‹çœ‹ ip route showï¼š </p>
<h3 id="çœ‹è·¯ç”±è¡¨"><a href="#çœ‹è·¯ç”±è¡¨" class="headerlink" title="çœ‹è·¯ç”±è¡¨"></a>çœ‹è·¯ç”±è¡¨</h3><pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip r s
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100

ip route show å‘½ä»¤æ˜¾ç¤ºçš„æ˜¯ç³»ç»Ÿè·¯ç”±è¡¨ï¼Œä¹Ÿå°±æ˜¯è®°å½•äº†ç›®çš„ç½‘ç»œå’Œä¸‹ä¸€è·³åœ°å€çš„ä¿¡æ¯çš„è·¯ç”±è¡¨ã€‚å®ƒçš„æ¯ä¸ªå­—æ®µçš„å«ä¹‰æ˜¯ï¼š

default è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹æ˜¯ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯å½“æ²¡æœ‰åŒ¹é…ç›®çš„åœ°å€çš„è·¯ç”±é¡¹æ—¶ï¼Œå°±ä½¿ç”¨è¿™ä¸ªè·¯ç”±é¡¹æ¥å‘é€æ•°æ®åŒ…ã€‚
via è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„ä¸‹ä¸€è·³åœ°å€ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åŒ…è¦ç»è¿‡çš„ç½‘å…³åœ°å€ã€‚
dev è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹å¯¹åº”çš„ç½‘å¡è®¾å¤‡åç§°ï¼Œä¾‹å¦‚ lo, eth0, ens5 ç­‰ã€‚
proto è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„åè®®æ¥æºï¼Œä¾‹å¦‚ kernel, static, dhcp ç­‰ã€‚
src è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„æºåœ°å€ï¼Œä¹Ÿå°±æ˜¯æœ¬æœºå‘é€æ•°æ®åŒ…æ—¶ä½¿ç”¨çš„IPåœ°å€ã€‚
metric è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„åº¦é‡å€¼ï¼Œä¹Ÿå°±æ˜¯åˆ°è¾¾ç›®çš„ç½‘ç»œæ‰€éœ€çš„è·³æ•°æˆ–å¼€é”€ã€‚</code></pre>

<p>è¿™é‡Œé¢æ˜¾ç¤º æˆ‘æœ‰ä¸‰ä¸ªé»˜è®¤è·¯ç”±ï¼Œ ä»–ä»¬çš„æƒé‡æ˜¯ä¸€æ ·çš„ï¼Œ é‚£ä¹ˆæŒ‰ç…§é€šå¸¸çš„é€»è¾‘ï¼Œ å“ªä¸ªæ¡ç›®åœ¨é å‰å°±ä¼šæŠŠæ•°æ®åŒ…äº¤ç»™è°ï¼Œ è¿™æ—¶å€™é—®é¢˜å‡ºç°äº†ã€‚ </p>
<blockquote>
<p>å¦‚æœæˆ‘çš„ä¸»ç½‘å¡ä¸Šé¢æœ‰å…¬ç½‘IPåœ°å€ï¼Œ è¿™æ—¶å€™æˆ‘å»è®¿é—®å…¬ç½‘ä¾‹å¦‚baiduï¼Œ ä¼šå‘ç°è¿™ä¸ªæ•°æ®æ˜¯å‡ºä¸å»çš„ï¼Œ å› ä¸ºé»˜è®¤åŒ¹é…äº†ç¬¬ä¸€ä¸ªæ¡ç›®ä¹‹åï¼Œ ä» ens7 è¿™ä¸ªæ²¡æœ‰å…¬ç½‘ipåœ°å€ç»‘å®šçš„ç½‘å¡èµ°äº†ã€‚</p>
</blockquote>
<h3 id="çœ‹æŠ“åŒ…"><a href="#çœ‹æŠ“åŒ…" class="headerlink" title="çœ‹æŠ“åŒ…"></a>çœ‹æŠ“åŒ…</h3><p>æµ‹è¯•ä¸€ä¸‹ï¼Œ ç›´æ¥å¼€ä¸€ä¸ªPingå‘½ä»¤åœ¨åå°ï¼Œ <code>ping www.baidu.com </code> ï¼Œ å¦ä¸€ä¸ªçª—å£å¼€ <code>tcpdump -i any icmp</code>çœ‹ç»“æœã€‚</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# tcpdump -i any icmp -nn
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes
14:49:31.480896 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 12, length 64
14:49:32.504867 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 13, length 64
14:49:33.528873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 14, length 64
14:49:34.552872 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 15, length 64
14:49:35.576877 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 16, length 64
14:49:36.600873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 17, length 64
14:49:37.624863 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 18, length 64
14:49:38.648871 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 19, length 64
14:49:39.672865 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 20, length 64
14:49:40.696876 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 21, length 64
14:49:41.720872 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 22, length 64
14:49:42.744873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 23, length 64
14:49:43.768868 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 24, length 64
</code></pre>

<p>èƒ½ç›´æ¥çœ‹åˆ°è¿™ä¸ªæ•°æ®åŒ…æ˜¯ä» ens7 çš„ç½‘å¡å‡ºå»çš„ï¼Œ ç¡®å®åŒ¹é…åˆ°äº†é»˜è®¤çš„è·¯ç”±æ¡ç›®ï¼Œ ç¬¬ä¸€æ¡ç›´æ¥å‘èµ°ï¼Œ è¿™æœ¬æ¥æ˜¯æ­£ç¡®çš„é€»è¾‘ï¼Œ ä½†æ˜¯ä¸€æ—¦æˆ‘éœ€è¦è®¿é—®å…¬ç½‘ä¸”è¯¥å®ä¾‹çš„ens5æ‰æ˜¯å…¬ç½‘ipçš„æŒ‡å®šç½‘å¡ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…å°±åªæœ‰å‡ºå»ï¼Œ æ²¡æœ‰å›æ¥çš„äº†ã€‚</p>
<p>è¿™ç¡®å®é¿å…äº†VPCå†…éƒ¨è®¿é—®çš„ç½‘ç»œé™åˆ¶é—®é¢˜ï¼Œ ä½†æ˜¯å…¬ç½‘çš„è®¿é—®ä¹Ÿæ²¡æœ‰äº†ã€‚ è¿™æ˜¯ä¸€ä¸ªè·¯ç”±æ¡ç›®çš„ä¼˜å…ˆçº§é—®é¢˜ï¼Œ åŸºäºè¿™ä¸ªé—®é¢˜åº”è¯¥å¦‚ä½•ä¿®å¤å‘¢ï¼Ÿ </p>
<h3 id="è°ƒæ•´è·¯ç”±æ¡ç›®çš„ä¼˜å…ˆçº§"><a href="#è°ƒæ•´è·¯ç”±æ¡ç›®çš„ä¼˜å…ˆçº§" class="headerlink" title="è°ƒæ•´è·¯ç”±æ¡ç›®çš„ä¼˜å…ˆçº§"></a>è°ƒæ•´è·¯ç”±æ¡ç›®çš„ä¼˜å…ˆçº§</h3><p>è°ƒæ•´é»˜è®¤è·¯ç”±çš„ä¼˜å…ˆçº§ï¼Œ è®©æ•°æ®åŒ¹é…é»˜è®¤è·¯ç”±çš„æ—¶å€™ä¼˜å…ˆåŒ¹é…ens5çš„æ¡ç›®ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">150</span>  <span class="token function">ip</span> route del default via <span class="token number">172.31</span>.32.1 dev ens5 proto dhcp src <span class="token number">172.31</span>.43.121 metric <span class="token number">100</span>
<span class="token number">151</span>  <span class="token function">ip</span> route <span class="token function">add</span> default via <span class="token number">172.31</span>.32.1 dev ens5 proto dhcp src <span class="token number">172.31</span>.43.121 metric <span class="token number">10</span></code></pre>

<p>ä¸Šé¢çš„å‘½ä»¤å¯ä»¥å°†ens5 çš„é»˜è®¤è·¯ç”±metric è®¾ç½®æˆ 10 ï¼Œæ•´ä½“çš„è·¯ç”±è¡¨ä¼šå˜æˆè¿™æ ·ï¼š </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;netplan# ip r s
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>è¿™æ—¶å€™å†ping <a href="http://www.baidu.com/">www.baidu.com</a> çš„ç»“æœå°±æ­£å¸¸äº†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-43-121:/etc/netplan<span class="token comment"># ping www.baidu.com</span>
PING www.a.shifen.com <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.60</span> ms
^C
--- www.a.shifen.com <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3004ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">5.590</span>/5.596/5.608/0.091 ms</code></pre>

<p>è¿™æ—¶å€™å¦‚æœé‡å¯ç½‘ç»œæœåŠ¡å°±ä¼šå‘ç°ï¼Œ è¿™ä¸‰ä¸ªé»˜è®¤æ¡ç›®è·¯ç”±çš„ metric åˆæ¢å¤äº† 100 ï¼Œ å¹¶ä¸èƒ½æŒä¹…ç”Ÿæ•ˆã€‚</p>
<h3 id="æŒä¹…åŒ–é…ç½®"><a href="#æŒä¹…åŒ–é…ç½®" class="headerlink" title="æŒä¹…åŒ–é…ç½®"></a>æŒä¹…åŒ–é…ç½®</h3><p>æ›´æ”¹è¿™ä¸ªç½‘å¡çš„é…ç½®æ–‡ä»¶<code>/etc/netplan/50-cloud-init.yaml</code></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">root@ip<span class="token punctuation">-</span>172<span class="token punctuation">-</span>31<span class="token punctuation">-</span>43<span class="token punctuation">-</span>121<span class="token punctuation">:</span>/etc/netplan<span class="token comment"># cat /etc/netplan/50-cloud-init.yaml</span>
<span class="token comment"># This file is generated from information provided by the datasource.  Changes</span>
<span class="token comment"># to it will not persist across an instance reboot.  To disable cloud-init's</span>
<span class="token comment"># network configuration capabilities, write a file</span>
<span class="token comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span class="token comment"># network: &#123;config: disabled&#125;</span>
<span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
        <span class="token key atrule">ens5</span><span class="token punctuation">:</span>
            <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">match</span><span class="token punctuation">:</span>
                <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>4d<span class="token punctuation">:</span>73<span class="token punctuation">:</span>35<span class="token punctuation">:</span>16<span class="token punctuation">:</span>8a
            <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens5
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0 <span class="token comment"># ä¸»è·¯ç”±è¡¨é»˜è®¤è·¯ç”±æ¡ç›®æƒé‡</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.32.1
               <span class="token key atrule">metric</span><span class="token punctuation">:</span> <span class="token number">10</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0  <span class="token comment"># ç­–ç•¥è·¯ç”±</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.32.1
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.43.121 <span class="token comment"># ç­–ç•¥è·¯ç”±</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
               <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
            <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.43.121
                <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span></code></pre>

<p>æ‰§è¡Œ <code>netplan try</code>æµ‹è¯•</p>
<p>æ‰§è¡Œ <code>netplan apply</code> ç¡®è®¤ç”Ÿæ•ˆ</p>
<hr>
<p>è¿™ä¸ªæ—¶å€™å†çœ‹è·¯ç”±è¡¨ï¼Œ è¾“å‡ºç»“æœï¼š </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;netplan# ip r s
default via 172.31.32.1 dev ens5 proto static metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>è¿™æ—¶å€™è¿™ä¸ªå®ä¾‹çš„å†…å¤–ç½‘ç»œéƒ½æ˜¯é€šçš„äº†ã€‚</p>
<h3 id="æœ€ä¼˜é…ç½®"><a href="#æœ€ä¼˜é…ç½®" class="headerlink" title="æœ€ä¼˜é…ç½®"></a>æœ€ä¼˜é…ç½®</h3><p>å¯¹äºUbuntuæœ€ä½³çš„é…ç½®æ˜¯ï¼š </p>
<p>ens5 è®¾ç½®ä¸º dhcpã€‚</p>
<p>ens6ï¼Œ ens7 è®¾ç½®ä¸º static ip ï¼Œ ä¸ä»DHCPå­¦ä¹ è·¯ç”±æ¡ç›®ã€‚è¿™æ ·é»˜è®¤çš„è·¯ç”±æ¡ç›®åªæœ‰ä¸€æ¡ï¼Œ å°±æ˜¯æŒ‡å‘ens5çš„æ¡ç›®ï¼Œ æ‰€æœ‰å»å¾€å…¬ç½‘çš„æµé‡ä¼šåŒ¹é…åˆ°è¿™ä¸ªdefaultæ¡ç›®ï¼Œ ç„¶åèµ° ens5. </p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ens6</span><span class="token punctuation">:</span>
    <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">dhcp4-overrides</span><span class="token punctuation">:</span> <span class="token comment"># è¿™ä¸ªå‚æ•°æ²¡å°è¯•ï¼Œ æ„Ÿè§‰æ˜¯éœ€è¦çš„ï¼Œè°ƒæ•´ä¸€ä¸‹å­¦ä¹ æ¥çš„è·¯ç”±çš„ä¼˜å…ˆçº§</span>
        <span class="token key atrule">route-metric</span><span class="token punctuation">:</span> <span class="token number">100</span>
        <span class="token comment"># ä¸æŒ‡å®šmetricä¹Ÿå¯ä»¥æŒ‡å®š         use-routes: false æ¥å…³é—­å­¦ä¹ é»˜è®¤è·¯ç”±ã€‚</span>
    <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 172.31.59.199/20
    <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">match</span><span class="token punctuation">:</span>
        <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>64<span class="token punctuation">:</span>69<span class="token punctuation">:</span>51<span class="token punctuation">:</span>00<span class="token punctuation">:</span>f2
    <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens6
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0
       <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.48.1
       <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
     <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.59.199
       <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
       <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
       <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
    <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.59.199
        <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
<span class="token key atrule">ens7</span><span class="token punctuation">:</span>   <span class="token comment"># åŒä¸Š</span>
</code></pre>

<p>ä½†æ˜¯å°±åƒä¹‹å‰çš„æè¿°ï¼Œ è¿™å·²ç»å¯ä»¥è¾¾æˆæœ€ç»ˆçš„ç›®æ ‡äº†ï¼Œ è¿™è¿˜æ˜¯æ„Ÿè§‰ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œ æœ€å¥½çš„æ–¹æ³•æ˜¯bondingï¼Œ ç›´æ¥å°†å¤šä¸ªç½‘å¡é“¾è·¯èšåˆï¼Œ æ‰èƒ½æ›´å¥½çš„åˆ©ç”¨å¥½åº•å±‚å¤šä¸ªç‰©ç†ç½‘å¡çš„ç‰¹æ€§ã€‚</p>
<h2 id="é…ç½®Bonding"><a href="#é…ç½®Bonding" class="headerlink" title="é…ç½®Bonding"></a>é…ç½®Bonding</h2><p>å¾…è¡¥å……ã€‚</p>
<h2 id="å¦‚ä½•æ’æŸ¥è·¯ç”±è¡¨æ¡ç›®"><a href="#å¦‚ä½•æ’æŸ¥è·¯ç”±è¡¨æ¡ç›®" class="headerlink" title="å¦‚ä½•æ’æŸ¥è·¯ç”±è¡¨æ¡ç›®"></a>å¦‚ä½•æ’æŸ¥è·¯ç”±è¡¨æ¡ç›®</h2><ol>
<li><p>é¦–å…ˆåº”è¯¥æŸ¥çœ‹çš„æ˜¯ ip rule list , è¿™é‡Œé¢å®šä¹‰çš„æ˜¯ æ‰€æœ‰è·¯ç”±è¡¨çš„ä¼˜å…ˆçº§ã€‚ </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;iproute2# ip rule list
0:	from all lookup local
0:	from 172.31.40.130 lookup 1002
0:	from 172.31.37.95 lookup 1001
0:	from 172.31.43.121 lookup 1000
32766:	from all lookup main
32767:	from all lookup default
</code></pre>

<p>æŸ¥çœ‹tcpæ•°æ®åŒ…ä¸­çš„<strong>ç›®çš„åœ°å€</strong>ï¼Œ æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºåŒ¹é…æ¡ç›®ï¼Œä¾æ¬¡æŸ¥ã€‚</p>
<p>local table æ˜¯å†…æ ¸ç»´æŠ¤æœ¬åœ°ç½‘ç»œï¼Œ æ— æ³•æ›´æ”¹ï¼Œ å¹¶ä¸”æ‰€æœ‰çš„æ¡ç›®éƒ½å…ˆåŒ¹é…localã€‚</p>
</li>
<li><p>æŸ¥çœ‹ local table ä¸­çš„æ¡ç›®ã€‚</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip route show table local
broadcast 127.0.0.0 dev lo proto kernel scope link src 127.0.0.1
local 127.0.0.0&#x2F;8 dev lo proto kernel scope host src 127.0.0.1
local 127.0.0.1 dev lo proto kernel scope host src 127.0.0.1
broadcast 127.255.255.255 dev lo proto kernel scope link src 127.0.0.1
broadcast 172.31.32.0 dev ens7 proto kernel scope link src 172.31.40.130
broadcast 172.31.32.0 dev ens6 proto kernel scope link src 172.31.37.95
broadcast 172.31.32.0 dev ens5 proto kernel scope link src 172.31.43.121
local 172.31.37.95 dev ens6 proto kernel scope host src 172.31.37.95
local 172.31.40.130 dev ens7 proto kernel scope host src 172.31.40.130
local 172.31.43.121 dev ens5 proto kernel scope host src 172.31.43.121
broadcast 172.31.47.255 dev ens7 proto kernel scope link src 172.31.40.130
broadcast 172.31.47.255 dev ens6 proto kernel scope link src 172.31.37.95
broadcast 172.31.47.255 dev ens5 proto kernel scope link src 172.31.43.121

ip route show table local å‘½ä»¤æ˜¾ç¤ºçš„æ˜¯æœ¬åœ°è·¯ç”±è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜æœ¬åœ°æ¥å£åœ°å€ï¼Œå¹¿æ’­åœ°å€ï¼ŒNATåœ°å€ç­‰ä¿¡æ¯çš„è·¯ç”±è¡¨ã€‚å®ƒçš„æ¯ä¸€ä¸ªå­—æ®µçš„å«ä¹‰æ˜¯ï¼š
 
broadcast è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹æ˜¯ä¸€ä¸ªå¹¿æ’­åœ°å€ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å‘åŒä¸€ç½‘æ®µå†…çš„æ‰€æœ‰ä¸»æœºå‘é€æ•°æ®åŒ…çš„åœ°å€ã€‚
local è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹æ˜¯ä¸€ä¸ªæœ¬åœ°åœ°å€ï¼Œä¹Ÿå°±æ˜¯æœ¬æœºè‡ªèº«çš„IPåœ°å€ã€‚
 
dev è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹å¯¹åº”çš„ç½‘å¡è®¾å¤‡åç§°ï¼Œä¾‹å¦‚ lo, eth0, ens5 ç­‰ã€‚
 
proto è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„åè®®æ¥æºï¼Œä¾‹å¦‚ kernel, static, dhcp ç­‰ã€‚
 
scope è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„ä½œç”¨èŒƒå›´ï¼Œä¾‹å¦‚ host, link, global ç­‰ã€‚

src è¡¨ç¤ºè¿™ä¸ªè·¯ç”±é¡¹çš„æºåœ°å€ï¼Œä¹Ÿå°±æ˜¯æœ¬æœºå‘é€æ•°æ®åŒ…æ—¶ä½¿ç”¨çš„IPåœ°å€ã€‚
</code></pre>

<p>è¿™ä¸ªè¡¨æ ¼ä¸­ï¼Œ ä¾‹å¦‚ </p>
<blockquote>
<p>local 172.31.37.95 dev ens6 proto kernel scope host src 172.31.37.95 </p>
</blockquote>
<p>å¦‚æœåŒ¹é…åˆ°äº†ç›®çš„åœ°å€æ˜¯  172.31.37.95  é‚£ä¹ˆå°±ç”± dev ens6 æ¥å¤„ç†è¿™ä¸ªæ•°æ®ï¼Œ æ˜¯é€šè¿‡kernelè®°å½•çš„ï¼Œ æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»ŸèŒƒå›´å†…çš„é“¾è·¯ï¼Œ è¿™ä¸ªæ¡ç›®è¡¨ç¤ºï¼Œ åŒ¹é…åˆ°è¿™ä¸ªè·¯ç”±æ¡ç›®çš„æ•°æ®æŠ¥æ–‡ä¼šè¢«äº¤ç»™dev dns6 æ¥è¿›è¡Œå¤„ç†ã€‚ </p>
<p>å¦‚æœæƒ³çŸ¥é“å…·ä½“è¿™ä¸ªåœ°å€ä¼šåŒ¹é…åˆ°å“ªä¸ªè·¯ç”±æ¡ç›®ï¼Œ å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-43-121:/etc/iproute2<span class="token comment"># ip route get 39.156.66.14</span>
<span class="token number">39.156</span>.66.14 via <span class="token number">172.31</span>.32.1 dev ens5 src <span class="token number">172.31</span>.43.121 uid <span class="token number">0</span>
    cache
root@ip-172-31-43-121:/etc/iproute2<span class="token comment"># ip route get 172.31.40.130</span>
<span class="token builtin class-name">local</span> <span class="token number">172.31</span>.40.130 dev lo table <span class="token builtin class-name">local</span> src <span class="token number">172.31</span>.40.130 uid <span class="token number">0</span>
    cache <span class="token operator">&lt;</span>local<span class="token operator">></span>
</code></pre>
</li>
<li><p>å¦‚æœlocalæ²¡æœ‰åŒ¹é…åˆ°ï¼Œ ä¾‹å¦‚ è®¿é—®ç™¾åº¦çš„åœ°å€ï¼Œ ä¼šè·³è½¬åˆ° ç­–ç•¥è·¯ç”±è¡¨ï¼Œ å½“ç„¶æˆ‘é…ç½®çš„ç­–ç•¥è·¯ç”±è¡¨å…¶å®ä¹Ÿæ²¡æœ‰åŒ¹é…åˆ°è¿™äº›æ¡ç›®ï¼Œ å› æ­¤å¼€å§‹æŸ¥ main</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;iproute2# ip r s t main
default via 172.31.32.1 dev ens5 proto static metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>ç”±ä¸Šé¢çš„æŸ¥è¯¢ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ åŒ¹é…åˆ°äº†mainè¡¨çš„ç¬¬ä¸€æ¡ã€‚ç›´æ¥ç»™äº†ens5 ï¼Œ æ•°æ®å‡ºå»äº†ã€‚</p>
</li>
</ol>
<h2 id="é¢å¤–çš„é—®é¢˜"><a href="#é¢å¤–çš„é—®é¢˜" class="headerlink" title="é¢å¤–çš„é—®é¢˜"></a>é¢å¤–çš„é—®é¢˜</h2><ol>
<li><p>å…·ä½“åŒ¹é…çš„è§„åˆ™æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œ src åœ°å€åˆ°åº•æ˜¯åŒ¹é…è§„åˆ™è¿˜æ˜¯ åŒ¹é…åæŠ¥æ–‡çš„æºåœ°å€ã€‚</p>
<blockquote>
<p>src åé¢çš„åœ°å€æ˜¯å‘å‡ºæŠ¥æ–‡çš„src ipï¼Œ è¡¨ç¤ºåŒ¹é…è¿™ä¸ªè·¯ç”±æ¡ç›®çš„æŠ¥æ–‡éƒ½æ˜¯è¿™ä¸ªåœ°å€å‘å‡ºå»çš„ã€‚</p>
</blockquote>
</li>
<li><p>ä¸‰ä¸ªæ¡ç›®çš„æƒé‡ç›¸åŒçš„æ—¶å€™ï¼Œ ä¹Ÿä¸æ˜¯å…¨éƒ¨çš„æŠ¥æ–‡éƒ½åŒ¹é…äº†é»˜è®¤çš„ç¬¬ä¸€ä¸ªè§„åˆ™ï¼Œ è€Œæ˜¯å‘¨æœŸçš„åŒ¹é…åˆ°ens6å¹¶ä¸”å°è¯•è®¿é—®å‡ æ¬¡ç™¾åº¦ï¼Œ ç„¶åå¤±è´¥ï¼Œ ä¸çŸ¥é“ä¸ºå•¥ã€‚</p>
<p>å¦‚å›¾ï¼š </p>
<p>å¾…</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Network, EC2</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch å®‰è£…è®°å½•</title>
    <url>/2019/09/11/Linux/Linux_ElasticSearch-01/</url>
    <content><![CDATA[<p>ElasticSearchçš„å®‰è£…è¿‡ç¨‹ã€‚</p>
<h1 id="å‡†å¤‡æºç åŒ…"><a href="#å‡†å¤‡æºç åŒ…" class="headerlink" title="å‡†å¤‡æºç åŒ…"></a>å‡†å¤‡æºç åŒ…</h1><ol>
<li>éœ€è¦ä¸‹è½½çš„åŒ…æœ‰ä¸‰ä¸ªï¼š<a href="https://www.elastic.co/cn/downloads/">ç½‘ç«™åœ°å€</a><ul>
<li>ElasticSearch- åˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œåˆ†æã€‚&#x2F;usr&#x2F;local&#x2F;src&#x2F;elasticsearch</li>
<li>Logstash - é‡‡é›†ã€è½¬æ¢ã€å……å®ï¼Œç„¶åè¾“å‡ºã€‚&#x2F;usr&#x2F;local&#x2F;src&#x2F;logstash</li>
<li>Kibana - å®ç°æ•°æ®å¯è§†åŒ–ã€‚åœ¨ Elastic Stack ä¸­è¿›è¡Œå¯¼èˆªã€‚&#x2F;usr&#x2F;local&#x2F;src&#x2F;kibana</li>
</ul>
</li>
</ol>
<h1 id="å®‰è£…-ElasticSearch"><a href="#å®‰è£…-ElasticSearch" class="headerlink" title="å®‰è£… ElasticSearch"></a>å®‰è£… ElasticSearch</h1><ol>
<li>è§£å‹ä¸‹è½½çš„å®‰è£…åŒ…<ol>
<li>tar zxvf elasticsearch-7.3.1-linux-x86_64.tar.gz</li>
<li>tar zxvf kibana-7.3.1-linux-x86_64.tar.gz</li>
<li>tar zxvf logstash-7.3.1.tar.gz</li>
</ol>
</li>
<li>ä¿®æ”¹ç³»ç»Ÿå‚æ•°<ul>
<li>vim &#x2F;etc&#x2F;sysctl.conf</li>
<li>fs.file-max&#x3D;65535</li>
<li>vm.max_map_count&#x3D;262144</li>
</ul>
</li>
<li>sysctl -p : é‡æ–°è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œæ›´æ–°çš„æ¡ç›®ä¼šæ˜¾ç¤ºåœ¨å‘½ä»¤æ‰§è¡Œç»“æœä¸­ã€‚</li>
<li>vim &#x2F;etc&#x2F;security&#x2F;limits.conf <pre class="language-none"><code class="language-none">* soft nofile 65536
* hard nofile 131072
* soft noproc 4096
* hard noproc 4096	</code></pre></li>
<li>ä¿å­˜é€€å‡ºã€‚</li>
<li>å»ºç«‹elkç”¨æˆ· <pre class="language-none"><code class="language-none">useradd elk -p &quot;YOUR-PASSWD&quot;</code></pre></li>
<li>å°†&#x2F;usr&#x2F;local&#x2F;src&#x2F;elasticsearchç›®å½•çš„æƒé™ç»™elkç”¨æˆ·ã€‚ <pre class="language-none"><code class="language-none">chown -R elk:elk &#x2F;usr&#x2F;local&#x2F;src&#x2F;elasticsearch&#x2F;</code></pre></li>
<li>åœ¨&#x2F;usr&#x2F;local&#x2F;src&#x2F;elasticsearch&#x2F;elasticsearch&#x2F;config&#x2F;ç›®å½•ä¸‹ä¿®æ”¹é…ç½®æ–‡ä»¶elasticsearch.ymlã€‚ <pre class="language-none"><code class="language-none">cluster.name: CLUSTER_NAME
node.name: HOSTNAME &amp; ROLES
node.master: true
node.data: true
network.host: YOUR_HOSTNAME
discovery.zen.ping.unicast.hosts: [&quot;YOUR_OTHER_NODE_HOSTNAME &quot;]
</code></pre></li>
<li>åˆ‡æ¢åˆ°elkç”¨æˆ·ï¼Œå°è¯•å¯åŠ¨elk<br> su elk<br> cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;elasticsearch&#x2F;elasticsearch&#x2F;bin&#x2F;<br> .&#x2F;elasticsearch<br> å¦‚æœæ²¡æœ‰é”™è¯¯å°±å¯ä»¥ä½¿ç”¨ -d é€‰é¡¹å°†æœåŠ¡å¯åŠ¨åˆ°åå°ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>Application, ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch å®‰è£…è®°å½•</title>
    <url>/2020/06/27/Linux/Linux_Elasticsearch-02/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹è‡ªå·±çš„é›†ç¾¤å®‰è£…è¿‡ç¨‹å’Œå¸¸è§çš„å‘½ä»¤ã€‚</p>
<h2 id="Elastic-Searchä¸‰èŠ‚ç‚¹çš„å®‰è£…"><a href="#Elastic-Searchä¸‰èŠ‚ç‚¹çš„å®‰è£…" class="headerlink" title="Elastic Searchä¸‰èŠ‚ç‚¹çš„å®‰è£…"></a>Elastic Searchä¸‰èŠ‚ç‚¹çš„å®‰è£…</h2><ol>
<li><p>èŠ‚ç‚¹çš„åç§°å’Œç›¸å…³å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>Host-name</th>
<th>IP</th>
<th>Cluster Name</th>
<th>Role</th>
</tr>
</thead>
<tbody><tr>
<td>elk01</td>
<td>192.168.122.101</td>
<td>liarlee-elk</td>
<td>Elasticsearch</td>
</tr>
<tr>
<td>elk02</td>
<td>192.168.122.102</td>
<td>liarlee-elk</td>
<td>Kibana</td>
</tr>
<tr>
<td>elk03</td>
<td>192.168.122.103</td>
<td>liarlee-elk</td>
<td>Filebeat</td>
</tr>
</tbody></table>
</li>
<li><p>ä½¿ç”¨æ¸…åçš„repo</p>
 <pre class="language-none"><code class="language-none">[elasticsearch]
name&#x3D;Elasticsearch repository for 7.x packages
#baseurl&#x3D;https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;packages&#x2F;7.x&#x2F;yum
baseurl&#x3D;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;elasticstack&#x2F;7.x&#x2F;yum&#x2F;
gpgcheck&#x3D;0
gpgkey&#x3D;https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;GPG-KEY-elasticsearch
enabled&#x3D;1
autorefresh&#x3D;1
type&#x3D;rpm-md</code></pre>
</li>
<li><p>ä¸‰ä¸ªæœåŠ¡å™¨éƒ½éœ€è¦å®‰è£…Elasticsearchå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ã€‚</p>
 <pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># å®‰è£…</span>
yum makecache fast <span class="token important">&amp;&amp;</span> yum install <span class="token punctuation">-</span>y elasticsearch 
<span class="token comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
vim /etc/elasticsearch/elasticsearch.yml
  <span class="token key atrule">node.master</span><span class="token punctuation">:</span> true<span class="token punctuation">[</span>åªæœ‰å…¶ä¸­çš„ä¸¤å°æ˜¯ä¸»èŠ‚ç‚¹å³å¯ï¼Œå‰©ä¸‹çš„03å¯ä»¥è®¾ç½®ä¸ºFalse<span class="token punctuation">]</span>
  <span class="token key atrule">node.name</span><span class="token punctuation">:</span> elk01 <span class="token punctuation">[</span>èŠ‚ç‚¹çš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯ä¸€ä¸ªé›†ç¾¤çš„å†…éƒ¨èŠ‚ç‚¹åç§°ä¸èƒ½ç›¸åŒ<span class="token punctuation">]</span>
  <span class="token key atrule">network.host</span><span class="token punctuation">:</span> 192.168.122.101<span class="token punctuation">[</span>æ¯ä¸ªæœºå™¨çš„å¤–éƒ¨IP<span class="token punctuation">]</span>
  <span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
  <span class="token key atrule">node.data</span><span class="token punctuation">:</span> true <span class="token punctuation">[</span>ä¸‰ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å­˜å‚¨æ•°æ®<span class="token punctuation">]</span>
  <span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> liarlee<span class="token punctuation">-</span>elk <span class="token punctuation">[</span>é›†ç¾¤çš„åç§°ä¸‰ä¸ªæœºå™¨å¿…é¡»ä¸€è‡´<span class="token punctuation">]</span>
  <span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"elk1.hayden.cluster"</span><span class="token punctuation">]</span>
  <span class="token key atrule">discovery.zen.ping.unicast.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"elk01"</span><span class="token punctuation">,</span> <span class="token string">"elk02"</span><span class="token punctuation">,</span> <span class="token string">"elk03"</span><span class="token punctuation">]</span>
  <span class="token key atrule">discovery.zen.minimum_master_nodes</span><span class="token punctuation">:</span> 1 <span class="token punctuation">[</span>æœ€å°‘çš„masterèŠ‚ç‚¹éœ€è¦æœ‰ä¸€ä¸ª<span class="token punctuation">]</span>
<span class="token comment"># å¤åˆ¶åˆ°02</span>
scp /etc/elasticsearch/elasticsearch.yml root@elk02<span class="token punctuation">:</span>/etc/elasticsearch/elasticsearch.yml
<span class="token comment"># å¤åˆ¶åˆ°03</span>
scp /etc/elasticsearch/elasticsearch.yml root@elk03<span class="token punctuation">:</span>/etc/elasticsearch/elasticsearch.yml
<span class="token comment"># å»å¯¹åº”çš„æœºå™¨ä¸Šä¿®æ”¹æœºå™¨åå’Œç›¸å…³å­—æ®µï¼Œç»“æŸï¼Œ å°è¯•å¯åŠ¨ã€‚ </span></code></pre>
</li>
<li><p>ç¡®è®¤ä¸‰ä¸ªèŠ‚ç‚¹çš„æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨curlå‘½ä»¤è®¿é—®èŠ‚ç‚¹çš„restfulAPI</span>
<span class="token function">curl</span> http://elk01:9200/_cluster/health?v
<span class="token function">curl</span> http://elk01:9200/_cluster/health?pretty
<span class="token function">curl</span> http://elk02:9200
<span class="token function">curl</span> http://elk03:9200</code></pre>
</li>
<li><p>åœ¨02ä¸Šå®‰è£…kibanaï¼Œå¹¶ä¸”å¼€æœºå¯åŠ¨ã€‚</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨yumå®‰è£…</span>
yum makecache fast <span class="token operator">&amp;&amp;</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kibana 
systemctl <span class="token builtin class-name">enable</span> kibana <span class="token operator">&amp;&amp;</span> systemctl start kibana</code></pre>
</li>
<li><p>è®¿é—®Kibanaçš„WebUIï¼Œå¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ã€‚</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é€šè¿‡APIæ£€æŸ¥</span>
<span class="token function">curl</span> http://elk02:5601
<span class="token comment"># é€šè¿‡WebUIæ£€æŸ¥</span>
firefox http://elk02:5601/</code></pre>
</li>
<li><p>é…ç½®filebeat æ— è„‘æ”¶é›†&#x2F;var&#x2F;log&#x2F;messages, å¹¶æŸ¥çœ‹ä¸ŠæŠ¥çš„çŠ¶æ€ã€‚</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…filebeatï¼Œ å¼€æœºå¯åŠ¨</span>
Download from ELK offical website <span class="token builtin class-name">:</span> filebeat-7.7.1-linux-x86_64.tar.gz
<span class="token builtin class-name">cd</span> /opt/filebeat/filebeat-7.7.1-linux-x86_64
<span class="token function">vim</span> ./filebeat.yml
  filebeat.inputs:
  - type: log
    enabled: <span class="token boolean">true</span>
    paths:
          - /var/log/messages
  output.elasticsearch:
  		hosts: <span class="token punctuation">[</span><span class="token string">"192.168.122.101:9200"</span><span class="token punctuation">]</span>
  setup.kibana:
  		host: <span class="token string">"192.168.122.102:5601"</span>
<span class="token comment"># è¿è¡Œ</span>
<span class="token builtin class-name">cd</span> /opt/filebeat/filebeat-7.7.1-linux-x86_64
<span class="token function">sudo</span> <span class="token function">nohup</span> ./filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> filebeat.yml <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></code></pre>
</li>
<li><p>è§‚å¯Ÿé›†ç¾¤çš„æ—¥å¿—çš„æ”¶é›†çŠ¶å†µï¼Œæˆ‘åœ¨è¿™ä¸ªæ—¶å€™å·²ç»æ²¡æœ‰å…¶ä»–çš„é—®é¢˜äº†â€¦. Over.</p>
</li>
</ol>
<h2 id="æœ‰äº›é—®é¢˜"><a href="#æœ‰äº›é—®é¢˜" class="headerlink" title="æœ‰äº›é—®é¢˜"></a>æœ‰äº›é—®é¢˜</h2><ol>
<li>æˆ‘è‡ªå·±çš„è™šæ‹Ÿæœºæˆ‘æ˜¯ç»å¸¸æ€§çš„æš´åŠ›å…³æœºçš„ï¼Œæ‰€ä»¥é‡åˆ°äº†èŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥ä¸æ­£ç¡®ï¼Œè¿™å¯¼è‡´æˆ‘çš„ESé›†ç¾¤å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿ ï¼Œå…¶ä»–çš„èŠ‚ç‚¹æ— æ³•åŠ å…¥ï¼Œ å¯ä»¥åœ¨ESçš„æ—¥å¿—ä¸­è§‚å¯Ÿåˆ°ï¼ŒèŠ‚ç‚¹è¯•å›¾æ·»åŠ ï¼Œä½†æ˜¯æ— æ³•æˆåŠŸåŠ å…¥ï¼Œ è¿™ä¸ªæ—¶å€™åªéœ€è¦åˆ é™¤æ— æ³•åŠ å…¥èŠ‚ç‚¹çš„Nodeæ•°æ®å³å¯ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>Application, ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>Epoll vs select vs poll vs io_uring</title>
    <url>/2022/04/19/Linux/Linux_Epoll/</url>
    <content><![CDATA[<p>selectæ–¹å¼ï¼šä½¿ç”¨fd_setç»“æ„ä½“å‘Šè¯‰å†…æ ¸åŒæ—¶ç›‘æ§é‚£äº›æ–‡ä»¶å¥æŸ„ï¼Œä½¿ç”¨é€ä¸ªæ’æŸ¥æ–¹å¼å»æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å¥æŸ„å°±ç»ªæˆ–è€…è¶…æ—¶ã€‚è¯¥æ–¹å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼šæ–‡ä»¶å¥æŸ„æ•°é‡æ˜¯æœ‰ä¸Šé™çš„ï¼Œé€ä¸ªæ£€æŸ¥ååé‡ä½ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦é‡å¤åˆå§‹åŒ–fd_setã€‚</p>
<p>pollæ–¹å¼ï¼šè¯¥æ–¹å¼ä¸»è¦è§£å†³äº†selectæ–¹å¼çš„2ä¸ªç¼ºç‚¹ï¼Œæ–‡ä»¶å¥æŸ„ä¸Šé™é—®é¢˜(é“¾è¡¨æ–¹å¼å­˜å‚¨)ä»¥åŠé‡å¤åˆå§‹åŒ–é—®é¢˜(ä¸åŒå­—æ®µæ ‡æ³¨å…³æ³¨äº‹ä»¶å’Œå‘ç”Ÿäº‹ä»¶)ï¼Œä½†æ˜¯é€ä¸ªå»æ£€æŸ¥æ–‡ä»¶å¥æŸ„æ˜¯å¦å°±ç»ªçš„é—®é¢˜ä»ç„¶æ²¡æœ‰è§£å†³ã€‚</p>
<p>epollæ–¹å¼ï¼šè¯¥æ–¹å¼å¯ä»¥è¯´æ˜¯C10Ké—®é¢˜çš„killerï¼Œä»–ä¸å»è½®è¯¢ç›‘å¬æ‰€æœ‰æ–‡ä»¶å¥æŸ„æ˜¯å¦å·²ç»å°±ç»ªã€‚epollåªå¯¹å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶å¥æŸ„æ„Ÿå…´è¶£ã€‚å…¶å·¥ä½œæœºåˆ¶æ˜¯ï¼Œä½¿ç”¨â€äº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œæ–‡ä»¶æè¿°ç¬¦fdï¼Œä¸€æ—¦è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fd, epoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥, å¹¶é€šçŸ¥åº”ç”¨ç¨‹åºã€‚è€Œä¸”epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦,å°†ç”¨æˆ·è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­, è¿™æ ·æ•°æ®åªéœ€è¦ä»å†…æ ¸ç¼“å­˜ç©ºé—´æ‹·è´ä¸€æ¬¡åˆ°ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´ã€‚è€Œä¸”epollæ˜¯é€šè¿‡å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å…±äº«å†…å­˜æ–¹å¼æ¥å®ç°äº‹ä»¶å°±ç»ªæ¶ˆæ¯ä¼ é€’çš„ï¼Œå…¶æ•ˆç‡éå¸¸é«˜ã€‚ä½†æ˜¯epollæ˜¯ä¾èµ–ç³»ç»Ÿçš„(Linux)ã€‚</p>
<p>å¼‚æ­¥I&#x2F;Oä»¥åŠWindowsï¼Œè¯¥æ–¹å¼åœ¨windowsä¸Šæ”¯æŒå¾ˆå¥½ï¼Œè¿™é‡Œå°±ä¸å…·ä½“ä»‹ç»å•¦ã€‚</p>
<p>io_uring å…¶å®æ˜¯å†…æ ¸5.10ä¹‹åå¼•è¿›çš„ä¸€ç§æ–¹å¼ï¼Œç›®å‰è¿˜æ²¡æœ‰åº”ç”¨æ˜¯ä½¿ç”¨è¿™ä¸ªæ¨¡å¼çš„ï¼Œ ä½†æ˜¯è¿™ä¸ªæ–¹å¼å¤§å¤§çš„å‡å°‘äº†åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ã€‚ æ€§èƒ½æœ‰å¢é•¿ã€‚<br>ç°åœ¨æœ‰äº†ï¼Œ æ¯”å¦‚ amazonçš„ä¸€äº›agentç±»åˆ«çš„è½¯ä»¶ã€‚ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>VMwareToolså…±äº«æ–‡ä»¶å¤¹æ–¹æ¡ˆ</title>
    <url>/2019/01/08/Linux/Linux_Fedora-InstallVMwareTools/</url>
    <content><![CDATA[<p>å‡çº§äº†VMware Workstation 15, è¿ç§»è¿‡æ¥Fedora 27çš„è™šæ‹Ÿæœºé‡Œé¢ä¸èƒ½å…±äº«å‰ªè´´æ¿ï¼Œä¸èƒ½æ‹–æ‹½å¤åˆ¶ï¼Œå…±äº«æ–‡ä»¶å¤¹è®¾ç½®ä¹‹åä¸ä¼šæŒ‚è½½åœ¨&#x2F;mnt&#x2F;hgfsç›®å½•ä¸‹ï¼Œæ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š  </p>
<span id="more"></span>

<h2 id="è§£å†³å…±äº«å‰ªè´´æ¿"><a href="#è§£å†³å…±äº«å‰ªè´´æ¿" class="headerlink" title="è§£å†³å…±äº«å‰ªè´´æ¿"></a>è§£å†³å…±äº«å‰ªè´´æ¿</h2><ol>
<li>fedora 27ä¸‹ï¼Œç›´æ¥å®‰è£…  <pre class="language-none"><code class="language-none">dnf update -y   
dnf install -y open-vm-tools-desktop   
OR  
dnf install -y open-vm-*</code></pre></li>
<li>é‡å¯è™šæ‹Ÿæœºå³å¯</li>
</ol>
<h2 id="è§£å†³æŒ‚è½½VMwareå…±äº«æ–‡ä»¶ä¸æ˜¾ç¤º"><a href="#è§£å†³æŒ‚è½½VMwareå…±äº«æ–‡ä»¶ä¸æ˜¾ç¤º" class="headerlink" title="è§£å†³æŒ‚è½½VMwareå…±äº«æ–‡ä»¶ä¸æ˜¾ç¤º"></a>è§£å†³æŒ‚è½½VMwareå…±äº«æ–‡ä»¶ä¸æ˜¾ç¤º</h2><ol>
<li>è¿™ä¸ªé—®é¢˜æˆ‘çš„è§£å†³åŠæ³•æ˜¯ï¼š å¸è½½è¿™ä¸ªæœºå™¨ä¸Šçš„open-vm-toolsæ‰€æœ‰åŒ…ï¼Œå®‰è£…VMwareæä¾›çš„Toolsï¼Œæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨  </li>
<li>é‚£ä¹ˆæ­¥éª¤å¦‚ä¸‹ï¼š <pre class="language-none"><code class="language-none">dnf remove -y opem-vm-*
reboot  
------------
åœ¨VMwareä¸­ï¼Œé€‰æ‹©å®‰è£…VMwareToolsï¼Œç„¶åæç¤ºæ¨èä½¿ç”¨Open-VM-Tooolså·¥å…·ï¼Œè¾“å…¥YESï¼Œå¼ºåˆ¶å®‰è£…  
ä¸€è·¯å›è½¦ï¼Œç›´åˆ°å‡ºç°Enjoy.
reboot</code></pre></li>
<li>é‡å¯ä¹‹åå¯ä»¥åœ¨&#x2F;mnt&#x2F;hgfsç›®å½•ä¸‹çœ‹è§å…±äº«çš„ç›®å½•äº†ï¼Œå®Œç¾  </li>
<li>å¦‚æœéœ€è¦å¯ä»¥æ·»åŠ ä¸€æ¡æŒ‡ä»¤åœ¨&#x2F;etc&#x2F;fstabæ¡ç›®ï¼Œ<pre><code>vim /etc/fstab
-   .host:/SHAREDFOLDERNAME     /mnt/hgfs   vmhgfs   defaults    0 0 
</code></pre>
</li>
<li>æ”¶å·¥</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Fedora</tag>
      </tags>
  </entry>
  <entry>
    <title>Fedoraå¼€æœºå¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–</title>
    <url>/2019/01/13/Linux/Linux_Fedora-bootspeedup/</url>
    <content><![CDATA[<p>ä¸€ç›´è®¤ä¸ºæˆ‘çš„è™šæ‹Ÿæœºæ€§èƒ½ä¸å¤Ÿæ‰€ä»¥å¯¼è‡´è‡ªå·±çš„æœºå™¨å¼€æ¡Œé¢ç¯å¢ƒï¼Œå¼€æœºæ…¢æ…¢æ…¢æ…¢æ…¢æ…¢â€¦â€¦.ä»Šå¤©ç»ˆäºå‘ç°äº†åŸå› â€¦..</p>
<h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><p>ä½¿ç”¨systemd-analyze å‘½ä»¤<br>ä½¿ç”¨systemd-analyze blame å‘½ä»¤ç½—åˆ—æ‰€æœ‰çš„å¯åŠ¨çš„æœåŠ¡å’Œè€—æ—¶</p>
<p>æˆ‘çš„æœºå™¨è€—æ—¶é—´æœ€é•¿çš„æ˜¯ </p>
<ol>
<li>dnf-makecache.service å ç”¨äº† 1min 8.124sï¼›  </li>
<li>plymouth-quit-wait.service å ç”¨äº† 1min 744ms</li>
</ol>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æ‰€ä»¥å…³é—­å®ƒï¼Œé˜»æ­¢ä»Šåå¼€æœºçš„æ—¶å€™å¯åŠ¨</p>
<pre class="language-none"><code class="language-none">systemctl disable dnf-makecache.service
systemctl disable dnf-makecache.timer</code></pre>
<p>æˆ–è€…å°±ç›´æ¥æŠŠè¿™ä¸ªæœåŠ¡æŒ‡å‘ &#x2F;dev&#x2F;null ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ æ€»ä½“æ¥è¯´å°±æ˜¯è®©ä»–å¼€æœºçš„æ—¶å€™ä¸è¦ç»§ç»­å¯åŠ¨ã€‚</p>
<pre class="language-none"><code class="language-none">systemctl mask dnf-makecache.service
systemctl mask dnf-makecache.timer
systemctl mask plymouth-quit-wait.service
systemctl mask firewalld.service</code></pre>
<p>å°½é‡ä¸ä½¿ç”¨DHCPä½¿ç”¨å›ºå®šçš„IPå¯ä»¥æé«˜å¯åŠ¨é€Ÿåº¦ï¼Œå…¶ä»–çš„ä¸éœ€è¦æœåŠ¡å¯ä»¥è‡ªè¡Œå…³é—­å³å¯  </p>
<h2 id="ä¼˜åŒ–åçš„ç»“æœ"><a href="#ä¼˜åŒ–åçš„ç»“æœ" class="headerlink" title="ä¼˜åŒ–åçš„ç»“æœ"></a>ä¼˜åŒ–åçš„ç»“æœ</h2><pre class="language-none"><code class="language-none">[root@localhost ~]# systemd-analyze 
Startup finished in 3.091s (kernel) + 1.669s (initrd) + 5.211s (userspace) &#x3D; 9.971s</code></pre>

<pre class="language-none"><code class="language-none">[root@localhost ~]# systemd-analyze blame
          2.868s vmware-tools.service
          1.317s lvm2-monitor.service
          1.115s dev-mapper-fedora\x2droot.device
          1.044s fwupd.service
           865ms NetworkManager-wait-online.service
           834ms systemd-udev-settle.service
           794ms dracut-initqueue.service
           715ms udisks2.service
           566ms sssd.service
           533ms initrd-switch-root.service
           443ms abrtd.service
           404ms systemd-udev-trigger.service
           326ms systemd-journal-flush.service
           280ms ModemManager.service
           259ms libvirtd.service
           251ms polkit.service
           209ms chronyd.service
           199ms NetworkManager.service
           192ms systemd-vconsole-setup.service
           164ms accounts-daemon.service
           149ms user@42.service
           146ms systemd-udevd.service
           143ms dracut-cmdline.service
           137ms dracut-pre-pivot.service
           137ms systemd-tmpfiles-setup-dev.service
           134ms systemd-sysctl.service
           131ms packagekit.service
           124ms gssproxy.service
           119ms fedora-readonly.service
           116ms lvm2-pvscan@8:2.service
           111ms user@0.service
           110ms avahi-daemon.service
           105ms auditd.service
           105ms dmraid-activation.service
           101ms gdm.service
            86ms systemd-user-sessions.service
            71ms fedora-import-state.service
            65ms initrd-parse-etc.service
            58ms upower.service
            51ms systemd-logind.service
            47ms var-lib-nfs-rpc_pipefs.mount
            47ms systemd-fsck@dev-disk-by\x2duuid-e37f7ce7\x2d367b\x2d4e28\x2d8c1e\x2d3b98d1e4d441.service
            46ms systemd-journald.service
            45ms systemd-tmpfiles-setup.service
            44ms boot.mount
            41ms home.mount
            41ms wpa_supplicant.service
            40ms dev-hugepages.mount
            37ms nfs-config.service
            35ms plymouth-read-write.service
            33ms rpc-statd-notify.service
            30ms systemd-remount-fs.service
            30ms systemd-fsck@dev-mapper-fedora\x2dhome.service
            27ms geoclue.service
            27ms cups.service
            26ms colord.service
            24ms livesys.service
            23ms rtkit-daemon.service
            22ms dracut-pre-udev.service
            21ms dev-mqueue.mount
            21ms dracut-shutdown.service
            20ms sysroot.mount
            20ms switcheroo-control.service
            20ms plymouth-start.service
            19ms plymouth-switch-root.service
            19ms kmod-static-nodes.service
            16ms dev-mapper-fedora\x2dswap.swap
            16ms initrd-cleanup.service
            15ms systemd-fsck-root.service
            13ms livesys-late.service
            10ms sys-kernel-debug.mount
             6ms systemd-update-utmp-runlevel.service
             6ms initrd-udevadm-cleanup-db.service
             6ms systemd-update-utmp.service
             6ms systemd-random-seed.service
             5ms tmp.mount
             2ms sys-kernel-config.mount</code></pre>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹systemdçš„ä¸€äº›ä¿¡æ¯ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token parameter variable">--failed</span> <span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å¯åŠ¨æˆ–è€…è¿è¡Œå¤±è´¥çš„æœåŠ¡</span>

systemctl status <span class="token comment"># æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨ä¹‹åçš„æ‰€æœ‰Service ä»¥åŠçŠ¶æ€</span></code></pre>
<h3 id="Mark-Tips"><a href="#Mark-Tips" class="headerlink" title="Mark Tips"></a>Mark Tips</h3><ol>
<li>axel  dnfå¯ç”¨çš„å¤šçº¿ç¨‹æ›´æ–°</li>
<li>yum-fastestmirror  è‡ªåŠ¨æŒ‘é€‰æœ€å¿«çš„æœåŠ¡å™¨æ›´æ–°</li>
<li><strong>é™„åŠ ä¸€ä¸ªsystemdçš„ä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://itxx00.github.io/blog/2014/04/08/systemd-basic-usage/">- ClickThisLink</a></strong>    </li>
<li><strong>é™„åŠ ä¸€ä¸ªplymouthçš„æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/qq_25773973/article/details/50786174">- ClickThisLink</a></strong></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Fedora</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶ç³»ç»ŸåŠæ–‡ä»¶ç®¡ç†</title>
    <url>/2019/07/24/Linux/Linux_FileManagement/</url>
    <content><![CDATA[<p>Linuxæ–‡ä»¶ç®¡ç†ç¬”è®°</p>
<p>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„è§„å®šæ˜¯éµå®ˆFHSè§„å®šçš„ã€‚</p>
<blockquote>
<p>FHS(Filesystem Hierarchy Standard) defines the directory structure and directory contents in Linux distributions.<br><a href="https://refpecs.linuxfoundation.org/fhs.shtml">FHS_Website</a></p>
</blockquote>
<p>æ ‡å‡†çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œåº”è¯¥å…·æœ‰å¦‚ä¸‹çš„ç»“æ„ï¼Œæ‰€æœ‰çš„æ–‡ä»¶ç›®å½•å‡åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚</p>
<ol>
<li>&#x2F;bin  â€“ å•ç”¨æˆ·æ¨¡å¼ä¸‹å¯è¿è¡Œçš„äºŒè¿›åˆ¶å‘½ä»¤ã€‚æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li>
<li>&#x2F;sbin  â€“ åŸºæœ¬çš„ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li>&#x2F;boot â€“ ä¸€èˆ¬ä¸ºBootLoaderFilesï¼Œä¾‹å¦‚å†…æ ¸ï¼Œramfsï¼Œgrubç­‰ç­‰ã€‚</li>
<li>&#x2F;etc  â€“ å¸¸ç”¨çš„åº”ç”¨ç¨‹åºçš„å…¨å±€é…ç½®æ–‡ä»¶ã€‚Host-specific system-wide configruationã€‚<ol>
<li>&#x2F;etc&#x2F;opt  â€“ &#x2F;optç›®å½•ä¸‹çš„ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚</li>
</ol>
</li>
<li>&#x2F;usr  â€“ åŒ…å«äº†ä¸»è¦çš„å¤šç”¨æˆ·å·¥å…·åŠåº”ç”¨ã€‚<ol>
<li>&#x2F;usr&#x2F;share â€“ Architecture-independent(shared) data.ç‹¬ç«‹æ¶æ„çš„å…±äº«æ•°æ®ã€‚</li>
<li>&#x2F;usr&#x2F;sbin â€“ éåŸºç¡€çš„ç³»ç»Ÿåº“æ–‡ä»¶ï¼Œä¾‹å¦‚ç½‘ç»œç®¡ç†çš„å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li>&#x2F;usr&#x2F;src â€“ æ”¾å†…æ ¸æºç åŠå¤´æ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li>&#x2F;usr&#x2F;bin â€“ éåŸºç¡€çš„å‘½ä»¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸éœ€è¦è¿è¡Œåœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹çš„å‘½ä»¤ã€‚</li>
<li>&#x2F;usr&#x2F;local â€“ ç‰¹æŒ‡å­˜æ”¾æœ¬åœ°çš„æ•°æ®ï¼Œä¾‹å¦‚æºç åŒ…ï¼ŒäºŒè¿›åˆ¶åŒ…ç­‰ç­‰ã€‚</li>
<li>&#x2F;usr&#x2F;lib â€“ &#x2F;usr&#x2F;bin &amp; &#x2F;usr&#x2F;sbinä¸‹çš„å‘½ä»¤æ‰€éœ€è¦çš„åº“æ–‡ä»¶ã€‚</li>
</ol>
</li>
<li>&#x2F;opt â€“ <strong>Opt</strong>ional application software packages.</li>
<li>&#x2F;mnt â€“ æ–‡ä»¶ç³»ç»Ÿçš„ä¸´æ—¶æŒ‚è½½ä½ç½®ã€‚</li>
<li>&#x2F;media â€“ é»˜è®¤çš„å¯ç§»åŠ¨è®¾å¤‡æŒ‚è½½ä½ç½®ã€‚</li>
<li>&#x2F;dev  â€“ æ‰€æœ‰çš„è®¾å¤‡ï¼Œå­—ç¬¦è®¾å¤‡ï¼Œå—è®¾å¤‡ã€‚</li>
<li>&#x2F;lib â€“ ä¸º&#x2F;bin &amp; &#x2F;sbinç›®å½•ä¸‹çš„æ–‡ä»¶åŠç¨‹åºæä¾›çš„åº“æ–‡ä»¶ã€‚</li>
<li>&#x2F;lib64 â€“ å¯æ›¿ä»£æ ¼å¼çš„åº“æ–‡ä»¶ï¼Œè¿™ä¸ªç›®å½•ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä¾‹å¦‚64ä½ç¨‹åºä¼šéœ€è¦è¿™ä¸ªç›®å½•ã€‚</li>
<li>&#x2F;tmp â€“ ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•ã€‚å®šæœŸæ¸…é™¤ã€‚</li>
<li>&#x2F;sys  â€“ è®¾å¤‡ï¼Œé©±åŠ¨ï¼Œä¸€äº›å†…æ ¸åŠŸèƒ½çš„ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>&#x2F;proc â€“ è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå±•ç¤ºè¿›ç¨‹åŠå†…æ ¸ä¿¡æ¯æ–‡ä»¶ã€‚ç³»ç»Ÿå¯åŠ¨ç›®å½•åˆ›å»ºï¼Œç³»ç»Ÿå…³é—­ç›®å½•æ¶ˆå¤±ã€‚</li>
<li>&#x2F;var â€“ å˜é‡æ–‡ä»¶ã€‚åœ¨ç³»ç»Ÿè¿è¡Œçš„è¿‡ç¨‹ä¸­åå¤å˜åŒ–çš„æ–‡ä»¶ã€‚æ¯”å¦‚æ—¥å¿—ï¼Œé‚®ä»¶ï¼Œä¿¡æ¯è¾“å‡ºç­‰ã€‚<ol>
<li>&#x2F;var&#x2F;log â€“ ç³»ç»Ÿåº”ç”¨ç¨‹åºäº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶é»˜è®¤å­˜æ”¾è·¯å¾„ã€‚</li>
<li>&#x2F;var&#x2F;spool&#x2F;mail â€“ æ¯ä¸ªç”¨æˆ·çš„é‚®ä»¶ã€‚</li>
</ol>
</li>
<li>&#x2F;home â€“ ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œsaved files, personal settings,etc.</li>
</ol>
<p>Bashæ–‡ä»¶è‰²å½©æ˜¾ç¤ºçš„å®šä¹‰åœ¨ï¼š &#x2F;etc&#x2F;DIR_COLORS , æ–‡ä»¶ä¸­å®šä¹‰äº†æ‰€æœ‰æ–‡ä»¶ç±»å‹åœ¨Bashä¸­çš„è‰²å½©ã€‚<br><strong>æ–°æŠ€å·§ï¼š æœ‰ä¸€ä¸ª$OLDPWDï¼Œå¯é€šè¿‡<code>cd -</code> åˆ‡æ¢åˆ°ä¸Šä¸€æ¬¡ç¦»å¼€çš„ç›®å½•</strong></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, FileSystem</tag>
      </tags>
  </entry>
  <entry>
    <title>Firefox-Openh264çš„é—®é¢˜</title>
    <url>/2017/12/28/Linux/Linux_Firefox-Openh264/</url>
    <content><![CDATA[<p>fedora27ä¸­Firefoxæ’ä»¶OpenH264ä¸å¯ç”¨  </p>
<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>OSï¼šFedora 27 Workstation<br>Software: Firefox 57  </p>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>Firefoxçš„æ’ä»¶ä¸­æç¤ºOpenH264 æœªå¯ç”¨ï¼Œä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œæ‰“å¼€è§†é¢‘ç«™ç‚¹ä¸èƒ½æ’­æ”¾è§†é¢‘ã€‚<br>åœ¨æ’ä»¶ä¸­è°ƒæ•´æ’ä»¶çŠ¶æ€ä¸º Always Activateï¼Œæ’ä»¶çŠ¶æ€æ”¹å˜ä¸ºå°†è¢«å®‰è£…ï¼Œä½†æ˜¯æ— è®ºçš„ç­‰å¾…å¤šä¹…è¿™ä¸ªæ’ä»¶çš„å®‰è£…çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œä¾æ—§ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚  </p>
<h1 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h1><p>æŸ¥æ‰¾åˆ°<a href="http://fedoraproject.org/wiki/OpenH264">å®˜æ–¹WIKI</a>ï¼Œç»™å‡ºäº†å¦‚ä¸‹çš„è§£å†³åŠæ³•ï¼š  </p>
<ol>
<li>åœ¨Fedoraé»˜è®¤ç»™å‡ºçš„å®˜æ–¹æºä¸­ï¼Œæœ‰ä¸€ä¸ªåç§°æ˜¯ï¼šfedora-cisco-openh264.repo</li>
<li>è¿™ä¸ªæºé»˜è®¤å…³é—­ï¼Œå¼€å¯å®ƒ<br><code>sudo dnf config-manager --set-enabled fedora-cisco-openh264</code>  </li>
<li>å®‰è£…å¦‚ä¸‹ä¸¤ä¸ªæ’ä»¶<br><code>sudo dnf install gstreamer1-plugin-openh264 mozilla-openh264</code>  </li>
<li>é‡å¯FirefoxæŸ¥çœ‹æ’ä»¶çŠ¶æ€å·²ç»æ¢å¤æ­£å¸¸ï¼Œå¯åŠ¨openh264æ’ä»¶å³å¯ã€‚</li>
</ol>
<h1 id="Openh264æµ‹è¯•é¡µ"><a href="#Openh264æµ‹è¯•é¡µ" class="headerlink" title="Openh264æµ‹è¯•é¡µ"></a>Openh264æµ‹è¯•é¡µ</h1><p><a href="http://mozilla.github.io/webrtc-landing/pc_test_h264.html">Simple mozRTCPeerConnection Video Test</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Application, Firefox</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitå¸¸è§çš„å‘½ä»¤</title>
    <url>/2023/07/12/Linux/Linux_Git%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="è¿œç«¯åˆ›å»ºï¼Œ-Cloneæœ¬åœ°"><a href="#è¿œç«¯åˆ›å»ºï¼Œ-Cloneæœ¬åœ°" class="headerlink" title="è¿œç«¯åˆ›å»ºï¼Œ Cloneæœ¬åœ°"></a>è¿œç«¯åˆ›å»ºï¼Œ Cloneæœ¬åœ°</h2><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>Githubä¸Šé¢åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œ é¡µé¢åˆ›å»ºå³å¯ï¼Œ ç„¶åè®°å½•ä¸‹URLã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">https://github.com/LiarLee/vps-init.git</code></pre>

<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>æœ¬åœ°åˆ›å»ºç›®å½•ï¼Œ å¹¶åˆå§‹åŒ–æœ¬åœ°çš„ä»“åº“è·¯å¾„ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> vps-init
<span class="token builtin class-name">cd</span> ./vps-init
<span class="token function">git</span> clone https://github.com/LiarLee/vps-init.git</code></pre>

<h3 id="å…³è”è¿œç«¯ä»“åº“"><a href="#å…³è”è¿œç«¯ä»“åº“" class="headerlink" title="å…³è”è¿œç«¯ä»“åº“"></a>å…³è”è¿œç«¯ä»“åº“</h3><p>åˆ›å»ºä¸€ä¸ªæœ¬åœ°ä»“åº“ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> vps-init
<span class="token builtin class-name">cd</span> ./vps-init
<span class="token function">git</span> init <span class="token builtin class-name">.</span>
<span class="token function">touch</span> README
<span class="token builtin class-name">echo</span> <span class="token string">"For init server use DroneCI."</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-A</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"init"</span>
<span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/LiarLee/vps-init.git
<span class="token function">git</span> <span class="token parameter variable">-u</span> origin master</code></pre>

<h3 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®ä»£ç†</span>
ec2-user@arch ~<span class="token operator">></span> gitc config <span class="token parameter variable">--global</span> http.proxy socks5://1.1.1.1:7890
ec2-user@arch ~<span class="token operator">></span> <span class="token function">git</span> config <span class="token parameter variable">--global</span> https.proxy socks5://1.1.1.1:7890
<span class="token comment"># å–æ¶ˆä»£ç†</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> <span class="token parameter variable">--unset</span> http.proxy <span class="token function">git</span> config <span class="token parameter variable">--global</span> <span class="token parameter variable">--unset</span> https.proxy</code></pre>

<h3 id="å–æ¶ˆgitçš„ç‰¹å®šæ–‡ä»¶è¿½è¸ª"><a href="#å–æ¶ˆgitçš„ç‰¹å®šæ–‡ä»¶è¿½è¸ª" class="headerlink" title="å–æ¶ˆgitçš„ç‰¹å®šæ–‡ä»¶è¿½è¸ª"></a>å–æ¶ˆgitçš„ç‰¹å®šæ–‡ä»¶è¿½è¸ª</h3><p>æœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥ä½¿ç”¨gitignoreå¿½ç•¥è¿™ä¸ªæ–‡ä»¶ï¼Œ ä½†æ˜¯å¼€å§‹åˆ›å»ºä»“åº“çš„æ—¶å€™å¯èƒ½æƒ³ä¸åˆ°ï¼Œ æ‰€ä»¥å·²ç»è¿½è¸ªçš„æ–‡ä»¶éœ€è¦å–æ¶ˆã€‚ </p>
<pre class="language-git" data-language="git"><code class="language-git">æŸ¥çœ‹è¿™ä¸ªå“ªäº›æ–‡ä»¶ä¼šå—åˆ°å½±å“ï¼š 
git rm -r -n --cached ./plugin 

åˆ é™¤è¿™äº›æ–‡ä»¶çš„è¿½è¸ªï¼š 
git rm -r --cached ./plugin
</code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Gnomeå¿«æ·é”®</title>
    <url>/2019/09/19/Linux/Linux_Gnome-Tricks/</url>
    <content><![CDATA[<p>Gnomeæ¡Œé¢ç¯å¢ƒçš„å¿«æ·é”®ã€‚</p>
<h2 id="å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªåº”ç”¨"><a href="#å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªåº”ç”¨" class="headerlink" title="å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªåº”ç”¨"></a>å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªåº”ç”¨</h2><ul>
<li>Super </li>
<li>Hot Corner<br>è¿™ä¸¤ä¸ªæˆ‘éƒ½ç”¨ï¼ŒHotCornerä¸æ˜¯ä¸€ä¸ªæŒ‰é”®ï¼Œè€Œæ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œæ˜¯æŒ‡å±å¹•çš„å³ä¸Šè§’ï¼Œé¼ æ ‡æŒ‡é’ˆç”¨åŠ›æ’è¿‡å»ï¼Œæ’å¼€æ‰€æœ‰çš„åº”ç”¨çª—å£ã€‚åœ¨Gnomeçš„ç¯å¢ƒä¸­ï¼ŒSuperæ˜¯ä¸€ä¸ªè¶…æ–¹ä¾¿çš„é”®ï¼Œå½“æˆ‘éœ€è¦æ‰“å¼€vscodeçš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä»»æ„æ—¶å€™é€šè¿‡super+code+Enterç›´æ¥æ‰“å¼€vscodeåº”ç”¨ã€‚å½“æŒ‰ä¸‹Superçš„æ—¶å€™ä¼šè‡ªåŠ¨è§¦å‘ä¸€ä¸ªå…¨å±€çš„æœç´¢ï¼Œå¯ä»¥é€šè¿‡Superå¿«é€ŸæŸ¥çœ‹è‡ªå·±çš„éœ€è¦çš„æ–‡ä»¶æˆ–è€…åº”ç”¨ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯æˆ‘æœ€å–œæ¬¢Gnomeçš„åœ°æ–¹ã€‚</li>
</ul>
<h2 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h2><ul>
<li>Alt+F2<br>æœ€å¸¸ç”¨çš„å°±æ˜¯é‡å¯Gnomeç¯å¢ƒï¼Œé€šè¿‡Alt+F2 è°ƒå‡ºçš„å‘½ä»¤çª—å£ï¼Œä½¿ç”¨rå‘½ä»¤é‡å¯Gnomeã€‚</li>
</ul>
<h2 id="åº”ç”¨çš„åˆ‡æ¢"><a href="#åº”ç”¨çš„åˆ‡æ¢" class="headerlink" title="åº”ç”¨çš„åˆ‡æ¢"></a>åº”ç”¨çš„åˆ‡æ¢</h2><ul>
<li>Super+TAB<br>ä½¿ç”¨Super+TABå¯ä»¥åœ¨åº”ç”¨ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚å¦‚æœCover-alt-tabçš„æ’ä»¶ï¼Œè¿˜æœ‰ä¸‰ç»´åŠ¨ç”»ã€‚</li>
<li>Super+&#96;<br>è¿™ä¸ªç»„åˆé”®æ˜¯åˆ‡æ¢åº”ç”¨å†…çª—å£çš„ï¼Œæˆ‘è‡ªå·±ç”¨çš„ä¸å¤šã€‚</li>
</ul>
<h2 id="å¿«é€Ÿæ˜¾ç¤ºä¸»å±å¹•åº”ç”¨èœå•"><a href="#å¿«é€Ÿæ˜¾ç¤ºä¸»å±å¹•åº”ç”¨èœå•" class="headerlink" title="å¿«é€Ÿæ˜¾ç¤ºä¸»å±å¹•åº”ç”¨èœå•"></a>å¿«é€Ÿæ˜¾ç¤ºä¸»å±å¹•åº”ç”¨èœå•</h2><ul>
<li>Super+a<br>å¿«é€Ÿæ˜¾ç¤ºä¸»å±å¹•çš„æ‰€æœ‰åº”ç”¨ç¨‹åºé¡µã€‚</li>
</ul>
<h2 id="åˆ‡æ¢å·¥ä½œåŒº"><a href="#åˆ‡æ¢å·¥ä½œåŒº" class="headerlink" title="åˆ‡æ¢å·¥ä½œåŒº"></a>åˆ‡æ¢å·¥ä½œåŒº</h2><ul>
<li>Super+PageUP or PageDown</li>
<li>Ctrl+Alt+UP or DOWN<br>å¯ä»¥åœ¨å¤šä¸ªå·¥ä½œåŒºä¹‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œä½†æ˜¯æˆ‘è‡ªå·±å¸¸ç”¨çš„æ˜¯ç¬¬äºŒç§ã€‚é”®ä½ä¸Šèˆ’æœä¸€äº›ã€‚</li>
</ul>
<h2 id="ç§»åŠ¨çª—å£åˆ°å…¶ä»–å·¥ä½œåŒº"><a href="#ç§»åŠ¨çª—å£åˆ°å…¶ä»–å·¥ä½œåŒº" class="headerlink" title="ç§»åŠ¨çª—å£åˆ°å…¶ä»–å·¥ä½œåŒº"></a>ç§»åŠ¨çª—å£åˆ°å…¶ä»–å·¥ä½œåŒº</h2><ul>
<li>Ctrl+Alt+Shift+UP or Down</li>
<li>Super+Shift+PageUP or PageDown<br>å°†å½“å‰çš„ç„¦ç‚¹çª—å£ç§»åŠ¨åˆ°å‰åçš„å·¥ä½œåŒºï¼Œå¹¶ä¿æŒå½“å‰çª—å£çš„ç„¦ç‚¹ä¸å˜ã€‚è¿™ä¸ªä¹Ÿæ˜¯ç‰¹åˆ«å¥½ç”¨çš„å¿«æ·é”®ã€‚</li>
</ul>
<h2 id="å‘¼å‡ºé€šçŸ¥ä¸­å¿ƒå’Œæ—¥å†"><a href="#å‘¼å‡ºé€šçŸ¥ä¸­å¿ƒå’Œæ—¥å†" class="headerlink" title="å‘¼å‡ºé€šçŸ¥ä¸­å¿ƒå’Œæ—¥å†"></a>å‘¼å‡ºé€šçŸ¥ä¸­å¿ƒå’Œæ—¥å†</h2><ul>
<li>Super+m<br>è¿™ä¸ªå¿«æ·é”®æœ€æ—©çš„Gnomeä¸Šæ˜¯é€šçŸ¥æ ï¼Œç°åœ¨ç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œæ¯•ç«ŸGnomeå·²ç»ä¸æ˜¯ä¸‹æ–¹çš„é€šçŸ¥æ äº†ï¼Œæ˜¯ä¸Šé¢çš„æ—¥å†åŠ ä¸Šé€šçŸ¥ä¸­å¿ƒçš„æ–¹å¼äº†ã€‚æˆ‘è‡ªå·±çš„ç”¨çš„æ—¶å€™å¤§éƒ¨åˆ†æ˜¯çœ‹æ—¶é—´å’Œæ—¥å†ã€‚</li>
</ul>
<h2 id="æˆªå›¾"><a href="#æˆªå›¾" class="headerlink" title="æˆªå›¾"></a>æˆªå›¾</h2><ul>
<li>PrintScreen<br>æˆªå–æ‰€æœ‰å±å¹•å†…å®¹ï¼Œä¿å­˜åˆ°æ–‡ä»¶ã€‚</li>
<li>Alt+PrintScreen<br>æˆªå–å½“å‰çª—å£çš„å†…å®¹ï¼Œä¿å­˜åˆ°æ–‡ä»¶ã€‚</li>
<li>Shift+PrintScreen<br>æˆªå–é€‰æ‹©çš„åŒºåŸŸï¼Œä¿å­˜åˆ°æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>NOTEï¼š æœ€æ–¹ä¾¿çš„å°±æ˜¯ï¼Œä½¿ç”¨Ctrl+Shift PrintScreenå’ŒCtrl+PrintScreen å¯ä»¥ç›´æ¥é€‰å–çš„åŒºåŸŸæˆªå›¾ï¼Œå°†æˆªå›¾ä¿å­˜åœ¨å‰ªè´´æ¿ï¼Œæˆªå›¾å®Œæˆç›´æ¥ç²˜è´´å³å¯ã€‚</strong></p>
<h2 id="æœ€å¤§åŒ–æœ€å°åŒ–å’Œåˆ†å±"><a href="#æœ€å¤§åŒ–æœ€å°åŒ–å’Œåˆ†å±" class="headerlink" title="æœ€å¤§åŒ–æœ€å°åŒ–å’Œåˆ†å±"></a>æœ€å¤§åŒ–æœ€å°åŒ–å’Œåˆ†å±</h2><ul>
<li>Super+UP<br>æœ€å¤§åŒ–åˆ°é“ºæ»¡å±å¹•</li>
<li>Super+LEFT<br>é å·¦å æ®ä¸€èˆ¬å±å¹•</li>
<li>Super+RIGHT<br>é å³å æ®ä¸€èˆ¬å±å¹•</li>
<li>Super+H<br>æœ€å°åŒ–ï¼Œéšè—</li>
</ul>
<p>è¿™äº›åŸºæœ¬ä¸Šå°±æ˜¯æˆ‘è§‰å¾—å¸¸ç”¨è€Œä¸”å¥½ç”¨çš„å¿«æ·é”®å•¦ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œåœ¨è®¾ç½®é‡Œé¢ï¼Œä¹Ÿå¯ä»¥éšä¾¿è®¾ç½®ï¼Œä½†æ˜¯é‚£æ ·çš„è¯å°±ä¸æ˜¯æ‹¿æ¥ç›´æ¥å¯ä»¥ç”¨çš„å•¦ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>grub2æ‰‹åŠ¨ä¿®å¤å¼•å¯¼é”™è¯¯</title>
    <url>/2018/01/09/Linux/Linux_Grub2repair/</url>
    <content><![CDATA[<p>grub2å¼•å¯¼é”™è¯¯çš„æ‰‹åŠ¨è§£å†³æ–¹æ³•</p>
<h2 id="Grubæ˜¯ä»€ä¹ˆ"><a href="#Grubæ˜¯ä»€ä¹ˆ" class="headerlink" title="Grubæ˜¯ä»€ä¹ˆ"></a>Grubæ˜¯ä»€ä¹ˆ</h2><ul>
<li><p>å¼•ç”¨ç™¾åº¦ç™¾ç§‘    </p>
<blockquote>
<p>GNU GRUBï¼ˆç®€ç§°â€œGRUBâ€ï¼‰æ˜¯ä¸€ä¸ªæ¥è‡ªGNUé¡¹ç›®çš„å¯åŠ¨å¼•å¯¼ç¨‹åºã€‚GRUBæ˜¯å¤šå¯åŠ¨è§„èŒƒçš„å®ç°ï¼Œå®ƒå…è®¸ç”¨æˆ·å¯ä»¥åœ¨è®¡ç®—æœºå†…åŒæ—¶æ‹¥æœ‰å¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œå¹¶åœ¨è®¡ç®—æœºå¯åŠ¨æ—¶é€‰æ‹©å¸Œæœ›è¿è¡Œçš„æ“ä½œç³»ç»Ÿã€‚GRUBå¯ç”¨äºé€‰æ‹©æ“ä½œç³»ç»Ÿåˆ†åŒºä¸Šçš„ä¸åŒå†…æ ¸ï¼Œä¹Ÿå¯ç”¨äºå‘è¿™äº›å†…æ ¸ä¼ é€’å¯åŠ¨å‚æ•°ã€‚<br>GNU GRUBçš„å‰èº«ä¸ºGrand Unified Bootloaderã€‚å®ƒä¸»è¦ç”¨äºç±»Unixç³»ç»Ÿï¼›åŒå¤§å¤šLinuxå‘è¡Œç‰ˆä¸€æ ·ï¼ŒGNUç³»ç»Ÿä¹Ÿé‡‡ç”¨GNU GRUBä½œä¸ºå®ƒçš„å¯åŠ¨å™¨ã€‚Solarisä»10 1&#x2F;06ç‰ˆå¼€å§‹åœ¨x86ç³»ç»Ÿä¸Šä¹Ÿé‡‡ç”¨GNU GRUBä½œä¸ºå¯åŠ¨å™¨ã€‚  </p>
</blockquote>
</li>
<li><p>å¼•ç”¨fedoraå®˜æ–¹wiki  </p>
<blockquote>
<p>GRUB 2 is the latest version of GNU GRUB, the GRand Unified Bootloader. A bootloader is the first software program that runs when a computer starts. It is responsible for loading and transferring control to the operating system kernel, (Linux, in the case of Fedora). The kernel, in turn, initializes the rest of the operating system.<br>GRUB 2 has replaced what was formerly known as GRUB (i.e. version 0.9x), which has, in turn, become GRUB Legacy.<br>Starting with Fedora 16, GRUB 2 is the default bootloader on x86 BIOS systems. For upgrades of BIOS systems the default is also to install GRUB 2, but you can opt to skip bootloader configuration entirely.</p>
</blockquote>
</li>
</ul>
<h2 id="ä¿®å¤grub2å¼•å¯¼ç¨‹åºå¼€æœºå¤±è´¥"><a href="#ä¿®å¤grub2å¼•å¯¼ç¨‹åºå¼€æœºå¤±è´¥" class="headerlink" title="ä¿®å¤grub2å¼•å¯¼ç¨‹åºå¼€æœºå¤±è´¥"></a>ä¿®å¤grub2å¼•å¯¼ç¨‹åºå¼€æœºå¤±è´¥</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ç³»ç»Ÿçš„grubæ–‡ä»¶ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æ¯”å¦‚æˆ‘ä»¬è¿›è¡Œäº†ç³»ç»Ÿè®¾ç½®çš„æ›´æ”¹æˆ–è€…æ–‡ä»¶çš„è¯¯åˆ é™¤ä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹grubè¿›è¡Œæ‰‹åŠ¨çš„é…ç½®ï¼Œæ‰èƒ½æ˜¯è®¡ç®—æœºæ­£ç¡®çš„è¿›å…¥ç³»ç»Ÿä¹‹ä¸­ï¼Œè¿›å…¥ç³»ç»Ÿä¹‹ååªè¦é‡æ–°ç”Ÿæˆgrubå¼•å¯¼æ–‡ä»¶ï¼Œå°±å¯ä»¥è®©ç³»ç»Ÿé‡å¯è‡ªåŠ¨å®Œæˆå¼•å¯¼è¿›å…¥ç³»ç»Ÿäº†ã€‚  </p>
<h3 id="æŒ‡å‡º-x2F-bootä½ç½®"><a href="#æŒ‡å‡º-x2F-bootä½ç½®" class="headerlink" title="æŒ‡å‡º&#x2F;bootä½ç½®"></a>æŒ‡å‡º&#x2F;bootä½ç½®</h3><ol>
<li>æŒ‡å®šgrubçš„ç¡¬ç›˜å¼•å¯¼åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯&#x2F;bootæ‰€åœ¨çš„ç¡¬ç›˜åˆ†åŒº<br><code>grub&gt; root (hd0,0)</code></li>
</ol>
<h3 id="æŒ‡å‡ºvmlinuzå†…æ ¸æ–‡ä»¶"><a href="#æŒ‡å‡ºvmlinuzå†…æ ¸æ–‡ä»¶" class="headerlink" title="æŒ‡å‡ºvmlinuzå†…æ ¸æ–‡ä»¶"></a>æŒ‡å‡ºvmlinuzå†…æ ¸æ–‡ä»¶</h3><ol>
<li>æŒ‡å‡ºkernelæ‰€åœ¨çš„åˆ†åŒºï¼Œä¸»è¦æ˜¯vmlinuzå†…æ ¸æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®<br><code>grub&gt; kernel /vmlinuz</code></li>
<li>æŒ‡å‡ºinitrdæ‰€åœ¨çš„åˆ†åŒºï¼ŒæŒ‡å®šåˆå§‹åŒ–æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®<br><code>grub&gt; initrd /initrd</code></li>
</ol>
<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><ol>
<li>æ–‡ä»¶é”å®šæˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å¯åŠ¨ç³»ç»Ÿ<br><code>grub&gt; boot</code></li>
</ol>
<h2 id="åœ¨ç³»ç»Ÿä¸­é‡æ–°å®‰è£…å’Œæ›´æ”¹grub2"><a href="#åœ¨ç³»ç»Ÿä¸­é‡æ–°å®‰è£…å’Œæ›´æ”¹grub2" class="headerlink" title="åœ¨ç³»ç»Ÿä¸­é‡æ–°å®‰è£…å’Œæ›´æ”¹grub2"></a>åœ¨ç³»ç»Ÿä¸­é‡æ–°å®‰è£…å’Œæ›´æ”¹grub2</h2><h3 id="å®‰è£…æˆ–è€…é‡æ–°å®‰è£…grub2ï¼ˆéå¿…é¡»-å¦‚æœæœ‰éœ€è¦çš„æ—¶å€™æ‰§è¡Œï¼‰"><a href="#å®‰è£…æˆ–è€…é‡æ–°å®‰è£…grub2ï¼ˆéå¿…é¡»-å¦‚æœæœ‰éœ€è¦çš„æ—¶å€™æ‰§è¡Œï¼‰" class="headerlink" title="å®‰è£…æˆ–è€…é‡æ–°å®‰è£…grub2ï¼ˆéå¿…é¡»-å¦‚æœæœ‰éœ€è¦çš„æ—¶å€™æ‰§è¡Œï¼‰"></a>å®‰è£…æˆ–è€…é‡æ–°å®‰è£…grub2ï¼ˆéå¿…é¡»-å¦‚æœæœ‰éœ€è¦çš„æ—¶å€™æ‰§è¡Œï¼‰</h3><p>å®‰è£…grub2åˆ°ç¡¬ç›˜åˆ†åŒºï¼Œä¸€èˆ¬ä¸ºç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºçš„å¼€å§‹ä½ç½®  </p>
<ol>
<li>ä¼ ç»Ÿå¼•å¯¼æ–¹å¼å®‰è£…grub2<br><code>[root@localhost /]# grub2-install /dev/sda</code>  </li>
<li>EFIå¼•å¯¼å®‰è£…grub2<br><code>[root@localhost /]# dnf reinstall grub2-efi shim</code></li>
</ol>
<h3 id="é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶"><a href="#é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶" class="headerlink" title="é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶"></a>é‡æ–°ç”Ÿæˆgrubé…ç½®æ–‡ä»¶</h3><p>ä½¿ç”¨grub2-mkconfigç”Ÿæˆæ–°çš„grub2é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶æŒ‡å®šå¼•å¯¼æ—¶è¯»å–è¯¥æ–‡ä»¶<br>ä¸åŒçš„å®‰è£…æ–¹å¼æœ‰ä¸åŒçš„å‘½ä»¤  </p>
<ol>
<li>æ ‡å‡†çš„ä¼ ç»Ÿå¼•å¯¼å®‰è£…æ–¹å¼<br><code>[root@localhost /]# grub2-mkconfig -o /boot/grub2/grub.cfg</code></li>
<li>EFIå¼•å¯¼æ–¹å¼<br><code>[root@localhost /]# grub2-mkconfig -o /boot/efi/EFI/fedora/grub.cfg</code></li>
</ol>
<h2 id="Windows-amp-LinuxåŒç³»ç»Ÿä¿®å¤"><a href="#Windows-amp-LinuxåŒç³»ç»Ÿä¿®å¤" class="headerlink" title="Windows&amp;LinuxåŒç³»ç»Ÿä¿®å¤"></a>Windows&amp;LinuxåŒç³»ç»Ÿä¿®å¤</h2><p>windowså’Œlinuxçš„åŒç³»ç»Ÿè¯·æ³¨æ„å®‰è£…é¡ºåºï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šéº»çƒ¦  </p>
<ul>
<li>å…ˆå®‰è£…windows - ç„¶åå®‰è£…linux</li>
</ul>
<p>å¦‚æœå…ˆå®‰è£…äº†linuxï¼Œé‚£ä¹ˆåœ¨å®‰è£…windowsä¹‹åï¼Œç³»ç»Ÿçš„MBRä¼šè¢«windowsè¦†å†™ï¼Œå¯¼è‡´linuxç³»ç»Ÿæ— æ³•æ­£å¸¸å¼•å¯¼ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨livecdè¿›è¡Œä¿®å¤grub2ï¼Œè®©grub2é‡æ–°å®‰è£…å¹¶ä¸”æ§åˆ¶å¼•å¯¼ç³»ç»Ÿçš„åˆ†åŒº  </p>
<hr>
<h2 id="åˆ é™¤ç³»ç»Ÿæ›´æ–°ä¹‹åå¤šä½™çš„å¯åŠ¨é¡¹"><a href="#åˆ é™¤ç³»ç»Ÿæ›´æ–°ä¹‹åå¤šä½™çš„å¯åŠ¨é¡¹" class="headerlink" title="åˆ é™¤ç³»ç»Ÿæ›´æ–°ä¹‹åå¤šä½™çš„å¯åŠ¨é¡¹"></a>åˆ é™¤ç³»ç»Ÿæ›´æ–°ä¹‹åå¤šä½™çš„å¯åŠ¨é¡¹</h2><p>ç³»ç»Ÿæ›´æ–°ä¹‹åæ€»æ˜¯ä¼šå¤šå¾ˆå¤šçš„æ—§ç‰ˆæœ¬å†…æ ¸çš„å¯åŠ¨é¡¹ï¼Œæ¯æ¬¡å¯åŠ¨çš„æ—¶å€™çœ‹èµ·æ¥éƒ½å¾ˆä¹±ï¼Œç®€å•æ“ä½œå°±å¯ä»¥å»æ‰å¤šä½™çš„å¯åŠ¨é¡¹ï¼Œå¦‚ä¸‹ï¼š  </p>
<h3 id="æš´åŠ›æ–¹å¼"><a href="#æš´åŠ›æ–¹å¼" class="headerlink" title="æš´åŠ›æ–¹å¼"></a>æš´åŠ›æ–¹å¼</h3><ol>
<li><p>åœ¨bootç›®å½•ä¸‹é¢å¼ºåˆ¶åˆ é™¤å†…æ ¸æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç”Ÿæˆgrub2.cfgå³å¯  </p>
<pre class="language-none"><code class="language-none">[root@localhost boot]# rm -rf vmlinuz-4.13.9-300.fc27.x86_64   
[root@localhost boot]# rm -rf vmlinuz-4.14.5-300.fc27.x86_64  </code></pre>
</li>
<li><p>é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š  </p>
<pre class="language-none"><code class="language-none">[root@localhost boot]# grub2-mkconfig -o &#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;fedora&#x2F;grub.cfg
Generating grub configuration file ...
Found linux image: &#x2F;boot&#x2F;vmlinuz-4.14.11-300.fc27.x86_64
Found initrd image: &#x2F;boot&#x2F;initramfs-4.14.11-300.fc27.x86_64.img
Found linux image: &#x2F;boot&#x2F;vmlinuz-0-rescue-2fbfdacc99ad4255953ae8b2ec521e9d
Found initrd image: &#x2F;boot&#x2F;initramfs-0-rescue-2fbfdacc99ad4255953ae8b2ec521e9d.img
done</code></pre></li>
</ol>
<h3 id="æ­£ç¡®æ–¹å¼"><a href="#æ­£ç¡®æ–¹å¼" class="headerlink" title="æ­£ç¡®æ–¹å¼"></a>æ­£ç¡®æ–¹å¼</h3><ul>
<li>ä½¿ç”¨dnfå‘½ä»¤å¸è½½æ—§å†…æ ¸ï¼š  <pre class="language-none"><code class="language-none">[root@localhost &#x2F;]# dnf remove kernel-4.13.9-300.fc27.x86_64  
[root@localhost &#x2F;]# dnf remove kernel-4.14.5-300.fc27.x86_64  </code></pre></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>GRUB2, Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Harbor Http å®‰è£…éƒ¨ç½²</title>
    <url>/2021/09/27/Linux/Linux_HarborInstallation/</url>
    <content><![CDATA[<p> Harborçš„éƒ¨ç½²è®°å½•ã€‚</p>
<h1 id="Harbor-Info"><a href="#Harbor-Info" class="headerlink" title="Harbor Info"></a>Harbor Info</h1><ul>
<li><a href="https://github.com/goharbor/harbor/releases/tag/v2.3.2">Harbor é¡¹ç›®åœ°å€</a></li>
</ul>
<h1 id="Harbor-HTTPéƒ¨ç½²"><a href="#Harbor-HTTPéƒ¨ç½²" class="headerlink" title="Harbor HTTPéƒ¨ç½²"></a>Harbor HTTPéƒ¨ç½²</h1><p>å› ä¸ºæ˜¯ä¸´æ—¶ä½¿ç”¨ï¼Œ æ‰€ä»¥ç›´æ¥ç»™äº†HTTPçš„æƒé™ï¼Œ ä¸ºçš„æ˜¯ä¸èµ°å…¬ç½‘éƒ¨ç½² CEPH Clusterï¼Œ CEPHåœ¨BootStrapä¹‹åä¼šé»˜è®¤å»å…¬ç½‘çš„é•œåƒä»“åº“å°è¯•Pullé•œåƒå¹¶ä¸”æ ¡éªŒé•œåƒå’ŒæœåŠ¡ï¼Œæ‰€ä»¥ç»™ä¸€ä¸ªç§æœ‰çš„ä»“åº“ï¼Œ ç›´æ¥å»æ‰¾ç§æœ‰ä»“åº“å°±å…äº†å…¬ç½‘è®¿é—®å¡é›†ç¾¤çš„æ­£å¸¸å¯åŠ¨çš„æ­¥éª¤ã€‚</p>
<h2 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="headerlink" title="ä¸‹è½½è§£å‹"></a>ä¸‹è½½è§£å‹</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">wget</span> https://github.com/goharbor/harbor/releases/download/v2.3.2/harbor-offline-installer-v2.3.2.tgz
~<span class="token punctuation">]</span>$ <span class="token function">mv</span> harbor-offline-installer-v2.3.2.tgz /opt 
~<span class="token punctuation">]</span>$ <span class="token function">tar</span> zxvf /opt/harbor-offline-installer-v2.3.2.tgz</code></pre>

<h2 id="å¤åˆ¶ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#å¤åˆ¶ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="å¤åˆ¶ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>å¤åˆ¶ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">cp</span> /opt/harbor/harbor.yml.tmpl /opt/harbor/harbor.yml</code></pre>

<h2 id="é…ç½®é»˜è®¤çš„å­˜å‚¨ä½ç½®"><a href="#é…ç½®é»˜è®¤çš„å­˜å‚¨ä½ç½®" class="headerlink" title="é…ç½®é»˜è®¤çš„å­˜å‚¨ä½ç½®"></a>é…ç½®é»˜è®¤çš„å­˜å‚¨ä½ç½®</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># æ³¨é‡Šæ‰httpsçš„éƒ¨åˆ†ï¼Œå¦‚æœéœ€è¦httpsçš„è¯ç­¾å‘ä¸€ä¸ªè¯ä¹¦å†™è·¯å¾„åœ¨é…ç½®æ–‡ä»¶ä¸­</span>
<span class="token comment"># ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨ä½ç½®</span>
<span class="token key atrule">data_volume</span><span class="token punctuation">:</span> /opt/harbor/image_store</code></pre>
<h2 id="æŒ‡å®šHarborå¯¹å¤–æä¾›æœåŠ¡çš„åŸŸå"><a href="#æŒ‡å®šHarborå¯¹å¤–æä¾›æœåŠ¡çš„åŸŸå" class="headerlink" title="æŒ‡å®šHarborå¯¹å¤–æä¾›æœåŠ¡çš„åŸŸå"></a>æŒ‡å®šHarborå¯¹å¤–æä¾›æœåŠ¡çš„åŸŸå</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># ä¿®æ”¹Harborçš„åŸŸåæˆ–è€…ä¸»æœºå(éœ€è¦å¯¹åº”çš„è§£æ)ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨IPåœ°å€</span>
<span class="token comment"># The IP address or hostname to access admin UI and registry service.</span>
<span class="token comment"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span>
<span class="token key atrule">hostname</span><span class="token punctuation">:</span> harbor.local</code></pre>
<h2 id="è®¾ç½®harbor-Adminçš„å¯†ç "><a href="#è®¾ç½®harbor-Adminçš„å¯†ç " class="headerlink" title="è®¾ç½®harbor Adminçš„å¯†ç "></a>è®¾ç½®harbor Adminçš„å¯†ç </h2><p>å¯ä»¥ç™»å½•Dashboard æˆ–è€… Pullé•œåƒ</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Remember Change the admin password from UI after launching Harbor.</span>
<span class="token key atrule">harbor_admin_password</span><span class="token punctuation">:</span> Harbor12345</code></pre>

<h2 id="åˆ›å»ºharborå­˜å‚¨é•œåƒçš„ç›®å½•"><a href="#åˆ›å»ºharborå­˜å‚¨é•œåƒçš„ç›®å½•" class="headerlink" title="åˆ›å»ºharborå­˜å‚¨é•œåƒçš„ç›®å½•"></a>åˆ›å»ºharborå­˜å‚¨é•œåƒçš„ç›®å½•</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºHarborçš„å­˜å‚¨ç›®å½•ï¼Œ å¯ä»¥è¿œç¨‹æŒ‡å®šåˆ°Cephfsä¸Šé¢</span>
~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> /opt/harbor/image_store</code></pre>

<h2 id="é…ç½®Docker-ce-æ¸…åçš„é•œåƒæº"><a href="#é…ç½®Docker-ce-æ¸…åçš„é•œåƒæº" class="headerlink" title="é…ç½®Docker-ce æ¸…åçš„é•œåƒæº"></a>é…ç½®Docker-ce æ¸…åçš„é•œåƒæº</h2><p>è¿™ä¸ªé…ç½®æ˜¯ç»™Centos &#x2F; RHELæ¥ä½¿ç”¨çš„ï¼Œæ¥è‡ªæ¸…åçš„Repo Help</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ·»åŠ repoæ–‡ä»¶ï¼Œå’Œä¿®æ”¹é…ç½®åˆ°Tsinghua repo</span>
~<span class="token punctuation">]</span>$ <span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo

<span class="token comment"># å®‰è£…Docker-ce</span>
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce

<span class="token comment"># CENTOS8 STREAM ç‰¹æ®Šçš„é…ç½®ï¼Œéœ€è¦å¸è½½ podman å’Œ Buildah</span>
~<span class="token punctuation">]</span>$ dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce <span class="token parameter variable">--allowerasing</span>

<span class="token comment"># å¼€æœºå¯åŠ¨</span>
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl restart <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>

<span class="token comment"># å®‰è£…Docker-compose ï¼Œå› ä¸ºCentOS8 é»˜è®¤æ˜¯æ²¡æœ‰Docker-composeçš„ ï¼Œ æŒ‰ç…§å®˜ç½‘çš„æµç¨‹èµ°å°±å¯ä»¥ã€‚</span>
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose</code></pre>
<h2 id="å®‰è£…harbor"><a href="#å®‰è£…harbor" class="headerlink" title="å®‰è£…harbor"></a>å®‰è£…harbor</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /opt/harbor
/opt/harbor<span class="token punctuation">]</span>$ ./install.sh</code></pre>

<h1 id="å¯åŠ¨Harbor"><a href="#å¯åŠ¨Harbor" class="headerlink" title="å¯åŠ¨Harbor"></a>å¯åŠ¨Harbor</h1><p>ç›´æ¥ä½¿ç”¨Docker-composeå¯åŠ¨å³å¯ï¼Œå¦‚æœéœ€è¦çš„è¯å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šé•œåƒæ‰«æå™¨ï¼Œæ¥è¿›è¡Œé•œåƒçš„æ¼æ´æ‰«æã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥Harborè¿è¡Œæ‰€åœ¨çš„ç›®å½•</span>
~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /opt/harbor	

<span class="token comment"># ä½¿ç”¨Docker-composeçš„å¯åŠ¨å‘½ä»¤ï¼Œé€‚ç”¨äºæœåŠ¡åœæ­¢ æˆ–è€… Docker é‡å¯çš„æ—¶å€™ï¼Œ å®¹å™¨æ²¡æœ‰æ­£å¸¸è¿è¡Œã€‚</span>
~<span class="token punctuation">]</span>$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> <span class="token parameter variable">-f</span> /opt/harbor/docker-compose.yaml

<span class="token comment"># æŸ¥çœ‹å®¹å™¨çš„å¯åŠ¨çŠ¶æ€</span>
/opt/harbor<span class="token punctuation">]</span>$ <span class="token function">docker-compose</span> <span class="token function">ps</span>
/opt/harbor<span class="token punctuation">]</span>$ <span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token function">docker-compose</span> <span class="token function">ps</span>

<span class="token comment"># é€šè¿‡Docker-composeåœæ­¢harbor</span>
/opt/harbor<span class="token punctuation">]</span>$ <span class="token function">docker-compose</span> down</code></pre>

<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><ol>
<li>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®harborçš„åœ°å€ é»˜è®¤çš„ç«¯å£80 </li>
<li>åœ¨æ‰€æœ‰dockerèŠ‚ç‚¹ä¸Šé…ç½®ä¸å®‰å…¨çš„ç§æœ‰ä»“åº“ï¼Œdocker login [HARBORIP:PORT]</li>
<li>åœ¨æ‰€æœ‰podmanèŠ‚ç‚¹ä¸Šé…ç½®ä¸å®‰å…¨çš„ç§æœ‰ä»“åº“ï¼Œpodman login [HARBORIP:PORT]</li>
<li>æç¤ºLogin Successedï¼Œ ç™»å½•æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸pullé•œåƒäº†</li>
</ol>
<h1 id="Cephadm-Bootstrap"><a href="#Cephadm-Bootstrap" class="headerlink" title="Cephadm Bootstrap"></a>Cephadm Bootstrap</h1><h2 id="ç¼–è¾‘cephadmæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹çš„é•œåƒåç§°ï¼Œå’Œä»“åº“çš„å‰ç¼€"><a href="#ç¼–è¾‘cephadmæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹çš„é•œåƒåç§°ï¼Œå’Œä»“åº“çš„å‰ç¼€" class="headerlink" title="ç¼–è¾‘cephadmæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹çš„é•œåƒåç§°ï¼Œå’Œä»“åº“çš„å‰ç¼€"></a>ç¼–è¾‘cephadmæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹çš„é•œåƒåç§°ï¼Œå’Œä»“åº“çš„å‰ç¼€</h2><p>è¿™é‡Œå…¶å®è¿˜æ˜¯éœ€è¦å†æµ‹è¯•çš„ï¼Œ æŒ‰ç…§è¿™ä¸ªè„šæœ¬çš„é€»è¾‘ï¼Œ åº”è¯¥ä¼šæŠŠæ‰€æœ‰çš„é•œåƒéƒ½ä»æŒ‡å®šçš„ä»“åº“Pullä¸‹æ¥ï¼Œä½†æ˜¯æˆ‘æ‰§è¡Œçš„æ—¶å€™åªæœ‰ceph&#x2F;ceph:v16ä¸€ä¸ªé•œåƒä¸‹æ¥äº†ï¼Œ æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹å„¿é—®é¢˜çš„ã€‚</p>
<pre class="language-python" data-language="python"><code class="language-python">DEFAULT_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/ceph:v16'</span>
DEFAULT_IMAGE_IS_MASTER <span class="token operator">=</span> <span class="token boolean">False</span>
DEFAULT_IMAGE_RELEASE <span class="token operator">=</span> <span class="token string">'pacific'</span>
DEFAULT_PROMETHEUS_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/prometheus:v2.18.1'</span>
DEFAULT_NODE_EXPORTER_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/node-exporter:v0.18.1'</span>
DEFAULT_ALERT_MANAGER_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/alertmanager:v0.20.0'</span>
DEFAULT_GRAFANA_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/ceph-grafana:6.7.4'</span>
DEFAULT_HAPROXY_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/haproxy:2.3'</span>
DEFAULT_KEEPALIVED_IMAGE <span class="token operator">=</span> <span class="token string">'harbor.local/ceph/keepalived'</span>
DEFAULT_REGISTRY <span class="token operator">=</span> <span class="token string">'harbor.local'</span>   <span class="token comment"># normalize unqualified digests to this</span></code></pre>

<h2 id="Cephadm-ä½¿ç”¨ç§æœ‰ä»“åº“bootstrap"><a href="#Cephadm-ä½¿ç”¨ç§æœ‰ä»“åº“bootstrap" class="headerlink" title="Cephadm ä½¿ç”¨ç§æœ‰ä»“åº“bootstrap"></a>Cephadm ä½¿ç”¨ç§æœ‰ä»“åº“bootstrap</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ cephadm bootstrap --mon-ip <span class="token number">192.168</span>.1.211 --allow-overwrite <span class="token punctuation">\</span>
  --registry-url harbor.local <span class="token punctuation">\</span>
  --registry-username admin <span class="token punctuation">\</span>
  --registry-password Harbor12345</code></pre>

<h2 id="æŸ¥çœ‹å¹¶ä¸”æ¸…é™¤ceph-bootstrapçš„å†å²è®°å½•"><a href="#æŸ¥çœ‹å¹¶ä¸”æ¸…é™¤ceph-bootstrapçš„å†å²è®°å½•" class="headerlink" title="æŸ¥çœ‹å¹¶ä¸”æ¸…é™¤ceph-bootstrapçš„å†å²è®°å½•"></a>æŸ¥çœ‹å¹¶ä¸”æ¸…é™¤ceph-bootstrapçš„å†å²è®°å½•</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">ls</span> /etc/systemd/system/ceph*
~<span class="token punctuation">]</span>$ <span class="token function">ls</span> /usr/lib/systemd/system/ceph*

~<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/systemd/system/ceph*
~<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/lib/systemd/system/ceph*
~<span class="token punctuation">]</span>$ <span class="token function">docker</span> stop <span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>  </code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Application, Harbor</tag>
      </tags>
  </entry>
  <entry>
    <title>KVMè™šæ‹Ÿæœºå¼€å¯å†…å­˜å¤§é¡µ</title>
    <url>/2020/05/02/Linux/Linux_Hugepage-configuration/</url>
    <content><![CDATA[<p>Huge Pagesæ˜¯ä»Linux Kernel 2.6åè¢«å¼•å…¥çš„ã€‚ç›®çš„æ˜¯ä½¿ç”¨æ›´å¤§çš„å†…å­˜é¡µé¢ï¼ˆmemory page sizeï¼‰ ä»¥é€‚åº”è¶Šæ¥è¶Šå¤§çš„ç³»ç»Ÿå†…å­˜ï¼Œè®©æ“ä½œç³»ç»Ÿå¯ä»¥æ”¯æŒç°ä»£ç¡¬ä»¶æ¶æ„çš„å¤§é¡µé¢å®¹é‡åŠŸèƒ½ã€‚<br>é€æ˜å¤§é¡µï¼ˆTransparent Huge Pagesï¼‰ç¼©å†™ä¸ºTHPï¼Œè¿™ä¸ªæ˜¯RHEL 6ï¼ˆå…¶å®ƒåˆ†æ”¯ç‰ˆæœ¬SUSE Linux Enterprise Server 11, and Oracle Linux 6 with earlier releases of Oracle Linux Unbreakable Enterprise Kernel 2 (UEK2)ï¼‰å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªåŠŸèƒ½ã€‚å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>è¿™ä¸¤è€…æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li>è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºå¤§é¡µçš„åˆ†é…æœºåˆ¶ï¼Œæ ‡å‡†å¤§é¡µç®¡ç†æ˜¯<strong>é¢„åˆ†é…çš„æ–¹å¼</strong>ï¼Œè€Œé€æ˜å¤§é¡µç®¡ç†åˆ™æ˜¯<strong>åŠ¨æ€åˆ†é…</strong>çš„æ–¹å¼ã€‚</li>
</ul>
<p>ä½¿ç”¨å¤§é¡µçš„ç›®çš„ï¼š</p>
<ul>
<li>å¢åŠ å†…å­˜å¯»å€çš„å‘½ä¸­ç‡ï¼Œå¦‚æœä½¿ç”¨æ—§çš„å†…å­˜åˆ†é¡µæ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç®¡ç†å¾ˆå¤šå¾ˆå¤šçš„å°çš„å†…å­˜é¡µé¢ï¼ŒæŸ¥æ‰¾å’Œå‘½ä¸­çš„æ•ˆç‡æ¯”è¾ƒä½ã€‚</li>
<li>æƒ³è±¡ä¸€ä¸‹ï¼Œ ä½ æœ‰ä¸€æœ¬1000é¡µçš„ä¹¦ï¼Œä½ éœ€è¦æ‰¾åˆ°å…¶ä¸­çš„ç¬¬782é¡µçš„ç¬¬20è¡Œä¸­çš„ä¸€ä¸ªâ€œæˆ‘â€å­—ï¼Œé‚£ä¹ˆè®¡ç®—æœºä¼šä»ç¬¬ä¸€é¡µå¼€å§‹ç¿»åŠ¨ä¸€é¡µä¸€é¡µçš„çœ‹æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼›ç°åœ¨æˆ‘å°†ä¹¦è—‰çš„æ¯100é¡µåˆæˆ1é¡µï¼Œé‚£æˆ‘ä»¬åªéœ€è¦é¡ºåºæŸ¥çœ‹10æ¬¡å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå­—ç¬¦æ‰€åœ¨çš„èŒƒå›´äº†ï¼Œä¹‹åå†å»æŸ¥çœ‹è¿™ä¸ªå­—ç¬¦æ‰€åœ¨çš„å…·ä½“ä½ç½®ï¼Œé€Ÿåº¦å°±ä¼šæ¯”ä¹‹å‰ä¸€é¡µä¸€é¡µæ‰¾å¿«å¾—å¤šã€‚</li>
</ul>
<hr>
<h2 id="é…ç½®å¯ç”¨æ‰‹åŠ¨åˆ†é…çš„HugePage"><a href="#é…ç½®å¯ç”¨æ‰‹åŠ¨åˆ†é…çš„HugePage" class="headerlink" title="é…ç½®å¯ç”¨æ‰‹åŠ¨åˆ†é…çš„HugePage"></a>é…ç½®å¯ç”¨æ‰‹åŠ¨åˆ†é…çš„HugePage</h2><ol>
<li><p>è®¾ç½®æ“ä½œç³»ç»Ÿå¯ç”¨çš„æœ€å¤§å†…å­˜å€¼</p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;security&#x2F;limits.conf
* soft memlock 8192
* hard memlock 8192</code></pre>
</li>
<li><p>è®¾ç½®sysctl.conf</p>
<pre class="language-none"><code class="language-none"># vim &#x2F;etc&#x2F;sysctl.conf
vm.nr_hugepages &#x3D; 72708
# sysctl -p</code></pre>
</li>
<li><p>æ ¹æ®æˆ‘çš„æµ‹è¯• ï¼Œéœ€è¦é‡å¯æ‰ä¼šç”Ÿæ•ˆï¼ŒHugepageéƒ¨åˆ†çš„å†…å­˜ä¼šä¸€ç›´å±äºä½¿ç”¨ä¸­çš„å†…å­˜ï¼Œå¹¶ä¸”ä¸€ç›´è¢«å ç”¨ã€‚æˆ‘çš„é…ç½®ç”¨äº†16Gå†…å­˜ä¹‹ä¸­çš„8Gï¼Œæ‰€ä»¥å¼€æœºä¹‹åï¼Œæˆ‘çš„8Gå†…å­˜æ˜¯ä¸€ç›´ä½¿ç”¨ä¸­çš„çŠ¶æ€ï¼Œ æ— è®ºä½ çš„åº”ç”¨æ˜¯å¦çœŸæ­£çš„å¼€å§‹ä½¿ç”¨äº†è¿™éƒ¨åˆ†Hugepage.</p>
</li>
</ol>
<hr>
<p>ä¸‹é¢ä¸¾ä¾‹äº†å¦‚ä½•æŸ¥çœ‹Hugepagesçš„ä¿¡æ¯ï¼š</p>
<pre class="language-none"><code class="language-none">$ cat &#x2F;proc&#x2F;meminfo | grep Huge
AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:    4096
HugePages_Free:     4096
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:         8388608 kB</code></pre>

<p>æˆ‘çš„éœ€æ±‚è¯•ä½¿ç”¨Hugepageæ¥åˆ†é…ç»™KVMä¸­çš„è™šæ‹Ÿæœºï¼Œ åŠ é€Ÿè™šæ‹Ÿæœºçš„å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œæ‰€ä»¥å½“ç„¶æ˜¯åœ¨è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œç¼–è¾‘è™šæ‹Ÿæœº&#x2F;etc&#x2F;libvirt&#x2F;qemu&#x2F;HaydenGentoo.xml, æ”¹æˆå¦‚ä¸‹çš„æ ·å­ï¼š</p>
<pre class="language-none"><code class="language-none">&lt;memory unit&#x3D;&#39;KiB&#39;&gt;4194304&lt;&#x2F;memory&gt;
&lt;currentMemory unit&#x3D;&#39;KiB&#39;&gt;4194304&lt;&#x2F;currentMemory&gt;
&lt;memoryBacking&gt;
  &lt;hugepages&#x2F;&gt;
&lt;&#x2F;memoryBacking&gt;</code></pre>

<p>ä¹‹åé‡å¯è™šæ‹Ÿæœºå³å¯ã€‚<br>å¯ä»¥è§‚å¯Ÿåˆ°å¦‚ä¸‹æ”¹å˜è¯´æ˜å·²ç»åœ¨ä½¿ç”¨äº†ã€‚</p>
<pre class="language-none"><code class="language-none">$ cat &#x2F;proc&#x2F;meminfo | grep Huge    
AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:    4096
HugePages_Free:     2048
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:         8388608 kB</code></pre>

<h2 id="åœ¨æŸäº›åœºæ™¯ä¸‹å®Œå…¨å…³é—­THP"><a href="#åœ¨æŸäº›åœºæ™¯ä¸‹å®Œå…¨å…³é—­THP" class="headerlink" title="åœ¨æŸäº›åœºæ™¯ä¸‹å®Œå…¨å…³é—­THP"></a>åœ¨æŸäº›åœºæ™¯ä¸‹å®Œå…¨å…³é—­THP</h2><p>æŸ¥çœ‹å½“å‰çš„çŠ¶æ€</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/defrag</span>
<span class="token punctuation">[</span>always<span class="token punctuation">]</span> madvise never
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span>
<span class="token punctuation">[</span>always<span class="token punctuation">]</span> madvise never</code></pre>

<p>ç¦ç”¨THP</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> never <span class="token operator">></span> /sys/kernel/mm/transparent_hugepage/enabled
<span class="token builtin class-name">echo</span> never <span class="token operator">></span> /sys/kernel/mm/transparent_hugepage/defrag</code></pre>

<p>å®Œå…¨ç¦ç”¨ THP</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">grubby --update-kernel<span class="token operator">=</span>ALL <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">"transparent_hugepage=never"</span>

---
<span class="token function">sudo</span> systemctl <span class="token function">reboot</span></code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Memory</tag>
      </tags>
  </entry>
  <entry>
    <title>IOé‡å®šå‘ç¬”è®°</title>
    <url>/2019/06/25/Linux/Linux_IO-Redirect/</url>
    <content><![CDATA[<p>è¾“å‡ºé‡å®šå‘éƒ¨åˆ†çš„å¤ä¹ ç¬”è®°  </p>
<h2 id="æ ‡å‡†è¾“å…¥è¾“å‡º"><a href="#æ ‡å‡†è¾“å…¥è¾“å‡º" class="headerlink" title="æ ‡å‡†è¾“å…¥è¾“å‡º"></a>æ ‡å‡†è¾“å…¥è¾“å‡º</h2><h3 id="æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µ"><a href="#æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µ" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µ"></a>æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µ</h3><p>å¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹ä»¥åŠç»‘å®šæ–‡ä»¶æè¿°ç¬¦FDã€‚  </p>
<pre class="language-none"><code class="language-none">liarlee@hayden-pc ~
&gt; $ ll &#x2F;proc&#x2F;$$&#x2F;fd
æ€»ç”¨é‡ 0
dr-x------ 2 liarlee liarlee  0  6æœˆ 24 20:22 .
dr-xr-xr-x 9 liarlee liarlee  0  6æœˆ 24 20:22 ..
lrwx------ 1 liarlee liarlee 64  6æœˆ 24 20:22 0 -&gt; &#x2F;dev&#x2F;pts&#x2F;0
lrwx------ 1 liarlee liarlee 64  6æœˆ 24 20:22 1 -&gt; &#x2F;dev&#x2F;pts&#x2F;0
lrwx------ 1 liarlee liarlee 64  6æœˆ 24 20:22 10 -&gt; &#x2F;dev&#x2F;pts&#x2F;0
lrwx------ 1 liarlee liarlee 64  6æœˆ 24 20:22 2 -&gt; &#x2F;dev&#x2F;pts&#x2F;0</code></pre>
<h3 id="Linuxæä¾›çš„I-x2F-Oè®¾å¤‡"><a href="#Linuxæä¾›çš„I-x2F-Oè®¾å¤‡" class="headerlink" title="Linuxæä¾›çš„I&#x2F;Oè®¾å¤‡"></a>Linuxæä¾›çš„I&#x2F;Oè®¾å¤‡</h3><p>Linuxç³»ç»Ÿæä¾›çš„IOè®¾å¤‡ï¼Œå…±æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>STDIN - 0 é»˜è®¤é”®ç›˜è¾“å…¥</li>
<li>STDOUT - 1 é»˜è®¤è¾“å‡ºä¿¡æ¯åˆ°ç»ˆç«¯</li>
<li>STDERR - 2 é»˜è®¤è¾“å‡ºé”™è¯¯ä¿¡æ¯åˆ°ç»ˆç«¯</li>
</ul>
<h2 id="Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘"><a href="#Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘" class="headerlink" title="Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘"></a>Linuxè¾“å…¥è¾“å‡ºé‡å®šå‘</h2><h3 id="é‡å®šå‘è¯´æ˜"><a href="#é‡å®šå‘è¯´æ˜" class="headerlink" title="é‡å®šå‘è¯´æ˜"></a>é‡å®šå‘è¯´æ˜</h3><pre><code>STDOUTå’ŒSTDERRå¯ä»¥è¢«é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼ŒSTDINå¯é€šè¿‡è¯»å–æ–‡ä»¶å®ç°è¾“å…¥é‡å®šå‘ï¼Œé‡å®šå‘å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š  
[CMD] [lOPERATION_SYMBOL] [FILENAME]  
å‘½ä»¤    æ“ä½œç¬¦å·    æ–‡ä»¶å
</code></pre>
<h3 id="æ“ä½œç¬¦å·åŒ…æ‹¬ï¼š"><a href="#æ“ä½œç¬¦å·åŒ…æ‹¬ï¼š" class="headerlink" title="æ“ä½œç¬¦å·åŒ…æ‹¬ï¼š"></a>æ“ä½œç¬¦å·åŒ…æ‹¬ï¼š</h3><ul>
<li>&gt; æŠŠSTDOUTé‡å®šå‘åˆ°æ–‡ä»¶ </li>
<li>2&gt; æŠŠSTDERRé‡å®šå‘åˆ°æ–‡ä»¶</li>
<li>&amp;&gt; æŠŠæ‰€æœ‰ç»“æœè¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶</li>
<li>&gt;&gt; åœ¨åŸæœ‰æ–‡ä»¶å†…å®¹çš„åŸºç¡€ä¸Šè¿›è¡Œè¿½åŠ  </li>
<li>&lt; æ ‡å‡†è¾“å…¥çš„é‡å®šå‘</li>
</ul>
<h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>é‚£ä¹ˆä¼šæœ‰å¦‚ä¸‹çš„æ“ä½œï¼š  </p>
<pre class="language-none"><code class="language-none">    &gt; $ ls 1&gt; &#x2F;tmp&#x2F;echo.stdout  
        # æ­£ç¡®çš„å‘½ä»¤ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­

    &gt; $ ls 2&gt; &#x2F;tmp&#x2F;echo.stderr  
        # å‘½ä»¤æ‰§è¡Œçš„é”™è¯¯ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­  

    &gt; $ ls &#x2F;error &#x2F;usr 2&gt;&amp;1 &gt;&#x2F;tmp&#x2F;right.test   
        # å°†é”™è¯¯ä¿¡æ¯é‡å®šå‘è¾“å‡ºåˆ°å±å¹•æ˜¾ç¤ºï¼Œæ­£ç¡®çš„ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ 
        # é€šä¿—çš„è®²æ˜¯-- å°†STDERR(2)é‡å®šå‘ä¸ºSTDOUT(1)è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œ
        # å‘½ä»¤çš„å…¶ä»–ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­  

    &gt; $ ls &#x2F;error &#x2F;usr &gt;true 2&gt;false
        # å°†æ­£ç¡®çš„ä¿¡æ¯è¾“å‡ºåˆ°trueä¸­ï¼ŒæŠŠé”™è¯¯çš„ä¿¡æ¯è¾“å‡ºåˆ°falseä¸­  

    &gt; $ ls &#x2F;error &#x2F;usr &gt;all 2&gt;&amp;1 
        # å…ˆå°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶allä¸­ï¼Œåœ¨å°†é”™è¯¯ä¿¡æ¯è¿½åŠ åˆ°æ ‡å‡†è¾“å‡ºä¸­  
        # å‘½ä»¤ç»“æœç­‰äºls &#x2F;error &#x2F;usr &amp;&gt;all 

    &gt; $ ls &#x2F;error &#x2F;usr &amp;&gt; &#x2F;dev&#x2F;null
        # é™é»˜æ‰§è¡Œå‘½ä»¤ï¼Œä¸æ˜¾ç¤ºç»“æœï¼Œä¸è¾“å‡ºåˆ°ç»ˆç«¯

    &gt; $ ls &#x2F;error &#x2F;usr 2&gt;&amp;1 &gt;&#x2F;dev&#x2F;null  
        # é”™è¯¯çš„ä¿¡æ¯æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šï¼Œå…¶ä»–ä¿¡æ¯ä¸æ˜¾ç¤º

#  æŸäº›å‘½ä»¤å¯ä»¥ä½¿ç”¨ç®¡é“å°†STDINè¾“å…¥é‡å®šå‘ä½œä¸ºå‘½ä»¤çš„å€¼
    echo [PASSWD] | passwd --stdin [username] &amp;&gt; &#x2F;dev&#x2F;null
        # æ›´æ”¹æŸä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç </code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Mavenæ•™ç¨‹</title>
    <url>/2018/06/25/Linux/Linux_Install-Maven-Guide/</url>
    <content><![CDATA[<p>å®‰è£…Mavenè¿‡ç¨‹ï¼Œå¤‡å¿˜ã€‚</p>
<h2 id="ä¸‹è½½å®‰è£…åŒ…"><a href="#ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="ä¸‹è½½å®‰è£…åŒ…"></a>ä¸‹è½½å®‰è£…åŒ…</h2><ol>
<li><p><a href="https://maven.apache.org/download.cgi">Maven Download Links</a>  </p>
</li>
<li><p>è§£å‹å®‰è£…åŒ…ï¼š<br>tar xzvf apache-maven-3.5.4-bin.tar.gz </p>
</li>
<li><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š<br> vim &#x2F;etc&#x2F;profile<br> export M2_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-maven&#x2F;apache-maven-3.2.5<br> export M2&#x3D;$M2_HOME&#x2F;bin<br> export MAVEN_OPTS&#x3D;-Xms256m -Xmx512m</p>
</li>
<li><p>æ·»åŠ ç¯å¢ƒå˜é‡åˆ°PATHï¼š<br> export PATH&#x3D;M2:PATH</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>å®Œå…¨éš”ç¦»CPUçš„æ–¹æ³•</title>
    <url>/2022/10/11/Linux/Linux_Isolate-cpu-and-taskset-to-it/</url>
    <content><![CDATA[<p>å®Œå…¨éš”ç¦»CPUï¼Œ å¹¶æ’ç©ºCPUæ‰€æœ‰çš„è¿›ç¨‹ï¼Œåˆ†é…æŒ‡å®šçš„ä»»åŠ¡åˆ°CPUä¸Šã€‚</p>
<ol>
<li><p>å½“å‰çš„æƒ…å†µä¸‹ï¼Œ æˆ‘æœ‰CPU 0 - 3ï¼Œ æˆ‘å¸Œæœ›éš”ç¦»å‡ºCPU3 æ¥è¿›è¡ŒæŒ‡å®šçš„ä»»åŠ¡è¿è¡Œï¼ˆæ–¹æ³•æ˜¯ä¼ é€’å†…æ ¸å‚æ•°å¹¶é‡å¯ï¼‰</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/default/grub

<span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">'................isolcpu=3 nohz_full=3'</span>

grub2-mkconfig <span class="token parameter variable">-o</span> /boot/grub2/grub.cfg
<span class="token function">sync</span> <span class="token operator">&amp;&amp;</span> systemctl <span class="token function">reboot</span></code></pre>
</li>
<li><p>é‡å¯ä¹‹åï¼ŒCPU3 å°±å·²ç»ä»CFSçš„è°ƒåº¦åˆ—è¡¨ä¸Šé¢æ‹¿æ‰äº†ï¼Œ å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„å‚æ•°è¯æ˜ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹è®¾ç½®æ˜¯å¦å·²ç»æ­£ç¡®çš„ç”Ÿæ•ˆï¼Œ åˆ†ç¦»çš„CPUä¼šè¡¨ç¤ºä¸ºåºå·ï¼Œ ä¸€èˆ¬æ˜¯ï¼š 0-2 ï¼Œ 3 ã€‚ è¿™ä¸¤ç§è¡¨ç¤ºæ–¹å¼ã€‚</span>
<span class="token function">cat</span> /sys/devices/system/cpu/isolated
<span class="token number">3</span>
<span class="token function">cat</span> /sys/devices/system/cpu/nohz_full
<span class="token number">3</span></code></pre>
</li>
<li><p>å…³äºnohz_fullè¿™ä¸ªå‚æ•°ï¼Œ éœ€è¦ç¼–è¯‘å†…æ ¸çš„æ—¶å€™å°±å¯ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># éœ€è¦å¯ç”¨çš„å‚æ•°å¦‚ä¸‹ï¼š</span>
<span class="token assign-left variable">CONFIG_NO_HZ_COMMON</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_NO_HZ_FULL</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_NO_HZ</span><span class="token operator">=</span>y</code></pre>
<p>è¿™éƒ¨åˆ†çš„å†…å®¹è¿˜åŒ…æ‹¬çš„Kernelçš„Ticklessç­‰ç­‰çŸ¥è¯†ï¼Œ è¿™ä¸ªéƒ¨åˆ†çš„å†…å®¹æˆ‘åœ¨Redhatçš„æ–‡æ¡£ä¸­æœ‰çœ‹åˆ°ã€‚ä½†æ˜¯æ–‡æ¡£æ¯”è¾ƒæ—§äº†ï¼Œ è¿™ä¸ªè®¾ç½®æ˜¯åŸºäºRedhat 7 ç‰ˆæœ¬çš„è¯´æ˜ï¼Œ å¯èƒ½ç°åœ¨æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæˆ‘ä¸å¤ªç¡®å®šã€‚</p>
</li>
<li><p>é‡å¯ä¹‹åï¼Œ CPU3ä¸Šé¢å·²ç»å®Œå…¨ä¸ä¼šæœ‰ç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹è¢«è°ƒåº¦ä¸Šå»äº†ï¼ŒåŒæ—¶ï¼Œ ç”±äºå·²ç»é…ç½®äº†NOHZçš„å‚æ•°ï¼ŒCPU3 ä¸Šé¢ä¹Ÿä¸ä¼šæœ‰Kernel Timer Interreptè§¦å‘ï¼Œå› æ­¤ä¹Ÿå°‘äº†ä¸€éƒ¨åˆ†ä¸­æ–­ã€‚</p>
</li>
<li><p>Redhatçš„æ–‡æ¡£ä¸­å®šä¹‰äº†å¦‚ä¸‹çš„æ–¹å¼è¿›è¡ŒéªŒè¯ï¼Œ æˆ‘ç›´æ¥æŠ„ä¸‹é¢çš„å†…å®¹äº†ã€‚</p>
<blockquote>
<p>å…³äºå¦‚ä½•éªŒè¯Cpuéš”ç¦»çš„æ–‡æ¡£ï¼š <a href="https://access.redhat.com/solutions/3875421">https://access.redhat.com/solutions/3875421</a><br>é…ç½®éš”ç¦»CPUçš„æ–¹æ³•å·²ç»ç¡®è®¤åŠŸèƒ½æ˜¯å¦æ¿€æ´»çš„æ–¹æ³•ï¼š<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/index</a></p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">perf <span class="token function">stat</span> <span class="token parameter variable">-C</span> <span class="token number">1</span> <span class="token parameter variable">-e</span> irq_vectors:local_timer_entry taskset <span class="token parameter variable">-c</span> <span class="token number">3</span> <span class="token function">sleep</span> <span class="token number">3</span></code></pre>
<p>å…ˆè®°å½•è¿™ä¹ˆå¤šå§ï¼Œ è¿™ä¸ªåŠŸèƒ½ç”¨åˆ°çš„åœ°æ–¹å®åœ¨æ˜¯æœ‰é™ï¼ŒåŸºæœ¬ä¸Šä¸æ€ä¹ˆéœ€è¦ã€‚å¹¶ä¸”éœ€è¦çŸ¥é“æ˜¯ç°åœ¨å·²ç»ä¸æ€ä¹ˆéœ€è¦ä½¿ç”¨è¿™ä¸ªå·¥å…·è¿›è¡Œè°ƒä¼˜äº†ï¼Œ Redhatæœ‰ Tuned å®ˆæŠ¤è¿›ç¨‹ï¼Œ å¯ä»¥é€šè¿‡é»˜è®¤çš„profileå¯¹OSè¿›è¡Œè°ƒä¼˜ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, CPU</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå†…æ ¸Configä¸­çš„å‚æ•° CONFIG_NO_HZ</title>
    <url>/2022/04/19/Linux/Linux_KernelParam_NOHZ/</url>
    <content><![CDATA[<p>å…³äºTickï¼Œ Ticklessçš„ç ”ç©¶ã€‚</p>
<blockquote>
<p><a href="https://www.kernel.org/doc/html/latest/timers/no_hz.html">https://www.kernel.org/doc/html/latest/timers/no_hz.html</a></p>
</blockquote>
<p>è¿™å‡ ä¸ªå‚æ•°çš„æœ€ç»ˆæ„ä¹‰éƒ½å’Œ Jitter ç›¸å…³ï¼Œ è®¾ç½®çš„å‚æ•°å«ä¹‰æ˜¯ ï¼š CPUæ—¶é’Ÿä¸­æ–­çš„å‘¨æœŸï¼Œ å¦‚æœæ˜¯ 100HZ ï¼Œ é‚£ä¹ˆ1sçš„æ—¶é—´å†…CPUä¼šä¸­æ–­100æ¬¡ã€‚<br>ç›®å‰æœ€æ–°çš„å†…æ ¸æ”¯æŒ NOHZ ï¼Œ ä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰ä»»åŠ¡çš„æ—¶å€™å¤„äºèŠ‚èƒ½çš„è€ƒè™‘ä¸è¿›è¡Œä¸­æ–­ã€‚å½“æœ‰éœ€è¦è¿è¡Œçš„ä¸šåŠ¡æ—¶è¿˜æ˜¯ä¼šæ­£å¸¸çš„è§¦å‘CPUä¸­æ–­ã€‚<br>NOHZä¸»è¦çš„åŠŸèƒ½æ—¶çœç”µï¼Œ è°ƒæ•´è¿™ä¸ªå‚æ•°çš„æ„ä¹‰å°±æ˜¯è®©CPUå¤„åœ¨åˆç†çš„ä¸­æ–­æ¬¡æ•°ã€‚è¿‡å¤šçš„ä¸­æ–­ä¼šå¯¼è‡´ç›¸å…³çš„ä»»åŠ¡è¢«æ‰“æ–­ã€‚</p>
<blockquote>
<p>git:&#x2F;&#x2F;git.kernel.org&#x2F;pub&#x2F;scm&#x2F;linux&#x2F;kernel&#x2F;git&#x2F;frederic&#x2F;dynticks-testing.git</p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes day1</title>
    <url>/2021/09/11/Linux/Linux_Kubernetes-day1/</url>
    <content><![CDATA[<p><a href="https://github.com/cncf/toc/blob/main/DEFINITION.md#%E4%B8%AD%E6%96%87%E7%89%88%E6%9C%AC">äº‘åŸç”Ÿçš„å®šä¹‰</a></p>
<h2 id="äº‘åŸç”Ÿä¸€äº›æ¦‚å¿µ"><a href="#äº‘åŸç”Ÿä¸€äº›æ¦‚å¿µ" class="headerlink" title="äº‘åŸç”Ÿä¸€äº›æ¦‚å¿µ"></a>äº‘åŸç”Ÿä¸€äº›æ¦‚å¿µ</h2><h3 id="åäºŒå› ç´ åº”ç”¨"><a href="#åäºŒå› ç´ åº”ç”¨" class="headerlink" title="åäºŒå› ç´ åº”ç”¨"></a>åäºŒå› ç´ åº”ç”¨</h3><ol>
<li>åŸºå‡†ä»£ç ï¼š ä¸€ä»½åŸºå‡†ä»£ç ï¼Œå¤šæ¬¡éƒ¨ç½²ï¼ˆç”¨åŒä¸€ä¸ªä»£ç åº“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼‰</li>
<li>ä¾èµ–ï¼š æ˜¾å¼çš„å£°æ˜å’Œéš”ç¦»ç›¸äº’ä¹‹é—´çš„ä¾èµ–</li>
<li>é…ç½®ï¼š åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®(é…ç½®ä¸­å¿ƒï¼Œæºç¨‹çš„apollo)</li>
<li>åç«¯æœåŠ¡ï¼š åç«¯æœåŠ¡ä½œä¸ºä¸€ä¸ªé™„åŠ çš„èµ„æºï¼Œæ•°æ®åº“ï¼Œä¸­é—´ä»¶ç­‰ç­‰</li>
<li>æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œï¼š å¯¹ç¨‹åºæ‰§è¡Œæ„å»ºæˆ–è€…æ‰“åŒ…ï¼Œä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ,æ‰“é•œåƒç¼–è¯‘ç­‰ç­‰ï¼Œæ„å»ºå’Œè¿è¡Œä¸¥æ ¼çš„åˆ†ç¦»</li>
<li>è¿›ç¨‹ï¼š ä½¿ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨</li>
<li>ç«¯å£ç»‘å®šï¼š é€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡</li>
<li>å¹¶å‘ï¼š é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•</li>
<li>æ˜“å¤„ç†ï¼š å¿«é€Ÿçš„å¯åŠ¨ï¼Œä¼˜é›…çš„ç»ˆæ­¢ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿æŒå¥å£®æ€§ã€‚</li>
<li>å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·ï¼š å°½å¯èƒ½ä¿æŒDevï¼ŒPreliveï¼ŒLiveç¯å¢ƒçš„ä¸€è‡´æ€§</li>
<li>æ—¥å¿—ï¼š å°†æ‰€æœ‰è¿è¡Œä¸­çš„è¿›ç¨‹å’Œåå°æœåŠ¡çš„è¾“å‡ºæµæŒ‰ç…§çš„æ—¶é—´é¡ºåºç»Ÿä¸€æ”¶é›†å­˜å‚¨å’Œå±•ç¤º(ELK,Fluend,Logstash,Filebeatç­‰ç­‰)</li>
<li>ç®¡ç†è¿›ç¨‹ï¼š ä¸€æ¬¡æ€§ç®¡ç†ç±»å‹çš„è¿›ç¨‹(Onetime Job)åº”è¯¥å’Œæ­£å¸¸çš„å¸¸é©»è¿›ç¨‹ä½¿ç”¨åŒæ ·çš„è¿è¡Œç¯å¢ƒ</li>
</ol>
<h2 id="Master-APIserver"><a href="#Master-APIserver" class="headerlink" title="Master - APIserver"></a>Master - APIserver</h2><p>APIserveræä¾›äº†Kuberneteså„ç±»èµ„æºå¯¹è±¡çš„CRUDä»¥åŠWatchç­‰ç­‰çš„HTTP RESTæ¥å£ï¼Œå¯¹è±¡åŒ…æ‹¬Podsï¼ŒServices, ReplicationsControllersç­‰ç­‰, ä¸ºRESTfulæ“ä½œæä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä¸ºé›†ç¾¤çŠ¶æ€æä¾›å‰ç«¯ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½é€šè¿‡å‰ç«¯è¿›è¡Œäº¤äº’ã€‚</p>
<ul>
<li><p>ç‰¹ç‚¹ï¼š RESTfulé£æ ¼</p>
<ol>
<li>APIserverçš„è¯·æ±‚æœ€åä¼šåŒæ­¥åˆ°Etcdã€‚</li>
<li>è¯·æ±‚APIserveråœ¨æƒé™çš„é‰´å®šå®Œæˆä¹‹åï¼Œ å¯ä»¥æŸ¥çœ‹å¤§éƒ¨åˆ†çš„ä¿¡æ¯ã€‚</li>
<li>ç«¯å£é»˜è®¤æ˜¯ 6443 å¯é€šè¿‡å¯åŠ¨å‚æ•°ï¼ˆâ€“secure-portï¼‰æ¥è¿›è¡Œè°ƒæ•´</li>
<li>ç»‘å®šçš„IPåœ°å€å¯ä»¥é€šè¿‡ â€“bind-address åœ¨å¯åŠ¨çš„æ—¶å€™æŒ‡å®š</li>
<li>ç«¯å£ç”¨äºæ¥å—å®¢æˆ·ç«¯ï¼Œdashboardçš„å¤–éƒ¨HTTPBaseçš„è¯·æ±‚</li>
<li>Token ä»¥åŠè¯ä¹¦çš„HTTPbaseçš„æ ¡éªŒ</li>
<li>åŸºäºæŒ‡å®šç­–ç•¥çš„æˆæƒ</li>
</ol>
</li>
<li><p>åŠŸèƒ½ï¼š </p>
<ol>
<li>èº«ä»½è®¤è¯</li>
<li>éªŒè¯æƒé™</li>
<li>éªŒè¯æŒ‡ä»¤</li>
<li>æ‰§è¡Œæ“ä½œ</li>
<li>è¿”å›ç»“æœ</li>
</ol>
</li>
</ul>
<h2 id="Master-Kube-scheduler"><a href="#Master-Kube-scheduler" class="headerlink" title="Master - Kube-scheduler"></a>Master - Kube-scheduler</h2><p>è´Ÿè´£å°†PodæŒ‡å®šåˆ°èŠ‚ç‚¹ä¸Šã€‚</p>
<ol>
<li>å–å‡ºPodéœ€è¦åˆ†é…çš„ä¿¡æ¯ï¼Œ å…ˆæ’é™¤ä¸å¯è°ƒåº¦çš„Nodeï¼Œåœ¨å¯ç”¨çš„Nodeåˆ—è¡¨ä¹‹ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„Nodeï¼Œå°†ä¿¡æ¯å†™å…¥etcdã€‚ç­‰å¾…Nodeä¸Šé¢çš„kubeletè¿›è¡Œç”ŸæˆPodã€‚</li>
<li>Nodeçš„Kubeleté€šè¿‡APIserverç›‘å¬åˆ°Podçš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åè·å–Podçš„æ¸…å•ï¼Œä¸‹è½½é•œåƒï¼Œå¯åŠ¨Podï¼Œ Kubeletæ¯ç§’Watch-APIserverçš„ä¿¡æ¯ã€‚</li>
<li>ä¸‰ä¸ªé»˜è®¤ç­–ç•¥ï¼š <ul>
<li>LeastRequestedPriority - CPU+MEMç›´æ¥è¯„åˆ†ï¼Œé€‰æ‹©èµ„æºç›®å‰è¾ƒä½</li>
<li>CalculateNodeLanelPriority - å…ˆåŒ¹é…æ ‡ç­¾ï¼Œåœ¨è¿›è¡Œè¯„åˆ†</li>
<li>BalancedResourceAllocation - ä¼˜å…ˆåˆ†é…å„é¡¹èµ„æºçš„ä½¿ç”¨ç‡æœ€å‡è¡¡çš„èŠ‚ç‚¹</li>
</ul>
</li>
<li>é˜Ÿåˆ—ï¼š PodQueue ï¼Œ NodeList</li>
</ol>
<h2 id="Master-Kuber-Controller-Manager"><a href="#Master-Kuber-Controller-Manager" class="headerlink" title="Master - Kuber-Controller-Manager"></a>Master - Kuber-Controller-Manager</h2><p>æä¾›ä¸åŒçš„æ§åˆ¶å™¨ï¼Œä¾‹å¦‚ï¼š é›†ç¾¤å†…çš„Node, Pod ReplicaCounts, EndPoint, Namespace, ServiceAccount, ResourceQuotaç­‰ç­‰èµ„æºçš„æ§åˆ¶å†…å®¹ï¼Œå¦‚æœå‘ç°å¼‚å¸¸çš„æ—¶å€™æä¾›è‡ªåŠ¨åŒ–çš„ä¿®å¤æµç¨‹ã€‚ç¡®ä¿æ‰€æœ‰çš„æœåŠ¡æ˜¯åœ¨é¢„æœŸçš„çŠ¶æ€ä¸‹è¿è¡Œã€‚</p>
<ol>
<li>5sæ£€æŸ¥ä¸€æ¬¡Nodeçš„çŠ¶æ€</li>
<li>åŒ…æ‹¬å¤šç§ä¸åŒçš„æ§åˆ¶å™¨</li>
<li>æ£€æŸ¥æ‰€æœ‰çš„æ§åˆ¶å™¨ å’Œ Nodeæ˜¯å¦ç¬¦åˆé¢„æœŸ</li>
<li>å¦‚æœNode ä¸å¯è¾¾ä¹‹å 40sä¼šå°†èŠ‚ç‚¹æ ‡è®°ä¸ºæ— æ³•è®¿é—®</li>
<li>æ ‡è®°ä¸ºæ— æ³•è®¿é—®5minä¹‹åï¼Œ å°†åˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶åœ¨å…¶ä»–çš„èŠ‚ç‚¹é‡å»ºéœ€è¦çš„Podã€‚</li>
</ol>
<hr>
<p>Podçš„é«˜å¯ç”¨æœºåˆ¶ï¼š<br>    1.  NodeMonitorPeriod: ç›‘è§†å‘¨æœŸ<br>    2.  NodeMonitorGracePerios: èŠ‚ç‚¹ç›‘è§†è§‚å¯ŸæœŸ<br>    3.  PodEvictionTimeout: è¶…æ—¶é©±é€çš„åŒºé—´</p>
<h2 id="Kube-Proxy"><a href="#Kube-Proxy" class="headerlink" title="Kube-Proxy"></a>Kube-Proxy</h2><p>Kubernetesç½‘ç»œä»£ç†ï¼Œåæ˜ äº†Nodeä¸Šé¢çš„Kubernetesä¸­çš„æœåŠ¡å¯¹è±¡çš„å˜åŒ–ï¼Œé€šè¿‡ç®¡ç†IPVSæˆ–è€…IPTABLESçš„è§„åˆ™æ¥è¿›è¡Œç½‘ç»œå±‚çš„å®ç°ã€‚</p>
<ul>
<li>å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥æŒ‡å®šIPVSçš„è°ƒåº¦ç®—æ³•ï¼Œ ä¸€èˆ¬é»˜è®¤æ˜¯RR, <code>ipvsadm -ln</code></li>
<li>ç›´æ¥æŒ‡å®škubeletçš„é…ç½®æ–‡ä»¶é€‰é¡¹<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ipvs</span><span class="token punctuation">:</span>
  <span class="token key atrule">scheduler</span><span class="token punctuation">:</span> sh</code></pre></li>
</ul>
<h2 id="Kubelet"><a href="#Kubelet" class="headerlink" title="Kubelet"></a>Kubelet</h2><ol>
<li>æ±‡æŠ¥èŠ‚ç‚¹çš„çŠ¶æ€</li>
<li>ç›‘å¬API server ä¸Šé¢çš„podä¿¡æ¯å˜åŒ–ï¼Œå¹¶è°ƒç”¨Docker å’Œ Containerd åˆ›å»ºå®¹å™¨</li>
<li>å‡†å¤‡Podæ‰€éœ€è¦çš„æ•°æ®å·</li>
<li>è¿”å›Podçš„è¿è¡ŒçŠ¶æ€</li>
<li>åœ¨NodeèŠ‚ç‚¹ä¸Šè¿›è¡Œå®¹å™¨çš„å¥åº·æ£€æŸ¥</li>
</ol>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes day2</title>
    <url>/2021/10/02/Linux/Linux_Kubernetes-day2/</url>
    <content><![CDATA[<p>å¯¹äºetcdçš„æ“ä½œå’Œå¤‡ä»½ </p>
<h1 id="Etcdçš„æ“ä½œ-Etcdctl"><a href="#Etcdçš„æ“ä½œ-Etcdctl" class="headerlink" title="Etcdçš„æ“ä½œ - Etcdctl"></a>Etcdçš„æ“ä½œ - Etcdctl</h1><h2 id="Etcdçš„è§„åˆ’"><a href="#Etcdçš„è§„åˆ’" class="headerlink" title="Etcdçš„è§„åˆ’"></a>Etcdçš„è§„åˆ’</h2><ol>
<li>æœ€å¥½ç”¨ å›ºæ€ç›˜ï¼Œ Podæ•°é‡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ä¼šéå¸¸éå¸¸æ…¢ï¼Œ å†…å­˜è¦å¤§.</li>
<li>ç±»ä¼¼äºredis æˆ–è€… Zookeeperï¼Œ KVçš„å­˜å‚¨.</li>
<li>æ”¯æŒwatchæœºåˆ¶ï¼Œå¯ä»¥é€šçŸ¥ç»™nodeèŠ‚ç‚¹çš„æ•°æ®å˜åŒ–.</li>
<li>etcd consul zookeeper çš„åŒºåˆ«</li>
</ol>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>æ¥å£</th>
<th>ä¸€è‡´æ€§ç®—æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>zookeeper</td>
<td>1.åŠŸèƒ½å¼ºå¤§ï¼Œä¸ä»…ä»…åªæ˜¯æœåŠ¡å‘ç°<br />2.æä¾›watcheræœºåˆ¶èƒ½å®æ—¶è·å–æœåŠ¡æä¾›è€…çš„çŠ¶æ€<br/>3.dubboç­‰æ¡†æ¶æ”¯æŒ</td>
<td>1.æ²¡æœ‰å¥åº·æ£€æŸ¥<br/>2.éœ€åœ¨æœåŠ¡ä¸­é›†æˆsdkï¼Œå¤æ‚åº¦é«˜<br/>3.ä¸æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ</td>
<td>sdk</td>
<td>Paxos</td>
</tr>
<tr>
<td>consul</td>
<td>1.ç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é›†æˆsdk<br/>2.è‡ªå¸¦å¥åº·æ£€æŸ¥<br/>3.æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ<br/>4.æä¾›webç®¡ç†ç•Œé¢</td>
<td>1.ä¸èƒ½å®æ—¶è·å–æœåŠ¡ä¿¡æ¯çš„å˜åŒ–é€šçŸ¥</td>
<td>http&#x2F;dns</td>
<td>Raft</td>
</tr>
<tr>
<td>etcd</td>
<td>1.ç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é›†æˆsdk<br/>2.å¯é…ç½®æ€§å¼º</td>
<td>1.æ²¡æœ‰å¥åº·æ£€æŸ¥<br/>2.éœ€é…åˆç¬¬ä¸‰æ–¹å·¥å…·ä¸€èµ·å®ŒæˆæœåŠ¡å‘ç°<br/>3.ä¸æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ</td>
<td>http</td>
<td>Raft</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Etcdctl-çš„å‘½ä»¤"><a href="#Etcdctl-çš„å‘½ä»¤" class="headerlink" title="Etcdctl çš„å‘½ä»¤"></a>Etcdctl çš„å‘½ä»¤</h2><ul>
<li><p>æŸ¥çœ‹etcdçš„æˆå‘˜æ¸…å•</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem --write-out<span class="token operator">=</span>table <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379,192.168.31.22:2379,192.168.31.23:2379"</span> member list</code></pre>
</li>
<li><p>æŸ¥çœ‹etcdçš„èŠ‚ç‚¹çŠ¶æ€</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379,192.168.31.22:2379,192.168.31.23:2379"</span> endpoint status <span class="token parameter variable">-w</span> table</code></pre>
</li>
<li><p>æŸ¥çœ‹etcdå­˜å‚¨çš„æ•°æ® </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379,192.168.31.22:2379,192.168.31.23:2379"</span> get /registry/ <span class="token parameter variable">--prefix</span> --keys-only <span class="token operator">|</span> <span class="token function">head</span></code></pre></li>
<li><p>æŸ¥çœ‹etcdä¸­çš„podä¿¡æ¯</p>
</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379,192.168.31.22:2379,192.168.31.23:2379"</span> get /registry/ <span class="token parameter variable">--prefix</span> --keys-only <span class="token operator">|</span> <span class="token function">grep</span> pod</code></pre>
<ul>
<li>å…¶ä»–çš„æ“ä½œ</li>
</ul>
<ol>
<li>get &#x2F; put &#x2F; del ç­‰åŸºç¡€æ“ä½œ</li>
</ol>
<h2 id="Watchæœºåˆ¶"><a href="#Watchæœºåˆ¶" class="headerlink" title="Watchæœºåˆ¶"></a>Watchæœºåˆ¶</h2><p>watchæœºåˆ¶æ˜¯é€šè¿‡ä¸æ–­çš„æŸ¥çœ‹æ•°æ®ï¼Œå‘ç”Ÿå˜åŒ–å°±ä¸»åŠ¨çš„é€šçŸ¥å®¢æˆ·ç«¯ï¼Œv3æ”¯æŒwatchå›ºå®šçš„key,ä¹Ÿå¯ä»¥watchä¸€ä¸ªèŒƒå›´çš„æ•°æ®ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># watch ä¸€ä¸ªpodçš„ä¿¡æ¯ï¼Œ ç„¶åæ‰‹åŠ¨deleteè¿™ä¸ªpod ï¼Œ æŸ¥çœ‹etcd çš„watchè¡Œä¸ºå’Œè¾“å‡ºçš„ç»“æœã€‚</span>
<span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379,192.168.31.22:2379,192.168.31.23:2379"</span> <span class="token function">watch</span> /registry/pods/monitoring/node-exporter-889hf</code></pre>

<h2 id="æ•°æ®å¤‡ä»½æ¢å¤å’ŒWALæ—¥å¿—"><a href="#æ•°æ®å¤‡ä»½æ¢å¤å’ŒWALæ—¥å¿—" class="headerlink" title="æ•°æ®å¤‡ä»½æ¢å¤å’ŒWALæ—¥å¿—"></a>æ•°æ®å¤‡ä»½æ¢å¤å’ŒWALæ—¥å¿—</h2><p>WALï¼š watch ahead log - é¢„å†™æ—¥å¿—ï¼Œ å¯ä»¥é€šè¿‡é¢„å†™æ—¥å¿—æ¥è¿›è¡Œæ•°æ®åº“çš„æ¢å¤ã€‚<br>WALè®°å½•äº†æ•´ä¸ªæ•°æ®å˜åŒ–çš„è¿‡ç¨‹ï¼Œåœ¨æ“ä½œå†™å…¥æ•°æ®ä¹‹å‰å…ˆè¿›è¡Œwalæ—¥å¿—çš„å†™å…¥ã€‚</p>
<p>etcd v2 çš„æ—¶å€™ç›´æ¥å¤åˆ¶å’Œå¤‡ä»½ç›®å½•ï¼Œå¤‡ä»½æ–‡ä»¶çš„æ–¹æ¡ˆ<br>etcd v3 çš„å¤‡ä»½å’Œæ¢å¤ï¼Œ ä½¿ç”¨å¿«ç…§çš„æ–¹å¼ã€‚</p>
<p>å¤‡ä»½ä½¿ç”¨çš„å‘½ä»¤å’Œæ¢å¤çš„å‘½ä»¤ä¸å¤ªä¸€æ ·ï¼Œ etcdctl  vs   etcdutl </p>
<p>å¯ä»¥å†™è„šæœ¬æ¥è¿›è¡Œæ•°æ®è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ etcdctl snapshot save
<span class="token punctuation">]</span>$ etcdctl snapshot restore
<span class="token punctuation">]</span>$ etcdctl snapshot status

<span class="token punctuation">]</span>$ etcdctl <span class="token parameter variable">--cacert</span><span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token parameter variable">--cert</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes.pem <span class="token parameter variable">--key</span><span class="token operator">=</span>/etc/kubernetes/ssl/kubernetes-key.pem <span class="token parameter variable">--endpoints</span><span class="token operator">=</span><span class="token string">"192.168.31.21:2379"</span> snapshot save snap-20211002.db

<span class="token comment"># æµ‹è¯•å°è¯•æ¢å¤åˆ°ä¸´æ—¶çš„ç›®å½•ï¼Œæµ‹è¯•ç”¨ã€‚ ç›®å½•åœ°å€ç”¨çš„æ˜¯tmpä¸‹é¢çš„ã€‚</span>
<span class="token punctuation">]</span>$ etcdutl snapshot restore ./snap-20211002.db --data-dir /tmp/etcd-restore
<span class="token number">2021</span>-10-02T12:01:13+08:00	info	snapshot/v3_snapshot.go:251	restoring snapshot	<span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"./snap-20211002.db"</span>, <span class="token string">"wal-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore/member/wal"</span>, <span class="token string">"data-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore"</span>, <span class="token string">"snap-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore/member/snap"</span>, <span class="token string">"stack"</span><span class="token builtin class-name">:</span> <span class="token string">"go.etcd.io/etcd/etcdutl/v3/snapshot.(*v3Manager).Restore<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/tmp/etcd-release-3.5.0/etcd/release/etcd/etcdutl/snapshot/v3_snapshot.go:257<span class="token entity" title="\n">\n</span>go.etcd.io/etcd/etcdutl/v3/etcdutl.SnapshotRestoreCommandFunc<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/tmp/etcd-release-3.5.0/etcd/release/etcd/etcdutl/etcdutl/snapshot_command.go:147<span class="token entity" title="\n">\n</span>go.etcd.io/etcd/etcdutl/v3/etcdutl.snapshotRestoreCommandFunc<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/tmp/etcd-release-3.5.0/etcd/release/etcd/etcdutl/etcdutl/snapshot_command.go:117<span class="token entity" title="\n">\n</span>github.com/spf13/cobra.(*Command).execute<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/home/remote/sbatsche/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:856<span class="token entity" title="\n">\n</span>github.com/spf13/cobra.(*Command).ExecuteC<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/home/remote/sbatsche/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:960<span class="token entity" title="\n">\n</span>github.com/spf13/cobra.(*Command).Execute<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/home/remote/sbatsche/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:897<span class="token entity" title="\n">\n</span>main.Start<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/tmp/etcd-release-3.5.0/etcd/release/etcd/etcdutl/ctl.go:50<span class="token entity" title="\n">\n</span>main.main<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/tmp/etcd-release-3.5.0/etcd/release/etcd/etcdutl/main.go:23<span class="token entity" title="\n">\n</span>runtime.main<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>/home/remote/sbatsche/.gvm/gos/go1.16.3/src/runtime/proc.go:225"</span><span class="token punctuation">&#125;</span>
<span class="token number">2021</span>-10-02T12:01:13+08:00	info	membership/store.go:119	Trimming membership information from the backend<span class="token punctuation">..</span>.
<span class="token number">2021</span>-10-02T12:01:13+08:00	info	membership/cluster.go:393	added member	<span class="token punctuation">&#123;</span><span class="token string">"cluster-id"</span><span class="token builtin class-name">:</span> <span class="token string">"cdf818194e3a8c32"</span>, <span class="token string">"local-member-id"</span><span class="token builtin class-name">:</span> <span class="token string">"0"</span>, <span class="token string">"added-peer-id"</span><span class="token builtin class-name">:</span> <span class="token string">"8e9e05c52164694d"</span>, <span class="token string">"added-peer-peer-urls"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"http://localhost:2380"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
<span class="token number">2021</span>-10-02T12:01:13+08:00	info	snapshot/v3_snapshot.go:272	restored snapshot	<span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"./snap-20211002.db"</span>, <span class="token string">"wal-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore/member/wal"</span>, <span class="token string">"data-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore"</span>, <span class="token string">"snap-dir"</span><span class="token builtin class-name">:</span> <span class="token string">"/tmp/etcd-restore/member/snap"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>$ <span class="token function">ls</span> /tmp/etcd-restore/
member</code></pre>

<p>æ•°æ®æ¢å¤çš„æµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºæ–°çš„etcdé›†ç¾¤</li>
<li>åœæ­¢kubernetesä»¥åŠå…¶ä»–çš„ä¾èµ–etcd çš„æœåŠ¡ã€‚ </li>
<li>åœæ­¢ç©ºç™½çš„æ–°çš„é›†ç¾¤</li>
<li>ä½¿ç”¨å¤‡ä»½çš„æ–‡ä»¶è¿›è¡Œé›†ç¾¤çš„æ¢å¤</li>
<li>ä½¿ç”¨åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹æ¢å¤ç›¸åŒçš„å¤‡ä»½æ–‡ä»¶</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨etcdçš„é›†ç¾¤å¹¶ä¸”è¿›è¡ŒéªŒè¯</li>
<li>å¯åŠ¨Kubernetesçš„ç›¸å…³é›†ç¾¤å’Œç»„ä»¶ã€‚</li>
<li>æŸ¥çœ‹æ¢å¤çš„ç»“æœï¼ŒéªŒè¯å„ä¸ªç»„ä»¶çš„ç›¸å…³æœåŠ¡æ˜¯å¦å·²ç»æ­£å¸¸æ¢å¤ã€‚</li>
</ol>
<h2 id="EtcdèŠ‚ç‚¹çš„ç»´æŠ¤"><a href="#EtcdèŠ‚ç‚¹çš„ç»´æŠ¤" class="headerlink" title="EtcdèŠ‚ç‚¹çš„ç»´æŠ¤"></a>EtcdèŠ‚ç‚¹çš„ç»´æŠ¤</h2><ul>
<li>etcdctl add-etcd  </li>
<li>etcdctl del-etcd</li>
</ul>
<h1 id="èµ„æºæ¸…å•ä»¥åŠAPI"><a href="#èµ„æºæ¸…å•ä»¥åŠAPI" class="headerlink" title="èµ„æºæ¸…å•ä»¥åŠAPI"></a>èµ„æºæ¸…å•ä»¥åŠAPI</h1><h2 id="ç›¸å…³çš„å¤–éƒ¨æœåŠ¡æ¥å£"><a href="#ç›¸å…³çš„å¤–éƒ¨æœåŠ¡æ¥å£" class="headerlink" title="ç›¸å…³çš„å¤–éƒ¨æœåŠ¡æ¥å£"></a>ç›¸å…³çš„å¤–éƒ¨æœåŠ¡æ¥å£</h2><ol>
<li>Container Runtime Interface - CRI</li>
</ol>
<ul>
<li>runc</li>
<li>RKT</li>
</ul>
<ol>
<li>Container Storage Interface - CSI</li>
<li>Container Network Interface - CNI</li>
</ol>
<h2 id="Nodeçš„ç›¸å…³æ“ä½œ"><a href="#Nodeçš„ç›¸å…³æ“ä½œ" class="headerlink" title="Nodeçš„ç›¸å…³æ“ä½œ"></a>Nodeçš„ç›¸å…³æ“ä½œ</h2><ol>
<li>cordon</li>
<li>uncordon</li>
<li>drain</li>
<li>taint</li>
</ol>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡æ—§LVMç¡¬ç›˜æŒ‚è½½å¤±è´¥</title>
    <url>/2020/05/30/Linux/Linux_Lvm2-member-mounterror/</url>
    <content><![CDATA[<p>æˆ‘ä¹‹å‰çš„ç¡¬ç›˜ä¸Šæ˜¯fedoraé»˜è®¤çš„LVMåˆ†åŒºï¼Œæˆ‘æ¢äº†ç¡¬ç›˜ä¹‹åï¼Œå¼„äº†ä¸€ä¸ªç¡¬ç›˜ç›’ï¼ŒæŠŠæ—§çš„ç¡¬ç›˜æ”¾è¿›å»ï¼Œè¿åˆ°ç”µè„‘ä¸Šè¯•å›¾æŠŠæ—§çš„æ•°æ®å–å‡ºæ¥ã€‚å‘ç°ç³»ç»Ÿå·²ç»æ­£ç¡®çš„è¯†åˆ«äº†PVï¼ŒVGï¼ŒLVï¼Œä½†æ˜¯ä¸èƒ½æŒ‚è½½ï¼Œ æç¤ºæ— æ³•è¯»å–ç¡¬ç›˜çš„Superblock å’Œæç¤º mount: unknown filesystem type â€˜LVM2_memberï¼ˆè¿™ä¸ªæç¤ºè¯´æ˜ä½ æ˜¯ç›´æ¥æŒ‚è½½çš„&#x2F;dev&#x2F;sdxï¼ŒLVMéœ€è¦ä½ æŒ‚è½½çš„åº”è¯¥æ˜¯é€»è¾‘å·ï¼Œä¸æ˜¯ç‰©ç†è®¾å¤‡ï¼‰ã€‚</p>
<span id="more"></span>

<h2 id="é—®é¢˜æ˜¯è¿™æ ·çš„"><a href="#é—®é¢˜æ˜¯è¿™æ ·çš„" class="headerlink" title="é—®é¢˜æ˜¯è¿™æ ·çš„"></a>é—®é¢˜æ˜¯è¿™æ ·çš„</h2><pre class="language-bash" data-language="bash"><code class="language-bash">HaydenArchLinux$ lvs
  LV   VG                    Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  home fedora_localhost-live -wi------- <span class="token operator">&lt;</span><span class="token number">118</span>.77g
  root fedora_localhost-live -wi-------   <span class="token number">70</span>.00g
  swap fedora_localhost-live -wi-------    <span class="token number">7</span>.75g
  
---
HaydenArchLinux$ vgs
  VG                    <span class="token comment">#PV #LV #SN Attr   VSize    VFree</span>
  fedora_localhost-live   <span class="token number">1</span>   <span class="token number">3</span>   <span class="token number">0</span> wz--n- <span class="token operator">&lt;</span><span class="token number">196</span>.52g    <span class="token number">0</span>

---
HaydenArchLinux$ vgchange <span class="token parameter variable">-ay</span> /dev/fedora_localhost-live
  device-mapper: create ioctl on fedora_localhost--live-swap LVM-SPkNfSXuuIWyxOArrqJAnfQbYfU4tEKFIj295MyZpNmiMsazbwuGuLsrDgl7u509 failed: Device or resource busy
  device-mapper: create ioctl on fedora_localhost--live-home LVM-SPkNfSXuuIWyxOArrqJAnfQbYfU4tEKFqvyrcOAarRr7ol6o2DbieN2mIRCnqi0m failed: Device or resource busy
  device-mapper: create ioctl on fedora_localhost--live-root LVM-SPkNfSXuuIWyxOArrqJAnfQbYfU4tEKFkTeSg9t8t8dy1jqHhzD6BRcOoJ7dG0H2 failed: Device or resource busy
  <span class="token number">0</span> logical volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> volume group <span class="token string">"fedora_localhost-live"</span> now active
  
---
HaydenArchLinux$ lvdisplay
 --- Logical volume ---
  LV Path                /dev/fedora_localhost-live/home
  LV Name                home
  VG Name                fedora_localhost-live
  LV UUID                qvyrcO-AarR-r7ol-6o2D-bieN-2mIR-Cnqi0m
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost-live, <span class="token number">2020</span>-04-05 03:07:47 +0800
  LV Status              NOT available
  LV Size                <span class="token operator">&lt;</span><span class="token number">118.77</span> GiB
  Current LE             <span class="token number">30405</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto</code></pre>

<p>å¯ä»¥æ³¨æ„çœ‹ä¸Šé¢çš„vgchangeçš„æ—¶å€™æ˜¾ç¤ºLVM-SPkNfSXuuIWyxOArrqJAnfQbYfU4tEKFqvyrcOAarRr7ol6o2DbieN2mIRCnqi0m failed: Device or resource busyï¼Œ lvdisplayæ˜¾ç¤ºlv statusæ˜¯NOT avaliableã€‚</p>
<p>å»Googleäº†ä¸€ä¸‹ï¼Œå¤§éƒ¨åˆ†å¤åˆ¶ç²˜è´´æ¥çš„ç­”æ¡ˆéƒ½æ˜¯ï¼š</p>
<p>ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥mount &#x2F;dev&#x2F;fedora_localhost-live&#x2F;home &#x2F;mnt;ç¬¬äºŒç§æ˜¯æ ¼å¼åŒ–ç¡¬ç›˜ã€‚</p>
<p>æˆ‘ä¸éœ€è¦è¿™ç§ç²—é²çš„å¤„ç†æ–¹å¼ï¼Œç¬¬ä¸€ç§å’Œç¬¬äºŒç§å…¶å®éƒ½æ˜¯åºŸè¯ã€‚</p>
<hr>
<h2 id="å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„"><a href="#å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„" class="headerlink" title="å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„"></a>å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„</h2><p>ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œä½¿ç”¨dmsetupå‘½ä»¤ï¼Œdmsetupæ˜¯ä¸€ä¸ªåå‘åº•å±‚çš„é€»è¾‘å·ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ç°åœ¨å·²ç»æœ‰çš„é€»è¾‘å·è¿›è¡Œæ›´æ”¹ã€‚æˆ‘çš„åˆæ­¥æ€€ç–‘æ˜¯Archè‡ªåŠ¨è¯†åˆ«æŒ‚è½½äº†æ—§ç¡¬ç›˜çš„é€»è¾‘å·ä½†æ˜¯ï¼Œä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°ï¼Œå¯¼è‡´è®¾å¤‡è¢«å ç”¨ä½†æ˜¯æˆ‘æ— æ³•å†æ¬¡æŒ‚è½½ä½¿ç”¨ã€‚ä½¿ç”¨dmsetup remove å‚æ•°å°†ç³»ç»Ÿç°åœ¨å·²ç»è¯†åˆ«å‡ºæ¥çš„é€»è¾‘å·ç§»é™¤ï¼Œ ä¹‹åæ‰‹åŠ¨ä½¿ç”¨vgchangeé‡æ–°è¯»å–ï¼Œé—®é¢˜è§£å†³äº†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">HaydenArchLinux$ dmsetup remove /dev/fedora_localhost-live/home
HaydenArchLinux$ vgchange <span class="token parameter variable">-ay</span>
  <span class="token number">3</span> logical volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> volume group <span class="token string">"fedora_localhost-live"</span> now active
HaydenArchLinux$ lvdisplay
  --- Logical volume ---
  LV Path                /dev/fedora_localhost-live/home
  LV Name                home
  VG Name                fedora_localhost-live
  LV UUID                qvyrcO-AarR-r7ol-6o2D-bieN-2mIR-Cnqi0m
  LV Write Access        read/write
  LV Creation host, <span class="token function">time</span> localhost-live, <span class="token number">2020</span>-04-05 03:07:47 +0800
  LV Status              available
  <span class="token comment"># open                 0</span>
  LV Size                <span class="token operator">&lt;</span><span class="token number">118.77</span> GiB
  Current LE             <span class="token number">30405</span>
  Segments               <span class="token number">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="token builtin class-name">set</span> to     <span class="token number">256</span>
  Block device           <span class="token number">254</span>:1
HaydenArchLinux$ <span class="token function">mount</span> /dev/fedora_localhost-live/home /mnt</code></pre>

<p>å¦‚ä¸Šæ‰æ˜¯æ­£ç¡®çš„å¤„ç†æ–¹å¼ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, LVM, Filesystem, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå†…å­˜ç®¡ç†ç¬”è®°</title>
    <url>/2023/07/11/Linux/Linux_MemoryManagement/</url>
    <content><![CDATA[<hr>
<h2 id="å†…å­˜ç®¡ç†éƒ¨åˆ†çš„ç¬”è®°"><a href="#å†…å­˜ç®¡ç†éƒ¨åˆ†çš„ç¬”è®°" class="headerlink" title="å†…å­˜ç®¡ç†éƒ¨åˆ†çš„ç¬”è®°"></a>å†…å­˜ç®¡ç†éƒ¨åˆ†çš„ç¬”è®°</h2><h3 id="Crashå‘½ä»¤çš„ä½¿ç”¨"><a href="#Crashå‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="Crashå‘½ä»¤çš„ä½¿ç”¨"></a>Crashå‘½ä»¤çš„ä½¿ç”¨</h3><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤éœ€è¦æœ‰debuginfo ä»¥åŠkernel debug çš„æ•°æ®åŒ…ï¼Œ åŒæ—¶å¯èƒ½éœ€è¦gdbã€‚ </p>
<p>éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œé¢å¼€å¯è¿™ä¸ª <strong>ä»“åº“ï¼š rhel-8-baseos-rhui-debug-rpms</strong></p>
<p>å…·ä½“çš„æ­¥éª¤ä¹Ÿå¯ä»¥çœ‹è¿™ä¸ªæ–‡æ¡£ï¼Œ æ¥è‡ªRedhat å®˜æ–¹ï¼š <a href="https://access.redhat.com/solutions/9907">https://access.redhat.com/solutions/9907</a></p>
 <pre class="language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kernel-debuginfo 
<span class="token comment"># ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥å®‰è£…ï¼Œ ä½†æ˜¯å°ºå¯¸éå¸¸çš„å¤§ã€‚</span>
crash /boot/vmlinuz-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-a</span><span class="token variable">)</span></span></code></pre>

<p>ä½¿ç”¨å‘½ä»¤crashæ¥è¿›è¡Œ PM å’Œ VMçš„å¯¹åº”å…³ç³»ï¼š</p>
<p>å†…æ ¸çš„debugæ–‡ä»¶åœ¨ï¼š &#x2F;var&#x2F;lib&#x2F;debug&#x2F;lib&#x2F;modules&#x2F;kernel-version&#x2F;</p>
<p> ä½¿ç”¨crashå‘½ä»¤ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~ <span class="token comment"># â¯â¯â¯ crash</span>

crash <span class="token number">7.3</span>.2-4.el8
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2002</span>-2022  Red Hat, Inc.
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2004</span>, <span class="token number">2005</span>, <span class="token number">2006</span>, <span class="token number">2010</span>  IBM Corporation
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1999</span>-2006  Hewlett-Packard Co
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2005</span>, <span class="token number">2006</span>, <span class="token number">2011</span>, <span class="token number">2012</span>  Fujitsu Limited
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2006</span>, <span class="token number">2007</span>  VA Linux Systems Japan K.K.
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2005</span>, <span class="token number">2011</span>, <span class="token number">2020</span>-2022  NEC Corporation
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1999</span>, <span class="token number">2002</span>, <span class="token number">2007</span>  Silicon Graphics, Inc.
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1999</span>, <span class="token number">2000</span>, <span class="token number">2001</span>, <span class="token number">2002</span>  Mission Critical Linux, Inc.
This program is <span class="token function">free</span> software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter <span class="token string">"help copying"</span> to see the conditions.
This program has absolutely no warranty.  Enter <span class="token string">"help warranty"</span> <span class="token keyword">for</span> details.

GNU gdb <span class="token punctuation">(</span>GDB<span class="token punctuation">)</span> <span class="token number">7.6</span>
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2013</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>
This is <span class="token function">free</span> software: you are <span class="token function">free</span> to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="token string">"show copying"</span>
and <span class="token string">"show warranty"</span> <span class="token keyword">for</span> details.
This GDB was configured as <span class="token string">"x86_64-unknown-linux-gnu"</span><span class="token punctuation">..</span>.

WARNING: kernel relocated <span class="token punctuation">[</span>592MB<span class="token punctuation">]</span>: patching <span class="token number">107327</span> gdb minimal_symbol values

      KERNEL: /usr/lib/debug/lib/modules/4.18.0-477.13.1.el8_8.x86_64/vmlinux  <span class="token punctuation">[</span>TAINTED<span class="token punctuation">]</span>
    DUMPFILE: /proc/kcore
        CPUS: <span class="token number">2</span>
        DATE: Tue Jul <span class="token number">11</span> <span class="token number">17</span>:07:01 CST <span class="token number">2023</span>
      UPTIME: 01:04:34
LOAD AVERAGE: <span class="token number">0.15</span>, <span class="token number">0.03</span>, <span class="token number">0.01</span>
       TASKS: <span class="token number">226</span>
    NODENAME: center
     RELEASE: <span class="token number">4.18</span>.0-477.13.1.el8_8.x86_64
     VERSION: <span class="token comment">#1 SMP Thu May 18 10:27:05 EDT 2023</span>
     MACHINE: x86_64  <span class="token punctuation">(</span><span class="token number">2199</span> Mhz<span class="token punctuation">)</span>
      MEMORY: <span class="token number">7.9</span> GB
         PID: <span class="token number">7657</span>
     COMMAND: <span class="token string">"crash"</span>
        TASK: ffff9ce7d835a800  <span class="token punctuation">[</span>THREAD_INFO: ffff9ce7d835a800<span class="token punctuation">]</span>
         CPU: <span class="token number">0</span>
       STATE: TASK_RUNNING <span class="token punctuation">(</span>ACTIVE<span class="token punctuation">)</span>

crash<span class="token operator">></span> vm <span class="token parameter variable">-p</span> <span class="token punctuation">[</span>pid<span class="token punctuation">]</span>

PID: <span class="token number">913</span>      TASK: ffff9ce7c75fd000  CPU: <span class="token number">0</span>    COMMAND: <span class="token string">"sshd"</span>
       MM               PGD          RSS    TOTAL_VM
ffff9ce7c11b8000  ffff9ce7c75ae000  7604k    76644k
      VMA           START       END     FLAGS FILE
ffff9ce7c759f828 55a7fcc7b000 55a7fcd4c000 <span class="token number">8000875</span> /usr/sbin/sshd
VIRTUAL     PHYSICAL
55a7fcc7b000  12026b000
55a7fcc7c000  1201df000
55a7fcc7d000  1201ec000
55a7fcc7e000  1200c7000
55a7fcc7f000  120c43000
55a7fcc80000  10fa79000
55a7fcc81000  11fdd3000
55a7fcc82000  11087f000
55a7fcc83000  11fa8d000
55a7fcc84000  10fe05000
55a7fcc85000  <span class="token number">110870000</span>
55a7fcc86000  10fa2c000
55a7fcc87000  10f9fc000
55a7fcc88000  10fdab000
55a7fcc89000  11f296000
55a7fcc8a000  1117ec000
55a7fcc8b000  10fdac000
55a7fcc8c000  120c65000
55a7fcc8d000  12011b000
55a7fcc8e000  <span class="token number">110714000</span>
55a7fcc8f000  110c83000
55a7fcc90000  110c90000
55a7fcc91000  110d2b000
55a7fcc92000  <span class="token number">120730000</span>
55a7fcc93000  12076f000
55a7fcc94000  1207e8000
55a7fcc95000  110c2f000
55a7fcc96000  110c3c000
55a7fcc97000  <span class="token number">120650000</span>
55a7fcc98000  1206c1000
55a7fcc99000  120c67000
55a7fcc9a000  120c0f000
55a7fcc9b000  FILE: /usr/sbin/sshd  OFFSET: <span class="token number">20000</span>
55a7fcc9c000  11d46d000
55a7fcc9d000  10fe01000
55a7fcc9e000  10fdb9000
55a7fcc9f000  10fde7000
55a7fcca0000  FILE: /usr/sbin/sshd  OFFSET: <span class="token number">25000</span>
<span class="token comment"># ç»“æœçœç•¥äº†åé¢çš„éƒ¨åˆ†ï¼Œ å¤ªé•¿äº†ã€‚ã€‚ ã€‚ã€‚ </span>


å¯ä»¥çœ‹åˆ°å†…å­˜çš„æ˜ å°„å…³ç³»ï¼Œ notmapped è¡¨ç¤ºæ²¡æœ‰è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„éƒ¨åˆ†ã€‚ 
ä¸€èˆ¬æ¥è¯´ åé¢çš„ä¸‰ä½æ˜¯ä¸€æ ·çš„ï¼Œ å¦‚æœæ˜¯THPçš„è¯ï¼Œ é‚£ä¹ˆåé¢çš„äº”ä½æ˜¯ä¸€æ ·çš„ã€‚

è¿™ä¸ªvtop å¯ä»¥ç›´æ¥æŸ¥çœ‹é‡Œé¢ä¿å­˜çš„å†…å®¹ä»¥åŠå…·ä½“çš„æ˜ å°„å…³ç³»ã€‚ 
crash<span class="token operator">></span> vtop 55d5473fc000
VIRTUAL     PHYSICAL
55d5473fc000  <span class="token punctuation">(</span>not accessible<span class="token punctuation">)</span>

rdå‘½ä»¤å¯ä»¥è¯»å–æŒ‡å®šçš„å†…å­˜è™šæ‹Ÿåœ°å€ä¹‹åçš„åç§»é‡ã€‚
crash<span class="token operator">></span> rd 55d54879d000 <span class="token number">100</span>
rd: invalid user virtual address: 55d54879d000  type: <span class="token string">"64-bit UVADDR"</span>
</code></pre>

<p>è¶…è¿‡å†…å­˜ç”³è¯·å®¹é‡çš„ä½¿ç”¨ï¼Œ ä¼šå¯¼è‡´ è®¿é—®å†…å­˜è¶Šç•Œï¼Œ ä¾‹å¦‚ç”³è¯·äº†1Gçš„å†…å­˜ï¼Œä½†æ˜¯å°è¯•å†™å…¥è¶…å‡ºçš„æ•°æ®é‡ï¼Œ ä¼šå¯¼è‡´æ•°æ®å†™åˆ°åç»­ä¸å±äºè¿™ä¸ªè¿›ç¨‹çš„ç©ºé—´ä¸Šï¼Œ è€Œè¿™ä¸ªæ—¶å€™å†…æ ¸ä¼šè§¦å‘ä¸€ä¸ª segfaultï¼Œ æ¥ç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ã€‚ </p>
<p>è¿™ä¸ªæŠ¥é”™ä¸æ˜¯ç«‹åˆ»å‘ç”Ÿçš„ï¼Œå¯èƒ½ç¡®å®ä¼šæº¢å‡ºä¸€éƒ¨åˆ†ã€‚</p>
<p>åŒ¿åé¡µé¢ å®é™…ä¸Šæ˜¯ mmap with MAP_ANONYMOUS flagæ˜ å°„å‡ºæ¥çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œ å½“éœ€è¦ç¬¬ä¸€æ¬¡å»å†™åŒ¿åé¡µé¢çš„æ—¶å€™ï¼Œ ä¼šå°†ç‰©ç†å†…å­˜çš„åœ°å€æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜å¹¶å°†å…¶ä¸­å¡«0.</p>
<p>overcommit 0 å¯ä»¥æ‰€æœ‰çš„åœ°å€ï¼Œ   1 æ— é™åˆ¶ï¼Œè™šæ‹Ÿå†…å­˜æ²¡æœ‰é™åˆ¶ï¼Œ 2  æŒ‰ç…§ä¸€å®šçš„æ¯”ä¾‹è¿›è¡Œè®¡ç®—ï¼Œ æœ€ç»ˆçš„ç»“æœã€‚ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Memory</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxé…ç½®ç½‘å¡ç­–ç•¥è·¯ç”±</title>
    <url>/2023/07/25/Linux/Linux_MultiNetworkCard-RoutePolicy/</url>
    <content><![CDATA[<p>ä¼šé‡åˆ°Linuxå¤šä¸ªç½‘å¡çš„æ—¶å€™ï¼Œ ç½‘ç»œå¹¶ä¸ä¼šä¿è¯æºåœ°å€è¿›ç½‘å¡ ï¼Œ æºåœ°å€å‡ºç½‘å¡ã€‚ </p>
<p>å¤§ä½¬è¯´ï¼Œ IPåœ°å€çš„å…¶å®å…³è”çš„æ˜¯æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸æ˜¯ç‰¹å®šçš„ç½‘å¡ï¼Œ æ‰€ä»¥å¯¹äºosæ¥è¯´ï¼Œ é‚»å±…å­ç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸‹ç½‘ç»œæ•°æ®ä»å“ªä¸ªç‰©ç†ç½‘å¡å‡ºã€‚ </p>
<p>è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œæ•°æ®åŒ…ä¼šåœ¨ç½‘å¡ä¹‹é—´Forwardä¸€ä¸‹ï¼Œè€Œè½¬å‘å‡ºæ¥çš„æ•°æ®åŒ…ï¼Œ ä¼šè¢«aws vpc ä¸¢åŒ…ï¼Œ å› ä¸ºå‡ºå…¥æ ˆçš„åœ°å€ä¸ä¸€æ ·äº†ã€‚ </p>
<p>å¯¹äºè¿™ä¸ªè¡Œä¸ºï¼Œ éœ€è¦é…ç½®æ“ä½œç³»ç»Ÿçš„è·¯ç”±ç­–ç•¥æ¥è§£å†³ï¼Œ è®©æµé‡ä»ç›¸åŒçš„ç½‘å¡è¿›å‡ºã€‚ </p>
<p>è®°å½•ä¸€ä¸‹è¿™ä¸ªé…ç½®ã€‚</p>
<h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>Ubuntu ç›´æ¥ä½¿ç”¨çš„netplan ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œé¢ç›´æ¥æŒ‡å®špolicyå°±å¯ä»¥äº†ã€‚ </p>
<p>é…ç½®æ–‡ä»¶ä½ç½®ï¼š &#x2F;etc&#x2F;netplan&#x2F;* </p>
<p>é…ç½®æ–‡ä»¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š </p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># cat /etc/netplan/50-cloud-init.yaml</span>
<span class="token comment"># This file is generated from information provided by the datasource.  Changes</span>
<span class="token comment"># to it will not persist across an instance reboot.  To disable cloud-init's</span>
<span class="token comment"># network configuration capabilities, write a file</span>
<span class="token comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span class="token comment"># network: &#123;config: disabled&#125;</span>
<span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
        <span class="token key atrule">ens4</span><span class="token punctuation">:</span>
            <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">match</span><span class="token punctuation">:</span>
                <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>ab<span class="token punctuation">:</span>8e<span class="token punctuation">:</span>b1<span class="token punctuation">:</span>ba<span class="token punctuation">:</span><span class="token number">36</span>
            <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens4
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.48.1
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.51.248
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
               <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
            <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.51.248
                <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
        <span class="token key atrule">ens6</span><span class="token punctuation">:</span>
            <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">match</span><span class="token punctuation">:</span>
                <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>64<span class="token punctuation">:</span>69<span class="token punctuation">:</span>51<span class="token punctuation">:</span>00<span class="token punctuation">:</span>f2
            <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens6
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.48.1
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.59.199
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
               <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
            <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.59.199
                <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span></code></pre>

<h2 id="Redhat-x2F-CentOS-x2F-Fedora-x2F-AmazonLinux2"><a href="#Redhat-x2F-CentOS-x2F-Fedora-x2F-AmazonLinux2" class="headerlink" title="Redhat&#x2F;CentOS&#x2F;Fedora&#x2F;AmazonLinux2"></a>Redhat&#x2F;CentOS&#x2F;Fedora&#x2F;AmazonLinux2</h2><h3 id="æ—§æ–¹å¼è®¾ç½®"><a href="#æ—§æ–¹å¼è®¾ç½®" class="headerlink" title="æ—§æ–¹å¼è®¾ç½®"></a>æ—§æ–¹å¼è®¾ç½®</h3><p>è®¾ç½®å¼€æœºé…ç½®è·¯ç”±çš„æ–¹å¼ï¼Œ ä½¿ç”¨æ—§è„šæœ¬å¾—æ–¹å¼éœ€è¦ç¦ç”¨NetworkManagerï¼Œå®Œå…¨æ‰‹åŠ¨é…ç½®networkdçš„è„šæœ¬ã€‚</p>
<ol>
<li><p>å®‰è£…æ—§çš„è„šæœ¬ç®¡ç†å·¥å…·</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> network-scripts</code></pre>
</li>
<li><p>ç¡®è®¤é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">244</span>
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">174</span> Dec <span class="token number">17</span> <span class="token number">12</span>:30 ifcfg-eth0
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">278</span> Dec <span class="token number">17</span> <span class="token number">15</span>:56 ifcfg-eth1
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">254</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifcfg-lo
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">2123</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> <span class="token function">ifdown</span>
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">646</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-bnep
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">6419</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-eth
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">769</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-ippp
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">4536</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-ipv6
lrwxrwxrwx. <span class="token number">1</span> root root    <span class="token number">11</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-isdn -<span class="token operator">></span> ifdown-ippp
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">2064</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-post
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">870</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-routes
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1458</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-sit
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1621</span> Jul <span class="token number">26</span>  <span class="token number">2020</span> ifdown-Team
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1556</span> Jul <span class="token number">26</span>  <span class="token number">2020</span> ifdown-TeamPort
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1462</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifdown-tunnel
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">5463</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> <span class="token function">ifup</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">12270</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-aliases
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">906</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-bnep
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">13776</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-eth
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">12068</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-ippp
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">11891</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-ipv6
lrwxrwxrwx. <span class="token number">1</span> root root     <span class="token number">9</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-isdn -<span class="token operator">></span> ifup-ippp
-rwxr-xr-x. <span class="token number">1</span> root root   <span class="token number">643</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-plip
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1057</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-plusb
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">5000</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-post
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">2001</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-routes
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">3303</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-sit
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1755</span> Jul <span class="token number">26</span>  <span class="token number">2020</span> ifup-Team
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1876</span> Jul <span class="token number">26</span>  <span class="token number">2020</span> ifup-TeamPort
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">2879</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-tunnel
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">1836</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> ifup-wireless
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">5421</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> init.ipv6-global
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">20431</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> network-functions
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">31037</span> Feb <span class="token number">15</span>  <span class="token number">2021</span> network-functions-ipv6
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">40</span> Dec <span class="token number">17</span> <span class="token number">16</span>:00 route-eth0
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">40</span> Dec <span class="token number">17</span> <span class="token number">16</span>:00 route-eth1
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">28</span> Dec <span class="token number">17</span> <span class="token number">15</span>:40 rule-eth0
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">28</span> Dec <span class="token number">17</span> <span class="token number">15</span>:41 rule-eth1</code></pre>
</li>
<li><p>ä¹¦å†™æ–‡ä»¶å†…å®¹ï¼Œéœ€è¦é…ç½®çš„æ–‡ä»¶å¦‚ä¸‹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> ifcfg-eth0
<span class="token comment"># Created by cloud-init on instance boot automatically, do not edit.</span>
<span class="token comment">#</span>
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>dhcp
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth0
<span class="token assign-left variable">HWADDR</span><span class="token operator">=</span>02:20:22:29:a4:0c
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">STARTMODE</span><span class="token operator">=</span>auto
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">USERCTL</span><span class="token operator">=</span>no
<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> ifcfg-eth1
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>dhcp
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>eth1
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>80caddf5-1347-4246-827e-5e0146c7f2c5
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>eth1
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes

<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> route-eth0
default via <span class="token number">172.31</span>.0.1 dev eth0 table <span class="token number">1</span>

<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> route-eth1
default via <span class="token number">172.31</span>.0.1 dev eth1 table <span class="token number">2</span>

<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> rule-eth0
from <span class="token number">172.31</span>.11.110 lookup <span class="token number">1</span>

<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span>$ <span class="token function">cat</span> rule-eth1
from <span class="token number">172.31</span>.11.124 lookup <span class="token number">2</span>

<span class="token punctuation">[</span>root@ip-172-31-11-110 network-scripts<span class="token punctuation">]</span><span class="token comment"># cat /etc/iproute2/rt_tables</span>
<span class="token comment">#</span>
<span class="token comment"># reserved values</span>
<span class="token comment">#</span>
<span class="token number">255</span>     <span class="token builtin class-name">local</span>
<span class="token number">254</span>     main
<span class="token number">253</span>     default
<span class="token number">1</span>       network0
<span class="token number">2</span>       network1
<span class="token number">0</span>       unspec
<span class="token comment">#</span>
<span class="token comment"># local</span>
<span class="token comment">#</span>
<span class="token comment">#1      inr.ruhep</span></code></pre>
</li>
<li><p>å…³é—­NetworkManagerï¼Œ å¼€å¯Networkd</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">358</span>  <span class="token function">sudo</span> systemctl stop NetworkManager
<span class="token number">380</span>  <span class="token function">sudo</span> systemctl disable NetworkManager
<span class="token number">375</span>  <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> network
<span class="token number">377</span>  <span class="token function">sudo</span> systemctl restart network</code></pre>
</li>
<li><p>é‡å¯ï¼Œ å®Œæˆ</p>
</li>
</ol>
<h3 id="ä½¿ç”¨NetworkManagerè®¾ç½®"><a href="#ä½¿ç”¨NetworkManagerè®¾ç½®" class="headerlink" title="ä½¿ç”¨NetworkManagerè®¾ç½®"></a>ä½¿ç”¨NetworkManagerè®¾ç½®</h3><p>ä½¿ç”¨network Managerçš„æ–¹å¼éœ€è¦æœ‰ä¸¤ä¸ªå‰ç½®çš„æ¡ä»¶ã€‚   </p>
<ul>
<li>å¼€å¯ NetworkManager </li>
<li>å¼€å¯ Firewalld</li>
</ul>
<p>å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œæ²¡æµ‹è¯•ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">nmcli connection <span class="token function">add</span> <span class="token builtin class-name">type</span> ethernet con-name Internal-Workstations-0 ifname eth0 ipv4.method manual ipv4.addresses <span class="token number">172.31</span>.11.110 ipv4.routes <span class="token string">"172.31.11.110 src=172.31.0.1 table=1"</span> ipv4.routing-rules <span class="token string">"priority 500 from 172.31.11.110 table 1"</span> connection.zone internal-0

nmcli connection <span class="token function">add</span> <span class="token builtin class-name">type</span> ethernet con-name Internal-Workstations-1 ifname eth1 ipv4.method manual ipv4.addresses <span class="token number">172.31</span>.11.124 ipv4.routes <span class="token string">"172.31.11.124 src=172.31.0.1 table=2"</span> ipv4.routing-rules <span class="token string">"priority 600 from 172.31.11.124 table 2"</span> connection.zone internal-1</code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, EC2, Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxç¼–è¯‘å®‰è£…</title>
    <url>/2018/01/22/Linux/Linux_Nginx-InstalltionNote/</url>
    <content><![CDATA[<p>å¾ˆä¹…ä¹‹å‰çš„ç¬”è®°äº†ï¼Œå‘å‡ºæ¥ï¼Œåšç¼–è¯‘å®‰è£…Nginxçš„æ—¶å€™è®°å½•çš„â€¦â€¦åŒ…æ‹¬å®‰è£…å‘½ä»¤å’Œè„šæœ¬â€¦â€¦</p>
<h2 id="å®‰è£…nginxæœåŠ¡å™¨"><a href="#å®‰è£…nginxæœåŠ¡å™¨" class="headerlink" title="å®‰è£…nginxæœåŠ¡å™¨"></a>å®‰è£…nginxæœåŠ¡å™¨</h2><ol>
<li>ä¸‹è½½<a href="http://zlib.net/">zlib</a>ï¼Œ<a href="http://www.pcre.org/">pcre</a>ï¼Œ<a href="http://nginx.org/en/download.html">nginx</a>  </li>
<li>å®‰è£…zlib<br><code>[root@localhost Liarlee]# cd zlib-[version]</code><br><code>[root@localhost Liarlee]# ./configure --prefix=/usr/local/zlib</code></li>
<li>å®‰è£…pcre<br><code>[root@localhost Liarlee]# cd pcre-[version]</code><br><code>[root@localhost Liarlee]# ./configure --prefix=/usr/local/pcre</code></li>
<li>å®‰è£…nginx<br><code>[root@localhost Liarlee]# cd nginx-[version]</code><br><code>[root@localhost Liarlee]# ./configure --prefix=/usr/local/nginx</code></li>
<li>å®‰è£…å®Œæˆ</li>
</ol>
<hr>
<h2 id="é…ç½®Sys-V-è„šæœ¬ï¼š"><a href="#é…ç½®Sys-V-è„šæœ¬ï¼š" class="headerlink" title="é…ç½®Sys V è„šæœ¬ï¼š"></a>é…ç½®Sys V è„šæœ¬ï¼š</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#</span>
<span class="token comment"># nginx - this script starts and stops the nginx daemon</span>
<span class="token comment">#</span>
<span class="token comment"># chkconfig:   - 85 15</span>
<span class="token comment"># description:  Nginx is an HTTP(S) server, HTTP(S) reverse \</span>
<span class="token comment">#               proxy and IMAP/POP3 proxy server</span>
<span class="token comment"># processname: nginx</span>
<span class="token comment"># config:      /etc/nginx/nginx.conf</span>
<span class="token comment"># config:      /etc/sysconfig/nginx</span>
<span class="token comment"># pidfile:     /var/run/nginx.pid</span>
<span class="token comment"># Source function library.</span>
<span class="token builtin class-name">.</span> /etc/rc.d/init.d/functions
<span class="token comment"># Source networking configuration.</span>
<span class="token builtin class-name">.</span> /etc/sysconfig/network
<span class="token comment"># Check that networking is up.</span>
<span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$NETWORKING</span>"</span> <span class="token operator">=</span> <span class="token string">"no"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token string">"/usr/sbin/nginx"</span>
<span class="token assign-left variable">prog</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $nginx<span class="token variable">)</span></span>
<span class="token assign-left variable">NGINX_CONF_FILE</span><span class="token operator">=</span><span class="token string">"/etc/nginx/nginx.conf"</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/sysconfig/nginx <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/sysconfig/nginx
<span class="token assign-left variable">lockfile</span><span class="token operator">=</span>/var/lock/subsys/nginx
<span class="token function-name function">make_dirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment"># make required directories</span>
   <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>nginx <span class="token parameter variable">-V</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"configure arguments:"</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/[^*]*--user=\([^ ]*\).*/\1/g'</span> -<span class="token variable">`</span></span>
   <span class="token assign-left variable">options</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$nginx <span class="token parameter variable">-V</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'configure arguments:'</span><span class="token variable">`</span></span>
   <span class="token keyword">for</span> <span class="token for-or-select variable">opt</span> <span class="token keyword">in</span> <span class="token variable">$options</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
       <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $opt <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'.*-temp-path'</span><span class="token variable">`</span></span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
           <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $opt <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-d</span> <span class="token string">"="</span> <span class="token parameter variable">-f</span> <span class="token number">2</span><span class="token variable">`</span></span>
           <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$value</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
               <span class="token comment"># echo "creating" $value</span>
               <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$value</span> <span class="token operator">&amp;&amp;</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token variable">$user</span> <span class="token variable">$value</span>
           <span class="token keyword">fi</span>
       <span class="token keyword">fi</span>
   <span class="token keyword">done</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span> <span class="token parameter variable">-x</span> <span class="token variable">$nginx</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">5</span>
    <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token variable">$NGINX_CONF_FILE</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">6</span>
    make_dirs
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> $<span class="token string">"Starting <span class="token variable">$prog</span>: "</span>
    daemon <span class="token variable">$nginx</span> <span class="token parameter variable">-c</span> <span class="token variable">$NGINX_CONF_FILE</span>
    <span class="token assign-left variable">retval</span><span class="token operator">=</span><span class="token variable">$?</span>
    <span class="token builtin class-name">echo</span>
    <span class="token punctuation">[</span> <span class="token variable">$retval</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> <span class="token variable">$lockfile</span>
    <span class="token builtin class-name">return</span> <span class="token variable">$retval</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> $<span class="token string">"Stopping <span class="token variable">$prog</span>: "</span>
    killproc <span class="token variable">$prog</span> <span class="token parameter variable">-QUIT</span>
    <span class="token assign-left variable">retval</span><span class="token operator">=</span><span class="token variable">$?</span>
    <span class="token builtin class-name">echo</span>
    <span class="token punctuation">[</span> <span class="token variable">$retval</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$lockfile</span>
    <span class="token builtin class-name">return</span> <span class="token variable">$retval</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    configtest <span class="token operator">||</span> <span class="token builtin class-name">return</span> <span class="token variable">$?</span>
    stop
    <span class="token function">sleep</span> <span class="token number">1</span>
    start
<span class="token punctuation">&#125;</span>
<span class="token function-name function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    configtest <span class="token operator">||</span> <span class="token builtin class-name">return</span> <span class="token variable">$?</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> $<span class="token string">"Reloading <span class="token variable">$prog</span>: "</span>
    killproc <span class="token variable">$nginx</span> <span class="token parameter variable">-HUP</span>
    <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>
    <span class="token builtin class-name">echo</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">force_reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    restart
<span class="token punctuation">&#125;</span>
<span class="token function-name function">configtest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token variable">$nginx</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> <span class="token variable">$NGINX_CONF_FILE</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">rh_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    status <span class="token variable">$prog</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">rh_status_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    rh_status <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
    start<span class="token punctuation">)</span>
        rh_status_q <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
        <span class="token variable">$1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    stop<span class="token punctuation">)</span>
        rh_status_q <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
        <span class="token variable">$1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    restart<span class="token operator">|</span>configtest<span class="token punctuation">)</span>
        <span class="token variable">$1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    reload<span class="token punctuation">)</span>
        rh_status_q <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">7</span>
        <span class="token variable">$1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    force-reload<span class="token punctuation">)</span>
        force_reload
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    status<span class="token punctuation">)</span>
        rh_status
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    condrestart<span class="token operator">|</span>try-restart<span class="token punctuation">)</span>
        rh_status_q <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> $<span class="token string">"Usage: <span class="token variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span>
        <span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">esac</span></code></pre>
<h1 id="è¡¥å……ä¸€äº›"><a href="#è¡¥å……ä¸€äº›" class="headerlink" title="è¡¥å……ä¸€äº›"></a>è¡¥å……ä¸€äº›</h1><ol>
<li>åœ¨ç¼–è¯‘å®‰è£…çš„nginxä¸­ï¼Œå¯èƒ½æ²¡æœ‰conf.dç›®å½•ï¼Œåªè¦è‡ªå·±çš„nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œ httpå­—æ®µä¸‹æ·»åŠ include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf å°±å¯ä»¥ä½¿ç”¨conf.dç›®å½•è¿›è¡Œä¸åŒç«™ç‚¹ç‹¬ç«‹é…ç½®æ–‡ä»¶çš„é…ç½®äº†ã€‚</li>
<li>Nginxå¯ä»¥æ”¯æŒåŒæ ·ä½¿ç”¨80ç«¯å£ï¼Œ ä½†æ˜¯ä½¿ç”¨ä¸åŒåŸŸåè¿›è¡Œç«™ç‚¹çš„å‘å¸ƒã€‚ä¹‹å‰æ²¡æœ‰ç¡®åˆ‡çš„è¯•è¿‡ï¼Œä»Šå¤©ç¡®å®ç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸‹æ¥ã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸åŒçš„server {}å­—æ®µï¼Œå®šä¹‰ä¸åŒçš„server_name ï¼Œ ä¸¤ä¸ªç«™ç‚¹å¯ä»¥åŒæ—¶listenåœ¨80 ç«¯å£ä¸Šã€‚è®¿é—®çš„æ—¶å€™ä¸åŒçš„åŸŸåä¼šç›´æ¥è®¿é—®åˆ°ä¸åŒçš„ç›®å½•ã€‚Over.</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx, Application</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxæ€§èƒ½è°ƒæ•´ï¼ˆä¸ä¸€å®šå¯¹</title>
    <url>/2022/12/27/Linux/Linux_Nginx-Performance-Tuning-Pre-md/</url>
    <content><![CDATA[<h1 id="Nginx-æ€§èƒ½ä¼˜åŒ–"><a href="#Nginx-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="Nginx æ€§èƒ½ä¼˜åŒ–"></a>Nginx æ€§èƒ½ä¼˜åŒ–</h1><p>çœ‹äº†ä¸å°‘çš„æ–‡æ¡£å’Œè¯´æ˜ï¼Œ å°è¯•è°ƒæ•´ä¸€ä¸‹Nginxï¼Œçœ‹çœ‹ä¸é»˜è®¤çš„è®¾ç½®æ€§èƒ½è¡¨ç°èƒ½æœ‰å¤šå¤§çš„å·®è·,é¡ºä¾¿è®°å½•ä¸€ä¸‹æ­¥éª¤ï¼Œä¸è®°å½•çš„è¯è‡ªå·±ä¼šå¿˜è®°çš„ã€‚ </p>
<h2 id="Sysctl-å‚æ•°"><a href="#Sysctl-å‚æ•°" class="headerlink" title="Sysctl å‚æ•°"></a>Sysctl å‚æ•°</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/sysctl.d/99-hayden.cof
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">8192</span> <span class="token number">4194304</span> <span class="token number">8388608</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">8192</span> <span class="token number">4194304</span> <span class="token number">8388608</span>

net.core.somaxconn <span class="token operator">=</span> <span class="token number">262144</span>

<span class="token assign-left variable">net.core.default_qdisc</span><span class="token operator">=</span>fq
<span class="token assign-left variable">net.ipv4.tcp_congestion_control</span><span class="token operator">=</span>bbr</code></pre>
<h2 id="Nginx-Config"><a href="#Nginx-Config" class="headerlink" title="Nginx Config"></a>Nginx Config</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/nginx/nginx.conf

user nginx<span class="token punctuation">;</span>
worker_processes <span class="token number">1</span><span class="token punctuation">;</span>
worker_cpu_affinity <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment"># error_log /var/log/nginx/error.log;</span>
pid /run/nginx.pid<span class="token punctuation">;</span>

<span class="token comment"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span>
include /usr/share/nginx/modules/*.conf<span class="token punctuation">;</span>

events <span class="token punctuation">&#123;</span>
    worker_connections <span class="token number">10240</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">..</span>.<span class="token comment"># åé¢çš„éƒ½æ˜¯é»˜è®¤å€¼ã€‚</span></code></pre>

<h2 id="Systemd-Nginx-Service"><a href="#Systemd-Nginx-Service" class="headerlink" title="Systemd Nginx Service"></a>Systemd Nginx Service</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ systemctl <span class="token function">cat</span> nginx
<span class="token comment"># /usr/lib/systemd/system/nginx.service</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>The nginx HTTP and reverse proxy server
<span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target remote-fs.target nss-lookup.target
<span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/run/nginx.pid
<span class="token comment"># Nginx will fail to start if /run/nginx.pid already exists but has the wrong</span>
<span class="token comment"># SELinux context. This might happen when running `nginx -t` from the cmdline.</span>
<span class="token comment"># https://bugzilla.redhat.com/show_bug.cgi?id=1268621</span>
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/bin/rm <span class="token parameter variable">-f</span> /run/nginx.pid
<span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/sbin/nginx <span class="token parameter variable">-t</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/nginx
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/sbin/nginx <span class="token parameter variable">-s</span> reload
<span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGQUIT
<span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>true
<span class="token assign-left variable">LimitAS</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitRSS</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitCORE</span><span class="token operator">=</span>infinity
<span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token assign-left variable">LimitNPROC</span><span class="token operator">=</span><span class="token number">65535</span>
<span class="token assign-left variable">Nice</span><span class="token operator">=</span>-20

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</code></pre>
<h2 id="CPU-Isolate"><a href="#CPU-Isolate" class="headerlink" title="CPU Isolate"></a>CPU Isolate</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/default/grub
<span class="token assign-left variable">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="token operator">=</span><span class="token string">"console=tty0 console=ttyS0,115200n8 net.ifnames=0 biosdevname=0 nvme_core.io_timeout=4294967295 rd.emergency=poweroff rd.shell=0 isolcpus=1 nohz_full=1 rcu_nocbs=1"</span>
<span class="token assign-left variable">GRUB_TIMEOUT</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">GRUB_DISABLE_RECOVERY</span><span class="token operator">=</span><span class="token string">"true"</span>
<span class="token assign-left variable">GRUB_TERMINAL</span><span class="token operator">=</span><span class="token string">"ec2-console"</span>
<span class="token assign-left variable">GRUB_X86_USE_32BIT</span><span class="token operator">=</span><span class="token string">"true"</span></code></pre>

<h2 id="è°ƒæ•´ä¸­æ–­"><a href="#è°ƒæ•´ä¸­æ–­" class="headerlink" title="è°ƒæ•´ä¸­æ–­"></a>è°ƒæ•´ä¸­æ–­</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /proc/interrupts
           CPU0       CPU1
 <span class="token number">27</span>:          <span class="token number">0</span>        <span class="token number">845</span>   PCI-MSI <span class="token number">81920</span>-edge      ena-mgmnt@pci:0000:00:05.0
 <span class="token number">28</span>:    <span class="token number">1455005</span>          <span class="token number">0</span>   PCI-MSI <span class="token number">81921</span>-edge      eth0-Tx-Rx-0
 <span class="token number">29</span>:          <span class="token number">0</span>    <span class="token number">1870959</span>   PCI-MSI <span class="token number">81922</span>-edge      eth0-Tx-Rx-1
LOC:     <span class="token number">119785</span>      <span class="token number">15755</span>   Local timer interrupts

~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token number">0</span> <span class="token operator">></span> /proc/irq/29/smp_affinity_list
~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token number">0</span> <span class="token operator">></span> /proc/irq/28/smp_affinity_list
~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token number">0</span> <span class="token operator">></span> /proc/irq/27/smp_affinity_list</code></pre>

<h2 id="å…³é—­-Irqbalance"><a href="#å…³é—­-Irqbalance" class="headerlink" title="å…³é—­ Irqbalance"></a>å…³é—­ Irqbalance</h2><pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl stop irqbalance.service
~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl disable irqbalance.service
Removed symlink /etc/systemd/system/multi-user.target.wants/irqbalance.service.</code></pre>

<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>è¿™äº›éƒ½åšå®Œä¹‹åï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå®‰è£…nginxä¹‹åä¸åšä»»ä½•çš„åŠ¨ä½œï¼Œ ä½¿ç”¨abå‘½ä»¤æµ‹è¯•é»˜è®¤é¡µ index.htmlã€‚ å¯¹æ¯”</p>
<h2 id="è°ƒæ•´åçš„å®ä¾‹ç»“æœå¦‚ä¸‹"><a href="#è°ƒæ•´åçš„å®ä¾‹ç»“æœå¦‚ä¸‹" class="headerlink" title="è°ƒæ•´åçš„å®ä¾‹ç»“æœå¦‚ä¸‹"></a>è°ƒæ•´åçš„å®ä¾‹ç»“æœå¦‚ä¸‹</h2><p>ä½¿ç”¨å‘½ä»¤ï¼š <code>ab -c 3000 -n 50000 http://172.31.37.166:80/index.html</code></p>
<h3 id="ç¬¬ä¸€æ¬¡"><a href="#ç¬¬ä¸€æ¬¡" class="headerlink" title="ç¬¬ä¸€æ¬¡"></a>ç¬¬ä¸€æ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        732 bytes

Concurrency Level:      3000
Time taken for tests:   2.225 seconds
Complete requests:      50000
Failed requests:        0
Total transferred:      48250000 bytes
HTML transferred:       36600000 bytes
Requests per second:    22474.64 [#&#x2F;sec] (mean)
Time per request:       133.484 [ms] (mean)
Time per request:       0.044 [ms] (mean, across all concurrent requests)
Transfer rate:          21179.71 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   67 139.7     47    1124
Processing:    25   63  16.1     61     274
Waiting:        0   47  13.7     46     254
Total:         57  130 143.2    106    1191

Percentage of the requests served within a certain time (ms)
  50%    106
  66%    125
  75%    131
  80%    135
  90%    142
  95%    149
  98%    165
  99%   1173
 100%   1191 (longest request)</code></pre>
<h3 id="ç¬¬äºŒæ¬¡"><a href="#ç¬¬äºŒæ¬¡" class="headerlink" title="ç¬¬äºŒæ¬¡"></a>ç¬¬äºŒæ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        732 bytes

Concurrency Level:      3000
Time taken for tests:   2.232 seconds
Complete requests:      50000
Failed requests:        0
Total transferred:      48250000 bytes
HTML transferred:       36600000 bytes
Requests per second:    22397.25 [#&#x2F;sec] (mean)
Time per request:       133.945 [ms] (mean)
Time per request:       0.045 [ms] (mean, across all concurrent requests)
Transfer rate:          21106.78 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   67 141.3     47    1092
Processing:    22   63  15.8     60     106
Waiting:        0   47  13.5     46      84
Total:         60  130 143.5    108    1175

Percentage of the requests served within a certain time (ms)
  50%    108
  66%    122
  75%    131
  80%    134
  90%    141
  95%    149
  98%    165
  99%   1150
 100%   1175 (longest request)</code></pre>
<h3 id="ç¬¬ä¸‰æ¬¡"><a href="#ç¬¬ä¸‰æ¬¡" class="headerlink" title="ç¬¬ä¸‰æ¬¡"></a>ç¬¬ä¸‰æ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        732 bytes

Concurrency Level:      3000
Time taken for tests:   2.220 seconds
Complete requests:      50000
Failed requests:        0
Total transferred:      48250000 bytes
HTML transferred:       36600000 bytes
Requests per second:    22526.08 [#&#x2F;sec] (mean)
Time per request:       133.179 [ms] (mean)
Time per request:       0.044 [ms] (mean, across all concurrent requests)
Transfer rate:          21228.19 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   64 123.5     49    1087
Processing:    35   65  15.1     63     108
Waiting:        0   48  13.2     48      88
Total:         61  129 125.5    115    1166

Percentage of the requests served within a certain time (ms)
  50%    115
  66%    123
  75%    132
  80%    136
  90%    140
  95%    145
  98%    159
  99%   1139
 100%   1166 (longest request)</code></pre>

<h2 id="å¹¶æœªè°ƒæ•´çš„å®ä¾‹ç»“æœå¦‚ä¸‹"><a href="#å¹¶æœªè°ƒæ•´çš„å®ä¾‹ç»“æœå¦‚ä¸‹" class="headerlink" title="å¹¶æœªè°ƒæ•´çš„å®ä¾‹ç»“æœå¦‚ä¸‹"></a>å¹¶æœªè°ƒæ•´çš„å®ä¾‹ç»“æœå¦‚ä¸‹</h2><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>ab -c 3000 -n 50000 http://172.31.45.66:80/index.html</code></p>
<h3 id="ç¬¬ä¸€æ¬¡-1"><a href="#ç¬¬ä¸€æ¬¡-1" class="headerlink" title="ç¬¬ä¸€æ¬¡"></a>ç¬¬ä¸€æ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        615 bytes

Concurrency Level:      3000
Time taken for tests:   2.197 seconds
Complete requests:      50000
Failed requests:        9856
   (Connect: 0, Receive: 0, Length: 4928, Exceptions: 4928)
Total transferred:      38221056 bytes
HTML transferred:       27719280 bytes
Requests per second:    22754.61 [#&#x2F;sec] (mean)
Time per request:       131.841 [ms] (mean)
Time per request:       0.044 [ms] (mean, across all concurrent requests)
Transfer rate:          16986.43 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   61 115.4     47    1110
Processing:    23   65  15.2     65     112
Waiting:        0   45  18.6     48      88
Total:         61  126 115.4    111    1209

Percentage of the requests served within a certain time (ms)
  50%    111
  66%    120
  75%    125
  80%    128
  90%    139
  95%    144
  98%    157
  99%   1143
 100%   1209 (longest request)
</code></pre>
<h3 id="ç¬¬äºŒæ¬¡-1"><a href="#ç¬¬äºŒæ¬¡-1" class="headerlink" title="ç¬¬äºŒæ¬¡"></a>ç¬¬äºŒæ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        615 bytes

Concurrency Level:      3000
Time taken for tests:   2.202 seconds
Complete requests:      50000
Failed requests:        9408
   (Connect: 0, Receive: 0, Length: 4704, Exceptions: 4704)
Total transferred:      38411008 bytes
HTML transferred:       27857040 bytes
Requests per second:    22710.18 [#&#x2F;sec] (mean)
Time per request:       132.099 [ms] (mean)
Time per request:       0.044 [ms] (mean, across all concurrent requests)
Transfer rate:          17037.52 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   64 123.9     48    1089
Processing:    22   65  15.9     65     116
Waiting:        0   46  18.9     48      89
Total:         65  128 125.4    111    1171

Percentage of the requests served within a certain time (ms)
  50%    111
  66%    124
  75%    128
  80%    132
  90%    141
  95%    146
  98%    166
  99%   1124
 100%   1171 (longest request)
</code></pre>
<h3 id="ç¬¬ä¸‰æ¬¡-1"><a href="#ç¬¬ä¸‰æ¬¡-1" class="headerlink" title="ç¬¬ä¸‰æ¬¡"></a>ç¬¬ä¸‰æ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        615 bytes

Concurrency Level:      3000
Time taken for tests:   2.236 seconds
Complete requests:      50000
Failed requests:        9216
   (Connect: 0, Receive: 0, Length: 4608, Exceptions: 4608)
Total transferred:      38492416 bytes
HTML transferred:       27916080 bytes
Requests per second:    22361.25 [#&#x2F;sec] (mean)
Time per request:       134.161 [ms] (mean)
Time per request:       0.045 [ms] (mean, across all concurrent requests)
Transfer rate:          16811.30 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   64 111.8     52    1110
Processing:    26   67  15.8     67     113
Waiting:        0   47  19.0     49      86
Total:         65  130 114.2    118    1205

Percentage of the requests served within a certain time (ms)
  50%    118
  66%    126
  75%    131
  80%    134
  90%    141
  95%    147
  98%    158
  99%   1117
 100%   1205 (longest request)</code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¦‚æœå¯¹æ¯”çš„è¯ï¼Œ å¯ä»¥æ˜æ˜¾çš„å‘ç°ï¼ŒConnection Time çš„è¾“å‡ºä¸­ï¼Œ æ˜æ˜¾çœ‹åˆ°Processing é˜¶æ®µï¼ˆåœ¨ 15.8 - 16.1 ä¹‹é—´ï¼‰ å’Œ Waitingé˜¶æ®µ ï¼ˆåœ¨ 13.2 - 13.7 ä¹‹é—´ï¼‰ å˜å¾—ç¨³å®šã€‚</p>
<p>è§‚å¯ŸCPUä½¿ç”¨ç‡ï¼Œ é»˜è®¤çš„è®¾ç½® CPU çš„ä½¿ç”¨ç‡åœ¨å¤šä¸ªæ ¸å¿ƒä¹‹é—´å‡è¡¡ï¼Œ IRQä»¥åŠ us sys åœ¨å¤šä¸ªæ ¸å¿ƒä¸Šå¹³å‡åˆ†å¸ƒã€‚<br>è°ƒæ•´ä¹‹åï¼Œ Nginxåœ¨CPU1ä¸Šå¤„ç†æ•°æ®ï¼Œ ä¸­æ–­ä»¥åŠå…¶ä»–è¿›ç¨‹å®Œå…¨è·‘æ»¡CPU0ï¼Œ Nginxå•ç‹¬åœ¨CPU1ä¸Šé¢å·¥ä½œï¼Œ æœ€å¤§ç¨‹åº¦çš„å¤„ç†æ•°æ®ã€‚ è¿™ä¹Ÿæ˜¯abå‘½ä»¤ä¸­è¿”å›çš„ processing time æ›´çŸ­æ›´ç¨³å®šçš„åŸå› ï¼ˆå¤§æ¦‚ã€‚</p>
<p>åœ¨è°ƒæ•´ä¹‹åï¼Œ CPU1 ä¸Šé¢ä¼šè§¦å‘å¤§é‡çš„RESä¸­æ–­ï¼Œ è¿™ä¼šå¯¼è‡´å½“å‰çš„CPUæ— æ³•å®Œå…¨çš„è·‘æ»¡ï¼Œ è¿™ä¸ªéƒ¨åˆ†è¿˜æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œ æˆ‘ä¸çŸ¥é“RESçš„ä¸­æ–­èƒ½ä¸èƒ½ä¹Ÿç§»é™¤ï¼Œ ä¸è¿‡æˆ‘æ„Ÿè§‰è¿™ä¸ªå¯èƒ½å¹¶ä¸èƒ½ï¼Œ åº”è¯¥æ˜¯è°ƒåº¦çš„éœ€è¦ï¼Œ ä½†æ˜¯è¿‡å¤šçš„ä¸­æ–­æ•°é‡æœ¬èº«ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œ å¯èƒ½è¿˜æœ‰å…¶ä»–çš„è§£æ³•ï¼Œ æš‚æ—¶ä¸å»è€ƒè™‘äº†ã€‚é—ç•™ã€‚</p>
<h1 id="é™„åŠ é™æ€é¡µé¢ä¹‹åçš„æµ‹è¯•"><a href="#é™„åŠ é™æ€é¡µé¢ä¹‹åçš„æµ‹è¯•" class="headerlink" title="é™„åŠ é™æ€é¡µé¢ä¹‹åçš„æµ‹è¯•"></a>é™„åŠ é™æ€é¡µé¢ä¹‹åçš„æµ‹è¯•</h1><p>Hexo Render Project</p>
<h2 id="è°ƒæ•´ä¹‹åçš„æµ‹è¯•"><a href="#è°ƒæ•´ä¹‹åçš„æµ‹è¯•" class="headerlink" title="è°ƒæ•´ä¹‹åçš„æµ‹è¯•"></a>è°ƒæ•´ä¹‹åçš„æµ‹è¯•</h2><p>å‘½ä»¤ï¼š <code>ab -c 3000 -n 50000 http://172.31.37.166:80/index.html</code></p>
<h3 id="ç¬¬ä¸€æ¬¡-2"><a href="#ç¬¬ä¸€æ¬¡-2" class="headerlink" title="ç¬¬ä¸€æ¬¡"></a>ç¬¬ä¸€æ¬¡</h3><pre class="language-bash" data-language="bash"><code class="language-bash">Document Path:          /index.html
Document Length:        <span class="token number">35312</span> bytes

Concurrency Level:      <span class="token number">3000</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">3.373</span> seconds
Complete requests:      <span class="token number">50000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1777400000</span> bytes
HTML transferred:       <span class="token number">1765600000</span> bytes
Requests per second:    <span class="token number">14822.50</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">202.395</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.067</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">514560.94</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">54</span> <span class="token number">104.2</span>     <span class="token number">44</span>    <span class="token number">1061</span>
Processing:    <span class="token number">37</span>  <span class="token number">144</span>  <span class="token number">23.0</span>    <span class="token number">145</span>     <span class="token number">196</span>
Waiting:        <span class="token number">0</span>   <span class="token number">41</span>  <span class="token number">14.4</span>     <span class="token number">38</span>     <span class="token number">103</span>
Total:         <span class="token number">80</span>  <span class="token number">198</span> <span class="token number">108.1</span>    <span class="token number">193</span>    <span class="token number">1229</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">193</span>
  <span class="token number">66</span>%    <span class="token number">200</span>
  <span class="token number">75</span>%    <span class="token number">207</span>
  <span class="token number">80</span>%    <span class="token number">209</span>
  <span class="token number">90</span>%    <span class="token number">215</span>
  <span class="token number">95</span>%    <span class="token number">218</span>
  <span class="token number">98</span>%    <span class="token number">231</span>
  <span class="token number">99</span>%   <span class="token number">1194</span>
 <span class="token number">100</span>%   <span class="token number">1229</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre>
<h3 id="ç¬¬äºŒæ¬¡-2"><a href="#ç¬¬äºŒæ¬¡-2" class="headerlink" title="ç¬¬äºŒæ¬¡"></a>ç¬¬äºŒæ¬¡</h3><pre class="language-bash" data-language="bash"><code class="language-bash">Document Path:          /index.html
Document Length:        <span class="token number">35312</span> bytes

Concurrency Level:      <span class="token number">3000</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">3.094</span> seconds
Complete requests:      <span class="token number">50000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1777400000</span> bytes
HTML transferred:       <span class="token number">1765600000</span> bytes
Requests per second:    <span class="token number">16157.77</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">185.669</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.062</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">560914.54</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">54</span> <span class="token number">120.1</span>     <span class="token number">39</span>    <span class="token number">1070</span>
Processing:    <span class="token number">64</span>  <span class="token number">127</span>  <span class="token number">19.7</span>    <span class="token number">128</span>     <span class="token number">180</span>
Waiting:        <span class="token number">0</span>   <span class="token number">37</span>  <span class="token number">14.1</span>     <span class="token number">35</span>      <span class="token number">98</span>
Total:        <span class="token number">106</span>  <span class="token number">181</span> <span class="token number">123.6</span>    <span class="token number">171</span>    <span class="token number">1240</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">171</span>
  <span class="token number">66</span>%    <span class="token number">180</span>
  <span class="token number">75</span>%    <span class="token number">183</span>
  <span class="token number">80</span>%    <span class="token number">184</span>
  <span class="token number">90</span>%    <span class="token number">190</span>
  <span class="token number">95</span>%    <span class="token number">195</span>
  <span class="token number">98</span>%    <span class="token number">204</span>
  <span class="token number">99</span>%   <span class="token number">1184</span>
 <span class="token number">100</span>%   <span class="token number">1240</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre>
<h3 id="ç¬¬ä¸‰æ¬¡-2"><a href="#ç¬¬ä¸‰æ¬¡-2" class="headerlink" title="ç¬¬ä¸‰æ¬¡"></a>ç¬¬ä¸‰æ¬¡</h3><pre class="language-bash" data-language="bash"><code class="language-bash">Document Path:          /index.html
Document Length:        <span class="token number">35312</span> bytes

Concurrency Level:      <span class="token number">3000</span>
Time taken <span class="token keyword">for</span> tests:   <span class="token number">3.212</span> seconds
Complete requests:      <span class="token number">50000</span>
Failed requests:        <span class="token number">0</span>
Total transferred:      <span class="token number">1777400000</span> bytes
HTML transferred:       <span class="token number">1765600000</span> bytes
Requests per second:    <span class="token number">15565.24</span> <span class="token punctuation">[</span><span class="token comment">#/sec] (mean)</span>
Time per request:       <span class="token number">192.737</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean<span class="token punctuation">)</span>
Time per request:       <span class="token number">0.064</span> <span class="token punctuation">[</span>ms<span class="token punctuation">]</span> <span class="token punctuation">(</span>mean, across all concurrent requests<span class="token punctuation">)</span>
Transfer rate:          <span class="token number">540344.85</span> <span class="token punctuation">[</span>Kbytes/sec<span class="token punctuation">]</span> received

Connection Times <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
              min  mean<span class="token punctuation">[</span>+/-sd<span class="token punctuation">]</span> median   max
Connect:        <span class="token number">0</span>   <span class="token number">55</span> <span class="token number">115.1</span>     <span class="token number">43</span>    <span class="token number">1107</span>
Processing:    <span class="token number">57</span>  <span class="token number">133</span>  <span class="token number">23.3</span>    <span class="token number">136</span>     <span class="token number">190</span>
Waiting:        <span class="token number">0</span>   <span class="token number">39</span>  <span class="token number">14.6</span>     <span class="token number">36</span>     <span class="token number">101</span>
Total:        <span class="token number">110</span>  <span class="token number">188</span> <span class="token number">121.2</span>    <span class="token number">182</span>    <span class="token number">1290</span>

Percentage of the requests served within a certain <span class="token function">time</span> <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
  <span class="token number">50</span>%    <span class="token number">182</span>
  <span class="token number">66</span>%    <span class="token number">188</span>
  <span class="token number">75</span>%    <span class="token number">194</span>
  <span class="token number">80</span>%    <span class="token number">198</span>
  <span class="token number">90</span>%    <span class="token number">205</span>
  <span class="token number">95</span>%    <span class="token number">212</span>
  <span class="token number">98</span>%    <span class="token number">223</span>
  <span class="token number">99</span>%   <span class="token number">1238</span>
 <span class="token number">100</span>%   <span class="token number">1290</span> <span class="token punctuation">(</span>longest request<span class="token punctuation">)</span>
</code></pre>

<h2 id="æœªè°ƒæ•´çš„æµ‹è¯•"><a href="#æœªè°ƒæ•´çš„æµ‹è¯•" class="headerlink" title="æœªè°ƒæ•´çš„æµ‹è¯•"></a>æœªè°ƒæ•´çš„æµ‹è¯•</h2><p>å‘½ä»¤ï¼š <code>ab -c 3000 -n 50000 http://172.31.35.221:80/index.html</code></p>
<h3 id="ç¬¬ä¸€æ¬¡-3"><a href="#ç¬¬ä¸€æ¬¡-3" class="headerlink" title="ç¬¬ä¸€æ¬¡"></a>ç¬¬ä¸€æ¬¡</h3><pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        0 bytes

Concurrency Level:      3000
Time taken for tests:   3.217 seconds
Complete requests:      50000
Failed requests:        50000
   (Connect: 0, Receive: 0, Length: 48496, Exceptions: 1504)
Total transferred:      1723935808 bytes
HTML transferred:       1712490752 bytes
Requests per second:    15543.00 [#&#x2F;sec] (mean)
Time per request:       193.013 [ms] (mean)
Time per request:       0.064 [ms] (mean, across all concurrent requests)
Transfer rate:          523342.50 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   50 115.9     37    1091
Processing:    28  139  29.4    148     338
Waiting:        0   45  13.6     48     249
Total:         60  189 122.8    185    1287

Percentage of the requests served within a certain time (ms)
  50%    185
  66%    195
  75%    197
  80%    198
  90%    211
  95%    216
  98%    225
  99%   1233
 100%   1287 (longest request)</code></pre>
<p>æœªè°ƒæ•´çš„æƒ…å†µä¸‹ç›´æ¥å°±å¤±è´¥äº†ã€‚ã€‚ æ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½Failedäº†ï¼Œ å°è¯•è°ƒå°ã€‚<br>å‘½ä»¤ï¼š <code>ab -c 1897 -n 50000 http://172.31.35.221/index.html</code><br>å¯ä»¥æ¥å—çš„æœ€å¤§å€¼æ˜¯ï¼š</p>
<pre class="language-none"><code class="language-none">Document Path:          &#x2F;index.html
Document Length:        35312 bytes

Concurrency Level:      1897
Time taken for tests:   3.206 seconds
Complete requests:      50000
Failed requests:        0
Total transferred:      1777400000 bytes
HTML transferred:       1765600000 bytes
Requests per second:    15597.31 [#&#x2F;sec] (mean)
Time per request:       121.624 [ms] (mean)
Time per request:       0.064 [ms] (mean, across all concurrent requests)
Transfer rate:          541458.01 [Kbytes&#x2F;sec] received

Connection Times (ms)
              min  mean[+&#x2F;-sd] median   max
Connect:        0   30  86.9     23    1062
Processing:    30   90  14.9     93     274
Waiting:        0   30   8.6     30     225
Total:         53  120  89.5    117    1180

Percentage of the requests served within a certain time (ms)
  50%    117
  66%    121
  75%    124
  80%    125
  90%    132
  95%    140
  98%    145
  99%    147
 100%   1180 (longest request)</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx, Application</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxåå‘ä»£ç†ç¬”è®°</title>
    <url>/2019/07/13/Linux/Linux_Nginx-Proxy/</url>
    <content><![CDATA[<p>Nginxçš„åå‘ä»£ç†ç¬”è®°ã€‚</p>
<h2 id="Nginxç¨‹åºçš„ä¸»è¦åŠŸèƒ½"><a href="#Nginxç¨‹åºçš„ä¸»è¦åŠŸèƒ½" class="headerlink" title="Nginxç¨‹åºçš„ä¸»è¦åŠŸèƒ½"></a>Nginxç¨‹åºçš„ä¸»è¦åŠŸèƒ½</h2><ol>
<li>load configuration</li>
<li>launch workers</li>
<li>non-stop upgrade</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨epollå•è¿›ç¨‹å“åº”å¤šä¸ªç”¨æˆ·è¯·æ±‚ï¼Œå¦‚æœæ˜¯BSDå¯ä»¥ä½¿ç”¨keventæ—¶é—´é©±åŠ¨æ¨¡å¼å“åº”ã€‚<br>ç£ç›˜ä¸€ä¾§ä½¿ç”¨çš„æ˜¯é«˜çº§IOä¸­çš„sendfileæœºåˆ¶ï¼ŒAIOå¼‚æ­¥IOï¼Œä»¥åŠå†…å­˜æ˜ å°„æœºåˆ¶æ¥å®Œæˆç¡¬ç›˜IOçš„é«˜çº§ç‰¹æ€§ã€‚</p>
<ul>
<li>Nginxå®˜æ–¹æ–‡æ¡£åŠå‚æ•°è¯´æ˜åœ¨è¿™é‡Œï¼š <a href="http://nginx.org/en/docs/">nginx documentation</a></li>
</ul>
<h3 id="SNAT-amp-amp-DNAT"><a href="#SNAT-amp-amp-DNAT" class="headerlink" title="SNAT &amp;&amp; DNAT"></a>SNAT &amp;&amp; DNAT</h3><p>ä¸»è¦æ˜¯å·¥ä½œåœ¨ä¸‰å±‚&#x2F;å››å±‚çš„åè®®<br>SNATä¸»è¦çš„åŠŸèƒ½æ˜¯<strong>éšè—å®¢æˆ·ç«¯</strong>ï¼ŒDNATå¯¹æœåŠ¡å™¨<strong>æ¥å—å¹¶è½¬å‘è¯·æ±‚</strong>ã€‚<br>NATåŠŸèƒ½æ— æ³•è§¦åŠ7å±‚åè®®çš„ä¸Šé¢ä¸‰å±‚ï¼Œæ‰€ä»¥æ— æƒæ§åˆ¶ä¸Šé¢çš„æ•°æ®åŒ…å†…å®¹ï¼Œæ‰€ä»¥NATä¸èƒ½å¯¹åº”ç”¨å±‚çš„å†…å®¹ä½œå‡ºæ›´æ”¹åŠç¼“å­˜ã€‚åªèƒ½å¯¹ç½‘ç»œçš„å†…å®¹åŠæ•°æ®åŒ…è¿›è¡Œç›´æ¥çš„è½¬å‘ä»¥åŠæ§åˆ¶ã€‚</p>
<h3 id="æ­£å‘ä»£ç†-amp-amp-åå‘ä»£ç†"><a href="#æ­£å‘ä»£ç†-amp-amp-åå‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç† &amp;&amp; åå‘ä»£ç†"></a>æ­£å‘ä»£ç† &amp;&amp; åå‘ä»£ç†</h3><p>æ­£å‘ä»£ç†æ˜¯é€šè¿‡ä»£ç†æœåŠ¡å™¨<strong>å¯¹å®¢æˆ·ç«¯å‘å‡º</strong>çš„è¯·æ±‚è¿›è¡Œ<strong>å…¨éƒ¨ä¿®æ”¹åŠè½¬å‘</strong>ï¼›<br>åå‘ä»£ç†æ˜¯é€šè¿‡ä»£ç†æœåŠ¡å™¨<strong>å¯¹å‘é€åˆ°æœåŠ¡å™¨</strong>çš„è¯·æ±‚è¿›è¡Œ<strong>å…¨éƒ¨ä¿®æ”¹åŠè½¬å‘</strong>ï¼›<br>ç”±äºä»£ç†çš„æœåŠ¡å™¨å¯ä»¥æ§åˆ¶åˆ¤å®šURLçš„èµ„æºå†…å®¹ï¼Œå› æ­¤å¯ä»¥å¯¹ç«™ç‚¹è¿›è¡ŒåŠ¨é™åˆ†ç¦»å¤„ç†ã€‚<br>å¦‚æœè¿™ä¸ªåŠŸèƒ½å¯ä»¥å·¥ä½œåœ¨åº”ç”¨å±‚å«åšä»£ç†ï¼Œå¦‚æœå·¥ä½œç±»ä¼¼SNATä¸Šçš„å«åšæ­£å‘ä»£ç†ï¼Œå·¥ä½œç±»ä¼¼DNATå°±å«åšåå‘ä»£ç†ã€‚</p>
<h2 id="Nginxåå‘ä»£ç†æœåŠ¡å™¨"><a href="#Nginxåå‘ä»£ç†æœåŠ¡å™¨" class="headerlink" title="Nginxåå‘ä»£ç†æœåŠ¡å™¨"></a>Nginxåå‘ä»£ç†æœåŠ¡å™¨</h2><ul>
<li>é¢å‘å®¢æˆ·ç«¯ï¼šè¯¥æ–¹å‘æ”¯æŒä¸¤ç§åè®®ï¼š http&#x2F;https</li>
<li>é¢å‘æœåŠ¡ç«¯ï¼šè¯¥æ–¹å‘æ”¯æŒHTTP&#x2F;FastCGI&#x2F;memcacheåè®®<br>Nginxéœ€è¦æ”¯æŒç›¸å…³çš„åè®®éœ€è¦æœ‰ç›¸å…³åè®®çš„å¯¹åº”æ¨¡å—<br>åŸç†ä»¥åŠæµç¨‹ï¼š<br>  ä»è¿œç¨‹æœåŠ¡å™¨å–å¾—æ•°æ®è¿›è¡ŒnginxæœåŠ¡å™¨æœ¬åœ°çš„ç¼“å­˜ï¼Œç„¶åå“åº”ç»™å®¢æˆ·ç«¯.<br>å¯ä¿®æ”¹æˆ–å…·æœ‰ä¿®æ”¹æ„ä¹‰çš„æŠ¥æ–‡æœ‰ä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯å‘åˆ°åé¢å¤„ç†æœåŠ¡å™¨çš„æŠ¥æ–‡ï¼›ç¬¬äºŒç§æ˜¯å‘ç»™å®¢æˆ·ç«¯çš„å“åº”æŠ¥æ–‡ã€‚</li>
</ul>
<h2 id="Nginxçš„ä»£ç†æ¨¡å—"><a href="#Nginxçš„ä»£ç†æ¨¡å—" class="headerlink" title="Nginxçš„ä»£ç†æ¨¡å—"></a>Nginxçš„ä»£ç†æ¨¡å—</h2><ol>
<li><p>ngx_http_proxy_module â€“ Nginxçš„åå‘ä»£ç†æ¨¡å—å®˜æ–¹è¯´æ˜ï¼š<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html">Module ngx_http_proxy_module</a><br> æ·»åŠ æ–°çš„åå‘ä»£ç†æœåŠ¡é…ç½®æ–‡ä»¶ï¼š<br> vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;proxy.conf</p>
 <pre class="language-none"><code class="language-none">server &#123;
    listen 80ï¼›
    server_name [SERVER_FQDN]
    location &#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;[IP_ADDR:PORT]
        # å­—æ®µååŠ ä¸Š&#x2F;è¡¨ç¤ºå°†locationåçš„ç›®å½•æ˜ å°„ä¸ºåç«¯æœåŠ¡å™¨çš„ç›®å½•ï¼›
        # ä¾‹å¦‚ï¼šå¦‚æœæ˜¯location &#x2F;testï¼Œé‚£ä¹ˆåœ¨åå‘ä»£ç†ä¸åŠ &#x2F;çš„æ—¶å€™ï¼Œè®¿é—®çš„æ˜¯åç«¯çœŸå®çš„&#x2F;testç›®å½•ï¼›
        # å¦‚æœåŠ ä¸Š&#x2F;ï¼Œè®¿é—®åˆ°çš„æ˜¯åç«¯æœåŠ¡å™¨çš„æ ¹ç›®å½•ï¼›
        # å½“ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œäº†åŒ¹é…çš„æ—¶å€™åé¢ä¸èƒ½æ·»åŠ &#x2F;ç¬¦å·ï¼›
    &#125;

    location ~* \.&#123;jpg|jpeg|png&#125;$ &#123;
        proxy_pass http:&#x2F;&#x2F;[IP_ADDR:PORT];
        # æ­£åˆ™è¡¨è¾¾æ¨¡å¼ä¸‹éƒ¨åˆ†åœ¨ä»£ç†æœåŠ¡å™¨çš„åœ°å€åé¢åŠ ä¸Š&#x2F;ï¼›
    &#125;
&#125;</code></pre></li>
<li><p>proxy_pass [RealServerAddress]ï¼›# è®¾ç½®åå‘ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼›<br> proxy_set_header [field] [value]; # è®¾å®šä¼ é€’åˆ°åç«¯æœåŠ¡å™¨çš„è¯·æ±‚æŠ¥æ–‡é¦–éƒ¨çš„å€¼ï¼›<br> proxy_set_header â€“ Nginxçš„è®¾å®šä»£ç†å¤´æ–‡ä»¶å‚æ•°æ¨¡å—çš„å®˜æ–¹è¯´æ˜ï¼š<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header">proxy_set_header</a>    </p>
 <pre class="language-none"><code class="language-none">proxy_set_header X-Real-IP $remote_addr;
åœ¨è®¾å®šå­—æ®µåï¼Œæ›´æ”¹åç«¯çœŸå®æœåŠ¡å™¨çš„æ—¥å¿—è®°å½•çš„å€¼ï¼Œå³å¯è®°å½•æ‰€æœ‰çš„çœŸæ­£çš„å®¢æˆ·ç«¯IPï¼›  
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  </code></pre>
</li>
<li><p>proxy_http_headers_module # è®¾å®šå‘ç»™å®¢æˆ·ç«¯çš„å“åº”æŠ¥æ–‡çš„åœ°å€çš„å€¼ï¼›<br> Module ngx_http_headers_module â€“ Nginxçš„å®¢æˆ·ç«¯å“åº”æŠ¥æ–‡æ¨¡å—å®˜æ–¹è¯´æ˜ï¼š  <a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html">Module ngx_http_headers_module</a>  </p>
 <pre class="language-none"><code class="language-none">add_header X_Via $server_addr;&#96; # æ˜¾ç¤ºåç«¯æœåŠ¡å™¨çš„çœŸå®åœ°å€ï¼›</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx, Application</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxé…ç½®æ–‡ä»¶ä¸­ifåˆ¤æ–­ä¸try_files</title>
    <url>/2019/09/19/Linux/Linux_Nginx-if-try-files-Notwork/</url>
    <content><![CDATA[<p>Nginxçš„ifåˆ¤æ–­é—®é¢˜ï¼Œå¯¼è‡´try_fileså­—æ®µæœªèƒ½æ­£å¸¸ç”Ÿæ•ˆã€‚</p>
<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><pre class="language-none"><code class="language-none">server &#123;
  listen 80;
  server_name liarlee.site;

  set $mobile_rewrite do_not_perform;
  if ($http_user_agent ~* &quot;(android|bb\d+|meego).+mobile|avantgo|bada\&#x2F;|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\&#x2F;|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino&quot;) &#123;
    set $mobile_rewrite perform;
  &#125;
  if ($http_user_agent ~* &quot;^(1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\&#x2F;|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\&#x2F;)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\&#x2F;)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\&#x2F;(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\&#x2F;|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\&#x2F;|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\&#x2F;|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-)&quot;) &#123;
    set $mobile_rewrite perform;
  &#125;
  if ($http_cookie ~ &#39;gotopc&#x3D;true&#39;) &#123;
    set $mobile_rewrite do_not_perform;
  &#125;

  location &#x2F; &#123;
    root &#x2F;var&#x2F;html&#x2F;www&#x2F;[PC_WEB_ROOT];
     # é—®é¢˜å‡ºç°åœ¨äº†è¿™é‡Œã€‚
    if ($mobile_rewrite &#x3D; perform) &#123;
      root &#x2F;var&#x2F;html&#x2F;www&#x2F;[MOBILE_WEB_ROOT];
    &#125;
    index index.html index.htm
    error_page 404 index.html
    # é—®é¢˜å°±å‡ºç°åœ¨äº†è¿™é‡Œã€‚
    try_files $uri $uri&#x2F; &#x2F;index.html 404; 
  &#125;
&#125;</code></pre>
<h2 id="è¡¨ç°"><a href="#è¡¨ç°" class="headerlink" title="è¡¨ç°"></a>è¡¨ç°</h2><p>åœ¨è®¿é—®è¯·æ±‚æ¥çš„åŒæ—¶ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯æ‰‹æœºè®¿é—®ï¼Œå¦‚æœæ˜¯PCä½¿ç”¨é»˜è®¤çš„PC_WEB_ROOT,  å¦‚æœæ˜¯æ‰‹æœºçš„è¯ï¼Œè®¿é—®åˆ°MOBILE_WEB_ROOTã€‚æœ¬èº«é€»è¾‘å’Œä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨try_fileså­—æ®µçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´PCç«™ç‚¹çš„tryfileså¯ä»¥æ­£å¸¸ç”Ÿæ•ˆï¼›ä½†æ˜¯æ‰‹æœºä¸ä¼šæœ‰tryfileçš„æ•ˆæœã€‚</p>
<h2 id="å¯è¡Œçš„æ–¹å¼-Proxypass"><a href="#å¯è¡Œçš„æ–¹å¼-Proxypass" class="headerlink" title="å¯è¡Œçš„æ–¹å¼ - Proxypass"></a>å¯è¡Œçš„æ–¹å¼ - Proxypass</h2><p>çœ‹åˆ°äº†ä¸€ç¯‡æ–‡ç« è¯´åˆ°nginxçš„IFè¯­å¥ï¼Œå¯ä»¥æ­£å¸¸ä¸å‡ºå¥‡æ€ªé—®é¢˜çš„åªæœ‰<code>Proxy_pass</code>,<code>Rewrite</code>ä¸¤ä¸ªï¼Œå› ä¸ºé¡¹ç›®æ— æ³•ç”¨rewriteæ‰€ä»¥é€‰æ‹©äº†Proxypassã€‚<br>é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªç½‘ç«™æ”¾åœ¨ä¸€ä¸ªServerä¸‹ã€‚</p>
<h3 id="PCé…ç½®æ–‡ä»¶"><a href="#PCé…ç½®æ–‡ä»¶" class="headerlink" title="PCé…ç½®æ–‡ä»¶"></a>PCé…ç½®æ–‡ä»¶</h3><pre class="language-none"><code class="language-none">server &#123;
  listen 80;
  server_name liarlee.site;

  set $mobile_rewrite do_not_perform;
  if ($http_user_agent ~* &quot;(android|bb\d+|meego).+mobile|avantgo|bada\&#x2F;|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\&#x2F;|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino&quot;) &#123;
    set $mobile_rewrite perform;
  &#125;
  if ($http_user_agent ~* &quot;^(1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\&#x2F;|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\&#x2F;)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\&#x2F;)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\&#x2F;(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\&#x2F;|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\&#x2F;|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\&#x2F;|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-)&quot;) &#123;
    set $mobile_rewrite perform;
  &#125;
  if ($http_cookie ~ &#39;gotopc&#x3D;true&#39;) &#123;
    set $mobile_rewrite do_not_perform;
  &#125;

  location &#x2F; &#123;
    root &#x2F;var&#x2F;html&#x2F;www&#x2F;[PC_WEB_ROOT];
    
    if ($mobile_rewrite &#x3D; perform) &#123;
      proxy_pass http:&#x2F;&#x2F;127.0.0.1:81; # æ›´æ”¹è¿™é‡Œä¸ºproxypassï¼›
    &#125;

    index index.html index.htm
    error_page 404 index.html
    
    try_files $uri $uri&#x2F; &#x2F;index.html 404; 
  &#125;
&#125;	
&#125;
</code></pre>
<h3 id="MOBILEé…ç½®æ–‡ä»¶"><a href="#MOBILEé…ç½®æ–‡ä»¶" class="headerlink" title="MOBILEé…ç½®æ–‡ä»¶"></a>MOBILEé…ç½®æ–‡ä»¶</h3><pre class="language-none"><code class="language-none">server &#123;
  listen 81;
    server_name 127.0.0.1;
    location &#x2F; &#123;
    root &#x2F;var&#x2F;www&#x2F;html&#x2F;[MOBILE_WEB_ROOT];
    index index.html index.htm;
    error_page 404 index.html;
    try_files $uri $uri&#x2F; &#x2F;index.html 404; 
  &#125;
&#125;</code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx, Application</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx Performance Test</title>
    <url>/2022/04/19/Linux/Linux_Nginx%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%8E%8B%E6%B5%8B/</url>
    <content><![CDATA[<p>å†™åœ¨æœ€å‰é¢ï¼Œ è¿™ä¸ªé—®é¢˜è¿˜åœ¨ç ”ç©¶ä¸­ï¼Œ æˆ‘ç›®å‰è¿˜æ²¡æœ‰åˆé€‚çš„æ¨¡å‹ç”¨æ¥ç ”ç©¶è¿™ä¸ªé—®é¢˜ï¼Œ Pendingâ€¦.</p>
<h2 id="Nginx-æ€§èƒ½æµ‹è¯•ä¸å‹åŠ›è®¡ç®—"><a href="#Nginx-æ€§èƒ½æµ‹è¯•ä¸å‹åŠ›è®¡ç®—" class="headerlink" title="Nginx æ€§èƒ½æµ‹è¯•ä¸å‹åŠ›è®¡ç®—"></a>Nginx æ€§èƒ½æµ‹è¯•ä¸å‹åŠ›è®¡ç®—</h2><p>ä½¿ç”¨al2023  + é»˜è®¤çš„yumä»“åº“è½¯ä»¶ç‰ˆæœ¬ï¼Œ å…·ä½“ä¿¡æ¯è®°å½•å¦‚ä¸‹ï¼š </p>
<p>æŒ‰ç…§ä¸‹é¢çš„é…ç½®ï¼Œ åœ¨Nginxä¸Šé¢å‘å¸ƒä¸€ä¸ªç›®å½•ï¼Œ å…¶ä¸­æ”¾äº†ä¸€ä¸ªFedoraé•œåƒï¼Œ å¤§å°å¤§çº¦2.3GBï¼Œ å›ºå®šNginxå¤„ç†è¯·æ±‚çš„å¤§å°ï¼Œ æ§åˆ¶å¤§éƒ¨åˆ†çš„å› ç´ æ¥å°è¯•è·å–ç²¾ç¡®çš„ç»“æœã€‚</p>
<ol>
<li><p>OS Version</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-53-146 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Amazon Linux"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"2023"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"amzn"</span>
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"fedora"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"2023"</span>
<span class="token assign-left variable">PLATFORM_ID</span><span class="token operator">=</span><span class="token string">"platform:al2023"</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Amazon Linux 2023"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;33"</span>
<span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:2.3:o:amazon:amazon_linux:2023"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://aws.amazon.com/linux/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/amazonlinux/amazon-linux-2023"</span>
<span class="token assign-left variable">SUPPORT_END</span><span class="token operator">=</span><span class="token string">"2028-03-01"</span></code></pre>
</li>
<li><p>åœ¨ä¸€ä¸ªæœºå™¨ä¸Šé¢éƒ¨ç½²MySQL ç„¶ååˆå§‹åŒ–é…ç½®ä¸€ä¸ªå¯†ç å’Œç”¨æˆ·ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-53-200 ~<span class="token punctuation">]</span><span class="token comment"># mysql --version</span>
mysql  Ver <span class="token number">8.0</span>.32 <span class="token keyword">for</span> Linux on x86_64 <span class="token punctuation">(</span>MySQL Community Server - GPL<span class="token punctuation">)</span></code></pre>
</li>
<li><p>ç›´æ¥ä½¿ç”¨bitnamiçš„wordpressï¼Œ ä»…éƒ¨ç½²wordpressåœ¨å¦ä¸€ä¸ªæœºå™¨ä¸Šé¢ï¼Œç„¶åé…ç½®è¿æ¥åˆ°ä¸Šé¢çš„é‚£å°æ•°æ®åº“ã€‚ </p>
</li>
<li><p>é¢å¤–é…ç½®ä¸€ä¸‹Docker-compose çš„CPU affinityï¼Œ ç»‘åˆ°cpu0ä¸Šé¢ï¼Œ è®©è¿™ä¸ªContaineråªèƒ½ç”¨cpu0, æ¨¡æ‹Ÿåªæœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œ åé¢åº”è¯¥è¿˜ä¼šç»™ä»–æ”¾å¼€ã€‚</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">   <span class="token punctuation">---</span>
   <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>
   <span class="token key atrule">services</span><span class="token punctuation">:</span>
     <span class="token key atrule">wordpress</span><span class="token punctuation">:</span>
       <span class="token key atrule">cpuset</span><span class="token punctuation">:</span> <span class="token string">"0"</span>
       <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host

5. å°è¯•ç»™ç‚¹å‹åŠ›ï¼Œ åšä¸ªåŸºå‡†æµ‹è¯•ã€‚

<span class="token comment">### æµ‹è¯•1 å•çº¿ç¨‹è®¡ç®—QPS</span>

<span class="token punctuation">></span> å…¬å¼ï¼š  1000ms/RT = QPS 
<span class="token punctuation">></span>
<span class="token punctuation">></span> è¿™ä¸ªæ˜¯å•çº¿ç¨‹çš„QPS ä¸ RT çš„å…³ç³»ï¼Œ è¯•å›¾èµ°ä¸€æŠŠæµç¨‹éªŒè¯è¿™ä¸ªã€‚ 

è¿è¡Œå‘½ä»¤ wrk é…ç½® 1connection 1thread è¿›è¡Œæµ‹è¯•ï¼Œ æµ‹è¯•æ—¶é—´5åˆ†é’Ÿã€‚

è·å– RTï¼ŒHTTPè¯·æ±‚ä»å‘å‡ºåˆ°å“åº”çš„æ—¶é—´ ï¼š 

<span class="token tag">!</span><span class="token punctuation">[</span>2023<span class="token punctuation">-</span>04<span class="token punctuation">-</span>27_10<span class="token punctuation">-</span>38.png<span class="token punctuation">]</span>(https<span class="token punctuation">:</span>//s2.loli.net/2023/04/27/pf2Z5erTzcayPFJ.png)

åŸºäºå½“å‰è·å–åˆ°çš„RTå°±å¯ä»¥è®¡ç®—å‡ºå•çº¿ç¨‹çš„QPS ï¼š 

```bash
RTï¼š45ms <span class="token comment"># è¿™ä¸ªæ—¶å€™è·å–çš„RTæ˜¯å®¢æˆ·ç«¯ä»å‘å‡ºæ•°æ®åŒ… åˆ° æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚çš„é¡µé¢è¿”å›çš„æ—¶é—´ï¼Œ åŸºäºä¸Šé¢çš„æŠ“åŒ…ç»“æœè®¡ç®—ã€‚</span>
1000ms/45ms = 22 QPS</code></pre></li>
</ol>
<p>å®é™…å‘½ä»¤è¿”å›çš„ç»“æœï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~ â¯â¯â¯ wrk <span class="token parameter variable">-t1</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-d5m</span> <span class="token parameter variable">--latency</span> http://nginx.liarlee.site:8080
Running 5m <span class="token builtin class-name">test</span> @ http://nginx.liarlee.site:8080
  <span class="token number">1</span> threads and <span class="token number">1</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    <span class="token number">45</span>.00ms    <span class="token number">3</span>.60ms <span class="token number">169</span>.02ms   <span class="token number">88.75</span>%
    Req/Sec    <span class="token number">22.24</span>      <span class="token number">4.27</span>    <span class="token number">30.00</span>     <span class="token number">76.72</span>%
  Latency Distribution
     <span class="token number">50</span>%   <span class="token number">44</span>.28ms
     <span class="token number">75</span>%   <span class="token number">46</span>.23ms
     <span class="token number">90</span>%   <span class="token number">48</span>.51ms
     <span class="token number">99</span>%   <span class="token number">54</span>.40ms
  <span class="token number">6668</span> requests <span class="token keyword">in</span> <span class="token number">5</span>.00m, <span class="token number">337</span>.69MB <span class="token builtin class-name">read</span>
Requests/sec:     <span class="token number">22.23</span> <span class="token comment"># ç¡®å®æ˜¯ 22å·¦å³ï¼Œ åŸºæœ¬ä¸Šå’Œè®¡ç®—å¾—å‡ºçš„ç»“æœä¸€è‡´ã€‚</span>
Transfer/sec:      <span class="token number">1</span>.13MB</code></pre>

<h3 id="æµ‹è¯•2-è®¡ç®—æœåŠ¡å½“å‰çš„æœ€ä½³çº¿ç¨‹æ•°é‡"><a href="#æµ‹è¯•2-è®¡ç®—æœåŠ¡å½“å‰çš„æœ€ä½³çº¿ç¨‹æ•°é‡" class="headerlink" title="æµ‹è¯•2 è®¡ç®—æœåŠ¡å½“å‰çš„æœ€ä½³çº¿ç¨‹æ•°é‡"></a>æµ‹è¯•2 è®¡ç®—æœåŠ¡å½“å‰çš„æœ€ä½³çº¿ç¨‹æ•°é‡</h3><p>é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ å½“ä¸€ä¸ªè¿›ç¨‹å¤„ç†çš„æ—¶å€™ï¼Œ çº¿ç¨‹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œ OnCPUå¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œ å‘å‡ºæ•°æ®åº“æŸ¥è¯¢ï¼Œåˆ‡æ¢åˆ°SleepçŠ¶æ€ï¼Œæ•°æ®åº“å¤„ç†å®Œæˆï¼Œçº¿ç¨‹å›åˆ°CPUç»§ç»­è¿ç®—ï¼Œå‘é€ç»“æœç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å®Œæˆä¸€ä¸ªRequestã€‚</p>
<p>è®¡ç®—æœåŠ¡çš„æœ€ä½³çº¿ç¨‹æ•°é‡å…¶å®æ˜¯ éœ€è¦å¤šå°‘ä¸ªçº¿ç¨‹å ç”¨CPUï¼Œæœ€ç»ˆå¯ä»¥å¡«æ»¡ CPU 1s çš„æ—¶é—´ï¼Œ è®©CPUå°½å¯èƒ½éƒ½ç”¨æ¥å¤„ç†ä¸šåŠ¡è¯·æ±‚ã€‚</p>
<p>æ‰€ä»¥æœ€å¤§çš„çº¿ç¨‹æ•°é‡æ˜¯å˜åŒ–çš„ï¼Œ ä¸CPU time ç›¸å…³ æˆ–è€…è¯´ ä¸RTç›¸å…³ï¼Œ å¯¹äºä¸€äº›ç‰¹å®šçš„è¯·æ±‚ï¼Œæ§åˆ¶äº†å¤§éƒ¨åˆ†å˜é‡çš„åœºæ™¯ä¸‹ï¼Œ å¯ä»¥è®¡ç®—ä¸€ä¸ªæœ€ä½³çš„çº¿ç¨‹æ•°é‡ã€‚ è®¡ç®—å…¬å¼ï¼š </p>
<blockquote>
<p>æœ€ä½³çº¿ç¨‹æ•°ï¼š CPU TIme + Wait Time &#x2F; CPU Time &#x3D; 2 + 42 &#x2F; 2 &#x3D; 22  </p>
</blockquote>
<h2 id="æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶å¯èƒ½çš„å¹¶å‘æ•°é‡"><a href="#æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶å¯èƒ½çš„å¹¶å‘æ•°é‡" class="headerlink" title="æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶å¯èƒ½çš„å¹¶å‘æ•°é‡"></a>æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶å¯èƒ½çš„å¹¶å‘æ•°é‡</h2><p>æµ‹è¯• conntrack çš„é—®é¢˜ï¼Œ å‘ç°è¿æ¥æ•°ä¸å¤ªé«˜ï¼Œ è¯•å›¾é€šè¿‡wrk æé«˜å¹¶å‘çš„è¿æ¥æ•°é‡ã€‚<br>ä½¿ç”¨å‘½ä»¤ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wrk <span class="token parameter variable">-t2</span> <span class="token parameter variable">-c30000</span> <span class="token parameter variable">-d30s</span> http://reg.liarlee.site:80</code></pre>
<p>å¦‚æœæˆ‘çš„ç†è§£æ²¡æœ‰é—®é¢˜ï¼Œ é‚£ä¹ˆæˆ‘åº”è¯¥å¯ä»¥åˆ›å»º30000ä¸ªè¿æ¥ åœ¨ å®¢æˆ·ç«¯ å’Œ æœåŠ¡ç«¯ ä¹‹é—´ã€‚<br>ä½†æ˜¯ç»“æœï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®¢æˆ·ç«¯å°è¯•å»ºç«‹ 8000c</span>
ec2-user@arch ~<span class="token operator">></span> wrk <span class="token parameter variable">-t1</span> <span class="token parameter variable">-c8000</span> <span class="token parameter variable">-d30s</span> http://reg.liarlee.site:80
Running 30s <span class="token builtin class-name">test</span> @ http://reg.liarlee.site:80
  <span class="token number">1</span> threads and <span class="token number">8000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    <span class="token number">49</span>.94ms   <span class="token number">42</span>.36ms <span class="token number">428</span>.68ms   <span class="token number">92.65</span>%
    Req/Sec    <span class="token number">21</span>.15k     <span class="token number">8</span>.19k   <span class="token number">41</span>.30k    <span class="token number">66.08</span>%
  <span class="token number">608596</span> requests <span class="token keyword">in</span> <span class="token number">30</span>.04s, <span class="token number">218</span>.23MB <span class="token builtin class-name">read</span>
  Socket errors: connect <span class="token number">6980</span>, <span class="token builtin class-name">read</span> <span class="token number">0</span>, <span class="token function">write</span> <span class="token number">0</span>, <span class="token function">timeout</span> <span class="token number">0</span>
Requests/sec:  <span class="token number">20260.60</span>
Transfer/sec:      <span class="token number">7</span>.27MB

<span class="token comment"># æœåŠ¡ç«¯çœ‹åˆ°çš„æ˜¯ï¼š </span>
<span class="token punctuation">[</span>root@reg tools<span class="token punctuation">]</span><span class="token comment"># ss -s</span>
Total: <span class="token number">282</span>
TCP:   <span class="token number">1103</span> <span class="token punctuation">(</span>estab <span class="token number">28</span>, closed <span class="token number">1063</span>, orphaned <span class="token number">0</span>, timewait <span class="token number">2</span><span class="token punctuation">)</span>

Transport Total     IP        IPv6
RAW	  <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span>
UDP	  <span class="token number">8</span>         <span class="token number">4</span>         <span class="token number">4</span>
TCP	  <span class="token number">40</span>        <span class="token number">36</span>        <span class="token number">4</span>
INET	  <span class="token number">48</span>        <span class="token number">40</span>        <span class="token number">8</span>
FRAG	  <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span></code></pre>
<p>è¿™å’Œé¢„æœŸçš„å·®è·æŒºå¤§çš„ï¼Œ 1103 è®©æˆ‘éå¸¸å®¹æ˜“çš„æƒ³åˆ°äº† 1024 çš„æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ã€‚ äºæ˜¯ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ec2-user@arch ~<span class="token operator">></span> <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span>
<span class="token number">1024</span></code></pre>
<p>å®¢æˆ·ç«¯  wrk çš„æ–‡ä»¶æè¿°ç¬¦å¯ç”¨è°ƒå¤§åˆ° 100000 ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®¢æˆ·ç«¯</span>
ec2-user@arch ~ <span class="token punctuation">[</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span>
<span class="token number">100000</span>
ec2-user@arch ~<span class="token operator">></span> wrk <span class="token parameter variable">-t2</span> <span class="token parameter variable">-c30000</span> <span class="token parameter variable">-d30s</span> http://reg.liarlee.site:80
Running 30s <span class="token builtin class-name">test</span> @ http://reg.liarlee.site:80
  <span class="token number">2</span> threads and <span class="token number">30000</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   <span class="token number">515</span>.29ms  <span class="token number">411</span>.20ms   <span class="token number">2</span>.00s    <span class="token number">78.35</span>%
    Req/Sec     <span class="token number">1</span>.76k     <span class="token number">2</span>.70k   <span class="token number">11</span>.96k    <span class="token number">85.71</span>%
  <span class="token number">39021</span> requests <span class="token keyword">in</span> <span class="token number">30</span>.28s, <span class="token number">13</span>.99MB <span class="token builtin class-name">read</span>
  Socket errors: connect <span class="token number">0</span>, <span class="token builtin class-name">read</span> <span class="token number">298852</span>, <span class="token function">write</span> <span class="token number">16</span>, <span class="token function">timeout</span> <span class="token number">3115</span>
Requests/sec:   <span class="token number">1288.65</span>
Transfer/sec:    <span class="token number">473</span>.17KB

<span class="token comment"># æœåŠ¡ç«¯</span>
<span class="token punctuation">[</span>root@reg tools<span class="token punctuation">]</span><span class="token comment"># ss -s</span>
Total: <span class="token number">282</span>
TCP:   <span class="token number">7544</span> <span class="token punctuation">(</span>estab <span class="token number">28</span>, closed <span class="token number">7504</span>, orphaned <span class="token number">1641</span>, timewait <span class="token number">2</span><span class="token punctuation">)</span>

Transport Total     IP        IPv6
RAW	  <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span>
UDP	  <span class="token number">8</span>         <span class="token number">4</span>         <span class="token number">4</span>
TCP	  <span class="token number">40</span>        <span class="token number">36</span>        <span class="token number">4</span>
INET	  <span class="token number">48</span>        <span class="token number">40</span>        <span class="token number">8</span>
FRAG	  <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span></code></pre>
<p>å¦‚æœä»ä¸Šé¢çš„è§’åº¦æ¥çœ‹ï¼Œ é‚£ä¹ˆå®¢æˆ·ç«¯çš„æ‰“å¼€æ–‡ä»¶æ•°æ˜¯é™åˆ¶ï¼Œ ç°åœ¨æ‰“å¼€æ–‡ä»¶æ•°è°ƒå¤§äº†ï¼Œ æœåŠ¡ç«¯è¿˜æ˜¯æ— æ³•å»ºç«‹æ›´å¤šçš„è¿æ¥ï¼Œ è¿™ä¸ªè¿˜å¾—ç»§ç»­çœ‹çœ‹ ï¼Œ æˆ‘æ„Ÿè§‰æ˜¯cpuçš„é—®é¢˜ï¼Œ æ¯•ç«Ÿæˆ‘è®¿é—®çš„é¡µé¢çš„æ˜¯æœ‰å†…å®¹çš„ï¼Œ ä¸æ˜¯ä¸€ä¸ªç©ºè¯·æ±‚ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°è¯•çœ‹äº†ä»¥ä¸‹æœåŠ¡ç«¯çš„ss å‘½ä»¤</span>
ec2-user@arch ~<span class="token operator">></span> ss <span class="token parameter variable">-s</span>
Total: <span class="token number">31669</span>
TCP:   <span class="token number">31268</span> <span class="token punctuation">(</span>estab <span class="token number">7959</span>, closed <span class="token number">1182</span>, orphaned <span class="token number">1250</span>, timewait <span class="token number">1</span><span class="token punctuation">)</span>

Transport Total     IP        IPv6
RAW	  <span class="token number">1</span>         <span class="token number">0</span>         <span class="token number">1</span>
UDP	  <span class="token number">4</span>         <span class="token number">2</span>         <span class="token number">2</span>
TCP	  <span class="token number">30086</span>     <span class="token number">30080</span>     <span class="token number">6</span>
INET	  <span class="token number">30091</span>     <span class="token number">30082</span>     <span class="token number">9</span>
FRAG	  <span class="token number">0</span>         <span class="token number">0</span>         <span class="token number">0</span></code></pre>
<p>ç¡®å®å‘èµ·äº†30000 ä½†æ˜¯ è¿›å…¥estabçŠ¶æ€çš„è¿æ¥åªæœ‰ 8000 å·¦å³ã€‚è¿™åŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæ˜¯æœåŠ¡ç«¯çš„é™åˆ¶äº†ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆåœ°æ–¹é™åˆ¶äº†å¾…æŸ¥ã€‚<br>å®¢æˆ·ç«¯ ï¼š c5 å®ä¾‹ç±»å‹ä¸Šé¢çš„ wrk<br>æœåŠ¡ç«¯ ï¼š t3.micro  - docker compose éƒ¨ç½²çš„ harbor</p>
<h2 id="è¿æ¥å¼‚å¸¸å¯¼è‡´çš„orphans"><a href="#è¿æ¥å¼‚å¸¸å¯¼è‡´çš„orphans" class="headerlink" title="è¿æ¥å¼‚å¸¸å¯¼è‡´çš„orphans"></a>è¿æ¥å¼‚å¸¸å¯¼è‡´çš„orphans</h2><p>ä¸€ä¸ªé—æ†¾çš„äº‹æƒ…ï¼Œ æœ€è¿‘é‡åˆ°äº†ä¸€ä¸ªå¯èƒ½æ˜¯ cilium çš„ä¸€ä¸ªé—®é¢˜ï¼Œ åœ¨å°è§„æ¨¡é›†ç¾¤çš„åœºæ™¯ä¸‹ï¼Œ Cilium ä¼šé”™è¯¯çš„å¤„ç†FIN ï¼Œ FIN ACKï¼Œ å¯¼è‡´å®‰å…¨ç»„çš„ Connection Track æ•°é‡è¢«æ‰“æ»¡ã€‚ ä¹‹å‰æ²¡æœ‰æ³¨æ„è¿‡è¿™ä¸ªè¡Œä¸ºï¼Œåœ¨Dockerçš„ç¯å¢ƒä¸­æµ‹è¯•ä¸‹ï¼Œ å°è¯•ä½¿ç”¨ iptables å±è”½å®¹å™¨å‘é€å‡ºæ¥çš„FINï¼Œ è®°å½•æ­¥éª¤å’Œå‘½ä»¤ï¼š </p>
<pre class="language-none"><code class="language-none">dnf install -y docker
systemctl enable --now docker
docker pull reg.liarlee.site&#x2F;docker.io&#x2F;library&#x2F;nginx&#x2F;nginx:latest
docker run -dt --rm --name nginx -p 81:80 reg.liarlee.site&#x2F;docker.io&#x2F;library&#x2F;nginx:latest 
docker ps çœ‹åˆ°å®¹å™¨å·²ç»å¯åŠ¨å°±å¯ä»¥äº†</code></pre>
<p>æŸ¥çœ‹å®¹å™¨çš„IPåœ°å€ï¼š </p>
<pre class="language-none"><code class="language-none">[root@ip-172-31-54-32 ~]# docker inspect nginx | grep -i ipaddress
            &quot;SecondaryIPAddresses&quot;: null,
            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</code></pre>
<p>æ·»åŠ ä¸€ä¸ªè§„åˆ™åœ¨ DOCKER-ISOLATION-STAGE-1 é“¾ä¸Šã€‚</p>
<pre class="language-none"><code class="language-none">[root@ip-172-31-54-32 ~]# iptables -I DOCKER-ISOLATION-STAGE-1 1 -p tcp -s 172.17.0.2 --tcp-flags FIN FIN -j DROP
[root@ip-172-31-54-32 ~]# iptables -I OUTPUT 1 -p tcp -s 172.31.47.174 -tcp-flags FIN FIN -j DROP</code></pre>
<p>æŸ¥çœ‹iptables é“¾è¡¨è§„åˆ™ï¼Œ DOCKER-ISOLATION-STAGE-1ã€‚</p>
<pre class="language-none"><code class="language-none">[root@ip-172-31-54-32 ~]# iptables -nvL --line-numbers
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1      47M   13G DOCKER-USER  all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
2      47M   13G DOCKER-ISOLATION-STAGE-1  all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
3      24M 1713M ACCEPT     all  --  *      docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            ctstate RELATED,ESTABLISHED
4    12371  742K DOCKER     all  --  *      docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
5      24M   11G ACCEPT     all  --  docker0 !docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
6        0     0 ACCEPT     all  --  docker0 docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination

Chain DOCKER (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    11933  716K ACCEPT     tcp  --  !docker0 docker0  0.0.0.0&#x2F;0            172.17.0.2           tcp dpt:80

Chain DOCKER-ISOLATION-STAGE-1 (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1      24M   11G DOCKER-ISOLATION-STAGE-2  all  --  docker0 !docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
2    30690 1596K DROP       tcp  --  *      *       172.17.0.2           0.0.0.0&#x2F;0            tcp flags:0x01&#x2F;0x01 # åœ¨è¿™é‡Œ
3      47M   13G RETURN     all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0

Chain DOCKER-ISOLATION-STAGE-2 (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 DROP       all  --  *      docker0  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0
2      24M   11G RETURN     all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0

Chain DOCKER-USER (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1      47M   13G RETURN     all  --  *      *       0.0.0.0&#x2F;0            0.0.0.0&#x2F;0</code></pre>
<p>ä½¿ç”¨ wrk åœ¨å®¢æˆ·ç«¯å‘èµ·æµ‹è¯•ï¼š </p>
<pre class="language-none"><code class="language-none">ec2-user@arch ~&gt; wrk -t1 -c1000 -d3000s http:&#x2F;&#x2F;172.31.54.32:81
Running 50m test @ http:&#x2F;&#x2F;172.31.54.32:81
  1 threads and 1000 connections</code></pre>
<p>åœ¨ç³»ç»Ÿå†…éƒ¨å¯ä»¥çœ‹åˆ°æœ‰ä¸€éƒ¨åˆ† orphans è¿æ¥ï¼š </p>
<pre class="language-none"><code class="language-none">[root@ip-172-31-54-32 ~]# ss -s
Total: 233
TCP:   2019 (estab 5, closed 2009, orphaned 1006, timewait 1)

Transport Total     IP        IPv6
RAW	  1         0         1
UDP	  4         2         2
TCP	  10        8         2
INET	  15        10        5
FRAG	  0         0         0</code></pre>
<p>è®°å½•ä¸‹GPTå‘Šè¯‰æˆ‘çš„ç­”æ¡ˆï¼š </p>
<blockquote>
<p>TCP orphans æ˜¯æŒ‡æ²¡æœ‰ä¸ä»»ä½•æ–‡ä»¶æè¿°ç¬¦å…³è”çš„ socketï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºå·²ç»å…³é—­äº†è¿™ä¸ª socketï¼Œä½†æ˜¯å†…æ ¸è¿˜æ²¡æœ‰é‡Šæ”¾å®ƒçš„èµ„æºï¼Œå› ä¸º TCP è¿˜æ²¡æœ‰å®Œæˆå®ƒçš„çŠ¶æ€è½¬æ¢ã€‚<br>    TCP orphans é€šå¸¸å‡ºç°åœ¨ä»¥ä¸‹å‡ ç§ TCP çŠ¶æ€ï¼šFIN-WAIT-1, FIN-WAIT-2, LAST-ACK, CLOSING å’Œ TIME-WAITã€‚è¿™äº›çŠ¶æ€éƒ½æ˜¯åœ¨ TCP å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ï¼Œè¡¨ç¤ºè¿æ¥æ­£åœ¨å…³é—­æˆ–å·²ç»å…³é—­ï¼Œä½†æ˜¯è¿˜éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½å®Œå…¨é‡Šæ”¾ã€‚<br>    TCP orphans çš„äº§ç”Ÿå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š<br>    åº”ç”¨ç¨‹åºå…³é—­äº† socketï¼Œä½†æ˜¯å¯¹æ–¹æ²¡æœ‰åŠæ—¶å›å¤ ACK æˆ– FIN æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥ä¸€ç›´å¤„äº FIN-WAIT-1 æˆ– FIN-WAIT-2 çŠ¶æ€ã€‚<br>    åº”ç”¨ç¨‹åºå…³é—­äº† socketï¼Œä½†æ˜¯å¯¹æ–¹å›å¤äº† FIN æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥è¿›å…¥ CLOSING çŠ¶æ€ï¼Œç„¶ååŒæ–¹éƒ½æ²¡æœ‰åŠæ—¶å›å¤ ACK æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥ä¸€ç›´å¤„äº CLOSING çŠ¶æ€ã€‚<br>    åº”ç”¨ç¨‹åºå…³é—­äº† socketï¼Œä½†æ˜¯å¯¹æ–¹å›å¤äº† ACK æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥è¿›å…¥ LAST-ACK çŠ¶æ€ï¼Œç„¶åå¯¹æ–¹æ²¡æœ‰åŠæ—¶å›å¤ FIN æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥ä¸€ç›´å¤„äº LAST-ACK çŠ¶æ€ã€‚<br>    åº”ç”¨ç¨‹åºå…³é—­äº† socketï¼Œä½†æ˜¯å¯¹æ–¹å›å¤äº† FIN å’Œ ACK æŠ¥æ–‡ï¼Œå¯¼è‡´è¿æ¥è¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç„¶åéœ€è¦ç­‰å¾… 2MSL çš„æ—¶é—´æ‰èƒ½é‡Šæ”¾è¿æ¥ã€‚<br>    åº”ç”¨ç¨‹åºå…³é—­äº† socketï¼Œä½†æ˜¯ç”±äºç½‘ç»œå»¶è¿Ÿæˆ–ä¸¢åŒ…ç­‰åŸå› ï¼Œå¯¼è‡´ä¸Šè¿°çŠ¶æ€è½¬æ¢è¿‡ç¨‹ä¸­çš„æŠ¥æ–‡ä¸¢å¤±æˆ–é‡ä¼ ï¼Œå»¶é•¿äº†è¿æ¥çš„å…³é—­æ—¶é—´ã€‚</p>
</blockquote>
<p><a href="https://github.com/moooofly/MarkSomethingDownLLS/blob/master/%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%20iptables%20%E4%B8%AD%20connection%20tracking%20(conntrack).md">https://github.com/moooofly/MarkSomethingDownLLS/blob/master/%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%20iptables%20%E4%B8%AD%20connection%20tracking%20(conntrack).md</a></p>
<p>æ–°çš„æµ‹è¯•æ­¥éª¤ï¼š </p>
<pre class="language-none"><code class="language-none"># æ¸…ç†IPtablesè§„åˆ™
iptables -Z &amp;&amp; iptables -X &amp;&amp; iptables -F
iptables -t raw -Z &amp;&amp; iptables -t raw -F &amp;&amp; iptables -t raw -X

# åˆ›å»ºæ–°çš„IPtablesè§„åˆ™ï¼Œ å±è”½ FIN ï¼Œ RST

# Server block self FIN RST 
# Role Nginx Server  172.31.54.32
iptables -I OUTPUT 1 -p tcp -s 171.31.54.32 --tcp-flags FIN FIN -j DROP
iptables -I OUTPUT 1 -p tcp -s 172.31.54.32 --tcp-flags RST RST -j DROP

# Client block self FIN RST 
# Role Client  172.31.36.129
iptables -I OUTPUT 1 -p tcp -s 172.31.36.129 --tcp-flags FIN FIN -j DROP
iptables -I OUTPUT 1 -p tcp -s 172.31.36.129 --tcp-flags RST RST -j DROP</code></pre>
<p>æŒ‰ç…§è¿™ä¸ªè®¾ç½®ï¼Œ ä½¿ç”¨tcpdumpæŠ“æŠ¥åŒ…ï¼Œ åŒæ–¹æ˜¯æ²¡æœ‰ FIN å’Œ RST çš„ï¼Œ è¯´æ˜iptablesè§„åˆ™å±‚é¢æ˜¯ç”Ÿæ•ˆã€‚<br>æŸ¥çœ‹ ss -s çš„æ•°æ®ï¼Œ å®¢æˆ·ç«¯çš„è¿æ¥æ•°æ˜¯åœ¨ 10000 å·¦å³çš„ï¼Œ æœåŠ¡ç«¯ä¹Ÿæ˜¯ï¼›<br>ä½¿ç”¨å‘½ä»¤ä¸­æ–­å®¢æˆ·ç«¯çš„wrkç¨‹åºä¹‹åï¼Œå®¢æˆ·ç«¯çš„è¿æ¥æ•°ä¼šç›´æ¥è¢«é‡Šæ”¾ï¼›<br>æœåŠ¡ç«¯ä¼šç»´æŒï¼Œ ç»´æŒä¸€æ®µæ—¶é—´ä¹‹åï¼Œ ä¸‹é™åˆ° 5000 ï¼Œ ç„¶åå®Œå…¨æ¶ˆå¤±ã€‚ </p>
<p>é€ æˆè¿™ä¸ªç°è±¡çš„åŸå› æ˜¯ï¼š Nginxé…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ã€‚</p>
<pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf
worker_rlimit_nofile 1024000;

http&#123;
    sendfile            on;
    tcp_nopush          on;
    types_hash_max_size 4096;
    keepalive_timeout 3000s; # æœåŠ¡ç«¯ç»´æŒè¿æ¥çš„æœ€å¤§æ—¶é—´ï¼Œ è¶…è¿‡è¿™ä¸ªæ—¶é—´ä¹‹åçš„è¿æ¥ä¼šè¢«nginxé‡Šæ”¾ã€‚ 
    keepalive_requests 1000000; # åœ¨ä¸€ä¸ªé•¿è¿æ¥ä¸Šå¯ä»¥æœåŠ¡çš„æœ€å¤§è¯·æ±‚æ•°ç›®ã€‚
&#125;</code></pre>
<p>Refer Linkï¼š <a href="https://www.cnblogs.com/kevingrace/p/9364404.html">https://www.cnblogs.com/kevingrace/p/9364404.html</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx, Application</tag>
      </tags>
  </entry>
  <entry>
    <title>OOMè¡Œä¸º</title>
    <url>/2022/04/19/Linux/Linux_OOMKiller/</url>
    <content><![CDATA[<p>å…³äºOOMè¡Œä¸ºçš„æ€è€ƒ ä»¥åŠKswapdçš„åŠ¨ä½œå’Œè¡Œä¸ºã€‚<br><a href="http://evertrain.blogspot.com/2018/04/oom.html">http://evertrain.blogspot.com/2018/04/oom.html</a><br>æ›´è¯¦ç»†çš„æ‰“åˆ†ç®—æ³•è§æºç   <a href="https://github.com/torvalds/linux/blob/master/mm/oom_kill.c">https://github.com/torvalds/linux/blob/master/mm/oom_kill.c</a></p>
<h2 id="å‘ç”Ÿä¹‹å"><a href="#å‘ç”Ÿä¹‹å" class="headerlink" title="å‘ç”Ÿä¹‹å"></a>å‘ç”Ÿä¹‹å</h2><p>OOM killerä¼šå°†killçš„ä¿¡æ¯è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—&#x2F;var&#x2F;log&#x2F;messagesï¼Œæ£€ç´¢ç›¸å…³ä¿¡æ¯å°±èƒ½åŒ¹é…åˆ°æ˜¯å¦è§¦å‘ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token string">'Out of memory'</span> /var/log/messages</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡dmesg</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">dmesg</span> <span class="token parameter variable">-Tx</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token parameter variable">-i</span> <span class="token string">'killed process'</span></code></pre>

<h2 id="æŸ¥çœ‹åˆ†æ•°æœ€é«˜çš„è¿›ç¨‹"><a href="#æŸ¥çœ‹åˆ†æ•°æœ€é«˜çš„è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹åˆ†æ•°æœ€é«˜çš„è¿›ç¨‹"></a>æŸ¥çœ‹åˆ†æ•°æœ€é«˜çš„è¿›ç¨‹</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">proc</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> /proc <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-regex</span> <span class="token string">'/proc/[0-9]+'</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token builtin class-name">printf</span> <span class="token string">"%2d %5d %s<span class="token entity" title="\n">\n</span>"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $proc/oom_score<span class="token variable">)</span></span>"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $proc<span class="token variable">)</span></span>"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $proc/cmdline <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\0'</span> <span class="token string">' '</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">50</span><span class="token variable">)</span></span>"</span>
<span class="token keyword">done</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span></code></pre>

<h2 id="ä¿æŠ¤æªæ–½"><a href="#ä¿æŠ¤æªæ–½" class="headerlink" title="ä¿æŠ¤æªæ–½"></a>ä¿æŠ¤æªæ–½</h2><h3 id="è®¾ç½®OverCommit"><a href="#è®¾ç½®OverCommit" class="headerlink" title="è®¾ç½®OverCommit"></a>è®¾ç½®OverCommit</h3><p>åªæœ‰åœ¨OverCommitçš„æ—¶å€™æ‰ä¼šè§¦å‘OOMï¼Œ é»˜è®¤æ˜¯è®¸å¯ä¸€å®šç¨‹åº¦çš„OverCommitçš„ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">https://docs.kernel.org/vm/overcommit-accounting.html
vm.overcommit_memory ä½œç”¨æ˜¯æ§åˆ¶OverCommitæ˜¯å¦è¢«è®¸å¯ã€‚
<span class="token number">0</span>
    Heuristic overcommit handling. Obvious overcommits of address space are refused. Used <span class="token keyword">for</span> a typical system. It ensures a seriously wild allocation fails <span class="token keyword">while</span> allowing overcommit to reduce swap usage. root is allowed to allocate slightly <span class="token function">more</span> memory <span class="token keyword">in</span> this mode. This is the default.
<span class="token number">1</span>
    Always overcommit. Appropriate <span class="token keyword">for</span> some scientific applications. Classic example is code using sparse arrays and just relying on the virtual memory consisting almost entirely of zero pages.
<span class="token number">2</span>
    Donâ€™t overcommit. The total address space commit <span class="token keyword">for</span> the system is not permitted to exceed swap + a configurable amount <span class="token punctuation">(</span>default is <span class="token number">50</span>%<span class="token punctuation">)</span> of physical RAM. Depending on the amount you use, <span class="token keyword">in</span> <span class="token function">most</span> situations this means a process will not be killed <span class="token keyword">while</span> accessing pages but will receive errors on memory allocation as appropriate.

    Useful <span class="token keyword">for</span> applications that want to guarantee their memory allocations will be available <span class="token keyword">in</span> the future without having to initialize every page.

<span class="token punctuation">[</span>root@ip-172-31-9-192 log<span class="token punctuation">]</span><span class="token comment"># cat /proc/meminfo | grep Comm</span>
CommitLimit:     <span class="token number">4794236</span> kB
Committed_AS:    <span class="token number">2344744</span> kB
---
CommitLimitï¼š å¯æäº¤å†…å­˜çš„ä¸Šé™ï¼Œ è¶…è¿‡è¿™ä¸ªä¸Šé™ç³»ç»Ÿè®¤ä¸ºç›®å‰å†…å­˜å·²ç»æ˜¯OverCommitã€‚
Committed_ASï¼š å·²ç»æäº¤å†…å­˜çš„ä¸Šé™ï¼Œå½“å‰æ‰€æœ‰è¿›ç¨‹å·²ç»æäº¤çš„å†…å­˜ä½¿ç”¨ï¼Œè¿™ä¸ªä¸æ˜¯å·²ç»åˆ†é…å‡ºå»çš„ï¼Œ æ˜¯è¿›ç¨‹ç”³è¯·çš„ã€‚</code></pre>

<h3 id="è®¾ç½®Killerçš„è¡Œä¸º"><a href="#è®¾ç½®Killerçš„è¡Œä¸º" class="headerlink" title="è®¾ç½®Killerçš„è¡Œä¸º"></a>è®¾ç½®Killerçš„è¡Œä¸º</h3><pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-11-235:/home/ec2-user<span class="token operator">|</span>â‡’  <span class="token function">cat</span> /proc/sys/vm/oom_kill_allocating_task
<span class="token comment"># å€¼ä¸º0ï¼šä¼š kill æ‰å¾—åˆ†æœ€é«˜çš„è¿›ç¨‹</span>
<span class="token comment"># å€¼ä¸ºé0ï¼šä¼škill æ‰å½“å‰ç”³è¯·å†…å­˜è€Œè§¦å‘OOMçš„è¿›ç¨‹</span></code></pre>

<h3 id="è®¾ç½®è¿›ç¨‹"><a href="#è®¾ç½®è¿›ç¨‹" class="headerlink" title="è®¾ç½®è¿›ç¨‹"></a>è®¾ç½®è¿›ç¨‹</h3><ol>
<li>å¯¹äºéœ€è¦ä¿æŠ¤çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨OOM_ADJ&#x3D;-17 å°†è¿™ä¸ªè¿›ç¨‹ä»OOM Killerçš„åˆ—è¡¨ä¸­ç§»é™¤ï¼ˆå·²ç»åœ¨å†…æ ¸çš„2.6ä¹‹ååºŸå¼ƒï¼Œå¤„äºå…¼å®¹æ€§ä¿ç•™äº†è¿™ä¸ªæ–‡ä»¶æ¥å£</li>
<li>è°ƒæ•´OOM_SCORE_ADJ, èŒƒå›´æ˜¯ -1000 &lt; oom_score_adj &lt; 1000</li>
</ol>
<p>ç›´æ¥è°ƒæ•´åˆ°-1000ï¼Œä¼šå‡ºç°åœ¨è®¡ç®—åˆ†æ•°åˆ—è¡¨çš„æœ€å<br>  <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-1000</span> <span class="token operator">></span> /proc/31595/oom_score_adj</code></pre></p>
<p>  æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡OOMè§„åˆ™ï¼Œ Killç¬¦åˆè¦æ±‚çš„è¿›ç¨‹<br>  <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> f <span class="token operator">></span> /proc/sysrq-trigger</code></pre></p>
<h3 id="è°ƒæ•´æœåŠ¡çš„OOM-Score"><a href="#è°ƒæ•´æœåŠ¡çš„OOM-Score" class="headerlink" title="è°ƒæ•´æœåŠ¡çš„OOM Score"></a>è°ƒæ•´æœåŠ¡çš„OOM Score</h3><p>å¯¹äºæœåŠ¡æœ¬èº«çš„ä¿æŠ¤æ–¹å¼ï¼Œ å¯ä»¥é‡‡ç”¨ä½¿ç”¨Systemd Unit fileé‡Œé¢è¿›è¡Œ OOMADJSCORE&#x3D;*** çš„æ–¹å¼æ¥æŒ‡å®šï¼Œä¾‹å¦‚ä¿æŠ¤MySQLçš„è¿›ç¨‹ä¸ä¼šåœ¨OOM Killerçš„åˆ—è¡¨ä¸­ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /usr/lib/systemd/system/mariadb.service

    <span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
    <span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
    <span class="token assign-left variable">User</span><span class="token operator">=</span>mysql
    <span class="token assign-left variable">Group</span><span class="token operator">=</span>mysql

    <span class="token assign-left variable">ExecStartPre</span><span class="token operator">=</span>/usr/libexec/mariadb-prepare-db-dir %n
    <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/mysqld_safe <span class="token parameter variable">--basedir</span><span class="token operator">=</span>/usr
    <span class="token assign-left variable">ExecStartPost</span><span class="token operator">=</span>/usr/libexec/mariadb-wait-ready <span class="token variable">$MAINPID</span>
    <span class="token comment"># Setting Here. and setting in the /proc/$PID/oom_score_adj.</span>
    <span class="token assign-left variable">OOMScoreAdjust</span><span class="token operator">=</span>-1000

<span class="token function">sudo</span> systemctl daemon-reload <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart mariadb</code></pre>

<h3 id="é¿å…OOMçš„æ–¹å¼"><a href="#é¿å…OOMçš„æ–¹å¼" class="headerlink" title="é¿å…OOMçš„æ–¹å¼"></a>é¿å…OOMçš„æ–¹å¼</h3><ol>
<li>å…³é—­OverCommitï¼š å…³é—­OverCommitä¼šå¯¼è‡´è¿›ç¨‹å¦‚æœæ— æ³•æ‹¿åˆ°å†…å­˜å°±fast fail ï¼Œ ä¸ä¼šå‡ºç°OOMKillerå¹²æ‰æ— è¾œè¿›ç¨‹çš„æƒ…å†µã€‚</li>
<li>å¼€å¯OverCommitï¼Œ å¼€å¯ä¸€å®šç¨‹åº¦çš„Swapï¼š å¼€å¯Swapä¼šå¯¼è‡´å†…å­˜åœ¨æ¥è¿‘99%çš„æ—¶å€™ï¼Œä¼šå‡ºç°ç³»ç»Ÿå“åº”å˜æ…¢çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šç”±äºç”³è¯·çš„å†…å­˜æ²¡æœ‰è¶…è¿‡TotalMEM + TotalSWAPï¼Œå› æ­¤ä¸ä¼šè§¦å‘OOM ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ˜æ˜¾çš„ç³»ç»Ÿå“åº”é—®é¢˜ã€‚ å¦‚æœè¶…è¿‡äº† TotalMEM + TotalSWAP ä¼šç«‹åˆ»è§¦å‘ä¸€æ¬¡OOMkillerç»“æŸè¿›ç¨‹ã€‚</li>
<li>å¼€å¯OverCommitï¼Œ è°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼š å¯¹äºç‰¹å®šçš„è¿›ç¨‹è¿›è¡Œä¿æŠ¤ã€‚OOMä¼šæŒ‰ç…§è®¾ç½®çš„ç§¯åˆ†è®¡ç®—éœ€è¦Killçš„è¿›ç¨‹ã€‚</li>
<li>å¼€å¯OverCommitï¼Œ è°ƒæ•´OOMkillerçš„è¡Œä¸ºæ–¹å¼ï¼š è®¡ç®—ç§¯åˆ†åKill æˆ–è€… ç›´æ¥Killå½“å‰æ–°ç”³è¯·å†…å­˜çš„è¿›ç¨‹ã€‚è¿™ä¸ªæ–¹å¼æ„Ÿè§‰å’Œé»˜è®¤çš„å…³é—­OverCommitçš„è¡Œä¸ºç±»å‹ï¼Œéƒ½æ˜¯æ‹’ç»æ–°çš„è¿›ç¨‹ä»¥ä¿è¯æ—§çš„è¿›ç¨‹å¯ä»¥å­˜æ´»ã€‚</li>
</ol>
<h2 id="æ›´å¯é çš„æ–¹å¼"><a href="#æ›´å¯é çš„æ–¹å¼" class="headerlink" title="æ›´å¯é çš„æ–¹å¼"></a>æ›´å¯é çš„æ–¹å¼</h2><h3 id="Faceboookçš„oomd"><a href="#Faceboookçš„oomd" class="headerlink" title="Faceboookçš„oomd"></a>Faceboookçš„oomd</h3><p><a href="https://github.com/facebookincubator/oomd">https://github.com/facebookincubator/oomd</a><br>oomdä½¿ç”¨çš„æ˜¯ PSIæ¥å£æ¥è¯„ä¼°å†…å­˜çš„å‹åŠ›ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰è§„åˆ™çš„æ–¹å¼æ¥å¯¹æ¥è¿›è¡Œå†…å­˜å‹åŠ›çš„åˆ†æï¼Œè€Œä¸æ˜¯ç®€å•çš„å†…å­˜ç”¨é‡ã€‚</p>
<h3 id="Fedoraçš„Early-OOM"><a href="#Fedoraçš„Early-OOM" class="headerlink" title="Fedoraçš„Early OOM"></a>Fedoraçš„Early OOM</h3><p><a href="https://github.com/rfjakob/earlyoom">https://github.com/rfjakob/earlyoom</a><br>EarlyOOMçš„ä½œç”¨æ˜¯æå‰OOMï¼Œè¿™æ ·å¯ä»¥ä¿éšœç”¨æˆ·ç©ºé—´çš„å›¾å½¢æ¡Œé¢ä¸ä¼šåˆ°äº¤æ¢ç©ºé—´å»ï¼Œ ä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯å†…å­˜å‹åŠ›è¿‡å¤§çš„äº¤æ¢åŠ¨ä½œä¼šå°†æ¡Œé¢ç¯å¢ƒæ¢å‡ºå¯¼è‡´å“åº”å˜æ…¢ã€‚</p>
<h2 id="è¾“å‡ºç»“æœè®°å½•"><a href="#è¾“å‡ºç»“æœè®°å½•" class="headerlink" title="è¾“å‡ºç»“æœè®°å½•"></a>è¾“å‡ºç»“æœè®°å½•</h2><h3 id="Cgroup-Pod"><a href="#Cgroup-Pod" class="headerlink" title="Cgroup - Pod"></a>Cgroup - Pod</h3><ul>
<li><p>é¦–å…ˆæ˜¯å“ªä¸ªç¨‹åºè¶…è¿‡äº†cgroupçš„limitï¼Œ è§¦å‘äº†cgroup çš„oomï¼Œ è¿™é‡Œæ˜¯ xray è¿™ä¸ªè¿›ç¨‹è‡ªå·±ã€‚</p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023] xray invoked oom-killer: gfp_mask&#x3D;0x100cca(GFP_HIGHUSER_MOVABLE), order&#x3D;0, oom_score_adj&#x3D;-997</code></pre>
</li>
<li><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯è§¦å‘kprintçš„ä¿¡æ¯ï¼Œ è§£é‡Šå¦‚ä¸‹ï¼š<br>åœ¨å“ªä¸ªCPUï¼ˆ1ï¼‰ä¸Šï¼Œ è¿è¡Œçš„è¿›ç¨‹PIDï¼ˆ1586622ï¼‰ï¼Œ commandlineçš„åç§°ï¼ˆxrayï¼‰ï¼Œ å“ªä¸ªç‰ˆæœ¬çš„å†…æ ¸ï¼Œ æ˜¯å¦è¢«æ ‡è®°ä¸º taint.</p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023] CPU: 1 PID: 1586622 Comm: xray Kdump: loaded Not tainted 5.14.0-333.el9.x86_64 #1</code></pre>
</li>
<li><p>ç¡¬ä»¶ä¿¡æ¯ï¼Œ BIOSä¿¡æ¯   </p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023] Hardware name: Red Hat KVM, BIOS 1.15.0-2.module_el8.6.0+2880+7d9e3703 04&#x2F;01&#x2F;2014</code></pre>
</li>
<li><p>æ‰“å°å‘ç”Ÿoomæ—¶åˆ»çš„å †æ ˆ</p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023] Call Trace:
kern  :warn  : [Thu Aug 17 17:29:27 2023]  &lt;TASK&gt;
kern  :warn  : [Thu Aug 17 17:29:27 2023]  dump_stack_lvl+0x34&#x2F;0x48
kern  :warn  : [Thu Aug 17 17:29:27 2023]  dump_header+0x4a&#x2F;0x201
kern  :warn  : [Thu Aug 17 17:29:27 2023]  oom_kill_process.cold+0xb&#x2F;0x10
kern  :warn  : [Thu Aug 17 17:29:27 2023]  out_of_memory+0xed&#x2F;0x2e0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  mem_cgroup_out_of_memory+0x13a&#x2F;0x150
kern  :warn  : [Thu Aug 17 17:29:27 2023]  try_charge_memcg+0x79d&#x2F;0x860
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? __mem_cgroup_charge+0x55&#x2F;0x80
kern  :warn  : [Thu Aug 17 17:29:27 2023]  charge_memcg+0x7a&#x2F;0xf0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  __mem_cgroup_charge+0x29&#x2F;0x80
kern  :warn  : [Thu Aug 17 17:29:27 2023]  __filemap_add_folio+0x224&#x2F;0x590
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? scan_shadow_nodes+0x30&#x2F;0x30
kern  :warn  : [Thu Aug 17 17:29:27 2023]  filemap_add_folio+0x37&#x2F;0xa0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  __filemap_get_folio+0x1fd&#x2F;0x330
kern  :warn  : [Thu Aug 17 17:29:27 2023]  filemap_fault+0x40b&#x2F;0x740
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? next_uptodate_page+0x160&#x2F;0x1f0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? _raw_spin_unlock+0xa&#x2F;0x30
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? filemap_map_pages+0x298&#x2F;0x540
kern  :warn  : [Thu Aug 17 17:29:27 2023]  __do_fault+0x36&#x2F;0x140
kern  :warn  : [Thu Aug 17 17:29:27 2023]  do_read_fault+0xf0&#x2F;0x160
kern  :warn  : [Thu Aug 17 17:29:27 2023]  do_fault+0xa9&#x2F;0x390
kern  :warn  : [Thu Aug 17 17:29:27 2023]  __handle_mm_fault+0x585&#x2F;0x650
kern  :warn  : [Thu Aug 17 17:29:27 2023]  handle_mm_fault+0xc5&#x2F;0x2a0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  do_user_addr_fault+0x1b4&#x2F;0x6a0
kern  :warn  : [Thu Aug 17 17:29:27 2023]  ? syscall_exit_to_user_mode+0x12&#x2F;0x30
kern  :warn  : [Thu Aug 17 17:29:27 2023]  exc_page_fault+0x62&#x2F;0x150
kern  :warn  : [Thu Aug 17 17:29:27 2023]  asm_exc_page_fault+0x22&#x2F;0x30</code></pre>
</li>
<li><p>å¯„å­˜å™¨çš„åœ°å€å’Œç›¸å…³ä¿¡æ¯ã€‚</p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023] RIP: 0033:0x46ea1d
kern  :warn  : [Thu Aug 17 17:29:27 2023] Code: Unable to access opcode bytes at RIP 0x46e9f3.
kern  :warn  : [Thu Aug 17 17:29:27 2023] RSP: 002b:000000c000073f10 EFLAGS: 00010202
kern  :warn  : [Thu Aug 17 17:29:27 2023] RAX: 0000000000000000 RBX: 0000000000002710 RCX: 000000000046ea1d
kern  :warn  : [Thu Aug 17 17:29:27 2023] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 000000c000073f10
kern  :warn  : [Thu Aug 17 17:29:27 2023] RBP: 000000c000073f20 R08: 000000000001af6c R09: 0000000000000072
kern  :warn  : [Thu Aug 17 17:29:27 2023] R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000000011
kern  :warn  : [Thu Aug 17 17:29:27 2023] R13: 000000c000aa6c00 R14: 000000c0000064e0 R15: 0000000000001000</code></pre>
</li>
<li><p>oomæ—¶åˆ»çš„å†…å­˜ä¿¡æ¯ å’Œ &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory.statï¼Œ å½“å‰å‘ç”Ÿoomä¸‹é¢çš„Cgroup çš„ä¿¡æ¯</p>
  <pre class="language-none"><code class="language-none">kern  :warn  : [Thu Aug 17 17:29:27 2023]  &lt;&#x2F;TASK&gt;
kern  :info  : [Thu Aug 17 17:29:27 2023] memory: usage 208204kB, limit 204800kB, failcnt 7470
kern  :info  : [Thu Aug 17 17:29:27 2023] swap: usage 0kB, limit 0kB, failcnt 0
kern  :info  : [Thu Aug 17 17:29:27 2023] Memory cgroup stats for &#x2F;kubepods.slice&#x2F;kubepods-pod089f25ee_a41a_414c_a028_71a38dfb30d3.slice&#x2F;cri-containerd-c3f1de0d0969e5d3c6758d2e59be98d4dc8ba0367af77f52b09d15225139c74f.scope:
kern  :info  : [Thu Aug 17 17:29:27 2023] anon 28139520
                                      file 8192
                                      kernel 1343488
                                      kernel_stack 212992
                                      pagetables 167936
                                      sec_pagetables 0
                                      percpu 0
                                      sock 183623680
                                      vmalloc 0
                                      shmem 0
                                      zswap 0
                                      zswapped 0
                                      file_mapped 0
                                      file_dirty 0
                                      file_writeback 0
                                      swapcached 0
                                      anon_thp 8388608
                                      file_thp 0
                                      shmem_thp 0
                                      inactive_anon 28135424
                                      active_anon 4096
                                      inactive_file 4096
                                      active_file 0
                                      unevictable 0
                                      slab_reclaimable 367104
                                      slab_unreclaimable 562944
                                      slab 930048
                                      workingset_refault_anon 0
                                      workingset_refault_file 5784
                                      workingset_activate_anon 0
                                      workingset_activate_file 2856
                                      workingset_restore_anon 0
                                      workingset_restore_file 2331
                                      workingset_nodereclaim 0
                                      pgscan 8263
                                      pgsteal 5880
                                      pgscan_kswapd 1945
                                      pgscan_direct 6318
                                      pgsteal_kswapd 1496
                                      pgsteal_direct 4384
                                      pgfault 23739
                                      pgmajfault 416
                                      pgrefill 4326
                                      pgactivate 379
                                      pgdeactivate 3235
                                      pglazyfree 0
                                      pglazyfreed 0
                                      zswpin 0
                                      zswpout 0
                                      thp_fault_alloc 14
                                      thp_collapse_alloc 4</code></pre></li>
<li><p>ä»»åŠ¡ä¿¡æ¯ï¼Œ è¢«killçš„è¿›ç¨‹çš„ä¿¡æ¯ï¼Œ å†…å­˜çš„ä½¿ç”¨é‡ä»¥åŠç§¯åˆ†æ¨¡å¼ã€‚</p>
  <pre class="language-none"><code class="language-none">kern  :info  : [Thu Aug 17 17:29:27 2023] Tasks state (memory values in pages):
kern  :info  : [Thu Aug 17 17:29:27 2023] [  pid  ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name
kern  :info  : [Thu Aug 17 17:29:27 2023] [1586608]     0 1586608   184282     6593   180224        0          -997 xray
kern  :info  : [Thu Aug 17 17:29:27 2023] oom-kill:constraint&#x3D;CONSTRAINT_MEMCG,nodemask&#x3D;(null),cpuset&#x3D;cri-containerd-c3f1de0d0969e5d3c6758d2e59be98d4dc8ba0367af77f52b09d15225139c74f.scope,mems_allowed&#x3D;0,oom_memcg&#x3D;&#x2F;kubepods.slice&#x2F;kubepods-pod089f25ee_a41a_414c_a028_71a38dfb30d3.slice&#x2F;cri-containerd-c3f1de0d0969e5d3c6758d2e59be98d4dc8ba0367af77f52b09d15225139c74f.scope,task_memcg&#x3D;&#x2F;kubepods.slice&#x2F;kubepods-pod089f25ee_a41a_414c_a028_71a38dfb30d3.slice&#x2F;cri-containerd-c3f1de0d0969e5d3c6758d2e59be98d4dc8ba0367af77f52b09d15225139c74f.scope,task&#x3D;xray,pid&#x3D;1586608,uid&#x3D;0
kern  :err   : [Thu Aug 17 17:29:27 2023] Memory cgroup out of memory: Killed process 1586608 (xray) total-vm:737128kB, anon-rss:26372kB, file-rss:0kB, shmem-rss:0kB, UID:0 pgtables:176kB oom_score_adj:-997</code></pre></li>
</ul>
<h3 id="System"><a href="#System" class="headerlink" title="System"></a>System</h3>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Memory</tag>
      </tags>
  </entry>
  <entry>
    <title>Orthancçš„å®‰è£…</title>
    <url>/2018/04/25/Linux/Linux_Orthanc_InstallationNote/</url>
    <content><![CDATA[<p>è®°å½•äº†Orthancçš„å®‰è£…è¿‡ç¨‹ã€‚åªæœ‰ç®€å•çš„å®‰è£…ï¼Œå¤æ‚æ²¡ç ”ç©¶ï¼Œå¾…è¡¥å…¨ã€‚<br>Orthancæ˜¯ä¸€ä¸ªå¼€æºçš„DICOM Serverï¼Œæ”¯æŒRESTful APIï¼Œæ˜¯è½»é‡çº§çš„DICOM Serverï¼Œé»˜è®¤åŸºäºæ•°æ®åº“SQLliteï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒPostgreSQLã€‚</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>  å¹³å°ï¼š<em>Fedora</em> OR <em>Windows</em>  </p>
<h2 id="å®‰è£…Orthanc"><a href="#å®‰è£…Orthanc" class="headerlink" title="å®‰è£…Orthanc"></a>å®‰è£…Orthanc</h2><h2 id="å¿«é€Ÿéƒ¨ç½²"><a href="#å¿«é€Ÿéƒ¨ç½²" class="headerlink" title="å¿«é€Ÿéƒ¨ç½²"></a>å¿«é€Ÿéƒ¨ç½²</h2><h4 id="Fedoraé›†æˆçš„RPMåŒ…"><a href="#Fedoraé›†æˆçš„RPMåŒ…" class="headerlink" title="Fedoraé›†æˆçš„RPMåŒ…"></a>Fedoraé›†æˆçš„RPMåŒ…</h4><p><a href="https://koji.fedoraproject.org/koji/rpminfo?rpmID=11215099">Fedoraæä¾›çš„BuildVersion</a><br>ä¸‹è½½åˆ°æœ¬åœ°ä¹‹åï¼šæ‰§è¡Œ  </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> orthanc*
systemctl <span class="token builtin class-name">enable</span> orthanc
systemctl start orthanc
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">8042</span> <span class="token parameter variable">-j</span> ACCEPT
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">4242</span> <span class="token parameter variable">-j</span> ACCEPT
iptables-save</code></pre>
<p>å®‰è£…ç»“æŸã€‚  </p>
<h4 id="Windowsä¸€é”®å®‰è£…åŒ…"><a href="#Windowsä¸€é”®å®‰è£…åŒ…" class="headerlink" title="Windowsä¸€é”®å®‰è£…åŒ…"></a>Windowsä¸€é”®å®‰è£…åŒ…</h4><p><a href="https://www.orthanc-server.com/download-windows.php">Windowså®‰è£…åŒ…ä¸‹è½½åœ°å€</a><br>ç›´æ¥ä¸‹è½½ä¹‹åè¿è¡Œå³å¯ã€‚</p>
<h2 id="æ’ä»¶éƒ¨åˆ†"><a href="#æ’ä»¶éƒ¨åˆ†" class="headerlink" title="æ’ä»¶éƒ¨åˆ†"></a>æ’ä»¶éƒ¨åˆ†</h2>]]></content>
      <categories>
        <category>Healthcare-IT</category>
      </categories>
      <tags>
        <tag>Orthanc, Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>BufferIOä¸DirectIOçš„æ¯”è¾ƒ</title>
    <url>/2023/07/10/Linux/Linux_Perf-DirectIO-BufferIO/</url>
    <content><![CDATA[<h2 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h2><p>ä½¿ç”¨BufferIOçš„æ–¹å¼ï¼Œ æµ‹è¯•æ–‡ä»¶çš„å†™å…¥ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

perf record <span class="token parameter variable">-T</span> <span class="token parameter variable">-C</span> <span class="token number">0</span> -- taskset <span class="token parameter variable">-c</span> <span class="token number">0</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>./a.dat <span class="token assign-left variable">bs</span><span class="token operator">=</span>4k <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">16384</span></code></pre>

<p>ä½¿ç”¨DirectIOçš„æ–¹å¼ï¼Œ æµ‹è¯•æ–‡ä»¶çš„å†™å…¥:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

perf record <span class="token parameter variable">-T</span> <span class="token parameter variable">-C</span> <span class="token number">0</span> -- taskset <span class="token parameter variable">-c</span> <span class="token number">0</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>./a.dat <span class="token assign-left variable">bs</span><span class="token operator">=</span>4k <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">16384</span> <span class="token assign-left variable">oflag</span><span class="token operator">=</span>direct</code></pre>

<h2 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h2><p>BufferIO:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-53-200 perf_records<span class="token punctuation">]</span><span class="token comment"># ./start_test_bufferio.sh</span>
<span class="token number">16384</span>+0 records <span class="token keyword">in</span>
<span class="token number">16384</span>+0 records out
<span class="token number">67108864</span> bytes <span class="token punctuation">(</span><span class="token number">67</span> MB, <span class="token number">64</span> MiB<span class="token punctuation">)</span> copied, <span class="token number">0.118848</span> s, <span class="token number">565</span> MB/s
<span class="token punctuation">[</span> perf record: Woken up <span class="token number">1</span> <span class="token builtin class-name">times</span> to <span class="token function">write</span> data <span class="token punctuation">]</span>
<span class="token punctuation">[</span> perf record: Captured and wrote <span class="token number">0.225</span> MB perf.data <span class="token punctuation">(</span><span class="token number">485</span> samples<span class="token punctuation">)</span> <span class="token punctuation">]</span>

ll <span class="token parameter variable">-h</span> 
-rw-r--r--. <span class="token number">1</span> root root  64M Jun  <span class="token number">1</span> <span class="token number">13</span>:45 a.dat

<span class="token punctuation">[</span>root@ip-172-31-53-200 ~<span class="token punctuation">]</span><span class="token comment"># dstat -tf</span>
----system---- -----cpu0-usage----------cpu1-usage----------cpu2-usage----------cpu3-usage---- dsk/nvme0n1 ---net/lo-----net/eth0- ---paging-- ---system--
     <span class="token function">time</span>     <span class="token operator">|</span>usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl<span class="token operator">|</span> <span class="token builtin class-name">read</span>  writ<span class="token operator">|</span> recv  send: recv  send<span class="token operator">|</span>  <span class="token keyword">in</span>   out <span class="token operator">|</span> int   csw
01-06 <span class="token number">13</span>:35:48<span class="token operator">|</span>  <span class="token number">2</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">98</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>8192B   35k<span class="token operator">|</span>1096B 1096B: 968B  828B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">712</span>   <span class="token number">971</span>
01-06 <span class="token number">13</span>:35:49<span class="token operator">|</span> <span class="token number">25</span>   <span class="token number">9</span>  <span class="token number">60</span>   <span class="token number">5</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>  <span class="token number">12</span>  <span class="token number">84</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>   <span class="token number">8</span>  <span class="token number">90</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>    64M<span class="token operator">|</span>1096B 1096B: 576B  756B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">2283</span>  <span class="token number">1311</span>
01-06 <span class="token number">13</span>:35:50<span class="token operator">|</span>  <span class="token number">6</span>   <span class="token number">1</span>  <span class="token number">94</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>: <span class="token number">16</span>   <span class="token number">2</span>  <span class="token number">83</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span>1096B 1096B: 156B  418B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">954</span>  <span class="token number">1018</span></code></pre>

<p>DirectIO:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-53-200 perf_records<span class="token punctuation">]</span><span class="token comment"># ./start_test_directio.sh</span>
<span class="token number">16384</span>+0 records <span class="token keyword">in</span>
<span class="token number">16384</span>+0 records out
<span class="token number">67108864</span> bytes <span class="token punctuation">(</span><span class="token number">67</span> MB, <span class="token number">64</span> MiB<span class="token punctuation">)</span> copied, <span class="token number">10.4225</span> s, <span class="token number">6.4</span> MB/s
<span class="token punctuation">[</span> perf record: Woken up <span class="token number">9</span> <span class="token builtin class-name">times</span> to <span class="token function">write</span> data <span class="token punctuation">]</span>
<span class="token punctuation">[</span> perf record: Captured and wrote <span class="token number">2.417</span> MB perf.data <span class="token punctuation">(</span><span class="token number">41489</span> samples<span class="token punctuation">)</span> <span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@ip-172-31-53-200 ~<span class="token punctuation">]</span><span class="token comment"># dstat -tf</span>
----system---- -----cpu0-usage----------cpu1-usage----------cpu2-usage----------cpu3-usage---- dsk/nvme0n1 ---net/lo-----net/eth0- ---paging-- ---system--
     <span class="token function">time</span>     <span class="token operator">|</span>usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl<span class="token operator">|</span> <span class="token builtin class-name">read</span>  writ<span class="token operator">|</span> recv  send: recv  send<span class="token operator">|</span>  <span class="token keyword">in</span>   out <span class="token operator">|</span> int   csw
01-06 <span class="token number">13</span>:36:36<span class="token operator">|</span>  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span>1097B 1097B: 688B  624B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">622</span>   <span class="token number">930</span>
01-06 <span class="token number">13</span>:36:37<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token number">4</span>  <span class="token number">32</span>  <span class="token number">61</span>   <span class="token number">0</span>:  <span class="token number">4</span>  <span class="token number">14</span>  <span class="token number">81</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">97</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">5</span>  <span class="token number">94</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  4277k<span class="token operator">|</span>1095B 1095B: 332B  338B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">6434</span>  <span class="token number">3133</span>
01-06 <span class="token number">13</span>:36:38<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token number">3</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">3</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6421k<span class="token operator">|</span>1096B 1096B:  52B  174B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8767</span>  <span class="token number">4148</span>
01-06 <span class="token number">13</span>:36:39<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">2</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6431k<span class="token operator">|</span>1096B 1096B:  52B  150B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8790</span>  <span class="token number">4191</span>
01-06 <span class="token number">13</span>:36:40<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">91</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">2</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6320k<span class="token operator">|</span>1096B 1096B:  52B  142B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8744</span>  <span class="token number">4092</span>
01-06 <span class="token number">13</span>:36:41<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">3</span>   <span class="token number">0</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6216k<span class="token operator">|</span>1096B 1096B:  52B  142B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8662</span>  <span class="token number">4103</span>
01-06 <span class="token number">13</span>:36:42<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">2</span>   <span class="token number">2</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  7492k<span class="token operator">|</span>1576B 1576B:  52B  134B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8756</span>  <span class="token number">4099</span>
01-06 <span class="token number">13</span>:36:43<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token number">3</span>   <span class="token number">0</span>  <span class="token number">91</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6284k<span class="token operator">|</span>1096B 1096B:  52B  134B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8720</span>  <span class="token number">4077</span>
01-06 <span class="token number">13</span>:36:44<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">2</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">2</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6296k<span class="token operator">|</span>1096B 1096B:  52B  134B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8788</span>  <span class="token number">4067</span>
01-06 <span class="token number">13</span>:36:45<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">5</span>   <span class="token number">0</span>  <span class="token number">91</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  6368k<span class="token operator">|</span>1096B 1096B:  52B  134B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8792</span>  <span class="token number">4071</span>
01-06 <span class="token number">13</span>:36:46<span class="token operator">|</span>  <span class="token number">3</span>   <span class="token number">5</span>   <span class="token number">0</span>  <span class="token number">92</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">4</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  5904k<span class="token operator">|</span>1096B 1096B:  52B  134B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">8576</span>  <span class="token number">3893</span>
01-06 <span class="token number">13</span>:36:47<span class="token operator">|</span> <span class="token number">25</span>   <span class="token number">7</span>   <span class="token number">0</span>  <span class="token number">69</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">2</span>   <span class="token number">1</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>  4811k<span class="token operator">|</span>1097B 1097B: 364B  763B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token number">7035</span>  <span class="token number">3360</span>
01-06 <span class="token number">13</span>:36:48<span class="token operator">|</span>  <span class="token number">4</span>   <span class="token number">0</span>  <span class="token number">96</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>: <span class="token number">22</span>   <span class="token number">3</span>  <span class="token number">75</span>   <span class="token number">1</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">1</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>2642k  109k<span class="token operator">|</span>1095B 1095B: 208B  472B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">977</span>  <span class="token number">1008</span>
01-06 <span class="token number">13</span>:36:49<span class="token operator">|</span>  <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span> <span class="token number">100</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">98</span>   <span class="token number">0</span>   <span class="token number">0</span>:  <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span><span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span>1096B 1096B: 104B  276B<span class="token operator">|</span>   <span class="token number">0</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">640</span>   <span class="token number">903</span></code></pre>

<h2 id="Perf-é‡‡æ ·ç»“æœ"><a href="#Perf-é‡‡æ ·ç»“æœ" class="headerlink" title="Perf é‡‡æ ·ç»“æœ"></a>Perf é‡‡æ ·ç»“æœ</h2><p>BufferIOï¼š</p>
<p><img src="https://s2.loli.net/2023/06/01/oArisB8fI71NQdE.png" alt="bufferIO.png"></p>
<p>DirectIOï¼š</p>
<p><img src="https://s2.loli.net/2023/06/01/VMW9lwpgnFQ34DB.png" alt="directio.png"></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Perf, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Perf å‘½ä»¤çš„Performanceåˆ†æ</title>
    <url>/2022/04/19/Linux/Linux_Perf/</url>
    <content><![CDATA[<p><a href="https://blog.gmem.cc/perf">https://blog.gmem.cc/perf</a>  ä¸€ä¸ªéå¸¸è¯¦ç»†çš„åšå®¢ï¼Œ å¤ªå¼ºå•¦ã€‚</p>
<h2 id="ä½¿ç”¨perfè¿›è¡Œæ€§èƒ½çš„ç®€å•è¾“å‡º"><a href="#ä½¿ç”¨perfè¿›è¡Œæ€§èƒ½çš„ç®€å•è¾“å‡º" class="headerlink" title="ä½¿ç”¨perfè¿›è¡Œæ€§èƒ½çš„ç®€å•è¾“å‡º"></a>ä½¿ç”¨perfè¿›è¡Œæ€§èƒ½çš„ç®€å•è¾“å‡º</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-11-235:~<span class="token operator">|</span>â‡’  perf <span class="token function">stat</span> <span class="token function">htop</span> <span class="token parameter variable">-d</span> <span class="token number">1</span>

 Performance counter stats <span class="token keyword">for</span> <span class="token string">'htop -d 1'</span><span class="token builtin class-name">:</span>

        <span class="token number">181.764747</span>      task-clock <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>         <span class="token comment">#    0.055 CPUs utilized</span>
                <span class="token number">52</span>      context-switches          <span class="token comment">#    0.286 K/sec</span>
                 <span class="token number">0</span>      cpu-migrations            <span class="token comment">#    0.000 K/sec</span>
               <span class="token number">320</span>      page-faults               <span class="token comment">#    0.002 M/sec</span>
   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      cycles
   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      instructions
   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      branches
   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      branch-misses

       <span class="token number">3.283236218</span> seconds <span class="token function">time</span> elapsed

</code></pre>

<h2 id="ä½¿ç”¨perfè®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°æ–‡ä»¶"><a href="#ä½¿ç”¨perfè®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨perfè®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°æ–‡ä»¶"></a>ä½¿ç”¨perfè®°å½•æ€§èƒ½æŒ‡æ ‡åˆ°æ–‡ä»¶</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-41-141 tmp<span class="token punctuation">]</span><span class="token comment"># perf record -F 99 -a -g -p 44551</span>
<span class="token punctuation">[</span>root@ip-172-31-41-141 tmp<span class="token punctuation">]</span><span class="token comment"># sudo perf record -F 99 -a -g -- sleep 60</span>
Warning:
PID/TID switch overriding SYSTEM
^C<span class="token punctuation">[</span> perf record: Woken up <span class="token number">1</span> <span class="token builtin class-name">times</span> to <span class="token function">write</span> data <span class="token punctuation">]</span>
<span class="token punctuation">[</span> perf record: Captured and wrote <span class="token number">0.021</span> MB perf.data <span class="token punctuation">(</span><span class="token number">2</span> samples<span class="token punctuation">)</span> <span class="token punctuation">]</span>
root@ip-172-31-11-235:~<span class="token operator">|</span>â‡’  <span class="token function">sudo</span> perf script <span class="token operator">></span> out.perf</code></pre>

<h2 id="ç”Ÿæˆç«ç„°å›¾"><a href="#ç”Ÿæˆç«ç„°å›¾" class="headerlink" title="ç”Ÿæˆç«ç„°å›¾"></a>ç”Ÿæˆç«ç„°å›¾</h2><p>é€šå¸¸çš„åšæ³•æ˜¯å°† out.perf æ‹·è´åˆ°æœ¬åœ°æœºå™¨ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆç«ç„°å›¾ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> clone <span class="token parameter variable">--depth</span> <span class="token number">1</span> https://github.com/brendangregg/FlameGraph.git
<span class="token comment"># æŠ˜å è°ƒç”¨æ ˆ</span>
$ perf script <span class="token operator">></span> out.perf
$ FlameGraph/stackcollapse-perf.pl out.perf <span class="token operator">></span> out.folded
<span class="token comment"># ç”Ÿæˆç«ç„°å›¾</span>
$ FlameGraph/flamegraph.pl out.folded <span class="token operator">></span> out.svg</code></pre>
<p>ç”Ÿæˆç«ç„°å›¾å¯ä»¥æŒ‡å®šå‚æ•°ï¼Œâ€“width å¯ä»¥æŒ‡å®šå›¾ç‰‡å®½åº¦ï¼Œâ€“height æŒ‡å®šæ¯ä¸€ä¸ªè°ƒç”¨æ ˆçš„é«˜åº¦ï¼Œç”Ÿæˆçš„ç«ç„°å›¾ï¼Œå®½åº¦è¶Šå¤§å°±è¡¨ç¤ºCPUè€—æ—¶è¶Šå¤šã€‚<br>FlameGraph&#x2F;flamegraph.pl &lt; out.profile &gt; out.svg</p>
<p>[root@ip-172-31-18-198 timechart]# perf timechart record -g â€“ curl <a href="http://localhost:19999/">http://localhost:19999</a><br>[root@ip-172-31-18-198 timechart]# perf timechart<br>Written 0.0 seconds of trace to output.svg.</p>
<h2 id="åˆ¶é€ ä¸€ä¸ªDè¿›ç¨‹"><a href="#åˆ¶é€ ä¸€ä¸ªDè¿›ç¨‹" class="headerlink" title="åˆ¶é€ ä¸€ä¸ªDè¿›ç¨‹"></a>åˆ¶é€ ä¸€ä¸ªDè¿›ç¨‹</h2><p>Most proper way is to use freezer cgroup. It puts process to uninterruptible sleep in case of FROZEN cgroup state.</p>
<p>mkdir &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer<br>mount -t cgroup -ofreezer freezer &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer<br>mkdir &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer&#x2F;frozen<br>echo FROZEN &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer&#x2F;frozen&#x2F;freezer.state<br>echo <code>pidof you_process</code> &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer&#x2F;frozen&#x2F;tasks<br>echo <code>pgrep cp</code> &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer&#x2F;frozen&#x2F;tasks<br>echo THAWED &gt; &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer&#x2F;frozen&#x2F;freezer.state</p>
<p>To put again to interruptible sleep, just change cgroup state to THAWED.</p>
<h2 id="åŠ¨æ€è¿½è¸ª"><a href="#åŠ¨æ€è¿½è¸ª" class="headerlink" title="åŠ¨æ€è¿½è¸ª"></a>åŠ¨æ€è¿½è¸ª</h2><ol>
<li>æ·»åŠ ä¸€ä¸ªåŠ¨æ€è¿½è¸ªçš„Tracepoint Event<pre class="language-none"><code class="language-none">perf probe --add&#x3D;&quot;probe:io_schedule_timeout&quot;
perf probe --add&#x3D;&quot;probe:io_schedule_timeout%return&quot;
# ä½¿ç”¨
perf record -e probe:tcp_sendmsg -a -g -- sleep 5
# åˆ†æ
perf report --stdio</code></pre></li>
<li>ç§»é™¤ä¸€ä¸ªåŠ¨æ€è¿½è¸ªçš„Tracepoint Event<pre class="language-none"><code class="language-none">perf probe --del&#x3D;&quot;probe:io_schedule_timeout&quot;
perf probe -d &quot;probe:io_schedule_timeout&quot;</code></pre></li>
<li>åˆ—å‡ºæ‰€æœ‰å­˜åœ¨çš„probe <pre class="language-none"><code class="language-none">perf probe -l</code></pre></li>
<li>æŸ¥çœ‹è¿½è¸ªçš„ç»“æœ<pre class="language-none"><code class="language-none">perf script
perf probe -V tcp_sendmsg # åˆ—å‡ºå¯ç”¨çš„å˜é‡åˆ—è¡¨
perf probe --add &#39;tcp_sendmsg size&#39; # è¿½è¸ªè¿™ä¸ªå˜é‡
# Add a tracepoint for tcp_sendmsg() return, and capture the return value:
perf probe &#39;tcp_sendmsg%return $retval&#39;</code></pre></li>
</ol>
<h2 id="å…³äºOff-cpuè¿›ç¨‹çš„åˆ†æ"><a href="#å…³äºOff-cpuè¿›ç¨‹çš„åˆ†æ" class="headerlink" title="å…³äºOff-cpuè¿›ç¨‹çš„åˆ†æ"></a>å…³äºOff-cpuè¿›ç¨‹çš„åˆ†æ</h2><ol>
<li>æŒ‰æ­¥éª¤ç”Ÿæˆ<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ /usr/share/bcc/tools/offcputime <span class="token parameter variable">-df</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>pgrep <span class="token parameter variable">-nx</span> mysqld<span class="token variable">`</span></span> <span class="token number">30</span> <span class="token operator">></span> out.stacks
<span class="token punctuation">[</span><span class="token punctuation">..</span>.copy out.stacks to your <span class="token builtin class-name">local</span> system <span class="token keyword">if</span> desired<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token punctuation">]</span>$ <span class="token function">git</span> clone https://github.com/brendangregg/FlameGraph
<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> FlameGraph
<span class="token punctuation">]</span>$ ./flamegraph.pl <span class="token parameter variable">--color</span><span class="token operator">=</span>io <span class="token parameter variable">--title</span><span class="token operator">=</span><span class="token string">"Off-CPU Time Flame Graph"</span> <span class="token parameter variable">--countname</span><span class="token operator">=</span>us <span class="token operator">&lt;</span> out.stacks <span class="token operator">></span> out.svg</code></pre></li>
<li>ä¸€æ¡å‘½ä»¤å‡ºå›¾ <pre class="language-none"><code class="language-none">]$ grep do_command &lt; out.stacks | .&#x2F;flamegraph.pl --color&#x3D;io --title&#x3D;&quot;Off-CPU Time Flame Graph&quot; --countname&#x3D;us &gt; out.svg</code></pre></li>
</ol>
<h2 id="Perfå‘½ä»¤çš„å¸¸è§å‚æ•°"><a href="#Perfå‘½ä»¤çš„å¸¸è§å‚æ•°" class="headerlink" title="Perfå‘½ä»¤çš„å¸¸è§å‚æ•°"></a>Perfå‘½ä»¤çš„å¸¸è§å‚æ•°</h2><ol>
<li>å†…æ ¸è®¾ç½®<br>è¦å¯ç”¨å†…æ ¸åŠ¨æ€è¿½è¸ªï¼Œéœ€è¦ä½¿ç”¨å†…æ ¸ç¼–è¯‘å‚æ•°CONFIG_KPROBES&#x3D;yã€CONFIG_KPROBE_EVENTS&#x3D;yã€‚<br>è¦è¿½è¸ªåŸºäºå¸§æŒ‡é’ˆçš„å†…æ ¸æ ˆï¼Œéœ€è¦å†…æ ¸ç¼–è¯‘å‚æ•°CONFIG_FRAME_POINTER&#x3D;yã€‚<br>è¦å¯ç”¨ç”¨æˆ·åŠ¨æ€è¿½è¸ªï¼Œéœ€è¦ä½¿ç”¨å†…æ ¸ç¼–è¯‘å‚æ•°CONFIG_UPROBES&#x3D;yã€CONFIG_UPROBE_EVENTS&#x3D;y</li>
<li>å­å‘½ä»¤åˆ—è¡¨</li>
</ol>
<p>perfæ”¯æŒä¸€ç³»åˆ—çš„å­å‘½ä»¤ï¼š<br>å­å‘½ä»¤ 	è¯´æ˜<br>annotate 	è¯»å–perf.dataå¹¶æ˜¾ç¤ºè¢«æ³¨è§£çš„ä»£ç <br>bench 	åŸºå‡†æµ‹è¯•çš„æ¡†æ¶<br>config 	åœ¨é…ç½®æ–‡ä»¶ä¸­è¯»å†™é…ç½®é¡¹<br>diff 	è¯»å–perf.dataå¹¶æ˜¾ç¤ºå‰–æå·®å¼‚<br>evlist 	åˆ—å‡ºperf.dataä¸­çš„äº‹ä»¶åç§°<br>inject 	ç”¨äºå¢å¼ºäº‹ä»¶æµçš„è¿‡æ»¤å™¨<br>kmem 	è·Ÿè¸ª&#x2F;åº¦é‡å†…æ ¸å†…å­˜å±æ€§<br>kvm 	è·Ÿè¸ª&#x2F;åº¦é‡KVMå®¢æˆ·æœºç³»ç»Ÿ<br>list 	æ˜¾ç¤ºç¬¦å·åŒ–çš„äº‹ä»¶åˆ—è¡¨<br>lock 	åˆ†æé”äº‹ä»¶<br>mem 	åˆ†æå†…å­˜è®¿é—®<br>record 	æ‰§è¡Œå‰–æ<br>report 	æ˜¾ç¤ºå‰–æç»“æœ<br>sched 	åˆ†æè°ƒåº¦å™¨<br>stat 	è·å–æ€§èƒ½è®¡æ•°<br>top 	æ˜¾ç¤ºæˆæœ¬æœ€é«˜çš„æ“ä½œå¹¶åŠ¨æ€åˆ·æ–°<br>trace 	ç±»ä¼¼äºstraceçš„å·¥å…·<br>probe 	å®šä¹‰æ–°çš„åŠ¨æ€è¿½è¸ªç‚¹</p>
<ol start="3">
<li>perrf record å‘½ä»¤å‚æ•° <pre class="language-bash" data-language="bash"><code class="language-bash">--exclude-perf 	ä¸è®°å½•perfè‡ªå·±å‘èµ·çš„äº‹ä»¶
<span class="token parameter variable">-p</span> 	æ”¶é›†æŒ‡å®šè¿›ç¨‹çš„äº‹ä»¶ï¼Œé€—å·åˆ†å‰²çš„PIDåˆ—è¡¨
<span class="token parameter variable">-a</span> 	ä½¿ç”¨Per-CPUæ¨¡å¼ï¼Œå¦‚æœä¸æŒ‡å®š-Cï¼Œåˆ™ç›¸å½“äºå…¨å±€æ¨¡å¼ã€‚å¦‚æœæŒ‡å®š-Cï¼Œåˆ™å¯ä»¥é€‰å®šè‹¥å¹²CPU
<span class="token parameter variable">-g</span> 	è®°å½•è°ƒç”¨æ ˆ
<span class="token parameter variable">-F</span> 	ä»¥æŒ‡å®šçš„é¢‘ç‡å‰–æ
<span class="token parameter variable">-T</span> 	è®°å½•æ ·æœ¬æ—¶é—´æˆ³
<span class="token parameter variable">-s</span> 	è®°å½•æ¯ä¸ªçº¿ç¨‹çš„äº‹ä»¶è®¡æ•°å™¨ï¼Œé…åˆ perf report -Tä½¿ç”¨</code></pre></li>
</ol>
<h1 id="å¾®åŸºå‡†æµ‹è¯•"><a href="#å¾®åŸºå‡†æµ‹è¯•" class="headerlink" title="å¾®åŸºå‡†æµ‹è¯•"></a>å¾®åŸºå‡†æµ‹è¯•</h1><p>From youtube videoï¼š </p>
<pre><code class="bash">root@HaydenArchDesktop /tmp# perf bench sched pipe
# Running &#39;sched/pipe&#39; benchmark:
# Executed 1000000 pipe operations between two processes

     Total time: 2.407 [sec]

       2.407455 usecs/op
         415376 ops/sec


root@HaydenArchDesktop /tmp# taskset -c 0 perf bench sched pipe
# Running &#39;sched/pipe&#39; benchmark:
# Executed 1000000 pipe operations between two processes

     Total time: 2.381 [sec]

       2.381081 usecs/op
         419977 ops/sec
# è¿™é‡Œçš„æ—¶é—´æå‡ä¸æ˜æ˜¾çš„åŸå› æ˜¯ï¼Œ æˆ‘çš„Archlinuxæ˜¯ZenKernelï¼Œ æ„Ÿè§‰å¯èƒ½åœ¨è°ƒåº¦ä¸Šå·²ç»åšäº†ä¸å°‘çš„äº‹æƒ… ï¼Œå¦‚æœéšä¾¿å¯åŠ¨ä¸€ä¸ªredhat , è¿™ä¸ªæŒ‡æ ‡çš„å·®è·ä¼šæ¯”è¾ƒå¤§ã€‚
</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Perf</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸­ä¸€äº›å¸¸è§çš„æ€§èƒ½åˆ†æå‘½ä»¤</title>
    <url>/2021/12/26/Linux/Linux_PerfCommand/</url>
    <content><![CDATA[<p>è®°å½•æ€§èƒ½åˆ†æçš„æ€è·¯ã€‚</p>
<p>æœ€è¿‘çš„è¿™ä¸ªåŠå¹´è¶Šæ¥è¶Šå¥½å¥‡çš„äº‹æƒ…æ˜¯ï¼Œ ä¸ºä»€ä¹ˆå‘½ä»¤ä¼šå¡ä½ï¼Œä¸ºä»€ä¹ˆå‘½ä»¤ä¼šæ‰§è¡Œä¸ä¸‹å»ï¼Œä¸ºä»€ä¹ˆå‘½ä»¤ä¼šç­‰å¾…ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚</p>
<p>é‚£ä¹ˆè¿™äº›é—®é¢˜ï¼Œ æœ‰çš„æ˜¯å¯ä»¥æœ‰ç­”æ¡ˆçš„ï¼Œ ç›®å‰ä¹Ÿä¸çŸ¥é“çš„ã€‚ </p>
<p>å·²ç»å¤§æ¦‚æŒæ¡çš„å‡ ä¸ªä¸åŒçš„æ–¹æ³•ä»¥åŠè§‚æµ‹çš„å·¥å…·ï¼Œ å¤§æ¦‚åšä¸€ä¸ªè®°å½•ã€‚</p>
<h1 id="Straceå‘½ä»¤"><a href="#Straceå‘½ä»¤" class="headerlink" title="Straceå‘½ä»¤"></a>Straceå‘½ä»¤</h1><h2 id="Strace-å‘½ä»¤çš„å¸¸è§ç”¨æ³•"><a href="#Strace-å‘½ä»¤çš„å¸¸è§ç”¨æ³•" class="headerlink" title="Strace å‘½ä»¤çš„å¸¸è§ç”¨æ³•"></a>Strace å‘½ä»¤çš„å¸¸è§ç”¨æ³•</h2><p>straceå‘½ä»¤æ˜¯ç”¨æ¥è¿½è¸ªç³»ç»Ÿè°ƒç”¨çš„ï¼Œå¸¸è§çš„å¯ä»¥è¿½è¸ªçš„ç³»ç»Ÿè°ƒç”¨éœ€è¦é˜…è¯»å†…æ ¸éƒ¨åˆ†çš„ä»£ç ã€‚ ä½†æ˜¯å¸¸è§çš„ç³»ç»Ÿè°ƒç”¨å°±æ˜¯é›†ä¸­ï¼Œ read() , write() , ioctl(), futex() , mmap()<br>å¤§éƒ¨åˆ†çš„æ—¶å€™ æˆ‘ä»¬éƒ½æ˜¯å¯ä»¥è§‚æµ‹åˆ°å¡ä½çš„éƒ¨åˆ†çš„ ï¼Œ è¿™ç§è¿½è¸ªæˆ‘è®¤ä¸ºå¸¸è§çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å‘½ä»¤å¡ä½äº†ï¼Œ æˆ–è€…æ‰§è¡Œä¸­çš„ç¨‹åºå¡ä½äº†ã€‚ </p>
<h3 id="å‘½ä»¤å¡ä½çš„åˆ†æ"><a href="#å‘½ä»¤å¡ä½çš„åˆ†æ" class="headerlink" title="å‘½ä»¤å¡ä½çš„åˆ†æ"></a>å‘½ä»¤å¡ä½çš„åˆ†æ</h3><p>å¯¹äºå‘½ä»¤å¡ä½çš„æƒ…å†µï¼Œ å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºå¦‚ä¸‹çš„å‘½ä»¤ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">strace</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-ttt</span> <span class="token parameter variable">-s</span> <span class="token number">512</span> <span class="token builtin class-name">echo</span> <span class="token string">"123"</span></code></pre>
<p>è¿™æ ·çš„è¯ï¼Œ åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°±å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„å†…å®¹ï¼Œæ¯”å¦‚å¸¸è§çš„å¡åœ¨äº†ç³»ç»Ÿè°ƒç”¨çš„æŸä¸ªå‡½æ•°ä¸Šï¼Œ è¿™ä¸ªå¯ä»¥ç”¨æ¥å®šä½ï¼Œå‘½ä»¤æ‰“å¼€äº†é‚£äº›æ–‡ä»¶ï¼Œç”³è¯·çš„é‚£äº›å†…å­˜åœ°å€ï¼Œæ‰“å¼€äº†ä»€ä¹ˆæ–‡ä»¶ï¼Œå…³é—­Socketç­‰ç­‰ç­‰ç­‰ã€‚<br>ç›®å‰æˆ‘çš„åŠæ³•çš„é€šè¿‡å¯¹æ¯”è¿™ä¸ªå¡ä½çš„å‘½ä»¤æ‰§è¡Œåˆ°ä»€ä¹ˆå‡½æ•°å‡ºç°çš„é—®é¢˜ï¼Œ å¯¹åº”çš„åœ¨æ­£å¸¸çš„æœºå™¨ä¸Šè¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥çŒœåˆ°å¤§æ¦‚çš„é—®é¢˜å‡ºç°åœ¨äº†å“ªé‡Œã€‚</p>
<h3 id="å·²ç»è¿è¡Œä¸­çš„ç¨‹åºåˆ†æ"><a href="#å·²ç»è¿è¡Œä¸­çš„ç¨‹åºåˆ†æ" class="headerlink" title="å·²ç»è¿è¡Œä¸­çš„ç¨‹åºåˆ†æ"></a>å·²ç»è¿è¡Œä¸­çš„ç¨‹åºåˆ†æ</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">strace</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-ttt</span> <span class="token parameter variable">-s</span> <span class="token number">512</span> <span class="token parameter variable">-p</span> <span class="token number">123</span></code></pre>
<p>æ‰§è¡Œè¿›ç¨‹çš„PID ï¼Œ ç„¶åstraceä¼šattachåˆ°è¿›ç¨‹ä¸Šï¼Œ è¾“å‡ºçš„å†…å®¹ï¼Œ ä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°å½“å‰ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚ </p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¦‚ä¸Šé¢çš„ä¸¤ç§æ–¹å¼ï¼Œéƒ½å¯ä»¥å¯¹è¿è¡Œä¸­æ˜æ˜¾çš„é—®é¢˜è¿›è¡Œè§‚å¯Ÿï¼Œ ä½†æ˜¯å¦‚æœæ²¡æœ‰å¡åœ¨ç³»ç»Ÿè°ƒç”¨çš„éƒ¨åˆ†ï¼Œ é€šè¿‡è¿™ä¸ªå‘½ä»¤çš„è§‚å¯Ÿå…¶å®æ˜¯æ— æ³•æŸ¥çœ‹çš„ï¼Œ å› ä¸ºä»–è®°å½•çš„æ˜¯åº”ç”¨ç¨‹åºæŒ‡ä»¤é™·å…¥åˆ°å†…æ ¸æ€çš„éƒ¨åˆ†ï¼Œ ä½†æ˜¯å¸¸è§çš„åº”ç”¨ç¨‹åºåŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨æˆ·æ€çš„ï¼Œæ‰€ä»¥è¿™ä¸ªéƒ¨åˆ†å¦‚æœæ˜¯åº”ç”¨å¡åœ¨ç”¨æˆ·æ€ä¸Šï¼Œ è§‚æµ‹çš„ä¿¡æ¯å°±æ¯”è¾ƒæœ‰é™äº†ã€‚</p>
<h1 id="Perfå‘½ä»¤"><a href="#Perfå‘½ä»¤" class="headerlink" title="Perfå‘½ä»¤"></a>Perfå‘½ä»¤</h1><h2 id="Perfç®€å•çš„åˆ†æ"><a href="#Perfç®€å•çš„åˆ†æ" class="headerlink" title="Perfç®€å•çš„åˆ†æ"></a>Perfç®€å•çš„åˆ†æ</h2><p>perfå‘½ä»¤çš„ç®€å•åˆ†æï¼Œ é¦–å…ˆæ˜¯</p>
<ol>
<li><p>perf top<br>perf top å¯ä»¥ç”¨æ¥å®æ—¶çš„æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„ç›¸å…³é—®é¢˜ï¼Œ æ”¶é›†æŒ‡æ ‡çš„èŒƒå›´æ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ï¼Œ è¾“å‡ºçš„ç»“æœä¹Ÿæ˜¯ç›´æ¥å¯ä»¥æŸ¥çœ‹çš„ï¼Œ çœ‹å®Œäº†ç»“æœæ‰“æ–­å³å¯ã€‚ </p>
</li>
<li><p>perf stat<br>perf stat æŸ¥çœ‹ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªæ ·ä¾‹ï¼Œæä¾›äº†ä¸€äº›é™æ€çš„æŒ‡æ ‡ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> perf <span class="token function">stat</span>
Performance counter stats <span class="token keyword">for</span> <span class="token string">'system wide'</span><span class="token builtin class-name">:</span>
        <span class="token number">61,167</span>.25 msec cpu-clock                 <span class="token comment">#   16.000 CPUs utilized</span>
            <span class="token number">4,955</span>      context-switches          <span class="token comment">#   81.007 /sec</span>
               <span class="token number">63</span>      cpu-migrations            <span class="token comment">#    1.030 /sec</span>
              <span class="token number">930</span>      page-faults               <span class="token comment">#   15.204 /sec</span>
    <span class="token number">6,266</span>,524,215      cycles                    <span class="token comment">#    0.102 GHz                      (83.32%)</span>
      <span class="token number">244,046</span>,608      stalled-cycles-frontend   <span class="token comment">#    3.89% frontend cycles idle     (83.34%)</span>
       <span class="token number">66,809</span>,179      stalled-cycles-backend    <span class="token comment">#    1.07% backend cycles idle      (83.34%)</span>
      <span class="token number">818,170</span>,826      instructions              <span class="token comment">#    0.13  insn per cycle</span>
                                                 <span class="token comment">#    0.30  stalled cycles per insn  (83.34%)</span>
      <span class="token number">155,602</span>,840      branches                  <span class="token comment">#    2.544 M/sec                    (83.34%)</span>
        <span class="token number">1,701</span>,804      branch-misses             <span class="token comment">#    1.09% of all branches          (83.33%)</span>

      <span class="token number">3.823037998</span> seconds <span class="token function">time</span> elapsed</code></pre>
<p>æ˜¾ç¤ºçš„å†…å®¹æ˜¯ä»è¾“å…¥äº†å‘½ä»¤ä¹‹åçš„ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ä¸€äº›CPUç›¸å…³çš„æŒ‡æ ‡ï¼Œ æ¯”å¦‚CPUæ—¶é’Ÿï¼Œä¸Šä¸‹æ–‡äº¤æ¢æ¬¡æ•°ï¼Œcpuè½¬ç§»ï¼Œç¼ºé¡µä¸­æ–­ç­‰ç­‰ç­‰ç­‰ã€‚</p>
</li>
<li><p>perf record<br>perf record æˆ‘å¸¸ç”¨çš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼Œ ä»–ä¼šå°†è®°å½•åˆ°çš„æŒ‡æ ‡è¾“å‡ºåˆ°å½“å‰ç›®å½•çš„æ–‡ä»¶ä¸­ï¼Œç„¶åä¾›reportå‘½ä»¤æ¥è¿›è¡Œåˆ†æï¼Œ è¿™ä¸¤ä¸ªä¸€èˆ¬æ¥è¯´ä¼šåˆç”¨ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">perf record <span class="token parameter variable">-a</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> <span class="token number">1000</span> <span class="token parameter variable">-p</span> <span class="token number">123</span>  
perf record <span class="token parameter variable">-a</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> <span class="token number">1000</span> <span class="token builtin class-name">echo</span> <span class="token number">123</span>
perf record <span class="token parameter variable">-a</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> <span class="token number">1000</span> 
perf record <span class="token parameter variable">-a</span> <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> <span class="token number">1000</span> -- <span class="token function">sleep</span> <span class="token number">60</span> 
ä¸‰ä¸ªå‘½ä»¤ä¼šè®°å½•ç›¸å…³çš„æŒ‡æ ‡åˆ°å½“å‰ç›®å½•çš„perf.dataæ–‡ä»¶ä¸­ã€‚ å¤§å°å’Œé‡‡æ ·çš„é¢‘ç‡ï¼Œæ—¶é—´çš„æ•°é‡æœ‰å…³ã€‚</code></pre></li>
<li><p>perf report<br>perf report æˆ‘æ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°å°±æ˜¯ ä½¿ç”¨ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">perf record <span class="token parameter variable">--stdio</span></code></pre>
<p>æ¥ç›´æ¥è¿›è¡ŒæŸ¥çœ‹ï¼Œ å ç”¨æ—¶é—´ç™¾åˆ†æ¯”æ¯”è¾ƒé«˜çš„å‡½æ•°ï¼Œå‰ææ˜¯ ï¼Œè¿™ä¸ªå‘½ä»¤çš„è¿è¡Œéœ€è¦æœ‰perf.data.</p>
</li>
<li><p>perf sched<br>perf sched é€šå¸¸æ˜¯ç”¨æ¥æŸ¥çœ‹cpuè°ƒåº¦å»¶æ—¶çš„ï¼Œ è¿™ä¸ªç”¨çš„ç¡®å®ä¸å¤šï¼Œ æ¯•ç«Ÿcpuè°ƒåº¦ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯cfqï¼Œ æ”¹çš„äººæ¯•ç«Ÿè¿˜æ˜¯å°‘æ•°ï¼Œ æ‰€ä»¥å®é™…çš„ä½¿ç”¨æ¯”è¾ƒå°‘ã€‚<br>è¿™ä¸ªæŒ‡ä»¤å¸¸ç”¨çš„å¦‚ä¸‹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">perf sched record 
perf sched latency 
perf sched report</code></pre>
<p>ä¸Šé¢çš„è¿™äº›éƒ½æ˜¯æˆ‘æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤ï¼Œ ä¸´æ—¶æŠ“å‡ºæ¥çœ‹ä¸‹ã€‚</p>
</li>
</ol>
<h2 id="Perfå‘½ä»¤è¾“å‡ºç«ç„°å›¾"><a href="#Perfå‘½ä»¤è¾“å‡ºç«ç„°å›¾" class="headerlink" title="Perfå‘½ä»¤è¾“å‡ºç«ç„°å›¾"></a>Perfå‘½ä»¤è¾“å‡ºç«ç„°å›¾</h2><p>perf å‘½ä»¤è¾“å‡ºç«ç„°å›¾éœ€è¦çš„æ˜¯Githubä¸Šé¢çš„ä¸€ä¸ªé¡¹ç›®ï¼Œ è¿™ä¸ªé¡¹ç›®çš„ä½œè€…ä¹Ÿæ˜¯å†™æ€§èƒ½ä¹‹å·…çš„ä½œè€…ã€‚</p>
<p>å…·ä½“çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span> <span class="token number">1</span> https://github.com/brendangregg/FlameGraph.git
<span class="token function">sudo</span> perf script <span class="token operator">></span> out.perf
FlameGraph/stackcollapse-perf.pl out.perf <span class="token operator">></span> out.folded
FlameGraph/flamegraph.pl out.folded <span class="token operator">></span> out.svg</code></pre>
<p>æœ€åè¾“å‡ºçš„out.svgå°±æ˜¯ç»“æœäº†ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æŸ¥çœ‹ã€‚<br>è‡³äºæŸ¥çœ‹çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯çœ‹å‡½æ•°æ‰€å æœ‰çš„é¢ç§¯ï¼Œ é¢ç§¯è¶Šå¤§è¯´æ˜å‡½æ•°è¿è¡Œçš„æ—¶é—´è¶Šé•¿ï¼›<br>é‚£ä¹ˆè¿˜æœ‰è¯´æ³•æ˜¯è¯´ï¼Œ è¶Šé è¿‘é¡¶ç«¯çš„åº”è¯¥è¶Šå°–ï¼Œå¦‚æœæœ‰é¡¶ç«¯æ¯”è¾ƒå¤§çš„å¹³é¡¶è¯´æ˜å¯èƒ½æ˜¯æœ‰é—®é¢˜çš„ï¼Œ è¿™ä¸ªç­”æ¡ˆè¿˜åœ¨æ±‚è¯ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Perf, Strace</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxæ€§èƒ½è°ƒä¼˜ç¬”è®°</title>
    <url>/2020/08/20/Linux/Linux_PerformanceNote/</url>
    <content><![CDATA[<p>åº”è¯¥æ˜¯ä¸€ä¸ªæ€§èƒ½è°ƒä¼˜çš„ä¹¦çš„ç¬”è®°ï¼Œ è®°ä¸æ¸…äº†ï¼Œ å­˜è´§äº†å±äºæ˜¯ã€‚</p>
<h1 id="Linuxçš„æ€§èƒ½è°ƒä¼˜"><a href="#Linuxçš„æ€§èƒ½è°ƒä¼˜" class="headerlink" title="Linuxçš„æ€§èƒ½è°ƒä¼˜"></a>Linuxçš„æ€§èƒ½è°ƒä¼˜</h1><h2 id="CPUæ€§èƒ½é‡Šæ”¾"><a href="#CPUæ€§èƒ½é‡Šæ”¾" class="headerlink" title="CPUæ€§èƒ½é‡Šæ”¾"></a>CPUæ€§èƒ½é‡Šæ”¾</h2><h3 id="Processç”Ÿå‘½å‘¨æœŸ"><a href="#Processç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Processç”Ÿå‘½å‘¨æœŸ"></a>Processç”Ÿå‘½å‘¨æœŸ</h3><ol>
<li>å»ºç«‹ä¸€ä¸ªæ–°çš„è¿›ç¨‹, è¡¨ç¤ºä¸ºçˆ¶è¿›ç¨‹ï¼Œ çˆ¶è¿›ç¨‹è¿›å…¥WaitçŠ¶æ€ã€‚</li>
<li>çˆ¶è¿›ç¨‹Fork()ç³»ç»Ÿè°ƒç”¨å‡ºæ¥çš„ä¸€ä¸ªå­è¿›ç¨‹ã€‚</li>
<li>å­è¿›ç¨‹è°ƒç”¨exec()å¯¹æ“ä½œè¿›è¡Œæ‰§è¡Œã€‚</li>
<li>å­è¿›ç¨‹æ‰§è¡Œç»“æŸé€€å‡ºexit()ã€‚</li>
<li>å­è¿›ç¨‹å˜ä¸ºZombieè¿›ç¨‹ã€‚</li>
<li>ç­‰å¾…çˆ¶è¿›ç¨‹å›æ”¶ï¼Œæ›´æ–°çˆ¶è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚</li>
</ol>
<h3 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h3><p>çº¿ç¨‹æ˜¯å¯ä»¥åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸‹å¹¶å‘æ‰§è¡Œçš„æ‰§è¡Œå•ä½ï¼Œä»–ä»¬å…±äº«ç›¸åŒçš„åœ°å€ï¼Œæ•°æ®å’Œè¿è¡Œç©ºé—´ã€‚çº¿ç¨‹ä¹Ÿå«åšï¼ˆLWPï¼‰ - è½»é‡çš„è¿›ç¨‹ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œè¿›ç¨‹åœ¨åŒä¸€ä¸ªCPUä¸Šä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œä¸”ä¸¤ä¸ªè¿›ç¨‹é—´ä¸æ˜¯å…±äº«èµ„æºçš„æ–¹å¼è¿›è¡Œæ•°æ®å¤„ç†çš„ã€‚å…¶ä»–çš„åœ°æ–¹ï¼Œ è¿›ç¨‹å’Œçº¿ç¨‹å¹¶æ— å¤ªå¤§çš„åŒºåˆ«ï¼ŒLinuxçš„å†…æ ¸å°†ä½¿ç”¨ä¸€ç›´çš„Mannerå¯¹è¿›ç¨‹å’Œçº¿ç¨‹è¿›è¡Œè°ƒåº¦å’Œå¤„ç†ã€‚</p>
<p>There are several thread implementations avaliable in linux operation system.</p>
<ol>
<li><p>Linux threads</p>
<p>ä¼ ç»Ÿçš„Linuxè¿›ç¨‹</p>
</li>
<li><p>Native POSIX thread library</p>
<p>å†…æ ¸ 2.6 ä»¥åç”±çº¢å¸½å¼€å‘çš„è¿›ç¨‹æ¨¡å‹ã€‚</p>
</li>
<li><p>Next Generation POSIX Thread</p>
<p>IBMå¼€å‘çš„æ–°çš„è¿›ç¨‹æ¨¡å‹ã€‚</p>
<p>Noteï¼šLinuxç³»ç»Ÿä¸­çš„<strong>ç¯å¢ƒå˜é‡ LD_ASSUME_KERNEL</strong> ã€‚</p>
</li>
</ol>
<h3 id="è¿›ç¨‹ä¼˜å…ˆçº§"><a href="#è¿›ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="è¿›ç¨‹ä¼˜å…ˆçº§"></a>è¿›ç¨‹ä¼˜å…ˆçº§</h3><ol>
<li>ä¼˜å…ˆçº§(æ§åˆ¶è°ƒåº¦çš„å…ˆåé¡ºåº): ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯ï¼š 0 - 139ã€‚</li>
<li>Niceå€¼(æ§åˆ¶è¿è¡Œæ—¶é—´çš„é•¿çŸ­): æ¯ä¸ªè¿›ç¨‹çš„niceå€¼ï¼Œ19 åˆ° -20 ï¼Œniceå€¼è¶Šå¤§ åˆ†é…çš„æ—¶é—´è¶Šé•¿ã€‚19æœ€ä½ ï¼Œ -20æœ€é«˜ã€‚é»˜è®¤çš„niceå€¼æ˜¯0ã€‚</li>
</ol>
<h3 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨ï¼Œå½“å¤šä¸ªè¿›ç¨‹åœ¨åŒä¸€é¢—CPUåˆ‡æ¢æ—¶ï¼Œå†…æ ¸ä¼šå¯¹è¿›ç¨‹éœ€è¦çš„æ•°æ®ç©ºé—´è¿›è¡Œé‡å®šå‘ï¼Œè¿™ä¸ªè¡Œä¸ºå«åšä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚Context Swtichingï¼Œè´Ÿè´£è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠè°ƒåº¦ã€‚åœ¨å¤šä¸ªè¿›ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œ æ¯æ¬¡åˆ‡æ¢éƒ½ä¼š<strong>è§¦å‘ä¸€æ¬¡ä¸Šä¸‹æ–‡çš„åˆ‡æ¢</strong>ï¼Œæ˜¯å¯¼è‡´æ€§èƒ½ä¸‹é™çš„ä¸»è¦åŸå› ã€‚</p>
<h3 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h3><p>CPUçš„ç»ˆç«¯æ§åˆ¶é€šå¸¸ç”± ç¡¬ä¸­æ–­ å’Œ è½¯ä¸­æ–­ä¸ºä¸»ï¼Œ ç¡¬ä¸­æ–­é€šå¸¸è§äºç¡¬ä»¶è®¾å¤‡ï¼Œé¼ æ ‡é”®ç›˜ç½‘å¡ç¡¬ç›˜è®¾å¤‡ã€‚è½¯ä¸­æ–­å¸¸è§äºTCP&#x2F;IPåè®®æ“ä½œï¼ŒSCSIåè®®æ“ä½œã€‚</p>
<p><strong>Noteï¼š</strong> ä¸­æ–­çš„ä¿¡æ¯æ˜¾ç¤ºåœ¨ï¼š <code>/proc/interrepts</code>ã€‚</p>
<p><strong>Noteï¼š</strong>åœ¨å¤šä¸ªCPUçš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å°†<strong>ä¸­æ–­é›†ä¸­ç»‘å®šåœ¨æŸä¸€é¢—ç‰©ç†çš„CPUä¸Š</strong>ï¼Œå¯ä»¥æœ‰æ•ˆçš„æ”¹å–„ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
<h3 id="è¿›ç¨‹çš„çŠ¶æ€"><a href="#è¿›ç¨‹çš„çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çš„çŠ¶æ€"></a>è¿›ç¨‹çš„çŠ¶æ€</h3><ol>
<li>RUNNINGï¼ˆæ­£å¸¸çš„è¿›ç¨‹ï¼‰</li>
<li>STOPPEDï¼ˆå·²ç»åœæ­¢çš„è¿›ç¨‹ï¼‰</li>
<li>UNINTERREPTIBLEï¼ˆDisk I&#x2F;Oï¼‰</li>
<li>INTERREPTIBLEï¼ˆKeyboard I&#x2F;Oï¼‰</li>
<li>ZOMBIEï¼ˆåªèƒ½é€šè¿‡ç»“æŸæˆ–é‡å¯çˆ¶è¿›ç¨‹æ¥å›æ”¶åƒµå°¸è¿›ç¨‹ï¼‰</li>
</ol>
<h3 id="è¿›ç¨‹çš„å†…å­˜ç©ºé—´"><a href="#è¿›ç¨‹çš„å†…å­˜ç©ºé—´" class="headerlink" title="è¿›ç¨‹çš„å†…å­˜ç©ºé—´"></a>è¿›ç¨‹çš„å†…å­˜ç©ºé—´</h3><p>è¿›ç¨‹çš„å†…å­˜åœ°å€ç©ºé—´ï¼š(ç”±é¡¶è‡³ä½é¡ºåºä¸º)Text Segmentï¼Œ Data Segmentï¼ŒHeap Segmentï¼Œ Stack Segment</p>
<ol>
<li>Text Segment ï¼š å­˜å‚¨è¿›ç¨‹å¯æ‰§è¡Œä»£ç çš„éƒ¨åˆ†ï¼Œåªè¯»æ¨¡å¼ã€‚</li>
<li>Data Segmentï¼š åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†<ul>
<li>Dataï¼š æ•°æ®ç‰‡æ®µï¼Œ åˆå§‹æ•°æ®çš„å­˜å‚¨ï¼Œä¾‹å¦‚é™æ€å˜é‡ã€‚</li>
<li>BSSï¼šå¡«é›¶æ•°æ®çš„å­˜å‚¨ã€‚æ•°æ®åˆå§‹åŒ–ä¸º0ã€‚</li>
<li>Heapï¼ˆå †å†…å­˜ï¼‰ï¼š malloc()æŒ‰éœ€åˆ†é…çš„åŠ¨æ€å†…å­˜ï¼Œå †å†…å­˜å‘æ›´é«˜çš„åœ°å€å‘å±•ã€‚</li>
</ul>
</li>
<li>Stack Segmentï¼š æ ˆå†…å­˜ã€‚å­˜å‚¨æœ¬åœ°å˜é‡ï¼Œ æ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”å›åœ°å€ã€‚æ ˆå†…å­˜å‘æ›´ä½çš„åœ°å€å‘å±•ã€‚</li>
</ol>
<p><strong>NOTEï¼š</strong>å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>pmap</code>æŸ¥çœ‹ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„åœ°å€åˆ†é…æƒ…å†µã€‚å¯ä»¥ä½¿ç”¨<code>ps</code>å‘½ä»¤æŸ¥çœ‹æ€»çš„å†…å­˜åˆ†é…æƒ…å†µã€‚</p>
<h3 id="CPUçš„NUMA-Node"><a href="#CPUçš„NUMA-Node" class="headerlink" title="CPUçš„NUMA Node"></a>CPUçš„NUMA Node</h3><ol>
<li><p>ä¸€é¢—ç‰©ç†CPU 8é€»è¾‘æ ¸ï¼Œä¸¤ä¸ªNUMAèŠ‚ç‚¹ã€‚</p>
</li>
<li><p>4CPUä¸ºä¸€ç»„ï¼Œ åœ¨åŒä¸€ä¸ªNUMAèŠ‚ç‚¹ä¸­ã€‚</p>
</li>
<li><p>HTæŠ€æœ¯æä¾›äº†ä¸€ä¸ªç‰©ç†ä¸¤ä¸ªé€»è¾‘CPUã€‚</p>
<ul>
<li>åœ¨ 1 æƒ…å†µä¸‹ï¼Œä¸€èˆ¬ä¸è§¦å‘è·¨è¶ŠNUMAèŠ‚ç‚¹çš„è´Ÿè½½å‡è¡¡ï¼Œé™¤éå­èŠ‚ç‚¹è¿‡è½½ã€‚</li>
<li>åœ¨ 2 æƒ…å†µä¸‹ï¼Œæä¾›äº†è°ƒåº¦å™¨tickçš„ æ—¶é—´è°ƒåº¦ å’Œ æ—¶é—´ç‰‡ è°ƒåº¦ã€‚</li>
<li>åœ¨ 3 æƒ…å†µä¸‹ï¼Œ æä¾›è°ƒåº¦å™¨tickæ—¶é—´çš„è´Ÿè½½å‡è¡¡è°ƒåº¦ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="å†…å­˜æ€§èƒ½"><a href="#å†…å­˜æ€§èƒ½" class="headerlink" title="å†…å­˜æ€§èƒ½"></a>å†…å­˜æ€§èƒ½</h2><p>Linuxå†…å­˜çš„ç»“æ„</p>
<h3 id="ç‰©ç†å†…å­˜"><a href="#ç‰©ç†å†…å­˜" class="headerlink" title="ç‰©ç†å†…å­˜"></a>ç‰©ç†å†…å­˜</h3><p>ç‰©ç†çš„å†…å­˜çš„åˆ†é…åˆ†åˆ«æœ‰32ä½å’Œ64ä½çš„ä¸åŒï¼Œ</p>
<ul>
<li>32ä½ç³»ç»Ÿä¸­åªèƒ½Linuxå†…æ ¸å¯ä»¥ç›´æ¥ç®¡ç†çš„å†…å­˜ç©ºé—´åªæœ‰ç¬¬ä¸€ä¸ª 1 GBï¼ˆæ‰£é™¤é¢„ç•™çš„éƒ¨åˆ†åªæœ‰896Mï¼‰ ï¼Œ å‰©ä¸‹çš„ç©ºé—´éœ€è¦æ˜ å°„åˆ°å‰é¢çš„1GBç©ºé—´ä¸­ã€‚è¿™ç§æ˜ å°„ä¼šä½¿æ€§èƒ½ä¸‹é™ï¼Œä½†æ˜¯å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´æ˜¯é€æ˜ä¸”æ— æ„Ÿçš„ã€‚</li>
<li>64ä½ç³»ç»Ÿä¸­å°†ZONE-NORMALçš„åŒºåŸŸæ‰©å±•åˆ°äº†64GB - 128GBï¼Œ å°±ä¸éœ€è¦è¿™ç§æ˜ å°„æ“ä½œäº†ã€‚</li>
</ul>
<h3 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h3><p>è™šæ‹Ÿå†…å­˜çš„åœ°å€å¸ƒå±€</p>
<ul>
<li>32ä½æ¶æ„ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜çš„ç©ºé—´æœ€å¤§åªèƒ½æœ‰4GBã€‚å†…å­˜è¢«åˆ†ä¸ºäº† 3GBçš„ç”¨æˆ·ç©ºé—´å’Œ1GBçš„å†…æ ¸ç©ºé—´ã€‚</li>
<li>64ä½æ¶æ„ä¸­å®Œå…¨æ²¡æœ‰è¿™ç§é™åˆ¶ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ä½¿ç”¨å…¨éƒ¨çš„å†…å­˜ç©ºé—´ã€‚</li>
</ul>
<h3 id="è™šæ‹Ÿå†…å­˜çš„ç®¡ç†"><a href="#è™šæ‹Ÿå†…å­˜çš„ç®¡ç†" class="headerlink" title="è™šæ‹Ÿå†…å­˜çš„ç®¡ç†"></a>è™šæ‹Ÿå†…å­˜çš„ç®¡ç†</h3><p>ç‰©ç†å†…å­˜é€šå¸¸å¯¹äºåº”ç”¨æˆ–è€…ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼ŒLinux<strong>å†…æ ¸</strong>ä¼šå°†<strong>ä»»ä½•å†…å­˜è‡ªåŠ¨æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜</strong>ã€‚</p>
<p>åº”ç”¨<strong>ä¸ç›´æ¥ä½¿ç”¨ç‰©ç†å†…å­˜</strong>è€Œæ˜¯å‘å†…æ ¸ç”³è¯·ä¸€ä¸ª<strong>ç¡®åˆ‡ç©ºé—´çš„è™šæ‹Ÿå†…å­˜æ˜ å°„</strong>ï¼Œå¹¶åœ¨è™šæ‹Ÿå†…å­˜ä¸­æ¥æ”¶å¹¶å¤„ç†å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>å¹¶ä¸”ï¼Œ<strong>è™šæ‹Ÿå†…å­˜</strong>ä¸æ˜¯å¿…é¡»æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œè¿˜å¯ä»¥æ˜ å°„åˆ°åœ¨ç¡¬ç›˜å­ç³»ç»Ÿä¸­çš„<strong>Swapæ–‡ä»¶</strong>ã€‚</p>
<p>åº”ç”¨é€šå¸¸ä¹Ÿä¸ç›´æ¥å†™å…¥ç¡¬ç›˜å­ç³»ç»Ÿï¼Œè€Œæ˜¯å†™å…¥æ•°æ®åˆ°Cache&#x2F;Bufferä¸­ã€‚pdflushå†…æ ¸çº¿ç¨‹åœ¨åˆé€‚çš„æ—¶é—´è´Ÿè´£å°†Cacheå’ŒBufferä¸­çš„æ•°æ®åˆ·å†™åˆ°ç¡¬ç›˜ã€‚</p>
<p>Linuxè™šæ‹Ÿå†…å­˜ç®¡ç†å™¨åˆ†é…å…¨éƒ¨çš„æœªä½¿ç”¨è™šæ‹Ÿå†…å­˜ä½œä¸ºç£ç›˜çš„cacheï¼Œå…¶ä»–çš„æ“ä½œç³»ç»Ÿåªä½¿ç”¨å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>åŒæ ·çš„ï¼Œäº¤æ¢çš„ç©ºé—´çš„ç®¡ç†åŒæ ·ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œäº‹å®ä¸Šäº¤æ¢ç©ºé—´å ç”¨ç¨‹åº¦å¹¶ä¸ä»£è¡¨ç³»ç»Ÿçš„ç“¶é¢ˆæ‰€åœ¨ï¼Œç›¸åè¯æ˜äº†linuxç³»ç»Ÿèµ„æºè°ƒåº¦ä¸Šçš„é«˜æ•ˆã€‚</p>
<h3 id="é¡µå¸§çš„åˆ†é…-å†…å­˜åˆ†é¡µ"><a href="#é¡µå¸§çš„åˆ†é…-å†…å­˜åˆ†é¡µ" class="headerlink" title="é¡µå¸§çš„åˆ†é… - å†…å­˜åˆ†é¡µ"></a>é¡µå¸§çš„åˆ†é… - å†…å­˜åˆ†é¡µ</h3><ol>
<li>Page - é¡µæ˜¯åœ¨ç‰©ç†å†…å­˜ï¼ˆPage Frameï¼‰ æˆ–è€… è™šæ‹Ÿå†…å­˜ä¸­çš„è¿ç»­çº¿æ€§åœ°å€ç©ºé—´ã€‚</li>
<li>Linuxé€šè¿‡æ§åˆ¶é¡µå•å…ƒæ¥æ§åˆ¶å†…å­˜çš„åˆ†é…ï¼Œä¸€é¡µçš„å¤§å°æ˜¯ 4Kbã€‚</li>
<li>å†…æ ¸äº†è§£é‚£äº›åˆ†é¡µæ˜¯å¯ç”¨çš„ï¼Œä»¥åŠä»–ä»¬çš„ç¡®åˆ‡ä½ç½®ã€‚</li>
</ol>
<h3 id="Buddy-System"><a href="#Buddy-System" class="headerlink" title="Buddy System"></a>Buddy System</h3><p>Linuxä½¿ç”¨è¿™ç§æœºåˆ¶æ¥è¿›è¡Œç©ºé—²é¡µçš„ç®¡ç†å’Œç»´æŠ¤ï¼Œå¹¶å¯¹ç”³è¯·è¿›è¡Œåˆ†é…ï¼Œå§‹ç»ˆè¯•å›¾ä¿æŒå†…å­˜åˆ†é¡µçš„è¿ç»­æ€§ã€‚å½“å†…å­˜çš„åˆ†é…å¤±è´¥çš„æ—¶å€™ï¼Œä¼šå†…å­˜çš„é¡µå¸§å›æ”¶ã€‚</p>
<h3 id="Page-Frame-Reclaiming"><a href="#Page-Frame-Reclaiming" class="headerlink" title="Page Frame Reclaiming"></a>Page Frame Reclaiming</h3><p>å½“æ‰€æœ‰çš„é¡µå·²ç»å¤„äºä¸å¯ç”¨çš„çŠ¶æ€ï¼ˆunavalibleï¼‰,ä¼šè§¦å‘å†…å­˜çš„å›æ”¶æœºåˆ¶ï¼Œå°†æš‚æ—¶ä¸åœ¨ä½¿ç”¨ä¸­çš„ï¼Œæˆ–è€…åœ¨ä½¿ç”¨ä¸­ä½†æ˜¯ä¼˜å…ˆçº§ä½çš„å†…å­˜é‡æ–°åˆ†é…ï¼Œè¿™ç§æœºåˆ¶å«åšå†…å­˜å›æ”¶ã€‚å†…æ ¸çº¿ç¨‹<code>pswapd</code>å’Œå†…æ ¸å‡½æ•°try_to_free_page()è´Ÿè´£æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œã€‚</p>
<hr>
<h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><p>Linuxå¯ä»¥æ”¯æŒå¤šç§å¤šæ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™å¾—ç›Šäºå†…æ ¸çš„VFSæŠ€æœ¯ï¼ŒVFSæ˜¯ä»‹äºç”¨æˆ·è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„æŠ½è±¡å±‚ã€‚ç”±äºVFSçš„å­˜åœ¨ï¼Œé‚£ä¹ˆç”¨æˆ·è¿›ç¨‹æ— éœ€çŸ¥é“æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ï¼Œå°±å¯ä»¥ç›´æ¥è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨ã€‚</p>
<p>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„æµç¨‹ï¼š</p>
<p>User Process â€“&gt; System Call â€“&gt; VFS â€“&gt; Variety of supported file system</p>
<p>æ—¥å¿—ï¼š</p>
<h3 id="Ext2"><a href="#Ext2" class="headerlink" title="Ext2"></a>Ext2</h3><p>ç®€å•çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ— æ—¥å¿—è®°å½•</p>
<p>Ext2 æ–‡ä»¶ç³»ç»Ÿï¼ˆBlockGroupï¼‰ç»“æ„ï¼š</p>
<ul>
<li><p>SuperBlockï¼š å­˜å‚¨ä¿¡æ¯ï¼Œåœ¨æ¯ä¸€ä¸ªBlockGroupçš„å‰é¢éƒ½æœ‰ä¸€ä¸ªSuperBlockã€‚</p>
</li>
<li><p>BlockGroupDesciptorï¼š å­˜å‚¨BlockGroupçš„ä¿¡æ¯ã€‚</p>
</li>
<li><p>Data Block Bitmapsï¼š ç©ºé—²çš„æ•°æ®å—ç®¡ç†ã€‚</p>
</li>
<li><p>i-node Bitmapï¼š ç©ºé—²çš„Inodeç®¡ç†</p>
</li>
<li><p>i-node Tablesï¼š inodeçš„tableå­˜å‚¨ä½ç½®ã€‚è®°å½•äº†æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š uidï¼Œgid, atime, ctime, mtime, dtime,æŒ‡å‘æ•°æ®å—çš„ä½ç½®ã€‚</p>
</li>
<li><p>Data blocks: å®é™…ç”¨æˆ·æ•°æ®çš„å­˜å‚¨ä½ç½®ã€‚</p>
<p>æ–‡ä»¶ç³»ç»ŸæŸ¥æ‰¾æ–‡ä»¶çš„è¿‡ç¨‹ï¼š å…ˆåœ¨&#x2F;ä¸‹æŸ¥çœ‹inodeä¿¡æ¯ï¼ŒæŸ¥çœ‹æ‰€æ‰¾æ–‡ä»¶çš„ä¿¡æ¯ï¼ŒæŒ‰ç…§è·¯å¾„æŒç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°äº†æ–‡ä»¶çš„inodeä¿¡æ¯ï¼Œé€šè¿‡inodeæä¾›çš„ä¿¡æ¯å»æ•°æ®å—è¯»å–æ•°æ®ã€‚</p>
</li>
</ul>
<h3 id="Ext3"><a href="#Ext3" class="headerlink" title="Ext3"></a>Ext3</h3><p>ext3æ–‡ä»¶ç³»ç»Ÿæ˜¯ext2 çš„å‡çº§ç‰ˆï¼Œä¸»è¦çš„å˜æ›´æ˜¯æ”¯æŒäº†æ–‡ä»¶ç³»ç»Ÿçš„æ—¥å¿—ï¼Œ</p>
<p>ext3æ”¯æŒçš„æ—¥å¿—æ¨¡å¼æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>journal - å…¨é‡è®°å½•ï¼Œæ•°æ®ä¹Ÿå…ƒæ•°æ®éƒ½é€šè¿‡æ—¥å¿—è®°å½•ã€‚</li>
<li>Ordered - åªæœ‰å…ƒæ•°æ®ä¼šè®°å½•æ—¥å¿—ã€‚</li>
<li>Writeback - è®°å½•äº†å…ƒæ•°æ®çš„æ“ä½œï¼Œæ— æ³•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œçªç„¶ç»ˆæ­¢ä¼šå¯¼è‡´æ—§æ•°æ®çš„å‡ºç°ã€‚</li>
</ol>
<h3 id="Xfs"><a href="#Xfs" class="headerlink" title="Xfs"></a>Xfs</h3><p>xfsæ˜¯æ–°ä¸€ä»£çš„æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œæ€§èƒ½å’Œç¨³å®šæ€§éƒ½ä¸é”™ã€‚å…¶ä»–èµ„æ–™å¾…è¡¥å…¨ã€‚</p>
<hr>
<h2 id="IOå­ç³»ç»Ÿ"><a href="#IOå­ç³»ç»Ÿ" class="headerlink" title="IOå­ç³»ç»Ÿ"></a>IOå­ç³»ç»Ÿ</h2><p>è¿›ç¨‹æ˜¯å¦‚ä½•ä½¿ç”¨IOå­ç³»ç»Ÿè¿›è¡Œæ•°æ®äº¤æ¢çš„ï¼Ÿ</p>
<ul>
<li>è¿›ç¨‹é€šè¿‡write()ç³»ç»Ÿè°ƒç”¨ï¼Œè¯·æ±‚ä¸€ä¸ªæ–‡ä»¶çš„å†™å…¥ã€‚</li>
<li>å†…æ ¸æ›´æ–°Pagecacheæ˜ å°„åˆ°æ–‡ä»¶ã€‚</li>
<li>pdflushå†…æ ¸çº¿ç¨‹å¤„ç†pagecacheåˆ°ç¡¬ç›˜ã€‚</li>
<li>æ–‡ä»¶ç³»ç»Ÿå±‚å°†æ¯ä¸ªBlockbufferç»„æˆä¸€ä¸ªBioç»“æ„ï¼Œæäº¤å’Œå†™å…¥åˆ°å—è®¾å¤‡å±‚ã€‚</li>
<li>å—è®¾å¤‡å±‚å¾—åˆ°ä¸Šå±‚çš„è¯·æ±‚ï¼Œæ‰§è¡ŒIOç”µæ¢¯ç®—æ³•æ“ä½œå°†æ•°æ®æ¨å…¥å†™å…¥é˜Ÿåˆ—ã€‚</li>
<li>å­˜å‚¨é©±åŠ¨æ¥ç®¡å¹¶æ‰§è¡Œå†™å…¥ã€‚</li>
<li>ç¡¬ç›˜ç¡¬ä»¶è®¾å¤‡æ‰§è¡Œå†™å…¥åˆ°ç›˜ç‰‡ã€‚</li>
</ul>
<p>å…³äºç¼“å­˜(cache)?</p>
<p>ç”±äºCPUå’Œç¡¬ç›˜çš„é€Ÿåº¦å·®è·å¤ªå¤§ï¼Œå› æ­¤éœ€è¦ç¼“å­˜æ¥è¿›è¡Œä¸´æ—¶çš„æ•°æ®å­˜å‚¨ã€‚</p>
<p>é€Ÿåº¦é€’å‡çš„ç»“æ„æ˜¯ï¼š</p>
<p>CPU â€“&gt; cache â€“&gt; RAM â€“&gt; Disk</p>
<h3 id="å—å±‚-Block-Layer"><a href="#å—å±‚-Block-Layer" class="headerlink" title="å—å±‚ Block Layer"></a>å—å±‚ Block Layer</h3><p>å…³é”®çš„æ•°æ®ç»“æ„å°±æ˜¯bioç»“æ„ï¼Œbioç»“æ„æ˜¯ä¸€ç§æ¥å£ï¼Œå­˜åœ¨äº æ–‡ä»¶ç³»ç»Ÿå±‚ å’Œ å—å±‚ä¹‹é—´ã€‚</p>
<p>bioå°±æ˜¯å°†ç›¸é‚»çš„block bufferå—æ•´åˆåˆ°ä¸€èµ·ï¼Œå‘é€bioåˆ°å—å±‚ã€‚</p>
<h3 id="å—å¤§å°"><a href="#å—å¤§å°" class="headerlink" title="å—å¤§å°"></a>å—å¤§å°</h3><p>ç›´æ¥å½±å“æœåŠ¡å™¨æ€§èƒ½çš„è®¾ç½®ã€‚å¦‚æœéœ€è¦å­˜å‚¨çš„æ–‡ä»¶å°ºå¯¸æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè®¾ç½®å¤§çš„blocksizeæ€§èƒ½æ›´å¥½ã€‚</p>
<h3 id="IOç”µæ¢¯ç®—æ³•"><a href="#IOç”µæ¢¯ç®—æ³•" class="headerlink" title="IOç”µæ¢¯ç®—æ³•"></a>IOç”µæ¢¯ç®—æ³•</h3><ul>
<li>Anticipatory</li>
<li>CFQ</li>
<li>BFQ</li>
<li>Deadline</li>
<li>MQ-deadline</li>
<li>NOOP</li>
<li>NONE</li>
</ul>
<h3 id="å­˜å‚¨é©±åŠ¨"><a href="#å­˜å‚¨é©±åŠ¨" class="headerlink" title="å­˜å‚¨é©±åŠ¨"></a>å­˜å‚¨é©±åŠ¨</h3><ol>
<li>SCSI</li>
<li>RAID</li>
</ol>
<hr>
<h2 id="ç½‘ç»œå­ç³»ç»Ÿ"><a href="#ç½‘ç»œå­ç³»ç»Ÿ" class="headerlink" title="ç½‘ç»œå­ç³»ç»Ÿ"></a>ç½‘ç»œå­ç³»ç»Ÿ</h2><pre class="language-none"><code class="language-none">netstat -n | awk &#39;&#x2F;^tcp&#x2F; &#123;++S[$NF]&#125; END &#123;for (a in S) print a, S[a]&#125;&#39;
# æŸ¥çœ‹æ‰€æœ‰çš„è¿æ¥çŠ¶æ€</code></pre>

<p>å½“ä¸€ä¸ªåº”ç”¨éœ€è¦å‘é€ç½‘ç»œæ•°æ®æµç¨‹ï¼š</p>
<ol>
<li>åº”ç”¨æ‰“åŒ…è‡ªå·±çš„æ•°æ®ã€‚</li>
<li>åº”ç”¨é€šè¿‡å¥—æ¥å­—æ¥å£å†™å…¥æ•°æ®ã€‚</li>
<li>socket bufferç”¨äºå¤„ç†éœ€è¦è¢«å‘é€çš„æ•°æ®ã€‚ç¼“å†²åŒºå¼•ç”¨äº†æ•°æ®ï¼Œå¹¶è´¯ç©¿æ‰€æœ‰çš„å±‚ã€‚</li>
<li>åœ¨æ¯ä¸ªå±‚ä¸­ï¼Œæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚æ•°æ®çš„å°åŒ…ï¼Œæ·»åŠ æ•°æ®çš„æŠ¥æ–‡é¦–éƒ¨ã€‚</li>
<li>ä»ç½‘å¡çš„ç‰©ç†æ¥å£å‘å‡ºã€‚</li>
<li>ä»¥å¤ªç½‘å¸§æŠµè¾¾å¯¹ç«¯çš„ç½‘å¡æ¥å£ã€‚</li>
<li>å¦‚æœMACåœ°å€åŒ¹é…å¯¹ç«¯ç½‘å¡çš„åœ°å€ï¼Œæ•°æ®å¸§ç§»åŠ¨åˆ°ç‰©ç†ç½‘å¡çš„Bufferã€‚</li>
<li>ç§»åŠ¨æ•°æ®åŒ…åˆ°socket bufferä¸­ï¼ŒåŒæ—¶å‘å‡ºä¸€æ¬¡CPUç¡¬ä¸­æ–­ã€‚</li>
<li>æ•°æ®åŒ…é€å±‚è§£åŒ…ï¼Œç›´åˆ°æŠµè¾¾å¯ä»¥è§£é‡Šçš„åº”ç”¨å±‚ã€‚</li>
</ol>
<hr>
<p>é€šè¿‡&#x2F;proc&#x2F;sys&#x2F;netç›®å½•å¯ä»¥è¿›è¡Œç½‘ç»œå­ç³»ç»Ÿçš„è°ƒä¼˜ã€‚</p>
<p>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;rmem_max<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;rmem_default<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;wmem_max<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;wmem_default<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_mem<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_rmem<br>â€‹	&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_wmem</p>
<h3 id="Network-API-NAPI"><a href="#Network-API-NAPI" class="headerlink" title="Network API(NAPI)"></a>Network API(NAPI)</h3><p>NAPIæ˜¯ä¸€ç§æ–°çš„ç½‘ç»œå¤„ç†æ–¹å¼ï¼Œæ¯æ¬¡å¯¹æ•°æ®åŒ…çš„æ“ä½œéƒ½ä¼šè§¦å‘ç³»ç»Ÿä¸­æ–­ï¼Œæ–°çš„æ–¹å¼ä½¿ç”¨çš„æ˜¯pollçš„æ–¹å¼ã€‚</p>
<p>NAPI æ˜¯ Linux ä¸Šé‡‡ç”¨çš„ä¸€ç§æé«˜ç½‘ç»œå¤„ç†æ•ˆç‡çš„æŠ€æœ¯ï¼Œå®ƒçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ä¸é‡‡ç”¨ä¸­æ–­çš„æ–¹å¼è¯»å–æ•°æ®ï¼Œè€Œä»£ä¹‹ä»¥é¦–å…ˆé‡‡ç”¨ä¸­æ–­å”¤é†’æ•°æ®æ¥æ”¶çš„æœåŠ¡ç¨‹åºï¼Œç„¶å POLL çš„æ–¹æ³•æ¥è½®è¯¢æ•°æ®ï¼Œ</p>
<p><a href="https://www.ibm.com/developerworks/cn/linux/l-napi/">https://www.ibm.com/developerworks/cn/linux/l-napi/</a></p>
<h3 id="Netfilter"><a href="#Netfilter" class="headerlink" title="Netfilter"></a>Netfilter</h3><p>Linuxæœ‰ä½¿ç”¨äº†å†…æ ¸çš„Netfilteræ¨¡å—ï¼Œå¯ä»¥é€šè¿‡Iptablesè¿›è¡Œç®¡ç†å’Œæ§åˆ¶ã€‚</p>
<p>Netfilteræä¾›äº†é»˜è®¤çš„é›†ä¸­åŠŸèƒ½ï¼š</p>
<ol>
<li>é€šè¿‡åŒ¹é…è§„åˆ™ï¼Œè¿›è¡Œç½‘ç»œæ•°æ®åŒ…çš„è¿‡æ»¤ã€‚</li>
<li>é€šè¿‡åŒ¹é…è§„åˆ™ï¼Œæä¾›ä¿®æ”¹æ•°æ®åŒ…åœ°å€ä¿¡æ¯ã€‚</li>
</ol>
<hr>
<p>Netfilterå¯ä»¥ä½¿ç”¨çš„è¿‡æ»¤å±æ€§æœ‰ï¼›</p>
<ul>
<li>ô°€  Network interface</li>
<li>ô°€  IP address, IP address range, subnet</li>
<li>ô°€  Protocol</li>
<li>ô°€  ICMP Type</li>
<li>ô°€  Port</li>
<li>ô°€  TCP flag</li>
<li>ô°€  State</li>
</ul>
<hr>
<p>Prerouting â€“ Routing â€“ Forward â€“ Postrouting</p>
<p>â€‹						  -                              -</p>
<p>â€‹           			 Input                     Output</p>
<hr>
<p>Netfilterå¯ä»¥ä½¿ç”¨æ‰§è¡Œçš„æ“ä½œæœ‰ï¼š</p>
<ul>
<li>ACCEPT</li>
<li>DROP</li>
<li>REJECT</li>
<li>LOG</li>
<li>MASQUERADE, SNAT, DNAT, REDIRECT</li>
</ul>
<p>Netfilterå¯ä»¥æ£€æµ‹çš„çŠ¶æ€ï¼›</p>
<ul>
<li><p>NEW</p>
</li>
<li><p>ESTABLISHED</p>
</li>
<li><p>RELATED</p>
</li>
<li><p>INVALID</p>
<p>è¿˜å¯ä»¥å•ç‹¬ä½¿ç”¨ç‹¬ç«‹çš„æ¨¡å—ç”¨æ¥è¿›è¡Œåˆ†æå’Œè¿‡æ»¤ç›¸å…³çš„æ•°æ®åŒ…ã€‚</p>
</li>
</ul>
<h3 id="TCPIP"><a href="#TCPIP" class="headerlink" title="TCPIP"></a>TCPIP</h3><p>connection establishment - è¿æ¥ç»´æŒï¼Œåœ¨åº”ç”¨çš„æ•°æ®è¢«ä¼ é€ä¹‹å‰ï¼ŒTCPä¸€ç›´å±äºç»´æŒçš„çŠ¶æ€ï¼Œåˆ›å»ºè¿æ¥çš„æ—¶å€™å«åšä¸‰æ¬¡æ¡æ‰‹ã€‚æ–­å¼€è¿æ¥çš„æ—¶å€™è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ã€‚</p>
<p>ä¸‰æ¬¡æ¡æ‰‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘å¸ƒSYNæ•°æ®åŒ…ï¼Œè¯·æ±‚å¯¹ç«¯è¿æ¥ã€‚</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°SYNï¼Œå›å¤SYN+ACK</li>
<li>å®¢æˆ·ç«¯å‘å¸ƒACKï¼Œå¼€å§‹ç»´æŒè¿æ¥ã€‚</li>
</ol>
<p>å››æ¬¡æŒ¥æ‰‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ å‘é€ FIN</li>
<li>æœåŠ¡ç«¯å‘é€ACK</li>
<li>æœåŠ¡ç«¯å‘é€ FIN</li>
<li>å®¢æˆ·ç«¯å‘é€ ACK</li>
</ol>
<hr>
<p>TCPIPæµé‡æ§åˆ¶</p>
<ol>
<li>æ»‘åŠ¨çª—å£ï¼š åŒæ–¹åå•†ä¼ è¾“æ•°æ®åŒ…å¤§å°ã€‚</li>
</ol>
<p>è´Ÿè½½</p>
<ol>
<li><p>æ ¡éªŒå’Œoffload</p>
<p>ç”¨äºæ ¡éªŒæ•°æ®çš„å­—æ®µè®¡ç®—çš„è´Ÿè½½ã€‚</p>
</li>
<li><p>TCPæ®µOffloadï¼ˆTSOï¼‰</p>
<p>ç”¨äºè®¡ç®—å¤§äºMTUçš„æ•°æ®åŒ…çš„æ¶ˆè€—ã€‚</p>
</li>
</ol>
<p>ç½‘å¡èšåˆï¼š Bonding module</p>
<p>ç½‘å¡çš„èšåˆå¯ä»¥å°†å¤šä¸ªç½‘å¡ç»‘å®šä¸ºä¸€ä¸ªç‰©ç†ç½‘å¡ä½¿ç”¨ï¼Œ Windowsä¸‹å«åš Teamingã€‚èƒ½å¤Ÿæä¾›æ¯”è¾ƒåˆçº§çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ã€‚<strong>å¯ä»¥ç›´æ¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°ã€‚</strong></p>
<h1 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h1><p>åœ¨è°ƒè¯•ç³»ç»Ÿä¹‹å‰ï¼Œéœ€è¦äº†è§£çš„æ˜¯ç›¸å…³æ€§èƒ½æŒ‡æ ‡çš„å«ä¹‰ï¼Œç”±äºæ˜¯å¼€æºçš„ç³»ç»Ÿï¼Œæ‰€ä»¥å¯ç”¨çš„å·¥å…·å¤šç§å¤šæ ·ï¼Œä½†æ˜¯ç›‘æ§çš„æŒ‡æ ‡æ˜¯ä¸€è‡´çš„ã€‚</p>
<h2 id="CPUæ€§èƒ½æŒ‡æ ‡"><a href="#CPUæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="CPUæ€§èƒ½æŒ‡æ ‡"></a>CPUæ€§èƒ½æŒ‡æ ‡</h2><ul>
<li><p>CPUä½¿ç”¨ç‡ - æ¯ä¸€é¢—å¤„ç†å™¨çš„åˆ©ç”¨ç‡ï¼Œç›´è§‚çš„æŒ‡æ ‡ã€‚</p>
</li>
<li><p>User Timeï¼š CPUè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„æ—¶é—´ï¼ŒåŒ…æ‹¬Nice Timeï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„æ—¶é—´<strong>è¶Šé•¿è¶Šå¥½</strong>ã€‚</p>
</li>
<li><p>System Timeï¼š CPUç”¨äºå¤„ç†å†…æ ¸çº§åˆ«æ“ä½œçš„æ—¶é—´ï¼ŒåŒ…æ‹¬IRQå’ŒSoftirq timeã€‚ç»´æŒåœ¨è¾ƒé«˜çš„æ°´å¹³è¯´æ˜ç³»ç»Ÿçš„ç“¶é¢ˆå¯èƒ½æ˜¯ç½‘ç»œæˆ–è€…é©±åŠ¨æ ˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå†…æ ¸æ—¶é—´<strong>è¶ŠçŸ­è¶Šå¥½</strong>ã€‚</p>
</li>
<li><p>Waitingï¼š ç­‰å¾…IOçš„æ—¶é—´ã€‚ç±»ä¼¼<em>Blocked</em>çš„æ•°å€¼ï¼Œç­‰å¾…çš„æ—¶é—´<strong>è¶ŠçŸ­è¶Šå¥½</strong>ã€‚å¦‚æœå¤ªå¤šæ—¶é—´èŠ±åœ¨ç­‰å¾…IOï¼Œä½ éœ€è¦æ’æŸ¥IOå­ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
</li>
<li><p>Idle Timeï¼š ç³»ç»Ÿçš„ç­‰å¾…ä»»åŠ¡çš„ç©ºé—²æ—¶é—´ï¼Œæè¿°CPUç©ºé—²çš„<strong>ç™¾åˆ†æ¯”</strong>ã€‚</p>
</li>
<li><p>Nice Timeï¼š CPU<strong>ç™¾åˆ†æ¯”</strong>ï¼Œé‡æ–°åˆ†é…è¿›ç¨‹Niceå€¼æ‰€å çš„ç™¾åˆ†æ¯”ã€‚</p>
</li>
<li><p>Load Averageï¼š Rolling average of the sum of the followings: </p>
<ol>
<li>è¿›ç¨‹é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œçš„æ•°é‡ã€‚</li>
<li>ä¸å¯ä¸­æ–­ä»»åŠ¡ç­‰å¾…è¢«å®Œæˆçš„æ•°é‡ã€‚ï¼ˆIOæ“ä½œçš„è¿›ç¨‹ï¼‰</li>
</ol>
</li>
<li><p>Runable Processesï¼šæè¿°å‡†å¤‡æ‰§è¡Œçš„è¿›ç¨‹ï¼Œåœ¨æŒç»­çš„æ—¶é—´ä¸­<strong>ä¸åº”è¯¥è¶…è¿‡ç‰©ç†CPUæ ¸å¿ƒæ•°é‡çš„10å€</strong>ã€‚è¶…è¿‡å°±æ˜¯CPUç“¶é¢ˆã€‚</p>
</li>
<li><p>Blockedï¼š ç­‰å¾…IOå®Œæˆçš„è¿›ç¨‹ï¼Œç›´æ¥æŒ‡å‘IOç“¶é¢ˆã€‚</p>
</li>
<li><p>Context Switchï¼š è¡¨ç¤ºå¤§é‡çš„çº¿ç¨‹åˆ‡æ¢ï¼Œæ•°å€¼è¿‡é«˜ä¸”å¤§é‡ç³»ç»Ÿä¸­æ–­å¯èƒ½ä»£è¡¨äº†<strong>ä¿¡å·é©±åŠ¨æˆ–åº”ç”¨é—®é¢˜</strong>ã€‚è¿™ä¸ªå‚æ•°é€šå¸¸<strong>ä¸æœŸæœ›è¿‡é«˜</strong>ï¼Œå› ä¸ºCPUçš„ç¼“å­˜åº”è¯¥å¯ä»¥å¤„ç†è¿›ç¨‹é—´åˆ‡æ¢çš„æ•°æ®ï¼Œä½†æ˜¯<strong>æŸäº›æ˜¯å¿…è¦çš„</strong>ã€‚</p>
</li>
<li><p>Interruptsï¼š ä¸­æ–­çš„å€¼åŒ…æ‹¬ç¡¬ä¸­æ–­å’Œè½¯ä¸­æ–­ï¼Œç¡¬ä¸­æ–­æ›´ä¸åˆ©äºç³»ç»Ÿçš„æ€§èƒ½é‡Šæ”¾ï¼Œé«˜ä¸­æ–­å€¼æ˜¯<strong>è½¯ä»¶ç“¶é¢ˆ</strong>çš„è¿¹è±¡ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨äº<strong>å†…æ ¸ æˆ– é©±åŠ¨</strong>ã€‚ è¦æ³¨æ„çš„æ˜¯ CPUçš„ä¸­æ–­å€¼å¯èƒ½æ˜¯åŒ…æ‹¬CPUclockå¯¼è‡´çš„ã€‚</p>
</li>
</ul>
<h2 id="å†…å­˜æŒ‡æ ‡"><a href="#å†…å­˜æŒ‡æ ‡" class="headerlink" title="å†…å­˜æŒ‡æ ‡"></a>å†…å­˜æŒ‡æ ‡</h2><ul>
<li><p>Free Memoryï¼š å’Œå…¶ä»–çš„æ“ä½œç³»ç»Ÿæ¥è¿›è¡Œæ¯”è¾ƒï¼ŒLinuxçš„å†…å­˜ä½¿ç”¨é‡ä¸æ˜¯ä¸»è¦çš„å…³å¿ƒæŒ‡æ ‡ï¼Œå› ä¸ºLinuxå†…æ ¸é‡‡ç”¨çš„è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨ï¼Œä¼šå°†æœªä½¿ç”¨çš„å†…å­˜ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„cacheï¼Œæ‰€ä»¥ï¼Œå‡é™¤Bufferså’ŒCacheæ‰æ˜¯çœŸæ­£æœªä½¿ç”¨çš„å†…å­˜é‡ã€‚ Free &#x3D; Used - Buffer - cache</p>
</li>
<li><p>Swap Usageï¼š äº¤æ¢ç©ºé—´çš„ä½¿ç”¨é‡ï¼Œä½¿ç”¨é‡ä¸æ˜¯ä¸»è¦çš„æŒ‡æ ‡ï¼Œç›¸æ¯”è¾ƒæ›´åº”è¯¥æŸ¥çœ‹<strong>Swap IN&#x2F;OUT</strong>ï¼Œæ‰å¯ä»¥çœ‹å‡ºæ˜¯å¦ä¸ºå†…å­˜ç“¶é¢ˆã€‚<strong>æ•°å€¼åœ¨200-300+ page&#x2F;s</strong> å¹¶ä¸”<strong>çŠ¶å†µæŒç»­</strong>æ‰è¯´æ˜æ˜¯å†…å­˜çš„ç“¶é¢ˆã€‚</p>
</li>
<li><p>Buffer and Cache:  Cacheåˆ†é…ç»™æ–‡ä»¶ç³»ç»Ÿå’Œå—è®¾å¤‡ç¼“å­˜ã€‚ï¼Ÿ å—è®¾å¤‡è¢«å†™å…¥ä¹‹å‰å’ŒæˆBioç»“æ„çš„æ—¶å€™ä½¿ç”¨çš„bufferç©ºé—´ï¼Ÿ</p>
</li>
<li><p>Slabsï¼š å†…æ ¸ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å†…æ ¸çš„Pagesä¸èƒ½è¢«Pageoutåˆ°ç¡¬ç›˜ã€‚</p>
</li>
<li><p>Active versus Inactive Memoryï¼š <strong>æä¾›æ•°æ®çš„å†…å­˜ç©ºé—´</strong>å«åšæ´»åŠ¨å†…å­˜ã€‚æœªæ´»åŠ¨çš„å†…å­˜ç±»ä¼¼äºå€™é€‰ï¼Œ<strong>ç­‰å¾…è¢«kswapdè¿›ç¨‹äº¤æ¢åˆ°ç¡¬ç›˜</strong>ã€‚</p>
</li>
</ul>
<h2 id="ç½‘ç»œæŒ‡æ ‡"><a href="#ç½‘ç»œæŒ‡æ ‡" class="headerlink" title="ç½‘ç»œæŒ‡æ ‡"></a>ç½‘ç»œæŒ‡æ ‡</h2><ul>
<li>Packets Received and sent : æ•°æ®åŒ…çš„å‘é€é‡å’Œæ¥æ”¶é‡ã€‚å…³äºç½‘ç»œçš„çŠ¶å†µã€‚</li>
<li>Bytes Received and sentï¼š æ•°æ®å­—èŠ‚æ•°çš„å‘é€é‡å’Œæ¥æ”¶é‡ã€‚</li>
<li>Collisions per secondï¼š æ•°æ®åŒ…å†²çªçš„æ•°é‡ã€‚ä¸€èˆ¬æ¥è®²ä¸æ˜¯æœåŠ¡å™¨çš„é—®é¢˜ï¼Œæ˜¯ç½‘ç»œè®¾å¤‡çš„é—®é¢˜ï¼Œå¸¸è§çš„æ˜¯åœ¨Hubç½‘ç»œä¸­ã€‚</li>
<li>Packets Droppedï¼š å†…æ ¸ä¸¢å¼ƒçš„æ•°æ®åŒ…ï¼Œé€šå¸¸æƒ…å†µä¸‹å’Œé˜²ç«å¢™è§„åˆ™ä»¥åŠç½‘ç»œç¼“å†²åŒºæº¢å‡ºæœ‰å…³ï¼Œé»˜è®¤è¾ƒå°‘ã€‚</li>
<li>Overruns: å±•ç¤ºäº†ç¼“å†²åŒºæº¢å‡ºçš„æ¬¡æ•°ã€‚ ç»“åˆ Packets Droppedæ¥åˆ†æå¯èƒ½çš„ç“¶é¢ˆï¼Œç¼“å†²åŒº æˆ–è€… ç½‘ç»œæ•°æ®é˜Ÿåˆ—é•¿åº¦ã€‚</li>
<li>Errorsï¼š æ•°æ®åŒ…é”™è¯¯ã€‚ç½‘ç»œæ•°æ®æ— æ³•å®Œæˆæ ¡éªŒæˆ–è€…ç½‘çº¿çš„æŸåã€‚</li>
</ul>
<h2 id="å—è®¾å¤‡æŒ‡æ ‡"><a href="#å—è®¾å¤‡æŒ‡æ ‡" class="headerlink" title="å—è®¾å¤‡æŒ‡æ ‡"></a>å—è®¾å¤‡æŒ‡æ ‡</h2><ul>
<li>IOwait ï¼š IOwaitè¡¨ç¤ºCPUåœ¨ç­‰å¾…IOæ“ä½œçš„å®Œæˆï¼Œ<strong>æŒç»­çš„æ•°å€¼åé«˜è¯´æ˜æ˜¯IOçš„ç“¶é¢ˆ</strong>ã€‚</li>
<li>Average queue lengthï¼š å¤§é‡IOè¯·æ±‚æœªå®Œæˆï¼Œé€šå¸¸æƒ…å†µä¸‹<strong>åœ¨ 2 - 3 ä¹‹é—´æ˜¯æœ€ä½³çš„å€¼</strong>ã€‚ å¦‚æœé«˜äºè¯´æ˜æ˜¯IOç“¶é¢ˆã€‚</li>
<li>Average Waitï¼š ä»è¯·æ±‚åˆ°å¾—åˆ°æœåŠ¡çš„å¹³å‡æ—¶é—´ã€‚åŒ…æ‹¬é˜Ÿåˆ—ç­‰å¾…çš„æ—¶é—´å’Œè¯·æ±‚æ‰§è¡Œçš„æ—¶é—´ã€‚</li>
</ul>
<hr>
<h1 id="è§‚å¯Ÿæ€§èƒ½çš„å·¥å…·"><a href="#è§‚å¯Ÿæ€§èƒ½çš„å·¥å…·" class="headerlink" title="è§‚å¯Ÿæ€§èƒ½çš„å·¥å…·"></a>è§‚å¯Ÿæ€§èƒ½çš„å·¥å…·</h1><ol>
<li><p>top</p>
<p>é€šè¿‡topå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹ï¼Œ è§‚å¯Ÿä½¿ç”¨CPUé«˜çš„è¿›ç¨‹ï¼Œå¯ä»¥killå‘½ä»¤åœæ­¢å®ƒï¼›æˆ–è€…è§‚å¯ŸTIMEè¿‡ä½çš„è¿›ç¨‹ï¼Œä½¿ç”¨reniceå‘½ä»¤æé«˜è¿›ç¨‹åœ¨CPUä¸Šçš„è°ƒåº¦æ—¶é—´ã€‚</p>
<p>å¸¸ç”¨çš„å‘½ä»¤ï¼š</p>
<p>t  â€“ æ˜¾ç¤ºSummaryä¿¡æ¯ã€‚å…³é—­æˆ–è€…ä¸åŒçš„é£æ ¼</p>
<p>m â€“ æ˜¾ç¤ºå†…å­˜çš„ä¿¡æ¯ã€‚ å…³é—­æˆ–è€…ä½¿ç”¨ä¸åŒçš„é£æ ¼ã€‚</p>
<p>A â€“ æ˜¾ç¤ºå¤šç§ä¸åŒçš„å‚æ•°æ¥è§‚å¯Ÿè¿›ç¨‹ã€‚ Def ï¼Œ Job ï¼Œ Memï¼Œ Usrï¼Œ å››ä¸ªç»´åº¦ï¼›é»˜è®¤ï¼Œ ä»»åŠ¡ï¼Œå†…å­˜ï¼Œ ç”¨æˆ·ã€‚</p>
<p>f â€“ äº¤äº’å¼é…ç½®ç•Œé¢ã€‚</p>
<p>o â€“ äº¤äº’å¼çš„é€‰æ‹©æ’åºæ–¹å¼ã€‚</p>
<p>r â€“ renice</p>
<p>k â€“ kill</p>
</li>
<li><p>[[Linux_vmstat|Linux_vmstat]]</p>
</li>
<li><p>uptime OR w</p>
<p>è§‚å¯Ÿç³»ç»Ÿçš„è´Ÿè½½çŠ¶å†µå’Œå½“å‰ç™»é™†åˆ°ç³»ç»Ÿçš„ç”¨æˆ·ã€‚ ä¸‰ä¸ªload averageçš„å€¼ï¼Œ1 5 15 åˆ†é’Ÿçš„ç³»ç»Ÿè´Ÿè½½æƒ…å†µï¼Œ ä¸»è¦æ˜¯è§‚å¯ŸçŠ¶å†µï¼Œ å‰é¢ä»‹ç»äº† ï¼Œ è®¡ç®—çš„æ–¹å¼æ˜¯<strong>CPUä»»åŠ¡é˜Ÿåˆ—é•¿åº¦</strong> å’Œ <strong>ä¸å¯ä¸­æ–­è¿›ç¨‹çš„æ•°é‡ï¼ˆIOæ“ä½œçš„å½±å“ï¼‰</strong>ã€‚</p>
</li>
<li><p>ps OR pstree</p>
<p>è§‚å¯Ÿç³»ç»Ÿè¿›ç¨‹çš„åˆ—è¡¨å’Œç³»ç»Ÿè¿›ç¨‹åˆ—è¡¨æ ‘çŠ¶å›¾ã€‚</p>
<p>åœ¨ps -elFLå‘½ä»¤ä¸­ï¼Œæœ‰å‡ ä¸ªä¸å¸¸ç”¨çš„åˆ— ï¼š </p>
<ul>
<li>WCHANï¼š ä¼‘çœ ä¸­çš„è¿›ç¨‹ä½¿ç”¨çš„å†…æ ¸å‡½æ•°åç§°ã€‚ - è¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è¿è¡Œï¼›* è¡¨ç¤ºè¿›ç¨‹æœ‰å¤šçº¿ç¨‹æˆ–è€…psæ— æ³•è¯¦ç»†æ˜¾ç¤ºã€‚</li>
<li>RSS ï¼š å¸¸é©»å†…å­˜é›†ã€‚è¿›ç¨‹ä½¿ç”¨çš„éäº¤æ¢ç‰©ç†å†…å­˜ã€‚å•ä½æ˜¯ï¼š KB</li>
<li>PSRï¼š è¿›ç¨‹è¿è¡Œæ‰€åœ¨çš„CPUç¼–å·ã€‚</li>
</ul>
</li>
<li><p>free</p>
<p>freeå‘½ä»¤æ˜¯æŸ¥çœ‹å†…å­˜çš„è¯¦ç»†ä¿¡æ¯ä½¿ç”¨ã€‚</p>
<p>freeçš„å‘½ä»¤åœ¨æœ€æ–°çš„æ“ä½œç³»ç»Ÿå·²ç»ç›´è§‚çš„æ˜¾ç¤ºå†…å­˜çš„æ¯ä¸ªå‚æ•°åŠç»†èŠ‚ã€‚ç›´æ¥èƒ½çœ‹æ‡‚äº†ï¼Œ è€ç‰ˆæœ¬çœ‹ usedä¸‹çš„Buffer&#x2F;Cacheè¡Œæ•°å€¼ï¼Œå³ä½¿å·²ç»ä½¿ç”¨çš„å†…å­˜ï¼›çœ‹freeä¸‹çš„Memè¡Œï¼Œ å³ä½¿æœªä½¿ç”¨çš„å†…å­˜å€¼ã€‚å…¶ä½™ç›´æ¥æŸ¥çœ‹å³å¯ã€‚</p>
</li>
<li></li>
</ol>
<p>CPUæ•´åˆçš„ä¸åŒæ¶æ„ï¼š</p>
<p>NUMAï¼ŒSMPï¼ŒMPPçš„æ¦‚å¿µï¼š</p>
<p><a href="https://www.cnblogs.com/yubo/archive/2010/04/23/1718810.html">https://www.cnblogs.com/yubo/archive/2010/04/23/1718810.html</a></p>
<h1 id="è°ƒä¼˜æ–¹æ³•"><a href="#è°ƒä¼˜æ–¹æ³•" class="headerlink" title="è°ƒä¼˜æ–¹æ³•"></a>è°ƒä¼˜æ–¹æ³•</h1><h2 id="å®‰è£…çš„è€ƒè™‘"><a href="#å®‰è£…çš„è€ƒè™‘" class="headerlink" title="å®‰è£…çš„è€ƒè™‘"></a>å®‰è£…çš„è€ƒè™‘</h2><p>å®‰è£…ç³»ç»Ÿä¹‹å‰å°±åº”è¯¥è€ƒè™‘åšä»€ä¹ˆä½¿ç”¨ï¼Œ é‡‡ç”¨ä»€ä¹ˆæ ·çš„é…ç½®ï¼ŒCPUï¼ˆæ•°é‡ï¼‰ï¼Œå†…å­˜ï¼ˆå¤§å°ï¼Œ å¤šé€šé“ï¼‰ï¼Œç¡¬ç›˜ï¼ˆå®¹é‡ï¼ŒRAIDï¼‰ï¼Œç½‘ç»œï¼ˆå¸¦å®½ï¼Œæ˜¯å¦èšåˆï¼Œæ˜¯å¦éœ€è¦Bindingï¼‰ç­‰ç­‰é—®é¢˜ã€‚</p>
<p>é€šè¿‡è¿™äº›è€ƒè™‘å¯ä»¥é¿å…å¾ˆå¤šåç»­çš„é—®é¢˜ã€‚</p>
<ol>
<li>æ”¶é›†é…ç½®<ul>
<li>dmesg</li>
<li>ulimit</li>
<li>å…³é—­ä¸ç”¨çš„å®ˆæŠ¤è¿›ç¨‹</li>
<li>æ”¹å˜Runlevel</li>
<li>æ˜¯å¦éœ€è¦SELinux</li>
<li>æ˜¯å¦éœ€è¦ç¼–è¯‘å†…æ ¸</li>
</ul>
</li>
</ol>
<hr>
<h2 id="æ›´æ”¹å†…æ ¸å‚æ•°"><a href="#æ›´æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="æ›´æ”¹å†…æ ¸å‚æ•°"></a>æ›´æ”¹å†…æ ¸å‚æ•°</h2><ol>
<li><p>ç³»ç»Ÿçš„å†…æ ¸å‚æ•°åœ¨&#x2F;proc&#x2F;sysç›®å½•ä¸‹ï¼Œæœ‰å¦‚ä¸‹çš„å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>vm</li>
<li>net</li>
<li>fs</li>
<li>abi</li>
<li>Kernel</li>
</ul>
<p>å¯ä»¥é€šè¿‡sysctlå‘½ä»¤è¿›è¡Œè°ƒèŠ‚ï¼Œ ä¹Ÿå¯ä»¥å†™å…¥é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;sysctl.conf</p>
</li>
</ol>
<h2 id="è¿›ç¨‹å­ç³»ç»Ÿ"><a href="#è¿›ç¨‹å­ç³»ç»Ÿ" class="headerlink" title="è¿›ç¨‹å­ç³»ç»Ÿ"></a>è¿›ç¨‹å­ç³»ç»Ÿ</h2><h3 id="SMTç»“æ„"><a href="#SMTç»“æ„" class="headerlink" title="SMTç»“æ„"></a>SMTç»“æ„</h3><ol>
<li>æ›´æ”¹è¿›ç¨‹çš„ä¼˜å…ˆçº§reniceï¼Œä½¿ä¸šåŠ¡è¿›ç¨‹æ›´å¤šçš„å¾—åˆ°CPU cycleã€‚</li>
<li>å˜æ›´ç³»ç»Ÿçš„ä¸­æ–­å¤„ç†ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å°†ä¸­æ–­ç»‘å®šç»™ä¸€é¢—ç‰©ç†CPUé›†ä¸­å¤„ç†ã€‚è¿˜æœ‰ä¸€ç§æ˜¯è®©ç‰©ç†CPUè‡ªåŠ¨æ§åˆ¶ä¸­æ–­ã€‚</li>
</ol>
<h3 id="NUMAç»“æ„"><a href="#NUMAç»“æ„" class="headerlink" title="NUMAç»“æ„"></a>NUMAç»“æ„</h3><ol>
<li>ä½¿ç”¨numactlè½¯ä»¶åŒ…ä¸­çš„numastatæ¥æŸ¥çœ‹NUMAèŠ‚ç‚¹çš„çŠ¶æ€ã€‚</li>
<li>å¦‚æœnuma_miss çš„æ•°å€¼è¿‡é«˜ï¼Œè€ƒè™‘ä½¿ç”¨NUMAèŠ‚ç‚¹çš„äº²å’Œè°ƒèŠ‚æˆ–è€…reniceè¿›ç¨‹çš„æ•°å€¼ã€‚</li>
<li></li>
</ol>
<h2 id="å†…å­˜å­ç³»ç»Ÿ"><a href="#å†…å­˜å­ç³»ç»Ÿ" class="headerlink" title="å†…å­˜å­ç³»ç»Ÿ"></a>å†…å­˜å­ç³»ç»Ÿ</h2><h3 id="å†…æ ¸è¡Œä¸º"><a href="#å†…æ ¸è¡Œä¸º" class="headerlink" title="å†…æ ¸è¡Œä¸º"></a>å†…æ ¸è¡Œä¸º</h3><ol>
<li><p>vm.swappinessçš„è°ƒæ•´</p>
<p>å†…å­˜äº¤æ¢çš„é¢‘åº¦</p>
<ul>
<li>è®¾ç½®ä¸º0 ï¼Œ å¦‚æœå†…å­˜æ²¡æœ‰è€—å°½å°±ä¸ä½¿ç”¨äº¤æ¢åˆ†åŒºã€‚</li>
<li>è®¾ç½®ä¸º100ï¼Œç§¯æçš„ä½¿ç”¨äº¤æ¢åˆ†åŒºã€‚</li>
</ul>
</li>
<li><p>vm.dirty_background_ratio</p>
<p>è„æ•°æ®å›å†™åˆ°ç¡¬ç›˜çš„æ¯”ä¾‹ï¼ŒæŒ‰ç…§ç™¾åˆ†æ¯”è®¾ç½®ï¼Œè§¦å‘pdflushå†…æ ¸è¿›ç¨‹çš„å›å†™ã€‚</p>
</li>
</ol>
<h3 id="äº¤æ¢åˆ†åŒº"><a href="#äº¤æ¢åˆ†åŒº" class="headerlink" title="äº¤æ¢åˆ†åŒº"></a>äº¤æ¢åˆ†åŒº</h3><p>Linuxæ¨èä½¿ç”¨å¤šä¸ªç¡¬ç›˜ï¼Œæ¯ä¸ªç¡¬ç›˜ä¸Šå»ºç«‹äº¤æ¢åˆ†åŒºï¼ŒLinuxä¼šè‡ªåŠ¨è°ƒåº¦ä¸åŒçš„äº¤æ¢åˆ†åŒºæ¥åˆç†çš„ä½¿ç”¨ç©ºé—´ã€‚å¯ä»¥åœ¨&#x2F;etc&#x2F;fstabæ–‡ä»¶ä¸­è¿›è¡Œäº¤æ¢åˆ†åŒºçš„é…ç½®ï¼Œå¯ä»¥è°ƒæ•´ä¼˜å…ˆçº§ï¼Œä½¿ç³»ç»Ÿä¼˜å…ˆä½¿ç”¨æŸå‡ ä¸ªåˆ†åŒºã€‚ (32767 is the highest and 0 is the lowest).</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/dev/sda2	swap	swap sw 	<span class="token number">0</span> <span class="token number">0</span>
/dev/sdb2	swap	swap sw 	<span class="token number">0</span> <span class="token number">0</span>

/dev/sda2	swap	swap sw,pri<span class="token operator">=</span><span class="token number">1</span> 	<span class="token number">0</span> <span class="token number">0</span>
/dev/sdb2	swap	swap sw,pri<span class="token operator">=</span><span class="token number">3</span> 	<span class="token number">0</span> <span class="token number">0</span></code></pre>

<h3 id="hugeLTBfs"><a href="#hugeLTBfs" class="headerlink" title="hugeLTBfs"></a>hugeLTBfs</h3><p>è¯¥å€¼å¯¹ è™šæ‹Ÿæœº å’Œ æ•°æ®åº“ è¿™ç§éœ€è¦ä½¿ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´çš„åº”ç”¨ æ˜¯éå¸¸æœ‰ç”¨çš„å‚æ•°ã€‚</p>
<p>&#x2F;proc&#x2F;sys&#x2F;vm&#x2F;nr_hugepages è®¾ç½®HugePagesçš„å®¹é‡ã€‚</p>
<p>cat &#x2F;proc&#x2F;meminfo | grep huge  æŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p>å¦‚æœåº”ç”¨éœ€è¦ä½¿ç”¨Hugepageï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½çš„æ–¹å¼ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> <span class="token parameter variable">-t</span> hugetlbfs none /mnt/hugepages</code></pre>

<h2 id="ç¡¬ç›˜å­ç³»ç»Ÿ"><a href="#ç¡¬ç›˜å­ç³»ç»Ÿ" class="headerlink" title="ç¡¬ç›˜å­ç³»ç»Ÿ"></a>ç¡¬ç›˜å­ç³»ç»Ÿ</h2><h3 id="å®‰è£…çš„è€ƒé‡"><a href="#å®‰è£…çš„è€ƒé‡" class="headerlink" title="å®‰è£…çš„è€ƒé‡"></a>å®‰è£…çš„è€ƒé‡</h3><ol>
<li>æ˜¯å¦éœ€è¦Raid ï¼Œå¦‚ä½•ç»„å»ºRaidï¼Œ ç¡¬ä»¶Raidæˆ–è€…è½¯ä»¶Raidã€‚</li>
<li>ç¡¬ç›˜çš„æ€§èƒ½è®¡ç®—ã€‚IOs PerSecond * 4kB &#x3D; 800kB</li>
</ol>
<h3 id="åˆ†åŒºçš„è§„åˆ’"><a href="#åˆ†åŒºçš„è§„åˆ’" class="headerlink" title="åˆ†åŒºçš„è§„åˆ’"></a>åˆ†åŒºçš„è§„åˆ’</h3><p>åˆ†åŒºçš„è§„åˆ’ï¼Œ è§„åˆ™å’Œç»†èŠ‚è§ï¼š FHS</p>
<h3 id="å†…æ ¸è°ƒåº¦ç®—æ³•"><a href="#å†…æ ¸è°ƒåº¦ç®—æ³•" class="headerlink" title="å†…æ ¸è°ƒåº¦ç®—æ³•"></a>å†…æ ¸è°ƒåº¦ç®—æ³•</h3><p>å¸¸è§çš„è°ƒåº¦ç®—æ³•ï¼š</p>
<ul>
<li><p>Anticipatory</p>
</li>
<li><p>CFQ</p>
</li>
<li><p>BFQ</p>
</li>
<li><p>Deadline</p>
</li>
<li><p>MQ-deadline</p>
</li>
<li><p>NOOP</p>
</li>
<li><p>NONE</p>
<p>ç¡¬ç›˜çš„è°ƒåº¦ç®—æ³•å¯ä»¥å•ç‹¬è®¾ç½®æŸä¸ªç¡¬ç›˜ï¼Œä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨çš„å†…æ ¸å‚æ•°é‡è®¾ç½®ã€‚</p>
<p>Cat &#x2F;proc&#x2F;block&#x2F;sda&#x2F;queue&#x2F;schedular æŸ¥çœ‹sdaçš„è°ƒåº¦ç®—æ³•ã€‚</p>
<p>elevator&#x3D;noop åœ¨Grubå¯åŠ¨é…ç½®å†…æ ¸æ–‡ä»¶çš„è¡Œä¸­æ·»åŠ ã€‚</p>
</li>
</ul>
<h3 id="æ–‡ä»¶ç³»ç»Ÿ-1"><a href="#æ–‡ä»¶ç³»ç»Ÿ-1" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h3><ol>
<li><p>æ–‡ä»¶ç³»ç»Ÿçš„æ—¥å¿—è®°å½•æ¨¡å¼</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/dev/sdb1 /testfs ext3 defaults,data<span class="token operator">=</span>writeback <span class="token number">0</span> <span class="token number">0</span></code></pre>
</li>
<li><p>æ–‡ä»¶ç³»ç»Ÿçš„å—å¤§å°</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Perf</tag>
      </tags>
  </entry>
  <entry>
    <title>RDS QPS ä¸‹é™å¼•å‘çš„ç½‘ç»œæµæ§åˆ†æè®°å½•</title>
    <url>/2023/05/09/Linux/Linux_RDS%20QPS%20%E4%B8%8B%E9%99%8D%E5%BC%95%E5%8F%91%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81%E6%8E%A7%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h3 id="Topic-1-ç°è±¡"><a href="#Topic-1-ç°è±¡" class="headerlink" title="Topic 1 ç°è±¡"></a>Topic 1 ç°è±¡</h3><p>çœ‹åˆ°ä¸€ä¸ªæœ‹å‹çš„é—®é¢˜ï¼Œ ç”± RDS QPS ä¸‹é™å¼•å‘çš„ç½‘ç»œé—®é¢˜åˆ†æï¼š </p>
<p>å¼•ç”¨åŸæ–‡çš„é—®é¢˜æè¿°ï¼š</p>
<blockquote>
<p>è¿™ä¸ªé—®é¢˜ä¸€å¼€å§‹æ˜¯åœ¨è¿›è¡ŒRDSå®éªŒçš„æ—¶å€™å‘ç°çš„ã€‚æœ€åˆçš„æƒ…æ™¯æ˜¯ï¼Œå¤šå°æœºå™¨åŒæ—¶å¯¹æ•°æ®åº“è¿›è¡Œselectå’Œinsertæ“ä½œæ—¶ï¼Œä¼šå‘ç°insertæ“ä½œä¼šé€ æˆselectæ“ä½œqpså¤§å¹…ä¸‹é™ï¼Œä¸”insertæ“ä½œç»“æŸä¹‹åselectæ“ä½œçš„qpsä»ä¸èƒ½å›å‡ã€‚èµ·åˆä»¥ä¸ºæ˜¯RDSçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤ç°é—®é¢˜ã€ç›‘æ§RDSä¹‹åå‘ç°RDSçš„å‹åŠ›å…¶å®å¾ˆå°ã€‚äºæ˜¯å¼€å§‹æ€€ç–‘æ˜¯ç½‘ç»œçš„é—®é¢˜ï¼Œåœ¨ç®€åŒ–äº†åœºæ™¯å’Œæ“ä½œä¹‹åï¼Œå‘ç°èƒ½åœ¨è¿‡å»åštcpå®éªŒçš„æœºå™¨ä¸Šå¤ç°ï¼Œäºæ˜¯ç”¨è¿™ä¸ªæ›´ç®€å•çš„åœºæ™¯è¿›è¡Œé—®é¢˜å¤ç°å’Œåˆ†æã€‚</p>
</blockquote>
<p>æ­£ç¡®ç­”æ¡ˆä»¥åŠå¤ç›˜ï¼š <a href="https://yishenggong.com/2023/05/06/why-does-my-network-speed-drop-cn/">https://yishenggong.com/2023/05/06/why-does-my-network-speed-drop-cn/</a></p>
<p>æ„Ÿè°¢å¤§ä½¬<a href="https://twitter.com/plantegg">@plantegg</a> æä¾›çš„è¿™ä¸ªæ¡ˆä¾‹å’Œ<a href="https://public.zsxq.com/groups/15552551584552.html">çŸ¥è¯†æ˜Ÿçƒ</a>ï¼Œ tcpåè®®å’Œ os ç½‘ç»œç³»ç»Ÿçš„åˆ†ææˆ‘ä¹‹å‰çœŸæ˜¯ä¸€å¥éƒ½è¯´ä¸å‡ºæ¥ï¼Œ è¿™æ¬¡ç¡®å®å®Œæ•´çš„èµ°äº†ä¸€éç½‘ç»œçš„éƒ¨åˆ†ã€‚</p>
<hr>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›æ€è·¯å’Œèµ„æ–™æ•´ç†ï¼š </p>
<p>çœ‹å®Œäº†é—®é¢˜çš„æè¿°ï¼Œ æˆ‘åŸºæœ¬ä¸Šå¯ä»¥ç»™å‡ºä¸€ä¸ªç»éªŒçš„åˆ¤æ–­ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯aws t2å®ä¾‹çš„æµæ§ï¼Œ å› ä¸ºè¡¨ç°å’Œä¹‹å‰çš„æµ‹è¯•éå¸¸ä¸€è‡´ï¼Œ ä¸ºäº†ç¡®è®¤è¿™ä¸ªé—®é¢˜æˆ‘åˆè¿›è¡Œäº†ç›¸å…³çš„æµ‹è¯•ï¼ŒåŸºå‡†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p>å®ä¾‹ç±»å‹ï¼št2.micro</p>
<p>å®ä¾‹çš„åŸºå‡†å¸¦å®½: 64Mbps</p>
<p>å®ä¾‹çš„çªå¢å¸¦å®½: 1Gbps</p>
<p>å®ä¾‹çš„EBSè§„æ ¼ï¼š 3000 IOPSï¼Œ 100GBæ ¹å·å­˜å‚¨ï¼Œ 125MiB&#x2F;s</p>
<p>å®ä¾‹çš„OS ï¼š AmazonLinux2023. </p>
<p>Congestion: Cubic</p>
<p>å…·ä½“çš„æµ‹è¯•æ–¹æ³•ï¼š</p>
<ol>
<li>å¯åŠ¨4ä¸ªå®ä¾‹  t2.micro, hostname åˆ†åˆ«æ˜¯ nginx \ client1 \ client2 ï¼Œ æ–¹ä¾¿æµ‹è¯•å’ŒåŒºåˆ†å®ä¾‹ï¼› å¯åŠ¨ä¸€ä¸ªé¢å¤–çš„å®ä¾‹Client3 æ¥å°è¯•éªŒè¯æ˜¯ä¸æ˜¯æµæ§ã€‚</li>
<li>nginxä¸Šé¢å¯åŠ¨ä¸€ä¸ªNginx serverï¼Œ å‘å¸ƒä¸€ä¸ª 2GB å¤§å°çš„æ–‡ä»¶ï¼› Client 1ã€ Client2 ä¸¤ä¸ªå®ä¾‹ä¸Šé¢ä½¿ç”¨curlå‘½ä»¤ä¸‹è½½ã€‚</li>
<li>å°è¯•ä¿æŒè¿™ä¸ªæµé‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œ å¸¦å®½ä¼šè¢«é™åˆ¶åˆ°64 Mbpsã€‚</li>
<li>ç”±äºæ˜¯æµæ§çš„é—®é¢˜ï¼Œ æ‰€ä»¥ç°è±¡ä¼šç¨³å®šå‡ºç°ã€‚</li>
</ol>
<hr>
<p>Summaryï¼š </p>
<p>æˆ‘ç†è§£è¿™ä¸ªåº”è¯¥æ˜¯ä¸€ä¸ªå¯¹tcpæµçš„é™åˆ¶ï¼Œ æ‰€ä»¥éªŒè¯è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯å¯åŠ¨ä¸€ä¸ªiperfçš„æœåŠ¡å¹¶é‡æ–°ç”Ÿæˆæµé‡ï¼Œ å¦‚æœæ˜¯æµæ§çš„è¯ï¼Œ é‚£ä¹ˆæ–°çš„æµé‡åº”è¯¥ä¸å—é™åˆ¶ï¼Œ ç®€å•çš„è¯æ˜æ–¹å¼å°±æ˜¯åœ¨Nginx Serverä¸Šé¢å¯åŠ¨ä¸€ä¸ªIperf3 çš„ Server ï¼Œ ç„¶ååœ¨å‘ç”Ÿé™ä½é€Ÿåº¦çš„æ—¶åˆ»ï¼Œ ä½¿ç”¨ Client3 iperf æµ‹è¯• Nginx Serverï¼Œ è¿™ä¸ªæ—¶å€™è§‚å¯Ÿåˆ°çš„ç°è±¡æ˜¯ä¸¤ä¸ªåŸæœ‰ç½‘ç»œé“¾æ¥çš„é€Ÿåº¦è¿˜æ˜¯å¾ˆä½ï¼Œ ä½†æ˜¯iperf3 çš„æµ‹è¯•ç½‘ç»œååé‡æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</p>
<p>tç³»åˆ—çš„å®ä¾‹éƒ½æ˜¯çªå¢ç±»å‹ï¼Œ å¯ä»¥å…è®¸ä¸€å®šçš„æ—¶é—´ä½¿ç”¨è¶…è¿‡å®ä¾‹åŸºå‡†æ€§èƒ½çš„èµ„æºï¼Œ åœ¨ç½‘ç»œæµé‡è¶…è¿‡åŸºå‡†æ€§èƒ½ä¸€æ®µæ—¶é—´ä¹‹åï¼Œ å®ä¾‹çš„å¸¦å®½ä¼šè¢«é™åˆ¶ã€‚ ä¹‹å‰çœŸçš„ä¸€ç›´éƒ½æ²¡æœ‰æ€è€ƒè¿‡å®ä¾‹çš„å¸¦å®½é™åˆ¶éƒ½æ˜¯æ€ä¹ˆåšçš„ï¼Œ è®©æˆ‘åœ¨æè¿°æ›´å¤šçš„ç»†èŠ‚æˆ‘ä¹Ÿç¡®å®æ— æ³•æä¾›ï¼Œ å€Ÿç€è¿™ä¸ªæœºä¼šï¼Œæ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<hr>
<p>é‡æ–°å¼€å§‹åˆ†æè¿™ä¸ªé—®é¢˜ï¼š </p>
<ol>
<li><p>åˆ†æç½‘ç»œæŠ“åŒ…çœ‹çœ‹ï¼Œè¢«é™é€Ÿçš„æ˜¯Serverçš„å®ä¾‹ï¼Œ æ‰€ä»¥ç›´æ¥çœ‹Serverçš„æŠ“åŒ….</p>
<p>è´´ä¸€ä¸ªæˆ‘è‡ªå·±æŠ“åŒ…æˆªå›¾ï¼Œ<strong>ä¸¤ä¸ªä¸åŒçš„æµ</strong>:</p>
<ul>
<li>Server to Client 1:</li>
</ul>
<p><img src="https://s2.loli.net/2023/05/08/WDAdY2RIxu9lPoF.png" alt="2023-05-08_20-39.png"></p>
<ul>
<li>Server to Client 2:</li>
</ul>
<p><img src="https://s2.loli.net/2023/05/08/WPR62JiBQ4ktlbh.png" alt="2023-05-08_20-39_1.png"></p>
<p>å¯¹ä¸ä¸Šé¢çš„ä¸¤ä¸ªæˆªå›¾æ¥çœ‹ï¼Œ æ–œç‡è¡¨è¶Šå¤§ï¼Œä¸‹è½½é€Ÿåº¦è¶Šå¿«ï¼Œ åœ¨æ–œç‡è¾ƒå¤§çš„å‰åŠæ®µï¼Œ å¹¶æœªå‘ç”Ÿä»»ä½•çš„TCPå¼‚å¸¸ï¼› ååŠæ®µæ–œç‡å˜å°çš„æœŸé—´ï¼Œä¸€ç›´æœ‰è§„å¾‹çš„çº¢è‰²æ ‡è®°ï¼Œ é‚£ä¸ªæ ‡è®°å¯¹åº”åˆ°æŠ“åŒ…çš„ç»“æœä¸­ï¼Œæ˜¯å¿«é€Ÿé‡ä¼ çš„æ•°æ®åŒ…ï¼Œ å¹¶ä¸”å‘ç”Ÿå¿«é€Ÿé‡ä¼ çš„æ—¶é—´æ¯”è¾ƒè§„å¾‹ï¼Œ è¿™ç±»è§„å¾‹çš„å¿«é€Ÿé‡ä¼ å½±å“äº†ä¼ è¾“çš„é€Ÿåº¦ã€‚</p>
</li>
<li><p>æŸ¥çœ‹<strong>RTTçš„å˜åŒ–</strong>ï¼Œ æˆªå›¾å¦‚ä¸‹ï¼š </p>
<p>Server to Client 1: </p>
<p><img src="https://s2.loli.net/2023/05/08/YUZSvzAGq1PwnsF.png" alt="2023-05-08_20-52.png"></p>
<p>Server to Client 2:</p>
<p><img src="https://s2.loli.net/2023/05/08/7TfVQMUIghqarCx.png" alt="2023-05-08_20-52_1.png"></p>
<p>ä¸Šé¢çš„è¿™ä¸ªéƒ¨åˆ†å¯ä»¥çœ‹å‡ºæ•´ä½“å¢å¤§äº†RTT ï¼ŒåŸºäºä¹‹å‰çš„tcæµæ§æµ‹è¯•ï¼Œ<strong>rttå¢å¤§</strong>çš„é“¾è·¯ä¸Šï¼Œ å‘<strong>é€å’Œæ¥æ”¶çš„çª—å£</strong>éœ€è¦ç›¸åº”çš„<strong>å¢å¤§</strong>ï¼Œ æ‰èƒ½ä¿è¯å¸¦å®½çš„åˆ©ç”¨ç‡è¾ƒé«˜ã€‚ æŒ‰ç…§å®éªŒæ›´å¢åŠ  <strong>wmem å’Œ rmem</strong>ï¼Œ ä¸‰ä¸ªå®ä¾‹çš„è®¾ç½®éƒ½å¢åŠ ï¼Œ å¢åŠ ä¹‹åçš„é€Ÿåº¦å¹¶æ²¡æœ‰æ”¹å˜ï¼Œ <strong>ä¾æ—§è¿˜æ˜¯è¢«é™åˆ¶çš„æ°´å¹³</strong>ã€‚RTTä»æŠ“åŒ…çš„ç»“æœä¸Šé¢æ¥çœ‹å°±æ˜¯æœ‰æ˜æ˜¾çš„å˜åŒ–ã€‚</p>
</li>
<li><p>æŸ¥çœ‹Server å®ä¾‹çš„<strong>CWND</strong>ï¼Œ è¿™ä¸ªCWNDçš„è®°å½•ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œçœ‹ï¼š</p>
<p><img src="https://s2.loli.net/2023/05/08/3eGPAKtZ9RdBHUE.png" alt="2023-05-08_16-20.png"></p>
<p>å·¦ä¾§æ˜¯Serverä¸Šé¢çš„å‘½ä»¤è¡Œæ‰§è¡Œç»“æœ å‘½ä»¤æ˜¯ <code>ss -4tni</code> ï¼Œ å‘½ä»¤è¾“å‡ºçš„ç»“æœä¸­ï¼Œ æœ‰å½“å‰çš„TCPé“¾æ¥çš„ RTTï¼Œ CWNDçš„å€¼ï¼Œ å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ åˆ°ä¸¤ä¸ªServerçš„é“¾æ¥ä¸­RTTçš„å€¼ ~60ms å·¦å³ï¼Œ æˆ‘ä½¿ç”¨äº†watch 0.1sæ¥æ‰§è¡Œsså‘½ä»¤å’Œè§‚å¯Ÿï¼Œ é‡ç‚¹å…³æ³¨ä¸Šé¢çš„å‡ ä¸ªå‚æ•°ï¼Œ å¯ä»¥å‘ç°è¿™å‡ ä¸ªæ•°å€¼çš„èŒƒå›´å¦‚ä¸‹ï¼š</p>
<p><strong>RTT</strong> ~ 50ms ~ 70ms ä¹‹é—´å˜åŒ–çš„é¢‘ç‡åŸºæœ¬ä¸Šä¸cwndçš„å˜åŒ–é¢‘ç‡ä¸€è‡´ã€‚</p>
<p><strong>CWND</strong> 40 - 64 ä¹‹é—´å˜åŒ–ï¼Œ åˆ°è¾¾64ä¹‹åå›è½åˆ°40å·¦å³ï¼Œ ç„¶åå¿«é€Ÿæé«˜åˆ°64å†å›è½ã€‚</p>
<p>å¼•ç”¨ä¸€ä¸ªæè¿°æ¯”è¾ƒæ¸…æ™°çš„ä¸­æ–‡æ–‡ç« ï¼Œå…¶ä¸­ä¹Ÿä»‹ç»äº†å¸¸è§çš„å‡ ç§<strong>æ‹¥å¡æ§åˆ¶ç®—æ³•</strong>çš„æ¨¡å¼ï¼Œ å¸®æˆ‘å¤§æ¦‚ç†è§£äº†ä¸‹ç½‘ç»œçš„éƒ¨åˆ†ï¼š </p>
<blockquote>
<p>TCP è¿æ¥å»ºç«‹åå…ˆç»è¿‡ Slow Start é˜¶æ®µï¼Œæ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼ŒCWND ç¿»å€ï¼Œæ•°æ®å‘é€ç‡ä»¥æŒ‡æ•°å½¢å¼å¢é•¿ï¼Œç­‰å‡ºç°ä¸¢åŒ…ï¼Œæˆ–è¾¾åˆ° ssthreshï¼Œæˆ–åˆ°è¾¾æ¥æ”¶æ–¹ RWND é™åˆ¶åè¿›å…¥ Congestion Avoidance é˜¶æ®µã€‚<a href="https://zhuanlan.zhihu.com/p/142618130?utm_id=0">1</a></p>
</blockquote>
<p>ä»å¦ä¸€ä¸ªæ–‡ç« ä¸­æ‰¾åˆ°äº†å¦‚ä¸‹çš„ä¸€ä¸ªå…¬å¼ï¼š </p>
<blockquote>
<p>å› æ­¤æƒ³è¦å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œå¿…é¡»è®©çª—å£å¤§å°æ¥è¿‘ BDP çš„å¤§å°ï¼Œæ‰èƒ½ç¡®ä¿æœ€å¤§ååé‡ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹çš„ä¾‹å­æ¥è®¨è®ºä¸€ä¸‹ï¼Œç©¶ç«Ÿ rwnd å’Œ cwnd çš„å€¼ä¸ç†è®ºæœ€å¤§ä½¿ç”¨å¸¦å®½çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<pre><code>min(cwnd, rwnd) = 16 KB
RTT = 100 ms
16 KB = 16 X 1024 X 8 = 131072 bits
131072 / 0.1 = 1310720 bits/s
1310720 bits/s = 1310720 / 1000000 = 1.31 Mbps
</code></pre>
<p>å› æ­¤ï¼Œæ— è®ºå‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„å®é™…å¸¦å®½ä¸ºå¤šå¤§ï¼Œå½“çª—å£å¤§å°ä¸º 16 KB æ—¶ï¼Œä¼ è¾“é€Ÿç‡æœ€å¤§åªèƒ½ä¸º 1.31 Mbps ã€‚<a href="https://blog.csdn.net/lingshengxiyou/article/details/130210354">2</a></p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„å…¬å¼ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œ åœ¨è®¡ç®—çš„æ—¶å€™ä¼šåœ¨cwndï¼Œ rwnd ä¸¤ä¸ªæŒ‡æ ‡ä¸­<strong>é€‰å–æœ€å°</strong>çš„ç”Ÿæ•ˆï¼Œ é‚£ä¹ˆåŸºäºä¸Šé¢çš„å˜åŠ¨ï¼Œ æˆ‘ä»¬å·²ç»æŠŠwmem ï¼Œ rmem éƒ½æ”¹åˆ°äº†è¾ƒå¤§çš„å€¼ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ—¶å€™è¾ƒå° çš„å°±æ˜¯ cwnd äº†ï¼Œ è¿™ä¸ªå€¼å¢åŠ ä¸ä¸Šå»å°±æ— æ³•å……åˆ†çš„åˆ©ç”¨å¸¦å®½ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å˜æˆäº†ä¸ºä»€ä¹ˆ cwnd æ— æ³•ç»§ç»­å¢é•¿ï¼Ÿ</p>
<blockquote>
<p>Cubic åœ¨ BIC çš„åŸºç¡€ä¸Šï¼Œä¸€ä¸ªæ˜¯é€šè¿‡ä¸‰æ¬¡å‡½æ•°å»å¹³æ»‘ CWND å¢é•¿æ›²çº¿ï¼Œè®©å®ƒåœ¨æ¥è¿‘ä¸Šä¸€ä¸ª  CWND æœ€å¤§å€¼æ—¶ä¿æŒçš„æ—¶é—´æ›´é•¿ä¸€äº›ï¼Œå†æœ‰å°±æ˜¯è®© CWND çš„å¢é•¿å’Œ RTT é•¿çŸ­æ— å…³ï¼Œå³ä¸æ˜¯æ¯æ¬¡ ACK åå°±å»å¢å¤§ CWNDï¼Œè€Œæ˜¯è®©  CWND å¢é•¿çš„ä¸‰æ¬¡å‡½æ•°è·Ÿæ—¶é—´ç›¸å…³ï¼Œä¸ç®¡ RTT å¤šå¤§ï¼Œä¸€å®šæ—¶é—´å CWND ä¸€å®šå¢é•¿åˆ°æŸä¸ªå€¼ï¼Œä»è€Œè®©ç½‘ç»œæ›´å…¬å¹³ï¼ŒRTT å°çš„è¿æ¥ä¸èƒ½æŒ¤å   RTT å¤§çš„è¿æ¥çš„èµ„æºã€‚<a href="https://zhuanlan.zhihu.com/p/142618130?utm_id=0">1</a></p>
</blockquote>
<p>å¦‚æœcwndçš„å¤§å°åœ¨æ‹¥å¡é¿å…ä¹‹åæ˜¯åŸºäºæ—¶é—´æ¥è¿›è¡Œå¢é•¿çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»“åˆä¸Šé¢æˆ‘è§‚å¯Ÿåˆ°çš„ç°è±¡ï¼Œ åŸºæœ¬ä¸Šè¿‡ä¸€æ®µæ—¶é—´å°±ä¼šå‡ºç°ä¸€å®šé‡çš„å¿«é€Ÿé‡ä¼ ï¼ˆæŠ“åŒ…ç»“æœï¼‰ï¼Œ å‘¨æœŸæ€§çš„RTT ä¸ cwndçš„å˜åŒ–ï¼ˆå‘½ä»¤è¾“å‡ºç»“æœï¼‰æ¯”è¾ƒå»åˆäº†ã€‚</p>
<p>åŸºäºä¸Šé¢çš„å‘½ä»¤è¾“å‡ºç»“æœå¯ä»¥è®¤ä¸ºç¡®å®æ˜¯é€šè¿‡RTTçš„å¢åŠ  + ä¸¢åŒ…æ§åˆ¶ CWNDï¼Œ å‹ç€CWNDçš„å€¼ä¸Šä¸å»çš„åŸå› å°±æ˜¯å¿«é€Ÿé‡ä¼ ï¼Œ è®©cwndéšæ—¶é—´å¢å¤§ä¹‹åå¿«é€Ÿé‡ä¼ ï¼Œ ç„¶åè§¦å‘æ‹¥å¡é¿å…ï¼Œ å›é€€åˆ°è¾ƒä½çš„å€¼ï¼Œ ç„¶åå¼€å§‹å¾ªç¯ã€‚</p>
</li>
</ol>
<hr>
<p>æ„Ÿè°¢<a href="https://twitter.com/bnu_chenshuo/status/1654867295452397569">Shuo Chen å’Œ Hao Chen å¤§ä½¬çš„æµ‹è¯•åˆ†ææ€è·¯ä»¥åŠå·¥å…·</a>ï¼Œåå¤çš„ç†è§£è¿™ä¸ªThreadé‡Œé¢çš„è¯´æ³•ï¼Œ ç°åœ¨åŸºæœ¬ä¸Šå¯ä»¥æŠ“ä½è¿™ä¸ªé—®é¢˜çš„é€»è¾‘äº†ã€‚ </p>
<p>èµ°ç€ä¸€åœˆä¹‹åï¼Œ å†™å®Œäº†ä¸Šé¢è‡ªå·±çš„æ€»ç»“ï¼Œ ç°åœ¨å¤åˆ¶å¤§ä½¬çš„ç­”æ¡ˆï¼š </p>
<blockquote>
<p><a href="https://twitter.com/haoel/status/1654654583149563904">@bnu_chenshuo</a> ä»å‘ç”Ÿ retransmit çš„é—´éš”çœ‹ï¼Œå¤ªè§„å¾‹äº†ã€‚æˆ‘ç°åœ¨æ€€ç–‘æ˜¯ aws æœ‰æ„é™é€Ÿï¼Œé€šè¿‡éå¸¸å·§å¦™çš„å°‘é‡ä¸¢åŒ…æˆ–ä¹±åºï¼ˆå›¾ä¸€ä¸­ç²—çº¿ä¸‹æŒ‚çš„å°é»‘ç‚¹ï¼‰ï¼Œå¹¶æ§åˆ¶ RTTï¼Œè®© Linux TCP sender çš„ cwnd é’³åˆ¶åœ¨å‡ å KBï¼ŒRTT åœ¨ 10msï¼Œè¿›è€Œé™åˆ¶ååé‡åœ¨å‡ åƒ KB&#x2F;sã€‚</p>
<p>æˆ‘åœ¨ t3.micro ä¸Šç”¨ FreeBSD 13 å¤ç°ã€‚è§‚å¯Ÿåˆ° AWS å…ˆç”¨å¯¹ä»˜ Linux çš„åŠæ³•ï¼šæ•…æ„ä¸¢åŒ…ä¹±åº + RTT&#x3D;10msï¼Œå‘ç°ä¸çµä¹‹åï¼Œæ¼ç¾æˆæ€’ï¼ŒåŒ…ä¹Ÿä¸ä¸¢äº†ï¼Œç›´æ¥å¡è„–å­ã€‚æ€»ä¹‹å°±æ˜¯ä¸è®©ä½ ç™½å«–ç½‘é€Ÿã€‚å¯¹ Linux æ˜¯æ™ºæ–—ï¼Œæ¯ç§’é’Ÿä¸¢ä½ ä¸€ä¸¤ä¸ªåŒ…ï¼ŒRTT&#x3D;10msï¼Œè®©ä½ è‡ªå·±cwndå°ã€é€Ÿåº¦ä¸Šä¸å»ï¼Œä½ ä¹Ÿä¸å¥½è¯´å•¥ã€‚å¯¹ FreeBSD å°±ä¸Šæ­¦åŠ›äº†ã€‚</p>
</blockquote>
<p>ï¼Ÿï¼Ÿï¼Ÿå¯¹äºæµ‹è¯•çš„ç»“æœï¼Œ æˆ‘è¿™è¾¹ç¡®å®ä¸åŒï¼Œæˆ‘è¯»å–åˆ°çš„RTT 60ms æ˜æ˜¾è¦æ¯”å¤§ä½¬æµ‹è¯•çš„æ—¶å€™çš„RTT 10ms æ›´é«˜. æˆ‘æŠŠè¿™ä¸ªç†è§£ä¸º ä¸­å›½åŒºAWS ä¸ Globalçš„å·®å¼‚ï¼Œ è¿™ä¸ªé—®é¢˜ä¹Ÿè®¸è¿˜èƒ½ç»§ç»­åˆ†æ?</p>
<p>è°ƒæ•´ rmem ï¼Œ wmem çš„å¤§å°åˆ° MTU * CWND &#x3D; 9001 * 60 &#x3D; 540600 ï¼Œè¿™ä¸ªæ•°å€¼x2 è®¾ç½®åˆ°å‘é€å’Œæ¥æ”¶çš„çª—å£ï¼Œ é‡æ–°æŠ“åŒ…ï¼Œ ç†è®ºä¸Šåº”è¯¥çœ‹ä¸åˆ°å¿«é€Ÿé‡ä¼ äº†ã€‚å¹¶ä¸”æ‹¥å¡çª—å£åº”è¯¥æ˜¯ç¨³å®šåœ¨ 60 å·¦å³ã€‚ </p>
<p>æµ‹è¯•çš„è¿‡ç¨‹ä¸­è§‚å¯Ÿï¼Œ è®¾ç½® rmem wmem æœ€ç»ˆçš„å€¼ä¸º 1000000ï¼Œ sså‘½ä»¤ä¸­çš„ CWNDç¨³å®šåœ¨ 57 ï¼Œ æŠ“åŒ…çš„ç»“æœä¸­æ²¡æœ‰å¿«é€Ÿé‡ä¼ ï¼Œ RTTä¹Ÿæ¯”è¾ƒç¨³å®šäº†ï¼Œ ä¸å†æœ‰è·³è·ƒå’Œçªç„¶å¢åŠ åˆ° 100+ çš„RTTï¼Œ é€Ÿåº¦è¿˜æ˜¯è¢«é™åˆ¶äº†ï¼Œ è¿™æ—¶å€™è¾ƒå°çš„æ˜¯ RWNDï¼Œ æ‰€ä»¥ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ CWND å¯ä»¥æ¯”è¾ƒç¨³å®šä¸å†å˜åŒ–çš„åŸå› ã€‚</p>
<p><img src="https://s2.loli.net/2023/05/09/B9y1vpEAQ7nDUrc.png" alt="2023-05-09_15-04_1.png"><br><img src="https://s2.loli.net/2023/05/09/o4SgzJrtXf5wixe.png" alt="2023-05-09_15-04.png"></p>
<h3 id="Topic-2-å¦‚ä½•ä½¿ç”¨wiresharkæŸ¥çœ‹ä¸¢åŒ…ç‡ï¼Ÿ"><a href="#Topic-2-å¦‚ä½•ä½¿ç”¨wiresharkæŸ¥çœ‹ä¸¢åŒ…ç‡ï¼Ÿ" class="headerlink" title="Topic 2 å¦‚ä½•ä½¿ç”¨wiresharkæŸ¥çœ‹ä¸¢åŒ…ç‡ï¼Ÿ"></a>Topic 2 å¦‚ä½•ä½¿ç”¨wiresharkæŸ¥çœ‹ä¸¢åŒ…ç‡ï¼Ÿ</h3><p>å¦‚ä½•æŸ¥çœ‹å®ä¾‹åœ¨é™é€ŸçŠ¶æ€çš„ ä¸¢åŒ…ç‡ å’Œ é‡ä¼ ç‡ï¼Ÿ </p>
<p>åœ¨å®¢æˆ·ç«¯çš„æŠ“åŒ…ç»“æœé‡Œé¢ï¼Œ ä½¿ç”¨å­—æ®µ tcp.stream eq 0 and tcp.analysis.fast_retransmission è°ƒæ•´åˆ°å¯¹åº”çš„ tcp streamï¼Œ ç„¶ååœ¨Conversion</p>
<p>sçª—å£ä¸­ç»Ÿè®¡çš„ Percent Filter é‡Œé¢çš„ç™¾åˆ†æ¯”å°±æ˜¯é‡ä¼ ç‡ï¼Œ ä¸¢åŒ…åº”è¯¥æ˜¯ ï¼š tcp.analysis.lost_segment</p>
<p>æˆ–è€…å°±ç›´æ¥ä½¿ç”¨IO Graphsï¼Œ ç„¶åå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„å›¾åƒï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªä¸¢åŒ…æ¯”è¾ƒå°ï¼Œ æ‰€ä»¥æˆ‘åœ¨Yè½´è®¾ç½® 100 çš„ Factorï¼Œ è¿™æ ·çœ‹èµ·æ¥æ¸…æ¥šäº›ã€‚</p>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://s2.loli.net/2023/05/10/yZ5uCSnvYXi73Be.png" alt="2023-05-10_16-23.png"></p>
<p>åŸºäºè¿™ä¸ªæŠ“åŒ…ç»“æœé‡Œé¢çš„åŸºæœ¬ä¸Šæ˜¯ä¹±åºå’Œå¿«é€Ÿé‡ä¼ ï¼ŒServeræ˜¯å‘é€æ•°æ®çš„æºå¤´ï¼Œ å®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°è®¤ä¸ºè¿™ä¸ªæ˜¯ä¸¢åŒ…ã€‚</p>
<p>é‚£ä¹ˆæ„Ÿè§‰<strong>ä¸¢åŒ…ç‡</strong>çœ‹Clientçš„æŠ“åŒ…ç»“æœåº”è¯¥å°±å¯ä»¥ã€‚ æŸ¥çœ‹<strong>é‡ä¼ ç‡</strong> ä»Serverè¿™æµ‹çš„æŠ“åŒ…ç»“æœæ¥çœ‹ã€‚ </p>
<hr>
<h3 id="Topic-3-RTTçš„å˜é•¿æ˜¯ä¸æ˜¯æµæ§å¯ä»¥è®¾è®¡çš„ï¼Ÿ"><a href="#Topic-3-RTTçš„å˜é•¿æ˜¯ä¸æ˜¯æµæ§å¯ä»¥è®¾è®¡çš„ï¼Ÿ" class="headerlink" title="Topic 3 RTTçš„å˜é•¿æ˜¯ä¸æ˜¯æµæ§å¯ä»¥è®¾è®¡çš„ï¼Ÿ"></a>Topic 3 RTTçš„å˜é•¿æ˜¯ä¸æ˜¯æµæ§å¯ä»¥è®¾è®¡çš„ï¼Ÿ</h3><p>è¿™ä¸ªrttç¡®å®æ— æ³•åŒºåˆ†åˆ°åº•æ˜¯åº•å±‚çš„æµæ§å¸¦æ¥çš„ï¼Œ æˆ–è€…æ˜¯è®¾è®¡æ•…æ„æ‹–é•¿çš„ï¼Œæ›´æ–°é¢å¤–æµ‹è¯•çš„ç»“æœ:</p>
<ol>
<li><p>å°†ä¸‰ä¸ªå®ä¾‹å®Œå…¨æ¢æˆ c5.large,  åç»­æ²¡æœ‰RTTéå¸¸é«˜çš„çš„é—®é¢˜äº†ï¼Œ å¦‚å›¾:</p>
<p><img src="https://s2.loli.net/2023/05/09/2PzAZy7GdYQbxp8.png" alt="2023-05-09_20-24.png"></p>
</li>
<li><p>å°è¯•å¤„ç†æ‰CPU çš„ IOwaitï¼Œ ä¹Ÿå°±æ˜¯å°†è¿™ä¸ªæ–‡ä»¶ç¼©å°åˆ° 500MB ï¼Œä¹‹ånginxçš„æ•°æ®éƒ½ä»å†…å­˜å–å‡ºï¼Œ å‘ç°RTTå¢åŠ åˆ°äº†120msï¼Œ ç»´æŒäº†è¾ƒé•¿çš„æ—¶é—´ä¹‹åè¿˜ä¼šå›åˆ°60msï¼Œ ä¸çŸ¥é“è¿™ä¸ªåŸå› æ˜¯ä»€ä¹ˆï¼Œ ä½†æ˜¯çœ‹èµ·æ¥RTTä¸ç¨³å®šå¯èƒ½ç¡®å®å’Œosæœ¬èº«æ²¡ä»€ä¹ˆå…³ç³»ã€‚</p>
</li>
</ol>
<hr>
<p>è¯•è¯•å…¶ä»–è§„æ ¼çš„å®ä¾‹ï¼š å°è¯•åœ¨c5çš„å®ä¾‹ä¸Šé¢ç›´æ¥ä½¿ç”¨tcå¡ä½ç½‘æ¡¥è®¾å¤‡çš„å¸¦å®½ï¼Œ æ¥æ¨¡æ‹Ÿé“¾è·¯ä¸­çš„ç½‘ç»œè®¾å¤‡ï¼Ÿ è§‚å¯Ÿrttçœ‹çœ‹æ˜¯å¦æœ‰ä»»ä½•çš„å˜åŒ–ã€‚ </p>
<p>æµ‹è¯•çš„æ–¹æ³•ä½¿ç”¨docker-composeå¯åŠ¨ä¸¤ä¸ªpodï¼Œ æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">pod1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> 111.dkr.ecr.cn<span class="token punctuation">-</span>north<span class="token punctuation">-</span>1.amazonaws.com.cn/haydenarchlinux<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">pod2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> 111.dkr.ecr.cn<span class="token punctuation">-</span>north<span class="token punctuation">-</span>1.amazonaws.com.cn/haydenarchlinux<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</code></pre>

<p>åœ¨dockerå®¹å™¨é‡Œé¢æ”¾å…¥ Shuo Chen å¤§ä½¬çš„tcpperfäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åæˆ‘åœ¨pod2é‡Œé¢å¯åŠ¨ <code>-s</code>ï¼Œ  ç„¶ååœ¨brä¸Šé¢åŠ tcæ§åˆ¶å¸¦å®½ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">tc qdisc del dev <span class="token string">"br-9f86ad93edf1"</span> root
tc qdisc <span class="token function">add</span> dev <span class="token string">"br-9f86ad93edf1"</span> root handle <span class="token number">1</span>:0 htb default <span class="token number">1</span>
tc class <span class="token function">add</span> dev <span class="token string">"br-9f86ad93edf1"</span> parent <span class="token number">1</span>:0 classid <span class="token number">1</span>:1 htb rate 64mbit</code></pre>

<p>åœ¨æµ‹è¯•pod1ä¸pod2 çš„å¸¦å®½ï¼Œ ä»–ä»¬çš„é€šä¿¡é€Ÿåº¦éå¸¸å¿«ï¼Œ 10Gçš„æ–‡ä»¶å‡ ç§’å°±å‘é€å®Œäº†ï¼Œ å¹¶ä¸”brä¸Šé¢çš„é™åˆ¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œ æ„Ÿè§‰åº”è¯¥æ˜¯ç›´æ¥èµ°äº†osçš„åè®®æ ˆï¼Œ å…¶ä»–çš„éƒ¨åˆ†éƒ½æ²¡è¿‡ï¼Œ æ‰€ä»¥æ²¡æ³•ç»§ç»­æµ‹è¯•ã€‚ </p>
<p>è½¬è€Œä½¿ç”¨host osä¸Šé¢çš„ tcpperf å»å‘é€æ•°æ®åˆ°å®¹å™¨å†…ï¼Œ å¸¦å®½ç¡®å®è¢«é™åˆ¶äº†ï¼Œ ä½†æ˜¯RTTä¾æ—§å¾ˆä½ã€‚</p>
<p><img src="https://s2.loli.net/2023/05/10/SnGDIEO31YxiMHe.png" alt="2023-05-10_10-47.png"></p>
<p>çœ‹èµ·æ¥æ€è·¯æ˜¯æ²¡é—®é¢˜çš„ï¼Ÿ ä½†æ˜¯å¥½åƒä¹Ÿç¡®å®æ— æ³•è¯æ˜RTTå‡é«˜çš„æœ€ç»ˆåŸå› ã€‚</p>
<hr>
<p>Update 2023-05-10</p>
<p>å¯¹äºè¿™ä¸ªå»¶è¿Ÿæ˜¯ä¸æ˜¯æµæ§æ·»åŠ ä¸Šå»çš„ï¼Œ æˆ‘å¾—åˆ°äº†ä¸¤ä¸ªä¸ä¸€è‡´çš„ç­”æ¡ˆï¼Œ </p>
<p>ä¸€ç§è¯´æ³•æ˜¯ï¼Œ RTTå‡é«˜æ˜¯æµæ§åˆ»æ„ä¸ºä¹‹ï¼Œ ä¸»è¦çš„åŸå› æ˜¯ï¼Œ RTTçš„ç¿»å€é‡çº§æ¯”è¾ƒå¤§ã€‚</p>
<p>å¦ä¸€ä¸ªè¯´æ³•æ˜¯ï¼Œ æ²¡æœ‰ç»™ç½‘ç»œæ·»åŠ å»¶æ—¶ï¼Œ è¿™ä¸ç¬¦åˆé€»è¾‘ï¼Œ RTTå¢é«˜ç¡®å®æ˜¯ä¸åˆç†çš„ç°è±¡ã€‚ </p>
<p><img src="https://s2.loli.net/2023/05/10/v7FPdLZyMkGNjSO.png" alt="2023-05-10_10-53.png"></p>
<hr>
<p>Update 2023-07-04</p>
<p>æˆ‘æœ€åæ‰¾åˆ°äº†åŸå› ï¼Œ åœ¨ENAé©±åŠ¨ç¨‹åºçš„æ–‡æ¡£ä¸­æ˜¯è¿™æ ·æè¿°æµæ§è¿™ä¸ªè¡Œä¸ºçš„ï¼š </p>
<blockquote>
<p>å½“å®ä¾‹çš„ç½‘ç»œæµé‡è¶…è¿‡æœ€å¤§å€¼æ—¶ï¼ŒAWS å°†é€šè¿‡æ’é˜Ÿç„¶åä¸¢å¼ƒç½‘ç»œæ•°æ®åŒ…æ¥è°ƒæ•´è¶…è¿‡æœ€å¤§å€¼çš„æµé‡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç½‘ç»œæ€§èƒ½æŒ‡æ ‡ç›‘æ§æµé‡ä½•æ—¶è¶…è¿‡æœ€å¤§å€¼ã€‚è¿™äº›æŒ‡æ ‡å¯ä»¥å®æ—¶å‘ŠçŸ¥æ‚¨å¯¹ç½‘ç»œæµé‡çš„å½±å“ä»¥åŠå¯èƒ½çš„ç½‘ç»œæ€§èƒ½é—®é¢˜ã€‚</p>
<p><a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/WindowsGuide/monitoring-network-performance-ena.htmlhttps://docs.aws.amazon.com/zh_cn/AWSEC2/latest/WindowsGuide/monitoring-network-performance-ena.html">https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/WindowsGuide/monitoring-network-performance-ena.htmlhttps://docs.aws.amazon.com/zh_cn/AWSEC2/latest/WindowsGuide/monitoring-network-performance-ena.html</a></p>
</blockquote>
<p>åŸºäºä¸Šé¢çš„æè¿°å°±å¯ä»¥ç¡®è®¤ï¼Œ å»¶è¿Ÿé«˜çš„åŸå› æ˜¯ é˜Ÿåˆ— ï¼Œ ä¸¢åŒ…çš„åŸå› æ˜¯æ§åˆ¶æ“ä½œç³»ç»Ÿçš„TCPåè®®ï¼Œ è®© TCP åè®®æ¥éµå®ˆåº•å±‚çš„è§„åˆ™ã€‚ çœ‹åˆ°äº†ç›¸å…³çš„æŒ‡æ ‡ï¼Œ ä¸¤è€…æ˜¯åˆ†å¼€çš„ã€‚ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Database, Kernel, Network</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ_SysVé£æ ¼ç®¡ç†è„šæœ¬æ¨¡æ¿</title>
    <url>/2019/09/23/Linux/Linux_RabbitMQ-Problems/</url>
    <content><![CDATA[<p>éœ€è¦è‡ªå·±å†™ä¸€ä¸ªRabbitMQçš„SysVè„šæœ¬ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ä¸ªæ¨¡æ¿ï¼Œå¦‚æœéœ€è¦çš„æ—¶å€™å¯ä»¥æ”¹æ”¹å°±ç”¨äº†ã€‚</p>
<h2 id="SysVè„šæœ¬"><a href="#SysVè„šæœ¬" class="headerlink" title="SysVè„šæœ¬"></a>SysVè„šæœ¬</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#</span>
<span class="token comment"># rabbitmq-server RabbitMQ broker</span>
<span class="token comment">#</span>
<span class="token comment"># chkconfig: - 80 05</span>
<span class="token comment"># description: Enable AMQP service provided by RabbitMQ</span>
<span class="token comment">#</span>
<span class="token comment">### BEGIN INIT INFO</span>
<span class="token comment"># Provides:          rabbitmq-server</span>
<span class="token comment"># Required-Start:    $remote_fs $network</span>
<span class="token comment"># Required-Stop:     $remote_fs $network</span>
<span class="token comment"># Description:       RabbitMQ broker</span>
<span class="token comment"># Short-Description: Enable AMQP service provided by RabbitMQ broker</span>
<span class="token comment">### END INIT INFO</span>
<span class="token comment"># Source function library.</span>
<span class="token builtin class-name">.</span> /etc/init.d/functions
<span class="token comment"># ä¸€äº›åŠ æ³¨é‡Šçš„ä½ç½®æ˜¯éœ€è¦ä¿®æ”¹çš„å‚æ•°</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/usr/sbin:/bin:/usr/bin:/data/erlang/bin  <span class="token comment"># æ›´æ”¹PATHæŒ‡å‘Erlangçš„è·¯å¾„</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>rabbitmq-server <span class="token comment"># æœåŠ¡çš„åç§°ï¼Œå¯ä»¥å’Œè„šæœ¬åç§°ä¸€è‡´</span>
<span class="token assign-left variable">DAEMON</span><span class="token operator">=</span>/data/rabbitmq_server-3.6.13/sbin/<span class="token variable">$&#123;NAME&#125;</span>	<span class="token comment"># å¯åŠ¨ä¸ºå®ˆæŠ¤è¿›ç¨‹çš„å‘½ä»¤æ‰€åœ¨ç»å¯¹è·¯å¾„</span>
<span class="token assign-left variable">CONTROL</span><span class="token operator">=</span>/data/rabbitmq_server-3.6.13/sbin/rabbitmqctl	<span class="token comment"># åˆ¶å®šrabbitmqctlç¨‹åºçš„æ‰€åœ¨ä½ç½®ï¼Œ ç»å¯¹è·¯å¾„</span>
<span class="token assign-left variable">DESC</span><span class="token operator">=</span>rabbitmq-server	<span class="token comment"># ç›®æ ‡æœåŠ¡</span>
<span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span>root	<span class="token comment"># è¿è¡Œæ—¶çš„ç”¨æˆ·ï¼Œ çº¿ä¸ŠæœåŠ¡éƒ½ä½¿ç”¨äº†rootç”¨æˆ·</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/data/rabbitmq_server-3.6.13/	<span class="token comment"># æŒ‡å®šRabbitMQçš„HOMEç›®å½•ï¼Œé»˜è®¤æ˜¯åœ¨å®‰è£…ç›®å½•ä¸‹ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯åœ¨è¿è¡ŒRabbitMQç”¨æˆ·çš„å®¶ç›®å½•ä¸‹</span>
<span class="token assign-left variable">ROTATE_SUFFIX</span><span class="token operator">=</span>
<span class="token comment"># INIT_LOG_DIR=/usr/local/rabbitmq/var/rabbitmq</span>
<span class="token assign-left variable">INIT_LOG_DIR</span><span class="token operator">=</span>/data/rabbitmq_server-3.6.13/var/log/rabbitmq	<span class="token comment"># æŒ‡å‡ºlogçš„ç›®å½•</span>
<span class="token comment"># PID_FILE=/var/run/rabbitmq/pid	</span>
<span class="token assign-left variable">PDI_FILE</span><span class="token operator">=</span>/data/rabbitmq_server-3.6.13/var/lib/rabbitmq/mnesia/rabbit@ean-online-dubbo-zk-rmq-server-209.pid <span class="token comment"># æŒ‡å‡ºå½“å‰RabbitMQçš„PIDæ–‡ä»¶æ‰€åœ¨ç›®å½•</span>
<span class="token assign-left variable">START_PROG</span><span class="token operator">=</span><span class="token string">"daemon"</span>
<span class="token assign-left variable">LOCK_FILE</span><span class="token operator">=</span>/var/lock/subsys/<span class="token variable">$NAME</span> 
<span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> <span class="token variable">$DAEMON</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> <span class="token variable">$CONTROL</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/default/<span class="token variable">$&#123;NAME&#125;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/default/<span class="token variable">$&#123;NAME&#125;</span>
<span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /etc/sysconfig/<span class="token variable">$&#123;NAME&#125;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> /etc/sysconfig/<span class="token variable">$&#123;NAME&#125;</span>
<span class="token function-name function">ensure_pid_dir</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token assign-left variable">PID_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> $<span class="token punctuation">&#123;</span>PID_FILE<span class="token punctuation">&#125;</span><span class="token variable">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$&#123;PID_DIR&#125;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$&#123;PID_DIR&#125;</span>
        <span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token variable">$&#123;<span class="token environment constant">USER</span>&#125;</span><span class="token builtin class-name">:</span><span class="token variable">$&#123;<span class="token environment constant">USER</span>&#125;</span> <span class="token variable">$&#123;PID_DIR&#125;</span>
        <span class="token function">chmod</span> <span class="token number">755</span> <span class="token variable">$&#123;PID_DIR&#125;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">remove_pid</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$&#123;PID_FILE&#125;</span>
    <span class="token function">rmdir</span> <span class="token variable"><span class="token variable">`</span><span class="token function">dirname</span> $<span class="token punctuation">&#123;</span>PID_FILE<span class="token punctuation">&#125;</span><span class="token variable">`</span></span> <span class="token operator">||</span> <span class="token builtin class-name">:</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">start_rabbitmq</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    status_rabbitmq quiet
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> RabbitMQ is currently running
    <span class="token keyword">else</span>
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">0</span>
        <span class="token comment"># RABBIT_NOFILES_LIMIT from /etc/sysconfig/rabbitmq-server is not handled</span>
        <span class="token comment"># automatically</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$RABBITMQ_NOFILES_LIMIT</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span> <span class="token variable">$RABBITMQ_NOFILES_LIMIT</span>
        <span class="token keyword">fi</span>
        ensure_pid_dir
        <span class="token builtin class-name">set</span> +e
        <span class="token assign-left variable">RABBITMQ_PID_FILE</span><span class="token operator">=</span><span class="token variable">$PID_FILE</span> <span class="token variable">$START_PROG</span> <span class="token variable">$DAEMON</span> <span class="token punctuation">\</span>
            <span class="token operator">></span> <span class="token string">"<span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/startup_log"</span> <span class="token punctuation">\</span>
            <span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">"<span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/startup_err"</span> <span class="token punctuation">\</span>
            <span class="token operator"><span class="token file-descriptor important">0</span>&lt;&amp;</span>- <span class="token operator">&amp;</span>
        <span class="token variable">$CONTROL</span> <span class="token function">wait</span> <span class="token variable">$PID_FILE</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>
        <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
        <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$RETVAL</span>"</span> <span class="token keyword">in</span>
            <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> SUCCESS
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$LOCK_FILE</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                    <span class="token function">touch</span> <span class="token variable">$LOCK_FILE</span>
                <span class="token keyword">fi</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
            *<span class="token punctuation">)</span>
                remove_pid
                <span class="token builtin class-name">echo</span> FAILED - check <span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/startup_<span class="token punctuation">\</span><span class="token punctuation">&#123;</span>log, _err<span class="token punctuation">\</span><span class="token punctuation">&#125;</span>
                <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">1</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">esac</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">stop_rabbitmq</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    status_rabbitmq quiet
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">set</span> +e
        <span class="token variable">$CONTROL</span> stop <span class="token variable">$&#123;PID_FILE&#125;</span> <span class="token operator">></span> <span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/shutdown_log <span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/shutdown_err
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token variable">$?</span>
        <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
            remove_pid
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$LOCK_FILE</span>"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable">$LOCK_FILE</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">else</span>
            <span class="token builtin class-name">echo</span> FAILED - check <span class="token variable">$&#123;INIT_LOG_DIR&#125;</span>/shutdown_log, _err
        <span class="token keyword">fi</span>
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> RabbitMQ is not running
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">status_rabbitmq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">set</span> +e
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">!=</span> <span class="token string">"quiet"</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token variable">$CONTROL</span> status <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
    <span class="token keyword">else</span>
        <span class="token variable">$CONTROL</span> status <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">3</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">rotate_logs_rabbitmq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">set</span> +e
    <span class="token variable">$CONTROL</span> rotate_logs <span class="token variable">$&#123;ROTATE_SUFFIX&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">restart_running_rabbitmq</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    status_rabbitmq quiet
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RETVAL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
        restart_rabbitmq
    <span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> RabbitMQ is not runnning
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>
<span class="token function-name function">restart_rabbitmq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    stop_rabbitmq
    start_rabbitmq
<span class="token punctuation">&#125;</span>
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
    start<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"Starting <span class="token variable">$DESC</span>: "</span>
        start_rabbitmq
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NAME</span>."</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    stop<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"Stopping <span class="token variable">$DESC</span>: "</span>
        stop_rabbitmq
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NAME</span>."</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    status<span class="token punctuation">)</span>
        status_rabbitmq
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    rotate-logs<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"Rotating log files for <span class="token variable">$DESC</span>: "</span>
        rotate_logs_rabbitmq
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    force-reload<span class="token operator">|</span>reload<span class="token operator">|</span>restart<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"Restarting <span class="token variable">$DESC</span>: "</span>
        restart_rabbitmq
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NAME</span>."</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    try-restart<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"Restarting <span class="token variable">$DESC</span>: "</span>
        restart_running_rabbitmq
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NAME</span>."</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> &#123;start|stop|status|rotate-logs|restart|condrestart|try-restart|reload|force-reload&#125;"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span>
        <span class="token assign-left variable">RETVAL</span><span class="token operator">=</span><span class="token number">1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
<span class="token builtin class-name">exit</span> <span class="token variable">$RETVAL</span></code></pre>

<h2 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h2><h3 id="é”™è¯¯1"><a href="#é”™è¯¯1" class="headerlink" title="é”™è¯¯1"></a>é”™è¯¯1</h3><p>åœ¨Workç›®å½•ä¸‹è¿è¡Œè¿™ä¸ªè„šæœ¬çš„æ—¶å€™å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨&#x2F;etc&#x2F;init.d&#x2F;ç›®å½•ä¸‹ä¸æ­£å¸¸ï¼Ÿ æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> rabbitmq-server status  
Status of <span class="token function">node</span> rabbit@<span class="token environment constant">HOSTNAME</span> <span class="token punctuation">..</span>.  
Error: unable to perform an operation on <span class="token function">node</span> <span class="token string">'rabbit@HOSTNAME'</span><span class="token builtin class-name">.</span> Please see diagnostics information and suggestions below.  
  
Most common reasons <span class="token keyword">for</span> this are:  
  
 * Target <span class="token function">node</span> is unreachable <span class="token punctuation">(</span>e.g. due to <span class="token function">hostname</span> resolution, TCP connection or firewall issues<span class="token punctuation">)</span>  
 * CLI tool fails to authenticate with the server <span class="token punctuation">(</span>e.g. due to CLI tool<span class="token string">'s Erlang cookie not matching that of the server)  
 * Target node is not running  
  
In addition to the diagnostics info below:  
  
 * See the CLI, clustering and networking guides on http://rabbitmq.com/documentation.html to learn more  
 * Consult server logs on node rabbit@HOSTNAME 
  
DIAGNOSTICS  
===========  
  
attempted to contact: ['</span>rabbit@<span class="token environment constant">HOSTNAME</span><span class="token string">']  
  
rabbit@HOSTNAME:  
  * connected to epmd (port 4369) on HOSTNAME  
  * epmd reports node '</span>rabbit<span class="token string">' uses port 25672 for inter-node and CLI tool traffic  
  * TCP connection succeeded but Erlang distribution failed  
  
  * Authentication failed (rejected by the remote node), please check the Erlang cookie 
  
  
Current node details:  
 * node name: '</span>rabbitmq@<span class="token environment constant">HOSTNAME</span><span class="token string">'  
 * effective user'</span>s home directory: /data/rabbitmq-<span class="token variable">$version</span>  
 * Erlang cookie hash: fhaluhadgahlfhlashdfag </code></pre>

<p>å› ä¸ºRabbitMQçš„è®¤è¯æ˜¯é€šè¿‡æ–‡ä»¶ ï¼š <code>.erlang.cookie</code>è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶ä¸æ˜¯åœ¨ç³»ç»Ÿçš„ä¸€ä¸ªä½ç½®æœ‰ï¼Œå¦‚æœä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾çš„è¯ä¼šå‘ç°ä¸¤ä¸ªç›®å½•éƒ½æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘çš„æŸ¥æ‰¾ç»“æœä¸€ä¸ªæ˜¯åœ¨rootçš„å®¶ç›®å½•ä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åœ¨å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºçš„$HOMEä¸‹ã€‚<br>éœ€è¦è‡ªè¡Œåˆ¤æ–­ç¨‹åºä½¿ç”¨çš„æ˜¯é‚£ä¸ªç›®å½•ä¸‹åœ¨Erlangcookieæ–‡ä»¶è¿›è¡Œçš„è®¤è¯åŠé€šä¿¡ï¼Œåœ¨SysVè„šæœ¬ä¸­ï¼Œexport $HOMEåˆ°æ­£ç¡®çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨serviceå‘½ä»¤äº†ã€‚  </p>
<h3 id="é”™è¯¯2"><a href="#é”™è¯¯2" class="headerlink" title="é”™è¯¯2"></a>é”™è¯¯2</h3><p>ä½¿ç”¨service rabbitmq-server status çš„æ—¶å€™ï¼Œ æç¤º$HOME éœ€è¦è¢«è®¾ç½®ï¼Œå°±åœ¨SysVè„šæœ¬é‡Œé¢ç›´æ¥exportå°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Application, RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux_Ranger_Usage</title>
    <url>/2021/08/26/Linux/Linux_RangerUsage/</url>
    <content><![CDATA[<p>ranger å¤‡å¿˜</p>
<pre><code class="bash">g/ Go root 
gh Go home
gg Go to top 
G  Go bottom



# æ–‡ä»¶æ“ä½œ å¤åˆ¶ã€å‰ªåˆ‡ã€åˆ é™¤ã€ç²˜è´´ ï¼ˆé’ˆå¯¹å½“å‰æ–‡ä»¶æˆ–åˆ™é€‰æ‹©çš„å†…å®¹ï¼‰
yy å¤åˆ¶
dd å‰ªåˆ‡
pp ç²˜è´´
F5 å¤åˆ¶
F5 å‰ªè´´
F8 åˆ é™¤
Delete åˆ é™¤

# ä¹¦ç­¾
mX æŠŠå½“å‰ç›®å½•åšä¸€ä¸ªä¹¦ç­¾ (X è¡¨ç¤ºä»»ä½•å­—ç¬¦)
&#39;X è·³åˆ°Xä¹¦ç­¾ä»£è¡¨çš„ç›®å½•

# æ ‡ç­¾ ä¸åŒæ ‡ç­¾å¯ä»¥å¤åˆ¶ã€ç²˜è´´ã€ç§»åŠ¨
gn æ–°å»ºä¸€ä¸ªæ ‡ç­¾
Alt+N è·³è½¬åˆ°Nå·æ ‡ç­¾ (ä»£è¡¨ä¸€ä¸ªæ•°å­—)
gt,gT è·³è½¬åˆ°å‰ä¸ªæ ‡ç­¾ï¼Œåä¸ªæ ‡ç­¾

# æ’åº å¯¹æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨è¿›è¡Œæ’åºï¼Œä»¥ä¾¿æŸ¥çœ‹ã€‚
ot æ ¹æ®åç¼€åè¿›è¡Œæ’åº (Type)
oa æ ¹æ®è®¿é—®æ—¶é—´è¿›è¡Œæ’åº (Access Time è®¿é—®æ–‡ä»¶è‡ªèº«æ•°æ®çš„æ—¶é—´)
oc æ ¹æ®æ”¹å˜æ—¶é—´è¿›è¡Œæ’åº (Change Time æ–‡ä»¶çš„æƒé™ç»„åˆ«å’Œæ–‡ä»¶è‡ªèº«æ•°æ®è¢«ä¿®æ”¹çš„æ—¶é—´)
om æ ¹æ®ä¿®æ”¹è¿›è¡Œæ’åº (Modify time æ–‡ä»¶è‡ªèº«å†…å®¹è¢«ä¿®æ”¹çš„æ—¶é—´)
ob æ ¹æ®æ–‡ä»¶åè¿›è¡Œæ’åº (basename)
on è¿™ä¸ªå¥½åƒå’Œbasenameå·®ä¸å¤š(natural)
os æ ¹æ®æ–‡ä»¶å¤§å°è¿›è¡Œæ’åº(Size)

# é‡å‘½å ä¿®æ”¹æ–‡ä»¶åæœ‰ä¸¤ç§æ¨¡å¼ï¼šå½“å‰æ–‡ä»¶å’Œæ‰¹é‡æ”¹å
cw æ–°æ–‡ä»¶å -- ä¿®æ”¹å½“å‰æ–‡ä»¶å
A -- åœ¨å½“å‰æ–‡ä»¶ååè¿½åŠ æ–‡å­—
I -- åœ¨å½“å‰æ–‡ä»¶åå‰è¿½åŠ æ–‡å­—
:bulkrename --é’ˆå¯¹markè¿‡çš„æ–‡ä»¶æ‰¹é‡æ”¹å

# æ‰§è¡Œshellå‘½ä»¤
! -- è¿›å…¥å‘½ä»¤æ¨¡å¼æ‰§è¡Œshellå‘½ä»¤
s -- åŒä¸Š
# -- åŒï¼ï¼Œä½†ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªpagerã€‚ç›¸å½“äº cmd | less
@ -- åŒï¼ï¼Œä½†ä¼šæŠŠé€‰æ‹©çš„æ–‡ä»¶ä½œä¸ºå‚æ•°æ”¾åœ¨æœ€åã€‚
S -- è¿›å…¥ä¸€ä¸ªæ–°çš„shellã€‚exitåå›åˆ°å½“å‰çš„ranger
</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Ranger</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Redhat 9 oomä¸è§¦å‘</title>
    <url>/2023/07/12/Linux/Linux_Redhat-9-MySQL%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h2><p>Amazon AMI ID: ami-0e54fe8afeb8fa59a</p>
<p>Operating System: Red Hat Enterprise Linux 9.2 (Plow)</p>
<p>Kernel: Linux 5.14.0-284.11.1.el9_2.x86_64</p>
<p>MySQL Version:  Ver 8.0.33 for Linux on x86_64 (MySQL Community Server - GPL)</p>
<h2 id="æµ‹è¯•æ­¥éª¤ï¼š"><a href="#æµ‹è¯•æ­¥éª¤ï¼š" class="headerlink" title="æµ‹è¯•æ­¥éª¤ï¼š"></a>æµ‹è¯•æ­¥éª¤ï¼š</h2><ol>
<li><p>ä½¿ç”¨ä¸Šé¢çš„AMIå¯åŠ¨ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œ åœ¨å®ä¾‹å¯åŠ¨ä¹‹åsshè¿æ¥è¿›å»ã€‚</p>
</li>
<li><p>æŒ‰ç…§MySQLå®˜æ–¹çš„ repo å®‰è£…ä¸€ä¸ªç¤¾åŒºçš„ç‰ˆæœ¬ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># https://dev.mysql.com/downloads/repo/yum/ </span>
<span class="token comment"># (mysql80-community-release-el9-1.noarch.rpm)</span>

<span class="token function">wget</span> https://dev.mysql.com/get/mysql80-community-release-el9-1.noarch.rpm

dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> ./mysql80-community-release-el9-1.noarch.rpm

dnf makecache <span class="token parameter variable">-y</span> 

dnf update <span class="token parameter variable">-y</span>

<span class="token comment"># Refer this doc to install mysql-community packages.</span>
<span class="token comment"># https://dev.mysql.com/doc/refman/8.0/en/linux-installation-yum-repo.html</span>
dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-community-server

<span class="token comment"># Check the installation success.</span>
systemctl status mysqld</code></pre>
</li>
<li><p>ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ å¦‚ä¸‹çš„å‚æ•°:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/my.cnf
<span class="token comment">#è®¾ç½®buffer pool çš„å‚æ•°å¤§äºç‰©ç†å†…å­˜ã€‚ ä¾‹å¦‚ os æœ¬èº«ç”±å¯ç”¨çš„å†…å­˜æ˜¯ 16Gï¼Œ é‚£ä¹ˆè®¾ç½®ä¸€ä¸ªæ›´å¤§çš„å€¼å³å¯ã€‚</span>
innodb_buffer_pool_size <span class="token operator">=</span> 40G

<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> mysqld

<span class="token function">sudo</span> systemctl status mysqld

<span class="token comment"># è·å–rootç”¨æˆ·çš„ä¸´æ—¶åˆå§‹åŒ–å¯†ç ï¼š </span>
<span class="token function">sudo</span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log

<span class="token comment"># ä½¿ç”¨rootç”¨æˆ·ç™»å½•ï¼Œ å¹¶æŸ¥çœ‹é…ç½®å·²ç»ç”Ÿæ•ˆã€‚</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>

MySQL <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show variables like <span class="token string">"%buffer_pool_size%"</span><span class="token punctuation">;</span>
+-------------------------+-------------+
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> Value       <span class="token operator">|</span>
+-------------------------+-------------+
<span class="token operator">|</span> innodb_buffer_pool_size <span class="token operator">|</span> <span class="token number">42949672960</span> <span class="token operator">|</span>
+-------------------------+-------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.005</span> sec<span class="token punctuation">)</span></code></pre>
</li>
<li><p>åˆ›å»ºdatabase ä»¥åŠ tableï¼š</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">create database test;

CREATE TABLE tt1(
id int NOT NULL AUTO_INCREMENT PRIMARY KEY,
person_id tinyint not null ,
person_name1 VARCHAR(3000) ,
person_name2 VARCHAR(3000) ,
person_name3 VARCHAR(3000) ,
person_name4 VARCHAR(3000) ,
person_name5 VARCHAR(3000) ,
gmt_create datetime ,
gmt_modified datetime
) ;	

insert into tt1 (person_id, person_name1, person_name2, person_name3, person_name4, person_name5, gmt_create, gmt_modified)
values (1, lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), lpad(&#39;&#39;,3000,&#39;*&#39;), now(), now());

# åå¤æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œ å¤åˆ¶å…¨è¡¨çš„æ•°æ®ï¼Œ å¤§æ¦‚æ‰§è¡Œ 10 æ¬¡å·¦å³ã€‚
insert into tt1 (person_id, person_name1, person_name2, person_name3, person_name4, person_name5, gmt_create, gmt_modified)
select person_id, person_name1, person_name2, person_name3, person_name4, person_name5, now(), now() from tt1;


# æŸ¥çœ‹å½“å‰tableçš„ä¿¡æ¯ ï¼Œç¡®è®¤ä¸€ä¸‹æ•°æ®é‡ã€‚ 
show table status like &#39;tt1&#39;\G</code></pre>
</li>
<li><p>åœ¨å¦ä¸€ä¸ªæœºå™¨ä¸Šé¢ select è¿™ä¸ªè¡¨æ ¼ã€‚</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">select count(*) from tt1;</code></pre>
</li>
<li><p>å¦‚æœæ•°æ®é‡è¶³å¤Ÿå¤§çš„è¯ï¼Œ é‚£ä¹ˆå°±ä¼šå ç”¨è¶…è¿‡ç‰©ç†å†…å­˜çš„ç©ºé—´ï¼Œå¯¼è‡´OOMã€‚</p>
</li>
</ol>
<hr>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å…¶ä»–ç‰ˆæœ¬çš„osä¸Šé¢éƒ½ä¼šè§¦å‘oomï¼Œ ç„¶åMySQLä¼šè¢«å¹²æ‰é‡å¯ï¼Œ åªæœ‰Redhat 9 è¿™ä¸ªç‰ˆæœ¬çš„osæ˜¯ä¸ä¼šè§¦å‘çš„ã€‚</p>
<p>æµ‹è¯•äº†Ubuntu 22ï¼Œ amazonlinux2ï¼Œ amazonlinux2023 éƒ½æ²¡ç”±è¿™ä¸ªé—®é¢˜ï¼Œ ä»–ä»¬çš„å†…æ ¸éƒ½æ˜¯ 5.10+ ã€‚</p>
<p>Redhat 9 è¿™ä¸ªç‰ˆæœ¬çš„è¡¨ç°æ˜¯ï¼Œ åœ¨æ¥è¿‘ç‰©ç†å†…å­˜å®¹é‡æé™çš„æ—¶å€™ï¼Œ os å¼€å§‹éå¸¸é¢‘ç¹çš„æ‰«æå¹¶å°è¯•å›æ”¶å†…å­˜çš„ç©ºé—´ï¼Œ å¯¼è‡´å‘½ä»¤çš„å“åº”å˜æ…¢ï¼Œæˆ‘å¼€äº†sarçš„ç›‘æ§å‘½ä»¤ï¼Œè¿”å›æ•°æ®çš„é€Ÿåº¦ä¹Ÿä¼šä¾¿çš„æ¯”è¾ƒæ…¢ï¼Œ å¤§éƒ¨åˆ†çš„è¿›ç¨‹ä¼šæ…¢æ…¢å˜æˆ UninterreptableçŠ¶æ€ï¼Œ å¹¶ä¸”æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œ æœ€ç»ˆä¼šå¯¼è‡´å®ä¾‹çš„ç½‘ç»œå­ç³»ç»Ÿä¸å·¥ä½œï¼Œ å®Œå…¨ä¸å“åº”ä»»ä½•çš„ç½‘ç»œæŠ¥æ–‡ï¼Œå®ä¾‹çš„å¥åº·æ£€æŸ¥å¤±è´¥ã€‚CPUä½¿ç”¨ç‡ä¾æ—§è¿˜åœ¨ï¼Œ EBSçš„ç›‘æ§æ˜¾ç¤ºè¿™ä¸ªå·æ»¡é€Ÿåº¦è¯»å–è¾“å‡ºï¼Œ å¹¶ä¸”éå¸¸å¹³ç¨³, å“åº”æ—¶é—´ä»¥åŠé˜Ÿåˆ—çš„é•¿åº¦ä¹Ÿæ²¡æœ‰å¼‚å¸¸ã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ—¶å€™å°è¯•å–æ‰‹åŠ¨è§¦å‘oomï¼Œ æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œ åœ¨æ€æ‰Mysqldä¹‹åï¼Œ oså°±æ¢å¤äº†æ­£å¸¸ã€‚</p>
<h2 id="åˆ†ææ€è·¯"><a href="#åˆ†ææ€è·¯" class="headerlink" title="åˆ†ææ€è·¯"></a>åˆ†ææ€è·¯</h2><p>å¯ä»¥ç¡®å®šçš„æ˜¯ ç£ç›˜çš„å·¥ä½œæ˜¯æ­£å¸¸çš„ï¼Œ CPUä½¿ç”¨ç‡æ…¢æ…¢å¢é•¿ä½†æ˜¯ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚ è¿™éƒ¨åˆ†çš„å·¥ä½œæ²¡æœ‰é—®é¢˜ã€‚ </p>
<p>åœ¨å‘ç”Ÿé—®é¢˜çš„æ—¶å€™å› ä¸ºç½‘ç»œæ— æ³•æ­£å¸¸çš„å·¥ä½œï¼Œsshå·²ç»æ–­å¼€ï¼Œ æ— æ³•ç¡®å®šå½“æ—¶çš„æƒ…å†µã€‚ </p>
<p>åˆæ­¥åˆ¤æ–­æ˜¯å†…å­˜çš„é—®é¢˜ï¼Œ ä½†æ˜¯å…·ä½“çš„å·®å¼‚æ˜¯å“ªé‡Œã€‚</p>
<h3 id="ç¬¬ä¸€"><a href="#ç¬¬ä¸€" class="headerlink" title="ç¬¬ä¸€"></a>ç¬¬ä¸€</h3><p>sarå‘½ä»¤ä¸­çš„è®°å½•</p>
<h3 id="ç¬¬äºŒ"><a href="#ç¬¬äºŒ" class="headerlink" title="ç¬¬äºŒ"></a>ç¬¬äºŒ</h3><p>å°è¯•å¯¹æ¯”ä¸è¡Œä¸ºæ­£å¸¸çš„osçš„å·®å¼‚ï¼Œ è·å–sysctl -a å¹¶è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚ </p>
<p>å¯¹æ¯”å®Œå…³äºå†…å­˜éƒ¨åˆ†çš„å‚æ•°ï¼Œ å®Œå…¨æ²¡æœ‰ä»»ä½•çš„å·®åˆ«ï¼Œ ä¸æ˜¯è®¾ç½®æˆ–è€…é…ç½®æ–‡ä»¶å¯¼è‡´çš„è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>min æ°´ä½çš„è®¾ç½®æ˜¯é»˜è®¤çš„ï¼Œ ä¸å…¶ä»–çš„å‘è¡Œç‰ˆæœ¬ä¸€ç›´ï¼Œ æµ‹è¯•çš„æ—¶å€™ç”¨çš„ç›¸åŒçš„è§„æ ¼ï¼Œ æ‰€ä»¥ä¸å­˜åœ¨è¿™ç±»çš„å·®å¼‚ã€‚</p>
<h3 id="ç¬¬ä¸‰"><a href="#ç¬¬ä¸‰" class="headerlink" title="ç¬¬ä¸‰"></a>ç¬¬ä¸‰</h3><p>è§¦å‘ä¸€ä¸ªkdump çœ‹çœ‹ç½‘ç»œä¸ç›¸åº”çš„æ—¶å€™ os å½“æ—¶çš„çŠ¶æ€ï¼Œ  è¿™ä¸ªä¸å¤ªä¼šã€‚</p>
<h3 id="ç¬¬å››"><a href="#ç¬¬å››" class="headerlink" title="ç¬¬å››"></a>ç¬¬å››</h3><p>æŸ¥çœ‹å†…æ ¸çš„ç¼–è¯‘é€‰é¡¹ï¼Œ çœ‹çœ‹æœ‰ä»€ä¹ˆä¸åŒã€‚</p>
<h3 id="ç¬¬äº”"><a href="#ç¬¬äº”" class="headerlink" title="ç¬¬äº”"></a>ç¬¬äº”</h3><p>å­¦ä¹ os å†…å­˜çš„éƒ¨åˆ†ï¼Œ çœ‹çœ‹å…·ä½“è¿™ä¸ªç‰ˆæœ¬çš„å†…æ ¸å¦‚ä½•è¿›è¡Œå†…å­˜çš„å›æ”¶çš„ï¼Œ æˆ–è€…è§¦å‘oomçš„æ¡ä»¶æœ‰å“ªäº›ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Memory, Kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>Shellè„šæœ¬å¤„ç†ç›®å½•æˆ–è€…æ–‡ä»¶åä¸­çš„ç©ºæ ¼</title>
    <url>/2022/04/15/Linux/Linux_Shell-Script-Process-Space/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h2><p>é—®é¢˜æ˜¯ï¼š ç½—åˆ—æŒ‡å®šçš„ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œ ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶ä¿ç•™ï¼Œ æœªåŒ¹é…çš„åˆ é™¤ã€‚</p>
<h2 id="è§£å†³ï¼š"><a href="#è§£å†³ï¼š" class="headerlink" title="è§£å†³ï¼š"></a>è§£å†³ï¼š</h2><p>ç®€å•çš„Bashè„šæœ¬ï¼Œ ä½¿ç”¨lsæ‹¿æ–‡ä»¶åï¼Œ ä½¿ç”¨For + IFåˆ¤æ–­å³å¯ã€‚<br>ä½†æ˜¯æ–‡ä»¶çš„ç›®å½•ä¸­æœ‰çš„æ–‡ä»¶åæ˜¯å¸¦æœ‰ç©ºæ ¼çš„ï¼Œ è€ŒShell ä½¿ç”¨ç©ºæ ¼åšåˆ†éš”ç¬¦ï¼Œå› æ­¤æ— æ³•æ­£ç¡®çš„å¤„ç†å®Œæ•´çš„æ–‡ä»¶åã€‚<br>è§£å†³æ–¹æ¡ˆæœ‰ç‰¹åˆ«å¤šï¼Œ åªè®°å½•ä¸€ä¸ªæˆ‘æœ€åä½¿ç”¨çš„æ–¹æ¡ˆï¼š<br>ä½¿ç”¨IFSå˜é‡æ¥å®šä¹‰Shell çš„é»˜è®¤åˆ†éš”ç¬¦ï¼Œ å°†ç©ºæ ¼æ›¿æ¢æˆ\n\b. </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#</span>
<span class="token assign-left variable">SAVEIFS</span><span class="token operator">=</span><span class="token environment constant">$IFS</span>
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-en</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\b">\b</span>"</span><span class="token variable">)</span></span>

<span class="token keyword">for</span> <span class="token for-or-select variable">number</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">&#125;</span>
<span class="token keyword">do</span>
  <span class="token function">mkdir</span> <span class="token parameter variable">-pv</span> <span class="token string">"dir <span class="token variable">$number</span>"</span>
<span class="token keyword">done</span>

tree

<span class="token assign-left variable">FILE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ls</span><span class="token variable">`</span></span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$FILE</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"The DirName: <span class="token variable">$i</span>"</span>
<span class="token keyword">done</span>

<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable">$SAVEIFS</span></code></pre>

<hr>
<p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°åç§°ä¸ºdir 1çš„å®Œæ•´ç›®å½•åå­—äº†ï¼Œå¦åˆ™ä¼šé»˜è®¤å§ç©ºæ ¼åˆ†å‰²çš„æ–‡ä»¶åç§°ä½œä¸ºä¸¤ä¸ªç›®å½•æå–ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">âš¡ ./delete.sh
<span class="token builtin class-name">.</span>
â”œâ”€â”€ delete.sh
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">1</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">10</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">2</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">3</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">4</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">5</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">6</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">7</span>
â”œâ”€â”€ <span class="token function">dir</span> <span class="token number">8</span>
â””â”€â”€ <span class="token function">dir</span> <span class="token number">9</span>

<span class="token number">10</span> directories, <span class="token number">1</span> <span class="token function">file</span>
The DirName: delete.sh
The DirName: <span class="token function">dir</span> <span class="token number">1</span>
The DirName: <span class="token function">dir</span> <span class="token number">10</span>
The DirName: <span class="token function">dir</span> <span class="token number">2</span>
The DirName: <span class="token function">dir</span> <span class="token number">3</span>
The DirName: <span class="token function">dir</span> <span class="token number">4</span>
The DirName: <span class="token function">dir</span> <span class="token number">5</span>
The DirName: <span class="token function">dir</span> <span class="token number">6</span>
The DirName: <span class="token function">dir</span> <span class="token number">7</span>
The DirName: <span class="token function">dir</span> <span class="token number">8</span>
The DirName: <span class="token function">dir</span> <span class="token number">9</span></code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Bash</tag>
      </tags>
  </entry>
  <entry>
    <title>Sysctl äº‘å¹³å°å‚æ•°çš„æ”¶é›†ä»¥åŠä¸€éƒ¨åˆ†è§£é‡Š</title>
    <url>/2022/04/19/Linux/Linux_Sysctl/</url>
    <content><![CDATA[<p>ä¸€äº›å…³äºsysctlå‚æ•°è®¾ç½®çš„æ”¶é›†å’Œè§£é‡Šã€‚</p>
<h1 id="x2F-etc-x2F-sysctl-d-x2F-00-defaults-conf"><a href="#x2F-etc-x2F-sysctl-d-x2F-00-defaults-conf" class="headerlink" title="&#x2F;etc&#x2F;sysctl.d&#x2F;00-defaults.conf"></a>&#x2F;etc&#x2F;sysctl.d&#x2F;00-defaults.conf</h1><h2 id="kernel-printk"><a href="#kernel-printk" class="headerlink" title="kernel.printk"></a>kernel.printk</h2><p>è¾“å‡ºå†…æ ¸æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ˜ å°„åˆ°çš„procæ–‡ä»¶ç³»ç»Ÿä½ç½® - /proc/sys/kernel/printk</span>
<span class="token comment"># Maximize console logging level for kernel printk messages</span>
kernel.printk <span class="token operator">=</span> <span class="token number">8</span> <span class="token number">4</span> <span class="token number">1</span> <span class="token number">7</span>

<span class="token comment"># (1) æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼šä¼˜å…ˆçº§é«˜äºè¯¥å€¼çš„æ¶ˆæ¯å°†è¢«æ‰“å°è‡³æ§åˆ¶å°ã€‚</span>
<span class="token comment"># (2) ç¼ºçœçš„æ¶ˆæ¯æ—¥å¿—çº§åˆ«ï¼šå°†ç”¨è¯¥å€¼æ¥æ‰“å°æ²¡æœ‰ä¼˜å…ˆçº§çš„æ¶ˆæ¯ã€‚</span>
<span class="token comment"># (3) æœ€ä½çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼šæ§åˆ¶å°æ—¥å¿—çº§åˆ«å¯èƒ½è¢«è®¾ç½®çš„æœ€å°å€¼ã€‚</span>
<span class="token comment"># (4) ç¼ºçœçš„æ§åˆ¶å°ï¼šæ§åˆ¶å°æ—¥å¿—çº§åˆ«çš„ç¼ºçœå€¼ã€‚</span></code></pre>
<p>å†…æ ¸ä¸­å…±æä¾›äº†å…«ç§ä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œåœ¨ linux&#x2F;kernel.h ä¸­æœ‰ç›¸åº”çš„å®å¯¹åº”ã€‚</p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#define KERN_EMERG  &quot;&lt;0&gt;&quot;   &#x2F;* systemis unusable *&#x2F;
#define KERN_ALERT  &quot;&lt;1&gt;&quot;   &#x2F;* actionmust be taken immediately *&#x2F;
#define KERN_CRIT    &quot;&lt;2&gt;&quot;   &#x2F;*critical conditions *&#x2F;
#define KERN_ERR     &quot;&lt;3&gt;&quot;   &#x2F;* errorconditions *&#x2F;
#define KERN_WARNING &quot;&lt;4&gt;&quot;   &#x2F;* warning conditions *&#x2F;
#define KERN_NOTICE  &quot;&lt;5&gt;&quot;   &#x2F;* normalbut significant *&#x2F;
#define KERN_INFO    &quot;&lt;6&gt;&quot;   &#x2F;*informational *&#x2F;
#define KERN_DEBUG   &quot;&lt;7&gt;&quot;   &#x2F;*debug-level messages *&#x2F;</code></pre>
<h2 id="kernel-panic"><a href="#kernel-panic" class="headerlink" title="kernel.panic"></a>kernel.panic</h2><p>è®¾ç½®å†…æ ¸çš„Panicä¹‹åè‡ªåŠ¨é‡å¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Wait 30 seconds and then reboot</span>
kernel.panic <span class="token operator">=</span> <span class="token number">30</span></code></pre>
<h2 id="neigh-default-gc"><a href="#neigh-default-gc" class="headerlink" title="neigh.default.gc"></a>neigh.default.gc</h2><p>è®¾ç½®arpç¼“å­˜ç›¸å…³çš„å‚æ•°<br><a href="https://zhuanlan.zhihu.com/p/94413312">https://zhuanlan.zhihu.com/p/94413312</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Allow neighbor cache entries to expire even when the cache is not full</span>
net.ipv4.neigh.default.gc_thresh1 <span class="token operator">=</span> <span class="token number">0</span>
net.ipv6.neigh.default.gc_thresh1 <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment"># Avoid neighbor table contention in large subnets</span>
net.ipv4.neigh.default.gc_thresh2 <span class="token operator">=</span> <span class="token number">15360</span>
net.ipv6.neigh.default.gc_thresh2 <span class="token operator">=</span> <span class="token number">15360</span>
net.ipv4.neigh.default.gc_thresh3 <span class="token operator">=</span> <span class="token number">16384</span>
net.ipv6.neigh.default.gc_thresh3 <span class="token operator">=</span> <span class="token number">16384</span>

<span class="token comment"># gc_thresh1</span>
å­˜åœ¨äºARPé«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å°‘å±‚æ•°ï¼Œå¦‚æœå°‘äºè¿™ä¸ªæ•°ï¼Œ
åƒåœ¾æ”¶é›†å™¨å°†ä¸ä¼šè¿è¡Œã€‚
ç¼ºçœå€¼æ˜¯128ã€‚
<span class="token comment"># gc_thresh2</span>
ä¿å­˜åœ¨ ARP é«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å¤šçš„è®°å½•è½¯é™åˆ¶ã€‚
åƒåœ¾æ”¶é›†å™¨åœ¨å¼€å§‹æ”¶é›†å‰ï¼Œå…è®¸è®°å½•æ•°è¶…è¿‡è¿™ä¸ªæ•°å­— <span class="token number">5</span> ç§’ã€‚
ç¼ºçœå€¼æ˜¯ <span class="token number">512</span>ã€‚
<span class="token comment"># gc_thresh3</span>
ä¿å­˜åœ¨ ARP é«˜é€Ÿç¼“å­˜ä¸­çš„æœ€å¤šè®°å½•çš„ç¡¬é™åˆ¶ï¼Œ
ä¸€æ—¦é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°ç›®é«˜äºæ­¤ï¼Œ
åƒåœ¾æ”¶é›†å™¨å°†é©¬ä¸Šè¿è¡Œã€‚
ç¼ºçœå€¼æ˜¯1024ã€‚</code></pre>

<h1 id="x2F-etc-x2F-sysctl-d-x2F-99-amazon-conf"><a href="#x2F-etc-x2F-sysctl-d-x2F-99-amazon-conf" class="headerlink" title="&#x2F;etc&#x2F;sysctl.d&#x2F;99-amazon.conf"></a>&#x2F;etc&#x2F;sysctl.d&#x2F;99-amazon.conf</h1><h2 id="sched-autogroup-enabled"><a href="#sched-autogroup-enabled" class="headerlink" title="sched_autogroup_enabled"></a>sched_autogroup_enabled</h2><p>é€šè¿‡CFSåˆ†ç»„æé«˜äº†æ¡Œé¢ç¯å¢ƒçš„æ€§èƒ½è¡¨ç°ã€‚è¿™ä¸ªå°å°çš„è¡¥ä¸ä»…ä¸º Linux Kernel å¢åŠ äº† 233 è¡Œä»£ç ï¼Œå´å°†é«˜è´Ÿè·ä¸‹æ¡Œé¢å“åº”æœ€å¤§å»¶è¿Ÿé™ä½åˆ°åŸå…ˆçš„ååˆ†ä¹‹ä¸€ï¼Œå¹³å‡å»¶è¿Ÿé™ä½åˆ°å…­ååˆ†ä¹‹ä¸€ï¼è¯¥è¡¥ä¸çš„ä½œç”¨æ˜¯ä¸ºæ¯ä¸ª TTY åŠ¨æ€åœ°åˆ›å»ºä»»åŠ¡åˆ†ç»„ã€‚(<a href="https://linuxtoy.org/archives/small-patch-but-huge-improvement.html">https://linuxtoy.org/archives/small-patch-but-huge-improvement.html</a>)</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># https://cateee.net/lkddb/web-lkddb/SCHED_AUTOGROUP.html</span>
<span class="token comment"># https://www.postgresql.org/message-id/50E4AAB1.9040902@optionshouse.com</span>
<span class="token comment"># This setting enables better interactivity for desktop workloads and not</span>
<span class="token comment"># suitable for many server workloads.</span>
<span class="token comment"># å¯ç”¨åï¼Œå†…æ ¸ä¼šåˆ›å»ºä»»åŠ¡ç»„æ¥ä¼˜åŒ–æ¡Œé¢ç¨‹åºçš„è°ƒåº¦ã€‚å®ƒå°†æŠŠå ç”¨å¤§é‡èµ„æºçš„åº”ç”¨ç¨‹åºæ”¾åœ¨å®ƒä»¬è‡ªå·±çš„ä»»åŠ¡ç»„ï¼Œæ ¹æ®PostgreSQLçš„æµ‹è¯•ï¼Œ å…³é—­è¿™ä¸ªé€‰é¡¹ä¼šå°†æ•°æ®åº“çš„æ€§èƒ½æé«˜30%ï¼ˆä¸Šé¢çš„Linkï¼‰ã€‚ åœ¨åå°çš„æœåŠ¡è¿›ç¨‹ä¸­æ˜¯æé«˜æ€§èƒ½çš„é€‰é¡¹ã€‚</span>
<span class="token comment"># 0ï¼šç¦æ­¢</span>
<span class="token comment"># 1ï¼šå¼€å¯</span>

<span class="token assign-left variable">kernel.sched_autogroup_enabled</span><span class="token operator">=</span><span class="token number">0</span></code></pre>

<h1 id="x2F-usr-x2F-lib-x2F-sysctl-d-x2F-00-system-conf"><a href="#x2F-usr-x2F-lib-x2F-sysctl-d-x2F-00-system-conf" class="headerlink" title="&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;00-system.conf"></a>&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;00-system.conf</h1><h2 id="Bridge-nf-call-iptables"><a href="#Bridge-nf-call-iptables" class="headerlink" title="Bridge-nf-call-iptables"></a>Bridge-nf-call-iptables</h2><p>ç½‘æ¡¥è®¾å¤‡å…³é—­netfilteræ¨¡å—ï¼Œå¼€å…³éœ€è¦æŒ‰éœ€æ±‚æ¥æŒ‡å®šã€‚<br>å…³é—­è¿™ä¸ªæ¨¡å—ä¼šåœ¨ç½‘æ¡¥2å±‚å¯ä»¥è½¬å‘çš„æ—¶å€™ç›´æ¥è½¬å‘ï¼Œ ä¸ä¼šèµ°ä¸‰å±‚è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šè¿‡Iptablesã€‚<br>Kuberneteséœ€è¦å¼€å¯è¿™ä¸ªå‚æ•°çš„åŸå› æ˜¯ï¼š <a href="https://imroc.cc/post/202105/why-enable-bridge-nf-call-iptables/%EF%BC%8C">https://imroc.cc/post/202105/why-enable-bridge-nf-call-iptables/ï¼Œ</a> ä¿®å¤äº†Corednsä¸å®šæœŸè§£æå¤±è´¥çš„é—®é¢˜ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Disable netfilter on bridges.</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-arptables <span class="token operator">=</span> <span class="token number">0</span></code></pre>

<h1 id="x2F-usr-x2F-lib-x2F-sysctl-d-x2F-10-default-yama-scope-conf"><a href="#x2F-usr-x2F-lib-x2F-sysctl-d-x2F-10-default-yama-scope-conf" class="headerlink" title="&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;10-default-yama-scope.conf"></a>&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;10-default-yama-scope.conf</h1><h2 id="Yama"><a href="#Yama" class="headerlink" title="Yama"></a>Yama</h2><p>Yama is a Linux Security Module that collects system-wide DAC security protections that are not handled by the core kernel itself. This is selectable at build-time with CONFIG_SECURITY_YAMA, and can be controlled at run-time through sysctls in &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;yama  </p>
<p><a href="https://www.kernel.org/doc/html/latest/admin-guide/LSM/Yama.html">https://www.kernel.org/doc/html/latest/admin-guide/LSM/Yama.html</a> </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-11-235 sysctl.d<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token number">10</span>-default-yama-scope.conf
<span class="token comment"># When yama is enabled in the kernel it might be used to filter any user</span>
<span class="token comment"># space access which requires PTRACE_MODE_ATTACH like ptrace attach, access</span>
<span class="token comment"># to /proc/PID/&#123;mem,personality,stack,syscall&#125;, and the syscalls</span>
<span class="token comment"># process_vm_readv and process_vm_writev which are used for interprocess</span>
<span class="token comment"># services, communication and introspection (like synchronisation, signaling,</span>
<span class="token comment"># debugging, tracing and profiling) of processes.</span>
<span class="token comment">#</span>
<span class="token comment"># Usage of ptrace attach is restricted by normal user permissions. Normal</span>
<span class="token comment"># unprivileged processes cannot interact through ptrace with processes</span>
<span class="token comment"># that they cannot send signals to or processes that are running set-uid</span>
<span class="token comment"># or set-gid.</span>
<span class="token comment">#</span>
<span class="token comment"># yama ptrace scope can be used to reduce these permissions even more.</span>
<span class="token comment"># This should normally not be done because it will break various programs</span>
<span class="token comment"># relying on the default ptrace security restrictions. But can be used</span>
<span class="token comment"># if you don't have any other way to separate processes in their own</span>
<span class="token comment"># domains. A different way to restrict ptrace is to set the selinux</span>
<span class="token comment"># deny_ptrace boolean. Both mechanisms will break some programs relying</span>
<span class="token comment"># on the ptrace system call and might force users to elevate their</span>
<span class="token comment"># priviliges to root to do their work.</span>
<span class="token comment">#</span>
<span class="token comment"># For more information see Documentation/security/Yama.txt in the kernel</span>
<span class="token comment"># sources. Which also describes the defaults when CONFIG_SECURITY_YAMA</span>
<span class="token comment"># is enabled in a kernel build (currently 1 for ptrace_scope).</span>
<span class="token comment">#</span>
<span class="token comment"># This runtime kernel parameter can be set to the following options:</span>
<span class="token comment"># (Note that setting this to anything except zero will break programs!)</span>
<span class="token comment">#</span>
<span class="token comment"># 0 - Default attach security permissions.</span>
<span class="token comment"># 1 - Restricted attach. Only child processes plus normal permissions.</span>
<span class="token comment"># 2 - Admin-only attach. Only executables with CAP_SYS_PTRACE.</span>
<span class="token comment"># 3 - No attach. No process may call ptrace at all. Irrevocable.</span>
<span class="token comment">#</span>
kernel.yama.ptrace_scope <span class="token operator">=</span> <span class="token number">0</span></code></pre>

<h1 id="x2F-usr-x2F-lib-x2F-sysctl-d-x2F-50-default-conf"><a href="#x2F-usr-x2F-lib-x2F-sysctl-d-x2F-50-default-conf" class="headerlink" title="&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;50-default.conf"></a>&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;50-default.conf</h1><h2 id="Sysrq"><a href="#Sysrq" class="headerlink" title="Sysrq"></a>Sysrq</h2><p>æ˜¯ä¸€ä¸ªMagic Keyçš„è®¾ç½®ï¼Œæ— è®ºå†…æ ¸å½“å‰åœ¨åšä»€ä¹ˆéƒ½ä¼šç«‹åˆ»å“åº”è¿™ä¸ªMagicKeyã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
<span class="token comment">#  This file is part of systemd.</span>
<span class="token comment">#</span>
<span class="token comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="token comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="token comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="token comment">#  (at your option) any later version.</span>

<span class="token comment"># See sysctl.d(5) and core(5) for for documentation.</span>

<span class="token comment"># To override settings in this file, create a local file in /etc</span>
<span class="token comment"># (e.g. /etc/sysctl.d/90-override.conf), and put any assignments</span>
<span class="token comment"># there.</span>

<span class="token comment"># System Request functionality of the kernel (SYNC)</span>
<span class="token comment">#</span>
<span class="token comment"># Use kernel.sysrq = 1 to allow all keys.</span>
<span class="token comment"># See http://fedoraproject.org/wiki/QA/Sysrq for a list of values and keys.</span>
kernel.sysrq <span class="token operator">=</span> <span class="token number">16</span>

When running a kernel with SysRq compiled in, /proc/sys/kernel/sysrq controls the functions allowed to be invoked via the SysRq key. Here is the list of possible values <span class="token keyword">in</span> /proc/sys/kernel/sysrq:

    <span class="token number">0</span> - disable sysrq completely
    <span class="token number">1</span> - <span class="token builtin class-name">enable</span> all functions of sysrq
    <span class="token operator">></span><span class="token number">1</span> - bitmask of allowed sysrq functions <span class="token punctuation">(</span>see below <span class="token keyword">for</span> detailed <span class="token keyword">function</span> description<span class="token punctuation">)</span>:
        <span class="token number">2</span> - <span class="token builtin class-name">enable</span> control of console logging level
        <span class="token number">4</span> - <span class="token builtin class-name">enable</span> control of keyboard <span class="token punctuation">(</span>SAK, unraw<span class="token punctuation">)</span>
        <span class="token number">8</span> - <span class="token builtin class-name">enable</span> debugging dumps of processes etc.
        <span class="token number">16</span> - <span class="token builtin class-name">enable</span> <span class="token function">sync</span> <span class="token builtin class-name">command</span>
        <span class="token number">32</span> - <span class="token builtin class-name">enable</span> remount read-only
        <span class="token number">64</span> - <span class="token builtin class-name">enable</span> signalling of processes <span class="token punctuation">(</span>term, kill, oom-kill<span class="token punctuation">)</span>
        <span class="token number">128</span> - allow reboot/poweroff
        <span class="token number">256</span> - allow nicing of all RT tasks
<span class="token comment"># è§¦å‘çš„æ–¹å¼</span>
- <span class="token builtin class-name">echo</span> t <span class="token operator">></span> /proc/sysrq-trigger
- You press the key combo Alt+SysRq+<span class="token operator">&lt;</span>command key<span class="token operator">></span>.</code></pre>

<h2 id="core-uses-pid"><a href="#core-uses-pid" class="headerlink" title="core_uses_pid"></a>core_uses_pid</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Append the PID to the core filename</span>
<span class="token comment"># DEBUGç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è¢«é…ç½®æˆ1ï¼Œå³ä½¿core_patternä¸­æ²¡æœ‰è®¾ç½®%pï¼Œæœ€åç”Ÿæˆçš„core dumpæ–‡ä»¶åä»ä¼šåŠ ä¸Šè¿›ç¨‹IDã€‚ </span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span></code></pre>

<h2 id="kptr-restrict"><a href="#kptr-restrict" class="headerlink" title="kptr_restrict"></a>kptr_restrict</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹å†…æ ¸åœ°å€ç¬¦å·çš„å‘½ä»¤ï¼š cat /proc/kallsyms</span>
<span class="token comment"># https://bugzilla.redhat.com/show_bug.cgi?id=1689344</span>
kernel.kptr_restrict <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment"># 0 æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹å†…æ ¸çš„åœ°å€ç©ºé—´è¾“å‡ºä¿¡æ¯</span>
<span class="token comment"># 1 åªæœ‰rootç”¨æˆ·å¯ä»¥ï¼Œå…¶ä»–ç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯0</span>
<span class="token comment"># 2 æ‰€æœ‰çš„ç”¨æˆ·éƒ½ä¸å¯ä»¥ï¼Œè¾“å‡ºçš„ç»“æœéƒ½æ˜¯0</span>

<span class="token comment"># Other Link: https://blog.csdn.net/qq1602382784/article/details/80066847</span></code></pre>

<h2 id="rp-filter"><a href="#rp-filter" class="headerlink" title="rp_filter"></a>rp_filter</h2><p>rp_filterå‚æ•°ç”¨äºæ§åˆ¶ç³»ç»Ÿæ˜¯å¦å¼€å¯å¯¹æ•°æ®åŒ…æºåœ°å€çš„æ ¡éªŒã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Source route verification</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
ä¸¤ä¸ªå‚æ•°ä¹‹ä¸­æœ‰ä¸€ä¸ªæ˜¯1ï¼Œ é‚£ä¹ˆè¿™ä¸ªåŠŸèƒ½å°±æ˜¯å¯ç”¨çš„
- <span class="token number">0</span>ï¼šä¸å¼€å¯æºåœ°å€æ ¡éªŒã€‚
- <span class="token number">1</span>ï¼šå¼€å¯ä¸¥æ ¼çš„åå‘è·¯å¾„æ ¡éªŒã€‚å¯¹æ¯ä¸ªè¿›æ¥çš„æ•°æ®åŒ…ï¼Œæ ¡éªŒå…¶åå‘è·¯å¾„æ˜¯å¦æ˜¯æœ€ä½³è·¯å¾„ã€‚å¦‚æœåå‘è·¯å¾„ä¸æ˜¯æœ€ä½³è·¯å¾„ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥æ•°æ®åŒ…ã€‚
- <span class="token number">2</span>ï¼šå¼€å¯æ¾æ•£çš„åå‘è·¯å¾„æ ¡éªŒã€‚å¯¹æ¯ä¸ªè¿›æ¥çš„æ•°æ®åŒ…ï¼Œæ ¡éªŒå…¶æºåœ°å€æ˜¯å¦å¯è¾¾ï¼Œå³åå‘è·¯å¾„æ˜¯å¦èƒ½é€šï¼ˆé€šè¿‡ä»»æ„ç½‘å£ï¼‰ï¼Œå¦‚æœåå‘è·¯å¾„ä¸åŒï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥æ•°æ®åŒ…ã€‚</code></pre>

<h2 id="accept-source-route"><a href="#accept-source-route" class="headerlink" title="accept_source_route"></a>accept_source_route</h2><p>æŒ‡å…è®¸æ•°æ®åŒ…çš„å‘é€è€…æŒ‡å®šæ•°æ®åŒ…çš„å‘é€è·¯å¾„ï¼Œä»¥åŠè¿”å›ç»™å‘é€è€…çš„æ•°æ®åŒ…æ‰€èµ°çš„è·¯å¾„ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Do not accept source routing</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.all.accept_source_route <span class="token operator">=</span> <span class="token number">0</span></code></pre>

<h2 id="promote-secondaries"><a href="#promote-secondaries" class="headerlink" title="promote_secondaries"></a>promote_secondaries</h2><p>downæ‰æ‰€å±æŸä¸ªå­ç½‘çš„primary ipçš„æ—¶å€™ï¼Œ æ‰€æœ‰ç›¸å…³çš„secondary ipä¹Ÿä¼šdownæ‰,å¯ç”¨çš„æ—¶å€™ï¼Œå½“primary ipå®•æ‰æ—¶å¯ä»¥å°†secondary ipæå‡ä¸ºprimary ipã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Promote secondary addresses when the primary address is removed</span>
net.ipv4.conf.default.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span></code></pre>

<h2 id="protected-links"><a href="#protected-links" class="headerlink" title="protected_links"></a>protected_links</h2><p>fs.protected_hardlinks 	ç”¨äºé™åˆ¶æ™®é€šç”¨æˆ·å»ºç«‹ç¡¬é“¾æ¥  </p>
<ul>
<li>0ï¼šä¸é™åˆ¶ç”¨æˆ·å»ºç«‹ç¡¬é“¾æ¥  </li>
<li>1ï¼šé™åˆ¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å±äºç”¨æˆ·ï¼Œæˆ–è€…ç”¨æˆ·å¯¹æ­¤ç”¨æˆ·æ²¡æœ‰è¯»å†™æƒé™ï¼Œåˆ™ä¸èƒ½å»ºç«‹ç¡¬é“¾æ¥</li>
</ul>
<p>fs.protected_symlinks 	ç”¨äºé™åˆ¶æ™®é€šç”¨æˆ·å»ºç«‹è½¯é“¾æ¥  </p>
<ul>
<li>0ï¼šä¸é™åˆ¶ç”¨æˆ·å»ºç«‹è½¯é“¾æ¥  </li>
<li>1ï¼šé™åˆ¶ï¼Œå…è®¸ç”¨æˆ·å»ºç«‹è½¯è¿æ¥çš„æƒ…å†µæ˜¯ è½¯è¿æ¥æ‰€åœ¨ç›®å½•æ˜¯å…¨å±€å¯è¯»å†™ç›®å½•æˆ–è€…è½¯è¿æ¥çš„uidä¸è·Ÿä»è€…çš„uidåŒ¹é…ï¼Œåˆæˆ–è€…ç›®å½•æ‰€æœ‰è€…ä¸è½¯è¿æ¥æ‰€æœ‰è€…åŒ¹é…  <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Enable hard and soft link protection</span>
fs.protected_hardlinks <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_symlinks <span class="token operator">=</span> <span class="token number">1</span></code></pre></li>
</ul>
<h1 id="x2F-usr-x2F-lib-x2F-sysctl-d-x2F-9-ipv6-conf"><a href="#x2F-usr-x2F-lib-x2F-sysctl-d-x2F-9-ipv6-conf" class="headerlink" title="&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;9-ipv6.conf"></a>&#x2F;usr&#x2F;lib&#x2F;sysctl.d&#x2F;9-ipv6.conf</h1><p>å…³äºIPv6åœ°å€é‡å¤çš„é—®é¢˜ã€‚<br>In case DAD does find a duplicate address, the address we tried to set is deleted (and in the syslog you see a message like this: â€œeth0: duplicate address detected!â€). In such a case, a sysadmin needs to configure an address manually.</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">net.ipv6.conf.all.accept_dad</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">net.ipv6.conf.default.accept_dad</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">net.ipv6.conf.eth0.accept_dad</span><span class="token operator">=</span><span class="token number">0</span></code></pre>
<h2 id="Case-Update"><a href="#Case-Update" class="headerlink" title="Case Update"></a>Case Update</h2><ol>
<li><p>[[Linux_å†…æ ¸å‚æ•°ç¬”è®°#net.ipv4.tcp_tw_recycle|tcp_tw_recycleï¼ˆBefore 4.12 available)]]<br>net.ipv4.tcp_timestamps è¿™ä¸ªå‚æ•°å¼€å¯çš„æ—¶å€™ï¼Œ æ‰ä¼šç”Ÿæ•ˆï¼Œå¯ä»¥å¿«é€Ÿå›æ”¶å¤„äºTIME_WAITçŠ¶æ€çš„socketã€‚å½“tcp_tw_recycleå¼€å¯æ—¶ï¼ˆtcp_timestampsåŒæ—¶å¼€å¯ï¼Œå¿«é€Ÿå›æ”¶socketçš„æ•ˆæœè¾¾åˆ°ï¼‰ï¼Œå¯¹äºä½äºNATè®¾å¤‡åé¢çš„Clientæ¥è¯´ï¼Œæ˜¯ä¸€åœºç¾éš¾ã€‚<br><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4396e46187ca5070219b81773c4e65088dac50cc">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4396e46187ca5070219b81773c4e65088dac50cc</a><br>è¿™ä¸ªå‚æ•°åœ¨2017å¹´ä¹‹åçš„å†…æ ¸å·²ç»ä¸å­˜åœ¨äº†ï¼Œ å¼€å‘è€…çš„Blog <a href="https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux">https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux</a><br>å†…æ ¸å½»åº•ç§»é™¤è¿™ä¸ªå‚æ•°çš„ç‰ˆæœ¬æ˜¯ 4.12 ï¼Œ å¦‚æœå†…æ ¸çš„ç‰ˆæœ¬æ˜¯4.12 ä¹‹åï¼Œè¿™ä¸ªé—®é¢˜å°±ä¸å­˜åœ¨äº†ã€‚<br>å¯¹äºNATåç«¯çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ï¼Œå¦‚æœæœ‰æ—¶é—´çš„å·®è·ä¼šå¯¼è‡´å¦ä¸€ä¸ªå®ä¾‹æ”¶åˆ°çš„æŠ¥æ–‡çš„Timestampæ˜¯ä¹‹å‰ä¸€ä¸ªæ—¶é—´ç‚¹çš„ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè®¤ä¸ºè¿™ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªä¹‹å‰çš„æŸä¸ªè¯·æ±‚çš„è¿”å›ã€‚ ç„¶è€Œå…¶<br>å®æ˜¯å› ä¸ºæ—¶é—´çš„åŸå› ï¼Œ å¹¶ä¸”è¿™ä¸ªè¯·æ±‚æ˜¯ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œç”±äºæ—¶é—´çš„åŸå› è¢«è¯†åˆ«æˆäº†æ—§çš„è¯·æ±‚ã€‚<br>è¿™ä¸ªé…ç½®å¯¹ Incomming å’Œ Outgoingçš„tcpè¿æ¥éƒ½ä¼šç”Ÿæ•ˆã€‚ç”±äºç½‘ç»œçš„è®¾è®¡æ˜¯é»˜è®¤ä¸ç›¸ä¿¡å¯é çš„ï¼Œ æ‰€ä»¥åœ¨TCPçš„æœ€åè¿›è¡Œç­‰å¾…ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„TIME_WAITï¼Œ è€Œè¿™äº›TIME_WAITå…¶å®æ˜¯å·²ç»ä¸ç”¨çš„ï¼Œ ä½†æ˜¯ç”±äºæ— æ³•è·å¾—ACKå› æ­¤æ— æ³•é‡Šæ”¾ã€‚</p>
</li>
<li><p>[[Linux_å†…æ ¸å‚æ•°ç¬”è®°#net.ipv4.tcp_tw_reuse|tcp_tw_reuse]]<br> <a href="http://lxr.linux.no/#linux+v3.2.8/Documentation/networking/ip-sysctl.txt#L464">http://lxr.linux.no/#linux+v3.2.8/Documentation/networking/ip-sysctl.txt#L464</a><br> è¿™ä¸ªé…ç½®åªæ˜¯å¯¹å®¢æˆ·ç«¯ç”Ÿæ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ å®¢æˆ·ç«¯å‘èµ·äº†FINä¹‹åï¼Œ åªè¦å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„FINï¼Œ åç»­çš„ç½‘ç»œæŠ¥æ–‡å·²ç»ä¸å†ç»§ç»­å…³æ³¨äº†ã€‚ è¿™æ ·å®¢æˆ·ç«¯çš„TIME_WAITå°±ä¼šä¸‹é™ï¼Œ æé«˜äº†å®¢æˆ·ç«¯çš„Timewaitçš„åˆ©ç”¨ç‡ï¼Œå‡å°‘äº†å®¢æˆ·ç«¯TWè¿æ¥çš„æ•°é‡ã€‚å¯ä»¥æé«˜å®¢æˆ·ç«¯çš„å¹¶å‘è¯·æ±‚æ•°é‡ã€‚<br> è¿™ä¸ªé…ç½®å‚æ•°åªå¯¹ Outgoing çš„å‚æ•°ç”Ÿæ•ˆã€‚<br> NOTEï¼š ç°åœ¨è¿™ä¸ªé€‰é¡¹æ”¯æŒ3ä¸ªå‚æ•°ï¼Œ0 å…³é—­ï¼Œ 1 å¼€å¯ ï¼Œ2 åªå¯¹å›ç¯å¼€å¯ã€‚</p>
</li>
</ol>
<h3 id="Other-Memory-and-OOM-Controll"><a href="#Other-Memory-and-OOM-Controll" class="headerlink" title="Other Memory and OOM Controll"></a>Other Memory and OOM Controll</h3>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>é€šè¿‡systemdç®¡ç†è½¯ä»¶å’ŒæœåŠ¡</title>
    <url>/2019/09/17/Linux/Linux_Systemctl-ManageService/</url>
    <content><![CDATA[<p>é€šè¿‡systemctl æ¥ç®¡ç†ç³»ç»Ÿçš„æœåŠ¡å’Œè½¯ä»¶ï¼Œä½†æ˜¯å¦‚æœæ˜¯è‡ªå·±å®‰è£…çš„è½¯ä»¶å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨äº†ã€‚å…¶å®æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰systemdçš„ç®¡ç†è„šæœ¬çš„ï¼Œç±»ä¼¼ä¸ä¹‹å‰çš„SysVé£æ ¼çš„ç®¡ç†è„šæœ¬ã€‚</p>
<h2 id="Systemdæ˜¯ä»€ä¹ˆ"><a href="#Systemdæ˜¯ä»€ä¹ˆ" class="headerlink" title="Systemdæ˜¯ä»€ä¹ˆ"></a>Systemdæ˜¯ä»€ä¹ˆ</h2><blockquote>
<p>systemd is a suite of basic building blocks for a Linux system. It provides a system and service manager that runs as PID 1 and starts the rest of the system. systemd provides aggressive parallelization capabilities, uses socket and D-Bus activation for starting services, offers on-demand starting of daemons, keeps track of processes using Linux control groups, maintains mount and automount points, and implements an elaborate transactional dependency-based service control logic. systemd supports SysV and LSB init scripts and works as a replacement for sysvinit. Other parts include a logging daemon, utilities to control basic system configuration like the hostname, date, locale, maintain a list of logged-in users and running containers and virtual machines, system accounts, runtime directories and settings, and daemons to manage simple network configuration, network time synchronization, log forwarding, and name resolution.</p>
</blockquote>
<p>ç®¡å¾—è¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸»è¦æ˜¯å¯åŠ¨PIDä¸º1çš„è¿›ç¨‹å¹¶å¯åŠ¨å…¶ä»–çš„ç¨‹åºï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œç»´æŠ¤æŒ‚è½½ç‚¹åŠè‡ªåŠ¨æŒ‚è½½ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ—¥å¿—è¿›ç¨‹ï¼Œ</p>
<h2 id="Systemdçš„Unitsæ–‡ä»¶"><a href="#Systemdçš„Unitsæ–‡ä»¶" class="headerlink" title="Systemdçš„Unitsæ–‡ä»¶"></a>Systemdçš„Unitsæ–‡ä»¶</h2><p>Systemdé»˜è®¤çš„æ–‡ä»¶é…ç½®è·¯å¾„æœ‰ï¼š<br>    - &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;*<br>    - &#x2F;run&#x2F;systemd&#x2F;system&#x2F;*<br>    - &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;*</p>
<h2 id="Systemd-Unit-File-çš„æ¨¡æ¿"><a href="#Systemd-Unit-File-çš„æ¨¡æ¿" class="headerlink" title="Systemd Unit File çš„æ¨¡æ¿"></a>Systemd Unit File çš„æ¨¡æ¿</h2><p>æœ‰è¿™æ ·çš„å‡ ä¸ªæ¨¡å—ï¼š</p>
<ol>
<li>[Unit]</li>
<li>[Service]</li>
<li>[Install]</li>
</ol>
<h3 id="Unit"><a href="#Unit" class="headerlink" title="Unit"></a>Unit</h3><p>Unitçš„ä½œç”¨æ˜¯è®°å½•æ–‡ä»¶çš„é€šç”¨ä¿¡æ¯ã€‚</p>
<ol>
<li>Descripition â€“ å¯¹è½¯ä»¶æˆ–æœåŠ¡çš„æè¿°ã€‚</li>
<li>Before OR After â€“ å®šä¹‰å¯åŠ¨çš„é¡ºåºï¼Œåœ¨æŸäº›æœåŠ¡ å¯åŠ¨ä¹‹å‰ OR å¯åŠ¨ä¹‹å ï¼Œåœ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡ã€‚å…¶ä¸­è¿˜å®šä¹‰äº†æœåŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå…ˆåé¡ºåºã€‚å¸¸ç”¨çš„å€¼æœ‰ <code>network.target, Multi-User.target, network.service</code> ç­‰ç­‰ã€‚</li>
<li>Requires â€“ å¹¶è¡Œå¯åŠ¨æ‰€æŒ‡å®šçš„å…¶ä»–æœåŠ¡ã€‚</li>
<li>RequireOverrideable â€“ ç±»ä¼¼ä¸requireï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯æ‰‹åŠ¨å¯åŠ¨çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ã€‚</li>
<li>Requisite â€“ åªè¦å¯åŠ¨å¤±è´¥äº†å°±ç›´æ¥æŠ¥é”™åœæ­¢ï¼Œå¼ºç¡¬ç‰ˆæœ¬çš„requiresã€‚</li>
<li>Wants â€“ å¯åŠ¨ä¾èµ–å•å…ƒçš„å¸¸ç”¨é€‰é¡¹ï¼Œåœ¨å¯åŠ¨çš„åŒæ—¶è°ƒèµ·å…¶ä»–çš„Unitï¼Œå¦‚æœå…¶ä»–å•å…ƒå¯åŠ¨å¤±è´¥äº†ä¹Ÿä¸ä¼šå½±å“å½“å‰å®šä¹‰çš„Unitçš„å¯åŠ¨ã€‚</li>
<li>Conflicts â€“ å†²çªå•å…ƒï¼Œå¯åŠ¨çš„æ—¶å€™å‘ç°äº†Conflictä¸­å®šä¹‰çš„å…¶ä»–å•å…ƒå°±ä¼šå°è¯•ç»ˆæ­¢Unitã€‚</li>
</ol>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><ol>
<li>Type â€“ å¯¹æœåŠ¡ç±»å‹çš„å®šä¹‰ï¼Œé€šå¸¸æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š<br>- simple é»˜è®¤çš„ç±»å‹ï¼Œå¯åŠ¨å°±å¯åŠ¨ï¼Œåœæ­¢å°±ç»“æŸäº†ã€‚<br>- forking å®ˆæŠ¤è¿›ç¨‹çš„ç±»å‹ï¼ŒæŠŠå¿…è¦çš„å¯åŠ¨ä¹‹åç•™ä¸‹å®ˆæŠ¤è¿›ç¨‹ã€‚<br>- oneshot ä¸€æ¬¡æ€§çš„æœåŠ¡ï¼Œå¯åŠ¨åå°±ç»“æŸäº†ã€‚</li>
<li>ExecStart â€“ å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œçš„å‘½ä»¤ï¼Œ è¿™æ¡å‘½ä»¤å°±æ˜¯æœåŠ¡çš„ä¸»ä½“ã€‚</li>
<li>ExecStartPre OR ExecStartPost â€“ ExecStartæ‰§è¡Œå‰åçš„åŠ¨ä½œã€‚</li>
<li>ExecStop â€“ æŒ‡å®šæœåŠ¡ç»“æŸçš„åŠ¨ä½œï¼Œå¦‚æœæœªæŒ‡å®šç›´æ¥killã€‚</li>
<li>Restart â€“ å®šä¹‰äº†é‡å¯çš„æ¡ä»¶å’ŒåŠ¨ä½œï¼Œå¸¸ç”¨çš„å‚æ•°æœ‰ï¼š <code>no, on-sucess, on-failure, on-watchdog, on-abort</code>ã€‚</li>
<li>SuccessExitStatus â€“ ExecStartçš„è¿”å›å€¼ã€‚ <code>SuccessExitStatus=1 2 8 SIGKILL</code></li>
</ol>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><ol>
<li>WantedBy â€“ å®šä¹‰å¯åŠ¨çš„æƒ…æ™¯ï¼Œå‡ ç§ä¸åŒçš„target: <code>multi-user.target | poweroff.target | rescue.target | graphical.target | reboot.target</code></li>
<li>Alias â€“ åˆ«åçš„è®¾ç½®åœ¨è¿™é‡Œå®šä¹‰ã€‚</li>
</ol>
<h2 id="æ ‡å‡†é…ç½®æ–‡ä»¶-Libvirtd"><a href="#æ ‡å‡†é…ç½®æ–‡ä»¶-Libvirtd" class="headerlink" title="æ ‡å‡†é…ç½®æ–‡ä»¶ - Libvirtd"></a>æ ‡å‡†é…ç½®æ–‡ä»¶ - Libvirtd</h2><pre class="language-none"><code class="language-none">[Unit]
Description&#x3D;Virtualization daemon
Requires&#x3D;virtlogd.socket
Requires&#x3D;virtlockd.socket
Wants&#x3D;systemd-machined.service
Before&#x3D;libvirt-guests.service
After&#x3D;network.target
After&#x3D;dbus.service
After&#x3D;iscsid.service
After&#x3D;apparmor.service
After&#x3D;local-fs.target
After&#x3D;remote-fs.target
After&#x3D;systemd-logind.service
After&#x3D;systemd-machined.service
Documentation&#x3D;man:libvirtd(8)
Documentation&#x3D;https:&#x2F;&#x2F;libvirt.org

[Service]
Type&#x3D;simple
EnvironmentFile&#x3D;-&#x2F;etc&#x2F;conf.d&#x2F;libvirtd
ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;libvirtd $LIBVIRTD_ARGS
ExecReload&#x3D;&#x2F;bin&#x2F;kill -HUP $MAINPID
KillMode&#x3D;process
Restart&#x3D;on-failure
# At least 1 FD per guest, often 2 (eg qemu monitor + qemu agent).
# eg if we want to support 4096 guests, we&#39;ll typically need 8192 FDs
# If changing this, also consider virtlogd.service &amp; virtlockd.service
# limits which are also related to number of guests
LimitNOFILE&#x3D;8192
# The cgroups pids controller can limit the number of tasks started by
# the daemon, which can limit the number of domains for some hypervisors.
# A conservative default of 8 tasks per guest results in a TasksMax of
# 32k to support 4096 guests.
TasksMax&#x3D;32768

[Install]
WantedBy&#x3D;multi-user.target
Also&#x3D;virtlockd.socket
Also&#x3D;virtlogd.socket</code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 18.04 å†…æ ¸ç¼–è¯‘åˆè¯•</title>
    <url>/2021/07/01/Linux/Linux_Ubuntu-kernel-Complie/</url>
    <content><![CDATA[<p>Ubuntu 18.04 ä¸Šç¼–è¯‘å†…æ ¸ï¼Œç”Ÿæˆdebå®‰è£…åŒ…çš„è¿‡ç¨‹å’Œé‡åˆ°çš„é—®é¢˜ã€‚<br>ä½¿ç”¨å·¥å…·ï¼š Linux-tkg<br>ç³»ç»Ÿç‰ˆæœ¬ï¼š Ubuntu18.04<br>å†…æ ¸ç‰ˆæœ¬ï¼š 5.12-muqss-6ms-skylake</p>
<h1 id="èƒŒæ™¯è¯´æ˜"><a href="#èƒŒæ™¯è¯´æ˜" class="headerlink" title="èƒŒæ™¯è¯´æ˜"></a>èƒŒæ™¯è¯´æ˜</h1><p>çœ‹åˆ°Bç«™å¤§ä½¬çš„æ•™å­¦è§†é¢‘ï¼Œ ä½¿ç”¨Linuxtkgè¿›è¡Œå†…æ ¸çš„ç¼–è¯‘æ‰“åŒ…å’Œæ·»åŠ muqssCPUè°ƒåº¦å™¨ï¼Œ æƒ³è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œ åŒæ—¶ç†Ÿæ‚‰ä¸€ä¸‹Ubuntuå¸¸è§çš„å·¥å…·é“¾ï¼Œæ‰€ä»¥å°±å¼€å§‹åšäº†è¿™ä¸ªäº‹æƒ…ã€‚</p>
<ol>
<li><p>é¦–å…ˆæ˜¯éœ€è¦å¯¹ç³»ç»Ÿè¿›è¡Œåˆå§‹åŒ–ï¼Œ éœ€è¦ä¸€äº›åº•å±‚çš„å·¥å…·åŒ…ã€‚ åœ¨Ubuntuä¸Šé¢è¿˜æ˜¯æœ‰äº›é—®é¢˜çš„ï¼Œ è¿™ä¸ªå‘è‡ªå·±è¸©äº†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> zstd <span class="token function">git</span> <span class="token function">wget</span> <span class="token function">sudo</span> <span class="token function">bc</span> <span class="token function">rsync</span> kmod cpio libelf-dev build-essential fakeroot libncurse5-dev libssl-dev ccache bison flex qtbase5-dev kernel-package</code></pre>

<p>NOTE: è¿™é‡Œé¢æˆ‘é‡åˆ°å°‘äº†pkgä½†æ˜¯æ²¡æœ‰æ˜ç¡®æŠ¥é”™çš„æ˜¯ï¼š<strong>zstd &amp; kernel-package</strong> ï¼Œè¿™ä¸¤ä¸ªå¦‚æœæ²¡æœ‰æ­£ç¡®çš„å®‰è£…æŠ¥é”™æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ï¼Œ å®Œå…¨ä¸èƒ½å®šå‘åˆ°é—®é¢˜æ˜¯ç¼ºå°‘äº†è¿™ä¸¤ä¸ªåŒ…ã€‚ ï¼ˆè€Œå®˜æ–¹çš„æ‰‹å†Œä¸­ä¹Ÿæ²¡æœ‰å†™éœ€è¦å®‰è£…kernel-packageå°±æ¯”è¾ƒå‘çˆ¹</p>
</li>
<li><p>ä¹‹åå°±æ˜¯ä¸‹è½½Linux-tkg ï¼Œå»ºè®®ç›´æ¥ä»Githubä¸‹è½½ï¼Œ <a href="https://github.com/Frogging-Family/linux-tkg">Linux-tkg official address</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">git</span> clone https://github.com/Frogging-Family/linux-tkg.git</code></pre>
</li>
<li><p>åœ¨cloneå®Œæˆä¹‹åï¼Œ æ‰§è¡Œä¸‹é¢çš„.&#x2F;install.sh config, æŒ‰ç…§æç¤ºå›ç­”ç›¸å…³çš„é—®é¢˜ã€‚ </p>
</li>
<li><p>æˆ–è€…å¯ä»¥ç›´æ¥ç¼–è¾‘å…¶ä¸­çš„customization.cfgæ¥è®¾ç½®é»˜è®¤çš„å‚æ•°ã€‚ï¼ˆè¿™ä¸ªæ–‡ä»¶ä¸­éƒ½æ˜¯æœ‰è¯´æ˜çš„ï¼Œè¿˜ç®—æ˜¯æ¯”è¾ƒè¯¦ç»†ï¼Œ ä¸€èˆ¬å¯ä»¥ç›´æ¥çœ‹æ‡‚ã€‚ </p>
</li>
<li><p>å›ç­”å®Œæˆé—®é¢˜ä¹‹åä¼šç”Ÿæˆå¯¹åº”çš„configæ–‡ä»¶ã€‚</p>
</li>
<li><p>æ‰§è¡Œ.&#x2F;install.sh installï¼Œ ä¹‹åä¼šæœ‰å‡ ä¸ªä¸åŒçš„å‘è¡Œç‰ˆçš„é€‰æ‹©ï¼Œ åªéœ€è¦é€‰æ‹©è‡ªå·±éœ€è¦çš„å³å¯ï¼Œ å¦‚æœæ˜¯Debç³»çš„ä¼šè‡ªåŠ¨å¯åŠ¨ç¼–è¯‘å‘½ä»¤ make -j32 deb-pkg ,è‡ªåŠ¨ç”Ÿæˆçš„è½¯ä»¶åŒ…åœ¨.&#x2F;DEBS&#x2F;*.deb.ç›´æ¥å®‰è£…å³å¯ã€‚å¦‚æœæ˜¯rpmä¹Ÿä¼šç”ŸæˆRPMSã€‚</p>
</li>
<li><p>å¦‚æœä¸­é€”æŠ¥é”™ ï¼Œ æˆ‘ä¹Ÿä¸çŸ¥é“å…·ä½“çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰å‘ç°çš„é—®é¢˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸åŒç‰ˆæœ¬çš„ubuntu è¡¨ç°æ˜¯ä¸åŒçš„ï¼Œ éœ‡æƒŠï¼ åŒæ ·çš„è®¾ç½®å‚æ•° ï¼ŒåŒæ ·çš„å†…æ ¸ä»£ç å’Œè¡¥ä¸ï¼Œåœ¨Ubuntu 18.04 å’Œ 20.04 ï¼Œ 20.04 ä¼šæˆåŠŸã€‚</li>
<li>ä¸åŒç¯å¢ƒçš„ç»“æœæ˜¯ä¸åŒçš„ï¼Œ åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šé¢ èµ·Dockerå®¹å™¨è¿›è¡Œåˆå§‹åŒ–ä¹‹åç¼–è¯‘ ä¼šæˆåŠŸçš„ã€‚ åœ¨ç¬”è®°æœ¬ä¸Šä¸ä¸€å®šä¼šæˆåŠŸã€‚ </li>
<li>ç›®å‰æ²¡æœ‰æ€»ç»“å‡ºä»»ä½•çš„ç›¸å…³è§„å¾‹ï¼Œ å¤ªä»»æ€§äº†åªèƒ½è¯´ã€‚ </li>
<li>å¦‚æœæ˜¯ä¸æ‰“åŒ…æˆdebï¼Œç›®å‰çš„æˆåŠŸç‡æ˜¯100%ï¼ˆåŒ…æ‹¬ç›´æ¥å°†æ–‡ä»¶é‡Šæ”¾åˆ°ç³»ç»Ÿä¸­ï¼Œ å’Œæ‰“æˆrpmï¼‰ã€‚</li>
</ol>
</li>
</ol>
<hr>
<p>ç°åœ¨èƒ½æƒ³åˆ°çš„å·®ä¸å¤šè¿™äº›å§ ï¼Œ åæ­£ç¼–è¯‘å‡ºé”™å°±æ˜¯dpkg-package ERROR 2 ï¼Œ æˆ‘ç°åœ¨æ»¡è„‘å­éƒ½æ˜¯ERROR 2äº†ï¼Œ å‘Šè¾ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>vimç¬”è®°</title>
    <url>/2019/07/08/Linux/Linux_VIM-note/</url>
    <content><![CDATA[<p>vimçš„å¸¸ç”¨çš„å‘½ä»¤é€Ÿè®°ã€‚  </p>
<span id="more"></span>
<p>å¯åœ¨~&#x2F;.vimrcä¸­è¿›è¡Œvimçš„çš„é»˜è®¤é…ç½®ï¼Œecho â€˜:set nuâ€™ &gt; ~&#x2F;.vimrcå³å¯è®¾ç½®vimé»˜è®¤æ˜¾ç¤ºè¡Œå·ã€‚<br><a href="https://www.w3cschool.cn/regex_rmjc/">30åˆ†é’Ÿæ­£åˆ™è¡¨è¾¾å¼å…¥é—¨æ•™ç¨‹</a></p>
<h1 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h1><p>ä¸€ç§æ¨¡å¼åŒ–çš„ç¼–è¾‘å™¨ï¼Œå…·æœ‰å¤šç§ä¸åŒçš„æ¨¡å¼ã€‚  </p>
<ol>
<li>ç¼–è¾‘æ¨¡å¼ï¼Œå‘½ä»¤æ¨¡å¼</li>
<li>æ’å…¥æ¨¡å¼</li>
<li>æœ«è¡Œæ¨¡å¼<br> å†…ç½®çš„å‘½ä»¤è¡Œæ¥å£</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> +12 test.sh
<span class="token function">vim</span> +/PATTERN test.sh æ‰“å¼€è‡ªåŠ¨å®šä½åˆ°åŒ¹é…æ¨¡å¼çš„ç¬¬ä¸€ä¸ªç»“æœçš„è¡Œé¦–ã€‚
<span class="token function">vim</span> + test.sh ç›´æ¥å‡ºç°åœ¨æ–‡ä»¶æœ«å°¾  </code></pre>
<h2 id="åˆ‡æ¢æ¨¡å¼çš„è¯´æ˜"><a href="#åˆ‡æ¢æ¨¡å¼çš„è¯´æ˜" class="headerlink" title="åˆ‡æ¢æ¨¡å¼çš„è¯´æ˜"></a>åˆ‡æ¢æ¨¡å¼çš„è¯´æ˜</h2><p>i â€“ ç›´æ¥åœ¨å½“å‰å…‰æ ‡çš„ä½ç½®è¾“å…¥<br>a â€“ åœ¨å…‰æ ‡å­—ç¬¦çš„åé¢è¾“å…¥<br>o â€“ åœ¨å…‰æ ‡ä¸‹é¢ç›´æ¥æ–°å»ºä¸€è¡Œï¼Œå¼€å§‹è¾“å…¥<br>I â€“ åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œé¦–è¾“å…¥<br>O â€“ åœ¨å…‰æ ‡æ‰€åœ¨çš„ä¸Šé¢ç›´æ¥æ–°å»ºä¸€è¡Œï¼Œå¼€å§‹è¾“å…¥<br>A â€“ åœ¨å…‰æ‰€æ‰€åœ¨è¡Œçš„è¡Œå°¾è¾“å…¥</p>
<p>ç¼–è¾‘æ¨¡å¼åˆ°æœ«è¡Œæ¨¡å¼ ä½¿ç”¨ç¬¦å· ï¼š<br>:10ï¼Œ100d<br>:set nu<br>:set nonu<br>:s&#x2F;dhcp&#x2F;static&#x2F;g</p>
<p>å…³é—­æ–‡ä»¶ï¼š<br>    ç¼–è¾‘æ¨¡å¼ä¸‹ è¿ç»­ZZï¼Œè¡¨ç¤ºä¿å­˜é€€å‡º<br>    :q è¡¨ç¤ºç›´æ¥é€€å‡ºï¼Œç±»ä¼¼çš„å¸¸ç”¨è¿˜æœ‰ :wq :wq! :q! :w! :w<br>    :x ä¿å­˜é€€å‡º<br>    :w [PATHTOFILE]</p>
<p>å…‰æ ‡è°ƒæ•´:<br>å­—ç¬¦é—´<br>hjkl å·¦ ä¸‹ ä¸Š å³ 10l å³ä¾§10ä¸ªå­—ç¬¦<br>w ä¸‹ä¸€ä¸ªå•è¯çš„è¯é¦–<br>b å‰ä¸€ä¸ªå•è¯çš„è¯é¦–<br>e ä¸‹ä¸€ä¸ªå•è¯çš„è¯å°¾</p>
<p>è¡Œé¦–è¡Œå°¾<br>^ è°ƒè‡³è¡Œé¦–ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦<br>0 è°ƒè‡³è¡Œé¦–<br>$ è°ƒè‡³è¡Œå°¾</p>
<p>HIJK è¡Œé—´<br>G ç›´æ¥åˆ°æœ€åä¸€è¡Œ<br>å¥é—´<br>æ®µé—´</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Neovim å…¨ Lua é…ç½®</title>
    <url>/2023/08/05/Linux/Linux_VIM_Neovim-Lua-from-scratch/</url>
    <content><![CDATA[<p>å†™è¿™ä¸ªæ˜¯ä¸ºäº†è®°å½•ä¸€ä¸‹æˆ‘æ–°çš„VIMé…ç½®å’ŒVIMçš„å¿«æ·é”®ï¼Œçœ‹èµ·æ¥luaçš„ç‰ˆæœ¬æ¯”ä¹‹å‰çš„scriptsè¦å¥½çš„å¤šï¼Œ æ— è®ºæ˜¯ä½¿ç”¨çš„æ–¹å¼è¿˜æ˜¯å¯åŠ¨çš„é€Ÿåº¦ï¼Œ éƒ½æ¯”ä¹‹å‰å¿«ã€‚ </p>
<h2 id="æˆ‘çš„éœ€æ±‚ï¼š"><a href="#æˆ‘çš„éœ€æ±‚ï¼š" class="headerlink" title="æˆ‘çš„éœ€æ±‚ï¼š"></a>æˆ‘çš„éœ€æ±‚ï¼š</h2><ul>
<li>æ‰“å¼€ä»£ç ï¼Œ ä¼šæ˜¾ç¤ºä»£ç é«˜äº®ã€‚ </li>
<li>vimå¯ä»¥é»˜è®¤æ»¡è¶³çš„è¦æ±‚ï¼Œ å°½å¯èƒ½å°‘çš„ä½¿ç”¨é¼ æ ‡ã€‚</li>
<li>ä»£ç é”™è¯¯æç¤º LSP ï¼Œ æŒ‚äº†Language Server. ( Already Config, but not work. Thinking About this.</li>
<li>ä¸»é¢˜ï¼Œ ç›®å‰ä½¿ç”¨çš„æ˜¯ catppuccin-frappe</li>
<li>Markdown Preview ï¼ˆ Pendingâ€¦.</li>
<li>ä»£ç è¡¥å…¨ï¼ˆAlready Done.</li>
</ul>
<h2 id="æˆ‘çš„å¿«æ·é”®æ¸…å•ï¼š"><a href="#æˆ‘çš„å¿«æ·é”®æ¸…å•ï¼š" class="headerlink" title="æˆ‘çš„å¿«æ·é”®æ¸…å•ï¼š"></a>æˆ‘çš„å¿«æ·é”®æ¸…å•ï¼š</h2><table>
<thead>
<tr>
<th align="right">Mappings</th>
<th>Actions</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><code> &lt;Leader-1&gt;</code></td>
<td>é«˜äº®ç¬¬ 1 åˆ—ï¼Œ é«˜äº®åˆ—ï¼Œ é¦–å­—æ¯ç¼©è¿›æ£€æŸ¥</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-2&gt;</code></td>
<td>é«˜äº®ç¬¬ 3 åˆ—ï¼Œ é«˜äº®åˆ—ï¼Œ åŒç©ºæ ¼ç¼©è¿›æ£€æŸ¥</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-3&gt;</code></td>
<td>é«˜äº®ç¬¬ 5 åˆ—ï¼Œ é«˜äº®åˆ—ï¼Œ 4ç©ºæ ¼ç¼©è¿›æ£€æŸ¥</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-4&gt;</code></td>
<td>é«˜äº®ç¬¬ 9 åˆ—ï¼Œ é«˜äº®åˆ—ï¼Œ 8ç©ºæ ¼ç¼©è¿›æ£€æŸ¥</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-a&gt;</code></td>
<td>æ­é…Visual block mode è¿›è¡Œbash shell çš„æ³¨é‡Šï¼Œè¡Œé¦–æ·»åŠ #</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-x&gt;</code></td>
<td>åŒä¸Šï¼Œåˆ é™¤æ³¨é‡Šã€‚</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-r&gt;</code></td>
<td>KubeApply (Fixed, Ready to use.)</td>
</tr>
<tr>
<td align="right"><code> &lt;Leader-e&gt;</code></td>
<td>KubeDelete (Fixed, Ready to use.)</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-dr&gt;</code></td>
<td>KubeApplyDIr (Fixed, Ready to use.)</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-de&gt;</code></td>
<td>KubeDeleteDir (Fixed, Ready to use.)</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-ff&gt;</code></td>
<td>Telescope Find FIles æŸ¥æ‰¾æ–‡ä»¶</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-fg&gt;</code></td>
<td>Telescope Find Live grep è¿‡æ»¤æ–‡ä»¶ä¸­çš„å…³é”®å­—</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-fb&gt;</code></td>
<td>Telescope Find Buffer æŸ¥çœ‹Bufferä¸­çš„æ•°æ®ã€‚VIMbuffer</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-fh&gt;</code></td>
<td>Telescope Find Helpï¼ˆ Maybe not useï¼Œ Just record</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-ps&gt;</code></td>
<td>This is Alias for :PackerSync.</td>
</tr>
<tr>
<td align="right"><code>&lt;Leader-ms&gt;</code></td>
<td>This is Alias for :Mason.</td>
</tr>
<tr>
<td align="right"><code>&lt;C-n&gt;</code></td>
<td>Telescope PageDown åœ¨Insertæ¨¡å¼ä¸‹é¢çš„ä¸Šä¸‹ç§»åŠ¨ã€‚</td>
</tr>
<tr>
<td align="right"><code>&lt;C-p&gt;</code></td>
<td>Telescope PageUp åœ¨Insertæ¨¡å¼ä¸‹é¢çš„ä¸Šä¸‹ç§»åŠ¨ã€‚</td>
</tr>
<tr>
<td align="right"><code>&lt;j / k&gt;</code></td>
<td>Telescope NORMAL Up&#x2F;Down Normalæ¨¡å¼ä¸‹çš„ä¸Šä¸‹ç§»åŠ¨ã€‚</td>
</tr>
<tr>
<td align="right"><code>&lt;C-x&gt;</code></td>
<td>Telescope Go to file selection as a split æ‰¾åˆ°çš„æ–‡ä»¶ç›´æ¥æ°´å¹³å¼€æ–°çª—å£ï¼ˆä¸‹æ–¹</td>
</tr>
<tr>
<td align="right"><code>&lt;C-v&gt;</code></td>
<td>Telescope Go to file selection as a vsplit æ‰¾åˆ°çš„æ–‡ä»¶ç›´æ¥å‚ç›´å¼€æ–°çª—å£ï¼ˆå³ä¾§</td>
</tr>
<tr>
<td align="right"><code>&lt;C-t&gt;</code></td>
<td>Telescope Go to a file in a new tab æ‰¾åˆ°çš„æ–‡ä»¶å¼€æ–°çš„VIM tabï¼Œ æ„Ÿè§‰ä¸æ˜¯éå¸¸çš„å¥½ç”¨ï¼Œå‚ç›´ä¼šç»å¸¸è¢«ç”¨åˆ°ã€‚</td>
</tr>
<tr>
<td align="right"><code>&lt;C-/&gt;</code></td>
<td>Telescope Show mappings for picker actions (insert mode)  å¸®åŠ©</td>
</tr>
<tr>
<td align="right"><code>?</code></td>
<td>Telescope Show mappings for picker actions (normal mode) å¸®åŠ©</td>
</tr>
<tr>
<td align="right"><code>&lt;M-f&gt;</code></td>
<td>Scroll left in results window</td>
</tr>
<tr>
<td align="right"><code>&lt;M-b&gt;</code></td>
<td>Scroll right in results window</td>
</tr>
<tr>
<td align="right"></td>
<td></td>
</tr>
<tr>
<td align="right"></td>
<td></td>
</tr>
</tbody></table>
<p>å…¶ä»–çš„è¿˜åœ¨é…ç½®å’Œå­¦ä¹ ä¸­ï¼Œ å…ˆè¿™æ ·æŠŠã€‚ã€‚ ä¹‹å‰ç”¨çš„åŠŸèƒ½ä¸å¤ªå¤šï¼Œ æœ‰æ—¶é—´ç»§ç»­çœ‹ã€‚ã€‚ã€‚ã€‚</p>
<h2 id="About-NerdFonts"><a href="#About-NerdFonts" class="headerlink" title="About NerdFonts."></a>About NerdFonts.</h2><p>Nerd ç±»å‹çš„å­—ä½“å®é™…ä»£è¡¨äº† å¸¦æœ‰Iconå­—ç¬¦é›†çš„å­—ä½“ã€‚<br><a href="https://www.nerdfonts.com/#home">https://www.nerdfonts.com/#home</a></p>
<h2 id="å…¶ä»–æŠ€å·§"><a href="#å…¶ä»–æŠ€å·§" class="headerlink" title="å…¶ä»–æŠ€å·§"></a>å…¶ä»–æŠ€å·§</h2><ol>
<li><p>ä¸æ¢è¡Œæ˜¾ç¤ºæ–‡æœ¬æˆ–è€…ä»£ç </p>
<pre class="language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">nowrap</span></code></pre></li>
<li><p>ç›´æ¥grepæ–‡æœ¬çš„å†…å®¹å¹¶æ›¿æ¢å½“å‰bufferä¸­çš„å†…å®¹.<br>æ˜¯çš„ï¼Œå½“å‰æ‰“å¼€çš„æ–‡ä»¶åœ¨VIMé‡Œé¢å…¶å®æ˜¯å«bufferï¼Œ å› ä¸ºå¹¶æœªå®Œæˆå®é™…çš„å†™å…¥ã€‚</p>
<pre class="language-vim" data-language="vim"><code class="language-vim"><span class="token punctuation">:</span><span class="token operator">%</span><span class="token operator">!</span> <span class="token keyword">grep</span> KEYWORD </code></pre></li>
<li><p>ç²˜è´´çš„æ—¶å€™ä¿ç•™æ ¼å¼ã€‚ </p>
<pre class="language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">paste</span>
<span class="token keyword">set</span> <span class="token builtin">nopaste</span></code></pre>
<p>æˆ–è€…æ˜¯å…³é—­autoindent</p>
<pre class="language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token builtin">ai</span>
<span class="token keyword">set</span> <span class="token builtin">noai</span></code></pre>
</li>
<li><p>å‹ç¼©å¤šä¸ªç©ºæ ¼ä¸ºä¸€ä¸ª</p>
<pre class="language-none"><code class="language-none">:%s@  *@ @g</code></pre></li>
<li><p>æ›¿æ¢æ‰€æœ‰çš„ç©ºæ ¼ ä¸º tab </p>
<pre class="language-none"><code class="language-none">:% s@ @\t@g</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>VIM, Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>LinuxåŠvimçš„æŠ€å·§</title>
    <url>/2019/10/10/Linux/Linux_VIM_tricks/</url>
    <content><![CDATA[<p>Linuxçš„ä½¿ç”¨æŠ€å·§å·²ç»vimçš„å¸¸ç”¨è®¾ç½®åŠæ’ä»¶ã€‚</p>
<span id="more"></span>

<h3 id="1-åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¿ç•™æ‰€æœ‰æ–‡ä»¶"><a href="#1-åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¿ç•™æ‰€æœ‰æ–‡ä»¶" class="headerlink" title="1. åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¿ç•™æ‰€æœ‰æ–‡ä»¶"></a>1. åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ä¿ç•™æ‰€æœ‰æ–‡ä»¶</h3><pre class="language-none"><code class="language-none">find .&#x2F; -type d ! -name . | xargs rm -rf</code></pre>
<h3 id="2-è®¾ç½®vimçš„ä¸ªæ€§åŒ–è®¾ç½®"><a href="#2-è®¾ç½®vimçš„ä¸ªæ€§åŒ–è®¾ç½®" class="headerlink" title="2. è®¾ç½®vimçš„ä¸ªæ€§åŒ–è®¾ç½®"></a>2. è®¾ç½®vimçš„ä¸ªæ€§åŒ–è®¾ç½®</h3><p>è®¾ç½®è‡ªåŠ¨æ˜¾ç¤ºè¡Œå·ï¼Œè®¾ç½®VIMè‡ªåŠ¨å°†tabè½¬åŒ–ä¸º4ä¸ªç©ºæ ¼</p>
<pre class="language-none"><code class="language-none">:set nu
:set tabstop&#x3D;4
:set softtabstop&#x3D;4
:set shiftwidth&#x3D;4
:set expandtab</code></pre>

<h3 id="3-å·²ç»ç¼–è¾‘çš„æ–‡ä»¶è¿›è¡Œtabç©ºæ ¼è½¬æ¢ï¼š"><a href="#3-å·²ç»ç¼–è¾‘çš„æ–‡ä»¶è¿›è¡Œtabç©ºæ ¼è½¬æ¢ï¼š" class="headerlink" title="3. å·²ç»ç¼–è¾‘çš„æ–‡ä»¶è¿›è¡Œtabç©ºæ ¼è½¬æ¢ï¼š"></a>3. å·²ç»ç¼–è¾‘çš„æ–‡ä»¶è¿›è¡Œtabç©ºæ ¼è½¬æ¢ï¼š</h3><ul>
<li>TABæ›¿æ¢ä¸ºç©ºæ ¼ï¼š<pre class="language-bash" data-language="bash"><code class="language-bash">:set <span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">4</span>
:set expandtab
:%retab<span class="token operator">!</span></code></pre></li>
<li>ç©ºæ ¼æ›¿æ¢ä¸ºTABï¼š<pre class="language-bash" data-language="bash"><code class="language-bash">:set <span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">4</span>
:set noexpandtab
:%retab<span class="token operator">!</span></code></pre></li>
</ul>
<h3 id="4-vimçš„ä¸ªæ€§åŒ–é…ç½®åŠæ’ä»¶"><a href="#4-vimçš„ä¸ªæ€§åŒ–é…ç½®åŠæ’ä»¶" class="headerlink" title="4. vimçš„ä¸ªæ€§åŒ–é…ç½®åŠæ’ä»¶"></a>4. vimçš„ä¸ªæ€§åŒ–é…ç½®åŠæ’ä»¶</h3><ul>
<li><p>è‡ªåŠ¨æ¢è¡Œ</p>
<p>set wrap</p>
</li>
<li><p>è¾“å…¥å‘½ä»¤æ—¶è‡ªåŠ¨æç¤ºè¡¥å®Œ</p>
<p>set showcmd</p>
</li>
<li><p>æ˜¾ç¤ºè¡Œå·</p>
<p>set nu</p>
</li>
<li><p>æ˜¾ç¤ºå½“å‰è¡Œå·åŠå…³è”å‰åè¡Œå·</p>
<p>set relativenumber</p>
</li>
<li><p>è¯­æ³•é«˜äº®</p>
<p>syntax on </p>
</li>
<li><p>å…‰æ ‡æ‰€åœ¨çš„è¡Œé«˜äº®</p>
<p>set cursorline</p>
</li>
<li><p>å‰åæ»šåŠ¨æ—¶ä¿ç•™æœ€å‰å’Œæœ€åçš„5è¡Œ</p>
<p>set scrolloff&#x3D;5</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Vim</tag>
      </tags>
  </entry>
  <entry>
    <title>KVMä¸­windows7è™šæ‹Ÿæœºæ—¶é—´é—®é¢˜</title>
    <url>/2019/06/25/Linux/Linux_VM-timer/</url>
    <content><![CDATA[<p>åœ¨KVMè™šæ‹Ÿæœºä¸­ï¼Œå®‰è£…Windows7çš„è™šæ‹Ÿæœºï¼Œå®‰è£…å®Œæˆå¯åŠ¨çš„æ—¶å€™å‘ç°è™šæ‹Ÿæœºçš„æ—¶é—´ä¸å¤–éƒ¨æ—¶é—´çš„é€Ÿåº¦ä¸ä¸€è‡´ã€‚è®°å½•é—®é¢˜çš„åŸå› åŠè§£å†³æ–¹æ³•ã€‚</p>
<h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><h3 id="æŸ¥çœ‹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶</h3><p>è§‚å¯Ÿè¿è¡Œçš„æ•ˆæœç±»ä¼¼äºGBAæ¨¡æ‹Ÿå™¨çš„åŠ é€Ÿè®¾å®šï¼ŒåŠ¨ç”»é€Ÿåº¦å˜å¿«äº†ï¼Œwindows7çš„ç³»ç»Ÿæ—¶é—´ä¹Ÿè¢«åŠ é€Ÿäº†ã€‚  é¦–å…ˆæ€€ç–‘çš„æ˜¯è™šæ‹Ÿæœºçš„è¿è¡Œé€Ÿåº¦æ˜¯ä¸æ˜¯è¢«åŠ é€Ÿäº†ï¼Œæ²¡æœ‰ç›¸å…³çš„è®¾ç½®ã€‚<br>å…¶æ¬¡æ˜¯æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸­æ—¶é—´çš„ç›¸å…³å®šä¹‰ï¼Œå‘ç°æˆ‘çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ—¶é—´çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>clock</span> <span class="token attr-name">offset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>localtime<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>rtc<span class="token punctuation">'</span></span> <span class="token attr-name">tickpolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>catchup<span class="token punctuation">'</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>pit<span class="token punctuation">'</span></span> <span class="token attr-name">tickpolicy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>delay<span class="token punctuation">'</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>hpet<span class="token punctuation">'</span></span> <span class="token attr-name">present</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>no<span class="token punctuation">'</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>hypervclock<span class="token punctuation">'</span></span> <span class="token attr-name">present</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>yes<span class="token punctuation">'</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>clock</span><span class="token punctuation">></span></span></code></pre>
<p>æ€€ç–‘è¿™å‡ ä¸ªtimeræ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸€èˆ¬æ¥è¯´é…ç½®æ–‡ä»¶ä¸­åªæœ‰ç®€å•çš„ clock offset&#x3D;â€™localtimeâ€™ çš„å­—æ®µå…¶å®å°±å¤Ÿç”¨äº†ã€‚<br>åœ¨åˆ é™¤äº†ç¬¬ä¸€ä¸ªtimerä¹‹åï¼Œç³»ç»Ÿçš„æ—¶é—´å’Œè¿è¡Œé€Ÿåº¦å°±æ­£å¸¸äº†ã€‚</p>
<h3 id="åœ¨fedora-wikiæ‰¾åˆ°çš„è¯´æ˜é¡µé¢"><a href="#åœ¨fedora-wikiæ‰¾åˆ°çš„è¯´æ˜é¡µé¢" class="headerlink" title="åœ¨fedora-wikiæ‰¾åˆ°çš„è¯´æ˜é¡µé¢"></a>åœ¨fedora-wikiæ‰¾åˆ°çš„è¯´æ˜é¡µé¢</h3><p><a href="https://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html/Virtualization_Deployment_and_Administration_Guide/sect-Virtualization-Tips_and_tricks-Libvirt_Managed_Timers.html">Libvirt_Managed_Timersé¡µé¢é“¾æ¥</a><br>åœ¨å­—æ®µä¸­â€˜rtcâ€™å¹¶ä¸æ˜¯ä¸»è¦çš„é—®é¢˜ï¼Œä¸»è¦é—®é¢˜æ˜¯åé¢çš„tickpolicy&#x3D;â€™catchcupâ€™ã€‚fedora wikiç»™å‡ºçš„ç­”æ¡ˆæ˜¯catchupâ€“Deliver at a higher rate to catch up.<br>æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆ é™¤äº†è¿™ä¸ªtimerä¹‹åç³»ç»Ÿæ­£å¸¸çš„åŸå› ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, KVM</tag>
      </tags>
  </entry>
  <entry>
    <title>X11 é€šè¿‡ ssh è½¬å‘å›¾å½¢åŒ–ç•Œé¢</title>
    <url>/2023/08/16/Linux/Linux_X11Forward/</url>
    <content><![CDATA[<h2 id="Ssh-è½¬å‘-X11"><a href="#Ssh-è½¬å‘-X11" class="headerlink" title="Ssh è½¬å‘ X11"></a>Ssh è½¬å‘ X11</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> xorg-x11-xauth xorg-x11-fonts-* xorg-x11-font-utils xorg-x11-fonts-Type1 xclock

<span class="token function">vim</span> /etc/ssh/sshd_config
  X11Forwarding <span class="token function">yes</span>
  X11UseLocalhost no</code></pre>
<p>è¿è¡Œå›¾å½¢åŒ–çš„å‘½ä»¤ , è‡ªåŠ¨æ•è·è¯·æ±‚ï¼Œ æŸ¥çœ‹mobextermæ˜¯å¦å·²ç»æ­£å¸¸çš„å¯åŠ¨äº†ä¸€ä¸ªä¸´æ—¶çš„çª—å£æ¥è¿›è¡Œæ•°æ®çš„è½¬å‘å³å¯ ã€‚</p>
<h2 id="Ssh-è½¬å‘è¿æ¥åˆ°è¿œç«¯"><a href="#Ssh-è½¬å‘è¿æ¥åˆ°è¿œç«¯" class="headerlink" title="Ssh è½¬å‘è¿æ¥åˆ°è¿œç«¯"></a>Ssh è½¬å‘è¿æ¥åˆ°è¿œç«¯</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-L</span> local-port:target-host:target-port tunnel-host
<span class="token function">ssh</span> <span class="token parameter variable">-vvv</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-N</span> <span class="token parameter variable">-D</span> <span class="token number">0.0</span>.0.0:30890 hayden@localhost</code></pre>
<h2 id="Ssh-è½¬å‘å‘½ä»¤å‚æ•°è¯´æ˜"><a href="#Ssh-è½¬å‘å‘½ä»¤å‚æ•°è¯´æ˜" class="headerlink" title="Ssh è½¬å‘å‘½ä»¤å‚æ•°è¯´æ˜"></a>Ssh è½¬å‘å‘½ä»¤å‚æ•°è¯´æ˜</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-L</span> listen-port:host:port æŒ‡æ´¾æœ¬åœ°çš„ port åˆ°è¾¾ç«¯æœºå™¨åœ°å€ä¸Šçš„ port
    å»ºç«‹æœ¬åœ°SSHéš§é“<span class="token punctuation">(</span>æœ¬åœ°å®¢æˆ·ç«¯å»ºç«‹ç›‘å¬ç«¯å£<span class="token punctuation">)</span>
    å°†æœ¬åœ°æœº<span class="token punctuation">(</span>å®¢æˆ·æœº<span class="token punctuation">)</span>çš„æŸä¸ªç«¯å£è½¬å‘åˆ°è¿œç«¯æŒ‡å®šæœºå™¨çš„æŒ‡å®šç«¯å£.

<span class="token parameter variable">-R</span> listen-port:host:port æŒ‡æ´¾è¿œç¨‹ä¸Šçš„ port åˆ°æœ¬åœ°åœ°å€ä¸Šçš„ port
    å»ºç«‹è¿œç¨‹SSHéš§é“<span class="token punctuation">(</span>éš§é“æœåŠ¡ç«¯å»ºç«‹ç›‘å¬ç«¯å£<span class="token punctuation">)</span>
    å°†è¿œç¨‹ä¸»æœº<span class="token punctuation">(</span>æœåŠ¡å™¨<span class="token punctuation">)</span>çš„æŸä¸ªç«¯å£è½¬å‘åˆ°æœ¬åœ°ç«¯æŒ‡å®šæœºå™¨çš„æŒ‡å®šç«¯å£.

<span class="token parameter variable">-D</span> port æŒ‡å®šä¸€ä¸ªæœ¬åœ°æœºå™¨ <span class="token string">"åŠ¨æ€çš„"</span> åº”ç”¨ç¨‹åºç«¯å£è½¬å‘.</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>bpftrace ä½¿ç”¨tracepoint è¿½è¸ª tcp çŠ¶æ€å˜åŒ–</title>
    <url>/2023/03/19/Linux/Linux_bpftrace/</url>
    <content><![CDATA[<h2 id="å…¥é—¨æ•™ç¨‹"><a href="#å…¥é—¨æ•™ç¨‹" class="headerlink" title="å…¥é—¨æ•™ç¨‹"></a>å…¥é—¨æ•™ç¨‹</h2><p>å¤§ä½¬çš„åšå®¢ï¼Œ å…¥é—¨æ•™ç¨‹ï¼š <a href="http://arthurchiao.art/blog/bpf-advanced-notes-1-zh/">http://arthurchiao.art/blog/bpf-advanced-notes-1-zh/</a></p>
<h2 id="è®°å½•åŸºç¡€çš„bpftraceä½¿ç”¨æ–¹æ³•"><a href="#è®°å½•åŸºç¡€çš„bpftraceä½¿ç”¨æ–¹æ³•" class="headerlink" title="è®°å½•åŸºç¡€çš„bpftraceä½¿ç”¨æ–¹æ³•"></a>è®°å½•åŸºç¡€çš„bpftraceä½¿ç”¨æ–¹æ³•</h2><p>å•è¡Œç¨‹åºçš„ä½¿ç”¨æ–¹æ³•</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost-live ~<span class="token punctuation">]</span><span class="token comment"># bpftrace -e 'tracepoint:syscalls:sys_enter_execve &#123; printf("%s %s\n", comm, str(args->filename));&#125;'</span></code></pre>

<h2 id="Tracepointå¦‚ä½•è·å–å¯ç”¨å‚æ•°çš„è§£é‡Š"><a href="#Tracepointå¦‚ä½•è·å–å¯ç”¨å‚æ•°çš„è§£é‡Š" class="headerlink" title="Tracepointå¦‚ä½•è·å–å¯ç”¨å‚æ•°çš„è§£é‡Š"></a>Tracepointå¦‚ä½•è·å–å¯ç”¨å‚æ•°çš„è§£é‡Š</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost-live sys_enter_execve<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/sys/kernel/tracing/events/syscalls/sys_enter_execve
<span class="token punctuation">[</span>root@localhost-live sys_enter_execve<span class="token punctuation">]</span><span class="token comment"># grep -ri .</span>
format:name: sys_enter_execve
format:ID: <span class="token number">742</span>
format:format:
format:	field:unsigned short common_type<span class="token punctuation">;</span>	offset:0<span class="token punctuation">;</span>	size:2<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:	field:unsigned char common_flags<span class="token punctuation">;</span>	offset:2<span class="token punctuation">;</span>	size:1<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:	field:unsigned char common_preempt_count<span class="token punctuation">;</span>	offset:3<span class="token punctuation">;</span>	size:1<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:	field:int common_pid<span class="token punctuation">;</span>	offset:4<span class="token punctuation">;</span>	size:4<span class="token punctuation">;</span>	signed:1<span class="token punctuation">;</span>
format:	field:int __syscall_nr<span class="token punctuation">;</span>	offset:8<span class="token punctuation">;</span>	size:4<span class="token punctuation">;</span>	signed:1<span class="token punctuation">;</span>
format:	field:const char * filename<span class="token punctuation">;</span>	offset:16<span class="token punctuation">;</span>	size:8<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:	field:const char *const * argv<span class="token punctuation">;</span>	offset:24<span class="token punctuation">;</span>	size:8<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:	field:const char *const * envp<span class="token punctuation">;</span>	offset:32<span class="token punctuation">;</span>	size:8<span class="token punctuation">;</span>	signed:0<span class="token punctuation">;</span>
format:print fmt: <span class="token string">"filename: 0x%08lx, argv: 0x%08lx, envp: 0x%08lx"</span>, <span class="token variable"><span class="token punctuation">((</span>unsigned long<span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-</span><span class="token operator">></span>filename<span class="token punctuation">))</span></span>, <span class="token variable"><span class="token punctuation">((</span>unsigned long<span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-</span><span class="token operator">></span>argv<span class="token punctuation">))</span></span>, <span class="token variable"><span class="token punctuation">((</span>unsigned long<span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-</span><span class="token operator">></span>envp<span class="token punctuation">))</span></span>
trigger:<span class="token comment"># Available triggers:</span>
trigger:<span class="token comment"># traceon traceoff snapshot stacktrace enable_event disable_event enable_hist disable_hist hist</span>
filter:none
id:742
enable:0</code></pre>

<h2 id="è®°å½•å°è¯•è¿½è¸ªtcpçŠ¶æ€å˜åŒ–çš„æ–¹æ³•"><a href="#è®°å½•å°è¯•è¿½è¸ªtcpçŠ¶æ€å˜åŒ–çš„æ–¹æ³•" class="headerlink" title="è®°å½•å°è¯•è¿½è¸ªtcpçŠ¶æ€å˜åŒ–çš„æ–¹æ³•"></a>è®°å½•å°è¯•è¿½è¸ªtcpçŠ¶æ€å˜åŒ–çš„æ–¹æ³•</h2><p>å…³äºbpftraceè¿½è¸ªçš„æ€»ç»“, è¿½è¸ªtcpçŠ¶æ€çš„æ–¹æ³•ï¼Œ é€šè¿‡ä½¿ç”¨ç‰¹å®šçš„tracepointçš„æ¥è·å–tcpçŠ¶æ€çš„å˜åŒ–ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~$ bpftrace <span class="token parameter variable">-e</span> <span class="token string">'tracepoint:sock:inet_sock_set_state &#123; printf("%s %d %d\n", comm, pid, args->newstate); &#125;'</span>
~$ bpftrace <span class="token parameter variable">-e</span> <span class="token string">'tracepoint:sock:inet_sock_set_state &#123; printf("%s - %d -> %d - %d - %s\n",strftime("%H:%M:%S.%L", nsecs), args->oldstate, args->newstate, pid, comm); &#125;'</span></code></pre>

<p>å…³äºè¿”å›å€¼çš„è¯´æ˜ï¼š </p>
<blockquote>
<p><a href="https://gitlab.com/redhat/centos-stream/src/kernel/centos-stream-9/-/blob/main/include/net/tcp_states.h">https://gitlab.com/redhat/centos-stream/src/kernel/centos-stream-9/-/blob/main/include/net/tcp_states.h</a>  </p>
</blockquote>
<p>tcp_set_state æ˜¯ä¸€ä¸ªå†…æ ¸å‡½æ•°ï¼Œç”¨äºè®¾ç½® TCP å¥—æ¥å­—çš„çŠ¶æ€ã€‚å®ƒæœ‰ 12 ä¸ªå¯èƒ½çš„è¿”å›å€¼ï¼Œåˆ†åˆ«å¯¹åº” TCP åè®®ä¸­å®šä¹‰çš„ 12 ç§çŠ¶æ€1ã€‚è¿™äº›çŠ¶æ€æ˜¯ï¼š</p>
<blockquote>
<p>1 TCP_ESTABLISHEDï¼šè¿æ¥å·²å»ºç«‹<br>2 TCP_SYN_SENTï¼šä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œå·²å‘é€ SYN åŒ…<br>3 TCP_SYN_RECVï¼šè¢«åŠ¨æ‰“å¼€è¿æ¥ï¼Œå·²æ”¶åˆ° SYN åŒ…<br>4 TCP_FIN_WAIT1ï¼šä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå·²å‘é€ FIN åŒ…<br>5 TCP_FIN_WAIT2ï¼šä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå·²æ”¶åˆ°å¯¹æ–¹çš„ ACK åŒ…<br>6 TCP_TIME_WAITï¼šä¸»åŠ¨å…³é—­è¿æ¥ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿å¯¹æ–¹æ”¶åˆ°æœ€åä¸€ä¸ª ACK åŒ…<br>7 TCP_CLOSEï¼šè¿æ¥å·²å…³é—­<br>8 TCP_CLOSE_WAITï¼šè¢«åŠ¨å…³é—­è¿æ¥ï¼Œå·²æ”¶åˆ° FIN åŒ…<br>9 TCP_LAST_ACKï¼šè¢«åŠ¨å…³é—­è¿æ¥ï¼Œå·²å‘é€æœ€åä¸€ä¸ª ACK åŒ…<br>10 TCP_LISTENï¼šç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…è¢«åŠ¨æ‰“å¼€è¿æ¥<br>11 TCP_CLOSINGï¼šåŒæ–¹åŒæ—¶å…³é—­è¿æ¥ï¼Œäº¤æ¢ FIN å’Œ ACK åŒ…çš„è¿‡ç¨‹ä¸­<br>12 TCP_NEW_SYN_RECVï¼šä¸´æ—¶çŠ¶æ€ï¼Œç”¨äºå¤„ç† SYN é˜Ÿåˆ—æº¢å‡ºçš„æƒ…å†µ</p>
</blockquote>
<p>è¿½è¸ªç‚¹ç†è§£èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œ æŸ¥çœ‹è¿½è¸ªç‚¹å¯ç”¨çš„å‚æ•°ï¼Œåœ¨è¿™ä¸ªéƒ¨åˆ†å¯ä»¥çœ‹ã€‚ </p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token operator">~</span>$ cat <span class="token operator">/</span>sys<span class="token operator">/</span>kernel<span class="token operator">/</span>debug<span class="token operator">/</span>tracing<span class="token operator">/</span>events<span class="token operator">/</span>syscalls<span class="token operator">/</span>sys_enter_sendmsg<span class="token operator">/</span>format
name<span class="token operator">:</span> sys_enter_sendmsg
ID<span class="token operator">:</span> <span class="token number">1252</span>
format<span class="token operator">:</span>
        field<span class="token operator">:</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> common_type<span class="token punctuation">;</span>       offset<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>       size<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> common_flags<span class="token punctuation">;</span>       offset<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span>       size<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> common_preempt_count<span class="token punctuation">;</span>       offset<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">;</span>       size<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">int</span> common_pid<span class="token punctuation">;</span>   offset<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>       size<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> common_preempt_lazy_count<span class="token punctuation">;</span>  offset<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span>       size<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>

        field<span class="token operator">:</span><span class="token keyword">int</span> __syscall_nr<span class="token punctuation">;</span> offset<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">;</span>      size<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">int</span> fd<span class="token punctuation">;</span>   offset<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">;</span>      size<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">struct</span> <span class="token class-name">user_msghdr</span> <span class="token operator">*</span> msg<span class="token punctuation">;</span> offset<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">;</span>      size<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>
        field<span class="token operator">:</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> flags<span class="token punctuation">;</span>       offset<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">;</span>      size<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token keyword">signed</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span>

print fmt<span class="token operator">:</span> <span class="token string">"fd: 0x%08lx, msg: 0x%08lx, flags: 0x%08lx"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-></span>fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-></span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>REC<span class="token operator">-></span>flags<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>å¦‚æœæ˜¯ä½¿ç”¨ kprobe çš„è¯ï¼Œ ä¸èƒ½ä½¿ç”¨ argsï¼Œ éœ€è¦ä½¿ç”¨ç¡®å®šçš„arg0 - argNï¼Œ è¿™ä¸ªéƒ¨åˆ†è¿˜åœ¨æ‘¸ç´¢ï¼Œ ç›®å‰å°è¯•ç”¨è¿™ä¸ªå‚æ•°è¿˜æ˜¯å¤±è´¥ã€‚ å–åˆ°å¯¹åº”çš„å¾—å€¼ï¼Œ ä½†æ˜¯printä¸å‡ºæ¥ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, BPF</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºBTRFSçš„ä¸€äº›æµ‹è¯•</title>
    <url>/2022/04/19/Linux/Linux_btrfs/</url>
    <content><![CDATA[<h2 id="åˆ›å»ºBTRFSå·"><a href="#åˆ›å»ºBTRFSå·" class="headerlink" title="åˆ›å»ºBTRFSå·"></a>åˆ›å»ºBTRFSå·</h2><pre><code>mkfs.btrfs -d single -m raid1 /dev/nvme1n1 /dev/nvme2n1 /dev/nvme3n1 
</code></pre>
<h2 id="æ›´æ”¹btrfsçš„å…ƒæ•°æ®å†—ä½™"><a href="#æ›´æ”¹btrfsçš„å…ƒæ•°æ®å†—ä½™" class="headerlink" title="æ›´æ”¹btrfsçš„å…ƒæ•°æ®å†—ä½™"></a>æ›´æ”¹btrfsçš„å…ƒæ•°æ®å†—ä½™</h2><p>  è¿™é‡Œæœ€å¥½çš„åŠæ³•å½“ç„¶æ˜¯åˆ›å»ºçš„æ—¶å€™å°±è§„åˆ’å’ŒæŒ‡å®šå¥½ã€‚<br>    btrfs balance start -dconvert&#x3D;raid1 -mconvert&#x3D;raid1 &#x2F;mnt</p>
<h2 id="åˆ›å»ºè½»é‡å‰¯æœ¬æ–‡ä»¶"><a href="#åˆ›å»ºè½»é‡å‰¯æœ¬æ–‡ä»¶" class="headerlink" title="åˆ›å»ºè½»é‡å‰¯æœ¬æ–‡ä»¶"></a>åˆ›å»ºè½»é‡å‰¯æœ¬æ–‡ä»¶</h2><pre><code>cp --reflink source dest 
</code></pre>
<p>è®°å½•æµ‹è¯•ç»“æœï¼š</p>
<ol>
<li>å¦‚æœæ˜¯ -d raid0 -m raid1 å¯ä»¥ç›´æ¥å°†ä¸‰ä¸ªEBS IO1 3000IOPSçš„å·åƒæ»¡ï¼Œ ç›´æ¥åˆ°9000</li>
<li>å¦‚æœæ˜¯ -d raid1 -m raid1 åªèƒ½è¾¾åˆ°3000IOPSï¼Œ ä½†æ˜¯å®¹é‡ä¼šæœ‰å†—ä½™ã€‚</li>
</ol>
<h2 id="Randread"><a href="#Randread" class="headerlink" title="Randread"></a>Randread</h2><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">global</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">directory</span><span class="token punctuation">=</span><span class="token value attr-value">/mnt</span>
<span class="token key attr-name">ioengine</span><span class="token punctuation">=</span><span class="token value attr-value">libaio</span>
<span class="token key attr-name">direct</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">randread</span>
<span class="token key attr-name">bs</span><span class="token punctuation">=</span><span class="token value attr-value">16M</span>
<span class="token key attr-name">size</span><span class="token punctuation">=</span><span class="token value attr-value">64M</span>
time_based
<span class="token key attr-name">runtime</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
group_reporting
norandommap
<span class="token key attr-name">numjobs</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
thread

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job1</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">iodepth</span><span class="token punctuation">=</span><span class="token value attr-value">2</span></code></pre>

<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-10-64 fio<span class="token punctuation">]</span><span class="token comment"># fio ./job1</span>
job1: <span class="token punctuation">(</span>g<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token assign-left variable">rw</span><span class="token operator">=</span>randread, <span class="token assign-left variable">bs</span><span class="token operator">=</span>16M-16M/16M-16M/16M-16M, <span class="token assign-left variable">ioengine</span><span class="token operator">=</span>libaio, <span class="token assign-left variable">iodepth</span><span class="token operator">=</span><span class="token number">2</span>
fio-2.14
Starting <span class="token number">1</span> thread
job1: Laying out IO file<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span> file<span class="token punctuation">(</span>s<span class="token punctuation">)</span> / 64MB<span class="token punctuation">)</span>
Jobs: <span class="token number">1</span> <span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token punctuation">[</span>r<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">100.0</span>% done<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">256</span>.0MB/0KB/0KB /s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">16</span>/0/0 iops<span class="token punctuation">]</span> <span class="token punctuation">[</span>eta 00m:00s<span class="token punctuation">]</span>
job1: <span class="token punctuation">(</span>groupid<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">jobs</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token assign-left variable">err</span><span class="token operator">=</span> <span class="token number">0</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">26359</span>: Thu Nov <span class="token number">18</span> 07:59:17 <span class="token number">2021</span>
  <span class="token builtin class-name">read</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">5232</span>.0MB, <span class="token assign-left variable">bw</span><span class="token operator">=</span>266745KB/s, <span class="token assign-left variable">iops</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">runt</span><span class="token operator">=</span> 20085msec
    slat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">70</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">21.39</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">23.43</span>
    clat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">130</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">101.29</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">31.01</span>
     lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">139</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">122.68</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">24.96</span>
    clat percentiles <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>:
     <span class="token operator">|</span>  <span class="token assign-left variable">1.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>    <span class="token number">7</span><span class="token punctuation">]</span>,  <span class="token assign-left variable">5.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">60</span><span class="token punctuation">]</span>, <span class="token assign-left variable">10.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">63</span><span class="token punctuation">]</span>, <span class="token assign-left variable">20.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">66</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">30.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">93</span><span class="token punctuation">]</span>, <span class="token assign-left variable">40.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">110</span><span class="token punctuation">]</span>, <span class="token assign-left variable">50.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">118</span><span class="token punctuation">]</span>, <span class="token assign-left variable">60.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">120</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">70.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">122</span><span class="token punctuation">]</span>, <span class="token assign-left variable">80.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>, <span class="token assign-left variable">90.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">127</span><span class="token punctuation">]</span>, <span class="token assign-left variable">95.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">128</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">130</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.50th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.90th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.95th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.99th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>
    lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">0.31</span>%, <span class="token assign-left variable">10</span><span class="token operator">=</span><span class="token number">3.36</span>%, <span class="token assign-left variable">20</span><span class="token operator">=</span><span class="token number">0.92</span>%, <span class="token assign-left variable">50</span><span class="token operator">=</span><span class="token number">0.31</span>%, <span class="token assign-left variable">100</span><span class="token operator">=</span><span class="token number">28.75</span>%
    lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">250</span><span class="token operator">=</span><span class="token number">66.36</span>%
  cpu          <span class="token builtin class-name">:</span> <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">0.04</span>%, <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">3.80</span>%, <span class="token assign-left variable">ctx</span><span class="token operator">=</span><span class="token number">994</span>, <span class="token assign-left variable">majf</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">minf</span><span class="token operator">=</span><span class="token number">8193</span>
  IO depths    <span class="token builtin class-name">:</span> <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">0.3</span>%, <span class="token assign-left variable">2</span><span class="token operator">=</span><span class="token number">99.7</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     submit    <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     complete  <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     issued    <span class="token builtin class-name">:</span> <span class="token assign-left variable">total</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">327</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">short</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">drop</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>
     latency   <span class="token builtin class-name">:</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">window</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">percentile</span><span class="token operator">=</span><span class="token number">100.00</span>%, <span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">2</span>

Run status group <span class="token number">0</span> <span class="token punctuation">(</span>all <span class="token function">jobs</span><span class="token punctuation">)</span>:
   READ: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">5232</span>.0MB, <span class="token assign-left variable">aggrb</span><span class="token operator">=</span>266744KB/s, <span class="token assign-left variable">minb</span><span class="token operator">=</span>266744KB/s, <span class="token assign-left variable">maxb</span><span class="token operator">=</span>266744KB/s, <span class="token assign-left variable">mint</span><span class="token operator">=</span>20085msec, <span class="token assign-left variable">maxt</span><span class="token operator">=</span>20085msec</code></pre>

<h2 id="Randwrite"><a href="#Randwrite" class="headerlink" title="Randwrite"></a>Randwrite</h2><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">global</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">directory</span><span class="token punctuation">=</span><span class="token value attr-value">/mnt</span>
<span class="token key attr-name">ioengine</span><span class="token punctuation">=</span><span class="token value attr-value">libaio</span>
<span class="token key attr-name">direct</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">randread</span>
<span class="token key attr-name">bs</span><span class="token punctuation">=</span><span class="token value attr-value">16M</span>
<span class="token key attr-name">size</span><span class="token punctuation">=</span><span class="token value attr-value">64M</span>
time_based
<span class="token key attr-name">runtime</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
group_reporting
norandommap
<span class="token key attr-name">numjobs</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
thread

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job1</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">iodepth</span><span class="token punctuation">=</span><span class="token value attr-value">2</span></code></pre>
<h2 id="Result-1"><a href="#Result-1" class="headerlink" title="Result"></a>Result</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-10-64 fio<span class="token punctuation">]</span><span class="token comment"># fio ./job1</span>
job1: <span class="token punctuation">(</span>g<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token assign-left variable">rw</span><span class="token operator">=</span>randwrite, <span class="token assign-left variable">bs</span><span class="token operator">=</span>16M-16M/16M-16M/16M-16M, <span class="token assign-left variable">ioengine</span><span class="token operator">=</span>libaio, <span class="token assign-left variable">iodepth</span><span class="token operator">=</span><span class="token number">2</span>
fio-2.14
Starting <span class="token number">1</span> thread
Jobs: <span class="token number">1</span> <span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token punctuation">[</span>w<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">100.0</span>% done<span class="token punctuation">]</span> <span class="token punctuation">[</span>0KB/256.0MB/0KB /s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">0</span>/16/0 iops<span class="token punctuation">]</span> <span class="token punctuation">[</span>eta 00m:00s<span class="token punctuation">]</span>
job1: <span class="token punctuation">(</span>groupid<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">jobs</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token assign-left variable">err</span><span class="token operator">=</span> <span class="token number">0</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">26385</span>: Thu Nov <span class="token number">18</span> 08:00:56 <span class="token number">2021</span>
  write: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">5248</span>.0MB, <span class="token assign-left variable">bw</span><span class="token operator">=</span>267987KB/s, <span class="token assign-left variable">iops</span><span class="token operator">=</span><span class="token number">16</span>, <span class="token assign-left variable">runt</span><span class="token operator">=</span> 20053msec
    slat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">67</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">12.64</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">21.62</span>
    clat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">12</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">141</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">109.45</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">31.98</span>
     lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">18</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">142</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">122.10</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">25.25</span>
    clat percentiles <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>:
     <span class="token operator">|</span>  <span class="token assign-left variable">1.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">16</span><span class="token punctuation">]</span>,  <span class="token assign-left variable">5.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">23</span><span class="token punctuation">]</span>, <span class="token assign-left variable">10.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">66</span><span class="token punctuation">]</span>, <span class="token assign-left variable">20.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">72</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">30.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">120</span><span class="token punctuation">]</span>, <span class="token assign-left variable">40.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">124</span><span class="token punctuation">]</span>, <span class="token assign-left variable">50.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>, <span class="token assign-left variable">60.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">127</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">70.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">128</span><span class="token punctuation">]</span>, <span class="token assign-left variable">80.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">130</span><span class="token punctuation">]</span>, <span class="token assign-left variable">90.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">133</span><span class="token punctuation">]</span>, <span class="token assign-left variable">95.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">135</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">139</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.50th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">139</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.90th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">141</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.95th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">141</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.99th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">141</span><span class="token punctuation">]</span>
    lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">20</span><span class="token operator">=</span><span class="token number">4.57</span>%, <span class="token assign-left variable">50</span><span class="token operator">=</span><span class="token number">0.91</span>%, <span class="token assign-left variable">100</span><span class="token operator">=</span><span class="token number">19.21</span>%, <span class="token assign-left variable">250</span><span class="token operator">=</span><span class="token number">75.30</span>%
  cpu          <span class="token builtin class-name">:</span> <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">1.51</span>%, <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">0.82</span>%, <span class="token assign-left variable">ctx</span><span class="token operator">=</span><span class="token number">720</span>, <span class="token assign-left variable">majf</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">minf</span><span class="token operator">=</span><span class="token number">1</span>
  IO depths    <span class="token builtin class-name">:</span> <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">0.3</span>%, <span class="token assign-left variable">2</span><span class="token operator">=</span><span class="token number">99.7</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     submit    <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     complete  <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     issued    <span class="token builtin class-name">:</span> <span class="token assign-left variable">total</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">328</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">short</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">drop</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>
     latency   <span class="token builtin class-name">:</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">window</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">percentile</span><span class="token operator">=</span><span class="token number">100.00</span>%, <span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">2</span>

Run status group <span class="token number">0</span> <span class="token punctuation">(</span>all <span class="token function">jobs</span><span class="token punctuation">)</span>:
  WRITE: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">5248</span>.0MB, <span class="token assign-left variable">aggrb</span><span class="token operator">=</span>267987KB/s, <span class="token assign-left variable">minb</span><span class="token operator">=</span>267987KB/s, <span class="token assign-left variable">maxb</span><span class="token operator">=</span>267987KB/s, <span class="token assign-left variable">mint</span><span class="token operator">=</span>20053msec, <span class="token assign-left variable">maxt</span><span class="token operator">=</span>20053msec</code></pre>

<h2 id="Xfs-å•ç‹¬ç£ç›˜"><a href="#Xfs-å•ç‹¬ç£ç›˜" class="headerlink" title="Xfs å•ç‹¬ç£ç›˜"></a>Xfs å•ç‹¬ç£ç›˜</h2><h3 id="Randwrite-1"><a href="#Randwrite-1" class="headerlink" title="Randwrite"></a>Randwrite</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-10-64 fio<span class="token punctuation">]</span><span class="token comment"># fio ./job1</span>
job1: <span class="token punctuation">(</span>g<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token assign-left variable">rw</span><span class="token operator">=</span>randwrite, <span class="token assign-left variable">bs</span><span class="token operator">=</span>16M-16M/16M-16M/16M-16M, <span class="token assign-left variable">ioengine</span><span class="token operator">=</span>libaio, <span class="token assign-left variable">iodepth</span><span class="token operator">=</span><span class="token number">2</span>
fio-2.14
Starting <span class="token number">1</span> thread
job1: Laying out IO file<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span> file<span class="token punctuation">(</span>s<span class="token punctuation">)</span> / 64MB<span class="token punctuation">)</span>
Jobs: <span class="token number">1</span> <span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token punctuation">[</span>w<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">100.0</span>% done<span class="token punctuation">]</span> <span class="token punctuation">[</span>0KB/128.0MB/0KB /s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">0</span>/8/0 iops<span class="token punctuation">]</span> <span class="token punctuation">[</span>eta 00m:00s<span class="token punctuation">]</span>
job1: <span class="token punctuation">(</span>groupid<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">jobs</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token assign-left variable">err</span><span class="token operator">=</span> <span class="token number">0</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">26541</span>: Thu Nov <span class="token number">18</span> 08:04:01 <span class="token number">2021</span>
  write: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">2704</span>.0MB, <span class="token assign-left variable">bw</span><span class="token operator">=</span>137688KB/s, <span class="token assign-left variable">iops</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">runt</span><span class="token operator">=</span> 20110msec
    slat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">12</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">130</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">118.63</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">24.61</span>
    clat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">12</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">130</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">118.91</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">23.73</span>
     lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">34</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">255</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">237.54</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">47.53</span>
    clat percentiles <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>:
     <span class="token operator">|</span>  <span class="token assign-left variable">1.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">14</span><span class="token punctuation">]</span>,  <span class="token assign-left variable">5.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">32</span><span class="token punctuation">]</span>, <span class="token assign-left variable">10.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">125</span><span class="token punctuation">]</span>, <span class="token assign-left variable">20.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">125</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">30.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">125</span><span class="token punctuation">]</span>, <span class="token assign-left variable">40.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">125</span><span class="token punctuation">]</span>, <span class="token assign-left variable">50.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">125</span><span class="token punctuation">]</span>, <span class="token assign-left variable">60.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">70.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>, <span class="token assign-left variable">80.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>, <span class="token assign-left variable">90.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>, <span class="token assign-left variable">95.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">126</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">129</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.50th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.90th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.95th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.99th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>
    lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">20</span><span class="token operator">=</span><span class="token number">1.78</span>%, <span class="token assign-left variable">50</span><span class="token operator">=</span><span class="token number">3.55</span>%, <span class="token assign-left variable">100</span><span class="token operator">=</span><span class="token number">0.59</span>%, <span class="token assign-left variable">250</span><span class="token operator">=</span><span class="token number">94.08</span>%
  cpu          <span class="token builtin class-name">:</span> <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">0.74</span>%, <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">0.49</span>%, <span class="token assign-left variable">ctx</span><span class="token operator">=</span><span class="token number">2132</span>, <span class="token assign-left variable">majf</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">minf</span><span class="token operator">=</span><span class="token number">1</span>
  IO depths    <span class="token builtin class-name">:</span> <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">0.6</span>%, <span class="token assign-left variable">2</span><span class="token operator">=</span><span class="token number">99.4</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     submit    <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     complete  <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     issued    <span class="token builtin class-name">:</span> <span class="token assign-left variable">total</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">169</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">short</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">drop</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>
     latency   <span class="token builtin class-name">:</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">window</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">percentile</span><span class="token operator">=</span><span class="token number">100.00</span>%, <span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">2</span>

Run status group <span class="token number">0</span> <span class="token punctuation">(</span>all <span class="token function">jobs</span><span class="token punctuation">)</span>:
  WRITE: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">2704</span>.0MB, <span class="token assign-left variable">aggrb</span><span class="token operator">=</span>137687KB/s, <span class="token assign-left variable">minb</span><span class="token operator">=</span>137687KB/s, <span class="token assign-left variable">maxb</span><span class="token operator">=</span>137687KB/s, <span class="token assign-left variable">mint</span><span class="token operator">=</span>20110msec, <span class="token assign-left variable">maxt</span><span class="token operator">=</span>20110msec

Disk stats <span class="token punctuation">(</span>read/write<span class="token punctuation">)</span>:
  nvme4n1: <span class="token assign-left variable">ios</span><span class="token operator">=</span><span class="token number">0</span>/10699, <span class="token assign-left variable">merge</span><span class="token operator">=</span><span class="token number">0</span>/0, <span class="token assign-left variable">ticks</span><span class="token operator">=</span><span class="token number">0</span>/720588, <span class="token assign-left variable">in_queue</span><span class="token operator">=</span><span class="token number">702508</span>, <span class="token assign-left variable">util</span><span class="token operator">=</span><span class="token number">99.40</span>%</code></pre>
<h3 id="Randread-1"><a href="#Randread-1" class="headerlink" title="Randread"></a>Randread</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-10-64 fio<span class="token punctuation">]</span><span class="token comment"># fio ./job1</span>
job1: <span class="token punctuation">(</span>g<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>: <span class="token assign-left variable">rw</span><span class="token operator">=</span>randread, <span class="token assign-left variable">bs</span><span class="token operator">=</span>16M-16M/16M-16M/16M-16M, <span class="token assign-left variable">ioengine</span><span class="token operator">=</span>libaio, <span class="token assign-left variable">iodepth</span><span class="token operator">=</span><span class="token number">2</span>
fio-2.14
Starting <span class="token number">1</span> thread
Jobs: <span class="token number">1</span> <span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token punctuation">[</span>r<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">100.0</span>% done<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">128</span>.0MB/0KB/0KB /s<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">8</span>/0/0 iops<span class="token punctuation">]</span> <span class="token punctuation">[</span>eta 00m:00s<span class="token punctuation">]</span>
job1: <span class="token punctuation">(</span>groupid<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">jobs</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>: <span class="token assign-left variable">err</span><span class="token operator">=</span> <span class="token number">0</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">26570</span>: Thu Nov <span class="token number">18</span> 08:05:27 <span class="token number">2021</span>
  <span class="token builtin class-name">read</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">2704</span>.0MB, <span class="token assign-left variable">bw</span><span class="token operator">=</span>137694KB/s, <span class="token assign-left variable">iops</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">runt</span><span class="token operator">=</span> 20109msec
    slat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">9</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">165</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">118.64</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">25.59</span>
    clat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">14</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">165</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">118.93</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">24.65</span>
     lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>: <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token number">25</span>, <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token number">288</span>, <span class="token assign-left variable">avg</span><span class="token operator">=</span><span class="token number">237.57</span>, <span class="token assign-left variable">stdev</span><span class="token operator">=</span><span class="token number">46.62</span>
    clat percentiles <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>:
     <span class="token operator">|</span>  <span class="token assign-left variable">1.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">16</span><span class="token punctuation">]</span>,  <span class="token assign-left variable">5.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>   <span class="token number">57</span><span class="token punctuation">]</span>, <span class="token assign-left variable">10.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">123</span><span class="token punctuation">]</span>, <span class="token assign-left variable">20.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">123</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">30.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">124</span><span class="token punctuation">]</span>, <span class="token assign-left variable">40.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">124</span><span class="token punctuation">]</span>, <span class="token assign-left variable">50.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">124</span><span class="token punctuation">]</span>, <span class="token assign-left variable">60.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">124</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">70.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">129</span><span class="token punctuation">]</span>, <span class="token assign-left variable">80.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">129</span><span class="token punctuation">]</span>, <span class="token assign-left variable">90.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">129</span><span class="token punctuation">]</span>, <span class="token assign-left variable">95.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">129</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.00th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">131</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.50th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">165</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.90th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">165</span><span class="token punctuation">]</span>, <span class="token assign-left variable">99.95th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">165</span><span class="token punctuation">]</span>,
     <span class="token operator">|</span> <span class="token assign-left variable">99.99th</span><span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token number">165</span><span class="token punctuation">]</span>
    lat <span class="token punctuation">(</span>msec<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token assign-left variable">20</span><span class="token operator">=</span><span class="token number">4.73</span>%, <span class="token assign-left variable">100</span><span class="token operator">=</span><span class="token number">1.78</span>%, <span class="token assign-left variable">250</span><span class="token operator">=</span><span class="token number">93.49</span>%
  cpu          <span class="token builtin class-name">:</span> <span class="token assign-left variable">usr</span><span class="token operator">=</span><span class="token number">0.00</span>%, <span class="token assign-left variable">sys</span><span class="token operator">=</span><span class="token number">0.59</span>%, <span class="token assign-left variable">ctx</span><span class="token operator">=</span><span class="token number">3558</span>, <span class="token assign-left variable">majf</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">minf</span><span class="token operator">=</span><span class="token number">8193</span>
  IO depths    <span class="token builtin class-name">:</span> <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">0.6</span>%, <span class="token assign-left variable">2</span><span class="token operator">=</span><span class="token number">99.4</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     submit    <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     complete  <span class="token builtin class-name">:</span> <span class="token assign-left variable">0</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">4</span><span class="token operator">=</span><span class="token number">100.0</span>%, <span class="token assign-left variable">8</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">16</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">32</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token assign-left variable">64</span><span class="token operator">=</span><span class="token number">0.0</span>%, <span class="token operator">>=</span><span class="token number">64</span><span class="token operator">=</span><span class="token number">0.0</span>%
     issued    <span class="token builtin class-name">:</span> <span class="token assign-left variable">total</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">169</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">short</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">drop</span><span class="token operator">=</span>r<span class="token operator">=</span><span class="token number">0</span>/w<span class="token operator">=</span><span class="token number">0</span>/d<span class="token operator">=</span><span class="token number">0</span>
     latency   <span class="token builtin class-name">:</span> <span class="token assign-left variable">target</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">window</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">percentile</span><span class="token operator">=</span><span class="token number">100.00</span>%, <span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">2</span>

Run status group <span class="token number">0</span> <span class="token punctuation">(</span>all <span class="token function">jobs</span><span class="token punctuation">)</span>:
   READ: <span class="token assign-left variable">io</span><span class="token operator">=</span><span class="token number">2704</span>.0MB, <span class="token assign-left variable">aggrb</span><span class="token operator">=</span>137694KB/s, <span class="token assign-left variable">minb</span><span class="token operator">=</span>137694KB/s, <span class="token assign-left variable">maxb</span><span class="token operator">=</span>137694KB/s, <span class="token assign-left variable">mint</span><span class="token operator">=</span>20109msec, <span class="token assign-left variable">maxt</span><span class="token operator">=</span>20109msec

Disk stats <span class="token punctuation">(</span>read/write<span class="token punctuation">)</span>:
  nvme4n1: <span class="token assign-left variable">ios</span><span class="token operator">=</span><span class="token number">10711</span>/1, <span class="token assign-left variable">merge</span><span class="token operator">=</span><span class="token number">0</span>/0, <span class="token assign-left variable">ticks</span><span class="token operator">=</span><span class="token number">598336</span>/56, <span class="token assign-left variable">in_queue</span><span class="token operator">=</span><span class="token number">579492</span>, <span class="token assign-left variable">util</span><span class="token operator">=</span><span class="token number">99.49</span>%</code></pre>

<p>slat è¡¨ç¤ºsubmission latencyï¼Œä¹Ÿå°±æ˜¯å‘é€è¿™ä¸ªIOç»™å†…æ ¸å¤„ç†çš„æäº¤æ—¶é—´èŠ±è´¹ã€‚  ï¼ˆè¯·æ±‚æŠµè¾¾å†…æ ¸çš„æ—¶é—´ï¼‰<br>clat æ˜¯æäº¤IOè¯·æ±‚ç»™å†…æ ¸ä¹‹ååˆ°IOå®Œæˆä¹‹é—´çš„æ—¶é—´ï¼Œä¸åŒ…æ‹¬submission latencyã€‚ ï¼ˆå†…æ ¸åˆ°å—è®¾å¤‡ â€”â€”&gt; è¯·æ±‚å¤„ç†å®Œæˆçš„æ—¶é—´ï¼‰<br>bw Bandwidth  å¸¦å®½<br>READ: è¯»å–çš„é€Ÿç‡</p>
<p>å…³äºfio å‡ ä¸ªå‚æ•°çš„æµ‹è¯•ï¼Œ è¿™æ˜¯æˆ‘ç›®å‰è§åˆ°æµ‹è¯•æœ€å®Œæ•´çš„ä¸€ä¸ªï¼š<br><a href="https://blog.csdn.net/get_set/article/details/108001674">https://blog.csdn.net/get_set/article/details/108001674</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, IO, FileSystem</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿«é€Ÿå¯åŠ¨ä¸€ä¸ª prometheus å’Œ grafana</title>
    <url>/2023/05/25/Linux/Linux_fast-create-prometheus-and-grafana/</url>
    <content><![CDATA[<p>å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå¯ç”¨çš„ prometheus å’Œ grafana è¿›è¡Œæµ‹è¯•ï¼Œ å¹¶å°†æ•°æ®ä¿ç•™åœ¨å½“å‰çš„ç›®å½•ä¸­ï¼Œ åœ¨é‡å¯ä¹‹åæ•°æ®ä¸ä¼šä¸¢å¤±ï¼š </p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªç›®å½•.</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /opt/monitor
<span class="token function">mkdir</span> /opt/monitor/grafana
<span class="token function">mkdir</span> /opt/monitor/grafana_data
<span class="token function">mkdir</span> /opt/monitor/prometheus
<span class="token function">mkdir</span> /opt/monitor/prometheus_data
<span class="token function">touch</span> /opt/monitor/docker-compose.yaml</code></pre>
</li>
<li><p>åˆ›å»ºdocker-compose æ–‡ä»¶</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">image</span><span class="token punctuation">:</span> reg.liarlee.site/docker.io/prom/prometheus<span class="token punctuation">:</span>latest
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token comment"># - /opt/monitor/prometheus/prometheus.yaml:/etc/prometheus/prometheus.yml</span>
      <span class="token punctuation">-</span> /opt/monitor/prometheus_data<span class="token punctuation">:</span>/prometheus
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'--config.file=/etc/prometheus/prometheus.yml'</span>
      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.path=/prometheus'</span>
      <span class="token punctuation">-</span> <span class="token string">'--web.console.libraries=/usr/share/prometheus/console_libraries'</span>
      <span class="token punctuation">-</span> <span class="token string">'--web.console.templates=/usr/share/prometheus/consoles'</span>
      <span class="token punctuation">-</span> <span class="token string">'--storage.tsdb.retention.time=90d'</span>
  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> grafana
    <span class="token key atrule">image</span><span class="token punctuation">:</span> reg.liarlee.site/docker.io/grafana/grafana<span class="token punctuation">-</span>oss<span class="token punctuation">:</span>main<span class="token punctuation">-</span>ubuntu
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /opt/monitor/grafana_data<span class="token punctuation">:</span>/var/lib/grafana
      <span class="token punctuation">-</span> /opt/monitor/grafana/datasource<span class="token punctuation">:</span>/etc/grafana/provisioning/datasources
      <span class="token comment"># - /opt/monitor/grafana/grafana.ini:/etc/grafana/grafana.ini</span>
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime<span class="token punctuation">:</span>ro
    <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">'472'</span></code></pre>
</li>
<li><p>å‡†å¤‡åŸºç¡€é…ç½®æ–‡ä»¶</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span> 
<span class="token function">docker</span> <span class="token function">cp</span> grafana:/etc/grafana/grafana.ini /opt/monitor/grafana/grafana.ini
<span class="token function">docker</span> <span class="token function">cp</span> prometheus:/etc/prometheus/prometheus.yml /opt/monitor/prometheus/prometheus.yaml

<span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token number">472</span>:472 /opt/monitor/grafana_data
<span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token number">472</span>:472 /opt/monitor/grafana

<span class="token function">chown</span> <span class="token parameter variable">-R</span> nobody:nobody /opt/monitor/prometheus_data
<span class="token function">chown</span> <span class="token parameter variable">-R</span> nobody:nobody /opt/monitor/prometheus

<span class="token function">docker</span> compose down --remove-orphans</code></pre>
</li>
<li><p>å‡†å¤‡prometheus ä½œä¸ºé»˜è®¤çš„Datasource</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">touch /opt/monitor/grafana/datasource/datasource.yml
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">datasources</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Prometheus
  <span class="token key atrule">type</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9090</span> 
  <span class="token key atrule">isDefault</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">access</span><span class="token punctuation">:</span> proxy
  <span class="token key atrule">editable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­éœ€è¦çš„å‚æ•°, å–æ¶ˆé…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šï¼Œ ç„¶åé‡å¯å³å¯ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose down --remove-orphans <span class="token operator">&amp;&amp;</span> <span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker, Application, Prometheus, Grafana</tag>
      </tags>
  </entry>
  <entry>
    <title>Fio å‘½ä»¤ä½¿ç”¨çš„è¯´æ˜</title>
    <url>/2022/04/19/Linux/Linux_fio_blktrace/</url>
    <content><![CDATA[<p>Fio ä¸€äº›æµ‹è¯•å’Œæ€è€ƒï¼Œ fio ï¼Œblktraceç­‰ç­‰ã€‚</p>
<h3 id="Githubåœ°å€"><a href="#Githubåœ°å€" class="headerlink" title="Githubåœ°å€"></a>Githubåœ°å€</h3><p>  <a href="https://github.com/axboe/fio">https://github.com/axboe/fio</a><br>  <a href="https://tobert.github.io/post/2014-04-17-fio-output-explained.html">https://tobert.github.io/post/2014-04-17-fio-output-explained.html</a><br>  <a href="http://xiaqunfeng.cc/2017/07/12/fio-test-ceph/">http://xiaqunfeng.cc/2017/07/12/fio-test-ceph/</a><br>  <a href="https://fio.readthedocs.io/en/latest/fio_doc.html">https://fio.readthedocs.io/en/latest/fio_doc.html</a><br>  <a href="http://linuxperf.com/?p=156">http://linuxperf.com/?p=156</a></p>
<h3 id="å‘½ä»¤å’Œè¯´æ˜"><a href="#å‘½ä»¤å’Œè¯´æ˜" class="headerlink" title="å‘½ä»¤å’Œè¯´æ˜"></a>å‘½ä»¤å’Œè¯´æ˜</h3><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token comment"># fio test file defination</span>
<span class="token comment"># ini file format </span>
 <span class="token comment">; -- start job file --</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">global</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">size</span><span class="token punctuation">=</span><span class="token value attr-value">1G # è®¾ç½®æµ‹è¯•æ–‡ä»¶çš„å¤§å°</span>
<span class="token key attr-name">runtime</span><span class="token punctuation">=</span><span class="token value attr-value">30 # è®¾å®šè¿è¡Œæ—¶é—´ï¼Œ å¦‚æœè¿è¡Œæ—¶é—´ä¹‹å†…å·²ç»å®Œæˆäº†æ–‡ä»¶å¤§å°çš„å†™å…¥åˆ™ä¼šä¿æŒæ–‡ä»¶å¤§å°å’Œè´Ÿè½½ç»§ç»­å†™ã€‚</span>
<span class="token key attr-name">bs</span><span class="token punctuation">=</span><span class="token value attr-value">4k # å—å¤§å°</span>
<span class="token key attr-name">numjobs</span><span class="token punctuation">=</span><span class="token value attr-value">1 # å®šä¹‰æµ‹è¯•çš„è¿›ç¨‹æ•°é‡ é»˜è®¤æ˜¯1</span>
<span class="token key attr-name">direct</span><span class="token punctuation">=</span><span class="token value attr-value">1 # æ˜¯å¦ç»•è¿‡æ“ä½œç³»ç»Ÿçš„Bufferç¼“å†²åŒºï¼Œ 1 Enable</span>
<span class="token key attr-name">ioengine</span><span class="token punctuation">=</span><span class="token value attr-value">libaio # ioå¼•æ“ä½¿ç”¨libaioæ¨¡å¼, æŸ¥çœ‹å¯ç”¨IOå¼•æ“çš„å‘½ä»¤</span> 
group_reporting # æ±‡æ€»ä¿¡æ¯æ˜¾ç¤º
thread # ä½¿ç”¨å•è¿›ç¨‹å¤šçº¿ç¨‹çš„æ¨¡å‹ï¼Œ é»˜è®¤æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹æ¨¡å‹ã€‚
time_based # ç”¨è¿è¡Œæ—¶é—´ä¸ºåŸºå‡†ï¼Œ å¦‚æœæ—¶é—´æ²¡æœ‰åˆ°è¾¾æŒ‡å®šçš„å€¼å°±ç»§ç»­æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œ ç›´æ¥åˆ°æ—¶é—´æ»¡è¶³è¦æ±‚ã€‚

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job1</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">write</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job2</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">read</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job3</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">randwrite</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job4</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">randread</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">job5</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">rw</span><span class="token punctuation">=</span><span class="token value attr-value">randrw</span>
<span class="token comment">; -- end job file --</span></code></pre>

<h2 id="å…³äºç¡¬ç›˜æ€§èƒ½-Iostat"><a href="#å…³äºç¡¬ç›˜æ€§èƒ½-Iostat" class="headerlink" title="å…³äºç¡¬ç›˜æ€§èƒ½ Iostat"></a>å…³äºç¡¬ç›˜æ€§èƒ½ Iostat</h2><p>é¦–å…ˆï¼Œ åœ¨man iostatçš„æ—¶å€™å·²ç»æ˜ç¡®çš„æç¤ºäº†ï¼Œiostat çš„ svctm ï¼ˆä¹Ÿå°±æ˜¯ç¡¬ç›˜çš„servicetimeï¼‰æ˜¯ä¸€ä¸ªä¸å‡†ç¡®çš„å€¼ï¼Œ ä¼šåœ¨åç»­çš„ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œ å› ä¸ºä»–æ‰€ä¾èµ–çš„æ•°æ®æ¥æºï¼ˆ&#x2F;proc&#x2F;diskstatsï¼‰ä¸­ï¼Œæ˜¯ä»Block Level å‡ºå‘æ¥è¿›è¡Œè®¡ç®—çš„ï¼Œ æ‰€ä»¥svctmå…¶å®å¹¶ä¸æ˜¯IOæ§åˆ¶å™¨æ‰€éœ€è¦çš„å‡†ç¡®æ—¶é—´ï¼Œ é‚£ä¹ˆå‡ºç°äº†ä¸¤ä¸ªé—®é¢˜ï¼Œ æˆ‘ä»¬èƒ½è§‚å¯Ÿçš„æ•°æ®æ˜¯é‚£ä¸ªï¼Ÿ ä»¥åŠèƒŒåçš„å«ä¹‰æ˜¯ä»€ä¹ˆ?  </p>
<h3 id="è°ƒåº¦ç®—æ³•-å’Œ-è¯»å†™è¯·æ±‚çš„åˆå¹¶"><a href="#è°ƒåº¦ç®—æ³•-å’Œ-è¯»å†™è¯·æ±‚çš„åˆå¹¶" class="headerlink" title="è°ƒåº¦ç®—æ³• å’Œ è¯»å†™è¯·æ±‚çš„åˆå¹¶"></a>è°ƒåº¦ç®—æ³• å’Œ è¯»å†™è¯·æ±‚çš„åˆå¹¶</h3><p>å†…æ ¸ä¼šå¯¹IOçš„è¯·æ±‚è¿›è¡Œåˆå¹¶ï¼Œ ä½†æ˜¯è¿™ä¸ªåˆå¹¶ä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œ åæ˜ åˆ°IOstatçš„æŒ‡æ ‡æ˜¯ rrqm&#x2F;s &amp; wrqm&#x2F;s,  è¿™ä¸¤ä¸ªè¡¨ç¤ºå¯¹äºç¡¬ç›˜çš„è¯»å†™è¯·æ±‚ä¸­ï¼Œ æ¯ç§’åˆå¹¶çš„è¯·æ±‚æ•°é‡ï¼› å¦‚æœä½ å»æŸ¥çœ‹IOçš„è°ƒåº¦ç®—æ³•ï¼Œ none ç®—æ³•æ˜¯å®Œå…¨ä¸åˆå¹¶çš„ï¼Œ æ‰€ä»¥è¿™ä¸¤åˆ—ä¸€ç›´éƒ½æ˜¯0.  </p>
<h3 id="é˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´"><a href="#é˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´" class="headerlink" title="é˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´"></a>é˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´</h3><p>iostatä¸­çš„awaitä¸€åˆ—ï¼Œ è¡¨ç¤ºè¯·æ±‚çš„ç­‰å¾…æ—¶é—´ï¼Œæ­£å¸¸çš„æƒ…å†µä¸‹åº”è¯¥æ¯”è¾ƒä½ï¼Œé‚£ä¹ˆç©¶ç«Ÿä»€ä¹ˆæƒ…å†µä¸‹æ‰æ˜¯æ€§èƒ½ä¸ä½³çš„è¡¨ç°ï¼Ÿ<br>await æ¯ä¸ªI&#x2F;Oçš„å¹³å‡è€—æ—¶æ˜¯ç”¨awaitè¡¨ç¤º(blktrace command results: Q2C â€“ æ•´ä¸ªIOè¯·æ±‚æ‰€æ¶ˆè€—çš„æ—¶é—´(Q2I + I2D + D2C &#x3D; Q2C)ï¼Œç›¸å½“äºiostatçš„awaitã€‚)ï¼ŒåŒ…æ‹¬äº† IOè¯·æ±‚åœ¨Kernelä¸­çš„ç­‰å¾…æ—¶é—´ + IOè¯·æ±‚ä»å†…æ ¸å‡ºå‘å¤„ç†å®Œæˆå›åˆ°å†…æ ¸çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯IO time + Service Timeã€‚<br>await ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥å°äº10ms ï¼Œ å¦‚æœæ²¡æœ‰æˆ–è€…æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ ï¼Œ åº”è¯¥è€ƒè™‘è´Ÿè½½çš„ç±»å‹ï¼Œ æ¥è¡¡é‡ç¡¬ç›˜çš„è´Ÿè½½æ°´å¹³ã€‚  </p>
<h3 id="Blktrace"><a href="#Blktrace" class="headerlink" title="Blktrace"></a>Blktrace</h3><p>ä¸€ä¸ªI&#x2F;Oè¯·æ±‚è¿›å…¥block layerä¹‹åï¼Œå¯èƒ½ä¼šç»å†ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<pre><code>Q Remap: å¯èƒ½è¢«DM(Device Mapper)æˆ–MD(Multiple Device, Software RAID) remapåˆ°å…¶å®ƒè®¾å¤‡
G Split: å¯èƒ½ä¼šå› ä¸ºI/Oè¯·æ±‚ä¸æ‰‡åŒºè¾¹ç•Œæœªå¯¹é½ã€æˆ–è€…sizeå¤ªå¤§è€Œè¢«åˆ†æ‹†(split)æˆå¤šä¸ªç‰©ç†I/O
I Merge: å¯èƒ½ä¼šå› ä¸ºä¸å…¶å®ƒI/Oè¯·æ±‚çš„ç‰©ç†ä½ç½®ç›¸é‚»è€Œåˆå¹¶(merge)æˆä¸€ä¸ªI/O
D è¢«IO Schedulerä¾ç…§è°ƒåº¦ç­–ç•¥å‘é€ç»™driver
C è¢«driveræäº¤ç»™ç¡¬ä»¶ï¼Œç»è¿‡HBAã€ç”µç¼†ï¼ˆå…‰çº¤ã€ç½‘çº¿ç­‰ï¼‰ã€äº¤æ¢æœºï¼ˆSANæˆ–ç½‘ç»œï¼‰ã€æœ€ååˆ°è¾¾å­˜å‚¨è®¾å¤‡ï¼Œè®¾å¤‡å®ŒæˆIOè¯·æ±‚ä¹‹åå†æŠŠç»“æœå‘å›ã€‚
</code></pre>
<p>å¸¸è§çš„çŠ¶æ€åˆ‡æ¢ Qâ€“Gâ€“Iâ€“Dâ€“C </p>
<pre class="language-r" data-language="r"><code class="language-r"><span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">2</span>     <span class="token number">0.000001080</span>  <span class="token number">7134</span>  Q   W <span class="token number">756856</span> <span class="token operator">+</span> <span class="token number">800</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">3</span>     <span class="token number">0.000004247</span>  <span class="token number">7134</span>  X   W <span class="token number">756856</span> <span class="token operator">/</span> <span class="token number">757368</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">4</span>     <span class="token number">0.000005806</span>  <span class="token number">7134</span>  G   W <span class="token number">756856</span> <span class="token operator">+</span> <span class="token number">512</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">5</span>     <span class="token number">0.000008792</span>  <span class="token number">7134</span>  I   W <span class="token number">756856</span> <span class="token operator">+</span> <span class="token number">512</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">6</span>     <span class="token number">0.000012844</span>  <span class="token number">7134</span>  G   W <span class="token number">757368</span> <span class="token operator">+</span> <span class="token number">288</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">7</span>     <span class="token number">0.000013202</span>  <span class="token number">7134</span>  I   W <span class="token number">757368</span> <span class="token operator">+</span> <span class="token number">288</span> <span class="token punctuation">[</span>dd<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">8</span>     <span class="token number">0.000031708</span>  <span class="token number">1830</span>  D   W <span class="token number">756856</span> <span class="token operator">+</span> <span class="token number">512</span> <span class="token punctuation">[</span>kworker<span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span>H<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>        <span class="token number">9</span>     <span class="token number">0.000034250</span>  <span class="token number">1830</span>  D   W <span class="token number">757368</span> <span class="token operator">+</span> <span class="token number">288</span> <span class="token punctuation">[</span>kworker<span class="token operator">/</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span>H<span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>       <span class="token number">10</span>     <span class="token number">0.001598439</span>  <span class="token number">7135</span>  C   W <span class="token number">756856</span> <span class="token operator">+</span> <span class="token number">512</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">259</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token number">0</span>       <span class="token number">11</span>     <span class="token number">0.001689880</span>  <span class="token number">7135</span>  C   W <span class="token number">757368</span> <span class="token operator">+</span> <span class="token number">288</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># ä¸»ï¼Œä»è®¾å¤‡å· ï¼Œ èµ·å§‹Sector ä¸º0 ï¼Œ å†™å‡ ä¸ªï¼Œ æ—¶é—´ ï¼Œ pid ï¼Œ çŠ¶æ€ ï¼Œ R/W ï¼Œ æœªçŸ¥</span></code></pre>

<p>ä¿ç•™blktraceçš„ç»“æœä¸ºbinæ–‡ä»¶</p>
<pre class="language-r" data-language="r"><code class="language-r">blktrace <span class="token operator">-</span>d <span class="token operator">/</span>dev<span class="token operator">/</span>sdb</code></pre>

<p>ä½¿ç”¨blkparse åˆ†æå·²ç»æœ‰çš„è®°å½•</p>
<pre class="language-r" data-language="r"><code class="language-r"><span class="token comment"># è®°å½•æ€§èƒ½æ•°æ® åˆ° æ–‡ä»¶ã€‚</span>
root<span class="token operator">@</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">235</span><span class="token operator">:</span><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">|</span>â‡’  blktrace <span class="token operator">-</span>d <span class="token operator">/</span>dev<span class="token operator">/</span>nvme0n1p1
<span class="token operator">^</span>C<span class="token operator">==</span><span class="token operator">=</span> nvme0n1p1 <span class="token operator">==</span><span class="token operator">=</span>
  CPU  <span class="token number">0</span><span class="token operator">:</span>                    <span class="token number">1</span> events<span class="token punctuation">,</span>        <span class="token number">1</span> KiB data
  CPU  <span class="token number">1</span><span class="token operator">:</span>                    <span class="token number">0</span> events<span class="token punctuation">,</span>        <span class="token number">0</span> KiB data
  Total<span class="token operator">:</span>                     <span class="token number">1</span> events <span class="token punctuation">(</span>dropped <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">1</span> KiB data
<span class="token comment"># æ¯ä¸ªcpuè®¾å¤‡æ¯ä¸ªè®¾å¤‡å­˜å‚¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚</span>
root<span class="token operator">@</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">235</span><span class="token operator">:</span><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">|</span>â‡’  ll
total <span class="token number">4.0</span>K
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1</span> root root <span class="token number">56</span> Nov  <span class="token number">4</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">55</span> nvme0n1p1.blktrace.<span class="token number">0</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1</span> root root  <span class="token number">0</span> Nov  <span class="token number">4</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">55</span> nvme0n1p1.blktrace.<span class="token number">1</span>

root<span class="token operator">@</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">235</span><span class="token operator">:</span><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">|</span>â‡’  blkparse <span class="token operator">-</span>i nvme0n1p1.blktrace.<span class="token number">0</span>
<span class="token comment"># æ ¼å¼åŒ–åˆ†æçš„æ•°æ®ä¸ºbinã€‚</span>
root<span class="token operator">@</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">235</span><span class="token operator">:</span><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">|</span>â‡’  blkparse <span class="token operator">-</span>i nvme0n1p1 <span class="token operator">-</span>d nvme0n1p1.blktrace.bin
<span class="token comment"># ä½¿ç”¨ä¸€ä¸ªç®€æ˜“çš„å›¾å½¢æ–¹å¼åˆ†æç»“æœã€‚</span>
root<span class="token operator">@</span>ip<span class="token operator">-</span><span class="token number">172</span><span class="token operator">-</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">235</span><span class="token operator">:</span><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">|</span>â‡’  btt <span class="token operator">-</span>i nvme0n1p1.blktrace.bin</code></pre>

<h2 id="å†å²èƒŒæ™¯"><a href="#å†å²èƒŒæ™¯" class="headerlink" title="å†å²èƒŒæ™¯"></a>å†å²èƒŒæ™¯</h2><blockquote>
<p>mdadm å·²ç»ä¸æ€ä¹ˆæ›´æ–°å’Œå¼€å‘äº†<br>é»˜è®¤æ¨èä½¿ç”¨LVM<br>LVM å’Œ mdadm åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯ä½¿ç”¨çš„Raidé©±åŠ¨ï¼ˆå†…æ ¸æ¨¡å—ï¼‰ã€‚</p>
<p>å…¶å®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨btrfs ï¼Œ è¿™ä¸ªæµ‹è¯•çš„ç»“æœæ˜¯ btrfs çš„å®ç°å’Œç®¡ç†æˆæœ¬æ¯” LVM è¦å°‘çš„å¤šã€‚ </p>
</blockquote>
<h2 id="ç›¸å…³çš„é—®é¢˜"><a href="#ç›¸å…³çš„é—®é¢˜" class="headerlink" title="ç›¸å…³çš„é—®é¢˜"></a>ç›¸å…³çš„é—®é¢˜</h2><p>å¦‚æœè¯´æœ‰ä¸€ä¸ªæ€§èƒ½çš„é—®é¢˜ï¼Œ IOPSè¾¾ä¸åˆ°æŒ‡å®šçš„æ•°å€¼ï¼Œ æ€è·¯ï¼Ÿ<br>é¦–å…ˆæŸ¥çœ‹é˜Ÿåˆ—æ·±åº¦æ˜¯ä¸æ˜¯è¶³å¤Ÿï¼Œçœ‹svctmæ—¶é—´é•¿ä¸é•¿ï¼Œçœ‹é˜Ÿåˆ—é•¿åº¦ </p>
<p>&#x2F;sys&#x2F;block&#x2F;sda&#x2F;nr_requests </p>
<h2 id="Iostatå‘½ä»¤çš„ç†è§£"><a href="#Iostatå‘½ä»¤çš„ç†è§£" class="headerlink" title="Iostatå‘½ä»¤çš„ç†è§£"></a>Iostatå‘½ä»¤çš„ç†è§£</h2><p>iostat -xkt 1<br>rrqm&#x2F;s wrqm&#x2F;s  - è¯»å†™è¯·æ±‚çš„åˆå¹¶æ•°é‡<br>r&#x2F;s w&#x2F;s - è¯»å†™è¯·æ±‚æ•°é‡<br>avgrq - é˜Ÿåˆ—é•¿åº¦<br>await - æ—¶å»¶<br>util - æ—¶é—´åº¦é‡ ï¼Œ æ—¶é—´å‘¨æœŸä¹‹å†…è¿›è¡ŒIOæ“ä½œæ‰€å çš„æ¯”ä¾‹ã€‚ä¾‹å¦‚ 1 ç§’çš„æ—¶é—´ä¹‹å†…ï¼Œ å–æ ·çš„ç‚¹ä¸­æœ‰å¤šå°‘æ˜¯åœ¨æ‰§è¡ŒIOæ“ä½œã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ ï¼Œ å¦‚æœé‡‡æ ·çš„å‘¨æœŸä¸º1sï¼Œ é‚£ä¹ˆé‡‡æ ·çš„èŒƒå›´ä¹‹å†… ï¼Œ å‰é¢çš„0.5ç§’æœ‰æ‰§è¡ŒIOçš„æ“ä½œï¼Œ åé¢çš„0.5ç§’æ²¡æœ‰æ‰§è¡Œä»»ä½•çš„æ“ä½œï¼Œ é‚£ä¹ˆ æœ€å Util ç°åœ¨çš„ç»“æœå°±æ˜¯50% ã€‚avgrqä¹Ÿæ˜¯ä¸€ç›´å¹³å‡å€¼ï¼Œ åœ¨é‡‡æ ·å‘¨æœŸä¹‹å†…å¦‚æœå‰åçš„çŠ¶å†µä¸ä¸€è‡´ ä¹Ÿä¼šè¿›è¡Œå¹³å‡ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå‚æ•°æ˜¯å‡†ç¡®çš„ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æŒ‡æ ‡éƒ½æ˜¯å–å†³äºç›‘æ§å–æ ·å‘¨æœŸçš„ã€‚</p>
<p>æ“ä½œç³»ç»Ÿé»˜è®¤è¾“å‡ºçš„å—å¤§å°æ˜¯ ï¼š 256 ï¼Œ å‚æ•°å¯è§ ï¼š<br>â•°â”€# cat &#x2F;sys&#x2F;block&#x2F;sda&#x2F;queue&#x2F;max_sectors_kb<br>256</p>
<p>max_segmentsè¡¨ç¤ºè®¾å¤‡èƒ½å¤Ÿå…è®¸çš„æœ€å¤§æ®µçš„æ•°ç›®ã€‚    â€“ è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå†…å­˜æˆ–è€…bufferçš„åˆ†æ®µæŒ‡æ ‡ã€‚ ï¼ˆå¾…å®šï¼‰<br>max_sectors_kbè¡¨ç¤ºè®¾å¤‡å…è®¸çš„æœ€å¤§è¯·æ±‚å¤§å°ã€‚      â€“ å¯æ”¹ ã€‚<br>max_hw_sectors_kbè¡¨ç¤ºå•ä¸ªè¯·æ±‚æ‰€èƒ½å¤„ç†çš„æœ€å¤§KBï¼ˆç¡¬çº¦æŸï¼‰ â€“ è¿™ä¸ªæ˜¯ä¸Šä¸€ä¸ªå‚æ•°çš„Limitã€‚  </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, EBS, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>buffer/cache æ— æ³•é‡Šæ”¾</title>
    <url>/2023/05/12/Linux/Linux_free-command-issue/</url>
    <content><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>çœ‹åˆ°äº†ä¸€ä¸ªæ¡ˆä¾‹ï¼Œ è¿™ä¸ªæ¡ˆä¾‹çš„é—®é¢˜æ˜¯ï¼š ä¸ºä»€ä¹ˆæˆ‘çš„buffer&#x2F;cacheåœ¨echo 3 ä¹‹åï¼Œ è¿˜æ˜¯ä¸èƒ½å›æ”¶ï¼Œ å†…å­˜çš„å ç”¨å¾ˆå¤§ã€‚</p>
<p>å‘½ä»¤å¦‚ä¸‹ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-47-174 ~<span class="token comment"># free -h</span>
               total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           <span class="token number">7</span>.5Gi       <span class="token number">1</span>.3Gi       <span class="token number">3</span>.5Gi       <span class="token number">2</span>.1Gi       <span class="token number">2</span>.6Gi       <span class="token number">3</span>.8Gi
Swap:             0B          0B          0B
root@ip-172-31-47-174 ~<span class="token comment"># echo 3 > /proc/sys/vm/drop_caches</span>
root@ip-172-31-47-174 ~<span class="token comment"># free -h</span>
               total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           <span class="token number">7</span>.5Gi       <span class="token number">1</span>.3Gi       <span class="token number">3</span>.7Gi       <span class="token number">2</span>.1Gi       <span class="token number">2</span>.4Gi       <span class="token number">3</span>.9Gi
Swap:             0B          0B          0B
root@ip-172-31-47-174 ~<span class="token comment"># free</span>
               total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:         <span class="token number">7833520</span>     <span class="token number">1376608</span>     <span class="token number">3917368</span>     <span class="token number">2160524</span>     <span class="token number">2539544</span>     <span class="token number">4059944</span>
Swap:              <span class="token number">0</span>           <span class="token number">0</span>           <span class="token number">0</span></code></pre>

<h2 id="åˆ†æå’Œç­”æ¡ˆ"><a href="#åˆ†æå’Œç­”æ¡ˆ" class="headerlink" title="åˆ†æå’Œç­”æ¡ˆ"></a>åˆ†æå’Œç­”æ¡ˆ</h2><p><strong>åˆ†æï¼š</strong> å¼€å§‹çš„æ—¶å€™æˆ‘å¹¶æ²¡æœ‰å‘ç°å…·ä½“æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œ è®¤ä¸ºæ˜¯åº”ç”¨ç¨‹åºç¡®å®æ— æ³•å›æ”¶cacheçš„ç©ºé—´ï¼Œå› ä¸ºæ­£åœ¨ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚Firefoxå¯åŠ¨çš„æ—¶å€™å°±ä¼šä½¿ç”¨Cacheçš„ç©ºé—´æ¥è¿›è¡Œæ•°æ®çš„å­˜å‚¨ã€‚  </p>
<p><strong>ç­”æ¡ˆï¼š</strong> ç¬¬äºŒå¤©çœ‹åˆ°äº†å¤§ä½¬çš„æ›´æ–°ï¼Œ è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼š <strong>å†…æ ¸ä¼šå°† shared çš„ç©ºé—´ï¼Œ ä¸€å¹¶ç»Ÿè®¡åœ¨ buffer&#x2F;cache</strong> ä¸­ï¼Œ æ‰€ä»¥freeå‘½ä»¤çš„è¾“å‡ºæ˜¯æ­£å¸¸çš„ï¼Œ å®é™…cacheå·²ç»é‡Šæ”¾äº†ä¸€éƒ¨åˆ†ï¼Œæ²¡æœ‰å¤§å¹…åº¦å˜åŒ–çš„åŸå› æ˜¯å› ä¸ºé‚£éƒ¨åˆ†æ˜¯ shmemçš„ç©ºé—´ï¼Œ æ‰€ä»¥ã€‚ã€‚ã€‚é‡Šæ”¾ä¸æ‰ã€‚  </p>
<hr>
<p>åˆè§è¿™ä¸ªç»“è®ºæ˜¯æœ‰äº›éœ‡æƒŠçš„ï¼Œ æˆ‘ä¸€ç›´éƒ½è®¤ä¸º shared å­—æ®µé‡Œé¢ç»Ÿè®¡çš„å†…å­˜æ˜¯ç‹¬ç«‹çš„ï¼Œ ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„å‘½ä»¤ï¼Œ ç¡®å® sharedç©ºé—´åŸºæœ¬ä¸Šä¸ buffer&#x2F;cacheçš„ç©ºé—´æ˜¯å·®ä¸å¤šçš„ã€‚  </p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼š   </p>
<ul>
<li><p>OS: Arch Linux x86_64  </p>
</li>
<li><p>Kernel: 6.3.1-arch2-1</p>
</li>
</ul>
<ul>
<li>Software Version: free from procps-ng 3.3.17</li>
</ul>
<p>æµ‹è¯•çš„æ–¹æ³•ï¼Œ æˆ‘åªæ˜¯å°è¯•è¯æ˜freeå‘½ä»¤çš„ç»Ÿè®¡æ–¹å¼å˜åŒ–ï¼Œ æ‰€ä»¥ç›´æ¥ç®€åŒ–äº†ï¼Œ ç›´æ¥æ‰©å¤§ShareMemoryã€‚  </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç›´æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ç›®å½•</span>
<span class="token comment"># å…¶å®ç›´æ¥ä½¿ç”¨ /dev/shm ä¹Ÿè¡Œï¼Œ ä½†æ˜¯å¯ç”¨ç©ºé—´ä¼šè¢«é™åˆ¶åˆ° ç‰©ç†å†…å­˜çš„ä¸€åŠã€‚</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /mnt/tmpfs/ 

<span class="token comment"># æŒ‚è½½åˆ° /mnt/tmpfs/</span>
<span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs <span class="token parameter variable">-o</span> <span class="token assign-left variable">size</span><span class="token operator">=</span>5000m shared /mnt/tmpfs/

<span class="token comment"># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å ç”¨é‚£ä¸ªéƒ¨åˆ†çš„å†…å­˜ã€‚</span>
<span class="token function">sudo</span> fallocate <span class="token parameter variable">-l</span> 4G /mnt/tmpfs/file</code></pre>

<p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æµ‹è¯•ï¼Œ å¯ä»¥å‘ç° share memory ç¡®å®ä¹ŸåŒæ—¶è¢«ç»Ÿè®¡åœ¨äº† buffer&#x2F;cache é‡Œé¢ï¼Œ ä¸å®¢æˆ·çš„ç°è±¡å®Œå…¨ä¸€è‡´ã€‚è¿™ä¸ªå‘½ä»¤ç¡®å®å°±æ˜¯è¿™æ ·å·¥ä½œçš„ã€‚  </p>
<p>æŒ‰ç…§è¿™ä¸ªæ€è·¯åº”è¯¥çœ‹çœ‹meminfo ä»¥åŠ å†…æ ¸çš„æ–‡æ¡£ï¼ŒMarkä¸€ä¸‹å‡†å¤‡å¼€å§‹èµ°ä¸€éè¿™ä¸ªæ€è·¯ã€‚   </p>
<p>ç«‹åˆ»æŸ¥çœ‹freeå‘½ä»¤çš„manpageï¼Œ å‘ç°æœç„¶æ²¡æœ‰æ›´æ–°ï¼Œ è¯´æ˜æ‘˜è¦ï¼š </p>
<blockquote>
<p>shared<br>Memory used (mostly) by tmpfs (Shmem in &#x2F;proc&#x2F;meminfo)</p>
<p>buffers<br>Memory used by kernel buffers (Buffers in &#x2F;proc&#x2F;meminfo)</p>
<p>cache<br>Memory  used  by  the  page  cache  and  slabs  (Cached  and SReclaimable in &#x2F;proc&#x2F;meminfo)</p>
<p>buff&#x2F;cache<br>Sum of buffers and cache</p>
</blockquote>
<p>çœ‹ &#x2F;proc&#x2F;meminfo ï¼Œ å‘ç°ç¡®å®æ˜¯å–å€¼å–åˆ°äº† shmemï¼Œ è¿™ä¸ªå€¼æ˜¯å¯¹çš„ï¼Œ ç°åœ¨çš„é—®é¢˜å°±æ˜¯ä¸ºä»€ä¹ˆå†…æ ¸æä¾›äº†è¿™æ ·çš„ä¸€ä¸ªå€¼ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cat</span> /proc/meminfo <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Ei</span> <span class="token string">"mem|cache|buffer|active"</span>
MemTotal:        <span class="token number">7833520</span> kB
MemFree:         <span class="token number">4417692</span> kB
MemAvailable:    <span class="token number">4615060</span> kB
Buffers:               <span class="token number">0</span> kB
Cached:          <span class="token number">2550368</span> kB  <span class="token comment"># è¿™ä¸ªçš„ç»Ÿè®¡å°±ã€‚ã€‚ã€‚ã€‚ freeæ˜¯å¯¹çš„</span>
SwapCached:            <span class="token number">0</span> kB
Active:           <span class="token number">830560</span> kB
Inactive:        <span class="token number">2397160</span> kB
Active<span class="token punctuation">(</span>anon<span class="token punctuation">)</span>:     <span class="token number">444220</span> kB
Inactive<span class="token punctuation">(</span>anon<span class="token punctuation">)</span>:  <span class="token number">2385016</span> kB
Active<span class="token punctuation">(</span>file<span class="token punctuation">)</span>:     <span class="token number">386340</span> kB
Inactive<span class="token punctuation">(</span>file<span class="token punctuation">)</span>:    <span class="token number">12144</span> kB
Shmem:           <span class="token number">2151884</span> kB  <span class="token comment"># è¿™ä¸ªæ˜¯åˆ›å»ºçš„æ–‡ä»¶å¤§å°ï¼Œè½¬æ¢æˆæ–‡ä»¶çš„å¤§å°ï¼Œ å·®ä¸å¤šæ˜¯ 2G å·¦å³ã€‚</span></code></pre>

<p>ç°åœ¨çš„é—®é¢˜å˜æˆï¼Œ å…·ä½“æ˜¯ä»€ä¹ˆæ—¶å€™ meminfoé‡Œé¢çš„å€¼å˜æ›´äº†ç»Ÿè®¡æ–¹å¼å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆè¿™æ ·ç»Ÿè®¡å‘¢ï¼Ÿ </p>
<p>ä¸ä¼šæ‰¾å…·ä½“æ˜¯ä»€ä¹ˆæ—¶å€™commitçš„å˜æ›´ï¼Œ ç›´æ¥çœ‹ä»£ç å§ã€‚ å¸Œæœ›æˆ‘çœ‹çš„æ˜¯å¯¹çš„ã€‚ </p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">// https://elixir.bootlin.com/linux/latest/source/fs/proc/meminfo.c</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">meminfo_proc_show</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">seq_file</span> <span class="token operator">*</span>m<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>v<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">struct</span> <span class="token class-name">sysinfo</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  cached <span class="token operator">=</span> <span class="token function">global_node_page_state</span><span class="token punctuation">(</span>NR_FILE_PAGES<span class="token punctuation">)</span> <span class="token operator">-</span>
              <span class="token function">total_swapcache_pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">.</span>bufferram<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        cached <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"MemTotal:       "</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>totalram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"MemFree:        "</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>freeram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"MemAvailable:   "</span><span class="token punctuation">,</span> available<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Buffers:        "</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>bufferram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Cached:         "</span><span class="token punctuation">,</span> cached<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"SwapCached:     "</span><span class="token punctuation">,</span> <span class="token function">total_swapcache_pages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Active:         "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_ACTIVE_ANON<span class="token punctuation">]</span> <span class="token operator">+</span>
             pages<span class="token punctuation">[</span>LRU_ACTIVE_FILE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Inactive:       "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_INACTIVE_ANON<span class="token punctuation">]</span> <span class="token operator">+</span>
             pages<span class="token punctuation">[</span>LRU_INACTIVE_FILE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Active(anon):   "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_ACTIVE_ANON<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Inactive(anon): "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_INACTIVE_ANON<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Active(file):   "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_ACTIVE_FILE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Inactive(file): "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_INACTIVE_FILE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Unevictable:    "</span><span class="token punctuation">,</span> pages<span class="token punctuation">[</span>LRU_UNEVICTABLE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">show_val_kb</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Mlocked:        "</span><span class="token punctuation">,</span> <span class="token function">global_zone_page_state</span><span class="token punctuation">(</span>NR_MLOCK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ä»ä¸€ä¸ªsysinfo çš„ struct å–å‡º, ç„¶åè¿›è¡Œè®¡ç®—ï¼Œ å­˜å‚¨åœ¨cached å˜é‡é‡Œé¢ï¼Œç„¶åè¾“å‡ºï¼š </p>
<pre class="language-c++" data-language="c++"><code class="language-c++">&#x2F;&#x2F; https:&#x2F;&#x2F;elixir.bootlin.com&#x2F;linux&#x2F;latest&#x2F;source&#x2F;include&#x2F;uapi&#x2F;linux&#x2F;sysinfo.h#L14

  __kernel_ulong_t bufferram;	&#x2F;* Memory used by buffers *&#x2F;</code></pre>

<p>å¥½äº† æˆ‘çœ‹ä¸åŠ¨äº†ï¼ŒCached çš„æœ€åç»“æœï¼š osæ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶é¡µé¢ - SwapCachedçš„æ•°å€¼ - Buffersçš„æ•°å€¼ï¼Œå¤§æ¦‚åº”è¯¥æ˜¯è¿™ä¸ªæ„æ€ï¼Œ æŒ‰ç…§è¿™ä¹ˆç®—çš„è¯ï¼Œ ç¡®å®ä¼šåŠ å…¥ shmem çš„éƒ¨åˆ†ï¼Œ<a href="https://lore.kernel.org/all/YS0Eq+tNe4Pr7O0X@casper.infradead.org/T/">é‚®ä»¶å½’æ¡£ä»¥åŠè§£é‡Š</a></p>
<blockquote>
<p>Thatâ€™s a reasonable position to take.</p>
<p>Another point of view is that everything in tmpfs is part of the page cache and can be written out to swap, so keeping it as part of Cached is not misleading.</p>
<p>I can see it both ways, and personally, Iâ€™d lean towards clarifying<br>the documentation about how shmem is accounted rather than changing how the memory usage is reported.</p>
</blockquote>
<p>è¿™æ˜¯ä¸Šé¢çš„é‚®ä»¶é“¾æ¥ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œ è§£é‡Šäº†ä¸ºä»€ä¹ˆå°† shmem è®¡ç®—åˆ° Cached ä¸­çš„åŸå› ï¼Œçœ‹èµ·æ¥ç°åœ¨åº”è¯¥ç”±ä¸€ä¸ªæ–°çš„æŒ‡æ ‡æ•°å€¼æ¥å¤„ç†è¿™ä¸ªäº†ã€‚</p>
<p>æ›´å¤šçš„éƒ¨åˆ†çœ‹å‚è€ƒé“¾æ¥å§ï¼Œæˆ‘é¡ºä¾¿çœ‹äº†è®²è§£ï¼Œå¤§ä½¬è®²çš„æ¸…æ¥šã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://zhuanlan.zhihu.com/p/586107891">https://zhuanlan.zhihu.com/p/586107891</a></p>
<p><a href="https://www.cnblogs.com/tsecer/p/16290025.html">https://www.cnblogs.com/tsecer/p/16290025.html</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Memory</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(1)</title>
    <url>/2019/07/21/Linux/Linux_k8s-basic-1/</url>
    <content><![CDATA[<p>KubernetesåŸºç¡€çŸ¥è¯†åŠç¬”è®°ã€‚</p>
<h1 id="æ¦‚å¿µå®šä¹‰"><a href="#æ¦‚å¿µå®šä¹‰" class="headerlink" title="æ¦‚å¿µå®šä¹‰"></a>æ¦‚å¿µå®šä¹‰</h1><p>å®¹å™¨çš„å‡ºç°ä»¥åŠå®¹å™¨ç¼–æ’å¼•æ“å‡ºç°çš„åŸå› ã€‚</p>
<h2 id="å®¹å™¨ç¼–æ’å·¥å…·"><a href="#å®¹å™¨ç¼–æ’å·¥å…·" class="headerlink" title="å®¹å™¨ç¼–æ’å·¥å…·"></a>å®¹å™¨ç¼–æ’å·¥å…·</h2><p>å®¹å™¨æœ€æ—©çš„æ¨¡å‹æ—¶LXC+Linux Namespaceã€‚å®¹å™¨çš„å‡ºç°å¯¼è‡´äº†æˆ‘ä»¬éœ€è¦å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ï¼Œå•æœºçš„ç®¡ç†ä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„éœ€è¦ï¼Œäºæ˜¯å¿«é€Ÿè¡ç”Ÿå‡ºäº†å¤šç§ä¸åŒçš„å®¹å™¨ç¼–æ’å·¥å…·ã€‚<br>Dockeræä¾›çš„å·¥å…·ï¼š</p>
<ol>
<li>docker compose</li>
<li>docker swarm </li>
<li>docker machine</li>
</ol>
<p>IDCçš„æ“ä½œç³»ç»Ÿï¼š</p>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Apache_Mesos">mesos(èµ„æºåˆ†é…å·¥å…·)</a>, <a href="https://en.wikipedia.org/wiki/Apache_Mesos#Marathon">marathron(é¢å‘å®¹å™¨ç¼–æ’çš„æ¡†æ¶)</a></li>
</ol>
<p>Googleçš„å·¥å…·ï¼š</p>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Kubernetes">Kubernetes</a></li>
</ol>
<p>å½“ä¸€ä¸ªäº§å“å¯ä»¥å æ®35%ä»¥ä¸Šçš„ä»½é¢å°±å·²å±äºè‡ªç„¶å„æ–­ã€‚k8sç°åœ¨å·²ç»å¤„äºå„æ–­åœ°ä½ã€‚<br>é€è¿‡å®¹å™¨æ‰€äº§ç”Ÿçš„è¡ç”Ÿæ¦‚å¿µæœ‰: DevOps, MicroServices, BlockChain.<br>å¼€å‘æ¨¡å¼çš„å¼€å‘ï¼š<a href="https://zh.wikipedia.org/wiki/%E7%80%91%E5%B8%83%E6%A8%A1%E5%9E%8B">ç€‘å¸ƒæ¨¡å‹</a>ï¼Œè¿›åŒ–åˆ°äº†æ•æ·å¼€å‘ï¼Œç²¾ç›Šå¼€å‘ï¼Œåˆ°ç°åœ¨çš„DevOps.<br>å‘å¸ƒçº¿ä¸Šçš„åšæ³•ï¼š<a href="https://www.jianshu.com/p/022685baba7d">è“ç»¿éƒ¨ç½²ï¼Œç°åº¦éƒ¨ç½²ï¼Œé‡‘ä¸é›€(canary)</a><br>DevOpså‡ ä¸ªç®€å•çš„åè¯è§£é‡Šï¼š</p>
<ul>
<li><p>CIï¼š æŒç»­é›†æˆ - æŒç»­é›†æˆé€šä¿—ä¸€äº›å°±æ˜¯<strong>å¿«é€Ÿæäº¤ä»£ç ï¼Œå¿«é€Ÿå˜æ›´éœ€æ±‚ï¼Œå¿«é€Ÿåˆå¹¶ä»£ç </strong>ã€‚</p>
</li>
<li><p>CDï¼š æŒç»­éƒ¨ç½² - æŒç»­éƒ¨ç½²æ˜¯æŒ‡åœ¨ä»£ç æäº¤å˜æ›´ä¹‹åï¼Œå¿«é€Ÿè¿›è¡Œéƒ¨ç½²åŠæµ‹è¯•ï¼›ä¼ ç»Ÿçš„ä»£ç åœ¨æäº¤åéœ€è¦è¿ç»´äººå‘˜æ‰‹åŠ¨éƒ¨ç½²ï¼ŒæŒç»­éƒ¨ç½²å…¶å®<strong>å°±æ˜¯ç¼©çŸ­çš„éƒ¨ç½²æ‰€éœ€è¦çš„æ­¥éª¤å’Œå‘¨æœŸï¼Œå°½å¯èƒ½å°†éƒ¨ç½²æ“ä½œäº¤ç”±è‡ªåŠ¨åŒ–å®Œæˆã€‚</strong></p>
</li>
<li><p>CDï¼š æŒç»­äº¤ä»˜ - è®©è½¯ä»¶äº§å“çš„<strong>äº§å‡ºè¿‡ç¨‹åœ¨ä¸€ä¸ªçŸ­å‘¨æœŸå†…å®Œæˆ</strong>ï¼Œä»¥ä¿è¯è½¯ä»¶å¯ä»¥ç¨³å®šã€æŒç»­çš„ä¿æŒåœ¨éšæ—¶å¯ä»¥å‘å¸ƒçš„çŠ¶æ€ã€‚</p>
<p>æœ‰æ—¶å€™ï¼ŒæŒç»­äº¤ä»˜ä¹Ÿä¸æŒç»­éƒ¨ç½²æ··æ·†ã€‚æŒç»­éƒ¨ç½²æ„å‘³ç€æ‰€æœ‰çš„å˜æ›´éƒ½ä¼šè¢«è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚æŒç»­äº¤ä»˜æ„å‘³ç€æ‰€æœ‰çš„å˜æ›´éƒ½å¯ä»¥è¢«éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½†æ˜¯å‡ºäºä¸šåŠ¡è€ƒè™‘ï¼Œå¯ä»¥é€‰æ‹©ä¸éƒ¨ç½²ã€‚å¦‚æœè¦å®æ–½æŒç»­éƒ¨ç½²ï¼Œå¿…é¡»å…ˆå®æ–½æŒç»­äº¤ä»˜ã€‚</p>
</li>
</ul>
<h2 id="äº‘åŸç”Ÿçš„æ¦‚å¿µ"><a href="#äº‘åŸç”Ÿçš„æ¦‚å¿µ" class="headerlink" title="äº‘åŸç”Ÿçš„æ¦‚å¿µ"></a>äº‘åŸç”Ÿçš„æ¦‚å¿µ</h2><p><a href="https://en.wikipedia.org/wiki/Native_cloud_application">Native Cloud Application</a> To Wikipedia.</p>
<blockquote>
<p> A <strong>native cloud application</strong> (NCA) is a type of computer software that natively utilizes services and infrastructure from cloud computing providers.</p>
</blockquote>
<p>ä¾‹å¦‚ï¼šå½“å®¹å™¨ä¸­çš„nginxéœ€è¦å˜æ›´é¡¹ç›®æ–‡ä»¶çš„æ—¶å€™ï¼Œå®¹å™¨çš„ç¯å¢ƒå·²ç»å†³å®šäº†ä¸å¤ªå®¹æ˜“å¯¹é¡¹ç›®çš„å˜æ›´,æ—©æœŸçš„ç¨‹åºè®¾è®¡ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œå®šä¹‰ã€‚å› æ­¤ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å¯ä»¥é€šè¿‡ä¼ é€’å®¿ä¸»æœºç¯å¢ƒå˜é‡çš„æ–¹å¼å¯¹é•œåƒè¿›è¡Œè®¾ç½®ï¼Œå½“é¡¹ç›®æœ‰å˜æ›´çš„æ—¶å€™ç›´æ¥é€šè¿‡è¯»å–ç¯å¢ƒå˜é‡çš„æ–¹å¼å¯¹å®¹å™¨å†…é¡¹ç›®çš„æ•°æ®è¿›è¡Œé…ç½®å’Œæ›´æ”¹ã€‚åŸºäºè¿™ç§æ€è·¯è®¾è®¡å‡ºæ¥çš„å®¹å™¨æˆ–è€…è½¯ä»¶ï¼Œå«åšäº‘åŸç”Ÿåº”ç”¨(Native Cloud Application)ã€‚</p>
<h2 id="K8sçš„å‰ä¸–"><a href="#K8sçš„å‰ä¸–" class="headerlink" title="K8sçš„å‰ä¸–"></a>K8sçš„å‰ä¸–</h2><p>k8sæœ¬æ¥å¼€å§‹æ˜¯Googleå†…éƒ¨çš„Brogç³»ç»Ÿï¼ŒGoogleåœ¨Dockerè¢«å‘ç°äº†ä¹‹åï¼Œå¿«é€Ÿçš„ä½¿ç”¨Goè¯­è¨€é‡å†™äº†Brogç³»ç»Ÿï¼Œå€Ÿé‰´äº†Brogçš„é€»è¾‘å’Œè®¾è®¡ï¼Œæ‰€æœ‰çš„ä»£ç è¿›è¡Œäº†å…¨é¢çš„é‡æ„ã€‚</p>
<p><a href="https://github.com/kubernetes/kubernetes">Kubernetesé¡¹ç›®çš„Githubé¡µé¢</a></p>
<h2 id="K8sçš„ç‰¹ç‚¹"><a href="#K8sçš„ç‰¹ç‚¹" class="headerlink" title="K8sçš„ç‰¹ç‚¹"></a>K8sçš„ç‰¹ç‚¹</h2><ul>
<li>è‡ªåŠ¨è£…ç®±</li>
<li>è‡ªæˆ‘ä¿®å¤</li>
<li>æ°´å¹³æ‰©å±•</li>
<li>æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</li>
<li>è‡ªåŠ¨å‘å¸ƒå’Œå›æ»š</li>
<li>å¯†é’¥çš„é…ç½®å’Œç®¡ç† â€“ å°†é…ç½®å®šä¹‰åœ¨k8sçš„å¯¹è±¡ä¸­ï¼Œé€šè¿‡k8såœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨ä¼ é€’ç¯å¢ƒå˜é‡åˆ°å®¹å™¨ä¸­ã€‚<ul>
<li>å­˜å‚¨ç¼–æ’ â€“ å¯è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·ä¾›å®¹å™¨éœ€è¦çš„è‡ªåŠ¨ç®¡ç†åŠä½¿ç”¨</li>
</ul>
</li>
<li>æ‰¹é‡å¤„ç†æ‰§è¡Œ</li>
</ul>
<h2 id="K8sçš„å·¥ä½œæµç¨‹åŠé€»è¾‘"><a href="#K8sçš„å·¥ä½œæµç¨‹åŠé€»è¾‘" class="headerlink" title="K8sçš„å·¥ä½œæµç¨‹åŠé€»è¾‘"></a>K8sçš„å·¥ä½œæµç¨‹åŠé€»è¾‘</h2><ol>
<li>Kubernetesç»„åˆå¤šå°ä¸»æœºçš„èµ„æºï¼Œ<strong>æ•´åˆæˆèµ„æºæ± </strong>ï¼Œå¹¶<strong>ç»Ÿä¸€å¯¹å¤–æä¾›è®¡ç®—ã€å­˜å‚¨ç­‰èƒ½åŠ›</strong>çš„é›†ç¾¤ã€‚k8sçš„é›†ç¾¤æ˜¯Master\Nodeæ¨¡å‹ï¼Œå…·æœ‰<strong>è§’è‰²åˆ†ç±»</strong>ï¼Œéœ€è¦éƒ¨ç½²masterèŠ‚ç‚¹åŠnodeèŠ‚ç‚¹ã€‚masterèŠ‚ç‚¹ä¸€èˆ¬æœ‰ä¸‰ä¸ªï¼ŒnodeèŠ‚ç‚¹ç†è®ºä¸Šå¯ä»¥æ— é™å¢åŠ ã€‚</li>
<li>k8sçš„ç®€è¦å·¥ä½œæµç¨‹ï¼š æ”¶åˆ°è¯·æ±‚åï¼Œ<em>MasterèŠ‚ç‚¹</em>ä¸Šçš„<strong>Scheduler</strong>ç”¨æ¥æ”¶é›†<em>æ‰€æœ‰Node</em>ä¸Šçš„å¯ç”¨èµ„æºä¿¡æ¯ï¼Œå¹¶é€šè¿‡<strong>API Server</strong>å‘ŠçŸ¥èµ„æºå……è¶³çš„<em>Node</em>å¯åŠ¨ç›¸å…³çš„å®¹å™¨ï¼›<em>Node</em>æ”¶åˆ°è¯·æ±‚ä¼šæŸ¥æ‰¾éœ€è¦çš„é•œåƒï¼Œå¦‚æœæœ¬åœ°ä¸å­˜åœ¨ä»<em>Docker Registery</em>ä¸Šé¢æ‹‰å–ç›¸åº”çš„é•œåƒè¿›è¡Œæ‰€è¯·æ±‚å®¹å™¨çš„å¯åŠ¨ã€‚</li>
<li>k8så¯å°† <em>MasterèŠ‚ç‚¹ + NodeèŠ‚ç‚¹ + RegisteryèŠ‚ç‚¹</em> åŒæ—¶æ‰˜ç®¡åœ¨k8sè‡ªèº«çš„ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æ‰˜ç®¡åœ¨dockerè™šæ‹ŸåŒ–å±‚ä¸Šï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡kubeadmç­‰ç›¸å…³çš„å·¥å…·å°†æ‰€æœ‰çš„ç»„ä»¶ä½¿ç”¨å®¹å™¨çš„æ–¹å¼è¿›è¡Œç®¡ç†å’Œè°ƒåº¦ã€‚</li>
</ol>
<h1 id="Masterä¸Šçš„ä¸»è¦ç»„ä»¶åŠæœåŠ¡"><a href="#Masterä¸Šçš„ä¸»è¦ç»„ä»¶åŠæœåŠ¡" class="headerlink" title="Masterä¸Šçš„ä¸»è¦ç»„ä»¶åŠæœåŠ¡"></a>Masterä¸Šçš„ä¸»è¦ç»„ä»¶åŠæœåŠ¡</h1><ul>
<li><p>API Server # è´Ÿè´£<strong>æä¾›å¯¹å¤–çš„åŠå¯¹å†…çš„æœåŠ¡æ¥å£</strong></p>
</li>
<li><p>Scheduler # é€‰å‡ºé€‚åˆéƒ¨ç½²å®¹å™¨çš„nodeèŠ‚ç‚¹ï¼Œ<strong>ä¸¤çº§ç­›é€‰</strong>ï¼šé€‰å‡ºæ‰€æœ‰å¯ä»¥ä½¿ç”¨çš„nodeï¼Œåœ¨æ‰€æœ‰åˆè§„çš„nodeä¸Šè¿›è¡Œæœ€ä¼˜é€‰æ‹©ï¼Œé€‰æ‹©å–å†³äºè°ƒåº¦ç®—æ³•ã€‚</p>
</li>
<li><p>Controller-Manager # <strong>æ£€æµ‹å®¹å™¨çš„çŠ¶æ€</strong>ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸æˆ–ä¸ç¬¦åˆå®šä¹‰çš„çŠ¶æ€ï¼Œå°±å‘APIç”³è¯·é‡æ–°éƒ¨ç½²ç›¸å…³å®¹å™¨ã€‚</p>
</li>
</ul>
<h1 id="Nodeä¸Šçš„ä¸»è¦æœåŠ¡åŠç»„ä»¶"><a href="#Nodeä¸Šçš„ä¸»è¦æœåŠ¡åŠç»„ä»¶" class="headerlink" title="Nodeä¸Šçš„ä¸»è¦æœåŠ¡åŠç»„ä»¶"></a>Nodeä¸Šçš„ä¸»è¦æœåŠ¡åŠç»„ä»¶</h1><ol>
<li>Kube-Proxy</li>
<li>å®¹å™¨å¼•æ“ï¼Œdocker</li>
<li>Kubelet</li>
<li>Flannel</li>
</ol>
<h2 id="é€»è¾‘ç»„ä»¶ï¼šPod"><a href="#é€»è¾‘ç»„ä»¶ï¼šPod" class="headerlink" title="é€»è¾‘ç»„ä»¶ï¼šPod"></a>é€»è¾‘ç»„ä»¶ï¼šPod</h2><p>Nodeä¸Šå¯ä»¥è¿è¡ŒåŠè°ƒåº¦é€»è¾‘å•å…ƒpodï¼Œpodæ˜¯k8sçš„ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼ŒçœŸå®è¿è¡Œèµ·æ¥çš„è¿˜æ˜¯Containerï¼Œåªæ˜¯k8sä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªContainerå°è£…äº†æˆäº†é€»è¾‘ä¸Šçš„Podï¼Œæ‰“ä¸Šäº†ç›¸åº”çš„æ ‡ç­¾ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡Seletorå¯¹ä¸åŒçš„Podè¿›è¡Œåˆ†ç±»ç®¡ç†å’Œé€‰æ‹©ã€‚Podæ˜¯æ¨¡æ‹Ÿäº†ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ¨¡å¼(ç›¸åŒä¸»æœºä¸Šçš„Podå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„loè¿›è¡Œç½‘ç»œé€šä¿¡),ä½¿å¾—å¯ä»¥æ„å»ºç²¾ç»†çš„æ¨¡å‹ã€‚</p>
<p>ä¸€ä¸ªpodä¸­å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ï¼Œå…±äº«åº•å±‚åç§°ç©ºé—´<strong>net,UTS,IPC</strong>,å¦å¤–ä¸‰ä¸ªäº’ç›¸éš”ç¦»<strong>user,mnt,pid</strong>. </p>
<h4 id="Sidecarçš„æ¦‚å¿µ"><a href="#Sidecarçš„æ¦‚å¿µ" class="headerlink" title="Sidecarçš„æ¦‚å¿µ"></a>Sidecarçš„æ¦‚å¿µ</h4><p>ä¸€èˆ¬æ¥è®²,ä¸€ä¸ªPodåªæ”¾å…¥ä¸€ä¸ªå®¹å™¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ”¾ç½®å¤šä¸ªå®¹å™¨ï¼Œä¸€èˆ¬ä¸ºä¸€ä¸ªä¸»è¦çš„ä¸€ä¸ªè¾…åŠ©çš„ï¼Œè¾…åŠ©çš„å«åš sidecar.ä¾‹å¦‚ä¸»ç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæ”¶é›†æ—¥å¿—çš„ç¨‹åºæ”¾åœ¨sidecarä¸­ã€‚ </p>
<h4 id="Podçš„æ ‡ç­¾é€‰æ‹©"><a href="#Podçš„æ ‡ç­¾é€‰æ‹©" class="headerlink" title="Podçš„æ ‡ç­¾é€‰æ‹©"></a>Podçš„æ ‡ç­¾é€‰æ‹©</h4><p>Podå·²ç»è¢«é™„åŠ äº†ä¸€äº›<strong>å…ƒæ•°æ®</strong>ï¼Œåˆ›å»ºå®Œæˆçš„Podå¯ä»¥é€šè¿‡<strong>æ ‡ç­¾çš„æ•°å€¼</strong>ç›´æ¥è¯†åˆ«Podçš„ç±»åˆ«ã€‚k8sä½¿ç”¨<strong>æ ‡ç­¾é€‰æ‹©å™¨selector</strong>æ¥è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„èµ„æºã€‚æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨è¿›è¡Œé€‰æ‹©ã€‚</p>
<h3 id="Podçš„ä¸å®Œå…¨åˆ†ç±»"><a href="#Podçš„ä¸å®Œå…¨åˆ†ç±»" class="headerlink" title="Podçš„ä¸å®Œå…¨åˆ†ç±»"></a>Podçš„ä¸å®Œå…¨åˆ†ç±»</h3><ul>
<li><strong>è‡ªä¸»å¼pod</strong> # è‡ªè¡Œæ§åˆ¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>æ§åˆ¶å™¨ç®¡ç†çš„pod</strong> # é€šè¿‡ç®¡ç†å™¨å¯ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„pod</li>
</ul>
<h3 id="k8sä½¿ç”¨çš„podçš„æ§åˆ¶å™¨"><a href="#k8sä½¿ç”¨çš„podçš„æ§åˆ¶å™¨" class="headerlink" title="k8sä½¿ç”¨çš„podçš„æ§åˆ¶å™¨"></a>k8sä½¿ç”¨çš„podçš„æ§åˆ¶å™¨</h3><ul>
<li>ReplicationController - æœ€æ—©æä¾›çš„ç»„ä»¶ï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°å’Œå›æ»šï¼Œæœ€æ—©åªæœ‰ä¸€ä¸ªã€‚<strong>ç°åœ¨å·²ç»ä¸å†ä½¿ç”¨ã€‚</strong></li>
<li>ReplicaSet - æ–°çš„å·¥å…·æ›¿ä»£äº†åŸå§‹çš„æ§åˆ¶å™¨ï¼Œä½†æ˜¯ä¸ç›´æ¥ä½¿ç”¨ï¼Œç›´æ¥ä½¿ç”¨çš„æ˜¯Deploymentæ¥ç®¡ç†æ— çŠ¶æ€çš„podã€‚</li>
<li>StatefulSet - å¯¹æœ‰çŠ¶æ€çš„Podè¿›è¡Œç®¡ç†ã€‚</li>
<li>DaemonSet - æ§åˆ¶å®¹å™¨çš„è¿›ç¨‹ä¸ºå®ˆæŠ¤è¿›ç¨‹çš„æ§åˆ¶å™¨ï¼Œæ¯ä¸ªNodeä¸Šéƒ½ä¼šè¿è¡Œä¸€ä¸ªï¼Œæ— æ³•æŒ‡å®šå‰¯æœ¬çš„æ•°é‡ã€‚ä¸€èˆ¬ç”¨äºä¿¡æ¯å’Œæ—¥å¿—çš„æ”¶é›†ã€‚</li>
<li>Job, Cronjob - ä½œä¸šç®¡ç†ï¼Œ å‘¨æœŸæ€§ä½œä¸šç®¡ç†ã€‚</li>
<li>HPA - HorizontalPodAutoscaler</li>
</ul>
<h1 id="æœåŠ¡å‘ç°çš„æ¦‚å¿µ"><a href="#æœåŠ¡å‘ç°çš„æ¦‚å¿µ" class="headerlink" title="æœåŠ¡å‘ç°çš„æ¦‚å¿µ"></a>æœåŠ¡å‘ç°çš„æ¦‚å¿µ</h1><p>ä¸ºäº†èƒ½å¿«é€Ÿç®¡ç†æ–°å¯åŠ¨çš„podï¼Œåœ¨podå’Œç”¨æˆ·ä¹‹é—´æ·»åŠ äº†<strong>é€»è¾‘çš„ä¸­é—´å±‚</strong>ï¼Œpodå¯åŠ¨åéœ€è¦åœ¨serviceä¸­æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯,å®¢æˆ·ç«¯éœ€è¦ç›¸å…³çš„æœåŠ¡çš„æ—¶å€™ä»serviceå–å¾—ç›¸å…³çš„ä¿¡æ¯ï¼Œå®ŒæˆæœåŠ¡çš„ç®¡ç†ã€‚serviceæ˜¯<strong>é€»è¾‘ç»„ä»¶</strong>ï¼Œé€šè¿‡<strong>iptablesçš„DNATæ¥å®ç°</strong>ç›¸å…³çš„serviceçš„åŠŸèƒ½ã€‚</p>
<p>å…¶å®æœåŠ¡å‘ç°ç›¸å½“äºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæœ‰Pods(ç”Ÿäº§è€…)æ¥æ³¨å†Œï¼Œæœ‰ç”¨æˆ·(æ¶ˆè´¹è€…)æ¥æ¶ˆè´¹ï¼Œåªæ˜¯ä¸ä¼šè¢«æ¶ˆè´¹æ‰ã€‚</p>
<h2 id="Kube-proxyçš„ä½œç”¨"><a href="#Kube-proxyçš„ä½œç”¨" class="headerlink" title="Kube-proxyçš„ä½œç”¨"></a>Kube-proxyçš„ä½œç”¨</h2><p>ä¸€æ—¦å‘ç°äº†serviceçš„æ”¹å˜ï¼Œåæ˜ åˆ°Iptablesä¸Šï¼ŒåŒæ—¶å‘API ServeræŠ¥å‘Šã€‚ </p>
<h1 id="Kubernetesçš„å®‰è£…éƒ¨ç½²"><a href="#Kubernetesçš„å®‰è£…éƒ¨ç½²" class="headerlink" title="Kubernetesçš„å®‰è£…éƒ¨ç½²"></a>Kubernetesçš„å®‰è£…éƒ¨ç½²</h1><p>é€šè¿‡kubeadmå·¥å…·è¿›è¡Œå®‰è£…åŠéƒ¨ç½²ï¼Œéƒ¨ç½²çš„è¿‡ç¨‹å…¶å®ä¸å¤æ‚ï¼Œåªæ˜¯é•œåƒçš„æ‹‰å–éº»çƒ¦äº†ä¸€äº›ï¼Œè®°å½•äº†ä¸€äº›ç®€å•çš„æ­¥éª¤å’Œé—®é¢˜ã€‚<br>å®‰è£…çš„æ—¶å€™å¯åŠ¨äº†ä¸‰ä¸ªè™šæ‹Ÿæœºï¼Œä¸€å°è™šæ‹Ÿæœºä½œä¸ºMasterèŠ‚ç‚¹ï¼Œå…¶ä»–çš„ä¸¤å°ä½œä¸ºNodeèŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„æœºå™¨éƒ½éœ€è¦å…³é—­firewalldï¼Œk8sä¼šé»˜è®¤æ‰˜ç®¡iptablesçš„ç›¸å…³è§„åˆ™ã€‚å®‰è£…é‡‡ç”¨k8sè‡ªæ‰˜ç®¡çš„æ–¹å¼ï¼Œç»“æ„å¦‚ä¸‹ï¼Œåˆ—å‡ºäº†åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¿…é¡»è¿è¡Œçš„æœåŠ¡å’Œå®¹å™¨ï¼š  </p>
<table>
<thead>
<tr>
<th>master</th>
<th>Node1</th>
<th>Node2</th>
</tr>
</thead>
<tbody><tr>
<td>Kubelet</td>
<td>Kubelet</td>
<td>Kubelet</td>
</tr>
<tr>
<td>Pause</td>
<td>Pause</td>
<td>Pause</td>
</tr>
<tr>
<td>Flannel</td>
<td>Flannel</td>
<td>Flannel</td>
</tr>
<tr>
<td>Kube-Proxy</td>
<td>Kube-Proxy</td>
<td>Kube-Proxy</td>
</tr>
<tr>
<td>API Server</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Schedular</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Controller-manager</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Coredns</td>
<td></td>
<td></td>
</tr>
<tr>
<td>etcd</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>æœºå™¨çš„ä¿¡æ¯å¦‚ä¸‹ï¼š  </p>
<table>
<thead>
<tr>
<th>IP-ADDRESS</th>
<th>HOSTNAME</th>
<th>ROLES</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.229.144</td>
<td>master.docker</td>
<td>master</td>
</tr>
<tr>
<td>192.168.229.145</td>
<td>node1.docker</td>
<td>node</td>
</tr>
<tr>
<td>192.168.229.146</td>
<td>node2.docker</td>
<td>node</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…åŸºç¡€ç¯å¢ƒ"><a href="#å®‰è£…åŸºç¡€ç¯å¢ƒ" class="headerlink" title="å®‰è£…åŸºç¡€ç¯å¢ƒ"></a>å®‰è£…åŸºç¡€ç¯å¢ƒ</h2><p>è¿™é‡Œè®°å½•ä¸€ä¸‹æ‰€æœ‰æœºå™¨éƒ½éœ€è¦å®‰è£…çš„ç¯å¢ƒåŠè½¯ä»¶ã€‚</p>
<ol>
<li>ç¼–è¾‘hostname<br> <code>vim /etc/hostname</code></li>
<li>å…³é—­firewalld<br> <code>systemctl mask firewalld</code></li>
<li>å…³é—­selinux<br> <code>sudo sed -i &#39;s/SELINUX=enforcing/SELINUX=disabled/&#39; /etc/selinux/config</code></li>
<li>å…³é—­Swapåˆ†åŒº, æ³¨é‡Šæ‰swapçš„ç›¸å…³è¡Œï¼Œæˆ–è€…åœ¨å®‰è£…çš„æ—¶å€™é»˜è®¤ä¸åˆ†åŒºå³å¯ã€‚<br> <code>vim /etc/fstab </code></li>
<li>é…ç½®docker-ceï¼Œkubernetesç›¸å…³è½¯ä»¶æº,ä»é˜¿é‡Œäº‘ç›´æ¥é…ç½®åˆ°æœ¬åœ°çš„æœºå™¨ä¸Šã€‚ <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># kuberneteséƒ¨åˆ†</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/yum.repos.d/kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>

<span class="token comment"># docker -ceéƒ¨åˆ†</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun</code></pre></li>
<li>åŒæ­¥é•œåƒä»“åº“ï¼Œä»docker-ceæºå®‰è£…docker-ce&#x2F;docker-cli&#x2F;containerdï¼›å…¶å®å¯ä»¥å…³é—­gpgcheckï¼Œå¹¶å°†å…¶ä»–åŒæ­¥å¤±è´¥çš„æºå…³é—­å³å¯ï¼Œæˆ‘è‡ªå·±åªæ˜¯ä¸ºäº†åšå­¦ä¹ ç”¨é€”ï¼Œå…³é—­äº†fedoraçš„updateæºï¼Œæ€»æ˜¯åŒæ­¥å¤±è´¥è€½è¯¯æˆ‘çš„æ—¶é—´ã€‚ <pre class="language-bash" data-language="bash"><code class="language-bash">dnf makecache <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-cli containerd <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
systemctl start <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> </code></pre></li>
<li>ä»kubernetesæºå®‰è£…kubeadm\kubectl\kubernetes-cni\kubeletå››ä¸ªç»„ä»¶ã€‚ <pre class="language-bash" data-language="bash"><code class="language-bash">dnf <span class="token function">install</span> - y kubeadm kubectl kubelet kubernetes-cni <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
systemctl start kubelet <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
systemctl <span class="token builtin class-name">enable</span> kubelet</code></pre>
 å››ä¸ªç»„ä»¶çš„ç”¨é€”åˆ†åˆ«æ˜¯ï¼š<ol>
<li>kubeadm ç”¨æ¥è¿›è¡Œæ‰€æœ‰èŠ‚ç‚¹çš„éƒ¨ç½²åŠåˆå§‹åŒ–ã€‚</li>
<li>kubectl é›†ç¾¤çš„cliæ¥å£ã€‚</li>
<li>kubelet æ¯ä¸ªNodeèŠ‚ç‚¹éƒ½ä¼šå¯åŠ¨kubeletè¿›ç¨‹ï¼Œç”¨æ¥å¤„ç†MasterèŠ‚ç‚¹ä¸‹å‘åˆ°æœ¬èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œç®¡ç†Podå’Œå…¶ä¸­çš„å®¹å™¨ã€‚kubeletä¼šåœ¨API Serverä¸Šæ³¨å†ŒèŠ‚ç‚¹ä¿¡æ¯ï¼Œå®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µã€‚</li>
<li>kubernetes-cni cniç½‘ç»œè§„èŒƒï¼Œé€šè¿‡cniçš„æ¡†æ¶å¯ä»¥é€šè¿‡æ’ä»¶çš„æ–¹å¼å¯¹k8sé›†ç¾¤é—´çš„ç½‘ç»œè¿›è¡Œç®¡ç†ï¼Œå¸¸è§çš„æ˜¯flannalã€‚</li>
</ol>
</li>
<li>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´æ˜¯å¦ä¸€è‡´<pre class="language-none"><code class="language-none">for i in master, node1, node2;do echo $i &amp;&amp; date;done &amp;&amp; hostname &amp;&amp; date</code></pre></li>
<li>æ¥ä¸‹æ¥å°±æ˜¯ä¸åŒèŠ‚ç‚¹äº†ï¼Œéƒ¨ç½²çš„æ–¹å¼ä¹Ÿä¸åŒï¼Œåˆ†å¼€è¯´æ˜ã€‚</li>
</ol>
<h2 id="Masterçš„åˆå§‹åŒ–"><a href="#Masterçš„åˆå§‹åŒ–" class="headerlink" title="Masterçš„åˆå§‹åŒ–"></a>Masterçš„åˆå§‹åŒ–</h2><ol>
<li><p>å‡†å¤‡é•œåƒ,googleé•œåƒè®¿é—®ä¸åˆ°ï¼Œæ‰€ä»¥æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªä½¿ç”¨é˜¿é‡Œäº‘çš„è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥å…ˆå°†é•œåƒæ‹‰åˆ°æœ¬åœ°ï¼Œç„¶åå†å¯¹masterèŠ‚ç‚¹è¿›è¡Œåˆå§‹åŒ–ã€‚é•œåƒçš„ç‰ˆæœ¬æ˜¯å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å’ŒæŒ‡å®šçš„ã€‚</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. åˆ—å‡ºéœ€è¦çš„é•œåƒåˆ—è¡¨ï¼Œè®°å½•ä¸‹æ¥ã€‚</span>
kubeadm config images list

<span class="token comment"># 2. å»ºç«‹ä¸€ä¸ªbashè„šæœ¬</span>
<span class="token assign-left variable">images</span><span class="token operator">=</span><span class="token punctuation">(</span>  
  kube-apiserver:v1.12.1
  kube-controller-manager:v1.12.1
  kube-scheduler:v1.12.1
  kube-proxy:v1.12.1
  pause:3.1
  	etcd:3.2.24
coredns:1.2.2
 <span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">imageName</span> <span class="token keyword">in</span> <span class="token variable">$&#123;images<span class="token punctuation">[</span>@<span class="token punctuation">]</span>&#125;</span> <span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">$imageName</span>
  <span class="token function">docker</span> tag registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">$imageName</span> k8s.gcr.io/<span class="token variable">$imageName</span>
  <span class="token function">docker</span> rmi registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="token variable">$imageName</span>
<span class="token keyword">done</span>
<span class="token comment"># 3. è¿è¡Œè„šæœ¬ï¼Œç­‰å¾…é•œåƒå¯¼å…¥æœ¬åœ°çš„dockerå­˜å‚¨ä¸­ã€‚</span></code></pre>
</li>
<li><p>æŸ¥çœ‹èŠ‚ç‚¹çš„æ‰€æœ‰imageå·²ç»æ­£ç¡®çš„æ‹‰å–åˆ°äº†æœ¬åœ°å³å¯</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span>$ <span class="token function">docker</span> image <span class="token function">ls</span>
REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE
k8s.gcr.io/kube-proxy                v1.15.0             d235b23c3570        <span class="token number">4</span> weeks ago         <span class="token number">82</span>.4MB
k8s.gcr.io/kube-apiserver            v1.15.0             201c7a840312        <span class="token number">4</span> weeks ago         207MB
k8s.gcr.io/kube-controller-manager   v1.15.0             8328bb49b652        <span class="token number">4</span> weeks ago         159MB
k8s.gcr.io/kube-scheduler            v1.15.0             2d3813851e87        <span class="token number">4</span> weeks ago         <span class="token number">81</span>.1MB
quay.io/coreos/flannel               v0.11.0-amd64       ff281650a721        <span class="token number">5</span> months ago        <span class="token number">52</span>.6MB
k8s.gcr.io/coredns                   <span class="token number">1.3</span>.1               eb516548c180        <span class="token number">6</span> months ago        <span class="token number">40</span>.3MB
k8s.gcr.io/etcd                      <span class="token number">3.3</span>.10              2c4adeb21b4f        <span class="token number">7</span> months ago        258MB
k8s.gcr.io/pause                     <span class="token number">3.1</span>                 da86e6ba6ca1        <span class="token number">19</span> months ago       742kB</code></pre>
</li>
<li><p>kubeadm initå‘½ä»¤è¿›è¡Œé›†ç¾¤åˆå§‹åŒ–</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubeadm init --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 --service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/12 
<span class="token comment"># --pod-network-cidr æ˜¯æŒ‡æ˜äº†flannelçš„ipåœ°å€èŒƒå›´,è¿™ä¸ªæ˜¯é›†ç¾¤çš„Nodeç½‘ç»œï¼Œè´Ÿè´£Nodeä¹‹é—´é€šä¿¡çš„ç½‘ç»œã€‚</span>
<span class="token comment"># --service-cidr=æŒ‡æ˜äº†å®¹å™¨å»ºç«‹æ—¶ç›´æ¥åˆ†é…çš„ipåœ°å€ï¼Œè¿™ä¸ªæ˜¯é›†ç¾¤çš„Podç½‘ç»œï¼Œè´Ÿè´£Podä¹‹é—´é€šä¿¡çš„ç½‘ç»œã€‚</span></code></pre>
</li>
<li><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€</p>
<p> è¿™ä¸ªä¿¡æ¯ä¸æ˜¯åˆšéƒ¨ç½²å®Œæˆçš„ä¿¡æ¯ï¼Œåªæ˜¯ä¸¾ä¸ªä¾‹å­å±•ç¤ºä¸€ä¸‹æ•ˆæœã€‚</p>
<p> <code>kubectl get pods -n kube-system</code> å‘½ä»¤å¯ä»¥è·å–<strong>é›†ç¾¤åç§°ç©ºé—´kube-systemå†…</strong>çš„æ‰€æœ‰podçš„ä¿¡æ¯ï¼›<br> <code>kubectl get nodes</code>å’Œ<code>kubectl get nodes -o wide</code> å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯ï¼›</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash">  <span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system</span>
  NAME                                    READY   STATUS    RESTARTS   AGE
  coredns-5c98db65d4-m5gj8                <span class="token number">1</span>/1     Running   <span class="token number">12</span>         3d3h
  coredns-5c98db65d4-nmdzx                <span class="token number">1</span>/1     Running   <span class="token number">12</span>         3d3h
  etcd-master.docker                      <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  kube-apiserver-master.docker            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  kube-controller-manager-master.docker   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  kube-flannel-ds-amd64-fdcr9             <span class="token number">1</span>/1     Running   <span class="token number">3</span>          3d3h
  kube-flannel-ds-amd64-hqwtr             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          2d1h
  kube-flannel-ds-amd64-lqtjc             <span class="token number">1</span>/1     Running   <span class="token number">4</span>          3d3h
  kube-proxy-k8vcz                        <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  kube-proxy-m6j4m                        <span class="token number">1</span>/1     Running   <span class="token number">2</span>          2d1h
  kube-proxy-ww2z9                        <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  kube-scheduler-master.docker            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          3d3h
  
  <span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME            STATUS   ROLES    AGE    VERSION
  master.docker   Ready    master   3d3h   v1.15.0
  node1.docker    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   3d3h   v1.15.0
  node2.docker    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   2d1h   v1.15.1
  
  <span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes -o wide</span>
  NAME            STATUS   ROLES    AGE    VERSION   INTERNAL-IP       EXTERNAL-IP   OS-IMAGE                     KERNEL-VERSION          CONTAINER-RUNTIME
  master.docker   Ready    master   3d4h   v1.15.0   <span class="token number">192.168</span>.229.144   <span class="token operator">&lt;</span>none<span class="token operator">></span>        Fedora <span class="token number">30</span> <span class="token punctuation">(</span>Server Edition<span class="token punctuation">)</span>   <span class="token number">5.0</span>.9-301.fc30.x86_64   docker://19.3.0
  node1.docker    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   3d3h   v1.15.0   <span class="token number">192.168</span>.229.145   <span class="token operator">&lt;</span>none<span class="token operator">></span>        Fedora <span class="token number">30</span> <span class="token punctuation">(</span>Server Edition<span class="token punctuation">)</span>   <span class="token number">5.0</span>.9-301.fc30.x86_64   docker://19.3.0
  node2.docker    Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   2d1h   v1.15.1   <span class="token number">192.168</span>.229.146   <span class="token operator">&lt;</span>none<span class="token operator">></span>        Fedora <span class="token number">30</span> <span class="token punctuation">(</span>Server Edition<span class="token punctuation">)</span>   <span class="token number">5.0</span>.9-301.fc30.x86_64   docker://19.3.0</code></pre></li>
</ol>
<h2 id="NodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><a href="#NodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤" class="headerlink" title="NodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"></a>NodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h2><p>åœ¨NodeèŠ‚ç‚¹ä¸Šï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼Œå°†éœ€è¦çš„é•œåƒå¯¼å…¥ã€‚</p>
<ol>
<li><p>kubeadm joinå°†èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼ŒåŒæ—¶åœ¨masterä¸Šæ³¨å†ŒèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚<br> ä½¿ç”¨kubeadm joinå°†èŠ‚ç‚¹æ³¨å†Œåˆ°masterä¸Š,ç»™å‡ºmasterä¸Šç”Ÿæˆçš„tokenï¼ŒæŒ‡å®šAPI Serverçš„IPåœ°å€ï¼ŒæŒ‡å‡ºcaè¯ä¹¦çš„hashå°±å¯ä»¥å°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤å¹¶åˆå§‹åŒ–</p>
 <pre class="language-none"><code class="language-none">kubeadm join --token jj10e9.7robjkn1202au8a4 192.168.229.144:6443 --discovery-token-ca-cert-hash sha256:452775d08cca2523f36b1d41101856b3d90f469a39bf7ccdd5bf45150fbff94d</code></pre></li>
<li><p>ä½¿ç”¨docker save åœ¨<em>masterèŠ‚ç‚¹</em>ä¸Šä¿å­˜ä¸‹æ¥kube-proxy\kube-pause\flannelé•œåƒ</p>
<pre class="language-none"><code class="language-none">docker save &gt; .&#x2F;kube-proxy.tar 
docker save &gt; .&#x2F;kube-pause.tar
docker save &gt; .&#x2F;flannel.tar</code></pre></li>
<li><p>ä½¿ç”¨docker load åœ¨<em>æ‰€æœ‰çš„nodeèŠ‚ç‚¹ä¸Š</em>å¯¼å…¥kube-proxy\kube-pause\flannelé•œåƒ</p>
<pre class="language-none"><code class="language-none">docker load &lt; .&#x2F;kube-proxy.tar
docker load &lt; .&#x2F;kube-pause.tar
docker load &lt; .&#x2F;flannel.tar</code></pre></li>
<li><p>é‡å¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„kubeletæœåŠ¡ï¼Œé‡å¯ä¹‹åä¼šè‡ªåŠ¨åŠ è½½å¹¶å¯åŠ¨ç›¸å…³çš„image<br><code>systemctl restart kubelet.service</code></p>
</li>
<li><p>ç”Ÿæˆæ–°çš„èŠ‚ç‚¹token</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">   <span class="token comment"># ç”Ÿæˆæ–°çš„token	</span>
   <span class="token comment"># kubeadm token create tokençš„æœ‰æ•ˆæœŸåªæœ‰24hï¼Œè¶…è¿‡æ—¶é—´å°±éœ€è¦é‡æ–°ç”Ÿæˆã€‚</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm token create</span>
jj10e9.7robjkn1202au8a4

<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„token</span>
<span class="token comment"># kubeadm token listå‘½ä»¤ç”¨æ¥æŸ¥çœ‹ç°åœ¨èŠ‚ç‚¹çš„é“¾æ¥éœ€è¦çš„è®¤è¯ä¿¡æ¯</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm token list</span>
TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION   EXTRA <span class="token environment constant">GROUPS</span>
jj10e9.7robjkn1202au8a4   23h       <span class="token number">2019</span>-07-24T17:14:56+08:00   authentication,signing   <span class="token operator">&lt;</span>none<span class="token operator">></span>        system:bootstrappers:kubeadm:default-node-token</code></pre></li>
<li><p>é‡æ–°æŸ¥çœ‹èŠ‚ç‚¹çš„ID</p>
 <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è·å–caè¯ä¹¦sha256ç¼–ç hashå€¼</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span>$ openssl x509 <span class="token parameter variable">-pubkey</span> <span class="token parameter variable">-in</span> /etc/kubernetes/pki/ca.crt <span class="token operator">|</span> openssl rsa <span class="token parameter variable">-pubin</span> <span class="token parameter variable">-outform</span> der <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-hex</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/^.* //'</span>
452775d08cca2523f36b1d41101856b3d90f469a39bf7ccdd5bf45150fbff94d</code></pre></li>
</ol>
<h1 id="éƒ¨ç½²å®Œæˆ"><a href="#éƒ¨ç½²å®Œæˆ" class="headerlink" title="éƒ¨ç½²å®Œæˆ"></a>éƒ¨ç½²å®Œæˆ</h1>]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(2)</title>
    <url>/2019/07/23/Linux/Linux_k8s-basic-2/</url>
    <content><![CDATA[<p>Kubernetesçš„åŸºæœ¬ä½¿ç”¨å‘½ä»¤ã€‚</p>
<p>å¯¹æ§åˆ¶å‘½ä»¤è¿›è¡Œåˆ†ç±»æ•´ç†ï¼š</p>
<h1 id="æŸ¥çœ‹k8sæ•´ä½“çŠ¶æ€çš„å‘½ä»¤"><a href="#æŸ¥çœ‹k8sæ•´ä½“çŠ¶æ€çš„å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹k8sæ•´ä½“çŠ¶æ€çš„å‘½ä»¤"></a>æŸ¥çœ‹k8sæ•´ä½“çŠ¶æ€çš„å‘½ä»¤</h1><ol>
<li>kubectl describe node node1.docker<br> æŸ¥çœ‹nodeçš„è¯¦ç»†ä¿¡æ¯</li>
<li>kubectl version<br> æŸ¥çœ‹kubeçš„ç‰ˆæœ¬ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå®¢æˆ·ç«¯çš„ç‰ˆæœ¬åŠæœåŠ¡ç«¯çš„ç‰ˆæœ¬</li>
<li>kubectl cluster-info<br> æŸ¥çœ‹kubeçš„é›†ç¾¤ä¿¡æ¯ï¼ŒmasterèŠ‚ç‚¹çš„æ‰€åœ¨åœ°å€åŠkubeDNSçš„æ‰€åœ¨åœ°å€</li>
</ol>
<h1 id="æ‰‹åŠ¨è¿è¡ŒPodsçš„å‘½ä»¤"><a href="#æ‰‹åŠ¨è¿è¡ŒPodsçš„å‘½ä»¤" class="headerlink" title="æ‰‹åŠ¨è¿è¡ŒPodsçš„å‘½ä»¤"></a>æ‰‹åŠ¨è¿è¡ŒPodsçš„å‘½ä»¤</h1><ol start="4">
<li>kubectl run nginx â€“image&#x3D;nginx â€“replicas&#x3D;5<br> å¯åŠ¨5ä¸ªnginxçš„pods</li>
<li>kubectl run nginx â€“image&#x3D;nginx â€“port:80 â€“replicas&#x3D;5 â€“dry-run&#x3D;true<br> å¯åŠ¨5ä¸ªnginxçš„podçš„æµ‹è¯•ï¼Œä½†ä¸æ‰§è¡Œæ”¹å˜ï¼Œå¹¶exposeç«¯å£80</li>
</ol>
<h1 id="æŸ¥çœ‹Podsçš„å‘½ä»¤"><a href="#æŸ¥çœ‹Podsçš„å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹Podsçš„å‘½ä»¤"></a>æŸ¥çœ‹Podsçš„å‘½ä»¤</h1><ol start="6">
<li>kubectl get pods<br> åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹æ­£åœ¨è¿è¡Œçš„podçš„çŠ¶æ€ä¿¡æ¯</li>
<li>kubectl get deployment<br> åˆ—å‡ºæ‰€æœ‰çš„deploymentæ§åˆ¶å™¨çš„ä¿¡æ¯ï¼Œ<strong>æ‰€æœ‰çš„podå±äºcni0æ¡¥ï¼Œä¸å±äºdockeræ¡¥</strong></li>
</ol>
<h1 id="åˆ é™¤å•ç‹¬ä¸€ä¸ªPodsçš„å‘½ä»¤"><a href="#åˆ é™¤å•ç‹¬ä¸€ä¸ªPodsçš„å‘½ä»¤" class="headerlink" title="åˆ é™¤å•ç‹¬ä¸€ä¸ªPodsçš„å‘½ä»¤"></a>åˆ é™¤å•ç‹¬ä¸€ä¸ªPodsçš„å‘½ä»¤</h1><ol start="8">
<li>kubectl delete pods hayden-nginx-6dd3ffd4c5-ww7mk<br>åˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„pod</li>
</ol>
<h1 id="æ‰‹åŠ¨å»ºç«‹Podså¹¶å¯¹å¤–å‘å¸ƒçš„å‘½ä»¤"><a href="#æ‰‹åŠ¨å»ºç«‹Podså¹¶å¯¹å¤–å‘å¸ƒçš„å‘½ä»¤" class="headerlink" title="æ‰‹åŠ¨å»ºç«‹Podså¹¶å¯¹å¤–å‘å¸ƒçš„å‘½ä»¤"></a>æ‰‹åŠ¨å»ºç«‹Podså¹¶å¯¹å¤–å‘å¸ƒçš„å‘½ä»¤</h1><ol start="9">
<li>kubectl expose deployment hayden-nginx â€“type&#x3D;[{ClusterIP},NodePort,LoadBalancer,ExternalName]  â€“name&#x3D;nginx-service â€“target-port&#x3D;80 â€“protocol&#x3D;TCP<br>åˆ›å»ºä¸€ä¸ªæ–°çš„serviceï¼Œå°†å†…éƒ¨çš„é€šä¿¡ä»¥serviceçš„å½¢å¼å¯¹å¤–äº¤ä»˜</li>
</ol>
<h1 id="æŸ¥çœ‹svcçŠ¶æ€çš„å‘½ä»¤"><a href="#æŸ¥çœ‹svcçŠ¶æ€çš„å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹svcçŠ¶æ€çš„å‘½ä»¤"></a>æŸ¥çœ‹svcçŠ¶æ€çš„å‘½ä»¤</h1><ol start="10">
<li>kubectl get svc<br>æŸ¥çœ‹serviceçš„çŠ¶æ€</li>
</ol>
<h1 id="æŸ¥çœ‹å±äºæŸä¸ªåç§°ç©ºé—´çš„å‘½ä»¤"><a href="#æŸ¥çœ‹å±äºæŸä¸ªåç§°ç©ºé—´çš„å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹å±äºæŸä¸ªåç§°ç©ºé—´çš„å‘½ä»¤"></a>æŸ¥çœ‹å±äºæŸä¸ªåç§°ç©ºé—´çš„å‘½ä»¤</h1><ol start="11">
<li>kubectl get nodes -n kube-system -o wide<br>æŸ¥çœ‹å±äºkube-systemçš„èŠ‚ç‚¹çš„ä¿¡æ¯</li>
<li>kubectl get svc -n kube-system -o wide<br>æŸ¥çœ‹å±äºkube-systemçš„æœåŠ¡çš„ä¿¡æ¯</li>
</ol>
<h1 id="ä»ä¸é‡å¯Podsçš„è®¾ç½®"><a href="#ä»ä¸é‡å¯Podsçš„è®¾ç½®" class="headerlink" title="ä»ä¸é‡å¯Podsçš„è®¾ç½®"></a>ä»ä¸é‡å¯Podsçš„è®¾ç½®</h1><ol start="13">
<li>kubectl run t-centos â€“image&#x3D;centos -it â€“restart&#x3D;Never â€“replicas&#x3D;1<br>å¯åŠ¨1ä¸ªæ™®é€šçš„å®¹å™¨ä½œä¸ºå®¢æˆ·ç«¯è¿›è¡ŒæœåŠ¡çš„è®¿é—®</li>
<li>kubectl describe svc nginx-service<br>æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</li>
<li>kubectl get nodes â€“show-labels<br>æŸ¥çœ‹èŠ‚ç‚¹çš„æ ‡ç­¾</li>
</ol>
<h1 id="å¯¹svcè¿›è¡Œç¼–è¾‘å’Œä¿®æ”¹"><a href="#å¯¹svcè¿›è¡Œç¼–è¾‘å’Œä¿®æ”¹" class="headerlink" title="å¯¹svcè¿›è¡Œç¼–è¾‘å’Œä¿®æ”¹"></a>å¯¹svcè¿›è¡Œç¼–è¾‘å’Œä¿®æ”¹</h1><ol start="16">
<li>kubectl edit svc nginx-service<br>ç¼–è¾‘ä¸€ä¸ªserviceçš„å±æ€§ï¼Œå‘½ä»¤æ‰“å¼€vimçš„ç¼–è¾‘ç•Œé¢è¿›è¡Œé…ç½®æ–‡ä»¶çš„æ›´æ”¹</li>
<li>kubectl delete svc nginx-service<br>åˆ é™¤ä¸€ä¸ªservice</li>
<li>kubectl get deployment -w<br>é•¿æ—¶é—´ç›‘æ§ä¸€ä¸ªæ§åˆ¶å™¨çš„çŠ¶æ€æ”¹å˜</li>
</ol>
<h1 id="å¯¹Podsçš„å‡çº§å’Œå›æ»š"><a href="#å¯¹Podsçš„å‡çº§å’Œå›æ»š" class="headerlink" title="å¯¹Podsçš„å‡çº§å’Œå›æ»š"></a>å¯¹Podsçš„å‡çº§å’Œå›æ»š</h1><ol start="19">
<li>kubectl set image deployment hayden-nginx hayden-nginx&#x3D;nginx:latest<br>å¯¹å®¹å™¨æŒ‡å®šå…¶ä»–çš„é•œåƒè¿›è¡ŒåŠ¨æ€çš„å‡çº§åŠæ›´æ–°</li>
<li>kubectl rollout status deployment hayden-nginx<br>å¯¹å®¹å™¨ç‰ˆæœ¬çš„æ›´æ–°è¿›è¡Œè¿›åº¦çš„æŸ¥çœ‹</li>
</ol>
<h1 id="æŒ‡å®šç‰ˆæœ¬çš„å›æ»š"><a href="#æŒ‡å®šç‰ˆæœ¬çš„å›æ»š" class="headerlink" title="æŒ‡å®šç‰ˆæœ¬çš„å›æ»š"></a>æŒ‡å®šç‰ˆæœ¬çš„å›æ»š</h1><ol start="21">
<li>kubectl rollout undo deployment hayden-nginx<br>å¯¹å‡çº§çš„ç‰ˆæœ¬è¿›è¡Œå›æ»šï¼Œå¯æŒ‡å®šå›æ»šçš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯ä¸Šä¸€ä¸ªç‰ˆæœ¬</li>
</ol>
<h1 id="Serviceå‘å¸ƒåˆ°NodePort"><a href="#Serviceå‘å¸ƒåˆ°NodePort" class="headerlink" title="Serviceå‘å¸ƒåˆ°NodePort"></a>Serviceå‘å¸ƒåˆ°NodePort</h1><p>å¤–éƒ¨è®¿é—®åˆ°serviceçš„æ–¹æ³•æ˜¯å®šä¹‰typeä¸ºNodePortï¼Œå¯åœ¨åˆ›å»ºserviceçš„æ—¶å€™å®šä¹‰ç±»å‹ï¼Œæˆ–è€…ä½¿ç”¨kubectl edit svc nginx-serviceå°†typeå˜æ›´ä¸ºNodePort ã€‚</p>
<h1 id="åˆ›å»ºèµ„æºçš„é€»è¾‘æ€è·¯"><a href="#åˆ›å»ºèµ„æºçš„é€»è¾‘æ€è·¯" class="headerlink" title="åˆ›å»ºèµ„æºçš„é€»è¾‘æ€è·¯"></a>åˆ›å»ºèµ„æºçš„é€»è¾‘æ€è·¯</h1><p>åˆšä»dockerçš„ç®¡ç†æ€è·¯è¿‡æ¥çš„æ—¶å€™è¿˜æ˜¯æœ‰äº›èŒ«ç„¶ï¼Œ ä¸å¤ªçŸ¥é“è¯¥æ€ä¹ˆç”¨ã€‚å…¶å®ä»k8sçš„ç®¡ç†é€»è¾‘ä¸Šï¼Œæˆ‘ä»¬å°†ä¹‹å‰çš„container å˜æ›´ä¸º podï¼Œå°†podçš„ç®¡ç†äº¤ç»™ä¸€ä¸ªdeploymentï¼Œå°†deploymentå·²ç»å¯åŠ¨çš„æ‰€æœ‰å®¹å™¨é€šè¿‡å¯¹å¤–æä¾›serviceçš„æ–¹å¼exposeåˆ°å¤–éƒ¨ã€‚ä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªhttpdæœåŠ¡ï¼Œä¸éœ€è¦ç›´æ¥å»dockerå¯åŠ¨äº†ï¼Œæˆ‘ç›´æ¥åœ¨k8sä¸Šå®šä¹‰ä¸€ä¸ªdeployment-httpdï¼Œé€šè¿‡k8sçš„æ§åˆ¶å™¨å»è°ƒåº¦å®¹å™¨ã€‚å¦‚æœéœ€è¦æ§åˆ¶å®¹å™¨å¯¹å¤–æä¾›æœåŠ¡ï¼Œé‚£å°±ç›´æ¥åˆ›å»ºä¸€ä¸ªserviceï¼Œé€šè¿‡serviceå»ç›´æ¥å®šä¹‰å’Œç®¡ç†å¯¹å¤–çš„æœåŠ¡å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(3)</title>
    <url>/2019/09/24/Linux/Linux_k8s-basic-3/</url>
    <content><![CDATA[<p>k8sç¬”è®°YAMLæ ¼å¼å®šä¹‰èµ„æºã€‚</p>
<span id="more"></span>

<h1 id="é€šè¿‡YAMLå®šä¹‰Pods"><a href="#é€šè¿‡YAMLå®šä¹‰Pods" class="headerlink" title="é€šè¿‡YAMLå®šä¹‰Pods"></a>é€šè¿‡YAMLå®šä¹‰Pods</h1><h2 id="apiVersion"><a href="#apiVersion" class="headerlink" title="apiVersion"></a>apiVersion</h2><p>kubectl api-versions<br>æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ç»„å<br>apiVersion:[Group&#x2F;Version]</p>
<h2 id="Kind-èµ„æºç±»åˆ«"><a href="#Kind-èµ„æºç±»åˆ«" class="headerlink" title="Kind èµ„æºç±»åˆ«"></a>Kind èµ„æºç±»åˆ«</h2><h2 id="Metadata-å…ƒæ•°æ®"><a href="#Metadata-å…ƒæ•°æ®" class="headerlink" title="Metadata å…ƒæ•°æ®"></a>Metadata å…ƒæ•°æ®</h2><ol>
<li>name: uniq Key</li>
<li>namespace</li>
<li>labels Key-Value<ol>
<li>annotations </li>
<li>SelfLink: èµ„æºå¼•ç”¨çš„é“¾æ¥APIæ ¼å¼ï¼š&#x2F;api&#x2F;group&#x2F;verison&#x2F;namespaces&#x2F;namespace&#x2F;type&#x2F;name</li>
</ol>
</li>
</ol>
<h2 id="Spec"><a href="#Spec" class="headerlink" title="Spec"></a>Spec</h2><p><code>kubectl explain pods.spec</code><br>å¯ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ï¼šå®šä¹‰ç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚</p>
<h2 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h2><p>è‡ªåŠ¨ç»´æŠ¤å³å¯ ï¼Œä¸éœ€è¦æ›´æ”¹ã€‚</p>
<h1 id="ç®€å•çš„YAMLå®ä¾‹"><a href="#ç®€å•çš„YAMLå®ä¾‹" class="headerlink" title="ç®€å•çš„YAMLå®ä¾‹"></a>ç®€å•çš„YAMLå®ä¾‹</h1><pre class="language-none"><code class="language-none">apiVersion: v1 
kind: Pod
metadata:
    name: myapp-pod
    labels:
        app: myapp
        version: v1
spec: 
    containers:
    - name: app
      image: nginx
   - name: php-fpm
      image: php-fpm</code></pre>

<h2 id="å¯¹Podsè¿›è¡Œæ ‡ç­¾æ“ä½œ"><a href="#å¯¹Podsè¿›è¡Œæ ‡ç­¾æ“ä½œ" class="headerlink" title="å¯¹Podsè¿›è¡Œæ ‡ç­¾æ“ä½œ"></a>å¯¹Podsè¿›è¡Œæ ‡ç­¾æ“ä½œ</h2><ol>
<li><p>æŸ¥çœ‹æ ‡ç­¾<br>kubectl get pods â€“show-labels<br>kubectl get pods -l LABEL_NAME â€“show-labels</p>
</li>
<li><p>å¢åŠ æ ‡ç­¾<br>kubectl label pods pod-demo KEY VALUE</p>
</li>
<li><p>ä¿®æ”¹æ ‡ç­¾<br>kubectl label pods pod-demo KEY VALUE â€“overwirte</p>
</li>
<li><p>æŒ‡å®šselectoré€‰æ‹©æ ‡ç­¾ - ç­‰å€¼å…³ç³»ï¼Œ é›†åˆå…³ç³»çš„æ ‡ç­¾é€‰æ‹©å™¨ã€‚<br>kubectl get pods -l release&#x3D;stable<br>kubectl get pods -l release!&#x3D;stable<br>kubectl get pods -l â€œrelease in (v1, v2, v3)â€<br>kubectl get pods -l â€œrelease notin (v1, v2, v3)â€</p>
<p>è®¸å¤šèµ„æºæ”¯æŒå†…åµŒå­—æ®µï¼ŒmatchLabels(ç›´æ¥ç»™å®šé”®å€¼) ï¼Œ matchExporession(åŸºäºç»™å‡ºçš„è¡¨è¾¾å¼è¿›è¡Œé€‰æ‹©)ã€‚å¸¸ç”¨çš„æ“ä½œç¬¦å·ï¼ŒIn ; Notin ï¼› Existsï¼›NotExistsï¼›</p>
</li>
</ol>
<h2 id="Podçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Podçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Podçš„ç”Ÿå‘½å‘¨æœŸ"></a>Podçš„ç”Ÿå‘½å‘¨æœŸ</h2><ul>
<li>åˆå§‹åŒ–å®¹å™¨init c(åˆå§‹åŒ–ä¸»å®¹å™¨çš„æ‰§è¡Œç¯å¢ƒ)ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸²è¡Œæ‰§è¡Œï¼Œç›´åˆ°æœ€åä¸€ä¸ªinit cæ‰§è¡Œç»“æŸã€‚</li>
<li>main cåœ¨æ‰€æœ‰çš„åˆå§‹åŒ–å®Œæˆä¹‹åå¼€å§‹å¯åŠ¨ï¼Œåœ¨å®¹å™¨çš„è¿è¡Œæ—¶é—´ä¸main cçš„æ‰§è¡Œæ—¶é—´åŸºæœ¬ä¸€è‡´ï¼›main cåˆšåˆšå¯åŠ¨ä¹‹åï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡ŒPoststartï¼›ç»“æŸä¹‹å‰å¯ä»¥è¿›è¡ŒPrestopï¼›</li>
<li>åœ¨Podè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæä¾›Podçš„Liveness probeï¼› æä¾›Podçš„Readiness probeã€‚</li>
</ul>
<p>å¸¸è§çš„PodçŠ¶æ€ï¼š</p>
<ol>
<li>Pendingï¼š æŒ‚èµ·ï¼Œè°ƒåº¦å°šæœªå®Œæˆï¼›</li>
<li>Runningï¼š è¿è¡ŒçŠ¶æ€ï¼›</li>
<li>Failedï¼š å¤±è´¥ï¼›</li>
<li>Succeededï¼š æˆåŠŸï¼›</li>
<li>Unknown: kubeletå¤±å»è”ç»œæˆ–è€…æ— æ³•è·å–Podä¿¡æ¯æ—¶ï¼›</li>
</ol>
<p>åˆ›å»ºPodçš„é˜¶æ®µï¼š</p>
<ol>
<li>åˆ›å»ºæäº¤è¯·æ±‚ç»™API serverï¼Œç›®æ ‡çŠ¶æ€ä¿å­˜åˆ°etcd;</li>
<li>API Server è¯·æ±‚ Schduler è¿›è¡ŒPodçš„è°ƒåº¦ï¼›</li>
<li>APIå–å¾—Podçš„è°ƒåº¦ç»“æœåï¼Œå°†ä¿¡æ¯è®°å½•åˆ°etcdï¼›</li>
<li>NodeèŠ‚ç‚¹è·å–åˆ°API serverä¸Šçš„PodçŠ¶æ€æ›´æ–°åï¼Œå¼€å§‹æŒ‰ç…§è°ƒåº¦çš„ä¿¡æ¯è¿›è¡ŒPodçš„å»ºç«‹ã€‚</li>
</ol>
<p>Podç”Ÿå‘½å‘¨æœŸä¸­çš„é‡è¦è¡Œä¸ºï¼š</p>
<ol>
<li>åˆå§‹åŒ–å®¹å™¨ï¼š init container ; </li>
<li>å®¹å™¨æ¢æµ‹ï¼š liveness ,readiness;</li>
</ol>
<p>å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼š restartPolicy<br>Always, OnFailure, Never; ä¸‰ç§ç­–ç•¥ä¸­é»˜è®¤çš„è®¾ç½®æ—¶Always.</p>
<p>Podçš„ç»ˆæ­¢è¿‡ç¨‹ï¼š</p>
<ol>
<li>å‘é€termä¿¡å·ï¼Œ é»˜è®¤ç­‰å¾…30sï¼Œå¦‚æœ30sè¿˜æœªç»ˆæ­¢å°±å¼ºåˆ¶ç»ˆæ­¢ã€‚</li>
</ol>
<h2 id="å­˜æ´»æ£€æµ‹"><a href="#å­˜æ´»æ£€æµ‹" class="headerlink" title="å­˜æ´»æ£€æµ‹"></a>å­˜æ´»æ£€æµ‹</h2><p>å¯é€šè¿‡ä¸‰ç§ç±»å‹è¿›è¡Œæ¢æµ‹ï¼š ExecAction, TCPSocketAction, HTTPGetAction;</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(4)</title>
    <url>/2019/10/14/Linux/Linux_k8s-basic-4/</url>
    <content><![CDATA[<p>K8S Serviceèµ„æºçš„ç¬”è®°ä»¥åŠIngressèµ„æºçš„ç¬”è®°ã€‚</p>
<h1 id="k8sçš„service"><a href="#k8sçš„service" class="headerlink" title="k8sçš„service"></a>k8sçš„service</h1><p>serviceçš„æ¨¡å‹ï¼š userspace(kube-proxy), iptables, ipvs </p>
<h2 id="Serviceçš„ç±»å‹"><a href="#Serviceçš„ç±»å‹" class="headerlink" title="Serviceçš„ç±»å‹"></a>Serviceçš„ç±»å‹</h2><p>è¯·æ±‚å‘é€çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>Client â€“&gt; Nodeâ€™s IP:Nodeâ€™s Port â€“&gt; Clusterâ€™s IP:ServicePort â€“&gt; PodIP: ContainerPort</li>
</ul>
<p>Serviceçš„ç±»å‹ï¼š</p>
<ul>
<li><p>ClusterIPæ˜¯å°†æä¾›æœåŠ¡çš„Podsç»Ÿä¸€å»ºç«‹ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„å¯è®¿é—®æ¥å£ï¼Œä¸ºé›†ç¾¤å†…éƒ¨çš„æœåŠ¡æä¾›å…¥å£ï¼ŒPodsPort to ClusterIP:Port.</p>
</li>
<li><p>NodePortæ˜¯å°†Nodeçš„ç«¯å£æ˜ å°„å‡ºå»çš„æ–¹å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹å„è‡ªå¯¹å¤–æä¾›ä¸€ç»„IP:Portç”¨æ¥å¯¹å¤–æä¾›æœåŠ¡ - PodsPort to NodePort.</p>
</li>
<li><p>LoadBalancerä½¿ç”¨LBaaSçš„æ–¹å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œå…±æœ‰äº‘ç¯å¢ƒå¯ç”¨ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘ã€‚</p>
</li>
<li><p>Externalnameå¯å°†å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤çš„å†…éƒ¨ï¼Œéœ€è¦æä¾›çš„å­—æ®µæ˜¯å¤–éƒ¨ç½‘ç»œçš„çœŸæ­£çš„DNSæœåŠ¡çš„CNAMEï¼ˆFQDNï¼‰ã€‚</p>
</li>
<li><p>HeadlessServiceæ˜¯ä¸æä¾›ClusterIPï¼Œå¯å°†ServiceNameç›´æ¥è§£æåˆ°PodsIPã€‚</p>
</li>
</ul>
<p>ä¸Šé¢çš„æ¯ä¸€ä¸ªç±»å‹çš„æœåŠ¡éƒ½æ˜¯é¡ºåºå¢å¼ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºç¡€çš„æ¨¡å¼æ˜¯ ClusterIP ã€‚</p>
<h3 id="HTTPSçš„å¤„ç†å’Œæ€è·¯"><a href="#HTTPSçš„å¤„ç†å’Œæ€è·¯" class="headerlink" title="HTTPSçš„å¤„ç†å’Œæ€è·¯"></a>HTTPSçš„å¤„ç†å’Œæ€è·¯</h3><ol>
<li><p>å¯åŠ¨ä¸€ä¸ªPodå¯¹HTTPSè¿›è¡Œå¸è½½å’ŒLB</p>
<p>å¦‚æœéœ€è¦å¯¹HTTPSè¿›è¡Œé…ç½®ï¼ŒKubernetesæœ¬èº«æä¾›çš„Serviceä¸èƒ½æä¾›7å±‚åè®®çš„å¸è½½(å°†HTTPSå¸è½½ä¸ºHTTPä¸åç«¯åšé€šä¿¡ä»¥åŠæ•°æ®äº¤æ¢),é‚£ä¹ˆå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„Podï¼Œä¾‹å¦‚nginxï¼Œç”±nginx-podè¿›è¡ŒHTTPSçš„ä»£ç†å’Œå¸è½½æ“ä½œï¼Œä½†æ˜¯è¿™æ ·çš„è¯å°±ä¼šæœ‰å¦‚ä¸‹çš„æµç¨‹ï¼š </p>
<p>User Request â€“&gt; LBaaS(LB) â€“&gt; Service - NodePort(LB) â€“&gt; Pod - nginx proxy(LB) â€“&gt; BackendPods</p>
<p>PROBLEM: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„è¯·æ±‚éœ€è¦è¿›è¡Œä¸¤æ¬¡è´Ÿè½½çš„è½¬æ¢æ‰å¯ä»¥åˆ°è¾¾Podï¼Œå¼€é”€å¤ªå¤§ã€‚</p>
</li>
<li><p>å°†Nginxçš„Podä¸Nodeçš„Netåç§°ç©ºé—´è¿›è¡Œå…±äº«</p>
<p>ä½¿å¾—Nginxçš„Podç›´æ¥å·¥ä½œåœ¨Nodeçš„ç½‘å¡çº§åˆ«ä¸Šã€‚å…å»äº†K8Sçš„Serviceä¸­é—´çš„ä¸€æ¬¡è½¬å‘ã€‚ä¸ºäº†é¿å…å•ç‚¹çš„æ•…éšœï¼Œå¯å°†DeamonSetå°†Podè¿è¡Œåœ¨ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸Šã€‚</p>
</li>
</ol>
<h2 id="Ingress-Controller"><a href="#Ingress-Controller" class="headerlink" title="Ingress Controller"></a>Ingress Controller</h2><p>å¯ä»¥ç”¨äºå¤„ç†å’Œå¸è½½HTTPSåè®®çš„è´Ÿè½½å‡è¡¡å™¨Podæ§åˆ¶å™¨ã€‚</p>
<p>K8Så››ä¸ªé™„ä»¶ï¼š DNSï¼Œ DashBoardï¼Œ Ingress Controller,  heasperã€‚</p>
<p>å¦‚ä¸Šçš„é‚£ç§NginxPodï¼Œè¡ç”Ÿä¸ºIngress Controllerï¼Œ ç‹¬ç«‹è¿è¡Œçš„åº”ç”¨ç¨‹åºç»„æˆï¼Œä¸å±äºController Managerã€‚é€šå¸¸ç”±4ç§é€‰æ‹©ï¼šHAProxyï¼ŒNginxï¼ŒEnvoyï¼ŒTraefikã€‚å¾®æœåŠ¡ä½¿ç”¨æ›´å¤šçš„æ˜¯Envoyã€‚</p>
<h3 id="Ingressèµ„æº"><a href="#Ingressèµ„æº" class="headerlink" title="Ingressèµ„æº"></a>Ingressèµ„æº</h3><p>å®šä¹‰IngressControllerå¦‚ä½•å»ºç«‹ä¸€ä¸ªæœŸæœ›çš„å‰ç«¯ï¼ˆNginx URL Rewriteï¼‰ï¼ŒåŒæ—¶å®šä¹‰äº†æœŸæœ›çš„åç«¯(Upstream servers)ï¼Œæ›´æ–°åç«¯è´Ÿè½½Podçš„ä¿¡æ¯ã€‚</p>
<h3 id="Ingressç±»å‹"><a href="#Ingressç±»å‹" class="headerlink" title="Ingressç±»å‹"></a>Ingressç±»å‹</h3><h3 id="Ingressèµ„æºçš„å®šä¹‰æ ¼å¼"><a href="#Ingressèµ„æºçš„å®šä¹‰æ ¼å¼" class="headerlink" title="Ingressèµ„æºçš„å®šä¹‰æ ¼å¼"></a>Ingressèµ„æºçš„å®šä¹‰æ ¼å¼</h3><p>ä½¿ç”¨NginxServerçš„æ–¹å¼è¿›è¡Œé…ç½®IngressPod</p>
<pre class="language-YAML" data-language="YAML"><code class="language-YAML">apiVersion: Extensions&#x2F;v1beta1
kind: Ingress
metadata:
  name: ingress-nginx
  namespace: default
  annotations: 
    kubernetes.io&#x2F;ingress.class: &quot;nginx&quot;
spec:
  rules:
  - host: nginx.test.local
    http:
    	paths:
    	- path:
    	  backend:
    		serviceName: svc-nginx
    		servicePort: 80 		 	</code></pre>

]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(5)</title>
    <url>/2019/10/18/Linux/Linux_k8s-basic-5/</url>
    <content><![CDATA[<p>K8Sé›†ç¾¤çš„å­˜å‚¨å·ç¬”è®°ã€‚</p>
<p>æ•´ä½“çš„å­˜å‚¨å·è°ƒç”¨ç»“æ„ï¼š</p>
<p>åœ¨k8sçš„é›†ç¾¤ä¸­ï¼ŒPodå£°æ˜è‡ªå·±éœ€è¦å­˜å‚¨å·èµ„æºï¼ŒåŒæ—¶åˆ›å»ºè‡ªå·±çš„PVCï¼ŒPVCç»‘å®šåˆ°é›†ç¾¤ä¸­å·²ç»æ³¨å†Œçš„PVèµ„æºï¼Œä¾‹å¦‚ å·²ç»å»ºç«‹çš„NFSç½‘ç»œç©ºé—´ã€‚PVèµ„æºé€šè¿‡å­˜å‚¨ç³»ç»Ÿçš„åˆ†é…ï¼Œç›´æ¥æä¾›ç»™Podæ¥ä½¿ç”¨ã€‚</p>
<p>PVCå±äºåç§°ç©ºé—´çº§åˆ«ï¼ŒPVå±äºé›†ç¾¤èµ„æºã€‚</p>
<h1 id="å­˜å‚¨å·çš„ç±»å‹"><a href="#å­˜å‚¨å·çš„ç±»å‹" class="headerlink" title="å­˜å‚¨å·çš„ç±»å‹"></a>å­˜å‚¨å·çš„ç±»å‹</h1><ol>
<li><p><strong>EmptyDir</strong>ï¼šåªåœ¨Nodeä¸Šå­˜åœ¨çš„å­˜å‚¨å·ï¼ŒPodåˆ é™¤çš„æ—¶å€™å­˜å‚¨å·ä¹Ÿä¼šè¢«ç§»é™¤ï¼Œæ— æ³•æŒä¹…å­˜å‚¨ï¼Œå«åšEmptyDirï¼Œåš<strong>ä¸´æ—¶å­˜å‚¨å’Œç¼“å­˜ä½¿ç”¨</strong>ï¼Œå¯ä»¥ä½¿ç”¨<strong>Nodeçš„å†…å­˜</strong>ã€‚</p>
</li>
<li><p><strong>HostPath</strong>ï¼š Dockerçš„å­˜å‚¨å·ç±»å‹ï¼Œ<strong>NodeèŠ‚ç‚¹ä¸Šçš„ç›®å½•</strong>ã€‚</p>
</li>
<li><p>ç½‘ç»œå­˜å‚¨ï¼š SANï¼Œ NAS; åˆ†å¸ƒå¼å­˜å‚¨(Glusterfsï¼ŒCephfsï¼Œrbd); äº‘å­˜å‚¨(EBSï¼Œ Azure Diskï¼Œç‰¹å®šçš„æ‰˜ç®¡åœ¨äº‘ä¸Šçš„æœåŠ¡)</p>
<pre class="language-none"><code class="language-none">kubectl explain pod.spec.volumes</code></pre>

<p> å¯ä»¥æŸ¥çœ‹æ”¯æŒé‚£äº›å­˜å‚¨ã€‚</p>
</li>
</ol>
<h2 id="PVC"><a href="#PVC" class="headerlink" title="PVC"></a>PVC</h2><p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæ— æ³•æŒæ¡æ‰€æœ‰çš„å­˜å‚¨ç³»ç»Ÿçš„çŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œå› æ­¤ï¼Œåˆ›å»ºäº†PVCçš„é€»è¾‘å±‚ï¼Œåœ¨å®šä¹‰éœ€è¦ä½¿ç”¨å­˜å‚¨å·çš„Podä¸­åªéœ€å®šä¹‰éœ€è¦çš„ç©ºé—´ä»¥åŠå­˜å‚¨çš„ç±»å‹ï¼Œä¸éœ€è¦è¯¦ç»†çš„è€ƒè™‘åç«¯å­˜å‚¨çš„ä¿¡æ¯å’Œé…ç½®ã€‚</p>
<p>PVCè¢«å®šä¹‰åœ¨Podsçš„é…ç½®ä¸­ï¼Œä¸€ä¸ª PVCå¯ä»¥è¢«å¤šä¸ªPodåŒæ—¶è®¿é—®ã€‚</p>
<h2 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h2><p>å­˜å‚¨ç±»ï¼š Gold Storage Class, Sliver Storage Class, Bronze Stroage Class.ä¸‰ä¸ªä¸åŒçº§åˆ«çš„å­˜å‚¨ç±»ã€‚å­˜å‚¨ç±»ç›´æ¥æ¥å—PVCçš„å†…å®¹å¹¶å¯¹PVCå®šä¹‰çš„å®¹é‡ç­‰ä¿¡æ¯è¿›è¡Œåˆ†é…ã€‚</p>
<p>PVä¸å­˜å‚¨æœåŠ¡çš„æä¾›è€…ç›´æ¥ç»‘å®šä¸”éœ€è¦åœ¨å­˜å‚¨æœåŠ¡æä¾›æ–¹é…ç½®å®Œæˆã€‚PVä¸PVCå…·æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚</p>
<h1 id="PersistentVolume"><a href="#PersistentVolume" class="headerlink" title="PersistentVolume"></a>PersistentVolume</h1><p>gitRepoä»“åº“çš„ä½¿ç”¨ï¼š</p>
<p>gitRepoå­˜å‚¨å·å»ºç«‹åœ¨EmptyDirçš„åŸºç¡€ä¸Šï¼Œåœ¨Podå†…å»ºç«‹ç©ºç›®å½•ï¼ŒåŒæ­¥Gitçš„å†…å®¹åˆ°ç©ºç›®å½•ï¼ŒPodè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¸ä¼šæ›´æ”¹å­˜å‚¨å·ä¸Šçš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒgitåŒæ­¥æ˜¯podå»ºç«‹çš„æ—¶å€™åŒæ­¥çš„æ•°æ®ï¼Œä¸ä¼šå¯¹gité¡¹ç›®çš„æ•°æ®è¿›è¡Œæ›´æ”¹ã€‚Podæ›´æ”¹äº†å­˜å‚¨å·ä¸­çš„æ•°æ®ä¸ä¼šè‡ªåŠ¨æ¨é€åˆ°Gitä¸Šï¼ˆå¯ä»¥ä½¿ç”¨Sidecarè¿›è¡Œæ¨é€å’Œé…ç½®ï¼‰ã€‚</p>
<h2 id="PVèµ„æºçš„å®šä¹‰"><a href="#PVèµ„æºçš„å®šä¹‰" class="headerlink" title="PVèµ„æºçš„å®šä¹‰"></a>PVèµ„æºçš„å®šä¹‰</h2><pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv001
  labels:
    name: pv001
spec:
  nfs:
    path: &#x2F;data&#x2F;volumes&#x2F;v1
    server: storage1.liarlee.com
  accessModes: [&quot;ReadWriteMany&quot;,&quot;ReadWriteOnce&quot;]
  capacity:
    storage: 20Gi</code></pre>

<p>ä½¿ç”¨applyå‘½ä»¤è¿›è¡Œåº”ç”¨å³å¯ã€‚</p>
<p>æŸ¥çœ‹æ‰€æœ‰çš„PVä½¿ç”¨ï¼š <code>kubectl get pv </code>ï¼Œ å…¶ä¸­æ˜¾ç¤ºäº†PVçš„åç§°ï¼Œå¤§å°ï¼Œè®¿é—®æ¨¡å¼ï¼Œå›æ”¶ç­–ç•¥ï¼ŒçŠ¶æ€ï¼Œå»ºç«‹æ—¶é—´ç­‰ã€‚</p>
<h1 id="PersistentVolumeClaim"><a href="#PersistentVolumeClaim" class="headerlink" title="PersistentVolumeClaim"></a>PersistentVolumeClaim</h1><p>ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨Podä¸­å®šä¹‰PVCï¼›PVCå’ŒPVæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½†æ˜¯PVCå¯ä»¥è¢«å¤šä¸ªPodè°ƒç”¨å’ŒæŒ‚è½½ã€‚ä¸€ä¸ªPVä¼šBindingä¸€ä¸ªPVCï¼ŒPVCåœ¨Podä¸­è¢«å®šä¹‰ã€‚</p>
<p>PVCä»¥åŠPVçš„çŠ¶æ€ï¼Œæœªç»‘å®šçš„çŠ¶æ€å«åšPendingï¼Œç»‘å®šåå«åšBoundã€‚</p>
<h2 id="PVCçš„å®šä¹‰"><a href="#PVCçš„å®šä¹‰" class="headerlink" title="PVCçš„å®šä¹‰"></a>PVCçš„å®šä¹‰</h2><pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc001
  namespace: default
spec:
  accessModes: [&quot;ReadWriteMany&quot;]
  resource:
    request:
      storage: 6Gi
  </code></pre>

<h1 id="ConfigMapèµ„æº"><a href="#ConfigMapèµ„æº" class="headerlink" title="ConfigMapèµ„æº"></a>ConfigMapèµ„æº</h1><p>configmapæ˜¯æ˜æ–‡èµ„æºï¼Œsecretæ˜¯base64çš„ç¼–ç èµ„æºï¼Œå› æ­¤å®‰å…¨ç¨‹åº¦æé«˜äº†ã€‚configmapç›¸å½“äºå¤–æŒ‚çš„é…ç½®æ–‡ä»¶ï¼Œå½“Podså¯åŠ¨çš„æ—¶å€™ç›´æ¥æŒ‚è½½Configmapè¯»å–è‡ªå·±éœ€è¦çš„é…ç½®å†…å®¹ã€‚</p>
<h2 id="é…ç½®åº”ç”¨å®¹å™¨åŒ–çš„æ–¹å¼"><a href="#é…ç½®åº”ç”¨å®¹å™¨åŒ–çš„æ–¹å¼" class="headerlink" title="é…ç½®åº”ç”¨å®¹å™¨åŒ–çš„æ–¹å¼"></a>é…ç½®åº”ç”¨å®¹å™¨åŒ–çš„æ–¹å¼</h2><ol>
<li>è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°</li>
<li>é…ç½®æ–‡ä»¶ç›´æ¥æ”¾å…¥é•œåƒä¸­</li>
<li>é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®</li>
<li>å­˜å‚¨å·<ol>
<li>Cloud Nativeåº”ç”¨é€šè¿‡ç¯å¢ƒå˜é‡ç›´æ¥é…ç½®</li>
<li>é€šè¿‡EntryPointè„šæœ¬é¢„å¤„ç†ç¯å¢ƒå˜é‡ä½œä¸ºé…ç½®é—®æ–‡ä»¶ä¸­çš„ä¿¡æ¯</li>
</ol>
</li>
<li>docker configå‘½ä»¤è¡Œæ–¹å¼</li>
</ol>
<h2 id="Configmapçš„åˆ›å»º"><a href="#Configmapçš„åˆ›å»º" class="headerlink" title="Configmapçš„åˆ›å»º"></a>Configmapçš„åˆ›å»º</h2><p>configmapä¸ºäº†å°†é…ç½®æ–‡ä»¶ä¸­é•œåƒä¸­è§£è€¦ï¼Œconfigmapå¯ä»¥ç›´æ¥æ³¨å…¥åˆ°å®¹å™¨ä¸­ç›´æ¥ä½¿ç”¨ï¼Œæ³¨å…¥çš„æ–¹å¼å¯ä»¥ä½¿ç”¨å­˜å‚¨å·ï¼Œæˆ–è€…ä½¿ç”¨EntryPointæ¥å¤„ç†ã€‚</p>
<p>é€šè¿‡å‘½ä»¤ç›´æ¥ä¼ é€’é”®å€¼ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubectl create configmap cm-nginx --from-literal<span class="token operator">=</span>nginx_server_name<span class="token operator">=</span>nginx.liarlee.com --from-literal<span class="token operator">=</span>nginx_server_port<span class="token operator">=</span><span class="token number">80</span>
kubectl create configmap cm-nginx --from-file<span class="token operator">=</span>./nginx.conf <span class="token comment"># ç›´æ¥ä¼ é€’æ–‡ä»¶åˆ°ConfigMap</span>
kubectl get cm cm-nginx <span class="token parameter variable">-o</span> yaml <span class="token comment"># ç”¨YAMLçš„æ ¼å¼æŸ¥çœ‹ConfigMap</span></code></pre>

<p>é€šè¿‡YAMLæ–‡ä»¶ï¼š</p>
<pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: ConfigMap
data: 
  nginx.conf................................
metadata:
  name: cm-nginx
  namespace: default</code></pre>

<p>åˆ›å»ºPodæ—¶ConfigMapä½¿ç”¨<strong>ç¯å¢ƒå˜é‡</strong>æ–¹å¼ï¼š</p>
<pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: Pod
metadata:
  name: pod-nginx
  namespace: default
  labels:
    app: pods-nginx
    tier: frontend
  annotations:
    liarlee.com&#x2F;created-by: &quot;cluster admin&quot;
spec:
  containers:
  - name: pod-nginx
    image: nginx:latest
    ports:
    - name: http
      containerPort: 80
    env:
    - name: NGINX_SERVER_PORT
      valueFrom:
      	configMapKeyRef:
      		name: cm-nginx
      		key: nginx_port
    env:
    - name: NGINX_SERVER_NAME
    	valueFrom:
    		configMapKeyRef:
    			name: cm-nginx
    			key: nginx_server_name</code></pre>

<p>åˆ›å»ºPodçš„æ—¶å€™ä½¿ç”¨<strong>æŒ‚è½½å·</strong>çš„æ–¹å¼ï¼š</p>
<p>é€šè¿‡æŒ‚è½½çš„æ–¹å¼å¯ä»¥é€šè¿‡ä¿®æ”¹configmapçš„æ–¹å¼ï¼ŒåŒæ­¥ä¿®æ”¹å®¹å™¨å†…éƒ¨çš„é…ç½®ã€‚</p>
<pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: Pod
metadata:
  name: pod-nginx
  namespace: default
  labels:
    app: pods-nginx
    tier: frontend
  annotations:
    liarlee.com&#x2F;created-by: &quot;cluster admin&quot;
spec:
  containers:
 	- name: pod-nginx
   	  image: nginx:latest
      ports:
      - name: http
      	containerPort: 80
 	  volumeMounts:
 	  - name: nginxconf
 	  	mountPath: &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;
 	  	readOnly: true
 	Volumes:
 	- name: nginxconf
 	  configMap: 
 	  	name: cm-nginx </code></pre>

<h2 id="åˆ›å»ºSecretçš„ç±»å‹"><a href="#åˆ›å»ºSecretçš„ç±»å‹" class="headerlink" title="åˆ›å»ºSecretçš„ç±»å‹"></a>åˆ›å»ºSecretçš„ç±»å‹</h2><p>kubectl create secret â€“help</p>
<ul>
<li>docker-registry â€“ è¿æ¥åˆ°Dockerç§æœ‰ä»“åº“çš„å¯†é’¥</li>
<li>generic â€“ é€šç”¨çš„æœåŠ¡å¯†é’¥</li>
<li>tls â€“ åˆ›å»ºè¯ä¹¦</li>
</ul>
<h1 id="StatefulSetçš„å»ºç«‹å’Œä½¿ç”¨"><a href="#StatefulSetçš„å»ºç«‹å’Œä½¿ç”¨" class="headerlink" title="StatefulSetçš„å»ºç«‹å’Œä½¿ç”¨"></a>StatefulSetçš„å»ºç«‹å’Œä½¿ç”¨</h1><p>åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°äº†æœ‰çŠ¶æ€çš„ç®¡ç†ï¼Œä½†æ˜¯ä¾æ—§éœ€è¦å†™æˆç®¡ç†è„šæœ¬ï¼Œæ³¨å…¥åˆ°Podä¸­ã€‚</p>
<p>CoreOS â€“ æä¾›äº† Operatorç›¸å…³çš„åŠŸèƒ½ç”¨æ¥å®Œå–„æœ‰çŠ¶æ€çš„åº”ç”¨çš„éƒ¨ç½²ã€‚</p>
<p>ä¸¤ç±»ä¸åŒçš„Pod</p>
<ol>
<li><p>Cattle</p>
</li>
<li><p>Pet</p>
</li>
</ol>
<p>æœ€æ—©å«åšPetSetï¼Œ åé¢æ”¹æˆStatefulSetã€‚</p>
<p>StatefulSetä¸€èˆ¬ç”¨äºç®¡ç†ä»¥ä¸‹ç‰¹æ€§çš„ç»„ä»¶ï¼š</p>
<ol>
<li><p>ç¨³å®šä¸”æœ‰å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦ï¼›å¿…é¡»ä¿æŒPodçš„åç§°å’Œåœ°å€ç¨³å®šæŒä¹…æœ‰æ•ˆï¼›</p>
</li>
<li><p>ç¨³å®šä¸”æŒä¹…çš„å­˜å‚¨ï¼›</p>
</li>
<li><p>æœ‰åºå¹³æ»‘(Graceful)çš„éƒ¨ç½²åŠæ‰©å±•ï¼›å¯åŠ¨çš„æ—¶å€™Pod1 - Pod8ï¼›</p>
</li>
<li><p>æœ‰åºå¹³æ»‘(Graceful)çš„ç»ˆæ­¢å’Œåˆ é™¤ï¼›å…³é—­çš„æ—¶å€™Pod8 - Pod1ï¼›</p>
</li>
<li><p>æœ‰åºçš„æ»šåŠ¨æ›´æ–°ï¼›æœ‰é¡ºåºçš„è¿›è¡ŒPodçš„æ›´æ–°ï¼›</p>
</li>
</ol>
<p>æœ‰ä¸‰ä¸ªä¸»è¦çš„éƒ¨åˆ†ï¼›</p>
<pre><code>  1. Headless Service
     - ç±»ä¼¼äºRedisï¼Œæä¾›ä¸€ä¸ªheadlessçš„æœåŠ¡ï¼Œæ¥ç¡®ä¿æ¯ä¸€ä¸ªè¯·æ±‚ç›´è¾¾åç«¯çš„podï¼Œå¯ä¿æŒpodçš„æ¥å…¥ç‚¹ç¨³å®šä¸”ä¸å‘ç”Ÿå˜åŒ–ã€‚
  2. StatefulSet Controller
     - éœ€è¦ä¸€ä¸ªæ§åˆ¶å™¨æ¥è¿›è¡ŒPodçš„ç®¡ç†å’Œæ§åˆ¶ï¼Œä¿æŒPodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿Podè¢«ç»ˆæ­¢ä¹Ÿéœ€è¦åœ¨å¯åŠ¨åä¿æŒå’Œä¹‹å‰ä¸€æ ·çš„Podä¿¡æ¯ã€‚
  3. Volume Claim Template
     - ç”±äºæœ‰çŠ¶æ€çš„æœåŠ¡ä¸èƒ½åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªPVï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®å„ä¸ç›¸åŒï¼Œæ‰€ä»¥ä¸èƒ½æä¾›ä¸€ä¸ªPVC&amp;PVã€‚å› æ­¤æä¾›äº†ç”³è¯·PVçš„æ¨¡æ¿ï¼Œæ¯ä¸ªPodæä¾›ä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨å·ç”¨æ¥åšç‹¬ç«‹å­˜å‚¨ã€‚
</code></pre>
<p>å¯¹äºStatefulSetæ¥è¯´ï¼Œç¡®ä¿æ‰€æœ‰çš„Podåç§°ç¨³å®šæœ‰æ•ˆä¸å¯å˜åŠ¨ã€‚å¤§å¤šæ•°æœ‰çŠ¶æ€çš„å‰¯æœ¬éƒ½ä¼šä½¿ç”¨æŒä¹…å­˜å‚¨ï¼Œå¤šä¸ªPodèƒ½ä¸èƒ½å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨ï¼Ÿ ä¸èƒ½ï¼Œæ¯ä¸ªPodå¿…é¡»ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ã€‚</p>
<p> æ‰€ä»¥ï¼Œéœ€è¦å®šä¹‰PVï¼Œå®šä¹‰PVCæ¨¡æ¿ï¼Œå®šä¹‰Podï¼Œå®šä¹‰Statefulæ§åˆ¶å™¨ï¼Œå®šä¹‰headlessæœåŠ¡è¿™å‡ ç§ã€‚</p>
<h2 id="å®šä¹‰StatefulSetçš„YAMLæ–‡ä»¶"><a href="#å®šä¹‰StatefulSetçš„YAMLæ–‡ä»¶" class="headerlink" title="å®šä¹‰StatefulSetçš„YAMLæ–‡ä»¶"></a>å®šä¹‰StatefulSetçš„YAMLæ–‡ä»¶</h2><pre class="language-YAML" data-language="YAML"><code class="language-YAML">---
apiVersion: v1
kind: Service 
metadata:
  name: sts-headless-svc
  labels:
    Service: sts-headless-svc
spec:
  ports:
  - port: 80
    name: sts-headless-svc
  clusterIP: None
  selector: 
    service: sts-headless-svc

---
apiVersion: app&#x2F;v1
kind: StatufulSet
metadata:
  name: sts
spec:
  serviceName: sts
  replicas: 3
  selector:
    matchlabels:
      service: sts-headless-svc
  template:
    metadata:
      labels:
        service: sts-headless-svc
   	spec: 
   		containers: 
   		- name: sts-container
   		  image: ikubernetes&#x2F;SOMEIMAGE&#39;SNAME
   		  ports:
   		  - containerPort: 80
   		    name: sts-headless-svc
   		  volumeMounts:
   		  - name: sts-pv
   		    mountPath: &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html
  volumeClainTempates:
  - metadata:
    name: sts-vct
  spec:
    accessModes: [ &quot;ReadWriteOnce&quot; ]
    resources:
      requests:
        storage: 5Gi
        
</code></pre>

<p>Podçš„dnså‘½åè§„åˆ™ï¼š</p>
<p>Pod_Name+Service_Name+NameSpace_Name.svc.cluster.local</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(6)</title>
    <url>/2019/11/06/Linux/Linux_k8s-basic-6/</url>
    <content><![CDATA[<p>K8Sçš„è®¤è¯éƒ¨åˆ†ï¼Œ ServiceAccountä»¥åŠRBAC ã€‚</p>
<h1 id="æˆæƒæ’ä»¶"><a href="#æˆæƒæ’ä»¶" class="headerlink" title="æˆæƒæ’ä»¶"></a>æˆæƒæ’ä»¶</h1><ol>
<li>Node</li>
<li>ABAC</li>
<li>RBAC</li>
<li>Webhook</li>
</ol>
<p>å¸¸ç”¨çš„æˆæƒæ’ä»¶å°±æ˜¯RBAC</p>
<h1 id="åŸºäºè§’è‰²çš„æˆæƒå’Œè®¿é—®æ§åˆ¶"><a href="#åŸºäºè§’è‰²çš„æˆæƒå’Œè®¿é—®æ§åˆ¶" class="headerlink" title="åŸºäºè§’è‰²çš„æˆæƒå’Œè®¿é—®æ§åˆ¶"></a>åŸºäºè§’è‰²çš„æˆæƒå’Œè®¿é—®æ§åˆ¶</h1><p>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œå°±æ˜¯å°†æƒé™æˆäºˆRoleï¼Œè€Œä¸æ˜¯Userã€‚ å°†æƒé™çš„æ§åˆ¶æˆäºˆRoleï¼Œ å°†Useråˆ†é…åˆ°Roleã€‚é»˜è®¤çš„æ˜¯æ‹’ç»å…¨éƒ¨ï¼Œ æ— æ³•ä¹Ÿæ— éœ€å®šä¹‰æ‹’ç»æƒé™ï¼Œå®šä¹‰çš„Permissionæ˜¯è®¸å¯è®¿é—®çš„æƒé™ã€‚</p>
<ol>
<li>è§’è‰²ï¼ŒUser Accouts OR Service Accounts.</li>
<li>è®¸å¯ï¼Œ Permissionåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šOperation ä»¥åŠ Object.</li>
</ol>
<h2 id="è§’è‰²ä»¥åŠè§’è‰²ç»‘å®š"><a href="#è§’è‰²ä»¥åŠè§’è‰²ç»‘å®š" class="headerlink" title="è§’è‰²ä»¥åŠè§’è‰²ç»‘å®š"></a>è§’è‰²ä»¥åŠè§’è‰²ç»‘å®š</h2><p>Role â€“ RoleBinding</p>
<p>Role å’Œ RoleBinding æ˜¯å»ºç«‹å’Œæ§åˆ¶ NameSpace çº§åˆ«çš„æƒé™ã€‚</p>
<h2 id="é›†ç¾¤è§’è‰²ä»¥åŠé›†ç¾¤è§’è‰²ç»‘å®š"><a href="#é›†ç¾¤è§’è‰²ä»¥åŠé›†ç¾¤è§’è‰²ç»‘å®š" class="headerlink" title="é›†ç¾¤è§’è‰²ä»¥åŠé›†ç¾¤è§’è‰²ç»‘å®š"></a>é›†ç¾¤è§’è‰²ä»¥åŠé›†ç¾¤è§’è‰²ç»‘å®š</h2><p>ClusterRole â€“ ClusterRoleBinding</p>
<p>Cluster å’Œ ClusterBinding æ˜¯å»ºç«‹å’Œæ§åˆ¶ Cluster çº§åˆ«çš„æƒé™ã€‚</p>
<p>NOTEï¼š ç‰¹æ®Šçš„æƒ…å†µï¼Œå¯ä»¥å¯¹åç§°ç©ºé—´çº§åˆ«çš„</p>
<h2 id="ç‰¹æ®Šçš„ç»‘å®šæ–¹å¼"><a href="#ç‰¹æ®Šçš„ç»‘å®šæ–¹å¼" class="headerlink" title="ç‰¹æ®Šçš„ç»‘å®šæ–¹å¼"></a>ç‰¹æ®Šçš„ç»‘å®šæ–¹å¼</h2><p>ClusterRole â€“ RoleBinding</p>
<p>å¯ä»¥ä½¿ç”¨ RoleBinding ç»‘å®š ClusterRoleï¼Œ é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼ŒRoleåªæ˜¯å…·æœ‰NameSpaceçš„æƒé™ã€‚<strong>è§£é‡Šä¸€ä¸‹ï¼š</strong>é›·åœ¨åŒä¸€ä¸ªClusterä¸­æœ‰å¤šä¸ªä¸åŒçš„NameSpaceï¼Œæˆ‘éœ€è¦å¯¹æ¯ä¸ªNameSpaceéƒ½æˆæƒç›¸åŒçš„æƒé™ï¼Œè¿™ç§åœºæ™¯ä¸‹:</p>
<ul>
<li><p>å¦‚æœä½¿ç”¨RoleBinding å»ç»‘å®šä¸€ä¸ªRoleï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªNameSpaceéƒ½éœ€è¦å»ºç«‹å„è‡ªçš„ RoleBindingï¼Œå¹¶ä¸”éƒ½è¦å„è‡ªç»‘å®šåˆ°Roleã€‚</p>
</li>
<li><p>å¦‚æœå»ºç«‹ä¸€ä¸ªClusterRole, ä½¿ç”¨RoleBindingç»‘å®šåˆ°ClusterRoleä¸Šé¢ï¼Œé‚£ä¹ˆæˆ‘åªéœ€è¦å®šä¹‰ä¸€ä¸ªå³å¯åœ¨å…¨éƒ¨é›†ç¾¤èŒƒå›´å†…ç”Ÿæ•ˆè¿™ä¸ªæƒé™ã€‚è¿™æ ·çš„å°±ç›¸å½“äºæ‰¹é‡çš„è¿›è¡ŒRoleçš„æˆæƒã€‚</p>
</li>
</ul>
<h1 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h1><p>å‘½ä»¤ä¸åšè¿‡å¤šçš„è§£é‡Šï¼Œæ‰€æœ‰çš„èµ„æºå¯ä»¥é€šè¿‡explainè·å–ï¼Œä¸»è¦æ˜¯è®°å½•é€»è¾‘å’Œæ€è·¯ã€‚</p>
<pre class="language-Shell" data-language="Shell"><code class="language-Shell">~]$ kubectl create role testrole --verb&#x3D;get,list,watch --resources&#x3D;pods -o yaml
~]$ kubectl get role
~]$ kubectl describe role pods-reader
~]$ kubectl create rolebinding test-rolebinding --role&#x3D;testrole --user&#x3D;testuser -o yaml
~]$ kubectl explain rolebinding
~]$ kubectl config use-context USERNAME@kubernetes
~]$ kubectl create clusterrole test-clusterrole --verb&#x3D;get,list,watch --resource&#x3D;pods -o yaml 
~]$ kubectl explain clusterrole
~]$ kubectl get clusterrole
~]$ </code></pre>

<h1 id="å…¶ä»–è¡¥å……"><a href="#å…¶ä»–è¡¥å……" class="headerlink" title="å…¶ä»–è¡¥å……"></a>å…¶ä»–è¡¥å……</h1><p>åœ¨RBACä¸­å¯ä»¥å­˜åœ¨ä¸‰ç±»ç»„ä»¶ï¼š</p>
<ol>
<li>user</li>
<li>group</li>
<li>service account</li>
</ol>
<p>åˆ›å»ºPodçš„è¿‡ç¨‹ä¸­å¯ä»¥æŒ‡å®šä¸€ä¸ªå€¼å«åšServiceAccountNameï¼Œå¦‚æœæˆæƒServiceAccounté«˜ç­‰çº§çš„æƒé™ï¼Œé‚£ä¹ˆï¼ŒPodä¼šä»¥è¿™ä¸ªAccountè¿è¡Œï¼Œé‚£ä¹ˆPodä¸­çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šæœ‰ServiceAccountçš„æƒé™ã€‚ä¹Ÿå°±æ˜¯æé«˜äº†Podåº”ç”¨ç¨‹åºçš„ç­‰çº§ï¼Œä½¿å¾—Podå¯ä»¥å¯¹K8Sçš„ç›¸å…³èµ„æºè¿›è¡Œç®¡ç†å’Œé…ç½®ã€‚</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesé›†ç¾¤çš„å­¦ä¹ ç¬”è®°(7)</title>
    <url>/2019/11/06/Linux/Linux_k8s-basic-7/</url>
    <content><![CDATA[<p>Kubernetesçš„Dashboard å’Œ åˆ†çº§è®¤è¯æƒé™ã€‚</p>
<h1 id="Dashboardçš„ç®€ä»‹"><a href="#Dashboardçš„ç®€ä»‹" class="headerlink" title="Dashboardçš„ç®€ä»‹"></a>Dashboardçš„ç®€ä»‹</h1><p>Dashboardç®—æ˜¯k8sçš„ä¸€ä¸ªç®¡ç†çš„webç•Œé¢ã€‚ä¸åšå…·ä½“çš„æ“ä½œï¼Œç™»å½•çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯K8Sæä¾›çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<h2 id="Dashboardçš„éƒ¨ç½²"><a href="#Dashboardçš„éƒ¨ç½²" class="headerlink" title="Dashboardçš„éƒ¨ç½²"></a>Dashboardçš„éƒ¨ç½²</h2><p>åªéœ€è¦ä»githubè¿›è¡Œapplyèµ„æºæ¸…å•å³å¯ã€‚</p>
<h2 id="Dashboardçš„ç™»å½•"><a href="#Dashboardçš„ç™»å½•" class="headerlink" title="Dashboardçš„ç™»å½•"></a>Dashboardçš„ç™»å½•</h2><h3 id="ä½¿ç”¨Tokenç™»å½•"><a href="#ä½¿ç”¨Tokenç™»å½•" class="headerlink" title="ä½¿ç”¨Tokenç™»å½•"></a>ä½¿ç”¨Tokenç™»å½•</h3><ol>
<li><p>è·å–ç³»ç»Ÿä¸­é»˜è®¤çš„adminçš„tokenï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªéœ€è¦ç™»å½•å’Œç®¡ç†çš„ServiceAccountï¼Œç„¶åBindingåˆ°Roleæˆ–è€… ClusterRole,è¿›è¡Œæƒé™çš„æ§åˆ¶</p>
</li>
<li><p>æŸ¥çœ‹é›†ç¾¤ä¸­è‡ªåŠ¨åˆ›å»ºçš„dashboardçš„secretï¼Œ ç³»ç»Ÿéƒ¨ç½²å®Œæˆä¹‹åè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªå¯ç®¡ç†å…¨éƒ¨é›†ç¾¤çš„secret</p>
</li>
</ol>
   <pre class="language-Shell" data-language="Shell"><code class="language-Shell">~]$ kubectl get secret -n kube-system | grep dashboard
dashboard-admin-token-g85h7                      kubernetes.io&#x2F;service-account-token   3      109d</code></pre>

<ol start="3">
<li><p>åœ¨è¿™ä¸ªsecretä¸­æœ‰Tokenç›¸å…³çš„ä¿¡æ¯</p>
<pre class="language-none"><code class="language-none">~]$ kubectl describe secret dashboard-admin-token-g85h7 -n kube-system</code></pre>
</li>
<li><p>å…¶ä¸­çš„<strong>Tokenå­—æ®µ</strong>çš„å†…å®¹å°±æ˜¯å¯ä»¥ç”¨æ¥ç™»å½•çš„ä»¤ç‰Œã€‚å¤åˆ¶åˆ°dashboardä¸­ç²˜è´´å³å¯</p>
</li>
</ol>
<h3 id="ä½¿ç”¨configæ–‡ä»¶ç™»å½•"><a href="#ä½¿ç”¨configæ–‡ä»¶ç™»å½•" class="headerlink" title="ä½¿ç”¨configæ–‡ä»¶ç™»å½•"></a>ä½¿ç”¨configæ–‡ä»¶ç™»å½•</h3><ol>
<li>åˆ›å»ºServiceAccountï¼ŒBindingåˆ°role</li>
<li>è·å–Secretï¼Œç„¶åæŸ¥çœ‹ä»–çš„token</li>
<li>åˆ¶ä½œconfigæ–‡ä»¶</li>
<li>ä½¿ç”¨configæ–‡ä»¶ç™»å½•</li>
</ol>
<h2 id="Kubernetesçš„ç®¡ç†æ–¹å¼"><a href="#Kubernetesçš„ç®¡ç†æ–¹å¼" class="headerlink" title="Kubernetesçš„ç®¡ç†æ–¹å¼"></a>Kubernetesçš„ç®¡ç†æ–¹å¼</h2><ol>
<li><p>å‘½ä»¤</p>
<p>create , run ,expose , delete ,edit â€¦.</p>
</li>
<li><p>å‘½ä»¤å¼é…ç½®æ–‡ä»¶</p>
<p>create -f , delete -f , replace -f </p>
</li>
<li><p>å£°æ˜å¼é…ç½®æ–‡ä»¶</p>
<p>apply -f , patch</p>
</li>
</ol>
<p>ä¸€èˆ¬ä¸æ··åˆä½¿ç”¨ï¼Œ1.2 ä½¿ç”¨çš„æ˜¯æ›¿æ¢ï¼Œä½†æ˜¯3æ˜¯ç«‹åˆ»ä¿®æ”¹ï¼Œç«‹åˆ»ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒå±é™©çš„ã€‚</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>K8Så°†loop-lvmæ”¹ä¸ºdirect-lvmè¯´æ˜</title>
    <url>/2019/09/24/Linux/Linux_k8s-changelooplvm-directlvm/</url>
    <content><![CDATA[<p>å¯¹k8sé›†ç¾¤è¿›è¡Œå­˜å‚¨é©±åŠ¨çš„è°ƒæ•´ï¼Œä»loop-lvm åˆ‡æ¢åˆ°direct-lvmã€‚</p>
<h2 id="k8sçš„å‡ ç§ä¸åŒçš„å­˜å‚¨é©±åŠ¨"><a href="#k8sçš„å‡ ç§ä¸åŒçš„å­˜å‚¨é©±åŠ¨" class="headerlink" title="k8sçš„å‡ ç§ä¸åŒçš„å­˜å‚¨é©±åŠ¨"></a>k8sçš„å‡ ç§ä¸åŒçš„å­˜å‚¨é©±åŠ¨</h2><ol>
<li>AUFS - è¿™æ˜¯ä¸€ä¸ªç»è¿‡æ—¶é—´æ£€éªŒçš„å­˜å‚¨é©±åŠ¨</li>
<li>DeviceMapper - Redhatç³»é»˜è®¤çš„é©±åŠ¨ï¼Œæœ‰loopå’Œdirectä¸¤ç§ä¸åŒé…ç½®</li>
<li>Btrfs - æˆ‘â€¦. è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¿«ç…§çœŸçš„æ˜¯è´¼å¥½ç”¨ï¼Œä½†æ˜¯æ€§èƒ½ä»€ä¹ˆçš„â€¦.æˆ‘å€’è§‰å¾—éƒ½ä¸€èˆ¬</li>
<li>ZFS - è¿˜æ²¡ç”¨è¿‡</li>
<li>VFS - è¿˜æ²¡ç”¨è¿‡</li>
<li>Overlay2 - ç®€å•çš„æ¥è§¦äº†ä¸€ä¸‹ï¼Œdockerç›®å‰æ¨èçš„å­˜å‚¨é©±åŠ¨</li>
</ol>
<h2 id="å…³äºå­˜å‚¨é©±åŠ¨é€‰æ‹©çš„ç›¸å…³åšå®¢åŠæ–‡ç« "><a href="#å…³äºå­˜å‚¨é©±åŠ¨é€‰æ‹©çš„ç›¸å…³åšå®¢åŠæ–‡ç« " class="headerlink" title="å…³äºå­˜å‚¨é©±åŠ¨é€‰æ‹©çš„ç›¸å…³åšå®¢åŠæ–‡ç« "></a>å…³äºå­˜å‚¨é©±åŠ¨é€‰æ‹©çš„ç›¸å…³åšå®¢åŠæ–‡ç« </h2><blockquote>
<p><a href="https://www.jianshu.com/p/6bf1bc011ade">Dockerå¼•æ“ - é€‰æ‹©å­˜å‚¨é©±åŠ¨</a><br><a href="http://dockone.io/article/1513">Dockeräº”ç§å­˜å‚¨é©±åŠ¨åŸç†åŠåº”ç”¨åœºæ™¯å’Œæ€§èƒ½æµ‹è¯•å¯¹æ¯”</a><br><a href="https://www.cnblogs.com/Terry-Wu/p/7471476.html">Dockerç³»ç»Ÿå…«ï¼šDockerçš„å­˜å‚¨é©±åŠ¨</a> </p>
</blockquote>
<h2 id="Loop-lvm"><a href="#Loop-lvm" class="headerlink" title="Loop-lvm"></a>Loop-lvm</h2><p>è¿™æ˜¯dockeré»˜è®¤å®‰è£…ä¹‹åçš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥out-of-boxï¼Œä½†æ˜¯æ®è¯´ç¨³å®šæ€§ä¸ä½³ï¼Œæˆ‘æ²¡é‡åˆ°ç¨³å®šæ€§çš„é—®é¢˜ï¼Œä½†æ˜¯é‡åˆ°äº†IOé«˜å¯¼è‡´çš„æ•´ä¸ªè™šæ‹Ÿæœºè¿è¡Œç¼“æ…¢ã€‚<br>Loop-LVMå…¶å®ä½¿ç”¨äº†linuxä¸­çš„ä½¿ç”¨loopè®¾å¤‡<br>æˆ‘ä¹‹å‰å®‰è£…çš„ä¸€å¥—k8sé»˜è®¤æ˜¯ä½¿ç”¨overlay2çš„å­˜å‚¨ï¼Œå¯èƒ½æ˜¯å†…æ ¸çš„ç‰ˆæœ¬è¿‡ä½å¯¼è‡´æ— æ³•ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨é©±åŠ¨ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—é»˜è®¤ä½¿ç”¨äº†loop-lvmã€‚</p>
<blockquote>
<p>loop-lvmçš„å·¥ä½œæ¨¡å¼æ˜¯ï¼Œé»˜è®¤åœ¨&#x2F;var&#x2F;lib&#x2F;docker&#x2F;devicemapper&#x2F;devicemapper&#x2F;ç›®å½•ä¸‹ç”Ÿæˆdata&amp;metadataä¸¤ä¸ª<strong>ç¨€ç–æ–‡ä»¶</strong>ï¼ˆæˆ‘ç›®å‰è¿˜ä¸çŸ¥é“ä»€ä¹ˆå«åšç¨€ç–æ–‡ä»¶ï¼‰ï¼Œå¹¶å°†ä¸¤ä¸ªæ–‡ä»¶æŒ‚è½½ä¸ºloopè®¾å¤‡åšä¸ºå—è®¾å¤‡æ¥ä½¿ç”¨ã€‚<br>æŒ‰ç…§è¿™ä¸ªè¯´æ³•çš„è¯ç¡®å®å¦‚æœç›´æ¥å¯¹è£¸è®¾å¤‡çš„æƒ³èƒ½å’Œç¨³å®šæ€§éƒ½åº”è¯¥æ›´å¼ºã€‚æ‰€ä»¥ä¸‹é¢å¯ä»¥åŠ¨æ‰‹å•¦~</p>
</blockquote>
<h2 id="Direct-lvm"><a href="#Direct-lvm" class="headerlink" title="Direct-lvm"></a>Direct-lvm</h2><p>è¿™é‡Œç›´æ¥æ”¾ä¸€ä¸ªå®˜æ–¹æ–‡æ¡£çš„é“¾æ¥å¥½äº†ã€‚<br><a href="https://docs.docker.com/storage/storagedriver/device-mapper-driver/">Device-Mapper-driver</a></p>
<h3 id="åˆ‡æ¢loop-lvmåˆ°direct-lvm"><a href="#åˆ‡æ¢loop-lvmåˆ°direct-lvm" class="headerlink" title="åˆ‡æ¢loop-lvmåˆ°direct-lvm"></a>åˆ‡æ¢loop-lvmåˆ°direct-lvm</h3><p>æƒ³è¦åˆ‡æ¢çš„åŸå› å…¶å®æ˜¯å·²ç»å®‰è£…å¥½çš„è¿™ä¸ªk8sçš„masterèŠ‚ç‚¹åœ¨è·‘äº†å¾ˆä¹…ä¹‹åï¼Œæ€»æ˜¯è¢«zabbixç›‘æ§åˆ°æŠ¥è­¦ï¼Œç¡¬ç›˜è´Ÿè½½é«˜ï¼›cpuè¿›ç¨‹æ•°é«˜ã€‚cpuçš„è¿›ç¨‹æ•°é‡é«˜å¯ä»¥ç†è§£ï¼Œæ¯•ç«Ÿç›‘æ§äº†å¦‚æ­¤å¤šçš„å®¹å™¨ã€‚ç¡¬ç›˜è´Ÿè½½é«˜è¿™ä¸ªæŠ¥è­¦åœ¨ç³»ç»Ÿä¸­å‘ç°æ˜¯&#x2F;dev&#x2F;loop2è¿™ä¸ªè®¾å¤‡ã€‚å¯¹åº”å»æŸ¥æ‰¾ docker infoä¸­çš„ä¿¡æ¯ï¼Œå‘ç°è¿™æ˜¯k8sçš„å­˜å‚¨æ‰€ä½¿ç”¨çš„ã€‚è¿›è€Œæœç´¢åˆ°äº†å…³äºloop-lvm&amp;direct-lvmçš„ç›¸å…³é—®é¢˜ï¼Œå‘ç°ä½¿ç”¨loopè®¾å¤‡çš„æ–¹å¼åº”è¯¥å®åœ¨æ€§èƒ½ä¸Šæœ‰å½±å“çš„ï¼Œk8sä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œæ‰€ä»¥è€ƒè™‘åˆ‡æ¢è¿‡æ¥ï¼Œä»Šåæ¯•ç«Ÿè¿˜æ˜¯è¦é•¿æœŸä½¿ç”¨çš„ã€‚<strong>å€¼å¾—æ³¨æ„çš„æ˜¯</strong>ï¼šåˆ‡æ¢ä¸€å®šä¼šå¯¼è‡´ä¹‹å‰çš„å®¹å™¨æ— æ³•ä½¿ç”¨ã€‚è€Œä¸”ç›®å‰æ¥çœ‹å…³é”®çš„æ•°æ®æ˜¯ä¸èƒ½æ¢å¤çš„ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯åœ¨ä¹‹å‰å·²ç»åšå¥½äº†è®¡åˆ’ã€‚</p>
<h4 id="è‡ªåŠ¨æ‰˜ç®¡é…ç½®"><a href="#è‡ªåŠ¨æ‰˜ç®¡é…ç½®" class="headerlink" title="è‡ªåŠ¨æ‰˜ç®¡é…ç½®"></a>è‡ªåŠ¨æ‰˜ç®¡é…ç½®</h4><p>è‡ªåŠ¨æ‰˜ç®¡çš„é…ç½®ä¸»è¦æ˜¯ä¸¤éƒ¨åˆ†ï¼Œé¦–å…ˆæ˜¯å»ºç«‹ä¸€ä¸ªç©ºçš„LVMï¼Œä¸éœ€è¦æŒ‚è½½ï¼Œåªè¦ç³»ç»Ÿè¯†åˆ«åˆ°å³å¯ã€‚ä¹‹åæ˜¯æ›´æ”¹é…ç½®æ–‡ä»¶åŠé‡å¯dockeræœåŠ¡ã€‚</p>
<ol>
<li>åœ¨è™šæ‹Ÿæœºä¸­åŠ å…¥ä¸€å—æ–°çš„ç¡¬ç›˜ï¼Œfdiskä¸­è¯†åˆ«ä¸º&#x2F;dev&#x2F;sdbï¼›</li>
<li>å…³é—­dockerã€‚systemctl stop docker.</li>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹çš„é…ç½®ï¼Œæ³¨æ„æ ¼å¼ä¸è¦é”™ï¼Œä¸è¦ä¸¢ä¸‹æœ«å°¾çš„é€—å·ï¼š<pre class="language-none"><code class="language-none">&#123;
  &quot;storage-driver&quot;: &quot;devicemapper&quot;,   # å‘Šè¯‰dockeråº”ç”¨ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨
  &quot;storage-opts&quot;: [
    &quot;dm.directlvm_device&#x3D;&#x2F;dev&#x2F;sdb&quot;,	# æŒ‡å®šä½¿ç”¨çš„å—è®¾å¤‡ï¼Œä¸éœ€è¦æ ¼å¼åŒ–ï¼Œä¸éœ€è¦åˆ†åŒºã€‚åœ¨è¿™é‡ŒæŒ‡å®šäº†è®¾å¤‡dockerä¼šè‡ªåŠ¨å®Œæˆåˆ›å»ºLVMç­‰ç­‰æ“ä½œã€‚
    &quot;dm.thinp_percent&#x3D;95&quot;,	# æŒ‡å®šThinpoolå ç”¨çš„ç™¾åˆ†æ¯”
    &quot;dm.thinp_metapercent&#x3D;1&quot;,	# æŒ‡å®šThinpool Metaæ•°æ®ä½¿ç”¨çš„ç™¾åˆ†æ¯”
    &quot;dm.thinp_autoextend_threshold&#x3D;80&quot;,	# æŒ‡å®šè‡ªåŠ¨æ‰©å®¹çš„é˜ˆå€¼
    &quot;dm.thinp_autoextend_percent&#x3D;20&quot;,	# æŒ‡å®šè‡ªåŠ¨æ‰©å®¹çš„æ¯”ä¾‹
    &quot;dm.directlvm_device_force&#x3D;false&quot;	# æ˜¯å¦å¼ºåˆ¶æ ¼å¼åŒ–è®¾å¤‡ï¼Œé»˜è®¤æ˜¯falseã€‚å¦‚æœä½¿ç”¨dockerdå¯åŠ¨çš„æ—¶å€™å‡ºç°äº†æä¾›éœ€è¦å¼ºè¡Œæ ¼å¼åŒ–è®¾å¤‡çš„æç¤ºï¼Œå°±æ”¹ä¸ºTrueã€‚
  ]
&#125;</code></pre></li>
<li>é‡æ–°å¯åŠ¨dockeræœåŠ¡ã€‚å¦‚æœæ­£å¸¸å¯åŠ¨å¯é€šè¿‡docker info æŸ¥çœ‹æ˜¯å¦å·²ç»åˆ‡æ¢è¿‡æ¥ã€‚</li>
<li>å¦‚æœæ²¡æœ‰èƒ½æˆåŠŸå¯åŠ¨ï¼Œå°è¯•é‡å¯è™šæ‹Ÿæœºï¼›å°è¯•ä½¿ç”¨dockerdå‘½ä»¤ç›´æ¥å¯åŠ¨ï¼Œæ ¹æ®dockerdçš„æ—¥å¿—ä¿¡æ¯è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚</li>
<li>å¸¸è§é”™è¯¯æœ‰ï¼š<pre class="language-none"><code class="language-none">Sep 23 18:38:03 k8s-master dockerd: time&#x3D;&quot;2019-09-23T18:38:03.931876136+08:00&quot; level&#x3D;warning msg&#x3D;&quot;[graphdriver] WARNING: the devicemapper storage-driver is deprecated, and will be removed in a future release&quot;
# å­˜å‚¨é©±åŠ¨å°†ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬è¢«ç§»é™¤çš„è­¦å‘Šã€‚è¿™ä¸ä¼šå¯¼è‡´dockeræ— æ³•è¿è¡Œã€‚
Sep 23 18:25:52 localhost dockerd: Error starting daemon: error initializing graphdriver: &#x2F;dev&#x2F;sdb is already part of a volume group &quot;docker&quot;: must remove this device from any volume group or provide a different device
# è¿™ä¸ªé—®é¢˜è¯´æ˜ docker è®¤ä¸ºä½ çš„&#x2F;dev&#x2F;sdbä¸Šå·²ç»è¢«åˆ›å»ºäº†LVMï¼Œä½ éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œè‡ªåŠ¨æ‰˜ç®¡ä¸ä¼šå¯¹è¿™ä¸ªè®¾å¤‡è¿›è¡Œæ“ä½œã€‚è¿™ä¼šå¯¼è‡´dockeræ— æ³•å¯åŠ¨ã€‚
# é¦–å…ˆä½ éœ€è¦æŠŠ&#x2F;dev&#x2F;sdbè¿™ä¸ªè®¾å¤‡ä»LVMé‡Œé¢ç§»é™¤ï¼Œlvdelete,pvdelete,vgdelete, å°†è®¾å¤‡è¿˜åŸä¸ºé»˜è®¤çš„çŠ¶æ€ï¼Œä¹‹åé‡å¯dockerï¼Œå°†è®¾å¤‡çš„æ‰€æœ‰æ“ä½œæ§åˆ¶éƒ½äº¤ç»™dockeræ¥åšï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé”™è¯¯äº†ã€‚</code></pre></li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨æ›´æ¢ä¹‹åç›®å‰æ€§èƒ½ç¨³å®šï¼ŒIOçš„è´Ÿè½½ä¹Ÿä¸‹æ¥äº†ã€‚æ€»ä½“æ¥çœ‹è¿˜æ˜¯ä¸é”™çš„ã€‚ä¸è¿‡éšç€kubernetesçš„å‘å±•ï¼Œæˆ‘è§‰å¾—è¿™ç§é—®é¢˜åº”è¯¥ä¼šè¶Šæ¥è¶Šå°‘ã€‚è¿˜æ˜¯æ¨èåœ¨å®‰è£…çš„æ—¶å€™ç›´æ¥è°ƒæ•´ï¼Œä¸ç„¶æ•°æ®çš„éšæ—¶ç¡®å®å¸¦æ¥äº†ä¸€äº›éº»çƒ¦ã€‚</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sæ‰€æœ‰çš„NSåˆ é™¤çš„æ—¶å€™éƒ½è¿›å…¥TerminatingçŠ¶æ€</title>
    <url>/2019/10/09/Linux/Linux_k8s-namespace-delete-terminating/</url>
    <content><![CDATA[<p>é›†ç¾¤æ— æ³•åˆ é™¤Namespaceè§£å†³æ–¹å¼ã€‚</p>
<h2 id="Namespace-æ— æ³•åˆ é™¤-å§‹ç»ˆå¤„äºTeminating"><a href="#Namespace-æ— æ³•åˆ é™¤-å§‹ç»ˆå¤„äºTeminating" class="headerlink" title="Namespace æ— æ³•åˆ é™¤ å§‹ç»ˆå¤„äºTeminating"></a>Namespace æ— æ³•åˆ é™¤ å§‹ç»ˆå¤„äºTeminating</h2><h3 id="å¼ºåˆ¶åˆ é™¤çš„æ–¹æ³•ï¼Œä¸´æ—¶æ–¹æ¡ˆã€‚"><a href="#å¼ºåˆ¶åˆ é™¤çš„æ–¹æ³•ï¼Œä¸´æ—¶æ–¹æ¡ˆã€‚" class="headerlink" title="å¼ºåˆ¶åˆ é™¤çš„æ–¹æ³•ï¼Œä¸´æ—¶æ–¹æ¡ˆã€‚"></a>å¼ºåˆ¶åˆ é™¤çš„æ–¹æ³•ï¼Œä¸´æ—¶æ–¹æ¡ˆã€‚</h3><ol>
<li><p>å°†åç§°ç©ºé—´çš„é…ç½®æ–‡ä»¶å¯¼å‡ºã€‚<br><code>kubectl get namespace testtest -o json &gt; tmp.json</code></p>
</li>
<li><p>ç¼–è¾‘è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚<br><code>vim tmp.json</code></p>
</li>
<li><p>åˆ é™¤specå­—æ®µä¸­çš„å€¼ã€‚</p>
<pre><code>&quot;spec&quot; : &#123;
        &quot;finalizers&quot; : [		# delete this line.
            &quot;kubernetes&quot;		# delete this line.
            ]		# delete this line.
        &#125;
``` 			
</code></pre>
</li>
<li><p>ä½¿ç”¨å¦ä¸€ä¸ªterminalï¼Œ è¿è¡Œæœ¬åœ°çš„proxyï¼Œ è¿æ¥åˆ°API serverã€‚<br> <code>kubectl proxy --port=8888</code></p>
</li>
<li><p>é€šè¿‡ApiServerè¿›è¡Œåˆ é™¤<br> <code>curl -k -H &quot;Content-Type: application/json&quot; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/[NEEDTODELETENS]/finalize;   </code></p>
<p> è¿™é‡Œé¢httpçš„<strong>è°ƒç”¨è·¯å¾„</strong>åœ¨ ï¼š tmp.jsonçš„ api å­—æ®µä¸­ã€‚</p>
</li>
<li><p>è¿è¡Œç»“æœè¿”å›NameSpaceçš„ç›¸å…³ä¿¡æ¯åº”è¯¥å°±æ˜¯åˆ é™¤äº†ã€‚</p>
</li>
</ol>
<h2 id="Namespaceåˆ é™¤å¡ä½çš„åŸå› "><a href="#Namespaceåˆ é™¤å¡ä½çš„åŸå› " class="headerlink" title="Namespaceåˆ é™¤å¡ä½çš„åŸå› "></a>Namespaceåˆ é™¤å¡ä½çš„åŸå› </h2><blockquote>
<p>Solution From Github: <a href="https://github.com/kubernetes/kubernetes/issues/60807">https://github.com/kubernetes/kubernetes/issues/60807</a></p>
</blockquote>
<p>æ˜¯æŸäº›æœåŠ¡çš„é—®é¢˜å¯¼è‡´äº†æ— æ³•åˆ é™¤æ‰ç›¸å…³çš„NS</p>
<ol>
<li>kubectl get apiservice | grep False</li>
<li>kubectl api-resources â€“verbs&#x3D;list â€“namespaced -o name | xargs -n 1 kubectl get -n [NEEDTODELETENS]</li>
<li>kubectl delete apiservice v1alpha3.kubevirt.io</li>
</ol>
<p>å…¶å®æ˜¯è¿™ä¸ªapiserviceå½±å“çš„ï¼Œä»–çš„çŠ¶æ€ä¸æ­£å¸¸å¯¼è‡´çš„NSåˆ é™¤çš„æ—¶å€™å¡ä½ï¼Œåˆ é™¤è¿™ä¸ªapiserviceå°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Fedoraé˜²ç«å¢™å…³é—­ï¼Œå¦‚ä½•å¼€æœºè¿è¡Œè„šæœ¬</title>
    <url>/2018/05/11/Linux/Linux_%E5%85%B3%E9%97%ADFedora%E9%98%B2%E7%81%AB%E5%A2%99/</url>
    <content><![CDATA[<p>è¿™æ¬¡çš„å†…å®¹æ˜¯ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…³é—­Firewalld å’Œ å¯åŠ¨rc.localçš„æœåŠ¡ã€‚  </p>
<p>å¦‚ä½•å½»åº•å…³é—­Fedora27çš„Firewalldï¼Œé˜²æ­¢æ¯æ¬¡é‡å¯è‡ªåŠ¨å¼€å¯ã€‚<br>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨å¾ˆæ—©ä¹‹å‰å°±å·²ç»å…³é—­äº†rc.localçš„ä½¿ç”¨ï¼Œå¼€æœºå¯åŠ¨çš„å†…å®¹å®Œå…¨ç”±systemdè¿›è¡Œç®¡ç†ï¼Œå¦‚æœè¦ä½¿ç”¨rc.localéœ€è¦è‡ªå·±é…ç½®ã€‚</p>
<h2 id="å¦‚ä½•å½»åº•å…³é—­Fedora27çš„Firewalld"><a href="#å¦‚ä½•å½»åº•å…³é—­Fedora27çš„Firewalld" class="headerlink" title="å¦‚ä½•å½»åº•å…³é—­Fedora27çš„Firewalld"></a>å¦‚ä½•å½»åº•å…³é—­Fedora27çš„Firewalld</h2><p>Fedoraçš„Firewalld,æ¯æ¬¡é‡å¯éƒ½ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œä¸ä¼šå½»åº•å…³é—­ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šçš„æ–¹å¼æ¥å…³é—­ã€‚  </p>
<ol>
<li>ç›´æ¥ç§»é™¤   <pre class="language-none"><code class="language-none">dnf remove firewalld</code></pre></li>
<li>æŒ‡å‘ä¸å­˜åœ¨çš„è®¾å¤‡   <pre class="language-none"><code class="language-none">systemctl mask firewalld  -- è¡¨ç¤ºç›´æ¥å°†è¿™ä¸ªæœåŠ¡æŒ‡å‘äº†&#x2F;dev&#x2F;null,æ— æ³•å¯åŠ¨ä¹Ÿæ— æ³•è¢«å…¶ä»–çš„ç¨‹åºç›´æ¥è°ƒç”¨ã€‚
systemctl disable firewalld -- å¼€æœºçš„æ—¶å€™ä¸ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œä½†æ˜¯æ¥å—å…¶ä»–çš„æœåŠ¡è°ƒç”¨å¹¶å¯åŠ¨ã€‚</code></pre></li>
</ol>
<h2 id="é…ç½®rc-localæœåŠ¡"><a href="#é…ç½®rc-localæœåŠ¡" class="headerlink" title="é…ç½®rc.localæœåŠ¡"></a>é…ç½®rc.localæœåŠ¡</h2><ol>
<li>æ–°å»ºrc.localæ–‡ä»¶ã€‚   <pre class="language-none"><code class="language-none">vim &#x2F;etc&#x2F;rc.d&#x2F;rc.local</code></pre></li>
<li>å†™å…¥å†…å®¹ã€‚   <pre class="language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash
&#x2F;usr&#x2F;sbin&#x2F;Orthanc
&#x2F;etc&#x2F;orthanc&#x2F;orthanc.json</code></pre></li>
<li>å¯åŠ¨æœåŠ¡,é…ç½®å¼€æœºè‡ªå¯ã€‚ <pre class="language-none"><code class="language-none">systemctl start rc-local.service
systemctl enable rc-local.service</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Fedora</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux-å†…æ ¸å‚æ•°ç¬”è®°</title>
    <url>/2018/01/22/Linux/Linux_%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>è®°å½•å†…æ ¸å‚æ•°çš„å«ä¹‰å’Œè°ƒæ•´çš„æ•ˆæœ, ä¸»è¦æ˜¯è®°å½•è¿™äº›å‚æ•°çš„å«ä¹‰æˆ–è€…ä½¿ç”¨å®ƒä»¬çš„æ–¹æ³•ï¼Œ ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦è°ƒæ•´è¿™ä¸ªã€‚</p>
<hr>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><h3 id="net-ipv4-tcp-max-tw-buckets"><a href="#net-ipv4-tcp-max-tw-buckets" class="headerlink" title="net.ipv4.tcp_max_tw_buckets"></a>net.ipv4.tcp_max_tw_buckets</h3><p>  å¯¹äºtcpè¿æ¥ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é€šä¿¡å®ŒåçŠ¶æ€å˜ä¸ºtimewaitï¼Œå‡å¦‚æŸå°æœåŠ¡å™¨éå¸¸å¿™ï¼Œè¿æ¥æ•°ç‰¹åˆ«å¤šçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªtimewaitæ•°é‡å°±ä¼šè¶Šæ¥è¶Šå¤§ã€‚æ¯•ç«Ÿå®ƒä¹Ÿæ˜¯ä¼šå ç”¨ä¸€å®šçš„èµ„æºï¼Œæ‰€ä»¥åº”è¯¥æœ‰ä¸€ä¸ªæœ€å¤§å€¼ï¼Œå½“è¶…è¿‡è¿™ä¸ªå€¼ï¼Œç³»ç»Ÿå°±ä¼šåˆ é™¤æœ€æ—©çš„è¿æ¥ï¼Œè¿™æ ·å§‹ç»ˆä¿æŒåœ¨ä¸€ä¸ªæ•°é‡çº§ã€‚<br>  è¿™ä¸ªæ•°å€¼å°±æ˜¯ç”±net.ipv4.tcp_max_tw_bucketsè¿™ä¸ªå‚æ•°æ¥å†³å®šçš„ã€‚CentOS7ç³»ç»Ÿï¼Œä½ å¯ä»¥ä½¿ç”¨sysctl -a |grep tw_bucketsæ¥æŸ¥çœ‹å®ƒçš„å€¼ï¼Œé»˜è®¤ä¸º32768ï¼Œä½ å¯ä»¥é€‚å½“æŠŠå®ƒè°ƒä½ï¼Œæ¯”å¦‚è°ƒæ•´åˆ°8000ï¼Œæ¯•ç«Ÿè¿™ä¸ªçŠ¶æ€çš„è¿æ¥å¤ªå¤šä¹Ÿæ˜¯ä¼šæ¶ˆè€—èµ„æºçš„ã€‚<br>  ä½†ä½ ä¸è¦æŠŠå®ƒè°ƒåˆ°å‡ åã€å‡ ç™¾è¿™æ ·ï¼Œå› ä¸ºè¿™ç§çŠ¶æ€çš„tcpè¿æ¥ä¹Ÿæ˜¯æœ‰ç”¨çš„ï¼Œå¦‚æœåŒæ ·çš„å®¢æˆ·ç«¯å†æ¬¡å’ŒæœåŠ¡ç«¯é€šä¿¡ï¼Œå°±ä¸ç”¨å†æ¬¡å»ºç«‹æ–°çš„è¿æ¥äº†ï¼Œç”¨è¿™ä¸ªæ—§çš„é€šé“ï¼Œçœæ—¶çœåŠ›ã€‚  </p>
<h3 id="net-ipv4-tcp-tw-recycle"><a href="#net-ipv4-tcp-tw-recycle" class="headerlink" title="net.ipv4.tcp_tw_recycle"></a>net.ipv4.tcp_tw_recycle</h3><p>  åœ¨æœ€æ–°ç‰ˆæœ¬çš„å†…æ ¸ä¸­ï¼Œ è¿™ä¸ªå·²ç»è¢«ç§»é™¤ï¼Œ è¿™ä¸ªå‚æ•°åœ¨å…·æœ‰natç½‘ç»œç»“æ„å’Œè¡Œä¸ºçš„æ—¶å€™ä¼šå¯¼è‡´å‡ºç°å¼‚å¸¸ã€‚</p>
<h3 id="net-ipv4-tcp-tw-reuse"><a href="#net-ipv4-tcp-tw-reuse" class="headerlink" title="net.ipv4.tcp_tw_reuse"></a>net.ipv4.tcp_tw_reuse</h3><p>  è¯¥å‚æ•°è®¾ç½®ä¸º1ï¼Œå°†timewaitçŠ¶æ€çš„è¿æ¥é‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œè¿™ä¸ªå‚æ•°æœ¬èº«å…¶å®å¼€å¼€å¯å°±å¯ä»¥äº†ï¼Œ ä»–å¯ä»¥å¿«é€Ÿçš„å›æ”¶å¤„äºtimewaitçš„socketï¼Œ ç”Ÿæ•ˆåœ¨å®¢æˆ·ç«¯ã€‚</p>
<h3 id="net-ipv4-tcp-syncookies"><a href="#net-ipv4-tcp-syncookies" class="headerlink" title="net.ipv4.tcp_syncookies"></a>net.ipv4.tcp_syncookies</h3><p>  tcpä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·synè¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åï¼Œä¹Ÿä¼šå‘å®¢æˆ·ç«¯å‘èµ·synè¯·æ±‚åŒæ—¶è¿å¸¦ackç¡®è®¤ï¼Œå‡å¦‚å®¢æˆ·ç«¯å‘é€è¯·æ±‚åç›´æ¥æ–­å¼€å’ŒæœåŠ¡ç«¯çš„è¿æ¥ï¼Œä¸æ¥æ”¶æœåŠ¡ç«¯å‘èµ·çš„è¿™ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šé‡è¯•å¤šæ¬¡ã€‚<br>  è¿™ä¸ªé‡è¯•çš„è¿‡ç¨‹ä¼šæŒç»­ä¸€æ®µæ—¶é—´ï¼Œå½“è¿™ç§çŠ¶æ€çš„è¿æ¥æ•°é‡éå¸¸å¤§æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ¶ˆè€—å¾ˆå¤§çš„èµ„æºï¼Œä»è€Œé€ æˆç˜«ç—ªï¼Œæ­£å¸¸çš„è¿æ¥è¿›ä¸æ¥ï¼Œè¿™ç§æ¶æ„çš„åŠè¿æ¥è¡Œä¸ºå…¶å®å«åšsyn floodæ”»å‡»ã€‚<br>  è®¾ç½®ä¸º1ï¼Œæ˜¯å¼€å¯SYN Cookiesï¼Œå¼€å¯åå¯ä»¥é¿å…å‘ç”Ÿä¸Šè¿°çš„syn floodæ”»å‡»ã€‚å¼€å¯è¯¥å‚æ•°åï¼ŒæœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯çš„ackåï¼Œå†å‘å®¢æˆ·ç«¯å‘é€ack+synä¹‹å‰ä¼šè¦æ±‚clientåœ¨çŸ­æ—¶é—´å†…å›åº”ä¸€ä¸ªåºå·ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸èƒ½æä¾›åºå·æˆ–è€…æä¾›çš„åºå·ä¸å¯¹åˆ™è®¤ä¸ºè¯¥å®¢æˆ·ç«¯ä¸åˆæ³•ï¼Œäºæ˜¯ä¸ä¼šå‘ack+synç»™å®¢æˆ·ç«¯ï¼Œæ›´æ¶‰åŠä¸åˆ°é‡è¯•ã€‚  </p>
<h3 id="net-ipv4-tcp-max-syn-backlog"><a href="#net-ipv4-tcp-max-syn-backlog" class="headerlink" title="net.ipv4.tcp_max_syn_backlog"></a>net.ipv4.tcp_max_syn_backlog</h3><p>  è¯¥å‚æ•°å®šä¹‰ç³»ç»Ÿèƒ½æ¥å—çš„æœ€å¤§åŠè¿æ¥çŠ¶æ€çš„tcpè¿æ¥æ•°ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†synåŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åï¼Œä¼šè®°å½•ä¸€ä¸‹ï¼Œè¯¥å‚æ•°å†³å®šæœ€å¤šèƒ½è®°å½•å‡ ä¸ªè¿™æ ·çš„è¿æ¥ã€‚æˆ‘çš„CentOS7ç³»ç»Ÿï¼Œé»˜è®¤æ˜¯256ï¼Œå½“æœ‰syn floodæ”»å‡»æ—¶ï¼Œè¿™ä¸ªæ•°å€¼å¤ªå°åˆ™å¾ˆå®¹æ˜“å¯¼è‡´æœåŠ¡å™¨ç˜«ç—ªï¼Œå®é™…ä¸Šæ­¤æ—¶æœåŠ¡å™¨å¹¶æ²¡æœ‰æ¶ˆè€—å¤ªå¤šèµ„æºï¼ˆcpuã€å†…å­˜ç­‰ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥é€‚å½“è°ƒå¤§å®ƒï¼Œæ¯”å¦‚è°ƒæ•´åˆ°30000ã€‚  </p>
<h3 id="net-ipv4-tcp-syn-retries"><a href="#net-ipv4-tcp-syn-retries" class="headerlink" title="net.ipv4.tcp_syn_retries"></a>net.ipv4.tcp_syn_retries</h3><p>  è¯¥å‚æ•°é€‚ç”¨äºå®¢æˆ·ç«¯ï¼Œå®ƒå®šä¹‰å‘èµ·synçš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º5ï¼Œå»ºè®®æ”¹ä¸º2ã€‚  </p>
<h3 id="net-ipv4-tcp-synack-retries"><a href="#net-ipv4-tcp-synack-retries" class="headerlink" title="net.ipv4.tcp_synack_retries"></a>net.ipv4.tcp_synack_retries</h3><p>  è¯¥å‚æ•°é€‚ç”¨äºæœåŠ¡ç«¯ï¼Œå®ƒå®šä¹‰å‘èµ·syn+ackçš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º5ï¼Œå»ºè®®æ”¹ä¸º2ï¼Œå¯ä»¥é€‚å½“é¢„é˜²syn floodæ”»å‡»ã€‚  </p>
<h3 id="net-ipv4-ip-local-port-range"><a href="#net-ipv4-ip-local-port-range" class="headerlink" title="net.ipv4.ip_local_port_range"></a>net.ipv4.ip_local_port_range</h3><p>  è¯¥å‚æ•°å®šä¹‰ç«¯å£èŒƒå›´ï¼Œç³»ç»Ÿé»˜è®¤ä¿ç•™ç«¯å£ä¸º1024åŠä»¥ä¸‹ï¼Œä»¥ä¸Šéƒ¨åˆ†ä¸ºè‡ªå®šä¹‰ç«¯å£ã€‚è¿™ä¸ªå‚æ•°é€‚ç”¨äºå®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œæ¯”å¦‚è¯´è®¿é—®æœåŠ¡ç«¯çš„80ç«¯å£ï¼Œå®¢æˆ·ç«¯éšæœºå¼€å¯äº†ä¸€ä¸ªç«¯å£å’ŒæœåŠ¡ç«¯å‘èµ·è¿æ¥ï¼Œè¿™ä¸ªå‚æ•°å®šä¹‰éšæœºç«¯å£çš„èŒƒå›´ã€‚é»˜è®¤ä¸º32768Â Â Â Â 61000ï¼Œå»ºè®®è°ƒæ•´ä¸º1025Â 61000ã€‚  </p>
<h3 id="net-ipv4-tcp-fin-timeout"><a href="#net-ipv4-tcp-fin-timeout" class="headerlink" title="net.ipv4.tcp_fin_timeout"></a>net.ipv4.tcp_fin_timeout</h3><p>  tcpè¿æ¥çš„çŠ¶æ€ä¸­ï¼Œå®¢æˆ·ç«¯ä¸Šæœ‰ä¸€ä¸ªæ˜¯FIN-WAIT-2çŠ¶æ€ï¼Œå®ƒæ˜¯çŠ¶æ€å˜è¿ä¸ºtimewaitå‰ä¸€ä¸ªçŠ¶æ€ã€‚è¯¥å‚æ•°å®šä¹‰ä¸å±äºä»»ä½•è¿›ç¨‹çš„è¯¥è¿æ¥çŠ¶æ€çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º60ï¼Œå»ºè®®è°ƒæ•´ä¸º6ã€‚  </p>
<h3 id="net-ipv4-tcp-keepalive-time"><a href="#net-ipv4-tcp-keepalive-time" class="headerlink" title="net.ipv4.tcp_keepalive_time"></a>net.ipv4.tcp_keepalive_time</h3><p>  tcpè¿æ¥çŠ¶æ€é‡Œï¼Œæœ‰ä¸€ä¸ªæ˜¯keepalivedçŠ¶æ€ï¼Œåªæœ‰åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ‰èƒ½é€šä¿¡ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“é€šä¿¡å®Œæ¯•ï¼Œå®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯ä¼šå‘Šè¯‰å¯¹æ–¹è¦å…³é—­è¿æ¥ï¼Œæ­¤æ—¶çŠ¶æ€å°±ä¼šå˜ä¸ºtimewaitï¼Œå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å‘Šè¯‰æœåŠ¡ç«¯ï¼Œå¹¶ä¸”æœåŠ¡ç«¯ä¹Ÿæ²¡æœ‰å‘Šè¯‰å®¢æˆ·ç«¯å…³é—­çš„è¯ï¼ˆä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯é‚£è¾¹æ–­ç½‘äº†ï¼‰ï¼Œæ­¤æ—¶éœ€è¦è¯¥å‚æ•°æ¥åˆ¤å®šã€‚<br>    æ¯”å¦‚å®¢æˆ·ç«¯å·²ç»æ–­ç½‘äº†ï¼Œä½†æœåŠ¡ç«¯ä¸Šæœ¬æ¬¡è¿æ¥çš„çŠ¶æ€ä¾ç„¶æ˜¯keepalivedï¼ŒæœåŠ¡ç«¯ä¸ºäº†ç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦æ–­ç½‘ï¼Œå°±éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´å»å‘ä¸€ä¸ªæ¢æµ‹åŒ…å»ç¡®è®¤ä¸€ä¸‹çœ‹çœ‹å¯¹æ–¹æ˜¯å¦åœ¨çº¿ã€‚è¿™ä¸ªæ—¶é—´å°±ç”±è¯¥å‚æ•°å†³å®šã€‚å®ƒçš„é»˜è®¤å€¼ä¸º7200ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œå»ºè®®è®¾ç½®ä¸º30ã€‚</p>
<h3 id="net-ipv4-tcp-keepalive-intvl"><a href="#net-ipv4-tcp-keepalive-intvl" class="headerlink" title="net.ipv4.tcp_keepalive_intvl"></a>net.ipv4.tcp_keepalive_intvl</h3><p>  è¯¥å‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ˜¯ä¸€èµ·çš„ï¼ŒæœåŠ¡ç«¯åœ¨è§„å®šæ—¶é—´å†…å‘èµ·äº†æ¢æµ‹ï¼ŒæŸ¥çœ‹å®¢æˆ·ç«¯æ˜¯å¦åœ¨çº¿ï¼Œå¦‚æœå®¢æˆ·ç«¯å¹¶æ²¡æœ‰ç¡®è®¤ï¼Œæ­¤æ—¶æœåŠ¡ç«¯è¿˜ä¸èƒ½è®¤å®šä¸ºå¯¹æ–¹ä¸åœ¨çº¿ï¼Œè€Œæ˜¯è¦å°è¯•å¤šæ¬¡ã€‚è¯¥å‚æ•°å®šä¹‰é‡æ–°å‘é€æ¢æµ‹çš„æ—¶é—´ï¼Œå³ç¬¬ä¸€æ¬¡å‘ç°å¯¹æ–¹æœ‰é—®é¢˜åï¼Œè¿‡å¤šä¹…å†æ¬¡å‘èµ·æ¢æµ‹ã€‚<br>    é»˜è®¤å€¼ä¸º75ç§’ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œå¯ä»¥æ”¹ä¸º3ã€‚</p>
<h3 id="net-ipv4-tcp-keepalive-probes"><a href="#net-ipv4-tcp-keepalive-probes" class="headerlink" title="net.ipv4.tcp_keepalive_probes"></a>net.ipv4.tcp_keepalive_probes</h3><p>  ç¬¬10å’Œç¬¬11ä¸ªå‚æ•°è§„å®šäº†ä½•æ—¶å‘èµ·æ¢æµ‹å’Œæ¢æµ‹å¤±è´¥åå†è¿‡å¤šä¹…å†å‘èµ·æ¢æµ‹ï¼Œä½†å¹¶æ²¡æœ‰å®šä¹‰ä¸€å…±æ¢æµ‹å‡ æ¬¡æ‰ç®—ç»“æŸã€‚è¯¥å‚æ•°å®šä¹‰å‘èµ·æ¢æµ‹çš„åŒ…çš„æ•°é‡ã€‚é»˜è®¤ä¸º9ï¼Œå»ºè®®è®¾ç½®2ã€‚</p>
<h3 id="net-ipv4-tcp-slow-start-after-idl"><a href="#net-ipv4-tcp-slow-start-after-idl" class="headerlink" title="net.ipv4.tcp_slow_start_after_idl"></a>net.ipv4.tcp_slow_start_after_idl</h3><h2 id="è¿™ä¸ªæ¨èç›´æ¥è®¾ç½®ä¸º0-ï¼Œ-åœ¨tcpè¿æ¥å¤šè€Œä¸”æ•°æ®äº¤äº’é¢‘ç¹çš„æ—¶å€™ï¼Œ-è¿™ä¸ªå‚æ•°æ²¡æœ‰ç‰¹åˆ«å¤§çš„å½±å“ï¼Œ-ä½†æ˜¯å¯¹äºé—´éš”ä¸€æ®µæ—¶é—´è¿™ç±»çš„ç½‘ç»œè¯·æ±‚ï¼Œ-ç¡®å®æ˜¯ä¼šæœ‰å½±å“çš„ï¼Œ-ä¼šå¯¼è‡´èµ°-æ…¢å¯åŠ¨-æ‹‰é•¿å»¶è¿Ÿ"><a href="#è¿™ä¸ªæ¨èç›´æ¥è®¾ç½®ä¸º0-ï¼Œ-åœ¨tcpè¿æ¥å¤šè€Œä¸”æ•°æ®äº¤äº’é¢‘ç¹çš„æ—¶å€™ï¼Œ-è¿™ä¸ªå‚æ•°æ²¡æœ‰ç‰¹åˆ«å¤§çš„å½±å“ï¼Œ-ä½†æ˜¯å¯¹äºé—´éš”ä¸€æ®µæ—¶é—´è¿™ç±»çš„ç½‘ç»œè¯·æ±‚ï¼Œ-ç¡®å®æ˜¯ä¼šæœ‰å½±å“çš„ï¼Œ-ä¼šå¯¼è‡´èµ°-æ…¢å¯åŠ¨-æ‹‰é•¿å»¶è¿Ÿ" class="headerlink" title="  è¿™ä¸ªæ¨èç›´æ¥è®¾ç½®ä¸º0 ï¼Œ åœ¨tcpè¿æ¥å¤šè€Œä¸”æ•°æ®äº¤äº’é¢‘ç¹çš„æ—¶å€™ï¼Œ è¿™ä¸ªå‚æ•°æ²¡æœ‰ç‰¹åˆ«å¤§çš„å½±å“ï¼Œ ä½†æ˜¯å¯¹äºé—´éš”ä¸€æ®µæ—¶é—´è¿™ç±»çš„ç½‘ç»œè¯·æ±‚ï¼Œ ç¡®å®æ˜¯ä¼šæœ‰å½±å“çš„ï¼Œ ä¼šå¯¼è‡´èµ° æ…¢å¯åŠ¨ æ‹‰é•¿å»¶è¿Ÿ  
  "></a>  è¿™ä¸ªæ¨èç›´æ¥è®¾ç½®ä¸º0 ï¼Œ åœ¨tcpè¿æ¥å¤šè€Œä¸”æ•°æ®äº¤äº’é¢‘ç¹çš„æ—¶å€™ï¼Œ è¿™ä¸ªå‚æ•°æ²¡æœ‰ç‰¹åˆ«å¤§çš„å½±å“ï¼Œ ä½†æ˜¯å¯¹äºé—´éš”ä¸€æ®µæ—¶é—´è¿™ç±»çš„ç½‘ç»œè¯·æ±‚ï¼Œ ç¡®å®æ˜¯ä¼šæœ‰å½±å“çš„ï¼Œ ä¼šå¯¼è‡´èµ° æ…¢å¯åŠ¨ æ‹‰é•¿å»¶è¿Ÿ<br>  <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sysctl</span> <span class="token parameter variable">-w</span>  net.ipv4.tcp_slow_start_after_idle <span class="token operator">=</span> <span class="token number">0</span> 
<span class="token builtin class-name">echo</span> <span class="token string">"net.ipv4.tcp_slow_start_after_idle = 0"</span> <span class="token operator">>></span> /etc/sysctl.conf</code></pre>
  </h2><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p>tcpåè®®çš„ç½‘ç»œæµé‡æ§åˆ¶ [[..&#x2F;Network&#x2F;Network_tcæ§åˆ¶æµé‡-update|Network_tcæ§åˆ¶æµé‡-update]]<br>Amazon Linux 2 å®Œæ•´çš„sysctlå‚æ•° [[Linux_Sysctl]]<br>Linuxæ“ä½œç³»ç»Ÿè§¦å‘NMIä¸­æ–­è°ƒè¯•å’ŒKdump [[Linux_DebugLinuxCrashOnEC2]]</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡çº§ä»¥åŠæ¸…ç†å†…æ ¸çš„æ­¥éª¤</title>
    <url>/2023/07/12/Linux/Linux_%E5%8D%87%E7%BA%A7%E5%92%8C%E6%B8%85%E7%90%86%E5%86%85%E6%A0%B8%E7%9A%84%E6%AD%A5%E9%AA%A4/</url>
    <content><![CDATA[<p>é€šå¸¸æƒ…å†µä¸‹å‡çº§å†…æ ¸ç‰ˆæœ¬çš„æ­¥éª¤:</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">yum makecache <span class="token parameter variable">-y</span> 

yum update <span class="token parameter variable">-y</span> 

grub2-editenv list

grub2-set-default <span class="token string">'CentOS Linux (3.10.xxxxx.el7.elrepo.x86_64) 7 (Core)'</span> <span class="token comment"># entry_name</span>

systemctl <span class="token function">reboot</span></code></pre>

<p>æ¸…ç†æ—§ç‰ˆæœ¬çš„æ­¥éª¤ï¼› </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-qa</span>  kernel* 
<span class="token comment"># è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰å½“å‰å·²ç»å®‰è£…çš„ç‰ˆæœ¬çš„å†…æ ¸ï¼Œ ç„¶åæ‰‹åŠ¨ä½¿ç”¨å‘½ä»¤ç§»é™¤å¯¹åº”çš„è½¯ä»¶åŒ…å³å¯ã€‚ </span>
<span class="token comment"># æˆ‘è®°å¾—æ˜¯æœ‰ä¸€ä¸ªå‘½ä»¤å¯ä»¥å®Œå…¨ç§»é™¤å…¨éƒ¨æœªä½¿ç”¨çš„å†…æ ¸ï¼Œ å¯èƒ½è®°é”™äº†ï¼Œ è¿™å‘½ä»¤åº”è¯¥åªæœ‰åœ¨ubuntu ä¸Šé¢æ˜¯å­˜åœ¨çš„ã€‚</span>

yum groupinstall <span class="token parameter variable">-y</span> <span class="token string">"Development Tools"</span>
categories: Linux
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kernel kernel-devel kernel-debug</code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux-è¿›ç¨‹ç®¡ç†ç¬”è®°</title>
    <url>/2018/01/29/Linux/Linux_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="è¿›ç¨‹çš„ä¼˜å…ˆçº§"><a href="#è¿›ç¨‹çš„ä¼˜å…ˆçº§" class="headerlink" title="è¿›ç¨‹çš„ä¼˜å…ˆçº§"></a>è¿›ç¨‹çš„ä¼˜å…ˆçº§</h2><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><ul>
<li>ä¼˜å…ˆçº§è¶Šé«˜çš„è¿›ç¨‹å°±èƒ½å¤Ÿè·å¾—æ›´å¤šçš„CPUè¿è¡Œæ—¶é—´</li>
<li>èƒ½å¤Ÿæ›´ä¼˜å…ˆçš„è·å¾—è¿è¡Œçš„æœºä¼š</li>
</ul>
<h3 id="ä¼˜å…ˆçº§çš„è°ƒæ•´"><a href="#ä¼˜å…ˆçº§çš„è°ƒæ•´" class="headerlink" title="ä¼˜å…ˆçº§çš„è°ƒæ•´"></a>ä¼˜å…ˆçº§çš„è°ƒæ•´</h3><ul>
<li>ç”¨æˆ·å¯ä»¥è°ƒæ•´çš„ä¼˜å…ˆçº§(priority)èŒƒå›´æ˜¯100-139<br>æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªniceå€¼, niceå€¼æ˜¯ä»-20åˆ°19ï¼Œåˆ†åˆ«å¯¹åº”100-139</li>
</ul>
<p>å¯ä»¥è°ƒæ•´è¿›ç¨‹è‡ªå·±çš„niceå€¼ï¼Œæ¥è°ƒæ•´ä¼˜å…ˆçº§  </p>
<ul>
<li>niceå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜  </li>
<li>é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§éƒ½æ˜¯0</li>
</ul>
<p>å¦‚æœæœ‰è¿›ç¨‹çš„ä¼˜å…ˆçº§æ˜¯3ï¼Œå°±è¯´æ˜è¯¥è¿›ç¨‹é™ä½äº†è‡ªå·±çš„ä¼˜å…ˆçº§ï¼Œæ™®é€šç”¨æˆ·åªèƒ½è°ƒå¤§niceå€¼ï¼Œç®¡ç†å‘˜å¯ä»¥éšæ„è°ƒæ•´</p>
<h3 id="PIDï¼ˆprocess-IDï¼‰-è¿›ç¨‹å·"><a href="#PIDï¼ˆprocess-IDï¼‰-è¿›ç¨‹å·" class="headerlink" title="PIDï¼ˆprocess IDï¼‰:è¿›ç¨‹å·"></a>PIDï¼ˆprocess IDï¼‰:è¿›ç¨‹å·</h3><h2 id="Initè¿›ç¨‹"><a href="#Initè¿›ç¨‹" class="headerlink" title="Initè¿›ç¨‹"></a>Initè¿›ç¨‹</h2><p>æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰çˆ¶è¿›ç¨‹ï¼Œé™¤äº†initï¼Œinitæ˜¯æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹<br>initçš„è¿›ç¨‹å·æ°¸è¿œä¸º1   </p>
<h2 id="å…¶ä»–è¿›ç¨‹"><a href="#å…¶ä»–è¿›ç¨‹" class="headerlink" title="å…¶ä»–è¿›ç¨‹"></a>å…¶ä»–è¿›ç¨‹</h2><p>è¿›ç¨‹çš„ç›¸å…³å±æ€§ä¿¡æ¯åœ¨&#x2F;procç›®å½•ä¸‹ï¼Œæ¯ä¸€ä¸ªç›®å½•å¯¹åº”ä¸€ä¸ªè¿›ç¨‹<br>æ¯ä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå³ä½¿è¿›ç¨‹é€€å‡ºäº†ï¼Œè¿›ç¨‹çš„å·ç ä¸€èˆ¬ä¸ä¼šè¢«å ç”¨<br>è®¿é—®åˆ°çš„éƒ½æ˜¯å†…æ ¸çš„æ˜ å°„ã€‚ä¸æ˜¯æ–‡ä»¶ï¼Œæ˜¯å†…æ ¸å‚æ•°<br>è¿›ç¨‹å·æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶è®°è½½äº†è¿›ç¨‹è¿è¡Œçš„å‘½ä»¤ï¼Œå†…å­˜ï¼Œä½¿ç”¨çš„cpuç­‰ç­‰  </p>
<h2 id="è¿›ç¨‹çš„åˆ†ç±»"><a href="#è¿›ç¨‹çš„åˆ†ç±»" class="headerlink" title="è¿›ç¨‹çš„åˆ†ç±»"></a>è¿›ç¨‹çš„åˆ†ç±»</h2><ul>
<li>ä¸ç»ˆç«¯æœ‰å…³çš„è¿›ç¨‹</li>
<li>ä¸ç»ˆç«¯æ— å…³çš„è¿›ç¨‹</li>
</ul>
<h2 id="è¿›ç¨‹çŠ¶æ€è¡¨"><a href="#è¿›ç¨‹çŠ¶æ€è¡¨" class="headerlink" title="è¿›ç¨‹çŠ¶æ€è¡¨"></a>è¿›ç¨‹çŠ¶æ€è¡¨</h2><table>
<thead>
<tr>
<th align="center">æ ‡è¯†ç¬¦</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">D</td>
<td align="left">ä¸å¯ä¸­æ–­çš„ç¡çœ </td>
</tr>
<tr>
<td align="center">R</td>
<td align="left">è¿è¡Œæˆ–å°±ç»ª</td>
</tr>
<tr>
<td align="center">S</td>
<td align="left">å¯ä¸­æ–­çš„ç¡çœ </td>
</tr>
<tr>
<td align="center">T</td>
<td align="left">åœæ­¢</td>
</tr>
<tr>
<td align="center">Z</td>
<td align="left">åƒµæ­»</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="left">é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹</td>
</tr>
<tr>
<td align="center">N</td>
<td align="left">ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹</td>
</tr>
<tr>
<td align="center">+</td>
<td align="left">å‰å°è¿›ç¨‹ç»„ä¸­çš„è¿›ç¨‹</td>
</tr>
<tr>
<td align="center">l</td>
<td align="left">è¡¨ç¤ºå¤šçº¿ç¨‹è¿›ç¨‹</td>
</tr>
<tr>
<td align="center">s</td>
<td align="left">ä¼šè¯è¿›ç¨‹çš„é¦–è¿›ç¨‹(é¢†å¯¼è€…è¿›ç¨‹)</td>
</tr>
</tbody></table>
<h2 id="è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤"><a href="#è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤" class="headerlink" title="è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤"></a>è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤</h2><p><strong>pså‘½ä»¤</strong> æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ï¼Œå¤šç§ä½¿ç”¨é£æ ¼ï¼Œunixçš„ä¸¤å¤§é˜µè¥ï¼ŒBSDé£æ ¼ï¼ˆä¸åŠ -ï¼‰ï¼ŒSYSVé£æ ¼ï¼ˆåŠ -)</p>
<p>Exampleï¼š <code>ps -aux</code>  </p>
<h3 id="å‚æ•°è¯´æ˜-BSDé£æ ¼"><a href="#å‚æ•°è¯´æ˜-BSDé£æ ¼" class="headerlink" title="å‚æ•°è¯´æ˜-BSDé£æ ¼"></a>å‚æ•°è¯´æ˜-BSDé£æ ¼</h3><p>aï¼šBSDé£æ ¼ï¼Œæ˜¾ç¤ºæ‰€æœ‰ä¸ç»ˆç«¯æœ‰å…³çš„è¿›ç¨‹ï¼Œä¸xä¸€èµ·ç”¨æ˜¾ç¤ºæ‰€æœ‰<br>uï¼šèƒ½å¤Ÿæ˜¾ç¤ºè¯¦ç»†çš„ä¿¡æ¯<br>xï¼šBSDé£æ ¼ï¼Œæ˜¾ç¤ºæ‰€æœ‰ä¸ç»ˆç«¯æ— å…³çš„è¿›ç¨‹  </p>
<h4 id="Pså‘½ä»¤è¾“å‡ºä¿¡æ¯çš„è¯´æ˜"><a href="#Pså‘½ä»¤è¾“å‡ºä¿¡æ¯çš„è¯´æ˜" class="headerlink" title="Pså‘½ä»¤è¾“å‡ºä¿¡æ¯çš„è¯´æ˜"></a>Pså‘½ä»¤è¾“å‡ºä¿¡æ¯çš„è¯´æ˜</h4><p>å•ç‹¬æŸ¥çœ‹Firefoxè¿›ç¨‹çš„ä¾‹å­  </p>
<pre class="language-none"><code class="language-none">[root@localhost Liarlee]# ps -aux | grep firefox  
USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND  
root       1915  5.7  6.9 9324108 570096 tty2   Sl+  11:23   2:00 &#x2F;usr&#x2F;lib64&#x2F;firefox&#x2F;firefox  </code></pre>

<p>è¯´æ˜è¡¨æ ¼  </p>
<table>
<thead>
<tr>
<th align="center">USER</th>
<th align="left">PID</th>
<th align="left">%CPU</th>
<th align="left">%MEM</th>
<th align="left">RSS</th>
<th align="left">VSZ</th>
<th align="left">TTY</th>
<th align="left">START</th>
<th align="left">STAT</th>
<th align="left">TIME</th>
<th align="left">COMMAND</th>
</tr>
</thead>
<tbody><tr>
<td align="center">è¿›ç¨‹å‘èµ·è€…</td>
<td align="left">è¿›ç¨‹å·</td>
<td align="left">ä½¿ç”¨cpuç™¾åˆ†æ¯”</td>
<td align="left">ä½¿ç”¨å†…å­˜çš„ç™¾åˆ†æ¯”</td>
<td align="left">å¸¸é©»å†…å­˜é›†</td>
<td align="left">è™šæ‹Ÿå†…å­˜é›†</td>
<td align="left">æ§åˆ¶å°å…³è”</td>
<td align="left">å¯åŠ¨æ—¶é—´</td>
<td align="left">çŠ¶æ€</td>
<td align="left">è¿è¡Œæ—¶é—´</td>
<td align="left">å“ªä¸€ä¸ªå‘½ä»¤å¯åŠ¨çš„è¿›ç¨‹</td>
</tr>
<tr>
<td align="center"><em>[]è¡¨ç¤ºæ˜¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¸æ˜¯ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹</em></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="å¦ä¸€ä¸ªé£æ ¼-SYSVé£æ ¼"><a href="#å¦ä¸€ä¸ªé£æ ¼-SYSVé£æ ¼" class="headerlink" title="å¦ä¸€ä¸ªé£æ ¼-SYSVé£æ ¼"></a>å¦ä¸€ä¸ªé£æ ¼-SYSVé£æ ¼</h3><p>-e SYSVé£æ ¼ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„è¿›ç¨‹<br>-F é¢å¤–çš„å®Œå…¨æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´å¤šçš„å­—æ®µ<br>-l é•¿æ ¼å¼  </p>
<p>PRIï¼šä¼˜å…ˆçº§<br>NIï¼šniceå€¼<br>SZï¼šsize<br>PSRï¼šæ­£åœ¨è¿è¡Œåœ¨é‚£ä¸ªCPU  </p>
<p>ps -o æŒ‡å®šæ˜¾ç¤ºçš„å­—æ®µ,ps ä¸åŠ å‚æ•°åªæ˜¾ç¤ºå‰å°è¿›ç¨‹ï¼Œä¸€èˆ¬ä½¿ç”¨ps -axo<br>ä¾‹ï¼šps -axo comm,pid,ni<br>manæ–‡æ¡£ä¸­æœ‰å•ç‹¬çš„è¯´æ˜-oå¯ä»¥æŒ‡å®šé‚£äº›å­—æ®µ  </p>
<h2 id="Pstreeè¿›ç¨‹æ ‘"><a href="#Pstreeè¿›ç¨‹æ ‘" class="headerlink" title="Pstreeè¿›ç¨‹æ ‘"></a>Pstreeè¿›ç¨‹æ ‘</h2><p>pgrep  æŸ¥æ‰¾ç¬¦åˆæŸç§ç‰¹æ€§çš„è¿›ç¨‹    ä¾‹ï¼š pgrep bash   pgrep -u root bash  ä»¥rootç”¨æˆ·ä¸ºå±ä¸»è¿è¡Œçš„bashè¿›ç¨‹<br>   åªæ˜¾ç¤ºè¿›ç¨‹å·ï¼Œä¸æ˜¾ç¤ºè¿›ç¨‹çš„åç§°<br>   -u euid        æœ‰æ•ˆID<br>   -U uid         è¿›ç¨‹å‘èµ·è€…ID  </p>
<p>pidof     æŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹åå­—å¯¹åº”å¾—è¿›ç¨‹å·   pidof init    |   pidof sshd    |    pidof crond</p>
<h2 id="Top"><a href="#Top" class="headerlink" title="Top"></a>Top</h2><h3 id="å…³äºtopæ˜¾ç¤ºä¿¡æ¯çš„è¯´æ˜"><a href="#å…³äºtopæ˜¾ç¤ºä¿¡æ¯çš„è¯´æ˜" class="headerlink" title="å…³äºtopæ˜¾ç¤ºä¿¡æ¯çš„è¯´æ˜"></a>å…³äºtopæ˜¾ç¤ºä¿¡æ¯çš„è¯´æ˜</h3><pre><code>   å½“å‰ç³»ç»Ÿæ—¶é—´ ï¼Œ upè¿è¡Œæ—¶é•¿ï¼Œç™»é™†ç”¨æˆ·ï¼Œå¹³å‡è´Ÿè½½ï¼ˆå¹³å‡é˜Ÿåˆ—é•¿åº¦ï¼Œé˜Ÿåˆ—é•¿åº¦è¶Šå°cpuè´Ÿè½½è¶Šä½ï¼‰ã€‚
   æ‰€æœ‰çš„è¿›ç¨‹æ•°é‡ï¼Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°é‡ï¼Œå¤šå°‘ä¸ªç¡çœ è¿›ç¨‹ï¼Œå¤šå°‘ä¸ªåƒµå°¸è¿›ç¨‹
   æ¯ä¸ªcpuè´Ÿè½½ï¼Œé»˜è®¤æ˜¯å¤šé¢—cpuå¹³å‡è´Ÿè½½ï¼Œæ•°å­—1ï¼Œè¡¨ç¤ºå±•å¼€æŸ¥çœ‹ã€‚
       us ï¼š ç”¨æˆ·ç©ºé—´å ç”¨çš„
       syï¼š è¿è¡Œåœ¨ç³»ç»Ÿå æ®äº†å¤šå°‘
       niï¼šniceå€¼å½±å“çš„cpuæ¯”ä¾‹
       idï¼š ç©ºé—²çš„ç™¾åˆ†æ¯”
       waï¼š ç­‰å¾…IOå®Œæˆçš„ç™¾åˆ†æ¯”ï¼Œå æ®çš„æ—¶é—´
       hi ï¼šä¸­æ–­å æ®çš„ç™¾åˆ†æ¯”
       si ï¼š è½¯ä¸­æ–­çš„æ—¶é—´
       st ï¼š è¢«å·èµ°çš„æ—¶é—´
   å†…å­˜çš„ä½¿ç”¨
   äº¤æ¢çš„ä½¿ç”¨
   é»˜è®¤ä½¿ç”¨cpuç™¾åˆ†æ¯”æ’åº
</code></pre>
<h3 id="Topäº¤äº’å¼çš„å­å‘½ä»¤"><a href="#Topäº¤äº’å¼çš„å­å‘½ä»¤" class="headerlink" title="Topäº¤äº’å¼çš„å­å‘½ä»¤"></a>Topäº¤äº’å¼çš„å­å‘½ä»¤</h3><pre><code>   Mï¼šä½¿ç”¨å†…å­˜ç™¾åˆ†æ¯”æ’åº
   Pï¼š ä½¿ç”¨cpuç™¾åˆ†æ¯”æ’åº
   Tï¼š å ç”¨cpuæ—¶é—´æ’åº

   lï¼šä¸æ˜¾ç¤ºå¹³å‡è´Ÿè½½å¯åŠ¨æ—¶é—´  
   tï¼šä¸æ˜¾ç¤ºè¿›ç¨‹å’Œcpuè´Ÿè½½   
   mï¼šä¸æ˜¾ç¤ºå…³äºå†…å­˜å’Œäº¤æ¢çš„ä¿¡æ¯

   cï¼š  æ˜¯å¦æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤è¡Œ
   qï¼š é€€å‡ºtop
   kï¼š  æ€æ­»æŸä¸ªè¿›ç¨‹
</code></pre>
<h3 id="æ›´æ”¹topå‘½ä»¤çš„é€‰é¡¹ï¼š"><a href="#æ›´æ”¹topå‘½ä»¤çš„é€‰é¡¹ï¼š" class="headerlink" title="æ›´æ”¹topå‘½ä»¤çš„é€‰é¡¹ï¼š"></a>æ›´æ”¹topå‘½ä»¤çš„é€‰é¡¹ï¼š</h3><pre><code>   -d    æ›´æ”¹åˆ·æ–°æ˜¯æ—¶å¸¸
   -b   æ‰¹å¤„ç†æ¨¡å¼   ä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œåˆ·æ–°å‡ºä¸€å±
   -n  3 ï¼š æ‰¹å¤„ç†æ¨¡å¼åªæ˜¾ç¤ºå¤šå°‘æ¬¡
</code></pre>
<h2 id="è¿›ç¨‹é—´é€šä¿¡ï¼š"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼š" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼š"></a>è¿›ç¨‹é—´é€šä¿¡ï¼š</h2><p>è¿›ç¨‹ä¹‹é—´å½¼æ­¤ä¸èƒ½æ„Ÿå—åˆ°å½¼æ­¤çš„å­˜åœ¨ï¼Œå› æ­¤è¿›ç¨‹é—´çš„é€šä¿¡æœ‰å‡ ç§æœºåˆ¶ï¼š  </p>
<h3 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h3><p>è¿›ç¨‹é—´é€šä¿¡ï¼Œunixä¸­éå¸¸å¸¸ç”¨çš„æœºåˆ¶ï¼Œinter process Communication<br>               å…±äº«å†…å­˜<br>               ä¿¡å·ï¼šsignal<br>               semaphore  </p>
<h3 id="æ‰‹åŠ¨æ§åˆ¶è¿›ç¨‹é—´é€šä¿¡ï¼š-Kill"><a href="#æ‰‹åŠ¨æ§åˆ¶è¿›ç¨‹é—´é€šä¿¡ï¼š-Kill" class="headerlink" title="æ‰‹åŠ¨æ§åˆ¶è¿›ç¨‹é—´é€šä¿¡ï¼š Kill"></a>æ‰‹åŠ¨æ§åˆ¶è¿›ç¨‹é—´é€šä¿¡ï¼š Kill</h3><pre><code>       kill -l  æ˜¾ç¤ºæ‰€æœ‰çš„killä¿¡å·
       1 sighup        è®©ä¸€ä¸ªè¿›ç¨‹ä¸é‡å¯ï¼Œé‡è¯»é…ç½®æ–‡ä»¶ï¼Œè®©æ–‡ä»¶çš„æ–°é…ç½®ç”Ÿæ•ˆ
       2 sigint          ä¸­æ–­ä¸€ä¸ªè¿›ç¨‹ï¼Œctrl c å°±æ˜¯å‘é€äº† 2 ä¿¡å·
       9 sigkill            æ€æ­»ä¸€ä¸ªè¿›ç¨‹  ï¼Œ å¼ºè¡Œå…³é—­  ï¼Œ æ²¡æœ‰ä»»ä½•ä½™åœ°
       15 sigterm        ä¸­æ­¢ä¸€ä¸ªè¿›ç¨‹
</code></pre>
<h3 id="æŒ‡å®šå‘é€ä¿¡å·ï¼š"><a href="#æŒ‡å®šå‘é€ä¿¡å·ï¼š" class="headerlink" title="æŒ‡å®šå‘é€ä¿¡å·ï¼š"></a>æŒ‡å®šå‘é€ä¿¡å·ï¼š</h3><p>   kill -1<br>   kill -sigkill<br>   kill -kill</p>
<h2 id="æ€æ­»æ‰€æœ‰æŸä¸ªåå­—çš„è¿›ç¨‹ï¼š"><a href="#æ€æ­»æ‰€æœ‰æŸä¸ªåå­—çš„è¿›ç¨‹ï¼š" class="headerlink" title="æ€æ­»æ‰€æœ‰æŸä¸ªåå­—çš„è¿›ç¨‹ï¼š"></a>æ€æ­»æ‰€æœ‰æŸä¸ªåå­—çš„è¿›ç¨‹ï¼š</h2><p>killall  command</p>
<h2 id="è°ƒæ•´è¿è¡Œä¸­è¿›ç¨‹çš„ä¼˜å…ˆçº§"><a href="#è°ƒæ•´è¿è¡Œä¸­è¿›ç¨‹çš„ä¼˜å…ˆçº§" class="headerlink" title="è°ƒæ•´è¿è¡Œä¸­è¿›ç¨‹çš„ä¼˜å…ˆçº§"></a>è°ƒæ•´è¿è¡Œä¸­è¿›ç¨‹çš„ä¼˜å…ˆçº§</h2><pre><code>     renice    è¿›ç¨‹ä¼˜å…ˆçº§   è¿›ç¨‹å·
       renice   3   3704
</code></pre>
<p>nice -n niceå€¼ å‘½ä»¤</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>vmstat<br>   vmstat 1   æ¯ä¸€ç§’æ˜¾ç¤ºä¸€æ¬¡</p>
<p>pkill ç±»ä¼¼äº pgrep</p>
<p>bg  æŠŠå‰å°çš„ä½œä¸šæ”¾å…¥åå°<br>   bg ã€%ã€‘jobid  å¯ä»¥æŒ‡å®šæ‰§è¡ŒæŸä¸€ä¸ªä½œä¸š  é»˜è®¤æ‰§è¡Œ+ ä½œä¸š<br>jobs  æŸ¥çœ‹åå°çš„æ‰€æœ‰ä½œä¸š  ä½œä¸šå·ä¸åŒäºè¿›ç¨‹å·<br>   å¦‚æœè¿›ç¨‹ä¸Šæœ‰+ å· è¯´æ˜æ¥ä¸‹æ¥å°†è¦ç»§ç»­æ“ä½œçš„ä½œä¸š<br>    å¦‚æœè¿›ç¨‹ä¸Šæœ‰-å¥½  è¯´æ˜æ‰§è¡Œå®Œ+çš„ä½œä¸šä¹‹åå†æ‰§è¡Œ-å·ä½œä¸š  </p>
<p>fg å°†åå°çš„ä½œä¸šæ”¾å…¥å‰å° ï¼Œç”¨æ³•ç±»ä¼¼äºbg  </p>
<p>å¦‚æœæ€æ­»æŸäº›ä½œä¸š ï¼Œ kill  %2   æ€æ­»ä½œä¸š2  </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Network ç›¸å…³çŸ¥è¯†ä¸çŸ¥é“æ”¾é‚£å„¿</title>
    <url>/2023/05/12/Network/Network-RFC1180/</url>
    <content><![CDATA[<p>Origin Version:<br><a href="https://datatracker.ietf.org/doc/html/rfc1180">https://datatracker.ietf.org/doc/html/rfc1180</a></p>
<p>Chinese Version:<br><a href="http://arthurchiao.art/blog/rfc1180-a-tcp-ip-tutorial-zh/">http://arthurchiao.art/blog/rfc1180-a-tcp-ip-tutorial-zh/</a></p>
<hr>
<p>Tuning initcwnd for optimum Performance: </p>
<p><a href="https://www.cdnplanet.com/blog/tune-tcp-initcwnd-for-optimum-performance/">https://www.cdnplanet.com/blog/tune-tcp-initcwnd-for-optimum-performance/</a></p>
<p><a href="https://www.kawabangga.com/posts/5217">https://www.kawabangga.com/posts/5217</a></p>
<hr>
<p>Other Linux Network Stack Explaination:<br><a href="https://www.clockblog.life/article/2023/7/4/44.html">https://www.clockblog.life/article/2023/7/4/44.html</a></p>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>Network</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux OS ç½‘ç»œæµé‡æ§åˆ¶æµ‹è¯•</title>
    <url>/2023/04/14/Network/Network_tc%E6%8E%A7%E5%88%B6%E6%B5%81%E9%87%8F-update/</url>
    <content><![CDATA[<h2 id="å†…æ ¸å‚æ•°çš„è¯´æ˜"><a href="#å†…æ ¸å‚æ•°çš„è¯´æ˜" class="headerlink" title="å†…æ ¸å‚æ•°çš„è¯´æ˜"></a>å†…æ ¸å‚æ•°çš„è¯´æ˜</h2><p>å¯¹äº TCP æ¥è¯´ï¼Œä¼šé‡åˆ°å¦‚ä¸‹çš„å‡ ä¸ªå‚æ•°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ä¸€ä¸‹å½“å‰OSå†…ä¸tcpç›¸å…³çš„ KernelParamï¼Œ å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">sysctl</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"rmem|wmem|tcp_mem|adv_win|moderate"</span></code></pre>

<p>å…¶ä¸­ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯:</p>
<pre class="language-none"><code class="language-none">net.ipv4.tcp_rmem &#x3D; 4096	131072	6291456
net.ipv4.tcp_wmem &#x3D; 4096	16384	4194304</code></pre>

<p>è¿™ä¸¤ä¸ªå‚æ•°å…¶å®è¡¨ç¤ºçš„æ˜¯å½“å‰å†…æ ¸é¢„ç•™çš„ Socket Bufferï¼Œ å•ä½æ˜¯Bytesï¼Œ ä¹Ÿæ˜¯å…·ä½“æŒ‡ å†…å­˜ çš„å¤§å°ã€‚å…·ä½“çš„è¯´æ˜æˆ‘æ‰¾åˆ° <a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">Kernelæ–‡æ¡£çš„è¯´æ˜</a>å¦‚ä¸‹ï¼š</p>
<blockquote>
<pre class="language-none"><code class="language-none">tcp_rmem - vector of 3 INTEGERs: min, default, max
  min: Minimal size of receive buffer used by TCP sockets.
  It is guaranteed to each TCP socket, even under moderate memory
  pressure.
  Default: 4K

  default: initial size of receive buffer used by TCP sockets.
  This value overrides net.core.rmem_default used by other protocols.
  Default: 87380 bytes. This value results in window of 65535 with
  default setting of tcp_adv_win_scale and tcp_app_win:0 and a bit
  less for default tcp_app_win. See below about these variables.

  max: maximal size of receive buffer allowed for automatically
  selected receiver buffers for TCP socket. This value does not override
  net.core.rmem_max.  Calling setsockopt() with SO_RCVBUF disables
  automatic tuning of that socket&#39;s receive buffer size, in which
  case this value is ignored.
  Default: between 87380B and 6MB, depending on RAM size.
  
tcp_wmem - vector of 3 INTEGERs: min, default, max
  min: Amount of memory reserved for send buffers for TCP sockets.
  Each TCP socket has rights to use it due to fact of its birth.
  Default: 4K

  default: initial size of send buffer used by TCP sockets.  This
  value overrides net.core.wmem_default used by other protocols.
  It is usually lower than net.core.wmem_default.
  Default: 16K

  max: Maximal amount of memory allowed for automatically tuned
  send buffers for TCP sockets. This value does not override
  net.core.wmem_max.  Calling setsockopt() with SO_SNDBUF disables
  automatic tuning of that socket&#39;s send buffer size, in which case
  this value is ignored.
  Default: between 64K and 4MB, depending on RAM size.
</code></pre>
</blockquote>
<p>è¿™æ–‡æ¡£ä¸­çš„è¯´æ˜ï¼Œé»˜è®¤çš„ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯ï¼š æœ€å°ï¼Œ é»˜è®¤ï¼Œ æœ€å¤§ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œ å¦‚æœåªæ˜¯éœ€è¦å®é™…è°ƒæ•´çš„è¯ï¼Œ è°ƒæ•´é‚£ä¸ªæœ€å¤§å€¼å³å¯ï¼Œ åœ¨é«˜å»¶è¿Ÿçš„é“¾è·¯ä¸­ï¼Œ è°ƒæ•´é»˜è®¤å€¼æˆ–è€…æœ€å¤§å€¼å°±å¯ä»¥ç”Ÿæ•ˆã€‚ åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œ å°†ä¸‰ä¸ªå€¼éƒ½å›ºå®šåˆ°é¢„æœŸï¼Œæ§åˆ¶å˜é‡ã€‚</p>
<p>å¯¹äºTCPåè®®çš„æ¥æ”¶ä¸å‘é€ä¸¤æ–¹ï¼Œ å„è‡ªæœ‰è‡ªå·±çš„ RecvBuffer å’Œ SendBufferï¼Œ å‘é€æ–¹ä¼šè€ƒè™‘é“¾è·¯ä¸Šé¢å¯ä»¥æ‰¿è½½çš„æ•°æ®é‡ï¼ˆå¸¦å®½ï¼‰ï¼Œ ä»¥åŠ å¯¹æ–¹å¯ä»¥æ‰¿è½½çš„æ•°æ®é‡ï¼ˆrmemï¼‰ã€‚</p>
<p>å®é™…ä¸Šï¼Œ åªæ˜¯æ›´æ–° max çš„å€¼ï¼Œ å¹¶ä¸ä¼šæ›´æ–° Recvbuffer.<br>å¦‚æœæƒ³å¢å¤§ receive buffer çš„å¤§å°, å¯ä»¥å¢åŠ  tcp_rmem çš„ default çš„å€¼å¤§å°.</p>
<h2 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h2><p>ä¸¤ä¸ª EC2 c5.2xlargeï¼Œ å…¶ä¸­ä¸€ä¸ªéƒ¨ç½² Nginx ï¼Œ å¹¶ä½¿ç”¨å¦‚ä¸‹é…ç½®æ–‡ä»¶éƒ¨åˆ†è®¾ç½® ,  å‘å¸ƒä¸€ä¸ª Fedora ISOï¼Œ å¤§å°å¤§çº¦ 2Gã€‚å¦ä¸€ä¸ªä¸Šé¢åªæ˜¯å®¢æˆ·ç«¯ï¼Œ ä½¿ç”¨çš„è®¿é—®å®¢æˆ·ç«¯æ˜¯Curlã€‚</p>
<pre class="language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
      <span class="token directive"><span class="token keyword">autoindex</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">autoindex_localtime</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å…¶ä»–éƒ¨åˆ†å°±çœç•¥å§ã€‚</code></pre>

<h2 id="æµ‹è¯•å‡†å¤‡"><a href="#æµ‹è¯•å‡†å¤‡" class="headerlink" title="æµ‹è¯•å‡†å¤‡"></a>æµ‹è¯•å‡†å¤‡</h2><p>æµ‹è¯•çš„è¿‡ç¨‹å…¶å®æ¶‰åŠäº†å››ä¸ªéƒ¨åˆ†çš„ å»¶è¿Ÿ é—®é¢˜:</p>
<ul>
<li>å‘é€æ–¹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</li>
<li>å‘é€æ–¹çš„å‘é€ç¼“å†²åŒºå¤§å°ï¼Œ SendBuffer</li>
<li>æ¥æ”¶æ–¹çš„æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼Œ RecvBuffer</li>
<li>æ¥æ”¶æ–¹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</li>
</ul>
<p>è°ƒæ•´å»¶è¿Ÿå’Œæ§åˆ¶å¸¦å®½ ï¼Œ è¿™ä¸¤ä¸ªéƒ¨åˆ†æ§åˆ¶çš„éƒ½æ˜¯ç½‘ç»œä¼ è¾“éƒ¨åˆ†çš„æ€§èƒ½ï¼Œæµ‹è¯•çš„è¿‡ç¨‹ä¸­é»˜è®¤è®¤ä¸º å‘é€ ä»¥åŠæ¥æ”¶æ–¹çš„æ€§èƒ½éƒ½å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚</p>
<h3 id="åŸºå‡†"><a href="#åŸºå‡†" class="headerlink" title="åŸºå‡†"></a>åŸºå‡†</h3><p>ä¸¤ä¸ªæœºå™¨çš„å†…æ ¸å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼Œ å…ˆé€šè¿‡ tc æµé‡æ§åˆ¶æ³¨å…¥ä¸€äº›å»¶è¿Ÿï¼Œ æŸ¥çœ‹å¹¶åˆ†æRTTå¯¹äºä¼ è¾“é€Ÿåº¦çš„å½±å“ã€‚</p>
<p>ä¸¤ä¸ªserverä¹‹é—´é»˜è®¤çš„å†…æ ¸å‚æ•°ï¼š</p>
<ul>
<li><p>æœåŠ¡ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">16384</span>	<span class="token number">4194304</span></code></pre>
</li>
<li><p>å®¢æˆ·ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">16384</span>	<span class="token number">4194304</span></code></pre></li>
</ul>
<p>curl çš„ æµ‹è¯•å‘½ä»¤ å¦‚ä¸‹ï¼šï¼ˆæ›´æ–°ç‰ˆæœ¬ï¼Œ ä¹‹å‰çš„æµ‹è¯•ç‰ˆæœ¬å°‘äº†ä¸€äº›å‚æ•° </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">curl</span> <span class="token parameter variable">-o</span> /dev/null <span class="token parameter variable">-s</span> <span class="token parameter variable">-w</span> <span class="token string">"time_namelookup:%&#123;time_namelookup&#125;<span class="token entity" title="\n">\n</span>time_connect: %&#123;time_connect&#125;<span class="token entity" title="\n">\n</span>time_appconnect: %&#123;time_appconnect&#125;<span class="token entity" title="\n">\n</span>time_redirect:  %&#123;time_redirect&#125;<span class="token entity" title="\n">\n</span>time_pretransfer:  %&#123;time_pretransfer&#125;<span class="token entity" title="\n">\n</span>time_starttransfer: %&#123;time_starttransfer&#125;<span class="token entity" title="\n">\n</span>time_total: %&#123;time_total&#125;<span class="token entity" title="\n">\n</span>"</span>  http://nginx.liarlee.site/Fedora-Workstation-Live-x86_64-38_Beta-1.3.iso </code></pre>

<p>å¦‚æœä½¿ç”¨é»˜è®¤çš„å‚æ•°ï¼Œ é‚£ä¹ˆ2Gçš„ ISO æ–‡ä»¶å¯ä»¥å¿«é€Ÿçš„ä¼ å®Œï¼Œ è¿™æ˜¯ä¸¤ä¸ªå®ä¾‹çš„åŸºå‡†è¡¨ç°ï¼Œ è¿™ä¹Ÿæ˜¯åˆ›å»ºäº†ä¸€ä¸ªTCP Connection çš„è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œ EC2 ä¹‹é—´çš„å¸¦å®½è¾ƒå¤§ 10Gbpsã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span> --:--:-- --:--:-- --:--:--     <span class="token number">0</span>*   
Trying <span class="token number">172.31</span>.48.133:80<span class="token punctuation">..</span>.
<span class="token number">100</span> 1967M  <span class="token number">100</span> 1967M    <span class="token number">0</span>     <span class="token number">0</span>  1116M      <span class="token number">0</span>  <span class="token number">0</span>:00:01  <span class="token number">0</span>:00:01 --:--:-- 1116M
* Connection <span class="token comment">#0 to host nginx.liarlee.site left intact</span>
time_connect: <span class="token number">0.005461</span>
time_starttransfer: <span class="token number">0.005797</span>
time_total: <span class="token number">1.762040</span></code></pre>

<p>æ€»ä½“çœ‹èµ·æ¥ä½¿ç”¨äº† 2s ä¸åˆ°çš„æ—¶é—´ï¼Œ å°±ä¼ è¾“å®Œæˆäº†2Gçš„æ–‡ä»¶ã€‚</p>
<h3 id="ä»…æ§åˆ¶å¸¦å®½"><a href="#ä»…æ§åˆ¶å¸¦å®½" class="headerlink" title="ä»…æ§åˆ¶å¸¦å®½"></a>ä»…æ§åˆ¶å¸¦å®½</h3><p>åœ¨æ·»åŠ äº†å¸¦å®½ æ§åˆ¶ï¼Œ å¸¦å®½æ§åˆ¶åœ¨ 1000Mbpsï¼Œ å¸¦å®½ç›‘æ§ç»“æœï¼š </p>
<p><img src="https://s2.loli.net/2023/04/14/ZVxCb43c2Wynaze.png" alt="2023-04-12_17-03.png"></p>
<p>Curlå‘½ä»¤çš„ç»“æœï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> 1967M  <span class="token number">100</span> 1967M    <span class="token number">0</span>     <span class="token number">0</span>   118M      <span class="token number">0</span>  <span class="token number">0</span>:00:16  <span class="token number">0</span>:00:16 --:--:--  118M
time_connect: <span class="token number">0.002070</span>
time_starttransfer: <span class="token number">0.002304</span>
time_total: <span class="token number">16.633562</span></code></pre>

<p>åœ¨ä»…ä»…æ§åˆ¶å¸¦å®½çš„å‰æä¸‹ï¼Œ ç”±äºå»¶è¿Ÿå¿½ç•¥ä¸è®¡ï¼Œ æ‰€ä»¥ä¼ è¾“çš„æ•°æ®é‡å¯ä»¥ä½¿ç”¨å…¨éƒ¨çš„å¸¦å®½ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹é¢<strong>ä¼ è¾“çš„é€Ÿåº¦å–å†³äºç½‘ç»œå¸¦å®½çš„å¤§å°</strong>ï¼Œ ç½‘ç»œå¸¦å®½è¶Šå¤§ï¼Œ ä¼ è¾“çš„æ•°æ®é‡å’Œé€Ÿåº¦éƒ½ä¼šç›¸åº”çš„å¢åŠ ã€‚</p>
<h3 id="æ§åˆ¶å¸¦å®½-å»¶è¿Ÿ"><a href="#æ§åˆ¶å¸¦å®½-å»¶è¿Ÿ" class="headerlink" title="æ§åˆ¶å¸¦å®½+å»¶è¿Ÿ"></a>æ§åˆ¶å¸¦å®½+å»¶è¿Ÿ</h3><p>ç»™æœåŠ¡ç«¯æ·»åŠ ä¸€ä¸ª 50ms çš„ å»¶è¿Ÿï¼Œ ä½¿ç”¨ tc å·¥å…·ï¼Œ <a href="https://zhuanlan.zhihu.com/p/443427232">å‚è€ƒæ–‡æ¡£</a>ï¼Œ å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">tc qdisc del dev eth0 root
tc qdisc <span class="token function">add</span> dev eth0 root handle <span class="token number">1</span>:0 htb default <span class="token number">1</span>
tc class <span class="token function">add</span> dev eth0 parent <span class="token number">1</span>:0 classid <span class="token number">1</span>:1 htb rate 1000mbit
tc qdisc <span class="token function">add</span> dev eth0 parent <span class="token number">1</span>:1 handle <span class="token number">2</span>:0 netem delay 50ms</code></pre>

<p>æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨curlå‘½ä»¤ï¼Œ å°†ç»“æœç›´æ¥è¾“å‡ºåˆ° &#x2F;dev&#x2F;null, è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œ å®¢æˆ·ç«¯æ”¶å†™æ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè¿™æ ·çš„æµ‹è¯•æ’é™¤äº†å¤§æ–‡ä»¶è½ç¡¬ç›˜é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œ ä½†æ˜¯ä¹Ÿè®©å®¢æˆ·ç«¯æ”¶åˆ°è¿™æ‰¹æ•°æ®ä¹‹åç«‹åˆ»å¯ä»¥å‘é€ackç»™æœåŠ¡ç«¯ï¼ˆClient - ACKâ€”â€”&gt; Serverï¼‰ï¼Œ å‘ŠçŸ¥æœåŠ¡ç«¯æˆ‘è¿™è¾¹çš„æ•°æ®å·²ç»å¤„ç†å®Œäº†ï¼Œ å›æ”¶ RecvBuffer ç©ºé—´.</p>
<p>åœ¨æ·»åŠ å¸¦å®½æ§åˆ¶å’Œ 50ms å»¶è¿Ÿä¹‹åï¼Œ å¸¦å®½ä½¿ç”¨ï¼š<br><img src="https://s2.loli.net/2023/04/14/wS7UK5IQWLMd2TG.png" alt="2023-04-12_17-03_1.png"></p>
<p>ping å‘½ä»¤ ç¡®è®¤ rtt ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@arch ~<span class="token comment"># ping nginx.liarlee.site</span>
PING nginx.liarlee.site <span class="token punctuation">(</span><span class="token number">172.31</span>.48.133<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from ip-172-31-48-133.cn-north-1.compute.internal <span class="token punctuation">(</span><span class="token number">172.31</span>.48.133<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">255</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">50.1</span> ms
<span class="token number">64</span> bytes from ip-172-31-48-133.cn-north-1.compute.internal <span class="token punctuation">(</span><span class="token number">172.31</span>.48.133<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">255</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">50.1</span> ms
<span class="token number">64</span> bytes from ip-172-31-48-133.cn-north-1.compute.internal <span class="token punctuation">(</span><span class="token number">172.31</span>.48.133<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">255</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">50.1</span> ms
^C
--- nginx.liarlee.site <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 2003ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">50.110</span>/50.117/50.132/0.010 ms</code></pre>

<p>curlçš„ç»“æœå˜æˆè¿™æ ·ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> 1967M  <span class="token number">100</span> 1967M    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">38</span>.7M      <span class="token number">0</span>  <span class="token number">0</span>:00:50  <span class="token number">0</span>:00:50 --:--:-- <span class="token number">39</span>.2M
time_connect: <span class="token number">0.053118</span>
time_starttransfer: <span class="token number">0.103339</span>
time_total: <span class="token number">50.756470</span></code></pre>

<p>é“¾è·¯çš„å¸¦å®½æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨ï¼Œ æ‰€ä»¥å‘é€æ•°æ®çš„é€Ÿåº¦å·²ç»æ…¢å¾ˆå¤šï¼Œå¹¶ä¸”æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ã€‚</p>
<p>åœ¨æœ‰å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œ å‘é€æ–¹ä¼šæŒ‰ç…§æ¥æ”¶çš„çª—å£è¿›è¡Œé…ç½®ã€‚</p>
<h3 id="åŠ å…¥éšæœºå»¶è¿Ÿ"><a href="#åŠ å…¥éšæœºå»¶è¿Ÿ" class="headerlink" title="åŠ å…¥éšæœºå»¶è¿Ÿ"></a>åŠ å…¥éšæœºå»¶è¿Ÿ</h3><pre class="language-bash" data-language="bash"><code class="language-bash">tc qdisc <span class="token function">add</span> dev eth0 root netem delay 100ms 10ms <span class="token comment"># ä¸Šä¸‹æµ®åŠ¨ 10ms</span>
tc qdisc <span class="token function">add</span> dev eth0 root netem delay 100ms 10ms <span class="token number">30</span>% <span class="token comment"># 30% æ•°æ®åŒ…ä¼šæµ®åŠ¨ï¼Œ å…¶ä»–ç¨³å®š</span></code></pre>

<h3 id="åŠ å…¥ä¸¢åŒ…"><a href="#åŠ å…¥ä¸¢åŒ…" class="headerlink" title="åŠ å…¥ä¸¢åŒ…"></a>åŠ å…¥ä¸¢åŒ…</h3><p>tcå­ç³»ç»Ÿå¯ä»¥åœ¨ç½‘å¡ä¸Šé¢ç›´æ¥æ§åˆ¶ä¸¢åŒ…çš„ç™¾åˆ†æ¯”ï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">tc qdisc <span class="token function">add</span> dev eth0 root netem loss <span class="token number">1</span>% <span class="token comment"># éšæœºä¸¢ 1%</span>
tc qdisc change dev eth0 root netem delay 100ms 20ms distribution normal <span class="token comment"># æ¨¡æ‹Ÿé‡å¤æ•°æ®åŒ…</span>
tc qdisc change dev eth0 root netem corrupt <span class="token number">0.1</span>% <span class="token comment"># æ¨¡æ‹Ÿæ•°æ®åŒ…é”™è¯¯ï¼Œ æŸåï¼Œ æŸåç‡ 1%</span>
tc qdisc change dev eth0 root netem gap <span class="token number">5</span> delay 10ms  <span class="token comment"># æ¨¡æ‹Ÿæ•°æ®åŒ…ä¹±åº.è§„å¾‹çš„ä¹±åºï¼Œ 5å€æ•°çš„åŒ…å‡†æ—¶å‘ï¼Œå…¶ä»–å»¶è¿Ÿ 10ms</span>
tc qdisc change dev eth0 root netem delay 10ms reorder <span class="token number">25</span>% <span class="token number">50</span>% <span class="token comment"># éšæœºä¹±åºï¼Œ 25% å‡†æ—¶ï¼Œ å…¶ä»–å»¶è¿Ÿ 10msï¼Œ Relate 50%</span></code></pre>

<h3 id="é…ç½®åˆ°ç‰¹å®šIPåœ°å€çš„æµæ§"><a href="#é…ç½®åˆ°ç‰¹å®šIPåœ°å€çš„æµæ§" class="headerlink" title="é…ç½®åˆ°ç‰¹å®šIPåœ°å€çš„æµæ§"></a>é…ç½®åˆ°ç‰¹å®šIPåœ°å€çš„æµæ§</h3><p>æœ‰çš„æ—¶å€™æ•…æ„æµ‹è¯•éå¸¸å¥‡æ€ªçš„åœºæ™¯ï¼Œ å¦‚æœåŠ åœ¨ethä¸Šé¢å°±ä¼šå¾ˆå¥‡æ€ªï¼Œ æ•´ä½“çš„æµé‡éƒ½è¢«å½±å“äº†ï¼Œ é‚£ä¹ˆæœ€ç®€å•çš„è®¾ç½®å°±æ˜¯é™åˆ¶ä¸€ä¸‹ç”Ÿæ•ˆçš„èŒƒå›´ï¼š </p>
<p>æŒ‡å®šIPåœ°å€å»¶è¿Ÿ17ms</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">tc qdisc del dev eth0 root
tc qdisc <span class="token function">add</span> dev eth0 root handle <span class="token number">1</span>: prio
tc filter <span class="token function">add</span> dev eth0 parent <span class="token number">1</span>:0 protocol <span class="token function">ip</span> pref <span class="token number">55</span> handle ::55 u32 match <span class="token function">ip</span> dst <span class="token number">172.31</span>.65.30 flowid <span class="token number">2</span>:1
tc qdisc <span class="token function">add</span> dev eth0 parent <span class="token number">1</span>:1 handle <span class="token number">2</span>: netem delay 17ms
<span class="token comment">####### ï¼ ï¼ ï¼ ï¼ ï¼ ï¼ ï¼ ï¼ ï¼ </span>
è¿™ä¸ªåœ¨å®¹å™¨çš„ç½‘æ¡¥ä¸Šé¢ä¸ç”Ÿæ•ˆ<span class="token punctuation">..</span><span class="token punctuation">..</span>. éº» ï¼ ï¼ 
ç›´æ¥è®¾ç½®åœ¨å®¿ä¸»æœºçš„eth0ä¸Šé¢æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œ åœ¨å®¿ä¸»æœºçš„ç½‘æ¡¥ä¸Šé¢åº”è¯¥æ˜¯ç½‘æ¡¥è®¾å¤‡ä¸æ”¯æŒå§ã€‚</code></pre>

<p>æŒ‡å®šIPåœ°å€å’Œç«¯å£è§¦å‘å»¶è¿Ÿ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">è¿™ä¸ªå¤ªéš¾äº† æˆ‘ä¸ä¼š ï¼Œ åé¢åœ¨çœ‹å§ï¼Œ æ„Ÿè§‰æš‚æ—¶ç”¨ä¸åˆ°ï¼Œ é™åˆ¶åˆ°IPåœ°å€å°±å¯ä»¥äº†ã€‚</code></pre>

<h2 id="ç†è®ºè¯´æ˜ä»¥åŠåç»­æµ‹è¯•"><a href="#ç†è®ºè¯´æ˜ä»¥åŠåç»­æµ‹è¯•" class="headerlink" title="ç†è®ºè¯´æ˜ä»¥åŠåç»­æµ‹è¯•"></a>ç†è®ºè¯´æ˜ä»¥åŠåç»­æµ‹è¯•</h2><p>å¦‚æœæˆ‘çš„ç½‘ç»œå»¶è¿Ÿå°åˆ°å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å‘é€æ–¹ç¼“å†²åŒºé‡Œé¢çš„æ•°æ®åŸºæœ¬ä¸Šå°±æ˜¯å®æ—¶æŠµè¾¾å¯¹æ–¹ï¼Œ å¹¶ä¸”ç«‹åˆ»å¯ä»¥æ¥æ”¶åˆ°å¯¹æ–¹çš„ACKæŠ¥æ–‡ï¼Œ è¿™æ ·æ— è®ºæˆ‘çš„å‘é€å’Œæ¥æ”¶çš„Bufferæœ‰å¤šå°æˆ–è€…å¤šå¤§éƒ½æ— æ‰€è°“ï¼Œ æ•°æ®åŒ…éƒ½å¯ä»¥å¿«é€Ÿçš„å‘é€å‡ºå»ï¼Œ ç„¶åè¢«ç¡®è®¤æ”¶åˆ°ã€‚</p>
<p>åœ¨æ·»åŠ äº†ç½‘ç»œçš„å»¶è¿Ÿä¹‹åï¼Œ 50msï¼Œ é‚£ä¹ˆè¿™ä¸ªæ—¶å€™é“¾è·¯ä¸Šé¢å¯ä»¥æ‰¿è½½çš„æ•°æ®åŒ…è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>1000Mbps&#x2F;8 * 0.05s (rtt)&#x3D; 6.25MB # BDP å¸¦å®½å»¶æ—¶ç§¯</p>
<p>6.25MB * 1024 &#x3D; 6400KB * 1024 &#x3D; 6553600 Bytes</p>
<p>6553600 * 2 &#x3D; 13107200 # è¿™ä¸ªæ˜¯linux kernel buffer size </p>
</blockquote>
<p>åœ¨è¿™ä¸ªæµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œ æ•°æ®å‘é€æ–¹çš„é€šå‘Šçš„window sizeï¼Œ å›ºå®šæ˜¯ tcp_rmem å€¼çš„ä¸€åŠã€‚ å‘ç°è¿™ä¸ªæ˜¯ BDP è®¡ç®—å‡ºæ¥çš„ç»“æœæ˜¯ 6553600ï¼Œ å¦‚æœè¿™ä¸ªå€¼ç›´æ¥é…ç½®åˆ°tcp_rmemä¸­ï¼ŒæŠ“åŒ…å‡ºæ¥windowsizeå°±æ­£å¥½æ˜¯é¢„æœŸçš„ä¸€åŠï¼Œ è¿™ä¼šå¯¼è‡´é™å®šçš„åƒå…†å¸¦å®½æ­£å¥½å ç”¨500Mbpsã€‚</p>
<p>buffersize è®¾ç½®æˆäº† 2å€ çš„ æ¥æ”¶çª—å£çš„åŸå› æ˜¯ï¼š   Linux Kernel çš„å‚æ•° <code>net.ipv4.tcp_adv_win_scale = 1</code>ï¼Œ <a href="https://docs.kernel.org/networking/ip-sysctl.html?highlight=tcp_adv_win_scale">å†…æ ¸æ–‡æ¡£</a>ä¸­çš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<pre class="language-none"><code class="language-none">tcp_adv_win_scale - INTEGER

    Count buffering overhead as bytes&#x2F;2^tcp_adv_win_scale (if tcp_adv_win_scale &gt; 0) or bytes-bytes&#x2F;2^(-tcp_adv_win_scale), if it is &lt;&#x3D; 0.
    Possible values are [-31, 31], inclusive.
    Default: 1</code></pre>

<p>ç”±äºè¿™ä¸ªå€¼ å½“å‰çš„ä¸»æµç‰ˆæœ¬å¯èƒ½éƒ½æ˜¯1 ï¼Œ æ‰€ä»¥é»˜è®¤ä¼šç”¨ä¸€åŠçš„rmemç©ºé—´æ¥é€šå‘Šè‡ªå·±çš„æ¥æ”¶çª—å£å¤§å°ï¼Œä½†æ˜¯è¿™å‚æ•°çš„å–å€¼èŒƒå›´å†™çš„æ˜¯ -31 åˆ° 31 ï¼Œ ä½†æ˜¯å¤§éƒ¨åˆ†å†™çš„éƒ½æ˜¯  1 0  -1 è¿™ä¸‰ä¸ªå€¼ï¼Œ æ„Ÿè§‰ç½‘ç»œä¸Šé¢ç›®å‰æ²¡æœ‰æ­£ç¡®ç­”æ¡ˆå‘¢ï¼Ÿ<br><a href="https://unix.stackexchange.com/questions/94770/what-does-net-ipv4-tcp-app-win-do">https://unix.stackexchange.com/questions/94770/what-does-net-ipv4-tcp-app-win-do</a><br><a href="https://emacsist.github.io/2019/07/13/linux%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0/">https://emacsist.github.io/2019/07/13/linux%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0/</a></p>
<h3 id="æµ‹è¯•1-å¢åŠ å®¢æˆ·ç«¯çš„-Rmem"><a href="#æµ‹è¯•1-å¢åŠ å®¢æˆ·ç«¯çš„-Rmem" class="headerlink" title="æµ‹è¯•1 å¢åŠ å®¢æˆ·ç«¯çš„ Rmem"></a>æµ‹è¯•1 å¢åŠ å®¢æˆ·ç«¯çš„ Rmem</h3><ul>
<li><p>æœåŠ¡ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">16384</span>	<span class="token number">4194304</span></code></pre>
</li>
<li><p>å®¢æˆ·ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">13107200</span> <span class="token number">13107200</span> <span class="token number">13107200</span></code></pre></li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒæ•´è¿™ä¸ªçš„é…ç½®æ¥è§‚å¯Ÿå¸¦å®½ä»¥åŠä¼ è¾“é€Ÿåº¦çš„å·®å¼‚ã€‚</p>
<p>å¸¦å®½ä½¿ç”¨é‡ï¼š<br><img src="https://s2.loli.net/2023/04/14/m2xVd145LXgvhCs.png" alt="2023-04-12_17-39.png"></p>
<p>curl çš„ç»“æœï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> 1967M  <span class="token number">100</span> 1967M    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">53</span>.0M      <span class="token number">0</span>  <span class="token number">0</span>:00:37  <span class="token number">0</span>:00:37 --:--:-- <span class="token number">53</span>.5M
time_connect: <span class="token number">0.053408</span>
time_starttransfer: <span class="token number">0.103699</span>
time_total: <span class="token number">37.118881</span></code></pre>

<h3 id="æµ‹è¯•2-å¢åŠ æœåŠ¡ç«¯çš„-Wmem"><a href="#æµ‹è¯•2-å¢åŠ æœåŠ¡ç«¯çš„-Wmem" class="headerlink" title="æµ‹è¯•2 å¢åŠ æœåŠ¡ç«¯çš„ Wmem"></a>æµ‹è¯•2 å¢åŠ æœåŠ¡ç«¯çš„ Wmem</h3><ul>
<li><p>æœåŠ¡ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">13107200</span> <span class="token number">13107200</span> <span class="token number">13107200</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">16384</span>	<span class="token number">4194304</span> </code></pre>
</li>
<li><p>å®¢æˆ·ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">13107200</span> <span class="token number">13107200</span> <span class="token number">13107200</span></code></pre></li>
</ul>
<p>å¸¦å®½çš„ç»“æœï¼š </p>
<p><img src="https://s2.loli.net/2023/04/14/85zygfpMBRnha19.png" alt="2023-04-12_17-47.png"></p>
<p>curl çš„ç»“æœï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span> 1967M  <span class="token number">100</span> 1967M    <span class="token number">0</span>     <span class="token number">0</span>   115M      <span class="token number">0</span>  <span class="token number">0</span>:00:17  <span class="token number">0</span>:00:17 --:--:--  118M
time_connect: <span class="token number">0.052605</span>
time_starttransfer: <span class="token number">0.102836</span>
time_total: <span class="token number">17.007612</span></code></pre>

<p>ä»å½“å‰çš„ç»“æœæ¥çœ‹ï¼Œ ç°åœ¨å·²ç»å¯ä»¥ç”¨æ»¡å…¨éƒ¨çš„å¸¦å®½äº†ï¼Œ æŸ¥çœ‹æŠ“åŒ…çš„ç»“æœï¼Œ å‘é€å’Œæ¥æ”¶æ•°æ®éå¸¸è¿ç»­ã€‚ ä¸­é—´çš„åœé¡¿æ—¶é—´ä¹Ÿæ¯”è¾ƒçŸ­ã€‚</p>
<p>å¦‚å›¾ï¼š</p>
<p><img src="https://s2.loli.net/2023/04/14/iey2OWk1FKHYSVg.png" alt="2023-04-12_22-47.png"></p>
<p>è¿™ä¸ªç»“æœæˆ‘è¿˜é‡æ–°åå¤æŠ“äº†å‡ æ¬¡ï¼Œè¿™ä¸ªå¯ä»¥è·‘æ»¡å¸¦å®½ å¹¶ä¸”å¯ä»¥é¡¶ä½ 50ms å»¶è¿Ÿã€‚</p>
<p>TCPæ…¢å¯åŠ¨æ—¶å€™çš„æˆªå›¾ï¼š</p>
<p>æˆ‘å°†å‡ ä¸ªå­—æ®µæå–äº†å‡ºæ¥ï¼Œæ”¾åœ¨äº†æˆªå›¾çš„æœ€å‰é¢ï¼Œ iRTTï¼Œ WindowSizeï¼Œ Bytes in flightã€‚ å¯¹äºè¿™ä¸ªç»“æœé‡Œé¢ï¼Œ æˆ‘çš„å®¢æˆ·ç«¯çª—å£çš„å˜åŒ–éå¸¸å°ï¼Œä¼ è¾“çš„ååŠæ®µ ä¼šä¸€ç›´ç»´æŒåœ¨æœ€å¤§å€¼ï¼Œ ä½†æ˜¯Bytes in flight ä¸€ç›´éƒ½å¾ˆå°ï¼Œ å¤§æ¦‚å°±æ˜¯ 30000 + çš„æ ·å­ã€‚ </p>
<blockquote>
<p>åŸå› æ˜¯ç”±äºcurlåœ¨è·å–åˆ°æ•°æ®åŒ…ä¹‹åå¿«é€Ÿçš„ackäº†æ”¶åˆ°çš„åŒ…ï¼Œ ç„¶åå‘æœåŠ¡ç«¯æ›´æ–°äº†æ¥æ”¶çª—å£ï¼Œ ç”±äºcurlçš„åŠ¨ä½œå¤ªå¿«äº†ï¼Œ æ‰€ä»¥æˆ‘çš„ Bytes in flight éå¸¸å°ï¼Œçª—å£ä¸€ç›´åœ¨è¢«æ›´æ–°ï¼Œ æ‰€ä»¥çª—å£çš„å°ºå¯¸éå¸¸å¤§ï¼Œ è€Œä¸”ç¨³å®šã€‚NOTEï¼š è¿™ä¸ªé€»è¾‘çš„è¯æ®æ˜¯ï¼š  æµ‹è¯•4ï¼Œ è®©curlæ²¡æœ‰æ—¶é—´æ”¶å–æ•°æ®åŒ…ã€‚<br><img src="https://s2.loli.net/2023/04/14/8KWyBIgZTQC4GVN.png" alt="2023-04-12_23-10.png"></p>
</blockquote>
<p>æˆªå–äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ç¨³å®šä¼ è¾“ä¸­çš„æŠ“åŒ…ç»“æœï¼Œ å¦‚å›¾ï¼š<br><img src="https://s2.loli.net/2023/04/14/qRGDdPh3pubUiZz.png" alt="2023-04-12_23-17.png"></p>
<p>ç¨³å®šä¼ è¾“ä¸­åŸºæœ¬ä¸Šæ˜¯æœ‰ç©ºé—´ï¼Œ æ”¶åˆ°ä¹‹å‰çš„ack å°±ç«‹åˆ»å‘é€æ–°çš„åˆ°é“¾è·¯ä¸­.</p>
<h3 id="æµ‹è¯•3-é”å®š-Wmem-ä»¥åŠ-Rmem-4096"><a href="#æµ‹è¯•3-é”å®š-Wmem-ä»¥åŠ-Rmem-4096" class="headerlink" title="æµ‹è¯•3 é”å®š Wmem ä»¥åŠ Rmem 4096"></a>æµ‹è¯•3 é”å®š Wmem ä»¥åŠ Rmem 4096</h3><ul>
<li><p>æœåŠ¡ç«¯å‚æ•°  </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span> <span class="token number">4096</span> <span class="token number">4096</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">16384</span>	<span class="token number">4194304</span> </code></pre>
</li>
<li><p>å®¢æˆ·ç«¯å‚æ•°</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span>	<span class="token number">131072</span>	<span class="token number">6291456</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">4096</span> <span class="token number">4096</span> <span class="token number">4096</span></code></pre></li>
</ul>
<ol>
<li><p>åŒæ—¶è®¾å®šä¸¤ç«¯å‚æ•°ï¼Œè®¾ç½®ç”Ÿæ•ˆä¹‹åï¼Œ é€Ÿåº¦å˜å¾—éå¸¸çš„æ…¢ï¼Œ æ•°æ®åŒ…åŸºæœ¬ä¸Šå‘ä¸€ä¸¤ä¸ªå°±ä¼šè§¦å‘ WindowFull çš„æç¤ºã€‚æ”¹å®¢æˆ·ç«¯çš„rmemå‚æ•°ï¼Œ ä¼šå¯¼è‡´ rmem çš„å®¹é‡ä¸å¤Ÿå¤§ï¼Œ é¢‘ç¹çš„è§¦å‘ WindowFullï¼Œ çª—å£å¾ˆå¿«å°±è¢«å¡«å……æ»¡äº†ï¼Œ æ‰€ä»¥curlçš„ä¸‹è½½é€Ÿåº¦ä¹Ÿéå¸¸æ…¢ã€‚</p>
<p><img src="https://s2.loli.net/2023/04/14/MHEsand1wvK7yIc.png" alt="2023-04-13_00-20.png"></p>
</li>
<li><p>å®¢æˆ·ç«¯å‚æ•°ä¸åŠ¨ï¼Œ åªæ˜¯æ”¹æœåŠ¡ç«¯çš„wmemå‚æ•°é™åˆ¶åˆ° 4096ï¼Œ ä¼ è¾“é€Ÿåº¦å¿«äº†ä¸€äº›ï¼Œä½†æ˜¯å¼€å§‹çš„æ—¶å€™æ•°æ®åŒ…å‘é€çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œ send-qä¸­çš„æŒ‡æ ‡å¿«é€Ÿè¢«é™ä½ä¸‹æ¥ï¼Œè™½ç„¶é€Ÿåº¦å˜å¿«äº†ä¸€äº›ï¼Œ ä½†æ˜¯ä¸å¤šã€‚<em>æˆ‘æƒ³è¿™ä¸ªåœ°æ–¹è¿˜èƒ½è§‚å¯Ÿä¸€ä¸‹Nginxçš„è¡Œä¸ºï¼Œ åº”ç”¨ç¨‹åºåº”è¯¥ä¹Ÿæ˜¯å˜æ…¢çš„ã€‚</em></p>
</li>
<li><p>æœåŠ¡ç«¯çš„å‚æ•°ä¸åŠ¨ï¼Œ åªæ˜¯æ”¹å®¢æˆ·ç«¯çš„å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™nginxçš„sendbufferé‡Œé¢å †ç§¯äº†è®¸å¤šæ•°æ®ï¼Œå› ä¸ºæ¥æ”¶çš„çª—å£å¤ªå°ï¼Œ æ‰€ä»¥ä¸ä¸Šé¢çš„æˆªå›¾ä¸€æ ·ï¼Œåˆ°å¤„éƒ½æ˜¯ WindowFullã€‚</p>
</li>
</ol>
<h3 id="æµ‹è¯•4-ä¸curlæŠ¢å CPU"><a href="#æµ‹è¯•4-ä¸curlæŠ¢å CPU" class="headerlink" title="æµ‹è¯•4 ä¸curlæŠ¢å CPU"></a>æµ‹è¯•4 ä¸curlæŠ¢å CPU</h3><p>è¿è¡Œå‘½ä»¤ï¼š å¯åŠ¨ä¸€ä¸ªJVMï¼Œ è·‘è®¡ç®—çš„çº¿ç¨‹ï¼Œ è¿™ä¸ªç¨‹åºæ˜¯è‡ªå·±å†™çš„ï¼ŒCPUå¯†é›†å‹ï¼Œ è¿è¡Œèµ·æ¥ä¹‹åå°±å¯ä»¥ä½¿ç”¨ç‡100%ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ taskset <span class="token parameter variable">-c</span> <span class="token number">0</span> <span class="token function">java</span> CPUIntensiveThread <span class="token operator">&amp;</span>
<span class="token comment"># è°ƒæ•´è¿™ä¸ªç¨‹åºçš„niceå€¼ä¸º -20ï¼Œ æˆ‘æ˜¯ç›´æ¥ç”¨htopè°ƒæ•´çš„ã€‚</span>
<span class="token punctuation">]</span>$ taskset <span class="token parameter variable">-c</span> <span class="token number">0</span> ./nginx-tc-traffic-test-curl.sh
<span class="token punctuation">]</span>$ <span class="token function">nice</span> <span class="token parameter variable">-n</span> <span class="token number">19</span> <span class="token function">curl</span> <span class="token parameter variable">-o</span> /dev/null http://nginx.liarlee.site/Fedora-Workstation-Live-x86_64-38_Beta-1.3.iso <span class="token parameter variable">-t</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-w</span> <span class="token string">"time_connect: %&#123;time_connect&#125;<span class="token entity" title="\n">\n</span>time_starttransfer: %&#123;time_starttransfer&#125;<span class="token entity" title="\n">\n</span>time_total: %&#123;time_total&#125;<span class="token entity" title="\n">\n</span>"</span></code></pre>

<p>æµ‹è¯•çš„ç»“æœå¦‚å›¾,  Recv-Qé‡Œé¢ä¸€ç›´æœ‰æ•°æ®ï¼Œ æŠ“åŒ…çš„ç»“æœä¸­æ˜¾ç¤ºå½“å‰çš„æ¥æ”¶ç«¯çš„çª—å£æ˜¯æ»¡çš„ï¼Œ å‡ºç°äº† WindowUpdate ä»¥åŠ ZeroWindowçš„æç¤ºã€‚<br><img src="https://s2.loli.net/2023/04/14/mYAb3qCwOvn1Q8Z.png" alt="2023-04-14_17-09.png"></p>
<p>åŸºæœ¬ä¸Šéšç€çª—å£çš„å˜åŒ–è€Œå˜åŒ–ï¼Œ curlçš„ä¸‹è½½é€Ÿåº¦å¹¶ä¸å¿«ï¼Œ ä¸‹è½½çš„é€Ÿåº¦ä¹Ÿä¸å¤ªç¨³å®šã€‚ã€‚<br><img src="https://s2.loli.net/2023/04/14/KZmte1CzfvIsoLM.png" alt="2023-04-14_17-09_1.png"></p>
<h2 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h2><ol>
<li>å¦‚ä½•è®¡ç®—æ¯ç§’ä¼ è¾“äº†å¤šå°‘MBæ•°æ®ï¼Ÿ</li>
<li>å¯¹äºRecvBuffer æˆ–è€… SendBuffer è¢«å¡«æ»¡çš„æ—¶å€™ï¼Œ åº”ç”¨ç¨‹åºçš„è¡¨ç°æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ æˆ‘çš„ç†è§£æ˜¯ï¼Œåº”è¯¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨writeï¼ˆï¼‰å†™å…¥çš„æ•°æ®åœ¨ SendBuffer æ»¡äº†çš„æƒ…å†µä¸‹ï¼Œ åº”ç”¨ä¼šåœ¨ç­‰å¾…ioçš„çŠ¶æ€ã€‚</li>
<li>wmemçš„å€¼ ä¸ Send-Q ä¸­çš„æ•°å€¼çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ol>
<hr>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://tonydeng.github.io/sdn-handbook/linux/tc.html">https://tonydeng.github.io/sdn-handbook/linux/tc.html</a></p>
<p><a href="https://plantegg.github.io/2016/08/24/Linux%20tc%20qdisc%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/">https://plantegg.github.io/2016/08/24/Linux%20tc%20qdisc%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/</a></p>
<p><a href="https://tldp.org/HOWTO/Traffic-Control-HOWTO/">https://tldp.org/HOWTO/Traffic-Control-HOWTO/</a></p>
<p><a href="https://blog.csdn.net/dog250/article/details/40483627">https://blog.csdn.net/dog250/article/details/40483627</a></p>
<p><a href="https://arthurchiao.art/blog/lartc-qdisc-zh/">https://arthurchiao.art/blog/lartc-qdisc-zh/</a></p>
<p>å…³äºè¿™ä¸ªé—®é¢˜çš„æ›´å¤šè§£é‡Šï¼š </p>
<p>æˆ‘ä¸Šé¢çš„å†…å®¹é‡Œé¢å¯èƒ½æœ‰ä¸€éƒ¨åˆ†å›¾ä¸å¤ªå¥½ï¼š </p>
<p><a href="https://www.kawabangga.com/posts/4794">https://www.kawabangga.com/posts/4794</a></p>
<p>è¿™ä¸ªé‡Œé¢æœ‰æ¯”è¾ƒæ¸…æ™°çš„æè¿°ï¼Œ ä¾‹å¦‚å›¾é‡Œé¢çš„æ¯æ¡çº¿æ˜¯åšä»€ä¹ˆçš„ï¼Œ å…¶å®åº”è¯¥çœ‹çš„æ˜¯ tcptrace ä¸æ˜¯ steven è¿™ä¸ªå›¾ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Network</tag>
      </tags>
  </entry>
  <entry>
    <title>è£è€€8-åˆ·LineageOS14.1ç®€è¿°</title>
    <url>/2018/07/08/Other/Android_Honor8InstallLineageOS/</url>
    <content><![CDATA[<p>è£è€€8åˆ·LineageOS 14.1 , æ„Ÿè°¢XDAçš„å¤§ç¥ä»¬ã€‚ç”¨åˆ°çš„åˆ·æœºåŒ…æˆ‘è½¬å­˜äº†ä¸€ä»½åˆ°å¾®äº‘ï¼Œé“¾æ¥åœ¨æœ«å°¾ã€‚  </p>
<span id="more"></span>  

<p><img src="https://i.loli.net/2018/08/02/5b628ca68c86f.png" alt="SystemHome.png"></p>
<h2 id="ä¸€-åŸºæœ¬æƒ…å†µ"><a href="#ä¸€-åŸºæœ¬æƒ…å†µ" class="headerlink" title="ä¸€ åŸºæœ¬æƒ…å†µ"></a>ä¸€ åŸºæœ¬æƒ…å†µ</h2><ol>
<li>è®¾å¤‡ï¼š åä¸ºè£è€€8 FRD-AL10 å›½è¡Œ  </li>
<li>åˆå§‹ç³»ç»Ÿç‰ˆæœ¬ï¼š B396   EMUI 5.0.1   </li>
<li>è§£é”çŠ¶æ€ï¼š Phone Unlocked</li>
</ol>
<hr>
<h2 id="äºŒ-éœ€è¦å‡†å¤‡çš„åŸæ–™"><a href="#äºŒ-éœ€è¦å‡†å¤‡çš„åŸæ–™" class="headerlink" title="äºŒ éœ€è¦å‡†å¤‡çš„åŸæ–™"></a>äºŒ éœ€è¦å‡†å¤‡çš„åŸæ–™</h2><ol>
<li>æ‰‹æœº  </li>
<li>SDå¡  </li>
<li>ç”µè„‘ä¸€å°ï¼ŒUSBçº¿ä¸€æ ¹  </li>
<li>è£è€€8æµ·å¤–ç‰ˆå®‰è£…åŒ…<br> Name:update.zip &amp; update_data_full_hw_usa.zip</li>
<li>OpenKirin TWRP 3.1.1.1<br> Name:twrp-3.1.1-1-frd.img </li>
<li>LineageOS ROM From XDA<br> Name:lineage-14.1-20170812-Unofficial.zip</li>
<li>OpenGAPPS<br> Name:open_gapps-arm64-7.1-stock-20180705.zip </li>
<li>SuperSU<br> Name:SuperSU-v2.82-201705271822.zip</li>
<li>Dolby ATOMå®‰è£…åŒ…<br><img src="https://i.loli.net/2018/08/02/5b628c9965473.png" alt="Install Packages.png"></li>
</ol>
<hr>
<h2 id="ä¸‰-æµç¨‹"><a href="#ä¸‰-æµç¨‹" class="headerlink" title="ä¸‰ æµç¨‹"></a>ä¸‰ æµç¨‹</h2><h3 id="1-è§£é”æ‰‹æœº"><a href="#1-è§£é”æ‰‹æœº" class="headerlink" title="1 è§£é”æ‰‹æœº"></a>1 è§£é”æ‰‹æœº</h3><ol>
<li>é¦–å…ˆéœ€è¦è¿›è¡Œåä¸ºæ‰‹æœºçš„è§£é”ï¼Œç™¾åº¦ä¸€ä¸‹æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥ä¸å†è¿‡å¤šçš„ä»‹ç»ã€‚</li>
<li>éœ€è¦çŸ¥é“æ˜¯æˆ‘å¤§åä¸ºè¦å…³é—­åç»­çš„è§£é”æœåŠ¡äº†ï¼Œæ‰€ä»¥ä»Šåå³ä¾¿æ˜¯åˆ·å¦‚æœä½ æ²¡æœ‰è§£é”ç ä¹Ÿåªèƒ½ä½œç½¢ã€‚</li>
</ol>
<hr>
<h3 id="2-å¤åˆ¶å®‰è£…åŒ…åˆ°SDå¡"><a href="#2-å¤åˆ¶å®‰è£…åŒ…åˆ°SDå¡" class="headerlink" title="2 å¤åˆ¶å®‰è£…åŒ…åˆ°SDå¡"></a>2 å¤åˆ¶å®‰è£…åŒ…åˆ°SDå¡</h3><ol>
<li>åœ¨SDå¡ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—å«åšpackages , æˆ–è€…å…¶ä»–ä¹Ÿå¯ä»¥ã€‚</li>
<li>å¤åˆ¶4-9é¡¹æ–‡ä»¶åˆ°SDå¡</li>
<li>å°†SDå¡æ”¾å…¥æ‰‹æœºã€‚</li>
</ol>
<hr>
<h3 id="3-å†™å…¥TWRP"><a href="#3-å†™å…¥TWRP" class="headerlink" title="3 å†™å…¥TWRP"></a>3 å†™å…¥TWRP</h3><ol>
<li>è§£é”ä¹‹åå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥å†™å…¥TWRP Recoveryã€‚ Recoveryä½¿ç”¨çš„openkiriné¡¹ç›®ç»„çš„ç‰ˆæœ¬ã€‚è¯·è‡ªè¡Œç¡®ä¿é©±åŠ¨åŠæ‰‹æœºçš„è¿æ¥å¤„äºæ­£å¸¸çŠ¶æ€å³å¯ã€‚</li>
<li>æ‰“å¼€adbå·¥å…·ç›®å½•ï¼Œåœ¨å·¥å…·ç›®å½•ä¸­ä½¿ç”¨Shift+é¼ æ ‡å³é”®ï¼Œå°†æ–‡ä»¶å¤¹åœ¨å‘½ä»¤è¡Œæˆ–Powershellä¸­æ‰“å¼€ã€‚</li>
<li>adb.exe devices   â€”â€”  ## æŸ¥çœ‹æ˜¯å¦è¯†åˆ«æ‰‹æœºæˆåŠŸã€‚</li>
<li>adb.exe reboot fastboot â€”â€”â€” ## å°†æ‰‹æœºé‡å¯è‡³fastbootæ¨¡å¼.<br> <strong>NOTE</strong> â€“ è¿›å…¥fastbootçš„æ–¹å¼ï¼Œé™¤äº†adb reboot fastbootä¹‹å¤–è¿˜å¯ä»¥ï¼Œå…³æœºï¼Œæ‰‹æœºè¿æ¥ç”µè„‘ï¼Œ<em>å¼€æœºé”®</em>åŠ *éŸ³é‡-*ï¼Œç›´åˆ°å‡ºç°fastbootç•Œé¢ä¸ºæ­¢ã€‚</li>
<li>fastboot.exe flash recovery .&#x2F;twrp-3.1.1.1-frd.img â€”â€”  ## å†™å…¥Recovery</li>
<li>fastboot.exe reboot â€”â€”  ## é‡å¯æ‰‹æœºã€‚<br><img src="https://i.loli.net/2018/08/02/5b628c9962113.png" alt="HomeScreenTWRP.png"></li>
</ol>
<hr>
<h3 id="4-å®‰è£…æµ·å¤–ç‰ˆROM"><a href="#4-å®‰è£…æµ·å¤–ç‰ˆROM" class="headerlink" title="4 å®‰è£…æµ·å¤–ç‰ˆROM"></a>4 å®‰è£…æµ·å¤–ç‰ˆROM</h3><ol>
<li>XDAåŸå¸– â€“ <a href="https://forum.xda-developers.com/honor-8/how-to/to-emui5-custom-roms-tested-openkirin-t3638445">HERE</a></li>
<li>æ‹”æ‰æ•°æ®çº¿ï¼Œå…³æœºï¼Œé•¿æŒ‰ <em>éŸ³é‡+</em> å’Œ <em>å¼€æœº</em> ï¼Œ ç›´åˆ°å‡ºç° <em>è§£é”è­¦å‘Š</em> å’Œ <em>Your device is booting now â€¦</em></li>
<li>è¿›å…¥Recoveryï¼Œä¸€æ¬¡è¿›å…¥Install â€“ Select Storage â€“ Micro SDCard â€“ OK â€“ Packagesã€‚</li>
<li>ç‚¹å‡»update.zip â€“ Swipt to confirm Flash. </li>
<li>ç­‰å¾…å†™å…¥æˆåŠŸåä¼šè‡ªåŠ¨é‡å¯ã€‚</li>
<li>è‡ªåŠ¨è¿›å…¥eRecoveryå®‰è£…æ›´æ–°ï¼Œè¿™ä¸ªæ˜¯æ­£å¸¸çš„ï¼Œä¸ç”¨ç®¡ä»–å°±å¥½ã€‚</li>
<li>å®‰è£…æ›´æ–°ä¹‹åä¼šè‡ªåŠ¨é‡å¯ï¼Œ<strong>è¿™ä¸ªæ—¶å€™TWRPä¼šè¢«è¦†ç›–</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„TWRPæ‰‹æœºä¸Šå·²ç»æ²¡æœ‰äº†ï¼Œè¢«æ›¿æ¢æˆäº†ROMé‡Œé¢åä¸ºé»˜è®¤çš„recoveryï¼Œéœ€è¦é‡æ–°è¿›å…¥fastbootå†å†™å…¥ä¸€æ¬¡TWRPã€‚</li>
<li>æŒ‰ç…§å†™å…¥TWRPçš„æ­¥éª¤å†æ¥ä¸€æ¬¡å³å¯ã€‚<br> <strong>NOTE</strong> â€“ å¦‚æœæç¤ºå†™å…¥TWRPå¤±è´¥ï¼Œéœ€è¦å†ä½¿ç”¨è§£é”ç è§£é”ä¸€æ¬¡æ‰‹æœºï¼Œä¸è¦éœ€è¦ç®¡fastbootç•Œé¢çš„é‚£ä¸ªæç¤ºã€‚æˆ‘çš„æ‰‹æœºå½“æ—¶æ˜¾ç¤ºçš„æ˜¯å·²ç»è§£é”ï¼Œä½†æ˜¯å…¶å®æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦2æ¬¡è§£é”æ‰‹æœºæ‰å¯ä»¥å†™å…¥TWRPã€‚</li>
<li>å†æ¬¡è¿›å…¥TWRPä¹‹åï¼Œé‡å¤ç¬¬2æ­¥ï¼Œæ‰¾åˆ°update_data_full_hw_usa.zip â€“ Swipt to confirm Flash.</li>
<li>è‡ªåŠ¨å†™å…¥æˆåŠŸåä¼šè‡ªåŠ¨é‡å¯ï¼Œè¿›å…¥ç³»ç»ŸåæŸ¥çœ‹å…³äºæ‰‹æœºï¼Œå…¶ä¸­åç§°å˜ä¸ºNRD90Mã€‚è¯´æ˜æˆ‘ä»¬å·²ç»å¯ä»¥å†™å…¥LineageOSäº†ã€‚</li>
</ol>
<hr>
<h3 id="5-å¡åˆ·LineageOS"><a href="#5-å¡åˆ·LineageOS" class="headerlink" title="5 å¡åˆ·LineageOS"></a>5 å¡åˆ·LineageOS</h3><ol>
<li>XDAåŸå¸– â€“ <a href="https://forum.xda-developers.com/honor-8/development/rom-lineageos-14-1-honor-8-t3615506">HERE</a></li>
<li>æˆ‘ç”¨çš„æ˜¯US Model â€“ FRD-L14C567 â€“ B360 ï¼Œå¯ä»¥ä½¿ç”¨ã€‚</li>
<li>é‡å¯æ‰‹æœºï¼Œè¿›å…¥TWRPï¼Œ åŒæ¸…ï¼Œæ ¼å¼åŒ–dataåˆ†åŒºã€‚<br><img src="https://i.loli.net/2018/08/02/5b628c9961462.png" alt="Wipe.png"></li>
<li>é€‰æ‹©lineage-14.1-20170812-Unofficial.zip â€“ Swipt to confirm Flash.</li>
<li>ç­‰å¾…å†™å…¥æˆåŠŸä¹‹åé‡å¯ã€‚<br><strong>NOTE</strong> â€“ å¦‚æœå†™å…¥ä¹‹åä¸€ç›´å¡åœ¨å¼€æœºåŠ¨ç”»ï¼Œè§£å†³æ–¹æ³•æ˜¯è¿›å…¥TWRP â€“ æ ¼å¼åŒ–dataåˆ†åŒºå³å¯ã€‚</li>
<li>ç¬¬ä¸€æ¬¡å¼€æœºçš„è¿‡ç¨‹å¯èƒ½æœ‰äº›æ…¢ï¼Œä½†æ˜¯åªè¦ç¬¬ä¸€è¿›å…¥äº†ç³»ç»Ÿå°±å¯ä»¥äº†ï¼Œåé¢ä¸ä¼šå†å‡ºç°é—®é¢˜äº†ã€‚</li>
<li>åˆ·å…¥LineageOSå®Œæˆã€‚</li>
</ol>
<hr>
<h3 id="6-å®‰è£…SuperSU"><a href="#6-å®‰è£…SuperSU" class="headerlink" title="6 å®‰è£…SuperSU"></a>6 å®‰è£…SuperSU</h3><ol>
<li>SuperSUå®˜ç½‘ â€“ <a href="http://www.supersu.com/">HERE</a></li>
<li>é€‰æ‹©SuperSU-v2.82-201705271822.zip â€“ Swipt to confirm Flash.</li>
<li>è¿›å…¥ç³»ç»Ÿå°±å¯ä»¥çœ‹åˆ°äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>
<li>å¦‚æœä¸æ˜¯ç”¨SuperSUï¼Œå¯ä»¥ä½¿ç”¨Magiskï¼Œå¥½åƒè¿™ä¸ªå¥½ç”¨ä¸€äº›ã€‚<br><img src="https://i.loli.net/2018/08/02/5b628c9964202.png" alt="Magisk.png"></li>
</ol>
<hr>
<h3 id="7-å®‰è£…OpenGAPPS"><a href="#7-å®‰è£…OpenGAPPS" class="headerlink" title="7 å®‰è£…OpenGAPPS"></a>7 å®‰è£…OpenGAPPS</h3><ol>
<li>OpenGAPPSå®˜ç½‘ â€“ <a href="https://opengapps.org/">HERE</a></li>
<li>è¿›å…¥TWRPï¼Œ é€‰æ‹©open_gapps-arm64-7.1-stock-20180705.zip â€“ Swipt to confirm Flash.</li>
<li>é‡å¯ä¹‹åå°±å¯ä»¥åœ¨ç³»ç»Ÿé‡Œé¢çœ‹åˆ°äº†ï¼Œæˆ‘é€‰æ‹©çš„è¿™ä¸ªç‰ˆæœ¬æ˜¯æ›¿æ¢ç³»ç»Ÿåº”ç”¨çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å¯ä»¥æä¾›ä¸€ä¸ªè¿‘ä¹äºåŸç”Ÿçš„ä½“éªŒã€‚</li>
</ol>
<hr>
<h3 id="8-å®‰è£…æœæ¯”ATOMS"><a href="#8-å®‰è£…æœæ¯”ATOMS" class="headerlink" title="8 å®‰è£…æœæ¯”ATOMS"></a>8 å®‰è£…æœæ¯”ATOMS</h3><ol>
<li><strong>XDAåŸå¸–</strong> â€“ <a href="https://forum.xda-developers.com/android/apps-games/soundmod-axon-7-dolby-atmos-t3412342">HERE</a></li>
<li>é€‰æ‹©dax_lemax2_v1.6.3.zip â€“ Swipe to confirm Flash.<br><strong>NOTE</strong> â€“ å¸–å­ä¸­ç»™å‡ºäº†äº”ä¸ªå®‰è£…åŒ…ï¼Œæˆ‘åŸºæœ¬ä¸Šæ˜¯å°è¯•åˆ°ç¬¬äºŒä¸ªçš„æ—¶å€™æˆåŠŸäº†ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™ä¸ªæŠŠåŸå¸–æ”¾å‡ºæ¥æ˜¯è¯´ï¼Œå¯èƒ½è¿™ä¸ªéœ€è¦ä¸åŒçš„æœºå‹å»å°è¯•ã€‚</li>
<li>é‡å¯å¯ä»¥åœ¨ç³»ç»Ÿåº”ç”¨ä¸­ç›´æ¥çœ‹åˆ°ã€‚å¯ä»¥å¼€å¯æˆ–è€…å…³é—­ã€‚  </li>
<li>å¯ä»¥é€‰æ‹©ä½¿ç”¨Viperæˆ–è€…Dolbyï¼Œçœ‹è‡ªå·±çš„å–œå¥½äº†ã€‚<br><strong>NOTE</strong> â€“ è¿™ç§åº”ç”¨ï¼Œæˆ‘è§‰å¾—æœ‰ä¸€ä¸ªå°±å¤Ÿäº†ï¼Œå…¶å®åªæ˜¯ä¼˜åŒ–ä¸€ä¸‹å¤–æ”¾çš„æ•ˆæœã€‚</li>
</ol>
<hr>
<h2 id="å››-ç»“å°¾"><a href="#å››-ç»“å°¾" class="headerlink" title="å›› ç»“å°¾"></a>å›› ç»“å°¾</h2><p>åªæ˜¯ä¸ä¹ æƒ¯å¦‚æ­¤å¤šçš„ROMé‡Œé¢å†…ç½®äº†å¾ˆå¤šæˆ‘ä¸ä½¿ç”¨çš„åº”ç”¨ï¼Œè¿˜ä¸èƒ½åˆ é™¤ã€‚<br><strong>å…¶å®è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸å»ºè®®åˆ·æœºï¼Œå¦‚æœä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚</strong></p>
<hr>
<h2 id="äº”-å…±äº«ä¸‹è½½èµ„æº"><a href="#äº”-å…±äº«ä¸‹è½½èµ„æº" class="headerlink" title="äº” å…±äº«ä¸‹è½½èµ„æº"></a>äº” å…±äº«ä¸‹è½½èµ„æº</h2><p>åŒ…æ‹¬æˆ‘æ‰€æœ‰æ–‡ä¸­ä½¿ç”¨åˆ°çš„å®‰è£…åŒ…åŠæ–‡ä»¶ï¼Œæˆ‘ä¸Šä¼ åˆ°äº†å¾®äº‘ï¼Œä¸‹è½½é“¾æ¥å¦‚ä¸‹ã€‚<br><strong>NOTE</strong> â€“ opengappsçš„å®‰è£…åŒ…æˆ‘æ›¿æ¢æˆäº†picoï¼Œè¿™æ ·ä¸éœ€è¦ç¿»å¢™ï¼Œåªæœ‰Googleçš„æ¡†æ¶å’ŒåŸºç¡€åº”ç”¨ï¼Œä¹Ÿä¸ä¼šæ›¿æ¢ç³»ç»Ÿåº”ç”¨ã€‚<br><strong>ä¸‹è½½åœ°å€</strong> â€“ <a href="https://share.weiyun.com/5wQdXtO">HERE</a><br>å¯†ç ï¼š9yn57o</p>
<hr>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>All this I did without you</title>
    <url>/2019/09/19/Other/Books_All%20this%20I%20did%20without%20you/</url>
    <content><![CDATA[<p>English Text for exercise the Reading and listening.</p>
<span id="more"></span>

<p>Letter No. 028</p>
<p>July 31st, 1978</p>
<p>Gerald Durrell, a respected conservationist wrote a love letter to his future wife, and then one of his students taking her PhD at Duke University, Lee McGeorge.</p>
<p>~</p>
<p>My darling McGeorge,</p>
<p>You said that things seemed clearer when they were written down. Well, here with is a very boring letter in which I will try and put everything down so that you may read and re-read it in horror at your folly in getting involved with me. Deep breath.</p>
<p>To begin with I love you with a depth and passion that I have felt for no one else in this life and if it astonishes you it astonishes me as well. Not I hasten to say, because you are not worth loving. Far from it. Itâ€™s just that, first of all, I swore I would not get involved with another woman. Secondly, I have never had such a feeling before and it is almost frightening. Thirdly, I would never have thought it possible that another human being could occupy my waking (and sleeping) thoughts to the exclusion of almost everything else.</p>
<p>Fourthly, I never thought that â€” even if one was in love â€” one could get so completely besotted with another person, so that a minute away from them felt like a thousand years.</p>
<p>Fifthly, I never hoped, aspired, dreamed that one could find everything one wanted in a person. I was not such an idiot as to believe this was possible. Yet in you I have found everything I want: you are beautiful, gay, giving, gentle, idiotically and deliciously feminine, sexy, wonderfully intelligent and wonderfully silly as well. I want nothing else in this life than to be with you, to listen and watch you (your beautiful voice, your beauty), to argue with you, to laugh with you, to show you things and share things with you, to explore your magnificent mind, to explore your magnificent mind, to explore your wonderful body, to help you, protect you , serve you, and bash you on the head when I think you are wrongâ€¦ not to put too fine a point on it I consider that I am the only man outside mythology to have found the crock of gold at the rainbowâ€™s end.</p>
<p>But â€” having said all that â€” let us consider things in detail. Donâ€™t let this become public butâ€¦ well, I have one or two faults. Minor ones, I hasten to say. For example, I am inclined to be overbearing. I do it for the best possible motives (all tyrants say that) but I do tend (without thinking) to tread people underfoot. You must tell me when I am doing it to you, my sweet, because it can be a very bad thing in a marriage.</p>
<p>Right. Second blemish. This, actually, is not so much a blemish  of character  as a blemish of circumstance. Darling I want you to be you in your own right, and I will do everything I can to help you in this. But you must take into consideration that I am also me in my own right and that I have a headstart on youâ€¦ what I am trying to say is that you must not feel offended if you are sometimes treated simply as my wife. Always remember that what you lose on the swings, you gain on the roundabouts. But I am an established â€˜creatureâ€™ in the world, and so â€” on occasions â€” you will have to live in my shadow. Nothing gives me less pleasure than this but it is a fact of life to be faced.</p>
<p>Third (and very important and nasty) blemish: jealousy. I donâ€™t think you know what jealousy is (thank God) in the real sense of the word. I know you have felt jealousy over Lincolnâ€™s wife and child but this is what I call normal jealousy, and this â€” to my regret â€” is not what Iâ€™ve got. What I have got is a black moster that can pervert my good sense, my good humour and any goodness that I have in my make-up. It is really a Jekyll and Hyde situationâ€¦ my Hyde is stronger than my good sense and defeats me, hard though I try. As I told you, I have always known that this lurks within me, but I couldnâ€™t control it, and my monster slumbered and nothing happened to awake it. Then I met you and I felt my monster stir and become half awake when you told me of Lincoln and others you have known, and with your letter my monster came out of its lair, black, irrational, bigoted, stupid, evil, malevolent. You will never know how terribly corrosive jealousy is; it is a physical pain as though you had swallowed acid or red hot coals. It is the most terrible of feelings. But you canâ€™t help it â€” at least I canâ€™t, and God knows Iâ€™ve tried. I donâ€™t want any ex-boyfriends sitting in church when I marry you. On our wedding day, I want nothing but happiness, for both you and me, and I know I wonâ€™t be happy if there is a church full of your ex-conquests. When I marry you I will have no past, only a future: I donâ€™t want to drag my past into our future and I donâ€™t want you to do it , either. Remember I am jealous of you because I love you. You are never jealous of something you donâ€™t care about. OK, enough about jealousy.</p>
<p>Now, let me tell you somethingâ€¦ I have seen a thousand sunsets and sunrises, on land where it floods forest and mountains with honey-coloured light, at sea where it rises and sets like a blood orange in a multi-coloured nest of cloud, slipping in and out of the vast ocean. I have seen a thousand moons: harvest moons like gold coins, winter moons as white as ice chips, new moons like baby swansâ€™ feathers.</p>
<p>I have seen seas as smooth as if painted, coloured like shot silk or blue as a kingfisher or transparent as glass or black and crumpled with foam, moving ponderously and murderously.</p>
<p>I have felt winds straight from the South Pole, bleak and wailing like a lost child; winds as tender and warm as a loverâ€™s breath; winds that carried the astringent smell of salt and the death of seaweeds; winds that carried the moist rich smell of a forest floor, the smell of a million flowers. Fierce winds that churned and moved the sea like yeast, or winds that made the waters lap at the shore like a kitten.</p>
<p>I have known silence: the cold, earthy silence at the bottom of a newly dug well; the implacable stony silence of a deep cave; the hot, drugged midday silence when everything is hypnotized and stilled into silence by the eye of the sun; the silence when great music ends.</p>
<p>I have heard summer cicadas cry so that the sound seems stitched into your bones. I have heard tree frogs in an orchestration as complicated as Bach singing in a forest lit by a million emerald fireflies. I have heard the Keas calling over grey glaciers that groaned to themselves like old people as they inched their way to the sea. I have heard the hoarse street vendor cries of the mating Fur seals as they sang to their sleek golden wives, the crisp staccato admonishment of the Rattlesnake, the cobweb squeak of the Bat and the belling roar of the Red deer knee-deep in purple heather. I have heard Wolves baying at a winterâ€™s moon, Red Howlers making the forest vibrate with their roaring cries. I have heard the squeak, purr and grunt of a hundred multi-coloured reef fishes.</p>
<p>I have seen hummingbirds flashing like opals round a tree of scarlet blooms, humming like a top. I have seen flying fish, skittering like quicksilver across the blue waves, drawing silver lines on the surface with their tails. I have seen Spoonbills flying home to roost like a scarlet banner across the sky. I have seen Whales, black as tar, cushioned on a cornflower blue sea, creating a Versailles of fountain with their breath. I have watched butterflies emerge and sit, trembling, while the sun irons their wings smooth. I have watched Tigers, like flames, mating in the long grass. I have been dive-bombed by an angry Raven, black and glossy as the Devilâ€™s hoof. I have lain in water warm as milk, soft as silk, while around me played a host of Dolphins. I have met a thousand animals and seen a thousand wonderful thingsâ€¦ but â€“</p>
<p>All this I did without you. This was my loss.</p>
<p>All this I want to do with you. This will be my gain.</p>
<p>All this I would gladly have forgone for the sake of one minute of your company, for your laugh, your voice, your eyes, hair, lips, body, and above all for your sweet, ever surprising mind which is an enchanting quarry in which it is my privilege to delve.</p>
]]></content>
      <categories>
        <category>Books</category>
      </categories>
      <tags>
        <tag>English</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­£è§â€”â€”ä½›é™€çš„è¯æ‚Ÿï¼ˆä¸€ï¼‰è¯¸è¡Œæ— å¸¸(é€‰æ‘˜)</title>
    <url>/2020/04/10/Other/Books_%E6%AD%A3%E8%A7%81-%E4%BD%9B%E9%99%80%E7%9A%84%E8%AF%81%E6%82%9F-%E8%8A%82%E9%80%89-1/</url>
    <content><![CDATA[<p>è¿™æ˜¯ä»ã€Šæ­£è§-ä½›é™€çš„è¯æ‚Ÿã€‹è¿™ä¹¦ä¸­ï¼Œæ‘˜å‡ºæ¥çš„å¥å­ï¼Œæˆ‘è®¤ä¸ºæœ‰æ„ä¹‰ï¼Œæˆ–è€…å¯¹å››æ³•å°ä¸­çš„è¯¸è¡Œæ— å¸¸æœ‰ç†è§£çš„éƒ¨åˆ†ï¼Œ ä¸€ç›´æ”¾åœ¨QQç©ºé—´ä¸­ï¼Œ å‰ä¸¤å¤©æ‹¿å‡ºæ¥çœ‹äº†ä¸€ä¸‹ï¼Œ è§‰å¾—è¿˜æ˜¯æœ‰ä¸å°‘çš„ä½“ä¼šï¼Œæ‰€ä»¥æŠŠå®ƒæ¬è¿‡æ¥äº†ï¼Œ åç»­çš„å†…å®¹æ˜¯ä¸æ˜¯ä¼šæ›´æ–°è¿˜æ˜¯è¦çœ‹æˆ‘æ‡’ä¸æ‡’äº†ã€‚</p>
<p><strong>åªæ˜¯å¯¹è€ä¸æ­»çš„åŒæ¶ï¼Œå¹¶ä¸è¶³ä»¥è®©å¤ªå­ç¦»å¼€ç‹å®«è€Œè¸å…¥æœªçŸ¥çš„ä¸–ç•Œ</strong>ï¼›æ‚‰è¾¾å¤šä¼šé‡‡å–è¿™ä¹ˆæ¿€çƒˆçš„è¡ŒåŠ¨ï¼Œæ˜¯å› ä¸º<strong>ä»–å®åœ¨æ— æ³•åˆç†åœ°è§£é‡Šæ‰€æœ‰å·²ç”Ÿå’Œå°†å‡ºç”Ÿçš„ä¸€åˆ‡ä¼—ç”Ÿå‘½è¿å°±æ˜¯å¦‚æ­¤è€Œå·²ã€‚</strong>å¦‚æœæ‰€æœ‰ç”Ÿè€…éƒ½å¿…é¡»è¡°æœ½æ­»äº¡ï¼Œé‚£ä¹ˆèŠ±å›­ä¸­çš„å­”é›€ã€çå®ã€åç›–ã€ç†é¦™ã€éŸ³ä¹ï¼Œæ”¾æ‹–é‹çš„é‡‘è´¨æ‹–ç›˜ã€è¿›å£çš„ç»ç’ƒæ°´ç“¶ã€ä»–ä¸è€¶è¾“é™€ç½—å’Œç½—çºç½—çš„æ„Ÿæƒ…ã€å®¶åº­ã€å›½å®¶ï¼Œéƒ½å˜å¾—æ¯«æ— æ„ä¹‰ã€‚<strong>è¿™ä¸€åˆ‡çš„ç›®çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>å®Œå…¨ä¸å‡­å€Ÿä»»ä½•ç§‘å­¦å·¥å…·ï¼Œæ‚‰è¾¾å¤šå¤ªå­ä»¥å‰ç¥¥è‰ä¸ºå«ï¼Œååœ¨ä¸€æ£µè©ææ ‘ä¸‹ï¼Œæ¢ç´¢äººç±»çš„æœ¬æ€§ã€‚ç»è¿‡äº†é•¿æ—¶é—´çš„æ€ç»´ï¼Œä»–ç»ˆäºäº†æ‚Ÿåˆ°<strong>ä¸€åˆ‡ä¸‡æœ‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„è¡€è‚‰ã€æˆ‘ä»¬æ‰€æœ‰çš„æƒ…ç»ªå’Œæˆ‘ä»¬æ‰€æœ‰çš„è§‰å—ï¼Œéƒ½æ˜¯ç”±ä¸¤ä¸ªä»¥ä¸Šçš„å…ƒç´ ç»„åˆè€Œæˆã€‚</strong>å½“ä¸¤ç§æˆ–å¤šç§å…ƒç´ å’Œåˆåœ¨ä¸€èµ·ï¼Œæ–°çš„ç°è±¡å°±ä¼šäº§ç”Ÿï¼›é’‰å­å’Œæœ¨å¤´äº§ç”Ÿäº†æ¡Œå­ï¼›æ°´å’Œå¶å­äº§ç”Ÿäº†èŒ¶ï¼›è€Œææƒ§ã€è™”è¯šå’Œæ•‘ä¸–ä¸»ï¼Œå°±äº§ç”Ÿäº†ç¥ã€‚è¿™äº›æœ€ç»ˆçš„äº§ç‰©ï¼Œå¹¶æ²¡æœ‰ç‹¬ç«‹äºå…¶å„åˆ«å…ƒç´ çš„å­˜åœ¨ã€‚ç›¸ä¿¡å®ƒçœŸå®ç‹¬ç«‹å­˜åœ¨ï¼Œæ˜¯æœ€å¤§çš„éª—å±€ã€‚è€Œåœ¨å’Œåˆçš„åŒæ—¶ï¼Œå„ä¸ªå…ƒç´ ä¹Ÿèµ·äº†å˜åŒ–ã€‚åªå› æ¥è§¦å’Œåˆï¼Œå®ƒä»¬çš„æ€§è´¨ä¹Ÿéšä¹‹æ”¹å˜äº†ã€‚</p>
<p><strong>ä¸€åˆ‡ä¸‡æœ‰ï¼Œæ²¡æœ‰ä¸€æ ·æ˜¯ä»¥ç‹¬ç«‹ã€æ’å¸¸ã€çº¯ç²¹çš„çŠ¶æ€å­˜åœ¨ã€‚</strong>ä½ æ‰‹ä¸Šçš„ä¹¦ä¸æ˜¯ï¼ŒåŸå­ä¸æ˜¯ï¼Œç”šè‡³ç¥ç¥‡ä¹Ÿä¸æ˜¯ã€‚</p>
<p>å› æ­¤æ‚‰è¾¾å¤šå‘ç°ï¼Œæ— å¸¸å¹¶ä¸åƒä¸€èˆ¬äººä»¥ä¸ºçš„å°±æ˜¯æ„å‘³æ­»äº¡ï¼Œè€Œæ˜¯æ„å‘³å˜åŒ–ã€‚ä»»ä½•äº‹ç‰©å’Œå¦ä¸€ä¸ªäº‹ç‰©ä¹‹é—´çš„ä½ç½®æˆ–å…³ç³»è½¬å˜äº†ï¼Œå³ä½¿æ˜¯éå¸¸ç»†å¾®çš„å˜åŠ¨ï¼Œéƒ½è¦ä¾å¾ªæ— å¸¸çš„æ³•åˆ™ã€‚</p>
<p><strong>å¦‚æœæ²¡æœ‰ç›²ç›®çš„æœŸå¾…ï¼Œå°±ä¸ä¼šæœ‰å¤±æœ›ã€‚å¦‚æœèƒ½äº†è§£ä¸€åˆ‡éƒ½æ˜¯æ— å¸¸ï¼Œä¸ä¼šæ”€ç¼˜æ‰§è‘—ï¼›å¦‚æœä¸æ”€ç¼˜æ‰§è‘—ï¼Œå°±ä¸ä¼šæ‚£å¾—æ‚£å¤±ï¼Œä¹Ÿæ‰èƒ½çœŸæ­£å®Œå®Œå…¨å…¨åœ°æ´»ç€ã€‚</strong></p>
<p>æ‚‰è¾¾å¤šä»æ’å¸¸çš„å¹»ç›¸ä¸­è§‰é†’ï¼Œå› æ­¤æˆ‘ä»¬ç§°ä»–ä¸ºä½›é™€ã€è§‰è€…ã€‚åˆ°ç°åœ¨è¿˜æ˜¯æ²¡æœ‰äººå¯ä»¥é•¿ç”Ÿä¸è€ï¼Œæ¯ä¸ªäººç»ˆç©¶ä¼šæ­»ï¼Œè€Œä¸”æ¯å¤©å¤§æ¦‚æœ‰äºŒåäº”ä¸‡äººæ­»äº¡ã€‚æˆ‘ä»¬äº²è¿‘çš„äººä¸æ˜¯å·²ç»æ­»äº¡å°±æ˜¯å°†ä¼šæ­»äº¡ã€‚ç„¶è€Œå½“äº²äººæ­»å»çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šéœ‡æƒŠå’Œæ‚²ä¼¤ï¼›æˆ‘ä»¬è¿˜æ˜¯ç»§ç»­å¯»æ‰¾é’æ˜¥ä¹‹æ³‰ï¼Œæˆ–æ˜¯é•¿å¯¿çš„ç§˜æ–¹ã€‚</p>
<p>æ‚‰è¾¾å¤šå¤ªå­ä¸å†éœ€è¦æˆ–æ¸´æ±‚é•¿ç”Ÿä¸è€è¯äº†ã€‚ç”±äºäº†æ‚Ÿåˆ°ä¸€åˆ‡äº‹ç‰©çš†æ˜¯å’Œåˆè€Œæˆï¼Œè§£æ„æ— æ­¢å¢ƒï¼Œè€Œä¸”ä¸€åˆ‡ä¸‡æœ‰çš„å„ä¸ªæˆåˆ†ï¼Œæ²¡æœ‰ä¸€é¡¹æ˜¯ä»¥ç‹¬ç«‹ã€æ’å¸¸ä¸çº¯ç²¹çš„çŠ¶æ€å­˜åœ¨çš„ï¼Œä»–å› æ­¤è·å¾—è§£è„±ã€‚ä¸€åˆ‡å’Œåˆä¹‹ç‰©(ç°åœ¨æˆ‘ä»¬çŸ¥é“è¿™æ˜¯æŒ‡ä¸€åˆ‡äº‹ç‰©)ä¸å…¶æ— å¸¸çš„æœ¬è´¨æ˜¯åˆè€Œä¸ºä¸€ã€ä¸å¯åˆ†å‰²çš„ã€‚</p>
<p>å½“æ‚‰è¾¾å¤šçœ‹åˆ°ä¸€ä¸ªäººèµ°è¿‡ï¼Œå³ä½¿ä»–å¾ˆå¥åº·ï¼Œæ‚‰è¾¾å¤šæ‰€çœ‹åˆ°çš„æ˜¯æ­¤äººçš„ç”Ÿä¸ç­åŒæ—¶å‘ç”Ÿã€‚ä½ ä¹Ÿè®¸ä¼šè®¤ä¸ºè¿™æ ·çš„äººç”Ÿè§‚ä¸å¤ªæœ‰è¶£ï¼Œä½†åœ¨ç”Ÿå‘½çš„æ—…ç¨‹ä¸­èƒ½å¤ŸåŒæ—¶çœ‹åˆ°ä¸€ä½“çš„ä¸¤é¢ï¼Œå¯ä»¥æ˜¯éå¸¸å¥‡å¦™ï¼Œè€Œä¸”å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„æ»¡è¶³æ„Ÿã€‚</p>
<p>ä¹Ÿå°±è¡¨ç¤ºç°åœ¨æœ‰ä¸ªâ€œå‡è®¾è€…â€ï¼Œæ‚‰è¾¾å¤šä¼šåŒæ„ï¼Œåªè¦æœ‰[å‡è®¾è€…]ï¼Œå°±ä¼šæœ‰ä¸Šå¸å­˜åœ¨ï¼›ä½†å¦‚æœæ²¡æœ‰å‡è®¾è€…ï¼Œå°±ä¸ä¼šæœ‰ä¸Šå¸å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰çº¸ï¼Œå°±ä¸ä¼šæœ‰ä¹¦ã€‚å¦‚æœæ²¡æœ‰æ°´ï¼Œå°±ä¸ä¼šæœ‰å†°ã€‚å¦‚æœæ²¡æœ‰å¼€å§‹ï¼Œå°±ä¸ä¼šæœ‰ç»“æŸã€‚ä¸€ä»¶äº‹ç‰©çš„å­˜åœ¨ï¼ŒäºŸéœ€ä¾èµ–å…¶å®ƒäº‹ç‰©çš„å­˜åœ¨ï¼Œå› æ­¤æ²¡æœ‰ä»€ä¹ˆæ˜¯çœŸæ­£ç‹¬ç«‹çš„ã€‚å°½ç®¡æˆ‘ä»¬ä»¥ä¸ºå¯ä»¥æ§åˆ¶å˜åŒ–ï¼Œä½†äº‹å®ä¸Šå¤§å¤šæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ— æ³•å¯Ÿè§‰çš„å½±å“å› ç´ å¤ªå¤šäº†ã€‚ä¹Ÿå› ä¸ºè¿™ç§ç›¸äº’ä¾å­˜æ€§ï¼Œä¸€åˆ‡äº‹ç‰©ä¸å¯é¿å…åœ°ä¼šä»ç›®å‰æˆ–åŸå§‹çŠ¶æ€ä¸­è§£ä½“ã€‚æ¯ä¸€ä¸ªå˜åŒ–ä¸­éƒ½è•´è—ç€æ­»äº¡çš„å› ç´ ã€‚ä»Šæ—¥å°±æ˜¯æ˜¨æ—¥ä¹‹æ­»ã€‚</p>
<p>å¤§éƒ¨åˆ†çš„äººéƒ½æ¥å—ä¸€åˆ‡ç”Ÿè€…ç»ˆå°†æ­»äº¡ã€‚ç„¶è€Œæˆ‘ä»¬å¯¹â€œä¸€åˆ‡â€ä¸â€œæ­»äº¡â€çš„å®šä¹‰æˆ–è®¸ä¸å¤ªä¸€æ ·ã€‚å¯¹æ‚‰è¾¾å¤šæ¥è¯´ï¼Œç”ŸæŒ‡çš„æ˜¯ä¸€åˆ‡ä¸‡æœ‰ï¼Œä¸ä»…ä»…æ˜¯èŠ±æœµã€è˜‘è‡ã€äººç±»ï¼Œè€Œæ˜¯ä¸€åˆ‡ç”Ÿæˆæˆ–å’Œåˆçš„äº‹ç‰©ã€‚è€Œæ­»äº¡æŒ‡çš„æ˜¯ä»»ä½•çš„è§£ä½“æˆ–æ˜¯è§£æ„ã€‚æ— å¸¸çº¯ç²¹æ˜¯ä¸€ä¸ªç®€å•å®åœ¨çš„äº‹å®ã€‚ä¸å¯èƒ½æœ‰ä¸€å¤©ï¼ŒæŸä¸ªçªå‘çš„å’Œåˆäº‹ç‰©ä¼šçªç„¶å˜å¾—æ’å¸¸ï¼Œæ›´éš¾æƒ³è±¡æˆ‘ä»¬èƒ½è¯æ˜è¿™æ ·çš„äº‹ã€‚ä½†æ˜¯åœ¨ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸æ˜¯å°†ä½›é™€å¥‰ä¸ºç¥æ˜ï¼Œå°±æ˜¯æƒ³ç”¨ç§‘æŠ€è¯æ˜è‡ªå·±æ¯”ä½›é™€æ›´é«˜æ˜ã€‚</p>
<p>ä½›é™€æ•™å¯¼æˆ‘ä»¬ï¼Œè‡³å°‘æˆ‘ä»¬å¿ƒä¸­è¦ä¿æŒç€æ— å¸¸çš„æ¦‚å¿µï¼Œä¸è¦æ•…æ„å»éšè—å®ƒã€‚æˆ‘ä»¬å€Ÿç€ä¸æ–­åœ°è§‰å¯Ÿå’Œåˆçš„ç°è±¡ï¼Œä¾¿ä¼šäº†çŸ¥å› ç¼˜ç›¸ä¾ã€‚è®¤è¯†å› ç¼˜ç›¸ä¾ï¼Œæˆ‘ä»¬å°±ä¼šè®¤è¯†æ— å¸¸ã€‚è€Œå½“æˆ‘ä»¬çŸ¥é“ä¸€åˆ‡äº‹ç‰©çš†æ— å¸¸ï¼Œæ‰ä¸ä¼šè¢«ç§ç§å‡è®¾ã€åƒµåŒ–çš„ä¿¡æ¡(ä¸è®ºå®—æ•™çš„æˆ–ä¸–ä¿—çš„)ã€ä»·å€¼ä½“ç³»å’Œç›²ç›®ä¿¡ä»°æ‰€å¥´å½¹ã€‚æˆ‘ä»¬çš„è§‰å¯ŸåŠ›å¯ä»¥è®©æˆ‘ä»¬å…äºå—é™äºä¸ªäººçš„ã€æ”¿æ²»çš„å’Œæ„Ÿæƒ…çš„æˆç ä¹‹ä¸­ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å°†è¿™ç§è§‰å¯ŸåŠ›å¯¼å‘å¤§è‡³æƒ³è±¡ä¹‹æï¼Œå°è‡³æ¬¡åŸå­å±‚æ¬¡ã€‚</p>
<p>ç”±äºæˆ‘ä»¬å¯¹è‡ªå·±çš„é“å¾·åŸåˆ™æ„Ÿåˆ°è‡ªè±ªï¼Œè€Œä¸”å¸¸å¼ºåŠ äºåˆ«äººèº«ä¸Šï¼Œå› æ­¤é“å¾·è§‚è¿˜æ˜¯å…·æœ‰å°‘è®¸ä»·å€¼ã€‚ç„¶è€Œï¼Œåœ¨æ•´ä¸ªäººç±»å†å²å½“ä¸­ï¼Œé“å¾·çš„å®šä¹‰ä¹Ÿéšç€æ—¶ä»£ç²¾ç¥è€Œä¸€ç›´åœ¨æ”¹å˜ã€‚ç¾å›½äººåº¦é‡æ”¿æ²»æ­£ç¡®æ€§æˆ–ä¸æ­£ç¡®æ€§çš„ä»ªè¡¨èµ·ä¼ä¸å®šï¼Œä»¤äººè¿·æƒ‘ã€‚ä¸ç®¡å¦‚ä½•ç§°å‘¼ç§æ—æˆ–æ–‡åŒ–ç¾¤ä½“ï¼Œæ€»æ˜¯æœ‰äººä¼šè¢«å†’çŠ¯ï¼Œæ¸¸æˆè§„åˆ™ä¸€ç›´åœ¨æ”¹å˜ã€‚</p>
<p>å½“æ‚‰è¾¾å¤šæåˆ°â€œä¸€åˆ‡å’Œåˆçš„äº‹ç‰©â€ï¼Œä»–æ‰€æŒ‡çš„ä¸åªæ˜¯åƒDNAã€ä½ çš„ç‹—ã€è‰¾è²å°”é“å¡”ã€åµå­å’Œç²¾å­ç­‰å…·ä½“å¯è®¤çŸ¥çš„ç°è±¡è€Œå·²ã€‚å¿ƒã€æ—¶é—´ã€è®°å¿†å’Œä¸Šå¸ï¼Œä¹Ÿæ˜¯å’Œåˆè€Œæˆã€‚è€Œæ¯ä¸€å’Œåˆçš„æˆåˆ†ï¼Œåˆä¾èµ–æ›´å¤šä¸åŒå±‚æ¬¡çš„å’Œåˆè€Œæˆã€‚    å½“æ‚‰è¾¾å¤šæ•™å¯¼æ— å¸¸æ—¶ï¼Œä»–ä¹Ÿè¶…è¶Šäº†ä¸€èˆ¬â€œç»“æŸâ€çš„æƒ³æ³•ï¼Œåƒæ˜¯é‚£ç§è®¤ä¸ºæ­»äº¡åªå‘ç”Ÿä¸€æ¬¡å°±å®Œäº†çš„æ¦‚å¿µã€‚æ­»äº¡ä»ç”Ÿã€ä»åˆ›é€ çš„é‚£ä¸€åˆ»å¼€å§‹ï¼Œå°±æ²¡æœ‰åœè¿‡ã€‚æ¯ä¸€ä¸ªå˜åŒ–ï¼Œéƒ½æ˜¯æ­»äº¡çš„ä¸€ç§å½¢å¼ï¼Œå› æ­¤æ¯ä¸€ä¸ªç”Ÿéƒ½åŒ…å«äº†å¦ä¸€ä¸ªäº‹ç‰©çš„æ­»äº¡ã€‚</p>
<p>æ‹¿ç…®é¸¡è›‹æ¥åšä¾‹å­ã€‚å¦‚æœæ²¡æœ‰ä¸æ–­çš„å˜åŒ–ï¼Œè›‹å°±ç…®ä¸ç†Ÿï¼›ç…®å¥½è›‹çš„è¿™ä¸ªç»“æœï¼Œéœ€è¦æŸäº›åŸºæœ¬çš„å› ç¼˜ã€‚å¾ˆæ˜¾ç„¶çš„ï¼Œä½ è¦æœ‰ä¸€é¢—è›‹ã€ä¸€é”…æ°´ï¼Œå’Œä¸€äº›åŠ çƒ­çš„å…ƒç´ ã€‚å¦å¤–æœ‰äº›éå¿…è¦çš„å› å’Œç¼˜ï¼Œåƒæ˜¯å¨æˆ¿ã€ç¯å…‰ã€è®¡æ—¶å™¨ï¼Œè¿˜æœ‰ä¸€åªæŠŠè›‹æ”¾è¿›é”…å­çš„æ‰‹ã€‚å¦å¤–ä¸€ä¸ªé‡è¦çš„æ¡ä»¶ï¼Œå°±æ˜¯æ²¡æœ‰åƒæ˜¯ç”µåŠ›ä¸­æ–­æˆ–æ˜¯å±±ç¾Šè·Ÿè¿›æ¥æ‰“ç¿»é”…å­ä¹‹ç±»çš„å¹²æ‰°ã€‚æ­¤å¤–ï¼Œæ¯ä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚æ¯é¸¡ï¼Œéƒ½éœ€è¦æœ‰å¦ä¸€å¥—å…·è¶³çš„å› ç¼˜æ¡ä»¶ã€‚éœ€è¦æœ‰å¦ä¸€åªæ¯é¸¡ç”Ÿä¸‹è›‹æ‰èƒ½å­µå‡ºå®ƒï¼Œè¿˜è¦æœ‰å®‰å…¨çš„åœ°æ–¹ï¼Œæœ‰é£Ÿç‰©æ‰èƒ½è®©å®ƒæˆé•¿ã€‚é¸¡çš„é£Ÿç‰©ä¹Ÿè¦æœ‰é€‚åˆçš„åœ°æ–¹ç”Ÿé•¿ï¼Œå¹¶ä¸”è¦èƒ½è®©å®ƒåƒè¿›å»æ‰è¡Œã€‚æˆ‘ä»¬å¯ä»¥å°†éå¿…è¦å’Œå¿…è¦æ¡ä»¶ä¸€ç›´åˆ†æåˆ°å°äºåŸå­çš„ç¨‹åº¦ï¼Œè€Œåœ¨è¿™ä¸ªåˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œå„ç§å½¢æ€ã€å½¢çŠ¶ã€åŠŸèƒ½å’Œæ ‡ç­¾ä¹Ÿä¼šä¸æ–­åœ°å¢åŠ ã€‚</p>
<p>å½“æ— æ•°çš„å› ç¼˜å’Œåˆåœ¨ä¸€èµ·ï¼Œè€Œä¸”æ²¡æœ‰éšœç¢ä¸å¹²æ‰°ï¼Œç»“æœæ˜¯å¿…ç„¶çš„ã€‚è®¸å¤šäººè¯¯ä»¥ä¸ºè¿™æ˜¯æ³¨å®šçš„æˆ–æ˜¯è¿æ°”æ‰€è‡´ã€‚ç„¶è€Œï¼Œåˆ°äº†ä¸€ä¸ªç¨‹åº¦ä»¥åï¼Œå³ä½¿æˆ‘ä»¬ç¥ˆæ±‚è›‹ä¸è¦ç…®ç†Ÿï¼Œå®ƒè¿˜æ˜¯ä¼šç†Ÿçš„ã€‚</p>
<p>å°±åƒè›‹ä¸€æ ·ï¼Œæ‰€æœ‰çš„ç°è±¡æ˜¯ç”±æ— æ•°çš„æˆåˆ†æ‰€ç»„æˆï¼Œå› æ­¤å®ƒä»¬æ˜¯å¯å˜çš„ã€‚è¿™äº›æ— æ•°çš„æˆåˆ†å‡ ä¹éƒ½ä¸æ˜¯æˆ‘ä»¬æ‰€èƒ½æ§åˆ¶çš„ï¼Œæ‰€ä»¥ä¼šè®©æˆ‘ä»¬çš„æœŸå¾…è½ç©ºã€‚è¿™ç§ä¸å¯é¢„æ–™æ€§ï¼Œéåœ¨äºæ‰€æœ‰çš„ç‰©è´¨ã€æ„Ÿå—ã€æƒ³è±¡ã€ä¼ ç»Ÿã€çˆ±æƒ…ã€ä¿¡ä»»ã€ä¸ä¿¡ä»»ã€æ€€ç–‘è®ºï¼Œç”šè‡³ä¸Šå¸ˆå’Œå¼Ÿå­ä»¥åŠäººä¸ç¥ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>ä¿¡ä»°ï¼Œæ€€ç–‘è®ºä»¥åŠæ‰€æœ‰å’Œåˆçš„ç°è±¡ä¸€æ ·ï¼Œéƒ½æ˜¯æ— å¸¸çš„ã€‚</p>
<p>æœ‰äº›äººåˆ°ç°åœ¨è¿˜è®¤ä¸ºé©¬å…‹Â·æŸ¥æ™®æ›¼(Mark Chapman)æ˜¯è°‹æ€çº¦ç¿°Â·è“ä¾¬(John Lennon)å”¯ä¸€çš„ç½ªçŠ¯ã€‚å½“æˆ‘ä»¬èƒ½äº†è§£ä¸€ä¸ªç—…æ€è€Œé¥±å—æŠ˜ç£¨çš„å¿ƒæ˜¯å¦‚ä½•å½¢æˆï¼Œå¹¶ä¸”çŸ¥é“å®ƒæ˜¯åœ¨ä»€ä¹ˆæ ·çš„æƒ…å†µä¸‹è¿ä½œï¼Œå°±æ¯”è¾ƒèƒ½å¤Ÿç†è§£å¹¶å®½æ•ä¸–ç•Œä¸Šä¼—å¤šçš„é©¬å…‹â€æŸ¥æ™®æ›¼ã€‚å½“æ¡ä»¶æˆç†Ÿï¼Œå°±åƒè›‹ç…®ç†Ÿäº†ä¸€æ ·ï¼Œå³ä½¿æˆ‘ä»¬ç¥ˆç¥·æš—æ€äº‹ä»¶ä¸è¦å‘ç”Ÿï¼Œå®ƒè¿˜æ˜¯é¿å…ä¸äº†ã€‚è¶…è¿‡äº†æŸä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘ä»¬è¦æ”¹å˜æ¡ä»¶çš„ä¼å›¾å’Œè¡Œä¸ºå°±ä¼šå¾’åŠ³æ— åŠŸäº†ã€‚</p>
<p>ææƒ§å’Œç„¦è™‘æ˜¯äººç±»å¿ƒæ™ºä¸­ä¸»è¦çš„å¿ƒç†çŠ¶æ€ã€‚ææƒ§çš„èƒŒåæ˜¯å¯¹ç¡®å®šæ€§ä¸æ–­çš„æ¸´æ±‚ã€‚æˆ‘ä»¬å¯¹æœªçŸ¥æ„Ÿåˆ°ææƒ§ã€‚äººå¿ƒå¯¹è‚¯å®šçš„æ¸´æœ›ï¼Œæ˜¯æ ¹æ¤äºæˆ‘ä»¬å¯¹æ— å¸¸çš„ææƒ§ã€‚</p>
<p><strong>ä½†æˆ‘ä»¬å¸¸å¸¸å¿˜è®°è‡ªå·±çš„æ¥æ—¥ä¸€ç›´éƒ½æ˜¯æœ‰é™çš„ã€‚å³ä½¿ç†æ™ºä¸ŠçŸ¥é“æœ‰ç”Ÿå¿…æœ‰æ­»ï¼Œä¸€åˆ‡å’Œåˆç»ˆå°†åˆ†æ•£ï¼Œæˆ‘ä»¬çš„æƒ…ç»ªçŠ¶æ€è¿˜æ˜¯å¸¸å¸¸ä¼šå›åˆ°ç›¸ä¿¡æ’å¸¸çš„æ¨¡å¼ï¼Œå®Œå…¨å¿˜è®°ç›¸äº’ä¾å­˜æ€§ã€‚è¿™ç§ä¹ æ°”ä¼šé€ æˆå„ç§è´Ÿé¢çš„æƒ…å†µï¼Œåƒæ˜¯åæ‰§ã€å¯‚å¯ã€ç½ªæ¶æ„Ÿç­‰ç­‰ã€‚æˆ‘ä»¬ä¼šè§‰å¾—è¢«æ¬ºéª—ã€è¢«å¨èƒã€è¢«è™å¾…ã€è¢«å†·è½ï¼Œä»¿ä½›è¿™ä¸ªä¸–ç•Œåªå¯¹æˆ‘ä»¬ä¸å…¬å¹³ã€‚</strong></p>
<p>ä½›é™€ä¸æ˜¯ä¸€ä¸ªæ‚²è§‚è€…ã€ä¹Ÿä¸æ˜¯æœ«æ—¥è®ºè€…ï¼Œä»–æ˜¯é‡è§†å®é™…è€…ï¼Œè€Œæˆ‘ä»¬å´å¤šæ˜¯é€ƒé¿ç°å®è€…ã€‚å½“ä»–è¯´ä¸€åˆ‡å’Œåˆçš†æ˜¯æ— å¸¸ï¼Œä»–å¹¶ä¸è®¤ä¸ºé‚£æ˜¯åæ¶ˆæ¯ï¼Œè€Œæ˜¯ç®€å•ã€ç§‘å­¦çš„äº‹å®ã€‚æˆ‘ä»¬èƒ½è®¤æ¸…å› ç¼˜çš„ä¸ç¨³å®šï¼Œå°±ä¼šäº†è§£è‡ªå·±æœ‰åŠ›é‡è½¬åŒ–éšœç¢ï¼Œå¹¶ä¸”å®Œæˆä¸å¯èƒ½çš„ä»»åŠ¡ã€‚ç”Ÿæ´»ä¸­çš„å„ä¸ªå±‚é¢éƒ½æ˜¯å¦‚æ­¤ã€‚å¦‚æœä½ ç°åœ¨æ²¡æœ‰ä¸€å°æ³•æ‹‰åˆ©ï¼Œä½ å®Œå…¨æœ‰å¯èƒ½åˆ›é€ å‡ºå› ç¼˜è€Œæ‹¥æœ‰ä¸€å°ã€‚åªè¦ä¸–ä¸Šæœ‰æ³•æ‹‰åˆ©ï¼Œä½ å°±æœ‰æœºä¼šå»æ‹¥æœ‰å®ƒã€‚åŒæ ·çš„ï¼Œå¦‚æœä½ æƒ³æ´»ä¹…ä¸€ç‚¹ï¼Œå¯ä»¥é€‰æ‹©ä¸æŠ½çƒŸå’Œå¤šè¿åŠ¨ã€‚åˆç†çš„å¸Œæœ›æ˜¯å­˜åœ¨çš„ã€‚è€Œç»æœ›ï¼Œå’Œå®ƒçš„åé¢â€”æ¨¡ä¸€æ ·ï¼Œéƒ½æ˜¯ç›¸ä¿¡æ’å¸¸çš„ç»“æœã€‚</p>
]]></content>
      <categories>
        <category>Books</category>
      </categories>
      <tags>
        <tag>ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­£è§â€”â€”ä½›é™€çš„è¯æ‚Ÿï¼ˆäºŒï¼‰è¯¸æ¼çš†è‹¦(é€‰æ‘˜)</title>
    <url>/2023/08/20/Other/Books_%E6%AD%A3%E8%A7%81-%E4%BD%9B%E9%99%80%E7%9A%84%E8%AF%81%E6%82%9F-%E8%8A%82%E9%80%89-2/</url>
    <content><![CDATA[<p>æ‚‰è¾¾å¤šæ²¡æœ‰ç»§ç»­å‰è¡Œï¼Œå†³å®šç•™åœ¨å½“åœ°ç¦…ä¿®ã€‚ä»–åœ¨é™„è¿‘çš„ä¸€æ£µæ¯•é’µç½—æ ‘ä¸‹æ‰¾åˆ°ä¸€å—å¹³å¦çš„çŸ³å¤´ï¼Œé“ºä¸Šå‰ç¥¥è‰å½“åå«ã€‚ä»–é™é»˜åœ°ç«‹ä¸‹èª“è¨€ï¼Œæ­¤èº«å¯çƒ‚ï¼Œæˆ‘å¯èƒ½åŒ–ä¸ºå°˜åœŸã€‚ä½†ç›´åˆ°æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ‘ç»ä¸èµ·èº«ï¼ˆæˆ‘ä»Šè‹¥ä¸è¯ï¼Œæ— ä¸Šå¤§è©æï¼Œå®å¯ç¢æ­¤èº«ï¼Œç»ˆä¸èµ·æ­¤åº§ï¼‰ã€‚</p>
<p>é—®ä¸€ä¸ªä½›æ•™å¾’â€œä»€ä¹ˆæ˜¯äººç”Ÿçš„ç›®çš„ï¼Ÿâ€æ˜¯ä¸æ°å½“çš„ã€‚å› ä¸ºè¿™ä¸ªé—®é¢˜æš—å–»åœ¨æŸä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿè®¸åœ¨ä¸€ä¸ªæ´ç©´ä¹‹ä¸­æˆ–è€…åœ¨ä¸€äººå±±å²­ä¹‹ä¸Šï¼Œå­˜åœ¨ç€ä¸€ä¸ªç©¶ç«Ÿçš„ç›®çš„ã€‚ä»¿ä½›æˆ‘ä»¬å¯ä»¥é€è¿‡è¿½éšåœ£è€…ï¼Œé˜…è¯»ä¹¦ç±ä»¥åŠç†Ÿæ‚‰ç§˜æ•™ä¿®è¡Œï¼Œæ¥è§£å¼€è¿™ä¸ªç§˜å¯†ã€‚å¦‚æœè¿™é—®é¢˜æ˜¯å‡è®¾åœ¨äº¿ä¸‡å¹´ä»¥å‰ï¼Œæœ‰æŸä¸ªäººæˆ–ç¥è®¾è®¡äº†ä¸€ä¸ªäººç”Ÿç›®çš„å›¾è¡¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªæœ‰ç¥è®ºçš„è§‚ç‚¹ã€‚ä½›æ•™å¾’ä¸ç›¸ä¿¡æœ‰ä¸ªå…¨èƒ½çš„åˆ›é€ è€…ï¼Œè€Œä¸”ä»–ä»¬ä¸ä¿¡ä¸ºç”Ÿå‘½çš„ç›®çš„å·²ç»ã€æˆ–éœ€è¢«å†³å®šå’Œå®šä¹‰ã€‚</p>
<p>å³ä½¿åœ¨ä¸ªäººèº«ä¸Šï¼Œç—›è‹¦å’Œå¿«ä¹çš„å®šä¹‰ä¹Ÿæ—¶æœ‰å˜åŠ¨ã€‚ä¸€ä¸ªè½»ä½»çš„è°ƒæƒ…æ—¶åˆ»ï¼Œå¯èƒ½å› ä¸ºå…¶ä¸­ä¸€ä¸ªäººæƒ³è¦æ›´è®¤çœŸçš„å…³ç³»è€Œçªç„¶å˜è°ƒï¼ŒæœŸå¾…è½¬ä¸ºææƒ§ã€‚å½“ä½ æ˜¯ä¸ªå°å­©çš„æ—¶å€™ï¼Œåœ¨æ²™æ»©ä¸Šå †ç­‘æ²™å ¡å°±æ˜¯å¿«ä¹ã€‚åœ¨é’å°‘å¹´æ—¶æœŸï¼Œçœ‹ç€ç©¿æ¯”åŸºå°¼çš„å¥³å­©ï¼Œå’Œèµ¤è£¸ä¸Šèº«çš„ç”·å­©å†²æµªæ˜¯å¿«ä¹ã€‚åœ¨ä¸­å¹´ï¼Œé‡‘é’±å’Œäº‹ä¸šæ˜¯å¿«ä¹ã€‚å½“ä½ å…«åå¤šå²çš„æ—¶å€™ï¼Œæ”¶é›†é™¶ç“·ç›ç½æ˜¯å¿«ä¹ã€‚å¯¹è®¸å¤šäººè€Œè¨€ï¼Œä¸æ–­è°ƒé€‚äºè¿™äº›æ— å°½è€Œåˆç»å¸¸å˜åŒ–çš„å¿«ä¹å®šä¹‰ï¼Œå³æ˜¯â€œäººç”Ÿçš„ç›®çš„â€ã€‚</p>
<p>æˆ‘ä»¬äººç±»åœ¨è¿½æ±‚å¿«ä¹ã€æ­¢æ¯ç—›è‹¦ä¸Šï¼Œç”¨å°½äº†æ— æ•°çš„æ–¹æ³•å’Œå·¥å…·ï¼Œè¿œè¶…è¿‡ä»»ä½•å…¶å®ƒçš„å—œå¥½å’ŒèŒä¸šã€‚å› æ­¤æˆ‘ä»¬æ‹¥æœ‰ç”µæ¢¯ã€ç¬”è®°å‹ç”µè„‘ã€å……ç”µç”µæ± ã€ç”µåŠ¨æ´—ç¢—æœºã€è‡ªåŠ¨å¼¹å‡ºå®Œç¾åœŸå¸çš„çƒ¤é¢åŒ…æœºã€ç‹—ç²ªå¸å°˜å™¨ã€ç”µåŠ¨é¼»æ¯›ä¿®å‰ªå™¨ã€æ¸©çƒ­åå«é©¬æ¡¶ã€å¥´ä½›å¡å› éº»é†‰è¯ï¼ˆ Novocaineï¼‰ã€è¡ŒåŠ¨ç”µè¯ã€å¨è€Œåˆšã€æ•´é“ºåœ°æ¯¯å­â€¦â€¦ï¼Œç„¶è€Œä¸å¯é¿å…çš„ï¼Œè¿™äº›ä¾¿æ·ä¹Ÿåˆ¶é€ äº†ç­‰é‡çš„å¤´ç—›ã€‚</p>
<p>æ‚‰è¾¾å¤šå½“æ—¶ä¹Ÿæ˜¯åœ¨è¯•å›¾æ ¹é™¤ç—›è‹¦ã€‚ä½†ä»–ä¸æ˜¯æ¢¦æƒ³ç€è¯¸å¦‚å±•å¼€æ”¿æ²»æ”¹é©ã€ç§»æ°‘åˆ°å¦ä¸€ä¸ªæ˜Ÿçƒæˆ–åˆ›é€ ä¸–ç•Œæ–°ç»æµï¼›ä»–ç”šè‡³æ²¡æœ‰æƒ³åˆ°è¦åˆ›é€ ä¸€ä¸ªå®—æ•™ï¼Œæˆ–å‘å±•ä¸€å¥—èƒ½å¸¦æ¥å®‰è¯¦ä¸å’Œè°çš„è¡Œä¸ºå‡†åˆ™ã€‚ä»–ä»¥å¼€æ”¾çš„å¿ƒçµæ¥æ¢ç´¢ç—›è‹¦ï¼Œé€è¿‡å‹¤å¥‹ä¸æ‡ˆçš„æ²‰æ€ï¼Œæ‚‰è¾¾å¤šå‘ç°ï¼Œè¿½æœ¬æº¯æºï¼Œå¯¼è‡´ç—›è‹¦çš„æ˜¯äººçš„æƒ…ç»ªã€‚äº‹å®ä¸Šä¸Šï¼Œæƒ…ç»ªå³æ˜¯ç—›è‹¦ã€‚ä¸è®ºå¦‚ä½•ï¼Œç›´æ¥æˆ–é—´æ¥çš„ï¼Œä¸€åˆ‡æƒ…ç»ªéƒ½æ˜¯ç”Ÿäºè‡ªç§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬éƒ½ä¸æ‰§ç€äºè‡ªæˆ‘æœ‰å…³ã€‚æ›´è¿›ä¸€æ­¥çš„ï¼Œä»–ä¹Ÿå‘ç°ï¼Œæƒ…ç»ªè™½ç„¶çœ‹ä¼¼çœŸå®ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªäººæœ¬å…·å­˜åœ¨çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬ä¸æ˜¯ä¸ç”Ÿä¿±æ¥çš„ï¼Œä¹Ÿä¸æ˜¯æŸä¸ªäººæˆ–æŸä¸ªç¥å¼ºåŠ åœ¨æˆ‘ä»¬èº«ä¸Šçš„è¯…å’’æˆ–æ¤å…¥ã€‚å½“æŸäº›ç‰¹å®šçš„å› ä¸ç¼˜èšåˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œæƒ…ç»ªå°±ä¼šç”Ÿèµ·ï¼Œä¾‹å¦‚å½“ä½ çªç„¶è®¤ä¸ºæŸä¸ªäººåœ¨æ‰¹è¯„ä½ ã€å¿½è§†ä½ ï¼Œæˆ–è€…å‰¥å¤ºä½ çš„åˆ©ç›Šæ—¶ã€‚ç„¶åï¼Œç›¸å¯¹åº”çš„æƒ…ç»ªå°±ä¼šæ¥ç€ç”Ÿèµ·ï¼Œåœ¨æ¥å—ã€é™·å…¥è¿™äº›æƒ…ç»ªçš„å½“ä¸‹ï¼Œæˆ‘ä»¬å°±å¤±å»äº†è§‰çŸ¥å’Œæ¸…æ˜ã€‚æˆ‘ä»¬â€œè¢«é¼“åŠ¨â€äº†ã€‚å› æ­¤æ‚‰è¾¾å¤šå‘ç°ä»–çš„è§£å†³æ–¹æ³•â€”-è§‰çŸ¥ã€‚å¦‚æœä½ è®¤çœŸåœ°æƒ³è¦æ ¹é™¤ç—›è‹¦ï¼Œä½ å¿…é¡»åŸ¹å…»è§‰çŸ¥ï¼Œç•™å¿ƒä½ çš„æƒ…ç»ªï¼Œå¹¶ä¸”å­¦ä¼šå¦‚ä½•é¿å…è¢«é¼“åŠ¨èµ·æ¥ã€‚</p>
<p>å¦‚æœä½ åƒæ‚‰è¾¾å¤šä¸€æ ·åœ°æ£€è§†æƒ…ç»ªï¼Œè¯•å›¾æ‰¾å‡ºå®ƒä»¬çš„èµ·æºï¼Œä½ å°†ä¼šå‘ç°å®ƒä»¬æ ¹æ¤äºè¯¯è§£ï¼Œå› æ­¤æ ¹æœ¬ä¸Šæ˜¯é”™è¯¯çš„ã€‚åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„æƒ…ç»ªéƒ½æ˜¯ä¸€ç§åè§ï¼Œåœ¨æ¯ä¸€ç§æƒ…ç»ªä¹‹ä¸­ï¼Œéƒ½å­˜åœ¨æœ‰åˆ†åˆ«å¿ƒçš„æˆåˆ†ã€‚</p>
<p>çœ‹é€äº†å®«å»·ç”Ÿæ´»çš„è¡¨è±¡ï¼Œæ‚‰è¾¾å¤šç°åœ¨èƒ½å¤Ÿçœ‹è§è‡ªå·±çš„èº«ä½“æ˜¯ä¸å…·æœ¬è´¨çš„ã€‚åœ¨ä»–çš„çœ¼ä¸­ï¼Œç«åœˆå’Œèº«ä½“å…·æœ‰ç›¸åŒçš„æœ¬æ€§ã€‚å¦‚æœæœ‰äººç›¸ä¿¡å…¶ä¸­ä¹‹ä¸€çœŸå®å­˜åœ¨â€”-ä¸è®ºæ˜¯çŸ­æš‚çš„æˆ–æ’å¸¸çš„â€”â€”é‚£ä¹ˆä»–çš„ä¿¡å¿µå°±æ˜¯æ ¹æºäºè¯¯è§£ï¼›å¦‚æ­¤ï¼Œä¾¿æ˜¯å¤±å»äº†è§‰å¯Ÿï¼Œä¹Ÿå°±æ˜¯ä½›æ•™å¾’æ‰€è¯´çš„æ— æ˜ã€‚æˆ‘ä»¬çš„æƒ…ç»ªï¼Œå°±æ˜¯ä»è¿™æ— æ˜æ‰€ç”Ÿèµ·ã€‚ä»å¤±å»äº†è§‰å¯Ÿåˆ°æƒ…ç»ªç”Ÿèµ·çš„è¿‡ç¨‹ï¼Œå¯ä»¥ç”¨å››çœŸè°›å®Œå…¨è§£é‡Šã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè°ˆåˆ°ã€‚</p>
<p>é­”ç½—æƒ³è¦äº‰å–æ›´å¤šè¿½éšè€…ï¼Œå› è€Œèªæ˜åœ°é¼“å¹è‡ªç”±ï¼Œä½†æ˜¯å¦‚æœæœ‰äººçœŸçš„è¡Œä½¿è‡ªç”±ï¼Œä»–ä¸ä¸€å®šä¼šå–œæ¬¢ã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬åªæƒ³è¦è®©è‡ªå·±ï¼Œè€Œä¸æƒ³è®©ä»–äººæ‹¥æœ‰è‡ªç”±ã€‚éš¾æ€ªï¼Œæˆ‘ä»¬çœŸçš„è¡Œä½¿æ‰€æœ‰çš„è‡ªç”±ï¼Œå°±ä¸ä¼šè¢«é‚€è¯·å»å‚åŠ ä»»ä½•æ´¾å¯¹äº†ã€‚</p>
<p>æ‚‰è¾¾å¤šçš„è§£ç­”æ˜¯â€”-åŸ¹å…»å¯¹æƒ…ç»ªçš„è§‰å¯Ÿã€‚å¦‚æœæƒ…ç»ªæ­£åœ¨èµ·çš„æ—¶å€™ï¼Œä½ èƒ½å¤Ÿæœ‰æ‰€è§‰å¯Ÿï¼Œå³ä½¿åªæ˜¯ä¸€ç‚¹ç‚¹ï¼Œä¸èƒ½å¤Ÿé™åˆ¶å®ƒä»¬çš„æ´»åŠ¨ï¼›å®ƒä»¬å˜æˆè±¡æœ‰ç›‘æŠ¤äººåœ¨æ—çš„é’å°‘å¹´ã€‚æœ‰äººåœ¨ç›‘è§†ç€ï¼Œé­”ç½—çš„åŠ›é‡å°±ä¼šå‡å¼±ã€‚æ‚‰è¾¾å¤šæ²¡æœ‰è¢«æ¯’ç®­æ‰€ä¼¤ï¼Œå› ä¸ºä»–è§‰å¯Ÿåˆ°è¿™äº›åªä¸è¿‡æ˜¯å¹»ç›¸ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬è‡ªå·±å¼ºå¤§çš„æƒ…ç»ªï¼Œä¹Ÿå¯ä»¥å˜æˆè±¡èŠ±ç“£ä¸€èˆ¬åœ°ä¸å…·æ€ä¼¤åŠ›ã€‚å½“å¤©å¥³æ¥è¿‘æ‚‰è¾¾å¤šçš„æ—¶å€™ï¼Œä»–æ¸…æ¥šåœ°äº†è§£ï¼Œå¥¹ä»¬å¦‚åŒç«åœˆï¼Œåªæ˜¯å’Œåˆè€Œæˆçš„ï¼Œå› æ­¤å¥¹ä»¬å¤±å»äº†è¯±æƒ‘åŠ›ï¼Œæ— æ³•åŠ¨ä»–ä¸€ä¸ä¸€æ¯«ã€‚åŒæ ·çš„ï¼Œåªè¦äº†è§£æˆ‘ä»¬æ‰€æ¬²æ±‚çš„å¯¹è±¡äº‹å®ä¸Šæ˜¯å’Œåˆè€Œæˆçš„ç°è±¡ï¼Œå°±èƒ½ç ´é™¤è¯±æƒ‘çš„é­”å’’ã€‚</p>
<p>å½“ä½ å¼€å§‹æ³¨æ„åˆ°æƒ…ç»ªæ‰€èƒ½å¤Ÿé€ æˆçš„æŸå®³ï¼Œè§‰çŸ¥å°±ä¼šå¼€å§‹å‘å±•ã€‚å½“ä½ æœ‰äº†è§‰çŸ¥â€”-ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ çŸ¥é“è‡ªå·±æ­£ç«™åœ¨æ‚¬å´–ä¸Šè¡Œèµ°ä¸å†é‚£ä¹ˆææ€–ï¼Œäº‹å®ä¸Šï¼Œå®ƒåè€Œæ˜¯éå¸¸åˆºæ¿€çš„ã€‚ä¸çŸ¥æ‰æ˜¯ææƒ§çš„çœŸæ­£æ ¹æºã€‚è§‰çŸ¥ä¸ä¼šå¦¨ç¢ä½ çš„ç”Ÿæ´»ï¼Œåè€Œè®©ç”Ÿå‘½æ›´åŠ å……å®ã€‚å¦‚æœä½ åœ¨äº«ç”¨ä¸€æ¯èŒ¶ï¼Œè€Œä¸”äº†è§£çŸ­æš‚äº‹ç‰©çš„ç”˜ä¸è‹¦ï¼Œä½ å°†èƒ½å¤ŸçœŸæ­£çš„äº«å—é‚£æ¯èŒ¶ã€‚</p>
]]></content>
      <categories>
        <category>Books</category>
      </categories>
      <tags>
        <tag>ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­£è§â€”â€”ä½›é™€çš„è¯æ‚Ÿï¼ˆä¸‰ï¼‰è¯¸æ³•æ— æˆ‘ (é€‰æ‘˜)</title>
    <url>/2023/08/20/Other/Books_%E6%AD%A3%E8%A7%81-%E4%BD%9B%E9%99%80%E7%9A%84%E8%AF%81%E6%82%9F-%E8%8A%82%E9%80%89-3/</url>
    <content><![CDATA[<p>æ‰€æœ‰è¿™äº›ä¸åŒçš„æƒ…ç»ªåŠå…¶ç»“æœï¼Œéƒ½æ¥è‡ªäºé”™è¯¯çš„ç†è§£ï¼Œè€Œè¿™ä¸ªè¯¯è§£æ¥è‡ªä¸€ä¸ªæºå¤´ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰æ— æ˜çš„æ ¹æºâ€”-æ‰§ç€äºè‡ªæˆ‘ã€‚</p>
<p>è‡ªæˆ‘åªæ˜¯å¦ä¸€ä¸ªè¯¯è§£ã€‚å½“æˆ‘ä»¬çœ‹ç€è‡ªå·±çš„èº«ä½“ï¼ˆè‰²ï¼‰ã€æ„Ÿå—ï¼ˆå—ï¼‰ã€æƒ³æ³•ï¼ˆæƒ³ï¼‰ã€è¡Œä¸ºï¼ˆè¡Œï¼‰å’Œæ„è¯†ï¼ˆè¯†ï¼‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸åˆ¶é€ å‡ºä¸€ç§è‡ªæˆ‘çš„æ¦‚å¿µã€‚äººä»¬å—åˆ¶çº¦ï¼ŒæŠŠè¿™ç§æ¦‚å¿µè§†ä¸ºæ’å¸¸è€Œä¸”çœŸå®çš„ã€‚</p>
<p>ä½†æ˜¯æ‚‰è¾¾å¤šäº†æ‚Ÿåˆ°ï¼Œä¸è®ºæ˜¯åœ¨èº«ä½“é‡Œæˆ–å¤–ï¼Œéƒ½æ‰¾ä¸åˆ°ä¸€ä¸ªç‹¬ç«‹å­˜åœ¨çš„å®ä½“ï¼Œè¶³ä»¥è¢«ç§°ä¸ºè‡ªæˆ‘ã€‚å¦‚åŒç«åœˆçš„è§†è§‰é”™å¹»ä¸€èˆ¬ï¼Œè‡ªæˆ‘ä¹Ÿæ˜¯è™šå¹»çš„ã€‚å®ƒæ˜¯è°¬è¯¯çš„ï¼›åŸºæœ¬ä¸Šé”™è¯¯ï¼Œè€Œç©¶ç«Ÿä¸Šä¸å­˜åœ¨ã€‚ä½†æ˜¯å¦‚åŒæˆ‘ä»¬è¢«ç«åœˆæ‰€è¿·æƒ‘ä¸€èˆ¬ï¼Œæˆ‘ä»¬ä¹Ÿå…¨éƒ½è¢«è‡ªæˆ‘æ‰€è¿·æƒ‘äº†ï¼Œæ‰§ç€äºè°¬è¯¯çš„è‡ªæˆ‘ï¼Œæ˜¯æ— æ˜çš„è’è°¬è¡Œä¸ºã€‚å®ƒä¸æ–­åœ°åˆ¶é€ æ›´å¤šçš„æ— æ˜ï¼Œå¯¼è‡´äº†å„ç§ç—›è‹¦å’Œå¤±æœ›ã€‚</p>
<p>æ— æ˜å•çº¯çš„å°±æ˜¯ä¸äº†è§£äº‹å®ï¼Œæˆ–å¯¹äº‹å®äº†è§£ä¸æ­£ç¡®ï¼Œæˆ–è®¤è¯†å¾—ä¸å®Œæ•´ã€‚æ‰€æœ‰è¿™äº›å½¢å¼çš„æ— æ˜ï¼Œéƒ½å¯¼è‡´è¯¯è§£å’Œè¯¯åˆ¤ï¼Œé«˜ä¼°å’Œä½ä¼°ã€‚å‡è®¾ä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªæœ‹å‹ï¼Œå¿½ç„¶çœ‹åˆ°ä»–åœ¨è¿œæ–¹çš„ç”°é‡ä¸­ã€‚ä¸€èµ°è¿‘ï¼Œå´å‘ç°ä½ è¯¯æŠŠä¸€ä¸ªç¨»è‰äººå½“åšæ˜¯ä»–äº†ã€‚ä½ ä¸€å®šä¼šæ„Ÿåˆ°å¤±æœ›ã€‚è¿™å¹¶éæœ‰ä¸ªæ¶ä½œå‰§çš„ç¨»è‰äººæˆ–ä½ çš„æœ‹å‹è¯•å›¾å·å·æ‘¸æ‘¸è¯¯å¯¼ä½ ï¼Œè€Œæ˜¯ä½ è‡ªå·±çš„æ— æ˜èƒŒå›äº†ä½ ã€‚ä»»ä½•æºè‡ªæ— æ˜æ‰€åšçš„è¡Œä¸ºï¼Œéƒ½æ˜¯å†’é™©ã€‚æˆ‘ä»¬åœ¨ä¸äº†è§£æˆ–ä¸å®Œå…¨äº†è§£çš„æƒ…å†µä¸‹è¡ŒåŠ¨ï¼Œå°±ä¸ä¼šæœ‰ä¿¡å¿ƒã€‚æˆ‘ä»¬æ ¹æœ¬çš„ä¸å®‰å…¨æ„Ÿå› æ­¤è€Œç”Ÿèµ·ã€‚åˆ›é€ å‡ºæ‰€æœ‰è¿™äº›æœ‰åæˆ–æ— åã€å·²çŸ¥æˆ–æœªçŸ¥çš„å„ç§æƒ…ç»ªã€‚</p>
<p>æ‚‰è¾¾å¤šäº†æ‚Ÿåˆ°è‡ªæˆ‘å¹¶éç‹¬ç«‹å­˜åœ¨ã€è‡ªæˆ‘åªä¸è¿‡æ˜¯ä¸€ä¸ªæ ‡ç­¾ã€å› è€Œæ‰§ç€äºè‡ªæˆ‘å°±æ˜¯æ— æ˜ï¼Œè¿™å¯èƒ½æ˜¯äººç±»å†å²ä¸Šæœ€å¤§çš„å‘ç°ã€‚ç„¶è€Œï¼Œè™½ç„¶è‡ªæˆ‘è¿™ä¸ªæ ‡ç­¾æˆ–è®¸æ¯«æ— æ ¹æ®ï¼Œè¦æ‘§æ¯å®ƒå´ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ã€‚æ‰§ç€äºè¿™ä¸ªç§°ä½œè‡ªæˆ‘çš„æ ‡ç­¾ï¼Œæ˜¯æ‰€æœ‰çš„æ¦‚å¿µä¸­æœ€éš¾ä»¥ç ´é™¤çš„ã€‚</p>
<p>é­”ç½—åªä¸è¿‡æ˜¯æ‚‰è¾¾å¤šçš„æˆ‘æ‰§ã€‚æ•…äº‹ä¸­ï¼Œæè¿°é­”ç½—æ˜¯ä¸ªè‹±ä¿Šå¨æ­¦ã€æ— å½¹ä¸å…‹çš„æˆ˜å£«ï¼Œè¿™ä¸ªæ¯”å–»ç›¸å½“é€‚åˆ‡ã€‚è‡ªæˆ‘ï¼Œå¦‚åŒé­”ç½—ä¸€èˆ¬ï¼Œå¨åŠ›å¼ºå¤§ä¸”è´ªå¾—æ— åŒã€è‡ªæˆ‘ä¸­å¿ƒä¸”è™šä¼ªæ¬ºè¯ˆã€è´ªæ±‚ä¼—äººç›®å…‰ã€æœºæ•ä¼¶ä¿ä¸”çˆ±æ…•è™šè£ã€‚æˆ‘ä»¬å¾ˆéš¾è®°ä½ï¼Œè‡ªæˆ‘å¦‚åŒç«åœˆçš„å¹»ç›¸ä¸€èˆ¬ï¼Œæ˜¯å’Œåˆè€Œæˆã€ä¸ç‹¬ç«‹å­˜åœ¨è€Œä¸”å–„äºæ”¹å˜ã€‚</p>
<p>éª„æ…¢å’Œè‡ªæ€œæ¯æ¯ç›¸å…³ã€‚æˆ‘æ‰§çº¯ç²¹æ˜¯ä¸€ç§è‡ªæˆ‘çºµå®¹ï¼Œè®¤ä¸ºè‡ªå·±çš„ç”Ÿå‘½æ¯”å…¶ä»–äººçš„éƒ½æ›´è‰°éš¾æ›´æ‚²å“€ã€‚å½“è‡ªæˆ‘å‘å±•å‡ºè‡ªæ€œçš„æ—¶å€™ï¼Œä¾¿è®©å…¶å®ƒäººç”Ÿèµ·æ‚²æ‚¯çš„ç©ºé—´æ¶ˆå¤±äº†ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬ä¸è®¤ä¸ºè‡ªå·±è¿™ä¹ˆç»æœ›ï¼Œè€Œä¸”ç›¸ä¿¡è‡ªå·±æ˜¯å—è¿‡æ•™è‚²ã€æ­£å¸¸ã€æ¸…é†’çš„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬çœ‹è§åŠæ„Ÿå—ä¸€åˆ‡éƒ½æ˜¯çœŸå®å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬çš„è¡Œä¸ºå°±å¦‚åŒé‚£ä½æ²™æ¼ ä¸­çš„è¿·å¤±è€…ã€‚æˆ‘ä»¬æ€¥åˆ‡åœ°æƒ³è¦æ‰¾åˆ°çœŸå®çš„ä¼´ä¾£å…³ç³»ã€å®‰å…¨æ„Ÿã€è¡¨æ‰¬ã€æˆåŠŸï¼Œæˆ–åªæ˜¯å®‰è¯¦å®é™ã€‚æˆ‘ä»¬ç”šè‡³èƒ½æŠ“åˆ°ä¸æ¬²æœ›ç›¸ä¼¼çš„ä¸œè¥¿ã€‚ä½†å°±è±¡é‚£ä½è¿·å¤±è€…ï¼Œå½“æˆ‘ä»¬ä¾èµ–å¤–åœ¨çš„å®ä½“æ€§æ—¶ï¼Œç»ˆç©¶ä¼šå¤±æœ›ã€‚äº‹ç‰©å¹¶ä¸å¦‚å…¶æ‰€æ˜¾ç°â€”â€“å®ƒä»¬æ˜¯æ— å¸¸çš„ï¼Œè€Œä¸”ä¸å®Œå…¨åœ¨æˆ‘ä»¬çš„æŒæ§ä¹‹ä¸­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è±¡æ‚‰è¾¾å¤šä¸€æ ·ç¡®å®åœ°å»åˆ†æï¼Œå°±ä¼šå‘ç°è¯¸å¦‚å½¢ä½“ã€æ—¶é—´ã€ç©ºé—´ã€æ–¹å‘ã€å¤§å°ç­‰é™„åŠ çš„æ ‡ç­¾ï¼Œéƒ½å¾ˆå®¹æ˜“è¢«è§£æ„ã€‚æ‚‰è¾¾å¤šäº†æ‚Ÿåˆ°ï¼Œç”šè‡³è‡ªæˆ‘éƒ½åªå­˜åœ¨äºç›¸å¯¹çš„å±‚æ¬¡ï¼Œæ°å¦‚æµ·å¸‚èœƒæ¥¼ä¸€èˆ¬ã€‚ä»–çš„ä½“æ‚Ÿï¼Œç»ˆæ­¢äº†æœŸå¾…ã€å¤±æœ›ä¸ç—›è‹¦çš„å¾ªç¯ã€‚åœ¨è¯æ‚Ÿçš„æ—¶åˆ»ï¼Œä»–è‡ªå¿–ï¼Œæˆ‘å·²æ‰¾åˆ°äº†ä¸€æ¡æ·±å¥¥ã€å®‰è¯¦ã€éæç«¯ã€æ¸…æ™°ã€æ»¡æ„¿åˆæœ‰å¦‚ç”˜éœ²ä¸€èˆ¬ä¹‹é“ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘æƒ³è¡¨è¾¾å®ƒï¼Œå¦‚æœæˆ‘æƒ³æ•™ç»™ä»–äººï¼Œæ²¡æœ‰äººæœ‰èƒ½åŠ›å¬é—»äº†è§£ã€‚å› æ­¤æˆ‘å°†ç•™åœ¨æ—ä¸­ï¼Œå®‰ä½äºæ­¤ç¥¥å’ŒçŠ¶æ€ä¹‹ä¸­ã€‚</p>
<p>ç„¶è€Œï¼Œæ‚‰è¾¾å¤šå¹¶éä¸ç†æ€§ï¼Œä»–åªæ˜¯æ˜ç¡®åœ°æŒ‡å‡ºä¸€èˆ¬çš„ã€ç†æ€§çš„æ€æƒŸæ˜¯æœ‰é™çš„ã€‚æˆ‘ä»¬ä¸èƒ½ï¼Œæˆ–ä¸æ„¿è¶…è¶Šæˆ‘ä»¬è‡ªå·±çš„èˆ’é€‚åŒºå»äº†è§£ã€‚ç”¨æ˜¨æ—¥ã€ä»Šæ—¥ã€æ˜æ—¥è¿™ç§çº¿æ€§çš„æ¦‚å¿µæ¥æ“ä½œï¼Œæ¯”å¦‚è¯´â€œæ—¶é—´æ˜¯ç›¸å¯¹çš„â€ï¼Œæ¥å¾—å®ç”¨å¾—å¤šã€‚æˆ‘ä»¬æ²¡æœ‰è¢«è®¾å®šæˆè¿™ä¹ˆæƒ³çš„ï¼šæˆ‘èƒ½ä¸æ”¹å˜å¤§å°æˆ–å½¢çŠ¶è€Œè¿›å…¥é‚£ç‰¦ç‰›è§’ã€‚æˆ‘ä»¬ä¸èƒ½ç ´é™¤å¤§å’Œå°çš„æ¦‚å¿µï¼›ç›¸åçš„ï¼Œæˆ‘ä»¬ä¸€ç›´è¢«ä¸–ä»£ä¼ ä¸‹æ¥çš„å®‰å…¨è€Œç‹­éš˜çš„è§‚ç‚¹æ‰€å±€é™ã€‚ç„¶è€Œï¼Œå½“è¿™äº›è§‚ç‚¹è¢«å®¡è§†æ—¶ï¼Œå´éƒ½ç«™ä¸ä½è„šã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè¿™ä¸ªä¸–ç•Œå¦‚æ­¤ä¾èµ–çš„çº¿æ€§æ—¶é—´è§‚å¿µï¼Œæ— æ³•è¯´æ˜æ—¶é—´æ²¡æœ‰çœŸæ­£çš„èµ·å§‹ä¹Ÿæ²¡æœ‰ç»ˆæ­¢çš„äº‹å®ã€‚</p>
<p>å› æ­¤å½“æˆ‘ä»¬å¬åˆ°ä¸€ä¸ªäººä¸æ”¹å˜å°ºå¯¸ï¼Œå°±å¯å®¹å…¥ç‰¦ç‰›è§’ä¸­æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¤ªå¤šé€‰æ‹©â€”â€“æˆ‘ä»¬å¯ä»¥å¾ˆâ€œç†æ€§â€ï¼Œè®¤ä¸ºè¿™æ ¹æœ¬ä¸å¯èƒ½è€Œé©³æ–¥å®ƒï¼›æˆ–è€…æˆ‘ä»¬å¼•ç”¨æŸç§å¯¹æ³•æœ¯çš„ç¥ç§˜ä¿¡ä»°æˆ–ç›²ç›®å´‡æ‹œè€Œè¯´ï¼Œå½“ç„¶ï¼Œå¯†å‹’æ—¥å·´æ˜¯å¤šä¹ˆä¼Ÿå¤§çš„ç‘œçˆè¡Œè€…ï¼Œå½“ç„¶ä»–èƒ½è¿™ä¹ˆåšï¼Œç”šè‡³è¿˜ä¸åªæ˜¯è¿™äº›å‘¢ã€‚è¿™ä¸¤ç§è§è§£éƒ½æ˜¯æ‰­æ›²çš„ï¼Œå› ä¸ºå¦è®¤æ˜¯ä¸€ç§ä½ä¼°ï¼Œè€Œç›²ä¿¡åˆ™æ˜¯ä¸€ç§é«˜ä¼°ã€‚</p>
<p>ä¸€æ¡æ²³ï¼Œæ°´åœ¨æµï¼Œæ°¸è¿œåœ¨å˜ï¼Œç„¶è€Œæˆ‘ä»¬ä»ç„¶ç§°å®ƒä¸ºæ²³æµã€‚å¦‚æœä¸€å¹´ä¹‹åæˆ‘ä»¬å†åº¦é€ è®¿ï¼Œä¼šè®¤ä¸ºå®ƒæ˜¯åŒä¸€æ¡æ²³ã€‚ä½†å®ƒæ˜¯å¦‚ä½•ç›¸åŒçš„å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å•ç‹¬æŒ‘å‡ºä¸€ä¸ªé¢å‘æˆ–ç‰¹æ€§ï¼Œè¿™ç›¸åŒæ€§å°±ä¸æˆç«‹äº†ã€‚æ°´ä¸åŒäº†ï¼Œåœ°çƒåœ¨é“¶æ²³ä¸­è½¬åŠ¨çš„ä½ç½®ä¹Ÿä¸åŒäº†ï¼Œæ ‘å¶å·²è½ï¼Œæ–°å¶åˆé•¿å‡ºæ¥äº†â€”-å‰©ä¸‹çš„åªæ˜¯ä¸€ä¸ªç›¸ä¼¼äºæˆ‘ä»¬ä¸Šæ¬¡è§åˆ°çš„æ²³æµè¡¨è±¡è€Œå·²ã€‚ä»¥â€œè¡¨è±¡â€ä½œä¸ºâ€œçœŸå®â€çš„åŸºç¡€æ˜¯ç›¸å½“ä¸å¯é çš„ã€‚ç»ç”±ç®€å•çš„åˆ†æï¼Œå°±èƒ½æ˜¾ç¤ºå‡ºæˆ‘ä»¬ä¸€èˆ¬å¯¹æ‰€è°“çœŸå®çš„åŸºç¡€ï¼Œéƒ½åªæ˜¯ä¸€äº›æ¨¡ç³Šçš„æ¦‚æ‹¬å’Œå‡è®¾ã€‚è™½ç„¶æ‚‰è¾¾å¤šä¹Ÿä½¿ç”¨ä¸€èˆ¬äººå®šä¹‰â€œçœŸå®â€æ—¶æ‰€ç”¨çš„å­—çœ¼â€”-éæƒ³è±¡çš„ã€ç¡®å®šçš„ã€ä¸æ”¹å˜çš„ã€æ— æ¡ä»¶çš„â€”-ä½†ä»–æ›´ç²¾ç¡®åœ°ä½¿ç”¨è¿™äº›å­—çœ¼ï¼Œè€Œéæ¦‚æ‹¬æ€§çš„ã€‚åœ¨ä»–çš„è§‚ç‚¹ä¸Šï¼Œä¸æ”¹å˜å¿…ç„¶æ„æŒ‡åœ¨æ‰€æœ‰çš„æ–¹é¢éƒ½ä¸æ”¹å˜ï¼Œç”šè‡³ç»è¿‡å½»åº•çš„åˆ†æåï¼Œä»ç„¶ç»æ— ä¾‹å¤–ã€‚</p>
<p>æ‚‰è¾¾å¤šå‘ç°ï¼Œè¦ç¡®å®šæŸä¸ªä¸œè¥¿çœŸå®å­˜åœ¨çš„å”¯ä¸€åŠæ³•ï¼Œå°±æ˜¯è¯æ˜å®ƒç‹¬ç«‹å­˜åœ¨ï¼Œè€Œä¸”ä¸éœ€è¦è¯ é‡Šã€ä¸èƒ½é€ ä½œæˆ–ä¸ä¼šæ”¹å˜ã€‚å¯¹æ‚‰è¾¾å¤šè€Œè¨€ï¼Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸Šä¸€åˆ‡ä¼¼ä¹èƒ½ä½œç”¨çš„æœºåˆ¶ï¼Œä¸è®ºæ˜¯èº«ä½“çš„ã€æƒ…æ„Ÿçš„åŠæ¦‚å¿µçš„ï¼Œéƒ½æ˜¯ç”±ä¸ç¨³å›ºã€ä¸æ’å¸¸çš„éƒ¨åˆ†æ‰€èšåˆè€Œæˆï¼Œå› æ­¤å®ƒä»¬éšæ—¶éƒ½åœ¨æ”¹å˜ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æƒ¯å¸¸çš„ä¸–ç•Œä¸­äº†è§£è¿™ä¸ªè®ºç‚¹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½ å¯ä»¥è¯´ä½ åœ¨é•œä¸­åå°„çš„å½±åƒä¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå› ä¸ºä»–éœ€è¦ä¾èµ–ä½ ç«™åœ¨é•œå­å‰é¢æ‰è¡Œã€‚ç±»ä¼¼çš„ï¼Œäº‹ç‰©è¦çœŸå®æˆ–ç‹¬ç«‹åœ°å­˜åœ¨ï¼Œå°±ä¸èƒ½è¢«åˆ¶ä½œæˆ–è¢«åˆ›é€ çš„ï¼Œå› ä¸ºè¿™è¦ä¾èµ–åˆ¶é€ è€…ã€‚</p>
<p>è®¸å¤šå¯¹ä½›é™€çš„æ•™æ³•ä¸ç”šäº†è§£çš„äººï¼Œè®¤ä¸ºä½›æ•™æ˜¯ç—…æ€çš„ï¼Œä»–ä»¬è®¤ä¸ºä½›æ•™å¾’å¦å®šå¿«ä¹ï¼Œåªæƒ³åˆ°ç—›è‹¦ã€‚ä»–ä»¬è®¾æƒ³ä½›æ•™å¾’æ’æ–¥ç¾ä¸½åŠèº«ä½“çš„äº«å—ï¼Œå› ä¸ºè¿™äº›æ˜¯è¯±æƒ‘ï¼›ä½›æ•™å¾’åº”è¯¥æ˜¯çº¯å‡€è€ŒèŠ‚åˆ¶çš„ã€‚äº‹å®ä¸Šï¼Œåœ¨æ‚‰è¾¾å¤šçš„æ•™æ³•ä¸­ï¼Œå¹¶ä¸ç‰¹åˆ«åå¯¹ç¾ä¸½å’Œäº«ä¹ç”šäºå…¶å®ƒçš„ä»»ä½•æ¦‚å¿µï¼ï¼åªè¦æˆ‘ä»¬ä¸è®¤ä¸ºå®ƒä»¬æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œè€Œè¿·å¤±å…¶ä¸­ã€‚</p>
<p>è™½ç„¶æ‚‰è¾¾å¤šè¯æ‚Ÿäº†ç©ºæ€§ï¼Œä½†ç©ºæ€§å¹¶ä¸æ˜¯ç”±ä»–æˆ–ä»»ä½•äººæ‰€åˆ¶é€ çš„ã€‚ç©ºæ€§ä¸æ˜¯æ‚‰è¾¾å¤šè·å¾—å¤©å¯çš„ç»“æœï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†è®©äººä»¬å¿«ä¹æ‰€å‘å±•å‡ºæ¥çš„ç†è®ºã€‚ä¸è®ºæ‚‰è¾¾å¤šå¼€ç¤ºä¸å¦ï¼Œç©ºæ€§å³æ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬ç”šè‡³ä¸èƒ½è¯´å®ƒä¸€ç›´éƒ½æ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒè¶…è¶Šæ—¶é—´ï¼Œè€Œä¸”ä¸å…·å½¢å¼ã€‚ç©ºæ€§ä¹Ÿä¸åº”è¢«è§£é‡Šä¸ºå­˜åœ¨çš„å¦å®šï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½è¯´è¿™ä¸ªç›¸å¯¹çš„ä¸–ç•Œä¸å­˜åœ¨ï¼‰ï¼Œå› ä¸ºè¦å¦å®šæŸä¸ªäº‹ç‰©ï¼Œä½ å°±è¦å…ˆæ‰¿è®¤æœ‰æŸä¸ªä¸œè¥¿å¯ä»¥è¢«å¦å®šæ‰è¡Œã€‚ç©ºæ€§ä¹Ÿä¸ä¼šæ¶ˆé™¤æˆ‘ä»¬æ—¥å¸¸çš„ç»éªŒã€‚æ‚‰è¾¾å¤šä»æ¥æ²¡è¯´è¿‡æœ‰ä»€ä¹ˆå¯ä»¥å–ä»£æˆ‘ä»¬æ‰€è§‰å—çš„æ›´å£®ä¸½ã€æ›´ç¾å¥½ã€æ›´çº¯ç²¹æˆ–æ›´ç¥åœ£çš„ä¸œè¥¿ã€‚ä»–ä¹Ÿä¸æ˜¯è™šæ— ä¸»ä¹‰è€…ï¼Œå¦å®šä¸–é—´å­˜åœ¨äº‹ç‰©çš„æ˜¾ç°ä¸åŠŸèƒ½ã€‚</p>
<p>æ‚‰è¾¾å¤šä¼šåŒæ„è¿™ä¸¤ç§æƒ…å†µï¼ï¼å½“ä½ é†’ç€æ—¶ï¼Œä½ ä¸èƒ½é£ï¼›è€Œå½“ä½ ç¡ç€æ—¶ï¼Œä½ èƒ½é£ã€‚è¿™é“ç†æ˜¯åœ¨äºå› ç¼˜æ˜¯å¦å…·è¶³ï¼›è¦èƒ½é£ç¿”çš„ä¸€ä¸ªç¼˜ï¼Œæ˜¯ç¡çœ ã€‚å½“ä½ æ²¡æœ‰å®ƒï¼Œä½ å°±ä¸èƒ½é£ï¼Œæœ‰äº†å®ƒï¼Œä½ å°±èƒ½é£ã€‚å‡è®¾ä½ æ¢¦è§ä½ èƒ½é£ï¼Œè€Œé†’æ¥åè¿˜ç»§ç»­ç›¸ä¿¡ä½ èƒ½é£ï¼Œé‚£å°±éº»çƒ¦äº†ã€‚ä½ ä¼šæ‰ä¸‹æ¥ï¼Œè€Œä¸”ä¼šå¤±æœ›ã€‚æ‚‰è¾¾å¤šè¯´ï¼Œå³ä½¿åœ¨ç›¸å¯¹ä¸–ç•Œä¸­é†’ç€ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨æ— æ˜ä¸­æ²‰ç¡ï¼Œå¦‚åŒåœ¨ä»–å‡ºèµ°é‚£å¤œçš„å®«å¥³ä¸€èˆ¬ã€‚æ°å½“çš„å› ç¼˜èšåˆæ—¶ï¼Œä»»ä½•äº‹æƒ…éƒ½å¯èƒ½å‡ºç°ã€‚ä½†å½“å› ç¼˜æ¶ˆæ•£ï¼Œæ˜¾ç°ä¹Ÿå°±åœæ­¢ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä½•åœ¨æ‚‰è¾¾å¤šæ•™æ³•ä¸€åƒäº”ç™¾å¹´åï¼Œä¸€ä½å«å¸æ´›å·´çš„ä½›æ³•ç»§æ‰¿è€…ï¼Œå¯¹ä»–çš„å­¦ç”Ÿé‚£æ´›å·´è¯´ï¼Œä¸æ˜¯æ˜¾ç°ï¼ˆå¤–ç›¸ï¼‰å›°ä½äº†ä½ ï¼Œè€Œæ˜¯ä½ å¯¹æ˜¾ç°ï¼ˆå¤–ç›¸ï¼‰çš„æ‰§ç€å›°ä½äº†ä½ ã€‚</p>
<p>å¦‚åŒç¯çƒå°å§é€‰ç¾ä¸€æ ·ï¼Œåœ¨è¿™ä¸ªä¸–ç•Œä¸Šï¼Œæˆ‘ä»¬æ‰€åšã€æ‰€æƒ³çš„ä»»ä½•äº‹ç‰©ï¼Œéƒ½æœ‰æ˜¯åŸºäºä¸€ä¸ªéå¸¸æœ‰é™çš„å…±åŒé€»è¾‘ç³»ç»Ÿã€‚æˆ‘ä»¬éå¸¸å¼ºè°ƒå…±è¯†ã€‚å¦‚æœå¤§å¤šæ•°äººåŒæ„æŸä»¶äº‹ç‰©æ˜¯çœŸå®çš„ï¼Œé€šå¸¸å®ƒå°±å˜æˆæ­£å½“æœ‰æ•ˆçš„ã€‚å½“æˆ‘ä»¬çœ‹ç€ä¸€ä¸ªå°æ± å¡˜ï¼Œæˆ‘ä»¬äººç±»è®¤ä¸ºå®ƒåªæ˜¯ä¸ªæ± å¡˜ï¼Œä½†å¯¹æ± é‡Œçš„é±¼å„¿æ¥è¯´ï¼Œè¿™æ˜¯å®ƒä»¬çš„å®‡å®™ã€‚å¦‚æœæˆ‘ä»¬é‡‡å–æ°‘ä¸»çš„ç«‹åœºï¼Œé‚£ä¹ˆæ°´ä¸­æ—ç¾¤ä¸€å®šä¼šèµ¢ï¼Œå†ä¸ºå®ƒä»¬æ¯”æˆ‘ä»¬è¿™äº›è§‚æ± å¡˜è€…ä¸ºæ•°å¤šå¾—å¤šã€‚å¤šæ•°å†³ä¸è§å¾—æ°¸è¿œéƒ½å¯¹ã€‚ç³Ÿç³•çš„å¤§å–åº§å½±ç‰‡å¯ä»¥èµšå¾—å¤§é‡çš„åˆ©æ¶¦ï¼Œè€Œä¸€éƒ¨ç‹¬ç«‹åˆ¶ä½œçš„ä¼˜ç§€å½±ç‰‡å´åªæœ‰å°‘æ•°äººè§‚èµã€‚è€Œä¸”ç”±äºæˆ‘ä»¬ä¾èµ–ç¾¤ä½“æ€è€ƒï¼Œè¿™ä¸–ç•Œé€šå¸¸æ˜¯è¢«æœ€çŸ­è§†è€Œè…è´¥çš„ç»Ÿæ²»è€…æ‰€æ²»ç†ï¼›æ°‘ä¸»åˆ¶åº¦åªæ˜¯è¯‰è¯¸äºæœ€å°å…¬çº¦æ•°è€Œå·²ã€‚</p>
<p>ç„¶è€Œäº†æ‚Ÿä¸å¿…æ˜¯è‡´å‘½çš„ã€‚æˆ‘ä»¬ä¸éœ€è¦è±¡äº•è›™ä¸€èˆ¬ï¼Œé¢å¯¹ç©ºæ€§æƒŠå“è€Œäº¡ã€‚å¦‚æœæµ·è›™èƒ½å¤Ÿæœ‰ç¨å¾®å¤šç‚¹çš„æ…ˆæ‚²å¿ƒå’Œå–„å·§ï¼Œä¹Ÿè®¸å®ƒå¯ä»¥åšä¸€ä¸ªæ›´å¥½çš„å‘å¯¼ï¼Œäº•è›™ä¹Ÿä¸è‡³äºå“æ­»ï¼Œä¹Ÿè®¸å®ƒè¿˜ä¼šç§»å±…åˆ°æµ·è¾¹ä¹Ÿè¯´ä¸å®šã€‚è€Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦æœ‰è¶…è‡ªç„¶çš„å¤©èµ‹æ‰èƒ½äº†è§£ç©ºæ€§ã€‚è¿™å’Œæ•™è‚²ä»¥åŠæ„¿æ„è§‚å¯Ÿäº‹ç‰©æ‰€æœ‰çš„éƒ¨åˆ†ä»¥åŠéšè—çš„å› ç¼˜æœ‰å…³ã€‚æœ‰äº†è¿™ç§æ´è§ï¼Œæˆ‘ä»¬å°±ä¼šè±¡å¸ƒæ™¯è®¾è®¡å¸ˆæˆ–æ‘„å½±åŠ©ç†åœ¨çœ‹ç”µå½±ã€‚ä¸“ä¸šè€…èƒ½çœ‹è§æˆ‘ä»¬æ‰€çœ‹ä¸è§çš„ä¸œè¥¿ã€‚ä»–ä»¬çœ‹è§æ‘„å½±æœºå¦‚ä½•å¸ƒç½®ï¼Œä»¥åŠå…¶ä»–è§‚ä¼—ä»¬ä¸çŸ¥é“çš„ç”µå½±æŠ€å·§ï¼Œå› æ­¤å¯¹ä»–ä»¬è€Œè¨€ï¼Œè¿™å¹»ç›¸è¢«æ‹†è§£äº†ã€‚ä½†ä¸“ä¸šè€…åœ¨çœ‹ç”µå½±çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥å°½æƒ…äº«å—ã€‚è¿™å°±æ˜¯æ‚‰è¾¾å¤šè¶…ç„¶çš„å¹½é»˜ã€‚</p>
<p>æ‚‰è¾¾å¤šæ²¡æœ‰ä¸€å¼€å§‹å°±ç”¨ç©ºæ€§æ¥æƒŠå“å¤§å®¶ï¼Œåè€Œä»¥ä¸€èˆ¬çš„æ–¹å¼ï¼Œè¯¸å¦‚ç¦…å®šä»¥åŠè¡Œä¸ºè§„èŒƒï¼ï¼åšæ­£ç¡®çš„äº‹ã€å‹¿ç›—çªƒã€å‹¿å¦„è¨€ç­‰æ¥æ•™å¯¼ä¼—å¤šçš„å¼Ÿå­ã€‚æ ¹æ®å¼Ÿå­çš„æœ¬æ€§ï¼Œä»–å®šä¸‹äº†ä¸åŒç¨‹åº¦çš„å‡ºç¦»åŠè‹¦è¡Œï¼Œä»å‰Šå‘åˆ°ä¸é£Ÿè‚‰ç­‰ç­‰ã€‚å¯¹ä¸€å¼€å§‹æ— æ³•å¬é—»æˆ–äº†è§£ç©ºæ€§çš„äººï¼Œä»¥åŠå¤©æ€§é€‚åˆè‹¦ä¿®çš„äººè€Œè¨€ï¼Œè¿™äº›çŠ¶ä¼¼å®—æ•™æ€§çš„ä¸¥æ ¼é“è·¯å¾ˆæœ‰æ•ˆã€‚</p>
<p>ä¸šï¼ˆKarmaï¼‰è¿™ä¸ªå­—å‡ ä¹å’Œä½›æ•™æˆäº†åŒä¹‰å­—ã€‚é€šå¸¸å®ƒè¢«ç†è§£ä¸ºä¸€ç§é“å¾·ç³»ç»Ÿçš„æŠ¥åº”â€”-æ¶ä¸šä¸å–„ä¸šã€‚ç„¶è€Œï¼Œä¸šåªæ˜¯ä¸€ç§å› æœçš„æ³•åˆ™ï¼Œä¸åº”è¯¥ä¸é“å¾·æˆ–ä¼¦ç†æ··æ·†ã€‚</p>
<p>ä½ ä¹Ÿè¡Œä¼šè®¤ä¸ºè¿™æ˜¯çŸ›ç›¾çš„ã€‚ä½›é™€è‡ªæˆ‘çŸ›ç›¾ï¼Œè¯´ä»–ä¸å­˜åœ¨ï¼Œä¸€åˆ‡çš†æ˜¯ç©ºæ€§ï¼Œç„¶åä»–åˆæ•™å¯¼äº†é“å¾·å’Œæ•‘èµã€‚ç„¶è€Œè¿™äº›æ–¹æ³•æ˜¯å¿…è¦çš„ï¼Œä»¥å…å“èµ°é‚£äº›å°šæœªå‡†å¤‡å¥½ï¼Œè¿˜ä¸èƒ½è¢«å¼•ä»‹ç©ºæ€§çš„äººã€‚ä»–ä»¬ç”¨äº†è¿™äº›æ–¹æ³•ï¼Œå› è€Œå˜å¾—ç¥¥å’Œï¼Œæ˜“äºæ¥å—çœŸæ­£çš„æ•™æ³•ï¼Œè¿™å°±å¦‚åŒè¯´é‚£é‡Œæ˜¯æœ‰ä¸€æ¡è›‡ã€‚ç„¶åæŠŠé¢†å¸¦ä¸¢åˆ°çª—å¤–ä¸€èˆ¬ã€‚è¿™äº›æ— é™çš„æ–¹æ³•å°±æ˜¯é“è·¯ã€‚ç„¶è€Œï¼Œé“è·¯æœ¬èº«ç»ˆç©¶ä¹Ÿéœ€è¦è¢«æŠ›å¼ƒï¼Œå¦‚åŒä½ æŠµè¾¾å½¼å²¸æ—¶ï¼Œå°±å¾—æŠ›å¼ƒèˆŸä¸€èˆ¬ã€‚ä½ æŠµè¾¾æ—¶å¿…é¡»è¦ä¸‹èˆ¹ã€‚åœ¨å®Œå…¨è¯æ‚Ÿçš„é‚£ä¸€åˆ»ï¼Œä½ å¿…é¡»æŠ›å¼ƒä½›æ•™ã€‚ç²¾ç¥ä¹‹è·¯æ˜¯ä¸€ä¸ªæš‚æ—¶è§£ç­”ï¼Œå®ƒæ˜¯åœ¨ç©ºæ€§è¢«äº†æ‚Ÿä¹‹å‰æ‰€ä½¿ç”¨çš„å®‰æ…°å‰‚ã€‚</p>
<p>å¦‚åŒåœ¨ç”µå½±é™¢é‡Œçš„å­©ç«¥ï¼Œæˆ‘ä»¬è¢«å¹»ç›¸æ³è·äº†ã€‚ä»è¿™å„¿å¼€å§‹ï¼Œè¡ç”Ÿäº†æˆ‘ä»¬çš„è™šè£ã€é‡å¿ƒå’Œä¸å®‰å…¨æ„Ÿã€‚æˆ‘ä»¬çˆ±ä¸Šäº†è‡ªå·±åˆ›é€ çš„å¹»ç›¸ï¼Œå‘å±•å‡ºå¯¹è‡ªå·±çš„å¤–è¡¨ã€è´¢å¯Œå’Œæˆå°±è¿‡åº¦çš„éª„æ…¢ã€‚å¥½æ¯”æˆ´äº†é¢å…·ï¼Œå´éª„å‚²åœ°è®¤ä¸ºé¢å…·æ˜¯çœŸå®çš„ä½ ã€‚</p>
<p>äº†æ‚Ÿç©ºæ€§çš„æ‚‰è¾¾å¤šï¼Œå¯¹è©ææ ‘ä¸‹çš„å¿˜å¿§è‰æˆ–å®«æ®¿é‡Œçš„ä¸ç»¸åå«æ²¡æœ‰å¥½æ¶åˆ†åˆ«ã€‚é‡‘çº¿ç»‡æˆçš„åå«ä»·å€¼è¾ƒé«˜ï¼Œå®Œå…¨æ˜¯ç”±äººç±»çš„é‡å¿ƒå’Œæ¬²æœ›é€ ä½œè€Œæ¥çš„ã€‚äº‹å®ä¸Šï¼Œå±±ä¸­çš„éšå£«ä¹Ÿè®¸ä¼šè§‰å¾—å¿˜å¿§è‰æ¯”è¾ƒæŸ”è½¯è€Œå¹²å‡€ï¼Œè€Œä¸”æœ€å¤§çš„å¥½å¤–æ˜¯ååäº†ä¹Ÿä¸éœ€è¦æ‹…å¿ƒã€‚ä½ ä¸éœ€è¦å¯¹å®ƒå–·è¯ï¼Œä»¥å…çŒ«ç”¨çˆªå­å»æŠ“å®ƒã€‚å®«å»·ç”Ÿæ´»å……æ»¡äº†è¿™ç±»çš„â€œçå“â€ï¼Œéœ€è¦ç›¸å½“å¤šçš„ç»´ä¿®ä¿å…»ã€‚æ‚‰è¾¾å¤šæ˜¯å±äºæ¯”è¾ƒå–œæ¬¢è‰å«çš„äººï¼Œå› æ­¤ä»–ä¸éœ€è¦å¸¸å¸¸å›å®¶å»è¡¥å……ä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>æˆ‘ä»¬äººç±»è®¤ä¸ºå¿ƒèƒ¸å®½å¹¿æ˜¯ä¸€ç§ç¾å¾·ã€‚è¦æ‰©å±•å¿ƒèƒ¸ï¼Œé‡è¦çš„æ˜¯ä¸è¦å®‰äºä»¤æˆ‘ä»¬èˆ’é€‚æˆ–ä¹ æƒ¯çš„ä¸œè¥¿ã€‚å¦‚æœæˆ‘ä»¬æœ‰å‹‡æ°”è¶…è¶Šä¸–ä¿—ï¼Œä¸è¢«æƒ¯å¸¸é€»è¾‘çš„ç•Œçº¿æ‰€é™åˆ¶ï¼Œå°±èƒ½å¾—åˆ°åˆ©ç›Šã€‚å¦‚æœæˆ‘ä»¬èƒ½è¶…è¶Šç•Œçº¿ï¼Œå°±èƒ½äº†è§£ç©ºæ€§æ˜¯å¦‚æ­¤å¯ç¬‘åœ°å•çº¯ã€‚å¯†å‹’æ—¥å·´èº²è¿›ç‰¦ç‰›è§’ä¸ä¼šæ¯”æŸä¸ªäººæˆ´ä¸Šæ‰‹å¥—è¿˜ä»¤ä½ è®¶å¼‚ã€‚æˆ‘ä»¬æ‰€è¦æŒ‘æˆ˜çš„ï¼Œæ˜¯å¯¹æƒ¯å¸¸é€»è¾‘ã€æ–‡æ³•ã€å­—æ¯ã€æ•°å­¦å…¬å¼çš„æ‰§ç€ã€‚å¦‚æœèƒ½è®°å¾—è¿™äº›ä¹ æƒ¯çš„å’Œåˆæœ¬æ€§ï¼Œæˆ‘ä»¬å°±èƒ½æ–­é™¤å®ƒä»¬ã€‚å®ƒä»¬ä¸æ˜¯ä¸èƒ½ç ´é™¤çš„ï¼Œæ‰€éœ€è¦çš„åªæ˜¯ä¸€ä¸ªæ¡ä»¶å®Œå…¨æ­£ç¡®ã€èµ„è®¯é€‚æ—¶åˆ°ä½çš„æƒ…å†µï¼Œä½ å¯èƒ½çªç„¶å‘ç°æ‰€æœ‰ä¾èµ–çš„å·¥å…·éƒ½ä¸æ˜¯é‚£ä¹ˆåšå®ï¼Œå®ƒä»¬æœ‰å¼¹æ€§ã€å¯å¼¯æ›²ã€‚ä½ çš„è§‚ç‚¹ä¼šæ”¹å˜ã€‚</p>
]]></content>
      <categories>
        <category>Books</category>
      </categories>
      <tags>
        <tag>ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯—è¯æ”¶é›†</title>
    <url>/2023/01/09/Other/Books_%E8%AF%97%E8%AF%8D%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<p>æ”¶é›†ä¸€äº›è‡ªå·±å¹³æ—¶è§åˆ°çš„è¯—å¥ï¼š</p>
<h4 id="Update-2018-12-24"><a href="#Update-2018-12-24" class="headerlink" title="Update 2018-12-24"></a>Update 2018-12-24</h4><ol>
<li>é‚»äººç„‰æœ‰è®¸å¤šé¸¡ï¼Œä¹ä¸ä½•æ›¾æœ‰äºŒå¦»ã€‚å½“æ—¶å°šæœ‰å‘¨å¤©å­ï¼Œä½•äº‹çº·çº·è¯´é­é½ã€‚</li>
<li>ç®—ä¸å°½èŠ¸èŠ¸ä¼—ç”Ÿå¾®è´±å‘½ï¼Œå›å¤´çœ‹äº”å‘³æ‚é™ˆå¥ˆä½•å¤©ã€‚</li>
<li>ä½•æ—¶æ–ç­–ç›¸éšå»ï¼Œä»»æ€§é€é¥ä¸å­¦ç¦…ã€‚</li>
<li>ç™¾æ— ä¸€ç”¨æ˜¯æƒ…æ·±ï¼Œä¸‡èˆ¬å¥ˆä½•ä¸ºæƒ…å›°ã€‚</li>
<li>æ¡ƒææ˜¥é£ä¸€æ¯é…’ï¼Œæ±Ÿæ¹–å¤œé›¨åå¹´ç¯ã€‚</li>
<li>æ€äººæ”¾ç«é‡‘è…°å¸¦ï¼Œä¿®æ¡¥è¡¥è·¯æ— å°¸éª¸ã€‚</li>
<li>æ®‹é›ªå‡è¾‰å†·ç”»å±ï¼Œè½æ¢…æ¨ªç¬›å·²ä¸‰æ›´ï¼Œæ›´æ— äººå¤„æœˆèƒ§æ˜ã€‚<br>æˆ‘æ˜¯äººé—´æƒ†æ€…å®¢ï¼ŒçŸ¥å›ä½•äº‹æ³ªçºµæ¨ªï¼Œæ–­è‚ å£°é‡Œå¿†å¹³ç”Ÿã€‚ çº³å…°æ€§å¾·ã€Šæµ£æºªæ²™Â·æ®‹é›ªå‡è¾‰å†·ç”»å±ã€‹</li>
<li>æ›¾ç»æ²§æµ·éš¾ä¸ºæ°´ï¼Œé™¤å´å·«å±±ä¸æ˜¯äº‘ã€‚å–æ¬¡èŠ±ä¸›æ‡’å›é¡¾ï¼ŒåŠç¼˜ä¿®é“åŠç¼˜å›ã€‚</li>
<li>äººç”Ÿåˆ°å¤„åº”ä½•ä¼¼ï¼Œåº”ä¼¼é£é¸¿è¸é›ªæ³¥ã€‚</li>
<li>å±±æœ‰æœ¨å…®æœ¨æœ‰æï¼Œå¿ƒæ‚¦å›å…®å›ä¸çŸ¥ã€‚</li>
<li>å«¦å¨¥åº”æ‚”å·çµè¯ï¼Œç¢§æµ·é’å¤©å¤œå¤œå¿ƒã€‚</li>
<li>æ»¡å ‚èŠ±é†‰ä¸‰åƒå®¢ï¼Œä¸€å‰‘éœœå¯’åå››å·ã€‚</li>
<li>æ—©å²è¯»ä¹¦æ— ç”šè§£ï¼Œæ™šå¹´çœäº‹æœ‰å¥‡åŠŸã€‚</li>
<li>è½¦é¥é¥ï¼Œé©¬æ†§æ†§ã€‚<br>å›æ¸¸ä¸œå±±ä¸œå¤ä¸œï¼Œå®‰å¾—å¥‹é£é€è¥¿é£ã€‚<br>æ„¿æˆ‘å¦‚æ˜Ÿå›å¦‚æœˆï¼Œå¤œå¤œæµå…‰ç›¸çšæ´ã€‚<br>æœˆæš‚æ™¦ï¼Œæ˜Ÿå¸¸æ˜ã€‚<br>ç•™æ˜å¾…æœˆå¤ï¼Œä¸‰äº”å…±ç›ˆç›ˆã€‚ èŒƒæˆå¤§ã€Šè½¦é¥é¥ç¯‡ã€‹  </li>
<li>ä¸€èº«è¯—æ„åƒå¯»ç€‘ï¼Œä¸‡å¤æµèŠ³å››æœˆå¤©ã€‚</li>
<li>æœªæ›¾ç›¸é€¢å…ˆä¸€ç¬‘ï¼Œåˆä¼šä¾¿å·²è®¸å¹³ç”Ÿã€‚</li>
<li>ä¸‰åƒå¹´è¯»å²ä¸è¿‡åŠŸååˆ©ç¦„ï¼Œä¹ä¸‡é‡Œæ‚Ÿé“ç»ˆå½’è¯—é…’ç”°å›­ã€‚</li>
<li>å›åŸ‹æ³‰ä¸‹æ³¥é”€éª¨ï¼Œæˆ‘å¯„äººé—´é›ªæ»¡å¤´ã€‚</li>
<li>ä¼¤å¿ƒæ¡¥ä¸‹æ˜¥æ³¢ç»¿ï¼Œæ›¾æ˜¯æƒŠé¸¿ç…§å½±æ¥ã€‚</li>
<li>é†‰åä¸çŸ¥å¤©åœ¨æ°´ï¼Œæ»¡èˆ¹æ¸…æ¢¦å‹æ˜Ÿæ²³ã€‚</li>
<li>ç§‹é£å¹å°½æ—§åº­æŸ¯ï¼Œé»„å¶ä¸¹æ«å®¢é‡Œè¿‡ã€‚ä¸€ç‚¹ç¦…ç¯åŠè½®æœˆï¼Œä»Šå®µå¯’è¾ƒæ˜¨å®µå¤šã€‚</li>
<li>ç»†é›¨ç”Ÿå¯’æœªæœ‰éœœï¼Œåº­å‰æœ¨å¶åŠé’é»„ã€‚å°æ˜¥æ­¤å»æ— å¤šæ—¥ï¼Œä½•å¤„æ¢…èŠ±ä¸€ç»½é¦™ã€‚</li>
<li>å²ä¹…äººæ— åƒæ—¥å¥½ï¼Œæ˜¥æ·±èŠ±æœ‰å‡ æ—¶çº¢ã€‚æ˜¯éå…¥è€³å›é¡»å¿ï¼ŒåŠä½œç—´å‘†åŠä½œè‹ã€‚</li>
<li>æ¸…é£ä¸è¯†å­—ï¼Œä½•æ•…ä¹±ç¿»ä¹¦ã€‚</li>
<li>ä¸‰è¿‡å¹³å±±å ‚ä¸‹ï¼ŒåŠç”Ÿå¼¹æŒ‡å£°ä¸­ã€‚åå¹´ä¸è§è€ä»™ç¿ï¼Œå£ä¸Šé¾™è›‡é£åŠ¨ã€‚æ¬²åŠæ–‡ç« å¤ªå®ˆï¼Œä»æ­Œæ¨æŸ³æ˜¥é£ã€‚ä¼‘è¨€ä¸‡äº‹è½¬å¤´ç©ºï¼Œæœªè½¬å¤´æ—¶çš†æ¢¦ã€‚</li>
<li>å±±æœˆä¸çŸ¥å¿ƒé‡Œäº‹ï¼Œæ°´é£ç©ºè½çœ¼å‰èŠ±ã€‚</li>
<li>æœªè‹¥é”¦å›Šæ”¶è‰³éª¨ï¼Œä¸€æŠ”å†·åœŸæ©é£æµã€‚</li>
<li>è«è¨€ä¸‹å²­ä¾¿æ— éš¾ï¼Œèµšå¾—è¡Œäººç©ºå–œæ¬¢ã€‚æ­£å…¥ä¸‡å±±åœˆå­é‡Œï¼Œä¸€å±±æ”¾è¿‡ä¸€å±±æ‹¦ã€‚</li>
<li>æœ‰ç¾ä¸€äººå…®å©‰å¦‚æ¸…æ‰¬ï¼Œè¯†æ›²åˆ«éŸ³å…®ä»¤å§¿ç…Œç…Œã€‚ç»£è¢‚æ§ç´å…®ç™»å›å­å ‚ï¼Œå¦‚å½¼è±è‰å…®ä½¿æˆ‘å¿§å¿˜ã€‚æ¬²èµ ä¹‹ä»¥ç´«ç‰å°ºï¼Œç™½é“¶ç°ï¼Œä¹…ä¸è§ä¹‹å…®æ¹˜æ°´èŒ«èŒ«ã€‚</li>
<li>ç”Ÿå¦‚é€†æ—…ï¼Œä¸€è‹‡ä»¥èˆªã€‚</li>
</ol>
<h4 id="Update-2023-01-09"><a href="#Update-2023-01-09" class="headerlink" title="Update 2023-01-09"></a>Update 2023-01-09</h4><ol>
<li>å›å¤´ä¸‡é‡Œï¼Œæ•…äººé•¿ç»ã€‚æ˜“æ°´è§è§è¥¿é£å†·ï¼Œæ»¡åº§è¡£å† ä¼¼é›ªã€‚ã€Šè´ºæ–°éƒÂ·åˆ«èŒ‚å˜‰åäºŒå¼Ÿã€‹è¾›å¼ƒç–¾</li>
<li>æ´›é˜³åŸé‡Œæ˜¥å…‰å¥½ï¼Œæ´›é˜³æ‰å­ä»–ä¹¡è€ã€‚ã€Šè©è¨è›®Â·æ´›é˜³åŸé‡Œæ˜¥å…‰å¥½ã€‹éŸ¦åº„</li>
<li>ä¼¤å¿ƒæ¡¥ä¸‹æ˜¥æ³¢ç»¿ï¼Œæ›¾æ˜¯æƒŠé¸¿ç…§å½±æ¥ã€‚ã€Šæ²ˆå›­äºŒé¦–Â·å…¶ä¸€ã€‹é™†æ¸¸</li>
<li>è°è§å¹½äººç‹¬å¾€æ¥ï¼Œç¼¥ç¼ˆå­¤é¸¿å½±ã€‚ã€Šåœç®—å­Â·é»„å·å®šæ…§é™¢å¯“å±…ä½œã€‹è‹è½¼</li>
<li>çµç¶å¼¦ä¸Šè¯´ç›¸æ€ã€‚å½“æ—¶æ˜æœˆåœ¨ï¼Œæ›¾ç…§å½©äº‘å½’ã€‚ã€Šä¸´æ±Ÿä»™Â·æ¢¦åæ¥¼å°é«˜é”ã€‹æ™å‡ é“</li>
<li>æ­¤åé”¦ä¹¦ä¼‘å¯„ï¼Œç”»æ¥¼äº‘é›¨æ— å‡­ã€‚ã€Šæ¸…å¹³ä¹Â·ç•™äººä¸ä½ã€‹æ™å‡ é“</li>
<li>ç¾äººè‡ªåˆä¹Œæ±Ÿå²¸ï¼Œæˆ˜ç«æ›¾çƒ§èµ¤å£å±±ï¼Œå°†å†›ç©ºè€ç‰é—¨å…³ã€‚</li>
<li>é£Ÿè‚‰ä½•æ›¾å°½è™å¤´ï¼Œå…å¹´ä¹¦å‰‘æµ·å¤©ç§‹ã€‚<br>æ–‡ç« å¹¸æœªé€¢é»„ç¥–ï¼Œè¥†è¢«ä»ŠçŠ¹çª˜é©¬å‘¨ã€‚<br>è‡ªæ˜¯æ±æ‰éš¾ç”¨ä¸–ï¼Œå²‚çœŸå¾ç›¸ä¸å½“ä¾¯ã€‚<br>é¡»çŸ¥å°‘æ—¥æ‹äº‘å¿—ï¼Œæ›¾è®¸äººé—´ç¬¬ä¸€æµã€‚ æ¸…ä»£å´åº†å»ã€Šé¢˜ä¸‰åè®¡å°è±¡ã€‹ </li>
<li>æ—¶äººä¸è¯†å‡Œäº‘æœ¨ï¼Œç›´å¾…å‡Œäº‘å§‹é“é«˜ã€‚</li>
<li>æ€»æœ‰åƒå¤ï¼Œæ¨ªæœ‰å…«è’ï¼Œå‰é€”ä¼¼æµ·ï¼Œæ¥æ—¥æ–¹é•¿ã€‚</li>
<li>é¹åŒ—æµ·ï¼Œé£æœé˜³ï¼Œåˆæºä¹¦å‰‘è·¯èŒ«èŒ«ã€‚æ˜å¹´æ­¤æ—¥é’äº‘å»ï¼Œå´ç¬‘äººé—´ä¸¾å­å¿™ã€‚</li>
</ol>
<h4 id="Update-2023-03-01-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤"><a href="#Update-2023-03-01-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤" class="headerlink" title="Update 2023-03-01 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤"></a>Update 2023-03-01 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤</h4><ol>
<li>ä¸æ˜¯é€¢äººè‹¦èª‰å›ï¼Œäº¦ç‹‚äº¦ä¾ äº¦æ¸©æ–‡ã€‚ç…§äººèƒ†ä¼¼ç§¦æ—¶æœˆï¼Œé€æˆ‘æƒ…å¦‚å²­ä¸Šäº‘ã€‚ </li>
<li>ä¸€ç”Ÿä¸€ä»£ä¸€åŒäººï¼Œäº‰æ•™ä¸¤å¤„é”€é­‚ã€‚ç›¸æ€ç›¸æœ›ä¸ç›¸äº²ï¼Œå¤©ä¸ºè°æ˜¥ï¼Ÿ</li>
<li>ä¹Ÿä¿¡ç¾äººç»ˆä½œåœŸï¼Œä¸å ªå¹½æ¢¦å¤ªåŒ†åŒ†ã€‚</li>
<li>é“¶å­—ç¬™è°ƒã€‚å¿ƒå­—é¦™çƒ§ã€‚æ–™èŠ³æ‚°ã€ä¹æ•´è¿˜å‡‹ã€‚å¾…å°†æ˜¥æ¨ï¼Œéƒ½ä»˜æ˜¥æ½®ã€‚è¿‡çªˆå¨˜å ¤ï¼Œç§‹å¨˜æ¸¡ï¼Œæ³°å¨˜æ¡¥ã€‚ </li>
<li>ä¸­å¿ƒè—ä¹‹ï¼Œä½•æ—¥å¿˜ä¹‹!</li>
</ol>
<h4 id="Update-2023-03-05-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤"><a href="#Update-2023-03-05-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤" class="headerlink" title="Update 2023-03-05 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤"></a>Update 2023-03-05 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤</h4><ol>
<li>é’“é±¼å°ï¼Œåå¹´ä¸ä¸Šé‡é¸¥çŒœã€‚ç™½äº‘æ¥å¾€é’å±±åœ¨ï¼Œå¯¹é…’å¼€æ€€ã€‚æ¬ ä¼Šå‘¨æµä¸–æ‰ï¼ŒçŠ¯åˆ˜é˜®è´ªæ¯æˆ’ï¼Œè¿˜ææœåŸè¯—å€ºã€‚é…¸æ–‹ç¬‘æˆ‘ï¼Œæˆ‘ç¬‘é…¸æ–‹ã€‚<br>æ™šå½’æ¥ï¼Œè¥¿æ¹–å±±ä¸Šé‡çŒ¿å“€ã€‚äºŒåå¹´å¤šå°‘é£æµæ€ªï¼ŒèŠ±è½èŠ±å¼€ã€‚æœ›äº‘éœ„æ‹œå°†å°ã€‚è¢–æ˜Ÿæ–—å®‰é‚¦ç­–ï¼Œç ´çƒŸæœˆè¿·é­‚å¯¨ã€‚é…¸æ–‹ç¬‘æˆ‘ï¼Œæˆ‘ç¬‘é…¸æ–‹ã€‚  </li>
<li>çŸ¥å›ç”¨å¿ƒå¦‚æ—¥æœˆï¼Œäº‹å¤«èª“æ‹ŸåŒç”Ÿæ­»ã€‚<br>è¿˜å›æ˜ç åŒæ³ªå‚ï¼Œæ¨ä¸ç›¸é€¢æœªå«æ—¶ã€‚  </li>
<li>åƒå¤é£æµå…«å’æ¥¼ï¼Œæ±Ÿå±±ç•™ä¸åäººæ„ã€‚<br>æ°´é€šå—å›½ä¸‰åƒé‡Œï¼Œæ°”å‹æ±ŸåŸåå››å·ã€‚  </li>
<li>é—®ä½™ä½•æ„æ –ç¢§å±±ï¼Œç¬‘è€Œä¸ç­”å¿ƒè‡ªé—²ã€‚<br>æ¡ƒèŠ±æµæ°´çª…ç„¶å»ï¼Œåˆ«æœ‰å¤©åœ°éäººé—´ã€‚  </li>
<li>å¾·ä¹Ÿç‹‚ç”Ÿè€³ã€‚å¶ç„¶é—´ï¼Œç¼å°˜äº¬å›½ï¼Œä¹Œè¡£é—¨ç¬¬ã€‚æœ‰é…’æƒŸæµ‡èµµå·åœŸï¼Œè°ä¼šæˆç”Ÿæ­¤æ„ã€‚ä¸ä¿¡é“ã€ç«Ÿé€¢çŸ¥å·±ã€‚é’çœ¼é«˜æ­Œä¿±æœªè€ï¼Œå‘å°Šå‰ã€æ‹­å°½è‹±é›„æ³ªã€‚å›ä¸è§ï¼Œæœˆå¦‚æ°´ã€‚<br>å…±å›æ­¤å¤œé¡»æ²‰é†‰ã€‚ä¸”ç”±ä»–ï¼Œè›¾çœ‰è°£è¯¼ï¼Œå¤ä»ŠåŒå¿Œã€‚èº«ä¸–æ‚ æ‚ ä½•è¶³é—®ï¼Œå†·ç¬‘ç½®ä¹‹è€Œå·²ã€‚å¯»æ€èµ·ã€ä»å¤´ç¿»æ‚”ã€‚ä¸€æ—¥å¿ƒæœŸåƒåŠ«åœ¨ï¼Œåèº«ç¼˜ã€æç»“ä»–ç”Ÿé‡Œã€‚ç„¶è¯ºé‡ï¼Œå›é¡»è®°ã€‚ çº³å…°æ€§å¾·ã€Šé‡‘ç¼•æ›²Â·èµ æ¢æ±¾ã€‹</li>
<li>æ¨å›ä¸ä¼¼æ±Ÿæ¥¼æœˆï¼Œå—åŒ—ä¸œè¥¿ï¼Œå—åŒ—ä¸œè¥¿ï¼Œåªæœ‰ç›¸éšæ— åˆ«ç¦»ã€‚<br>æ¨å›å´ä¼¼æ±Ÿæ¥¼æœˆï¼Œæš‚æ»¡è¿˜äºï¼Œæš‚æ»¡è¿˜äºï¼Œå¾…å¾—å›¢åœ†æ˜¯å‡ æ—¶ï¼Ÿ å•æœ¬ä¸­ã€Šé‡‡æ¡‘å­Â·æ¨å›ä¸ä¼¼æ±Ÿæ¥¼æœˆã€‹  </li>
<li>è‡ªå›ä¹‹å‡ºçŸ£ï¼Œä¸å¤ç†æ®‹æœºã€‚<br>æ€å›å¦‚æ»¡æœˆï¼Œå¤œå¤œå‡æ¸…è¾‰ã€‚ å¼ ä¹é¾„ã€Šèµ‹å¾—è‡ªå›ä¹‹å‡ºçŸ£ã€‹</li>
</ol>
<h4 id="Update-2023-03-08-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤ï¼Œ-â€œæ±Ÿâ€-å­—é£èŠ±ä»¤"><a href="#Update-2023-03-08-æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤ï¼Œ-â€œæ±Ÿâ€-å­—é£èŠ±ä»¤" class="headerlink" title="Update 2023-03-08 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤ï¼Œ â€œæ±Ÿâ€ å­—é£èŠ±ä»¤"></a>Update 2023-03-08 æ´¾å…‹ç›´æ’­é—´é£èŠ±ä»¤ï¼Œ â€œæ±Ÿâ€ å­—é£èŠ±ä»¤</h4><ol>
<li>æ±Ÿä¸œå­å¼Ÿä»Šè™½åœ¨ï¼Œè‚¯ä¸å›ç‹å·åœŸæ¥ï¼Ÿ ç‹å®‰çŸ³ã€Šå é¢˜ä¹Œæ±Ÿäº­ã€‹</li>
<li>æ±Ÿé›¨éœéœæ±Ÿè‰é½ï¼Œå…­æœå¦‚æ¢¦é¸Ÿç©ºå•¼ã€‚ éŸ¦åº„ã€Šå°åŸã€‹</li>
<li>æ®‹ç¯æ— ç„°å½±å¹¢å¹¢ï¼Œæ­¤å¤•é—»å›è°ªä¹æ±Ÿã€‚<br>å‚æ­»ç—…ä¸­æƒŠåèµ·ï¼Œæš—é£å¹é›¨å…¥å¯’çª—ã€‚å…ƒç¨¹ã€Šé—»ä¹å¤©æˆæ±Ÿå·å¸é©¬ã€‹</li>
<li>å°‘å¹´å¬é›¨æ­Œæ¥¼ä¸Šï¼Œçº¢çƒ›æ˜ç½—å¸ã€‚å£®å¹´å¬é›¨å®¢èˆŸä¸­ï¼Œæ±Ÿé˜”äº‘ä½ã€æ–­é›å«è¥¿é£ã€‚<br>è€Œä»Šå¬é›¨åƒ§åºä¸‹ï¼Œé¬“å·²æ˜Ÿæ˜Ÿä¹Ÿã€‚æ‚²æ¬¢ç¦»åˆæ€»æ— æƒ…ï¼Œä¸€ä»»é˜¶å‰ã€ç‚¹æ»´åˆ°å¤©æ˜ã€‚ è’‹æ·ã€Šè™ç¾äººÂ·å¬é›¨ã€‹</li>
<li>æ€å°½æ±Ÿå—ç™¾ä¸‡å…µï¼Œè…°é—´å®å‰‘è¡€çŠ¹è…¥ï¼<br>è€åƒ§ä¸è¯†è‹±é›„æ±‰ï¼Œåªç®¡å““å““é—®å§“åã€‚ æœ±å…ƒç’‹ ã€Šä¸æƒ¹åºµç¤ºåƒ§ã€‹</li>
</ol>
<h4 id="Update-2023-08-11-å†å²è®°å½•"><a href="#Update-2023-08-11-å†å²è®°å½•" class="headerlink" title="Update 2023-08-11 å†å²è®°å½•"></a>Update 2023-08-11 å†å²è®°å½•</h4><ol>
<li>ç¼ºæœˆæŒ‚ç–æ¡ï¼Œæ¼æ–­äººåˆé™ã€‚è°è§å¹½äººç‹¬å¾€æ¥ï¼Œç¼¥ç¼ˆå­¤é¸¿å½±ã€‚æƒŠèµ·å´å›å¤´ï¼Œæœ‰æ¨æ— äººçœã€‚æ‹£å°½å¯’æä¸è‚¯æ –ï¼Œå¯‚å¯æ²™æ´²å†·ã€‚  â€”â€”ã€Šåœç®—å­Â·é»„å·å®šä¼šé™¢å¯“å±…ä½œã€‹</li>
</ol>
]]></content>
      <categories>
        <category>Books</category>
      </categories>
      <tags>
        <tag>è¯—</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo+Githubå»ºç«‹ä¸ªäººåšå®¢è®°å½•</title>
    <url>/2017/12/27/Other/Hexo_Install/</url>
    <content><![CDATA[<p>å»ºç«‹Blogï¼Œè®°å½•è¿‡ç¨‹<br>æ‰€æœ‰çš„é…ç½®éƒ½æ˜¯åœ¨<a href="https://getfedora.org/en/workstation/">Fedora 27 Workstation</a>ç‰ˆæœ¬ä¸‹è¿›è¡Œï¼ŒWindowsé…ç½®ç¯å¢ƒæ¶å¿ƒäº†æˆ‘å¾ˆä¹…æ‰€ä»¥ä¸åšä»‹ç»ã€‚</p>
<h1 id="Hexoéƒ¨ç½²ç¯å¢ƒ"><a href="#Hexoéƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="Hexoéƒ¨ç½²ç¯å¢ƒ"></a>Hexoéƒ¨ç½²ç¯å¢ƒ</h1><p>Hexoè¿è¡Œåœ¨Linuxç¯å¢ƒä¸­çš„é…ç½®åŠå…¶ç®€å•ï¼Œåªéœ€è¦ç¡®è®¤ç³»ç»Ÿä¸­å®‰è£…äº†gitå’ŒNodejså°±å¥½ï¼Œåœ¨Fedora27ä¸­å·²ç»é»˜è®¤æœ‰Gitè½¯ä»¶åŒ…ï¼Œå¦‚æœéœ€è¦å®‰è£…gitä½¿ç”¨<code>dnf install -y git</code>å°±å¥½ã€‚ç›®å‰æˆ‘ä»¬åªéœ€è¦æ·»åŠ nodejså°±å¯ä»¥äº†ï¼Œå‡†å¤‡å·¥ä½œå¼€å§‹ï½<br><strong>ä½¿ç”¨<code>git version</code> è¿›è¡Œgitæ˜¯å¦å­˜åœ¨äºç³»ç»Ÿä¸­çš„æ£€æµ‹ã€‚</strong></p>
<h3 id="å®‰è£…Node-js"><a href="#å®‰è£…Node-js" class="headerlink" title="å®‰è£…Node.js"></a>å®‰è£…Node.js</h3><p>Node.jsçš„å®‰è£…åªéœ€è¦ä¸¤æ¡å‘½ä»¤ï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œå°±å¥½ï¼š  </p>
<ol>
<li><p>ç”¨äºç³»ç»Ÿçš„æ›´æ–°ï¼ŒåŸºæœ¬ä¸Šç­‰å¾…å‘½ä»¤ç»“æŸå°±å¯ä»¥ï¼Œåªæ˜¯ä¿è¯è¿è¡Œç¯å¢ƒçš„æ‰€æœ‰è½¯ä»¶åŒ…éƒ½æ˜¯æœ€æ–°çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p><code>[root@localhost test]# dnf update -y</code>  </p>
</blockquote>
</li>
<li><p>ç”¨äºå®‰è£…Nodejsï¼Œdnfç®¡ç†å™¨ä¼šè‡ªåŠ¨é…ç½®éœ€è¦çš„ä¾èµ–è½¯ä»¶ï¼Œä¹Ÿæ˜¯ç­‰å¾…å°±å¥½ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„æ“ä½œã€‚</p>
<blockquote>
<p><code>[root@localhost test]# dnf install -y nodejs</code></p>
</blockquote>
</li>
</ol>
<h3 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h3><ol>
<li><p>æ¥ä¸‹æ¥éœ€è¦é€‰æ‹©ä¸€ä¸ªä½ æƒ³å®‰è£…çš„ç›®å½•ï¼Œä¾‹å¦‚ï¼š&#x2F;root&#x2F;Document&#x2F;Hexo&#x2F;test  </p>
</li>
<li><p>é‚£ä¹ˆéœ€è¦ç¡®å®šå·¥ä½œç›®å½•å¹¶ä¸”åˆ‡æ¢è¿‡å»  </p>
<blockquote>
<p><code>[root@localhost test]# cd /root/Document/Hexo/test</code>  </p>
</blockquote>
</li>
<li><p>ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•æˆ–è€…å®ƒçš„å­ç›®å½•ï¼Œè¯·ç•™æ„ã€‚  </p>
<blockquote>
<p><code>[root@localhost test]# npm install hexo -g</code>  </p>
</blockquote>
</li>
<li><p>ç­‰å¾…å®‰è£…ç»“æœâ€¦â€¦.  </p>
</li>
<li><p>å®‰è£…ç»“æŸä¹‹åï¼ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ,ä½¿ç”¨ï¼š  </p>
<blockquote>
<p><code>[root@localhost test]# hexo -v</code>  </p>
</blockquote>
</li>
<li><p>å¦‚è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯åˆ™è¯´æ˜å®‰è£…æˆåŠŸï¼Œå¯ä»¥æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚  </p>
<blockquote>
<p>[root@localhost test]# hexo -v<br>hexo: 3.4.4<br>hexo-cli: 1.0.4<br>os: Linux 4.13.13-300.fc27.x86_64 linux x64<br>http_parser: 2.7.1<br>node: 8.9.3<br>v8: 6.1.534.48<br>uv: 1.16.0<br>zlib: 1.2.11<br>ares: 1.10.1-DEV<br>modules: 57<br>nghttp2: 1.25.0<br>openssl: 1.0.2m-fips<br>icu: 57.1<br>unicode: 8.0<br>cldr: 29.0<br>tz: 2016b</p>
</blockquote>
</li>
</ol>
<p>å®‰è£…æˆåŠŸï¼Œæ²¡æœ‰å†™å®‰è£…å¤±è´¥çš„è§£å†³æ–¹æ³•ï¼Œå› ä¸ºæˆ‘è§‰å¾—éš¾ä»¥å¤±è´¥ï¼ŒæˆåŠŸç‡å¾ˆé«˜çš„ã€‚  </p>
<h4 id="å¤±è´¥è§£å†³æ–¹æ¡ˆ"><a href="#å¤±è´¥è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¤±è´¥è§£å†³æ–¹æ¡ˆ"></a>å¤±è´¥è§£å†³æ–¹æ¡ˆ</h4><ol>
<li>å¤±è´¥è¯·æ›´æ¢cnpm æˆ–è€… æ›´æ¢æ·˜å®æºé‡è¯•ã€‚  </li>
<li>å¦‚æœå®‰è£…ï¼Œç¡®è®¤è‡ªå·±åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>npm install</code>é‡è¯•</li>
</ol>
<h3 id="å®‰è£…Hexo-server"><a href="#å®‰è£…Hexo-server" class="headerlink" title="å®‰è£…Hexo-server"></a>å®‰è£…Hexo-server</h3><p>å®‰è£…Hexo-serverä¸»è¦æ˜¯ä½œä¸ºæœ¬åœ°æµ‹è¯•ä½¿ç”¨ï¼Œé€šè¿‡æœ¬åœ°localhost:4000è®¿é—®æ¥é¢„è§ˆï¼Œæ–¹ä¾¿è°ƒæ•´ã€‚  </p>
<ol>
<li><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œå®‰è£…ï¼š  </p>
<blockquote>
<p><code>[root@localhost test]npm install hexo-server -g</code></p>
</blockquote>
</li>
<li><p>æ‰§è¡Œå¯åŠ¨hexo-serverï¼Œç¡®è®¤æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š  </p>
<blockquote>
<p><code>[root@localhost test]hexo s</code><br>OR<br><code>[root@localhost test]hexo server</code>  </p>
</blockquote>
</li>
<li><p>è¾“å…¥å¦‚ä¸‹ç»“æœåˆ™æ­£å¸¸å¯åŠ¨ï¼š  </p>
<blockquote>
<p>[root@localhost test]# hexo s<br> INFO  Start processing<br> INFO  Hexo is running at <a href="http://localhost:4000/">http://localhost:4000/</a>. Press Ctrl+C to stop.  </p>
</blockquote>
</li>
<li><p>è¿™é‡ŒæœåŠ¡å™¨å·²ç»å¯åŠ¨äº†ï¼Œä½¿ç”¨Ctrl+Cåœæ­¢æœåŠ¡ï¼Œæ¢å¤æ­£å¸¸çš„Shellçª—å£ã€‚</p>
</li>
</ol>
<h3 id="åˆå§‹åŒ–Hexo"><a href="#åˆå§‹åŒ–Hexo" class="headerlink" title="åˆå§‹åŒ–Hexo"></a>åˆå§‹åŒ–Hexo</h3><ol>
<li><p>è¿™é‡Œéœ€è¦åˆ›å»ºæ–°çš„Blogç›®å½•ï¼Œä¾‹å¦‚ï¼š&#x2F;root&#x2F;Document&#x2F;Hexo&#x2F;test</p>
</li>
<li><p>åœ¨testç›®å½•ä¸‹æ‰§è¡Œï¼š  </p>
<blockquote>
<p><code>[root@localhost test] hexo init</code>  </p>
</blockquote>
</li>
<li><p>åˆå§‹åŒ–ä¼šå°†Blogæ‰€éœ€çš„æ–‡ä»¶æ”¾å…¥testæ–‡ä»¶å¤¹ä¸­ï¼Œè¿™ä¸ªç›®å½•å°±æ˜¯æˆ‘ä»¬éœ€è¦æ¨åˆ°githubä¸Šé¢çš„ä¸œè¥¿ã€‚ä¹Ÿå°±æ˜¯æ•´ä¸ªåšå®¢çš„æ ¹ç›®å½•ã€‚</p>
</li>
</ol>
<h1 id="é…ç½®Git"><a href="#é…ç½®Git" class="headerlink" title="é…ç½®Git"></a>é…ç½®Git</h1><p>è¿™éƒ¨åˆ†çš„å†…å®¹å·²ç»å’Œæˆ‘ä»¬æœ¬åœ°çš„è®¡ç®—æœºæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„å…³ç³»äº†ï¼Œæˆ‘ä»¬éœ€è¦å»Githubä¸Šé¢æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œåœ¨è¿™ä¸ªè´¦æˆ·é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„repoï¼Œä¾‹å¦‚ï¼š test.github.io<br>æˆ‘ä»¬åœ¨æœ¬åœ°å»ºç«‹çš„siteä½¿ç”¨gitå·¥å…·ï¼Œå°†æ•´ä¸ªblogå‘å¸ƒåˆ°å¯¹åº”çš„è½¯ä»¶ä»“åº“ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é…ç½®gitçš„ä¿¡æ¯<br>ä½¿ç”¨å‘½ä»¤é…ç½®gitçš„ç”¨æˆ·åå’Œé‚®ç®±ï¼š  </p>
<blockquote>
<p><code>[root@localhost test] git config --global user.name &quot;yourname&quot;</code><br><code>[root@localhost test] git config --global user.email &quot;youremailaddress&quot;</code></p>
</blockquote>
<h3 id="æ·»åŠ SSHè®¤è¯"><a href="#æ·»åŠ SSHè®¤è¯" class="headerlink" title="æ·»åŠ SSHè®¤è¯"></a>æ·»åŠ SSHè®¤è¯</h3><p>ä½¿ç”¨sshè¿›è¡Œä¸githubçš„é€šä¿¡å¯ä»¥å…å»æˆ‘ä»¬æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åå¯†ç çš„ç¹çï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ºæœ¬åœ°çš„è®¡ç®—æœºç”Ÿæˆä¸€ä¸ªSSHçš„KEYã€‚  </p>
<ol>
<li><p>å‘½ä»¤å¦‚ä¸‹ï¼š  </p>
<blockquote>
<p><code>[root@localhost test] ssh-keygen -t rsa -C &quot;your_email@example.com&quot;</code>  </p>
</blockquote>
</li>
<li><p>æœŸé—´ä¼šè®©æˆ‘ä»¬è¾“å…¥å¯†ç è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœè¿™ä¸ªä½ç½®è¾“å…¥å¯†ç ï¼Œä»Šåæ¯æ¬¡è¿æ¥åˆ°githubçš„æ—¶å€™ï¼Œéƒ½éœ€è¦è¾“å…¥è¿™ä¸ªå¯†ç æ‰èƒ½è¿æ¥ï¼Œå¦‚æœè¿™é‡Œæˆ‘ä»¬ä¸è¾“å…¥å¯†ç ç›´æ¥å›è½¦ï¼Œä»Šåè¿æ¥çš„æ—¶å€™å°±ä¸éœ€è¦å¯†ç äº†ï¼Œæ¨é€çš„å†…å®¹ä¼šç›´æ¥è¢«æ¨é€ï¼Œä¹‹åè¿”å›ç»“æœã€‚  </p>
</li>
<li><p>ç”Ÿæˆçš„å¯†é’¥ä¼šç›´æ¥æ”¾åœ¨å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶å¤¹é‡Œï¼Œå› æ­¤æˆ‘ä»¬æŠŠä»–æ‰¾å‡ºæ¥ï¼š  </p>
<blockquote>
<p><code>[root@localhost test] cd ~/.ssh</code>  </p>
</blockquote>
</li>
<li><p>å¤åˆ¶id_rsa.pubæ–‡ä»¶å†…çš„æ‰€æœ‰å†…å®¹ï¼Œç²˜è´´åˆ°githubçš„æ·»åŠ SSHå¯†é’¥ä½ç½®ã€‚æˆåŠŸã€‚</p>
</li>
</ol>
<h3 id="è¿æ¥Github"><a href="#è¿æ¥Github" class="headerlink" title="è¿æ¥Github"></a>è¿æ¥Github</h3><p>æµ‹è¯•è¿æ¥åˆ°Githubæ˜¯å¦èƒ½å¤ŸæˆåŠŸï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  </p>
<blockquote>
<p><code>[root@localhost test] ssh -T git@github.com</code>  </p>
</blockquote>
<p>å¦‚æœä¸Šä¸€éƒ¨åˆ†ç”ŸæˆSSHå¯†é’¥çš„æ—¶å€™è¾“å…¥äº†å¯†ç ï¼Œè¯·åœ¨è¿™ä¸ªå‘½ä»¤è¿è¡Œä¹‹åæŒ‰ç…§æç¤ºè¾“å…¥å¯†ç ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š  </p>
<blockquote>
<p>[root@localhost .ssh]# ssh -T <a href="mailto:&#x67;&#105;&#x74;&#x40;&#103;&#105;&#x74;&#x68;&#x75;&#x62;&#46;&#99;&#x6f;&#109;">&#x67;&#105;&#x74;&#x40;&#103;&#105;&#x74;&#x68;&#x75;&#x62;&#46;&#99;&#x6f;&#109;</a><br>Hi test! Youâ€™ve successfully authenticated, but GitHub does not provide shell access.  </p>
</blockquote>
<p>æˆ‘ä»¬å·²ç»æˆåŠŸçš„è¿æ¥ä¸Šäº†Githubä¸Šé¢çš„repoï¼Œgithubçš„é…ç½®ç»“æŸäº†ï½  </p>
<h3 id="é…ç½®Hexo-deployer"><a href="#é…ç½®Hexo-deployer" class="headerlink" title="é…ç½®Hexo-deployer"></a>é…ç½®Hexo-deployer</h3><p>gitå¯ä»¥å°†æˆ‘ä»¬çš„blogæ¨é€åˆ°repoä¸Šé¢å»ï¼Œä½†æ˜¯æœ¬èº«æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨hexoæä¾›çš„å·¥å…·æ¥è¿›è¡Œblogçš„æ›´æ–°ã€‚  </p>
<ol>
<li><p>ç›´æ¥ç¼–è¾‘hexoçš„é…ç½®æ–‡ä»¶ï¼š _config.yml  </p>
<blockquote>
<p><code>[root@localhost test]# vim _config.yml</code></p>
</blockquote>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è¿™ä¸ªéƒ¨åˆ†ï¼Œå¦‚ä¸‹æ˜¯æœ€ç»ˆçš„ä¿®æ”¹ç»“æœï¼š  </p>
<blockquote>
<p> 77 # Deployment<br> 78 ## Docs: <a href="https://hexo.io/docs/deployment.html">https://hexo.io/docs/deployment.html</a></p>
</blockquote>
</li>
</ol>
<p> 79 deploy:<br> 80   type:  git<br> 81   repo:  <a href="mailto:&#103;&#105;&#116;&#64;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#46;&#x63;&#x6f;&#109;">&#103;&#105;&#116;&#64;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#46;&#x63;&#x6f;&#109;</a>:test&#x2F;test.github.io.git<br> 82   branch:  master  </p>
<ol start="3">
<li><p>ç°åœ¨å°†æˆ‘ä»¬æœ¬åœ°çš„é»˜è®¤ç«™ç‚¹æ¨é€åˆ°Githubä¸Šé¢å»è¯•è¯•å§ï¼   </p>
<blockquote>
<p><code>[root@localhost test]# hexo d</code><br>INFO  Deploying: git<br>INFO  Clearing .deploy_git folderâ€¦<br>INFO  Copying files from public folderâ€¦<br>INFO  Copying files from extend dirsâ€¦<br>[master caa83a9] Site updated: 2017-12-27 18:26:01<br> 1 file changed, 63 insertions(+), 11 deletions(-)<br>To github.com:test&#x2F;test.github.io.git<br>62dcd56..caa83a9  HEAD -&gt; master<br>Branch master set up to track remote branch master from   <a href="mailto:&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#x6f;&#109;">&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#x6f;&#109;</a>:test&#x2F;test.github.io.git.<br>INFO  Deploy done: git  </p>
</blockquote>
</li>
<li><p>è¾“å‡ºæœ€åDeploy done,å°±è¡¨ç¤ºæˆ‘ä»¬çš„åŸå§‹é¡µé¢å·²ç»ä¸Šä¼ æˆåŠŸäº†ï½ï¼Œè®¿é—®Repoçš„åå­—å°±å¯ä»¥ç›´æ¥çœ‹åˆ°åˆå§‹blogçš„æ ·å­äº†ã€‚</p>
</li>
<li><p>åç»­æ’ä»¶å®‰è£…çš„è®°å½•:</p>
<pre class="language-none"><code class="language-none">[root@localhost ~]# cnpm list -g --depth 0
&#x2F;usr&#x2F;lib
â”œâ”€â”€ cnpm@6.0.0
â”œâ”€â”€ hexo@3.4.4
â”œâ”€â”€ hexo-cli@1.1.0
â”œâ”€â”€ hexo-generator-archive@0.1.5
â”œâ”€â”€ hexo-generator-category@0.1.3
â”œâ”€â”€ hexo-generator-index@0.2.1
â”œâ”€â”€ hexo-generator-search@2.4.0
â”œâ”€â”€ hexo-generator-tag@0.2.0
â”œâ”€â”€ hexo-render-pug@2.1.0
â”œâ”€â”€ hexo-site@0.0.0
â””â”€â”€ npm@6.4.1</code></pre></li>
</ol>
<h1 id="Hexoå¸¸ç”¨å‘½ä»¤è¯´æ˜"><a href="#Hexoå¸¸ç”¨å‘½ä»¤è¯´æ˜" class="headerlink" title="Hexoå¸¸ç”¨å‘½ä»¤è¯´æ˜"></a>Hexoå¸¸ç”¨å‘½ä»¤è¯´æ˜</h1><p>Hexoç›®å½•ä¸‹å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼š</p>
<pre class="language-none"><code class="language-none">[root@localhost test]# hexo s           &#x2F;&#x2F;å¯åŠ¨hexoæœ¬åœ°æœåŠ¡è¿›è¡Œblogé¢„è§ˆ
[root@localhost test]# hexo new TITLE   &#x2F;&#x2F;æ–°å»ºæ–‡ç« 
[root@localhost test]# hexo clean       &#x2F;&#x2F;æ¸…é™¤ç¼“å­˜
[root@localhost test]# hexo g           &#x2F;&#x2F;é‡æ–°ç”Ÿæˆç«™ç‚¹é¡µé¢æ–‡ä»¶
[root@localhost test]# hexo d           &#x2F;&#x2F;æ¨é€åˆ°github</code></pre>
<h1 id="æ·»åŠ é¼ æ ‡çˆ†ç‚¸ç‚¹å‡»æ•ˆæœ"><a href="#æ·»åŠ é¼ æ ‡çˆ†ç‚¸ç‚¹å‡»æ•ˆæœ" class="headerlink" title="æ·»åŠ é¼ æ ‡çˆ†ç‚¸ç‚¹å‡»æ•ˆæœ"></a>æ·»åŠ é¼ æ ‡çˆ†ç‚¸ç‚¹å‡»æ•ˆæœ</h1><p>åœ¨&#x2F;themes&#x2F;yelee&#x2F;layout&#x2F;layout.ejsçš„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å¼€å§‹ä½ç½®åŠ å…¥å¦‚ä¸‹å­—æ®µï¼š  </p>
<pre class="language-none"><code class="language-none">&lt;head&gt;
  &lt;canvas class&#x3D;&quot;fireworks&quot; style&#x3D;&quot;position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;&quot; &gt;&lt;&#x2F;canvas&gt; 
  &lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;animejs&#x2F;2.2.0&#x2F;anime.min.js&quot;&gt;&lt;&#x2F;script&gt; 
  &lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;js&#x2F;firework.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;&#x2F;head&gt;</code></pre>
<p>åœ¨themes&#x2F;yelee&#x2F;source&#x2F;js&#x2F;å»ºç«‹å¦‚ä¸‹æ–‡ä»¶firework.js,æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š  </p>
<pre class="language-none"><code class="language-none">&quot;use strict&quot;;function updateCoords(e)&#123;pointerX&#x3D;(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY&#x3D;e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top&#125;function setParticuleDirection(e)&#123;var t&#x3D;anime.random(0,360)*Math.PI&#x2F;180,a&#x3D;anime.random(50,180),n&#x3D;[-1,1][anime.random(0,1)]*a;return&#123;x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)&#125;&#125;function createParticule(e,t)&#123;var a&#x3D;&#123;&#125;;return a.x&#x3D;e,a.y&#x3D;t,a.color&#x3D;colors[anime.random(0,colors.length-1)],a.radius&#x3D;anime.random(16,32),a.endPos&#x3D;setParticuleDirection(a),a.draw&#x3D;function()&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle&#x3D;a.color,ctx.fill()&#125;,a&#125;function createCircle(e,t)&#123;var a&#x3D;&#123;&#125;;return a.x&#x3D;e,a.y&#x3D;t,a.color&#x3D;&quot;#F00&quot;,a.radius&#x3D;0.1,a.alpha&#x3D;0.5,a.lineWidth&#x3D;6,a.draw&#x3D;function()&#123;ctx.globalAlpha&#x3D;a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth&#x3D;a.lineWidth,ctx.strokeStyle&#x3D;a.color,ctx.stroke(),ctx.globalAlpha&#x3D;1&#125;,a&#125;function renderParticule(e)&#123;for(var t&#x3D;0;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;function animateParticules(e,t)&#123;for(var a&#x3D;createCircle(e,t),n&#x3D;[],i&#x3D;0;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;targets:n,x:function(e)&#123;return e.endPos.x&#125;,y:function(e)&#123;return e.endPos.y&#125;,radius:0.1,duration:anime.random(1200,1800),easing:&quot;easeOutExpo&quot;,update:renderParticule&#125;).add(&#123;targets:a,radius:anime.random(80,160),lineWidth:0,alpha:&#123;value:0,easing:&quot;linear&quot;,duration:anime.random(600,800)&#125;,duration:anime.random(1200,1800),easing:&quot;easeOutExpo&quot;,update:renderParticule,offset:0&#125;)&#125;function debounce(e,t)&#123;var a;return function()&#123;var n&#x3D;this,i&#x3D;arguments;clearTimeout(a),a&#x3D;setTimeout(function()&#123;e.apply(n,i)&#125;,t)&#125;&#125;var canvasEl&#x3D;document.querySelector(&quot;.fireworks&quot;);if(canvasEl)&#123;var ctx&#x3D;canvasEl.getContext(&quot;2d&quot;),numberOfParticules&#x3D;30,pointerX&#x3D;0,pointerY&#x3D;0,tap&#x3D;&quot;mousedown&quot;,colors&#x3D;[&quot;#FF1461&quot;,&quot;#18FF92&quot;,&quot;#5A87FF&quot;,&quot;#FBF38C&quot;],setCanvasSize&#x3D;debounce(function()&#123;canvasEl.width&#x3D;2*window.innerWidth,canvasEl.height&#x3D;2*window.innerHeight,canvasEl.style.width&#x3D;window.innerWidth+&quot;px&quot;,canvasEl.style.height&#x3D;window.innerHeight+&quot;px&quot;,canvasEl.getContext(&quot;2d&quot;).scale(2,2)&#125;,500),render&#x3D;anime(&#123;duration:1&#x2F;0,update:function()&#123;ctx.clearRect(0,0,canvasEl.width,canvasEl.height)&#125;&#125;);document.addEventListener(tap,function(e)&#123;&quot;sidebar&quot;!&#x3D;&#x3D;e.target.id&amp;&amp;&quot;toggle-sidebar&quot;!&#x3D;&#x3D;e.target.id&amp;&amp;&quot;A&quot;!&#x3D;&#x3D;e.target.nodeName&amp;&amp;&quot;IMG&quot;!&#x3D;&#x3D;e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!1),setCanvasSize(),window.addEventListener(&quot;resize&quot;,setCanvasSize,!1)&#125;&quot;use strict&quot;;function updateCoords(e)&#123;pointerX&#x3D;(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY&#x3D;e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top&#125;function setParticuleDirection(e)&#123;var t&#x3D;anime.random(0,360)*Math.PI&#x2F;180,a&#x3D;anime.random(50,180),n&#x3D;[-1,1][anime.random(0,1)]*a;return&#123;x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)&#125;&#125;function createParticule(e,t)&#123;var a&#x3D;&#123;&#125;;return a.x&#x3D;e,a.y&#x3D;t,a.color&#x3D;colors[anime.random(0,colors.length-1)],a.radius&#x3D;anime.random(16,32),a.endPos&#x3D;setParticuleDirection(a),a.draw&#x3D;function()&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle&#x3D;a.color,ctx.fill()&#125;,a&#125;function createCircle(e,t)&#123;var a&#x3D;&#123;&#125;;return a.x&#x3D;e,a.y&#x3D;t,a.color&#x3D;&quot;#F00&quot;,a.radius&#x3D;0.1,a.alpha&#x3D;0.5,a.lineWidth&#x3D;6,a.draw&#x3D;function()&#123;ctx.globalAlpha&#x3D;a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth&#x3D;a.lineWidth,ctx.strokeStyle&#x3D;a.color,ctx.stroke(),ctx.globalAlpha&#x3D;1&#125;,a&#125;function renderParticule(e)&#123;for(var t&#x3D;0;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;function animateParticules(e,t)&#123;for(var a&#x3D;createCircle(e,t),n&#x3D;[],i&#x3D;0;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;targets:n,x:function(e)&#123;return e.endPos.x&#125;,y:function(e)&#123;return e.endPos.y&#125;,radius:0.1,duration:anime.random(1200,1800),easing:&quot;easeOutExpo&quot;,update:renderParticule&#125;).add(&#123;targets:a,radius:anime.random(80,160),lineWidth:0,alpha:&#123;value:0,easing:&quot;linear&quot;,duration:anime.random(600,800)&#125;,duration:anime.random(1200,1800),easing:&quot;easeOutExpo&quot;,update:renderParticule,offset:0&#125;)&#125;function debounce(e,t)&#123;var a;return function()&#123;var n&#x3D;this,i&#x3D;arguments;clearTimeout(a),a&#x3D;setTimeout(function()&#123;e.apply(n,i)&#125;,t)&#125;&#125;var canvasEl&#x3D;document.querySelector(&quot;.fireworks&quot;);if(canvasEl)&#123;var ctx&#x3D;canvasEl.getContext(&quot;2d&quot;),numberOfParticules&#x3D;30,pointerX&#x3D;0,pointerY&#x3D;0,tap&#x3D;&quot;mousedown&quot;,colors&#x3D;[&quot;#FF1461&quot;,&quot;#18FF92&quot;,&quot;#5A87FF&quot;,&quot;#FBF38C&quot;],setCanvasSize&#x3D;debounce(function()&#123;canvasEl.width&#x3D;2*window.innerWidth,canvasEl.height&#x3D;2*window.innerHeight,canvasEl.style.width&#x3D;window.innerWidth+&quot;px&quot;,canvasEl.style.height&#x3D;window.innerHeight+&quot;px&quot;,canvasEl.getContext(&quot;2d&quot;).scale(2,2)&#125;,500),render&#x3D;anime(&#123;duration:1&#x2F;0,update:function()&#123;ctx.clearRect(0,0,canvasEl.width,canvasEl.height)&#125;&#125;);document.addEventListener(tap,function(e)&#123;&quot;sidebar&quot;!&#x3D;&#x3D;e.target.id&amp;&amp;&quot;toggle-sidebar&quot;!&#x3D;&#x3D;e.target.id&amp;&amp;&quot;A&quot;!&#x3D;&#x3D;e.target.nodeName&amp;&amp;&quot;IMG&quot;!&#x3D;&#x3D;e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!1),setCanvasSize(),window.addEventListener(&quot;resize&quot;,setCanvasSize,!1)&#125;;</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoå¤‡ä»½å’Œæ¢å¤</title>
    <url>/2018/07/03/Other/Hexo_backup-restore/</url>
    <content><![CDATA[<p>hexoé¡¹ç›®çš„å¤‡ä»½å’Œè¿˜åŸæ–¹æ³•ã€‚</p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>ä¸€ä¸ªç‰¹åˆ«æ— å¥ˆçš„é—®é¢˜ï¼Œæˆ‘å°è¯•åœ¨æˆ‘å†™åšå®¢çš„è™šæ‹Ÿæœºé‡Œé¢ä½¿ç”¨äº†ä¸€ä¸ªç ´åæ€§çš„å‘½ä»¤ï¼Œdnf autoremove, å°±æ˜¯è¿™ä¸ªå‘½ä»¤å¯¼è‡´æˆ‘çš„è™šæ‹Ÿæœºå½»åº•åäº†ã€‚æ‰€ä»¥æˆ‘æ¢å¤äº†å¿«ç…§ï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæœˆå‰çš„è®°å½•äº†ã€‚å‘ç°è‡ªå·±çš„blogæ— æ³•æ¢å¤ï¼Œæ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ol>
<li>åœ¨githubä¸Šè®¾ç½®ä¸€ä¸ªæ–°çš„åˆ†æ”¯hexoã€‚</li>
<li>åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šæ”¾ç½®è‡ªå·±å·¥ä½œç›®å½•ä¸‹çš„åŸå§‹æ–‡ä»¶ã€‚</li>
<li>æ¯æ¬¡æ¨é€Blogåˆ°githubçš„æ—¶å€™åŒæ—¶æ¨é€è‡ªå·±çš„å·¥ä½œç›®å½•åˆ°githubã€‚</li>
<li>å½“éœ€è¦æ¢å¤è‡ªå·±çš„æœ¬åœ°ç¯å¢ƒçš„æ—¶å€™ï¼Œç›´æ¥ä»githubä¸Šé¢Cloneä¸‹æ¥å°±å¯ä»¥äº†ã€‚</li>
</ol>
<p>Note: ä¹‹å‰çš„æ€è·¯æ˜¯å»hexoçš„å·¥ä½œç›®å½•ä¸‹é¢æ‰¾blogçš„é¡¹ç›®ï¼Œç¼–è¯‘ä¹‹åæ¨é€é™æ€é¡µé¢åˆ°gtihubã€‚ç°åœ¨æ˜¯ç›´æ¥æŠŠå·¥ä½œç›®å½•ä¼ ä¸Šå»ï¼Œç”¨çš„æ—¶å€™ä¸‹è½½ä¸‹æ¥ã€‚  </p>
<h3 id="1-å‡†å¤‡ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•"><a href="#1-å‡†å¤‡ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•" class="headerlink" title="1. å‡†å¤‡ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•"></a>1. å‡†å¤‡ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•</h3><p>åœ¨ç›®å½•ä¸‹git clone è‡ªå·±çš„Blogé¡¹ç›®ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/xxxx/xxxx.github.io.git</code></pre>
<h3 id="2-ç›®å½•çš„æ„å»º"><a href="#2-ç›®å½•çš„æ„å»º" class="headerlink" title="2. ç›®å½•çš„æ„å»º"></a>2. ç›®å½•çš„æ„å»º</h3><ol>
<li>åˆ°xxxx.github.ioç›®å½•ä¸‹é¢ï¼Œä¿ç•™ä¸‹é¢çš„.gitç›®å½•ï¼Œåˆ é™¤æ‰€æœ‰çš„å…¶ä½™ç›®å½•ã€‚  </li>
<li>å°†ä¹‹å‰çš„hexoå·¥ä½œç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°xxxx.github.ioä¸‹ã€‚  </li>
<li>åœ¨lxxxx.github.ioç›®å½•ä¸‹æ”¾ç½®.gitignoreæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š  <pre class="language-none"><code class="language-none">.DS_Store  
Thumbs.db  
db.json  
*.log  
node_modules&#x2F;  
public&#x2F;  
.deploy*&#x2F;   </code></pre></li>
<li>cd åˆ°xxxx.liarlee.ioç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤æ–°å»ºåˆ†æ”¯ï¼š  <pre class="language-none"><code class="language-none">git checkout -b hexo</code></pre></li>
<li>å°†hexoå·¥ä½œç›®æäº¤åˆ°ç¼“å­˜  <pre class="language-none"><code class="language-none">git add --all</code></pre></li>
<li>æäº¤åˆ°githubçš„hexoåˆ†æ”¯  <pre class="language-none"><code class="language-none">git commit -m &quot;Some statement...&quot;</code></pre></li>
<li>æ¨é€åˆ°è‡ªå·±åšå®¢é¡¹ç›®çš„hexoåˆ†æ”¯ä¸‹    <pre class="language-none"><code class="language-none">git push --set-upstream origin hexo</code></pre></li>
<li>ç»“æŸ</li>
</ol>
<h3 id="3-æ›´æ–°æ–‡ç« "><a href="#3-æ›´æ–°æ–‡ç« " class="headerlink" title="3. æ›´æ–°æ–‡ç« "></a>3. æ›´æ–°æ–‡ç« </h3><ol>
<li>git add â€“all</li>
<li>git commit -m â€œSaySomethingHEREâ€</li>
<li>git push origin hexo </li>
<li>hexo clean &amp;&amp; hexo g -d</li>
</ol>
<h3 id="4-æ¢å¤hexoçš„å·¥ä½œç›®å½•"><a href="#4-æ¢å¤hexoçš„å·¥ä½œç›®å½•" class="headerlink" title="4. æ¢å¤hexoçš„å·¥ä½œç›®å½•"></a>4. æ¢å¤hexoçš„å·¥ä½œç›®å½•</h3><ol>
<li>sudo cnpm install -g hexo-cli</li>
<li>dnf install -y npm</li>
<li>sudo npm install -g cnpm â€“registry&#x3D;<a href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a></li>
<li>cd Liarlee.github.io&#x2F;Liarlee</li>
<li>sudo cnpm install -no-bin-links</li>
<li>sudo cnpm install hexo-deployer-git</li>
<li>å»Githubä¸Šé¢æ·»åŠ æœºå™¨çš„ssh public key </li>
<li>å°è¯•ä½¿ç”¨hexo d , æŸ¥çœ‹æ˜¯å¦å¯ä»¥æˆåŠŸã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Linux, Application</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•è®°å½•</title>
    <url>/2019/07/18/Other/Interview_2019/</url>
    <content><![CDATA[<p>è¿™ä¸ªæœˆè¿˜æ˜¯å‘ç”Ÿäº†ä¸å°‘äº‹æƒ…äº†ï¼Œé¢è¯•ï¼Œæ¢æˆ¿å­ï¼ŒçœŸå¿«ã€‚</p>
<hr>
<h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><ol>
<li><p>æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²s&#x3D;â€œkjdfdsfevsdfâ€,ä½¿ç”¨pythonå•ç‹¬è¾“å‡ºæ¯ä¸ªå­—ç¬¦å¹¶åœ¨åé¢åŠ ä¸Šâ€thâ€.</p>
 <pre class="language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"asdfaurhgauh"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">'th'</span><span class="token punctuation">)</span>	</code></pre></li>
<li><p>æ•°æ®åº“é—®é¢˜ï¼Œå¢åˆ æ”¹æŸ¥ã€‚åŸºæœ¬ä¸Šéƒ½æ²¡ç­”ä¸Šæ¥ã€‚selectè¯­å¥å¯¹æ•°æ®åº“å†…å®¹Whereåšä¸€ä¸ªç­›é€‰ã€‚</p>
</li>
<li><p>æå–b.txtä¸­çš„æ‰€æœ‰åŸŸåï¼Œawkæˆ‘å†™çš„grepã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-o</span> <span class="token string">"www.[[:alpha:]]*.com"</span> ./b.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span>
<span class="token function">awk</span> <span class="token parameter variable">-F</span> / <span class="token string">'&#123;print $3&#125;'</span> b.txt <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span></code></pre>
<p>æˆ‘å†™çš„è¿™ä¸ªå”¯ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹å°±æ˜¯ä¸èƒ½åŒ¹é…æ•°å­—çš„éƒ¨åˆ†ï¼Œå¦‚æœåŸŸåæœ‰æ•°å­—å°±æå–ä¸å‡ºäº†ã€‚å…¶å®ä¸­é—´å¦‚æœå…¨éƒ¨ç”¨æ­£åˆ™ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æ­£åˆ™ä¼šç‰¹åˆ«çš„é•¿ã€‚</p>
</li>
<li><p>nginxçš„åå‘ä»£ç†é…ç½®æ–‡ä»¶æ˜¯ä¸æ˜¯èƒ½çœ‹æ‡‚ï¼Œè€ƒäº†ä¸€ä¸ªupstreamæ¨¡å—ï¼Œè€ƒäº†ä¸€ä¸ªweightçš„åˆ†é…ï¼Œè€ƒäº†ä¸€ä¸ª proxy_passæ¨¡å—çš„è°ƒç”¨ã€‚</p>
</li>
<li><p>æè¿°Raid0 ï¼Œ 1 ï¼Œ5çš„åŒºåˆ«ï¼Œä½†æ˜¯æ²¡è®©è¯´raid10ã€‚</p>
</li>
<li><p>æè¿°å¦‚æœä½ æœ‰å¤šçš„èµ„æºå¦‚ä½•æ­å»ºé«˜å¯ç”¨å’Œé«˜å¹¶å‘ï¼Œè¿™ç§é¢˜ç›®å…¶å®è¿˜æŒºæ— èŠçš„ï¼Œé«˜å¹¶å‘é è´Ÿè½½å‡è¡¡åˆ†æµï¼Œå››å±‚è½¬å‘ä¸ƒå±‚ä»£ç†ã€‚é«˜å¯ç”¨é çš„å†—ä½™å’Œæ•…éšœçš„å¿«é€Ÿåˆ‡æ¢ã€‚æ²¡ä»€ä¹ˆç‰¹åˆ«çš„æ¶æ„ï¼ŒwebæœåŠ¡ä¹Ÿå°±æ˜¯keepalived + lvsã€‚ç¡¬ä»¶çš„è¯F5ç›´æ¥æï¼Œè™½ç„¶æˆ‘æ²¡è§è¿‡ï¼Œä½†æ˜¯ä¹Ÿå¬è¯´è¿‡ã€‚</p>
</li>
<li><p>å®¹å™¨é—®äº†ä¸€ä¸ªç§æœ‰çš„register,ä¸è®°å¾—å«ä»€ä¹ˆåå­—ï¼Œä½†æ˜¯æˆ‘çŸ¥é“Dockerå®˜æ–¹æœ‰æ–‡æ¡£ã€‚<strong>è½¯ä»¶åç§°æ˜¯Harbor</strong></p>
</li>
<li><p>k8sæ²¡ä»€ä¹ˆå¯è¯´äº†ï¼Œæ˜¨å¤©æ™šä¸Šå¬äº†ä¸€å †çš„k8sçš„ç†è®ºï¼Œä¸€ä¸ªé›†ç¾¤ç®€å•è€Œè¦ä¸‰ä¸ªç½‘ç»œï¼Œè¦ä¸æ˜¯è®¾è®¡æ€è·¯æ¸…æ™°ï¼Œç½‘ç»œå°±å·²ç»æ˜¯ä¸€é”…ç²¥äº†ã€‚è½¯ä»¶çš„æ¶æ„çœŸçš„æ˜¯è¶Šæ¥è¶Šå¤æ‚äº†ï¼Œç°åœ¨çš„ç½‘ç»œé‡Œé¢ä¸æ˜¯æ¡¥æ¡¥æ¡¥ï¼Œå°±æ˜¯NATè½¬æ¢ã€‚</p>
</li>
<li><p>æŸ¥çœ‹Linuxç³»ç»ŸCPUï¼ŒMEMï¼ŒNET-IOï¼ŒDISK-IOçš„å‘½ä»¤ã€‚top | htop | free -m | iostat -a</p>
</li>
<li><p>ext4å¦‚æœåˆ†åŒºè¶…è¿‡2Tå¦‚ä½•æ“ä½œã€‚è¿™é¢˜ä¼°è®¡æœ¬æ¥æ˜¯é—®Ext3æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ”¹çš„ã€‚Ext4éšä¾¿åˆ†äº†å·²ç»ã€‚</p>
</li>
<li><p>å¦‚ä½•ç†è§£topå‘½ä»¤ä¸­çš„load averageçš„å«ä¹‰<br> è¿™ä¸ªé—®é¢˜æœ¬æ¥æ˜¯èŠåˆ°äº†æœåŠ¡å™¨æ€§èƒ½çš„è§‚å¯Ÿï¼Œæˆ‘è¯´åˆ°äº†topå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„å½“å‰çŠ¶å†µï¼Œæ‰€ä»¥åç»­æœ‰äº†è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™ä¸‰ä¸ªæ•°å€¼çš„è®¡ç®—æ–¹å¼æ˜¯é€šè¿‡CPUè¿›ç¨‹é˜Ÿåˆ—çš„é•¿åº¦æ¥è¿›è¡Œè®¡ç®—çš„ï¼Œå…·ä½“çš„æ•°å€¼åŠè®¡ç®—å…¬å¼ç½‘ä¸Šæœ‰å¾ˆå¤š,ç­‰æˆ‘ä¸è®°å¾—äº†æˆ‘åœ¨å»æ‰¾èµ„æ–™å§ï¼Œè¿™ç§ä¸œè¥¿å·²ç»æ˜¯æ­»çŸ¥è¯†äº†ï¼Œåˆ°å¤„éƒ½æ˜¯ã€‚<br> æˆ‘è¯´è¯´æˆ‘çš„ç†è§£ï¼Œè¿™ä¸‰ä¸ªæ•°å€¼å…¶å®æ˜¯system load average,æ˜¯ç³»ç»Ÿçš„è´Ÿè½½çŠ¶æ€ï¼Œå…¶å®æ˜¯æè¿°äº†<strong>ç³»ç»Ÿçš„å‹åŠ›å˜åŒ–è¶‹åŠ¿</strong>ï¼Œè®¡ç®—çš„CPUå‚æ•°ä¸»è¦æ˜¯Running Process &amp; uninterreptable Process , å…¶å®å°±æ˜¯<strong>æ­£åœ¨è¿è¡Œ</strong>å’Œ<strong>ä¸å¯ä¸­æ–­è¿è¡Œ</strong>çš„è¿›ç¨‹ï¼Œè¿™äº›æ˜¯<strong>CPUçš„å·¥ä½œé‡</strong>ã€‚è¿˜æœ‰ä¸€ä¸ªè¡¡é‡çš„å‚æ•°å®é™…ä¸Šæ˜¯<strong>IO</strong>ï¼ŒIOçš„æŒ‡æ ‡ä¹Ÿä¼šä½“ç°åœ¨ä¸‰ä¸ªä¸åŒæ—¶é—´ç‚¹çš„è®¡ç®—ä¸­ã€‚<br> å¦‚ä½•æŸ¥çœ‹æˆ–è€…åˆ†ææ˜¯æˆ‘ä¸€ç›´ç†è§£çš„ä¸é€å½»çš„ç‚¹ï¼Œè®°å½•ä¸€ä¸‹ã€‚å•é¡¹æŒ‡æ ‡çš„è§‚å¯Ÿä¸è¶³ä»¥è§£å†³ç³»ç»Ÿçš„é—®é¢˜ï¼Œéœ€è¦æ­é…å…¶ä»–çš„å·¥å…·è¿›è¡Œåˆ†ææ‰å¯ä»¥ã€‚<br> çœ‹ä¸‰ä¸ªå‚æ•°çš„<strong>å˜åŒ–è¶‹åŠ¿</strong>ï¼Œ1ï¼Œ5ï¼Œ15ä¸‰ä¸ªæ—¶é—´ç‚¹ï¼š  </p>
<ul>
<li>å¦‚æœ<strong>1åˆ†é’Ÿé«˜</strong>ï¼Œä½†æ˜¯åé¢ä¸¤ä¸ªéƒ½ä½ï¼Œè¯´æ˜ç³»ç»Ÿå½“å‰çš„çŠ¶æ€æ˜¯å‹åŠ›é«˜çš„ï¼Œä½†æ˜¯æ˜¯æš‚æ—¶çš„ã€‚</li>
<li>å¦‚æœæ˜¯<strong>ä¸‰ä¸ªæ•°å€¼éƒ½é«˜</strong>ï¼Œå¯ä»¥è¯´æ˜å¯èƒ½æ˜¯ç³»ç»Ÿçš„æ€§èƒ½ä¸è¶³æˆ–è€…æœ‰é—®é¢˜éœ€è¦è§£å†³ã€‚</li>
<li>å¦‚æœ<strong>1åˆ†é’Ÿçš„æ•°å€¼ä½</strong>ï¼Œä½†æ˜¯<strong>15åˆ†é’Ÿçš„æ•°å€¼é«˜</strong>ï¼Œè¯´æ˜ç³»ç»Ÿçš„å‹åŠ›ä¼šæ…¢æ…¢å¹³ç¨³ä¸‹æ¥ï¼Œä¸ä¼šæŒç»­å¤ªä¹…ã€‚</li>
</ul>
</li>
<li><p>pså‘½ä»¤çš„ä½¿ç”¨</p>
<ul>
<li>ps aux <ul>
<li>To see every process on the system using BSD syntax <pre class="language-none"><code class="language-none">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.1  0.0 186736 10160 ?        Ss   09:32   0:03 &#x2F;sbin&#x2F;init
root         2  0.0  0.0      0     0 ?        S    09:32   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        I&lt;   09:32   0:00 [rcu_gp]
root         4  0.0  0.0      0     0 ?        I&lt;   09:32   0:00 [rcu_par_gp]
root         6  0.0  0.0      0     0 ?        I&lt;   09:32   0:00 [kworker&#x2F;0:0H-kblockd]
root         8  0.0  0.0      0     0 ?        I&lt;   09:32   0:00 [mm_percpu_wq]
root         9  0.0  0.0      0     0 ?        S    09:32   0:00 [ksoftirqd&#x2F;0]
root        10  0.0  0.0      0     0 ?        I    09:32   0:00 [rcu_preempt]
root        11  0.0  0.0      0     0 ?        I    09:32   0:00 [rcu_sched]
root        12  0.0  0.0      0     0 ?        I    09:32   0:00 [rcu_bh]</code></pre></li>
</ul>
</li>
<li>ps axjf &#x2F; ps -ejH<ul>
<li>To print a process tree  <pre class="language-none"><code class="language-none">PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND
1   555   555   555 ?           -1 Ssl      0   0:00 &#x2F;usr&#x2F;bin&#x2F;gdm
555   585   555   555 ?           -1 Sl       0   0:00  \_ gdm-session-worker [pam&#x2F;gdm-launch-environment]
585   789   789   789 tty1       789 Ssl+   120   0:00  |   \_ &#x2F;usr&#x2F;lib&#x2F;gdm-x-session gnome-session --autostart &#x2F;usr&#x2F;share&#x2F;gdm&#x2F;g
789   791   789   789 tty1       789 Sl+    120   0:01  |       \_ &#x2F;usr&#x2F;lib&#x2F;Xorg vt1 -displayfd 3 -auth &#x2F;run&#x2F;user&#x2F;120&#x2F;gdm&#x2F;Xautho
791   848   789   789 tty1       789 S+       0   0:00  |       |   \_ xf86-video-intel-backlight-helper intel_backlight
789   939   789   789 tty1       789 Sl+    120   0:00  |       \_ &#x2F;usr&#x2F;lib&#x2F;gnome-session-binary --autostart &#x2F;usr&#x2F;share&#x2F;gdm&#x2F;gree
939   970   789   789 tty1       789 Sl+    120   0:04  |           \_ &#x2F;usr&#x2F;bin&#x2F;gnome-shell
970  1032  1032   789 tty1       789 Sl     120   0:00  |           |   \_ ibus-daemon --xim --panel disable
1032  1035  1032   789 tty1       789 Sl     120   0:00  |           |       \_ &#x2F;usr&#x2F;lib&#x2F;ibus&#x2F;ibus-dconf
1032  1200  1032   789 tty1       789 Sl     120   0:00  |           |       \_ &#x2F;usr&#x2F;lib&#x2F;ibus&#x2F;ibus-engine-simple
939  1086   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-rfkill
939  1088   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-smartcard
939  1089   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-clipboard
939  1090   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-xsettings
939  1091   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-housekeeping
939  1092   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-mouse
939  1093   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-power
939  1094   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-screensaver-proxy
939  1095   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-sound
939  1099   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-color
939  1101   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-keyboard
939  1103   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-print-notifications
939  1104   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-sharing
939  1105   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-a11y-settings
939  1106   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-wacom
939  1107   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-datetime
939  1108   789   789 tty1       789 Sl+    120   0:00  |           \_ &#x2F;usr&#x2F;lib&#x2F;gsd-media-keys</code></pre></li>
</ul>
</li>
</ul>
</li>
<li><p>Buffer å’Œ Cacheçš„åŒºåˆ« </p>
<ul>
<li>Bufferï¼šA buffer is somthing that has yet to be â€œwrittenâ€ to disk.</li>
<li>Cacheï¼šA Cache is something that has been â€œreadâ€ from the disk and stored for later use.</li>
</ul>
<p>free æˆ–è€… top å‘½ä»¤ä¸­çš„buffer å’Œ cacheï¼š  </p>
<ul>
<li>Bufferï¼š ä½œä¸ºBuffer-cacheçš„ä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ˜¯å—è®¾å¤‡çš„è¯»å†™ç¼“å†²åŒºã€‚</li>
<li>Cacheï¼š ä½œä¸ºPage-cacheçš„ä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ˜¯ç¼“å†²æ–‡ä»¶ç³»ç»Ÿçš„cacheã€‚</li>
<li>Bufferï¼ˆç¼“å†²åŒºï¼‰æ˜¯ç³»ç»Ÿä¸¤ç«¯å¤„ç†é€Ÿåº¦å¹³è¡¡ï¼ˆä»é•¿æ—¶é—´å°ºåº¦ä¸Šçœ‹ï¼‰æ—¶ä½¿ç”¨çš„ã€‚å®ƒçš„å¼•å…¥æ˜¯ä¸ºäº†å‡å°çŸ­æœŸå†…çªå‘I&#x2F;Oçš„å½±å“ï¼Œèµ·åˆ°æµé‡æ•´å½¢çš„ä½œç”¨ã€‚æ¯”å¦‚ç”Ÿäº§è€…â€”â€”æ¶ˆè´¹è€…é—®é¢˜ï¼Œä»–ä»¬äº§ç”Ÿå’Œæ¶ˆè€—èµ„æºçš„é€Ÿåº¦å¤§ä½“æ¥è¿‘ï¼ŒåŠ ä¸€ä¸ªbufferå¯ä»¥æŠµæ¶ˆæ‰èµ„æºåˆšäº§ç”Ÿ&#x2F;æ¶ˆè€—æ—¶çš„çªç„¶å˜åŒ–ã€‚</li>
<li>Cacheï¼ˆç¼“å­˜ï¼‰åˆ™æ˜¯ç³»ç»Ÿä¸¤ç«¯å¤„ç†é€Ÿåº¦ä¸åŒ¹é…æ—¶çš„ä¸€ç§æŠ˜è¡·ç­–ç•¥ã€‚å› ä¸ºCPUå’Œmemoryä¹‹é—´çš„é€Ÿåº¦å·®å¼‚è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥äººä»¬å……åˆ†åˆ©ç”¨æ•°æ®çš„å±€éƒ¨æ€§ï¼ˆlocalityï¼‰ç‰¹å¾ï¼Œé€šè¿‡ä½¿ç”¨å­˜å‚¨ç³»ç»Ÿåˆ†çº§ï¼ˆmemory hierarchyï¼‰çš„ç­–ç•¥æ¥å‡å°è¿™ç§å·®å¼‚å¸¦æ¥çš„å½±å“ã€‚<br>ç­”æ¡ˆæ¥æºé“¾æ¥:<br><a href="https://www.zhihu.com/question/26190832/answer/32387918">çŸ¥ä¹</a></li>
</ul>
</li>
<li><p>iptablesçš„é“¾è¡¨ç»“æ„ï¼š<br> è¡¨ï¼š   </p>
<ul>
<li>Filter   			ä¸€èˆ¬çš„è¿‡æ»¤åŠŸèƒ½  </li>
<li>NAT  			NATåŠŸèƒ½çš„ç›¸å…³è®¾ç½®  </li>
<li>Mangle  			ç”¨äºå¯¹ç‰¹å®šæ•°æ®åŒ…çš„ä¿®æ”¹  </li>
<li>Raw  			ä¸€èˆ¬è®¾ç½®ä¸éœ€è¦iptablesè¿‡æ»¤åŠç›‘æ§çš„æµé‡ï¼Œæé«˜æ€§èƒ½ä½¿ç”¨ã€‚  <ul>
<li>Rawè¡¨çš„ä½¿ç”¨:<pre><code>iptables -t raw -A PREROUTING -d 1.2.3.4 -p tcp --dport 80 -j NOTRACK
iptables -t raw -A PREROUTING -s 1.2.3.4 -p tcp --sport 80 -j NOTRACK
iptables -A FORWARD -m state --state UNTRACKED -j ACCEPT
</code></pre>
</li>
</ul>
</li>
</ul>
<p> é“¾ï¼š  </p>
<ul>
<li>PREROUTING æ•°æ®åŒ…è¿›å…¥è·¯ç”±è¡¨ä¹‹å‰çš„Hookå‡½æ•°  </li>
<li>INPUT æ•°æ®åŒ…ç»è¿‡è·¯ç”±è¡¨åè¿›å…¥æœ¬æœºçš„æ•°æ®  </li>
<li>FORWARD  	æ•°æ®åŒ…ç»è¿‡è·¯ç”±è¡¨åä¸æ˜¯æœ¬æœºçš„æ•°æ®  <ul>
<li>å‰é¢ä¸‰ä¸ªç»è¿‡è·¯ç”±è¡¨çš„é€‰æ‹©ï¼Œåé¢ä¸¤ä¸ªä¸ä¼šå†æ¬¡ç»è¿‡è·¯ç”±è¡¨</li>
</ul>
</li>
<li>OUTPUT æ•°æ®åŒ…æ˜¯æœ¬æœºäº§ç”Ÿçš„ï¼Œå‘å¤–å‘é€</li>
<li>POSTROUTING å‘é€åˆ°ç½‘å¡æ¥å£ä¹‹å‰</li>
</ul>
</li>
<li><p>å¦‚ä½•è§‚å¯Ÿç½‘å¡çš„æµé‡åŠtcpdumpçš„ä½¿ç”¨</p>
</li>
</ol>
]]></content>
      <tags>
        <tag>Personal</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux-ç”µè¯é¢è¯•</title>
    <url>/2018/01/29/Other/Interview_%E7%94%B5%E8%AF%9D%E9%9D%A2%E8%AF%95/</url>
    <content><![CDATA[<p>å°±åœ¨åˆšåˆšç»å†äº†ç”µè¯é¢è¯•ï¼Œå¿«é€Ÿå›å¿†é—®æˆ‘çš„é—®é¢˜ï¼Œè®°ä¸‹ï¼š  </p>
<span id="more"></span>

<h3 id="linuxä¸­topå‘½ä»¤çš„ç”¨é€”ï¼Ÿtopå‘½ä»¤ä¸­loadå‚æ•°çš„è¯¦ç»†æ¦‚å¿µ"><a href="#linuxä¸­topå‘½ä»¤çš„ç”¨é€”ï¼Ÿtopå‘½ä»¤ä¸­loadå‚æ•°çš„è¯¦ç»†æ¦‚å¿µ" class="headerlink" title="linuxä¸­topå‘½ä»¤çš„ç”¨é€”ï¼Ÿtopå‘½ä»¤ä¸­loadå‚æ•°çš„è¯¦ç»†æ¦‚å¿µ"></a>linuxä¸­topå‘½ä»¤çš„ç”¨é€”ï¼Ÿtopå‘½ä»¤ä¸­loadå‚æ•°çš„è¯¦ç»†æ¦‚å¿µ</h3><p>é—®é¢˜é—®çš„æˆ‘å½“æ—¶æ²¡ååº”è¿‡æ¥ï¼Œè¯´çš„æ˜¯topå‘½ä»¤ä¸­ç¬¬ä¸€è¡Œçš„é‚£ä¸ªload average,ä¸€å…±æœ‰ä¸‰ä¸ªå€¼ï¼Œä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¾ç¤ºäº†ä¸€åˆ†é’Ÿï¼Œäº”åˆ†é’Ÿï¼Œåäº”åˆ†é’Ÿçš„ç³»ç»Ÿè´Ÿè½½æƒ…å†µï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡1ï¼Œè¶…è¿‡5è®¤ä¸ºæ˜¯è¶…è´Ÿè·è¿è½¬ã€‚  </p>
<h3 id="é‚®ä»¶æœåŠ¡å™¨ä½¿ç”¨çš„åè®®ï¼Ÿ"><a href="#é‚®ä»¶æœåŠ¡å™¨ä½¿ç”¨çš„åè®®ï¼Ÿ" class="headerlink" title="é‚®ä»¶æœåŠ¡å™¨ä½¿ç”¨çš„åè®®ï¼Ÿ"></a>é‚®ä»¶æœåŠ¡å™¨ä½¿ç”¨çš„åè®®ï¼Ÿ</h3><p>ä½¿ç”¨SMTPåè®®ï¼ŒIMAPåè®®</p>
<ul>
<li>å‘é€é‚®ä»¶çš„åè®®å’Œç«¯å£å·ï¼š<br>SMTPåè®®ç«¯å£å·ä¸ºï¼š25å’Œ465</li>
<li>æ¥å—é‚®ä»¶çš„åè®®å’Œç«¯å£å·ï¼š<br>POP3åè®®ç«¯å£å·ä¸ºï¼š110å’Œ995<br>IMAPåè®®ç«¯å£å·ä¸ºï¼š143å’Œ993</li>
</ul>
<h3 id="windowsçš„æ•…éšœè½¬ç§»é›†ç¾¤æ˜¯å¦ç”¨è¿‡ï¼Ÿ"><a href="#windowsçš„æ•…éšœè½¬ç§»é›†ç¾¤æ˜¯å¦ç”¨è¿‡ï¼Ÿ" class="headerlink" title="windowsçš„æ•…éšœè½¬ç§»é›†ç¾¤æ˜¯å¦ç”¨è¿‡ï¼Ÿ"></a>windowsçš„æ•…éšœè½¬ç§»é›†ç¾¤æ˜¯å¦ç”¨è¿‡ï¼Ÿ</h3><h3 id="keepalivedä½¿ç”¨ä»€ä¹ˆåè®®å®ç°æ£€æµ‹å¿ƒè·³ï¼Ÿ"><a href="#keepalivedä½¿ç”¨ä»€ä¹ˆåè®®å®ç°æ£€æµ‹å¿ƒè·³ï¼Ÿ" class="headerlink" title="keepalivedä½¿ç”¨ä»€ä¹ˆåè®®å®ç°æ£€æµ‹å¿ƒè·³ï¼Ÿ"></a>keepalivedä½¿ç”¨ä»€ä¹ˆåè®®å®ç°æ£€æµ‹å¿ƒè·³ï¼Ÿ</h3><p>keepalivedæ˜¯ä»¥VRRPåè®®ä¸ºå®ç°åŸºç¡€çš„ï¼ŒVRRPå…¨ç§°Virtual Router Redundancy Protocolï¼Œå³è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ã€‚</p>
<h3 id="keepalivedä¸»ä»æœåŠ¡å™¨çš„é€‰ä¸¾ç»†èŠ‚ï¼Ÿ"><a href="#keepalivedä¸»ä»æœåŠ¡å™¨çš„é€‰ä¸¾ç»†èŠ‚ï¼Ÿ" class="headerlink" title="keepalivedä¸»ä»æœåŠ¡å™¨çš„é€‰ä¸¾ç»†èŠ‚ï¼Ÿ"></a>keepalivedä¸»ä»æœåŠ¡å™¨çš„é€‰ä¸¾ç»†èŠ‚ï¼Ÿ</h3><p>Keepalivedæ˜¯ä¸€ä¸ªåŸºäºVRRPåè®®æ¥å®ç°çš„WEB æœåŠ¡é«˜å¯ç”¨æ–¹æ¡ˆï¼Œå¯ä»¥åˆ©ç”¨å…¶æ¥é¿å…å•ç‚¹æ•…éšœã€‚ä¸€ä¸ªWEBæœåŠ¡è‡³å°‘ä¼šæœ‰2å°æœåŠ¡å™¨è¿è¡ŒKeepalivedï¼Œä¸€å°ä¸ºä¸»æœåŠ¡å™¨ï¼ˆMASTERï¼‰ï¼Œä¸€å°ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼ˆBACKUPï¼‰ï¼Œä½†æ˜¯å¯¹å¤–è¡¨ç°ä¸ºä¸€ä¸ªè™šæ‹ŸIPï¼Œä¸»æœåŠ¡å™¨ä¼šå‘é€ç‰¹å®šçš„æ¶ˆæ¯ç»™å¤‡ä»½æœåŠ¡å™¨ï¼Œå½“å¤‡ä»½æœåŠ¡å™¨æ”¶ä¸åˆ°è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œå³ä¸»æœåŠ¡å™¨å®•æœºçš„æ—¶å€™ï¼Œå¤‡ä»½æœåŠ¡å™¨å°±ä¼šæ¥ç®¡è™šæ‹ŸIPï¼Œç»§ç»­æä¾›æœåŠ¡ï¼Œä»è€Œä¿è¯äº†é«˜å¯ç”¨æ€§ã€‚</p>
<h3 id="keepalivedåŸç†ï¼Ÿè„‘è£‚é—®é¢˜ä½¿ç”¨pingç½‘å…³çš„æ–¹å¼ä¸èƒ½å®Œç¾è§£å†³ï¼Ÿ"><a href="#keepalivedåŸç†ï¼Ÿè„‘è£‚é—®é¢˜ä½¿ç”¨pingç½‘å…³çš„æ–¹å¼ä¸èƒ½å®Œç¾è§£å†³ï¼Ÿ" class="headerlink" title="keepalivedåŸç†ï¼Ÿè„‘è£‚é—®é¢˜ä½¿ç”¨pingç½‘å…³çš„æ–¹å¼ä¸èƒ½å®Œç¾è§£å†³ï¼Ÿ"></a>keepalivedåŸç†ï¼Ÿè„‘è£‚é—®é¢˜ä½¿ç”¨pingç½‘å…³çš„æ–¹å¼ä¸èƒ½å®Œç¾è§£å†³ï¼Ÿ</h3><p>è®¾ç½®ä¸»ä»pingç½‘å…³ï¼Œå¦‚æœæ²¡æœ‰pingé€šè®¤ä¸ºè‡ªå·±çš„ç½‘ç»œå‡ºé—®é¢˜ï¼Œé‡å¯æœåŠ¡ã€‚é¢è¯•å®˜æç¤ºæˆ‘æ­£ç¡®çš„å¤„ç†æ–¹å¼åº”è¯¥æ˜¯ï¼Œå¦‚æœpingä¸é€šåº”è¯¥ä¸»æœåŠ¡å™¨é‡å¯æœåŠ¡ï¼Œä»æœåŠ¡å™¨ç›´æ¥å…³é—­è‡ªå·±çš„å¯¹å¤–æœåŠ¡ã€‚</p>
<h3 id="LVSçš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œå’Œè½¬å‘è¯·æ±‚æ¨¡å¼ï¼Ÿ"><a href="#LVSçš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œå’Œè½¬å‘è¯·æ±‚æ¨¡å¼ï¼Ÿ" class="headerlink" title="LVSçš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œå’Œè½¬å‘è¯·æ±‚æ¨¡å¼ï¼Ÿ"></a>LVSçš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œå’Œè½¬å‘è¯·æ±‚æ¨¡å¼ï¼Ÿ</h3><p>ç›®å‰æœ‰ä¸‰ç§IPè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼ˆVS&#x2F;NATã€VS&#x2F;TUNå’ŒVS&#x2F;DRï¼‰å…«ç§è°ƒåº¦ç®—æ³•ï¼ˆrr,wrr,lc,wlc,lblc,lblcr,dh,shï¼‰ã€‚</p>
<h3 id="webæœåŠ¡å™¨å¦‚ä½•å°†ä¸åŒç«™ç‚¹é…ç½®åœ¨åŒä¸€ä¸ªIPä¸Šï¼Ÿè™šæ‹Ÿä¸»æœºé…ç½®å¤šä¸ªç«™ç‚¹çš„åŒºåˆ†æ–¹å¼ï¼Ÿ"><a href="#webæœåŠ¡å™¨å¦‚ä½•å°†ä¸åŒç«™ç‚¹é…ç½®åœ¨åŒä¸€ä¸ªIPä¸Šï¼Ÿè™šæ‹Ÿä¸»æœºé…ç½®å¤šä¸ªç«™ç‚¹çš„åŒºåˆ†æ–¹å¼ï¼Ÿ" class="headerlink" title="webæœåŠ¡å™¨å¦‚ä½•å°†ä¸åŒç«™ç‚¹é…ç½®åœ¨åŒä¸€ä¸ªIPä¸Šï¼Ÿè™šæ‹Ÿä¸»æœºé…ç½®å¤šä¸ªç«™ç‚¹çš„åŒºåˆ†æ–¹å¼ï¼Ÿ"></a>webæœåŠ¡å™¨å¦‚ä½•å°†ä¸åŒç«™ç‚¹é…ç½®åœ¨åŒä¸€ä¸ªIPä¸Šï¼Ÿè™šæ‹Ÿä¸»æœºé…ç½®å¤šä¸ªç«™ç‚¹çš„åŒºåˆ†æ–¹å¼ï¼Ÿ</h3><p>ipå’Œç«¯å£</p>
<h3 id="freeå‘½ä»¤ä¸­cacheå’Œbufferçš„åŒºåˆ«ï¼Ÿ"><a href="#freeå‘½ä»¤ä¸­cacheå’Œbufferçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="freeå‘½ä»¤ä¸­cacheå’Œbufferçš„åŒºåˆ«ï¼Ÿ"></a>freeå‘½ä»¤ä¸­cacheå’Œbufferçš„åŒºåˆ«ï¼Ÿ</h3><blockquote>
<p>A buffer is something that has yet to be â€œwrittenâ€ to disk. A cache is something that has been â€œreadâ€ from the disk and stored for later use.  </p>
</blockquote>
<p>å¯¹äºè®¡ç®—æœºæ¥è®²cache å’Œ bufferçš„åŒºåˆ«ï¼š</p>
<ul>
<li><p><strong>Cache</strong>ï¼šé«˜é€Ÿç¼“å­˜ï¼Œæ˜¯ä½äºCPUä¸ä¸»å†…å­˜é—´çš„ä¸€ç§å®¹é‡è¾ƒå°ä½†é€Ÿåº¦å¾ˆé«˜çš„å­˜å‚¨å™¨ã€‚ç”±äºCPUçš„é€Ÿåº¦è¿œé«˜äºä¸»å†…å­˜ï¼ŒCPUç›´æ¥ä»å†…å­˜ä¸­å­˜å–æ•°æ®è¦ç­‰å¾…ä¸€å®šæ—¶é—´å‘¨æœŸï¼ŒCacheä¸­ä¿å­˜ç€CPUåˆšç”¨è¿‡æˆ–å¾ªç¯ä½¿ç”¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå½“CPUå†æ¬¡ä½¿ç”¨è¯¥éƒ¨åˆ†æ•°æ®æ—¶å¯ä»Cacheä¸­ç›´æ¥è°ƒç”¨ï¼Œè¿™æ ·å°±å‡å°‘äº†CPUçš„ç­‰å¾…æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚Cacheåˆåˆ†ä¸ºä¸€çº§Cacheï¼ˆL1 Cacheï¼‰å’ŒäºŒçº§Cacheï¼ˆL2 Cacheï¼‰ï¼ŒL1 Cacheé›†æˆåœ¨CPUå†…éƒ¨ï¼ŒL2 Cacheæ—©æœŸä¸€èˆ¬æ˜¯ç„Šåœ¨ä¸»æ¿ä¸Šï¼Œç°åœ¨ä¹Ÿéƒ½é›†æˆåœ¨CPUå†…éƒ¨ï¼Œå¸¸è§çš„å®¹é‡æœ‰256KBæˆ–512KB L2 Cacheã€‚</p>
</li>
<li><p><strong>Buffer</strong>ï¼šç¼“å†²åŒºï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨é€Ÿåº¦ä¸åŒæ­¥çš„è®¾å¤‡æˆ–ä¼˜å…ˆçº§ä¸åŒçš„è®¾å¤‡ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŒºåŸŸã€‚é€šè¿‡ç¼“å†²åŒºï¼Œå¯ä»¥ä½¿è¿›ç¨‹ä¹‹é—´çš„ç›¸äº’ç­‰å¾…å˜å°‘ï¼Œä»è€Œä½¿ä»é€Ÿåº¦æ…¢çš„è®¾å¤‡è¯»å…¥æ•°æ®æ—¶ï¼Œé€Ÿåº¦å¿«çš„è®¾å¤‡çš„æ“ä½œè¿›ç¨‹ä¸å‘ç”Ÿé—´æ–­ã€‚</p>
</li>
</ul>
<p>*Freeä¸­çš„bufferå’Œcacheï¼šï¼ˆå®ƒä»¬éƒ½æ˜¯å ç”¨å†…å­˜ï¼‰   </p>
<ul>
<li><strong>buffer</strong>: ä½œä¸ºbuffer cacheçš„å†…å­˜ï¼Œæ˜¯å—è®¾å¤‡çš„è¯»å†™ç¼“å†²åŒº  </li>
<li><strong>cache</strong>: ä½œä¸ºpage cacheçš„å†…å­˜ï¼Œ æ–‡ä»¶ç³»ç»Ÿçš„cache<br>å¦‚æœ cache çš„å€¼å¾ˆå¤§ï¼Œè¯´æ˜cacheä½çš„æ–‡ä»¶æ•°å¾ˆå¤šã€‚å¦‚æœé¢‘ç¹è®¿é—®åˆ°çš„æ–‡ä»¶éƒ½èƒ½è¢«cacheä½ï¼Œé‚£ä¹ˆç£ç›˜çš„è¯»IO å¿…ä¼šéå¸¸å°ã€‚</li>
</ul>
<h3 id="windowsä¸­æ‰‹åŠ¨è®¡ç®—çš„å†…å­˜ä½¿ç”¨å€¼ï¼Œå’Œä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºå‡ºæ¥çš„å€¼ç›¸å·®å·¨å¤§ï¼Ÿ"><a href="#windowsä¸­æ‰‹åŠ¨è®¡ç®—çš„å†…å­˜ä½¿ç”¨å€¼ï¼Œå’Œä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºå‡ºæ¥çš„å€¼ç›¸å·®å·¨å¤§ï¼Ÿ" class="headerlink" title="windowsä¸­æ‰‹åŠ¨è®¡ç®—çš„å†…å­˜ä½¿ç”¨å€¼ï¼Œå’Œä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºå‡ºæ¥çš„å€¼ç›¸å·®å·¨å¤§ï¼Ÿ"></a>windowsä¸­æ‰‹åŠ¨è®¡ç®—çš„å†…å­˜ä½¿ç”¨å€¼ï¼Œå’Œä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºå‡ºæ¥çš„å€¼ç›¸å·®å·¨å¤§ï¼Ÿ</h3><p>windowséšè—äº†ç±»ä¼¼linuxä¸­çš„cacheå’Œbufferï¼Œwindows10åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å·²ç»å¼€å§‹æ˜¾ç¤ºcacheäº†</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerä¸­è¿è¡ŒDCM4CHEE-arc-light</title>
    <url>/2018/07/02/Other/Other_DCM4CHEE_RunDocker/</url>
    <content><![CDATA[<p>åœ¨Dockerä¸­å®‰è£…DCM4CHEE-arc-lighté¡¹ç›®ã€‚</p>
<span id="more"></span>

<p>å› ä¸ºéœ€è¦è¿›è¡Œæµ‹è¯•æ‰€ä»¥ä½¿ç”¨äº†DCM4CHEEï¼Œ ä½†æ˜¯DCM4CHEEç°åœ¨çš„ç‰ˆæœ¬å·²ç»å¾ˆå¤è€äº†ï¼Œ ä»è€Œæˆ‘æ¥è§¦äº†ä¸¤ä¸ªå¤è€çš„PACSç¨‹åºï¼Œ ä¸€ä¸ªæ˜¯Windowså¹³å°ä¸Šæœ‰åçš„ClearCanvas, è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯DCM4CHEEã€‚<br>åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¾ˆå¤šçš„éº»çƒ¦ã€‚ çœ‹åˆ°å®˜æ–¹æœ‰æŠŠé¡¹ç›®æ”¾åœ¨dockerä¸Šï¼Œ æ‰€ä»¥å†³å®šç›´æ¥ä½¿ç”¨ã€‚ç›´æ¥è®°å½•äº†æ‰€æœ‰çš„ç»„ä»¶å¯åŠ¨çš„æ–¹å¼å’Œå‘½ä»¤ï¼Œ æ–¹ä¾¿ä»Šåçš„æŸ¥é˜…ã€‚</p>
<p>DCM4CHEE-arc-lightæ˜¯ç›®å‰æ¯”è¾ƒæ–°é¡¹ç›®äº†ï¼Œæˆ‘è¿™é‡Œå†™ä¸‹äº†æœ€å°çš„å®‰è£…æ¨¡å¼ï¼Œ åŸºæœ¬ä¸Šè¶³å¤Ÿæˆ‘æ—¥å¸¸æµ‹è¯•ä½¿ç”¨äº†ã€‚</p>
<p>è¿™å‡ ä¸ªDockerå®¹å™¨æ˜¯ï¼š</p>
<ol>
<li>Docker</li>
<li>dockerç½‘æ¡¥</li>
<li>DAOCloudåŠ é€Ÿå™¨</li>
<li>OpenLDAP</li>
<li>PostgreSQLæ•°æ®åº“</li>
<li>DCM4CHEE-arc-lightæœ¬ä½“</li>
</ol>
<h2 id="DCM4CHEE-Docker-Command"><a href="#DCM4CHEE-Docker-Command" class="headerlink" title="DCM4CHEE_Docker_Command"></a>DCM4CHEE_Docker_Command</h2><ol>
<li><p>Install Docker component:   </p>
 <pre class="language-none"><code class="language-none">dnf install -y docker  </code></pre>
</li>
<li><p>Create the dcm4chee bridge network:  </p>
 <pre class="language-none"><code class="language-none">docker network create dcm4chee_default  </code></pre></li>
<li><p>DAOCloudåŠ é€Ÿå™¨é…ç½®dockerï¼š</p>
 <pre class="language-none"><code class="language-none">curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;daotools&#x2F;set_mirror.sh | sh -s http:&#x2F;&#x2F;f1dac9f0.m.daocloud.io</code></pre>
</li>
<li><p>Start OpenLDAP Server: </p>
 <pre class="language-none"><code class="language-none">docker run --network&#x3D;dcm4chee_default --name ldap \
       -p 389:389 \
       -v &#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime:ro \
       -v &#x2F;var&#x2F;local&#x2F;dcm4chee-arc&#x2F;ldap:&#x2F;var&#x2F;lib&#x2F;ldap \
       -v &#x2F;var&#x2F;local&#x2F;dcm4chee-arc&#x2F;slapd.d:&#x2F;etc&#x2F;ldap&#x2F;slapd.d \
       -d dcm4che&#x2F;slapd-dcm4chee:2.4.44-13.2  </code></pre>
</li>
<li><p>Start PostgreSQL:   </p>
 <pre class="language-none"><code class="language-none">docker run --network&#x3D;dcm4chee_default --name db \
       -p 5432:5432 \
       -e POSTGRES_DB&#x3D;pacsdb \
       -e POSTGRES_USER&#x3D;pacs \
       -e POSTGRES_PASSWORD&#x3D;pacs \
       -v &#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime:ro \
       -v &#x2F;var&#x2F;local&#x2F;dcm4chee-arc&#x2F;db:&#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;data \
       -d dcm4che&#x2F;postgres-dcm4chee:10.0-13  </code></pre>
</li>
<li><p>Start Wildfly With DCM4CHEE Archive 5:  </p>
 <pre class="language-none"><code class="language-none">docker run --network&#x3D;dcm4chee_default --name arc \
       -p 8080:8080 \
       -p 8443:8443 \
       -p 9990:9990 \
       -p 11112:11112 \
       -p 2575:2575 \
       -e POSTGRES_DB&#x3D;pacsdb \
       -e POSTGRES_USER&#x3D;pacs \
       -e POSTGRES_PASSWORD&#x3D;pacs \
       -e WILDFLY_WAIT_FOR&#x3D;&quot;ldap:389 db:5432&quot; \
       -v &#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime:ro \
       -v &#x2F;var&#x2F;local&#x2F;dcm4chee-arc&#x2F;wildfly:&#x2F;opt&#x2F;wildfly&#x2F;standalone \
       -d dcm4che&#x2F;dcm4chee-arc-psql:5.13.2  </code></pre>
</li>
<li><p>Start the three applications use on command:  </p>
 <pre class="language-none"><code class="language-none">docker start ldap db arc  </code></pre>
</li>
<li><p>Stop the three application:  </p>
 <pre class="language-none"><code class="language-none">docker stop ldap db arc  </code></pre></li>
</ol>
<h2 id="é™„åŠ è¯´æ˜ï¼š"><a href="#é™„åŠ è¯´æ˜ï¼š" class="headerlink" title="é™„åŠ è¯´æ˜ï¼š"></a>é™„åŠ è¯´æ˜ï¼š</h2><h3 id="Host-è¯´æ˜ï¼š"><a href="#Host-è¯´æ˜ï¼š" class="headerlink" title="Host è¯´æ˜ï¼š"></a>Host è¯´æ˜ï¼š</h3><pre><code>dcm4chee_docker: 11.11.11.209/dcm4chee-arc/ui2
</code></pre>
<h3 id="Github-Project-DCM4CHEE-arc-light-Note"><a href="#Github-Project-DCM4CHEE-arc-light-Note" class="headerlink" title="Github Project DCM4CHEE-arc-light Note"></a>Github Project DCM4CHEE-arc-light Note</h3><ol>
<li><a href="https://github.com/dcm4che/dcm4chee-arc-light/wiki/HL7-Related-Features">HL7 Relative Features</a></li>
<li><a href="">Weasis Integration</a><a href="https://github.com/dcm4che/dcm4chee-arc-light/wiki/Weasis-Viewer-Integration">https://github.com/dcm4che/dcm4chee-arc-light/wiki/Weasis-Viewer-Integration</a></li>
</ol>
]]></content>
      <categories>
        <category>Healthcare-IT</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker/Containerd/Harbor é…ç½®ä»£ç†</title>
    <url>/2022/12/20/Other/Other_Docker-daemon-proxy-setting-md/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹ Docker Daemon &#x2F; Containerd é…ç½®ä»£ç†çš„æ­¥éª¤ï¼Œå°½ç®¡èƒ½ç”¨çš„æ—¶å€™ä¸å¤ªå¤šã€‚</p>
<p>Update - 2023-07-10 Add Harbor.</p>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="åˆ›å»ºæ–‡ä»¶"><a href="#åˆ›å»ºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ–‡ä»¶"></a>åˆ›å»ºæ–‡ä»¶</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-pv</span> /etc/systemd/system/docker.service.d
<span class="token punctuation">]</span>$ <span class="token function">touch</span> /etc/systemd/system/docker.service.d/proxy.conf</code></pre>

<h2 id="å†™å…¥å†…å®¹"><a href="#å†™å…¥å†…å®¹" class="headerlink" title="å†™å…¥å†…å®¹"></a>å†™å…¥å†…å®¹</h2><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">HTTP_PROXY=socks5://&lt;-->:&lt;-->/</span>"</span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">HTTPS_PROXY=socks5://&lt;-->:&lt;-->/</span>"</span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">NO_PROXY=localhost,127.0.0.1</span>"</span></code></pre>

<h2 id="é‡å¯DockerDaemon"><a href="#é‡å¯DockerDaemon" class="headerlink" title="é‡å¯DockerDaemon"></a>é‡å¯DockerDaemon</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl daemon-reload <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart <span class="token function">docker</span></code></pre>

<h1 id="Containerd"><a href="#Containerd" class="headerlink" title="Containerd"></a>Containerd</h1><h2 id="åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶"><a href="#åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶" class="headerlink" title="åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶"></a>åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-pv</span> /etc/systemd/system/containerd.service.d
<span class="token punctuation">]</span>$ <span class="token function">touch</span> /etc/systemd/system/containerd.service.d/proxy.conf</code></pre>

<h2 id="å†™å…¥å†…å®¹-1"><a href="#å†™å…¥å†…å®¹-1" class="headerlink" title="å†™å…¥å†…å®¹"></a>å†™å…¥å†…å®¹</h2><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">HTTP_PROXY=socks5://&lt;-->:&lt;-->/</span>"</span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">HTTPS_PROXY=socks5://&lt;-->:&lt;-->/</span>"</span>
<span class="token key attr-name">Environment</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">NO_PROXY=localhost,127.0.0.1</span>"</span></code></pre>

<h2 id="é‡å¯-Containerd"><a href="#é‡å¯-Containerd" class="headerlink" title="é‡å¯ Containerd"></a>é‡å¯ Containerd</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl daemon-reload <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart <span class="token function">docker</span></code></pre>

<h2 id="Harbor-ä»“åº“åŠ ä»£ç†"><a href="#Harbor-ä»“åº“åŠ ä»£ç†" class="headerlink" title="Harbor ä»“åº“åŠ ä»£ç†"></a>Harbor ä»“åº“åŠ ä»£ç†</h2><p>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ç›´æ¥ç»™harborä»“åº“æ·»åŠ ä»£ç†ï¼Œ è®©Harboræ¥è¿›è¡Œä»£ç†è®¿é—® ï¼Œå¸®å¿™pullé•œåƒï¼Œ é›†ç¾¤ç›´æ¥æŒ‡å‘è¿™ä¸ªä»“åº“å³å¯ã€‚</p>
<p>harboræˆ‘æ˜¯ç›´æ¥ä½¿ç”¨docker-compose çš„æ–¹å¼éƒ¨ç½²çš„ï¼Œ è¿™æ ·ç®€å•ä¸€äº›ã€‚ </p>
<p>æˆ‘çš„è½¯ä»¶å®‰è£…ç›®å½•æ˜¯åœ¨: <code>/opt/harbor</code></p>
<ol>
<li><p>æ‰¾åˆ°harbor çš„é…ç½®æ–‡ä»¶ï¼š <code>/opt/harbor/harbor.yml</code></p>
</li>
<li><p>é…ç½®æ–‡ä»¶éƒ¨åˆ†å¦‚ä¸‹ï¼š </p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">189	<span class="token comment"># Global proxy</span>
190	<span class="token comment"># Config http proxy for components, e.g. http://my.proxy.com:3128</span>
191	<span class="token comment"># Components doesn't need to connect to each others via http proxy.</span>
192	<span class="token comment"># Remove component from `components` array if want disable proxy</span>
193	<span class="token comment"># for it. If you want use proxy for replication, MUST enable proxy</span>
194	<span class="token comment"># for core and jobservice, and set `http_proxy` and `https_proxy`.</span>
195	<span class="token comment"># Add domain to the `no_proxy` field, when you want disable proxy</span>
196	<span class="token comment"># for some special registry.</span>
<span class="token key atrule">197	proxy</span><span class="token punctuation">:</span>
<span class="token key atrule">198	  http_proxy</span><span class="token punctuation">:</span> socks5<span class="token punctuation">:</span>//ip<span class="token punctuation">:</span>port
<span class="token key atrule">199	  https_proxy</span><span class="token punctuation">:</span> socks5<span class="token punctuation">:</span>//ip<span class="token punctuation">:</span>port
<span class="token key atrule">200	  no_proxy</span><span class="token punctuation">:</span>
<span class="token key atrule">201	  components</span><span class="token punctuation">:</span>
202	    <span class="token punctuation">-</span> core
203	    <span class="token punctuation">-</span> jobservice
204	    <span class="token punctuation">-</span> trivy</code></pre>
</li>
<li><p>å¯åŠ¨æœåŠ¡ä¹‹åè¿›å…¥å®¹å™¨è¿›è¡Œç¡®è®¤ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">core<span class="token punctuation">]</span>$ <span class="token function">dc</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> core <span class="token function">bash</span>

harbor <span class="token punctuation">[</span> /harbor <span class="token punctuation">]</span>$ <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> proxy
<span class="token assign-left variable">PERMITTED_REGISTRY_TYPES_FOR_PROXY_CACHE</span><span class="token operator">=</span>docker-hub,harbor,azure-acr,aws-ecr,google-gcr,quay,docker-registry,github-ghcr
<span class="token assign-left variable">NO_PROXY</span><span class="token operator">=</span>redis,chartmuseum,portal,db,.internal,.local,127.0.0.1,localhost,core,trivy-adapter,nginx,postgresql,registryctl,log,jobservice,registry,notary-server,notary-signer,exporter
<span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span>socks5://ip:port
<span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span>socks5://ip:port</code></pre>
</li>
<li><p>ç¯å¢ƒå˜é‡å·²ç»ç”Ÿæ•ˆäº†ï¼Œ ç„¶åç›´æ¥åœ¨æ§åˆ¶å°åˆ›å»ºé¡¹ç›®ï¼Œ åˆ›å»ºæ–°çš„ä»“åº“ç¼“å­˜ä»£ç†ã€‚</p>
<p>æˆ‘åˆ›å»ºçš„ä»“åº“å¦‚ä¸‹ï¼Œé™¤äº†åˆ—å‡ºçš„å…¶ä»–<strong>ç•™ç©º</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æä¾›è€…</th>
<th>ç›®æ ‡å</th>
<th>ç›®æ ‡URL</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Quay</td>
<td>registry.k8s.io</td>
<td><a href="https://registry.k8s.io/">https://registry.k8s.io</a></td>
</tr>
<tr>
<td align="left">GtihubGHCR</td>
<td>ghcr.io</td>
<td><a href="https://ghcr.io/">https://ghcr.io</a></td>
</tr>
<tr>
<td align="left">Quay</td>
<td>k8s.gcr.io (Archived)</td>
<td><a href="https://k8s.gcr.io/">https://k8s.gcr.io</a></td>
</tr>
<tr>
<td align="left">Quay</td>
<td>gcr.io</td>
<td><a href="https://gcr.io/">https://gcr.io</a></td>
</tr>
<tr>
<td align="left">Quay</td>
<td>quay.io</td>
<td><a href="https://quay.io/">https://quay.io</a></td>
</tr>
<tr>
<td align="left">Docker Hub</td>
<td>docker.io</td>
<td><a href="https://hub.docker.com/">https://hub.docker.com</a></td>
</tr>
<tr>
<td align="left">DockerRegistry</td>
<td>public.ecr.aws</td>
<td><a href="https://public.ecr.aws/">https://public.ecr.aws</a></td>
</tr>
</tbody></table>
</li>
</ol>
<p>æ‰€æœ‰ä»“åº“çš„å¥åº·æ£€æŸ¥æ˜¯é€šè¿‡çš„ï¼Œ ç„¶åå»åˆ›å»ºé¡¹ç›®ï¼Œ å°±è¡Œäº†ã€‚ </p>
<p>åˆ›å»ºå®Œæˆé¡¹ç›®ä¹‹åï¼Œ å°±å¯ä»¥é€šè¿‡å½“å‰è¿™ä¸ªä»“åº“çš„é¡¹ç›®åœ°å€æ¥pull é•œåƒäº†ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull reg.liarlee.site/docker.io/library/nginx:latest
<span class="token function">docker</span> pull reg.liarlee.site/registry.k8s.io/metrics-server/metrics-server@sha256:1ab8d2722ce57979eb05ec0594cb9173e07ace16a253c747bb94c31b138a07dc
<span class="token function">docker</span> pull reg.liarlee.site/public.ecr.aws/amazonlinux/amazonlinux:minimal
<span class="token function">docker</span> pull reg.liarlee.site/quay.io/prometheus/prometheus
<span class="token function">docker</span> pull reg.liarlee.site/quay.io/argoproj/argocd
<span class="token function">docker</span> pull reg.liarlee.site/ghcr.io/dexidp/dex</code></pre>

]]></content>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ¶ä½œä¸€ä¸ªå¯ç”¨çš„malloc image</title>
    <url>/2023/01/03/Other/Other_Malloc-docker-image-md/</url>
    <content><![CDATA[<h1 id="å†™ä¸€ä¸ªmellocçš„Cç¨‹åº"><a href="#å†™ä¸€ä¸ªmellocçš„Cç¨‹åº" class="headerlink" title="å†™ä¸€ä¸ªmellocçš„Cç¨‹åº"></a>å†™ä¸€ä¸ªmellocçš„Cç¨‹åº</h1><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SIGTERM_MSG</span> <span class="token string">"SIGTERM received.\n"</span></span>
 
<span class="token keyword">void</span> <span class="token function">sig_term_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token class-name">siginfo_t</span> <span class="token operator">*</span>info<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">write</span><span class="token punctuation">(</span>STDERR_FILENO<span class="token punctuation">,</span> SIGTERM_MSG<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>SIGTERM_MSG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">void</span> <span class="token function">catch_sigterm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> _sigact<span class="token punctuation">;</span>
 
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_sigact<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>_sigact<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _sigact<span class="token punctuation">.</span>sa_sigaction <span class="token operator">=</span> sig_term_handler<span class="token punctuation">;</span>
    _sigact<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_SIGINFO<span class="token punctuation">;</span>
 
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGTERM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>_sigact<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> argc <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ERROR ELEMENT COUNTS."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// printf ("%ld\n", atol(argv[1]));</span>

    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
    <span class="token keyword">long</span> n <span class="token operator">=</span> <span class="token function">atol</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token comment">// printf ("%ld\n", n);</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Allocate Memory Size: %ld MB.\n"</span><span class="token punctuation">,</span> <span class="token function">atol</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Allocate Memory.</span>
    p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SUCCESS."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FAILED."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">memset</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">catch_sigterm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h1 id="å†™ä¸€ä¸ªDockerfile"><a href="#å†™ä¸€ä¸ªDockerfile" class="headerlink" title="å†™ä¸€ä¸ªDockerfile"></a>å†™ä¸€ä¸ªDockerfile</h1><pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> alpine</span>
<span class="token instruction"><span class="token keyword">RUN</span> apk add build-base</span>
<span class="token instruction"><span class="token keyword">COPY</span> mem.c .</span>
<span class="token instruction"><span class="token keyword">RUN</span> gcc -o mem mem.c</span>
<span class="token comment"># or RUN gcc -static -o mem mem.c</span>

<span class="token instruction"><span class="token keyword">FROM</span> alpine</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">0</span></span> ./mem .</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [ <span class="token string">"/mem"</span> ]</span></code></pre>

<h1 id="è¿›è¡Œä¸€ä¸ªå¾ˆæ–°çš„æµ‹è¯•"><a href="#è¿›è¡Œä¸€ä¸ªå¾ˆæ–°çš„æµ‹è¯•" class="headerlink" title="è¿›è¡Œä¸€ä¸ªå¾ˆæ–°çš„æµ‹è¯•"></a>è¿›è¡Œä¸€ä¸ªå¾ˆæ–°çš„æµ‹è¯•</h1><p>Build Image.</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">dive build <span class="token parameter variable">-t</span> liarlee-malloc:latest <span class="token builtin class-name">.</span>
OR
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> liarlee-malloc:latest <span class="token builtin class-name">.</span></code></pre>
<h2 id="Docker-RUN"><a href="#Docker-RUN" class="headerlink" title="Docker RUN."></a>Docker RUN.</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> malloc <span class="token parameter variable">--rm</span> <span class="token parameter variable">-dt</span> liarlee-malloc:latest <span class="token number">200</span>
<span class="token comment"># docker run --name malloc --rm -dt liarlee-malloc:latest [MemorySize(MB)]</span></code></pre>
<h2 id="Kubernetes-Deployment-RUN"><a href="#Kubernetes-Deployment-RUN" class="headerlink" title="Kubernetes Deployment RUN."></a>Kubernetes Deployment RUN.</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liarlee<span class="token punctuation">-</span>malloc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> malloc
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span> 
  <span class="token key atrule">template</span><span class="token punctuation">:</span> 
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> malloc
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> malloc
        <span class="token key atrule">image</span><span class="token punctuation">:</span> liarlee<span class="token punctuation">-</span>malloc<span class="token punctuation">:</span>latest
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"200"</span> <span class="token punctuation">]</span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>pyautoguiè‡ªåŠ¨è„šæœ¬</title>
    <url>/2019/05/17/Python/Python_Script-ForGame/</url>
    <content><![CDATA[<p>å®åœ¨æ˜¯è‚ä¸åŠ¨äº†ï¼Œè‡ªå·±å†™äº†ä¸ªè„šæœ¬å¸®æˆ‘ç‚¹ç‚¹ç‚¹ã€‚  </p>
<h1 id="Pyautoguiè¯´æ˜"><a href="#Pyautoguiè¯´æ˜" class="headerlink" title="Pyautoguiè¯´æ˜"></a>Pyautoguiè¯´æ˜</h1><p>pyautogui.position()  #  è·å–é¼ æ ‡ä½ç½®<br>pyautogui.locateOnScreen()  #  å¯¹å±å¹•æˆªå›¾ï¼Œè·å–å›¾ç‰‡æ–‡ä»¶æ‰€å¯¹åº”çš„å±å¹•åæ ‡<br>pyautogui.click()   #  æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»<br>pyautogui.doubleclick()  #  æ¨¡æ‹Ÿé¼ æ ‡åŒå‡»<br>pyautogui.moveTo()  #  ç§»åŠ¨åˆ°å±å¹•åæ ‡ä½ç½®<br>pyautogui.moveRel()     #  ç§»åŠ¨å›ºå®šçš„åæ ‡è·ç¦»<br>pyautogui.dragRel()     #  æŒ‰ä½é¼ æ ‡æ‹–æ‹½  </p>
<h1 id="ä»£ç å¦‚ä¸‹ï¼š"><a href="#ä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="ä»£ç å¦‚ä¸‹ï¼š"></a>ä»£ç å¦‚ä¸‹ï¼š</h1><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding:UTF-8 -*-</span>

<span class="token keyword">import</span> pyautogui
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">MOTIONMOUSE</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> lines <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">:</span>
        <span class="token comment"># æ£€æµ‹æ˜¯å¦æœ‰ä¹¦æœ¬æˆ–é£Ÿç‰©</span>
        results_food <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./food.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment"># æ£€æµ‹é£Ÿç‰©å›¾ç‰‡æ˜¯å¦å­˜åœ¨</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- é£Ÿç‰©æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_food<span class="token punctuation">)</span>
        results_book <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./book.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment"># æ£€æµ‹ä¹¦ç±å›¾ç‰‡æ˜¯å¦å­˜åœ¨</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- ä¹¦æœ¬æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_book<span class="token punctuation">)</span>
        pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token comment"># ç‚¹å‡»æ¢çº¿</span>
        <span class="token keyword">if</span> results_book <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">325</span><span class="token punctuation">)</span> <span class="token comment"># ç‚¹å‡»å­¦ä¹ </span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">645</span><span class="token punctuation">)</span> <span class="token comment"># ç‚¹å‡»ç¡®å®š</span>
        <span class="token keyword">elif</span> results_food <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">325</span><span class="token punctuation">)</span>  <span class="token comment"># ç‚¹å‡»é£Ÿç”¨</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

        pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>    <span class="token comment"># ç§»åŠ¨åˆ°å¯¹åº”ä¸€çº¿çš„ä½ç½®</span>
        pyautogui<span class="token punctuation">.</span>moveRel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">65</span> <span class="token operator">*</span> lines<span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>  <span class="token comment"># ç§»åŠ¨åˆ°å¯¹åº”çš„çº¿è·¯ä½ç½®</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># è§¦å‘ä¸€æ¬¡ç‚¹å‡»</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment">#  </span>
        <span class="token comment"># æ£€æµ‹æ˜¯å¦æœ‰ä¹¦æœ¬æˆ–é£Ÿç‰©</span>
        results_food <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./food.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- é£Ÿç‰©æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_food<span class="token punctuation">)</span>
        results_book <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./book.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- ä¹¦æœ¬æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_book<span class="token punctuation">)</span>
        <span class="token keyword">if</span> results_book <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">325</span><span class="token punctuation">)</span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">645</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> results_food <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">325</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

        <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lines<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            pyautogui<span class="token punctuation">.</span>dragRel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

        pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1700</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token comment"># starting .....</span>

Count <span class="token operator">=</span> <span class="token number">0</span>
replace_times <span class="token operator">=</span> <span class="token number">0</span>
Energy <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'please input value of energy: '</span><span class="token punctuation">)</span>        <span class="token comment"># è¾“å…¥ä½“åŠ›</span>
All_lines <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'please input the number of lines: '</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å…¥æ‰€æœ‰çº¿è·¯çš„æ•°å­—</span>

<span class="token keyword">for</span> turns <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'** è¿™æ˜¯ç¬¬ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>turns<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' è½®é‡‡é›†ã€‚'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>All_lines<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'* è¿™æ˜¯ç¬¬ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' æ¡çº¿è·¯ã€‚'</span><span class="token punctuation">)</span>
        clock <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%H:%M:%S'</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'* å¼€å§‹æ—¶é—´ = '</span> <span class="token operator">+</span> clock <span class="token operator">+</span> <span class="token string">' '</span><span class="token punctuation">)</span>
        MOTIONMOUSE<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">770</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span>
        pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span><span class="token number">1310</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span>

        <span class="token comment">#æ£€æµ‹æ˜¯å¦æœ‰æ ‘æœ¨</span>
        results_click <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./level4_usable.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># è®¡ç®—æ–§å­åœ¨ä¸åœ¨</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- æ–§å­æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_click<span class="token punctuation">)</span>
        results_replace <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'./level4_replace.png'</span><span class="token punctuation">,</span> grayscale<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># è®¡ç®—å¯æ›¿æ¢çš„æ–§å­åœ¨ä¸åœ¨</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'- æ›´æ¢æ£€æµ‹ç»“æœï¼š'</span><span class="token punctuation">,</span> results_replace<span class="token punctuation">)</span>

        <span class="token comment"># åˆ¤æ–­æ˜¯å¦æœ‰ç‰©å“</span>
        <span class="token keyword">if</span> results_click <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># åˆ¤æ–­æ˜¯å¦æœ‰æŒ‰é”®ï¼Œæœ‰ç­‰å¾…ï¼Œæ²¡æœ‰æŒ‰é”®æ¢çº¿ï¼›</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'* ç¬¬ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' æ¬¡é‡‡é›†ã€‚'</span><span class="token punctuation">)</span>
            Count <span class="token operator">=</span> Count <span class="token operator">+</span><span class="token number">1</span>
            energy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Energy<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">15</span>
        <span class="token keyword">elif</span> results_replace <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>   <span class="token comment"># åˆ¤æ–­æ˜¯å¦æœ‰å¯æ›´æ¢çš„æ–§å­ </span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1510</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
            pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token number">1310</span><span class="token punctuation">,</span> <span class="token number">880</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
            Count <span class="token operator">=</span> Count <span class="token operator">+</span> <span class="token number">1</span>
            replace_times <span class="token operator">=</span> replace_times <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿™æ˜¯ç¬¬ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' æ¬¡é‡‡é›†ã€‚'</span><span class="token punctuation">)</span> 
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿™æ˜¯ç¬¬ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>replace_times<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' æ¬¡æ¢æ–§å­ã€‚'</span><span class="token punctuation">)</span>
            energy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Energy<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">15</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-- é‡‡é›†ç‰©æˆ–æ–§å­æœªå­˜åœ¨ï¼Œè·³è¿‡ã€‚'</span><span class="token punctuation">)</span> 
            <span class="token keyword">pass</span>            <span class="token comment"># å•¥ä¹Ÿæ²¡æœ‰ï¼Œè·³è¿‡</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Starting Waiting for Refresh:'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></code></pre>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå…¥é—¨ç¬”è®° (ä¸€)</title>
    <url>/2018/01/08/Python/Python_%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-1/</url>
    <content><![CDATA[<h2 id="Pythonçš„è¾“å…¥è¾“å‡º"><a href="#Pythonçš„è¾“å…¥è¾“å‡º" class="headerlink" title="Pythonçš„è¾“å…¥è¾“å‡º"></a>Pythonçš„è¾“å…¥è¾“å‡º</h2><pre class="language-none"><code class="language-none">print(&#39;Hello,World!&#39;)  
name &#x3D; input()
print(&#39;Your name is&#39;, name, &#39;,Right?&#39;)</code></pre>

<h2 id="Pythonå­—ç¬¦ä¸­æ–‡ç¼–ç Title"><a href="#Pythonå­—ç¬¦ä¸­æ–‡ç¼–ç Title" class="headerlink" title="Pythonå­—ç¬¦ä¸­æ–‡ç¼–ç Title"></a>Pythonå­—ç¬¦ä¸­æ–‡ç¼–ç Title</h2><pre class="language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python3  
# -*- coding: utf-8 -*-  

a &#x3D; input()
age &#x3D; int(a)                       \\printè¾“å‡ºéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ ¼å¼åŒ–ä¸ºæ•°å­—ä¹‹åæ‰å¯ä»¥ä½¿ç”¨</code></pre>

<h2 id="Pythonè¾“å‡ºå¤šè¡Œå†…å®¹"><a href="#Pythonè¾“å‡ºå¤šè¡Œå†…å®¹" class="headerlink" title="Pythonè¾“å‡ºå¤šè¡Œå†…å®¹"></a>Pythonè¾“å‡ºå¤šè¡Œå†…å®¹</h2><pre class="language-none"><code class="language-none">print(&#39;&#39;&#39;line1
...line2
...line3
&#39;&#39;&#39;)</code></pre>

<h2 id="Pythonçš„è¯­å¥æ‹¼æ¥"><a href="#Pythonçš„è¯­å¥æ‹¼æ¥" class="headerlink" title="Pythonçš„è¯­å¥æ‹¼æ¥"></a>Pythonçš„è¯­å¥æ‹¼æ¥</h2><pre class="language-none"><code class="language-none">print(&#39;Hello,World!&#39;,&#39;My Name is Liarlee.&#39;)  </code></pre>

<h2 id="Pythonå ä½ç¬¦"><a href="#Pythonå ä½ç¬¦" class="headerlink" title="Pythonå ä½ç¬¦"></a>Pythonå ä½ç¬¦</h2><pre class="language-none"><code class="language-none">name &#x3D; Liarlee
age &#x3D; 24
print(&#39;Hello,%s&#39; % (name))
print(&#39;Your age is %d&#39; % (age))</code></pre>

<h2 id="Pythonä¸­ä½¿ç”¨listå’Œtuple"><a href="#Pythonä¸­ä½¿ç”¨listå’Œtuple" class="headerlink" title="Pythonä¸­ä½¿ç”¨listå’Œtuple"></a>Pythonä¸­ä½¿ç”¨listå’Œtuple</h2><h3 id="List-â€“-åˆ—è¡¨"><a href="#List-â€“-åˆ—è¡¨" class="headerlink" title="List â€“ åˆ—è¡¨"></a>List â€“ åˆ—è¡¨</h3><pre class="language-none"><code class="language-none">classmates &#x3D; [Liarlee,TEST,WTF,LOL]</code></pre>
<p>classmateså°±æ˜¯ä¸€ä¸ªlistï¼Œlistå¯ä»¥åµŒå¥—list    </p>
<pre class="language-none"><code class="language-none">len(classmates)                    \\æŸ¥çœ‹listçš„é•¿åº¦  
classmates[1]                      \\listç¬¬äºŒä¸ªå…ƒç´   
classmates[-1]                     \\listå€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´     
classmates.append(&#39;Liarlee&#39;)       \\æœ«å°¾æ·»åŠ ä¸€ä¸ªå€¼
classmates.pop()                   \\åˆ é™¤æœ«å°¾çš„å€¼
classmates.pop(i)                  \\åˆ é™¤æŒ‡å®šç´¢å¼•ä½ç½®çš„å€¼
classmates.insert(1, &#39;Liarlee&#39;)    \\å°†å€¼æ’å…¥åˆ°æŸä¸ªç´¢å¼•ä½ç½®
classmates[1] &#x3D; Liarlee            \\ç›´æ¥æ›´æ”¹æŸä¸ªç´¢å¼•ä½ç½®çš„å€¼
classmates.sort()                  \\listæ’åº</code></pre>

<h3 id="Tuple-â€“-å…ƒç»„"><a href="#Tuple-â€“-å…ƒç»„" class="headerlink" title="Tuple â€“ å…ƒç»„"></a>Tuple â€“ å…ƒç»„</h3><p>å¦ä¸€ç§æœ‰åºåˆ—è¡¨å«å…ƒç»„ï¼štupleã€‚tupleå’Œlistéå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯tupleä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹  </p>
<pre class="language-none"><code class="language-none">classmates &#x3D; (Liarlee,TEST,WTF,LOL)</code></pre>

<h2 id="å¾ªç¯å’Œåˆ¤æ–­"><a href="#å¾ªç¯å’Œåˆ¤æ–­" class="headerlink" title="å¾ªç¯å’Œåˆ¤æ–­"></a>å¾ªç¯å’Œåˆ¤æ–­</h2><h3 id="IFåˆ¤æ–­"><a href="#IFåˆ¤æ–­" class="headerlink" title="IFåˆ¤æ–­"></a>IFåˆ¤æ–­</h3><pre class="language-none"><code class="language-none">if
elif
.
.
.
elif
else                                        \\å®Œå…¨ifæ ¼å¼        </code></pre>

<h3 id="FORâ€¦â€¦INâ€¦â€¦å¾ªç¯"><a href="#FORâ€¦â€¦INâ€¦â€¦å¾ªç¯" class="headerlink" title="FORâ€¦â€¦INâ€¦â€¦å¾ªç¯"></a>FORâ€¦â€¦INâ€¦â€¦å¾ªç¯</h3><pre class="language-none"><code class="language-none">for classmate in classmates:
  print(classmate)

list(range(101))                              \\ç”Ÿæˆ0-100æ•°å­—å­˜å…¥list</code></pre>

<h3 id="WHILEå¾ªç¯"><a href="#WHILEå¾ªç¯" class="headerlink" title="WHILEå¾ªç¯"></a>WHILEå¾ªç¯</h3><pre class="language-none"><code class="language-none"># -*- coding: utf-8 -*-
classmates &#x3D; [Liarlee,TEST,WTF,LOL]
i &#x3D; 0
while i &lt; 4:
    print(&#39;Hello,%s&#39; % (classmates[i]))
    i &#x3D; i + 1</code></pre>

<h2 id="Dictå’Œset"><a href="#Dictå’Œset" class="headerlink" title="Dictå’Œset"></a>Dictå’Œset</h2><h3 id="Dict-â€“-å­—å…¸"><a href="#Dict-â€“-å­—å…¸" class="headerlink" title="Dict â€“ å­—å…¸"></a>Dict â€“ å­—å…¸</h3><pre class="language-none"><code class="language-none">SCORE &#x3D; &#123;&#39;Liarlee&#39;: 95, &#39;TEST&#39;: 75, &#39;WTF&#39;: 85, â€˜LOLâ€˜ï¼š54&#125;       \\å®šä¹‰å­—å…¸
d[&#39;Liarlee&#39;] &#x3D; 67                                                \\å­—å…¸èµ‹å€¼
&#39;Thomas&#39; in d                                                    \\ç¡®å®šKeyæ˜¯å¦åœ¨å­—å…¸ä¸­
d.get(&#39;Liarlee&#39;)                                                 \\ç¡®å®šKeyæ˜¯å¦åœ¨å­—å…¸ä¸­
d.pop(&#39;Liarlee&#39;)                                                 \\åˆ é™¤Key</code></pre>

<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>setå’Œdictç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„keyçš„é›†åˆï¼Œä½†ä¸å­˜å‚¨valueã€‚    </p>
<pre class="language-none"><code class="language-none">s &#x3D; set([1, 2, 3])                      \\åˆ›å»ºä¸€ä¸ªsetç„¶åå°†listä¼ å…¥
s.add(4)                                \\æ·»åŠ ä¸€ä¸ªå…ƒç´ è¿›å…¥set</code></pre>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå…¥é—¨ç¬”è®° (äºŒ)</title>
    <url>/2018/01/09/Python/Python_%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-2/</url>
    <content><![CDATA[<h2 id="Defå®šä¹‰å‡½æ•°"><a href="#Defå®šä¹‰å‡½æ•°" class="headerlink" title="Defå®šä¹‰å‡½æ•°"></a>Defå®šä¹‰å‡½æ•°</h2><pre class="language-none"><code class="language-none">def fact(n):                    #å®šä¹‰æ±‚é˜¶ä¹˜å‡½æ•°
    if n &#x3D;&#x3D; 1:
        return 1
    return n * fact(n - 1)

result &#x3D; fact(5)                #è®¡ç®—ç»“æœ
print(result)                   #è¾“å‡ºè®¡ç®—ç»“æœ</code></pre>

<h2 id="é€’å½’å‡½æ•°-â€“-å°¾é€’å½’ä¼˜åŒ–"><a href="#é€’å½’å‡½æ•°-â€“-å°¾é€’å½’ä¼˜åŒ–" class="headerlink" title="é€’å½’å‡½æ•° â€“ å°¾é€’å½’ä¼˜åŒ–"></a>é€’å½’å‡½æ•° â€“ å°¾é€’å½’ä¼˜åŒ–</h2><p><strong>ç”¨é€’å½’å‡½æ•°éœ€è¦æ³¨æ„é˜²æ­¢æ ˆæº¢å‡ºã€‚</strong><br>è§£å†³é€’å½’è°ƒç”¨æ ˆæº¢å‡ºçš„æ–¹æ³•æ˜¯é€šè¿‡å°¾é€’å½’ä¼˜åŒ–ï¼Œ</p>
<pre class="language-none"><code class="language-none">def fact(n):                                #å°¾é€’å½’ä¼˜åŒ–
    return fact_iter(n, 1)                  #å‡½æ•°è¿”å›å€¼æ˜¯ä¹‹å‰å®šä¹‰çš„é€’å½’å‡½æ•°

def fact_iter(num, product):
    if num &#x3D;&#x3D; 1:
        return product
    return fact_iter(num - 1, num * product)
    print(num, product)


result &#x3D; fact(1000)
print(result)</code></pre>

<h2 id="è¿·ä¹‹é€’å½’-â€“-æ±‰è¯ºå¡”-æ²¡æ‡‚"><a href="#è¿·ä¹‹é€’å½’-â€“-æ±‰è¯ºå¡”-æ²¡æ‡‚" class="headerlink" title="è¿·ä¹‹é€’å½’ â€“ æ±‰è¯ºå¡” (æ²¡æ‡‚)"></a>è¿·ä¹‹é€’å½’ â€“ æ±‰è¯ºå¡” (æ²¡æ‡‚)</h2><pre class="language-none"><code class="language-none">def move(n, a, b, c):
    if n &#x3D;&#x3D; 1:                          #åªæœ‰ä¸€ä¸ªç›˜å­ï¼Œæ‰€ä»¥ä»aåˆ°c
        print(a, &#39;--&gt;&#39;, c)
    else:
        move(n-1, a, c, b)              #æœ‰Nä¸ªç›˜å­ï¼Œç§»åŠ¨N-1ä¸ªç›˜å­ï¼Œa-b
        move(1, a, b, c)                #å°†æœ€å¤§çš„ç›˜å­ä»a--c
        move(n-1, b, a, c)              #å‰©ä¸‹çš„N-1ä»b--c

move(3, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;)                      # æ€»å…±ä¸‰ä¸ªç›˜å­ï¼ŒABCä¸‰ä¸ªæŸ±å­</code></pre>

<h2 id="é«˜çº§ç‰¹æ€§"><a href="#é«˜çº§ç‰¹æ€§" class="headerlink" title="é«˜çº§ç‰¹æ€§"></a>é«˜çº§ç‰¹æ€§</h2><h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><pre class="language-none"><code class="language-none">L &#x3D; [&#39;aaa&#39;, &#39;bbb&#39;, &#39;ccc&#39;]

# å–å‡ºå‰ä¸¤ä¸ªå…ƒç´ 

# Method 1
[L[0],L[1]]

# Method 2 -- For
r &#x3D; []
n &#x3D; 2
for i in range(n):
    r.append(L[i])

print(r)

# Method 3 -- Slice
print(L[0:2])               #å–å‡º 0--2

print(L[:2])                #å–å‡º 0--2

print(L[-2:])               #å–å‡ºå€’æ•°ä¸¤ä¸ªå…ƒç´ 

print(L[-2:-1])             #å–å‡ºå€’æ•°ç¬¬äºŒä¸ª

L[a:b:c]                    #a----ç´¢å¼•å¼€å§‹åºå·
                            #b----ç´¢å¼•ç»“æŸåºå·
                            #c----æ­¥é•¿</code></pre>
<h3 id="åˆ‡ç‰‡ç»ƒä¹ "><a href="#åˆ‡ç‰‡ç»ƒä¹ " class="headerlink" title="åˆ‡ç‰‡ç»ƒä¹ "></a>åˆ‡ç‰‡ç»ƒä¹ </h3><pre class="language-none"><code class="language-none">def trim(s):
    if not len(s):        #éç©º
        return s
    if s[0] &#x3D;&#x3D; &#39; &#39;:       #èµ·å§‹ä½ç½®ä½ç½®ä¸ºç©º
        s &#x3D; s[1:]
        return trim(s)        #è¿”å›å¤„ç†åçš„å­—ç¬¦ä¸²
    elif s[-1] &#x3D;&#x3D; &#39; &#39;:        #æœ«å°¾ä¸ºç©º
        s &#x3D; s[:-1]
        return trim(s)
    return s              #è¿”å›s

if trim(&#39;hello  &#39;) !&#x3D; &#39;hello&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif trim(&#39;  hello&#39;) !&#x3D; &#39;hello&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif trim(&#39;  hello  &#39;) !&#x3D; &#39;hello&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif trim(&#39;  hello  world  &#39;) !&#x3D; &#39;hello  world&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif trim(&#39;&#39;) !&#x3D; &#39;&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif trim(&#39;    &#39;) !&#x3D; &#39;&#39;:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
else:
    print(&#39;æµ‹è¯•æˆåŠŸ!&#39;)</code></pre>

<h3 id="Forå¾ªç¯è¿­ä»£-ç»ƒä¹ "><a href="#Forå¾ªç¯è¿­ä»£-ç»ƒä¹ " class="headerlink" title="Forå¾ªç¯è¿­ä»£ ç»ƒä¹ "></a>Forå¾ªç¯è¿­ä»£ ç»ƒä¹ </h3><pre class="language-none"><code class="language-none">def findMinAndMax(L):
    if 0 &#x3D;&#x3D; len(L):
        return None, None

    min &#x3D; L[0]
    max &#x3D; L[0]
    i &#x3D; 0
    for i in L:
        if i &gt; max:
            max &#x3D; i
        if i &lt; min:
            min &#x3D; i
    return min, max

# æµ‹è¯•
if findMinAndMax([]) !&#x3D; (None, None):
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif findMinAndMax([7]) !&#x3D; (7, 7):
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif findMinAndMax([7, 1]) !&#x3D; (1, 7):
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif findMinAndMax([7, 1, 3, 9, 5]) !&#x3D; (1, 9):
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
else:
    print(&#39;æµ‹è¯•æˆåŠŸ!&#39;)
</code></pre>

<h3 id="åˆ—è¡¨ç”Ÿæˆå¼"><a href="#åˆ—è¡¨ç”Ÿæˆå¼" class="headerlink" title="åˆ—è¡¨ç”Ÿæˆå¼"></a>åˆ—è¡¨ç”Ÿæˆå¼</h3><pre class="language-none"><code class="language-none">list(range(1,11))

M &#x3D; [x * x for x in range(1, 11)]     #åˆ—è¡¨ç”Ÿæˆå¼
print(M)

list &#x3D; [s.lower() for s in L1]

# ç»ƒä¹ 
L1 &#x3D; [&#39;Hello&#39;,&#39;World&#39;, 18, &#39;Apple&#39;, None]
test &#x3D; isinstance(L1, str)
print(test)

L2 &#x3D; [s.lower() for s in L1 if isinstance(s, str) &#x3D;&#x3D; True]


# æµ‹è¯•:
print(L2)
if L2 &#x3D;&#x3D; [&#39;hello&#39;, &#39;world&#39;, &#39;apple&#39;]:
    print(&#39;æµ‹è¯•é€šè¿‡!&#39;)
else:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)</code></pre>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå…¥é—¨ç¬”è®° (ä¸‰)</title>
    <url>/2018/01/10/Python/Python_%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-3/</url>
    <content><![CDATA[<p>pythonè¿›è¡Œç³»ç»Ÿç®¡ç†çš„æ¨¡å—ã€‚ç³»ç»Ÿç®¡ç†æ¨¡å—çš„ä»‹ç»å’Œä½¿ç”¨ã€‚<br>ç³»ç»Ÿç®¡ç†çš„å››ä¸ªæ¨¡å—:</p>
<ol>
<li>os</li>
<li>os.path</li>
<li>glob</li>
<li>fnmatch</li>
</ol>
<h2 id="1-OS"><a href="#1-OS" class="headerlink" title="1. OS"></a>1. OS</h2><p>OSæ¨¡å—ä¸­åŒ…å«äº†æ™®éçš„æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œå¦‚æœå¸Œæœ›ç¨‹åºä¸å¹³å°æ²¡æœ‰å¼ºå…³è”çš„æƒ…å†µä¸‹è¿™ä¸ªæ¨¡å—å¾ˆé‡è¦ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥åœ¨ä¸æ”¹åŠ¨ç¨‹åºçš„åŸºç¡€ä¸Šï¼Œä½¿ç¨‹åºè¿è¡Œåœ¨Linuxå’ŒWindowsä¹‹é—´ã€‚</p>
<h3 id="å¯ç§»æ¤æ€§è¯´æ˜"><a href="#å¯ç§»æ¤æ€§è¯´æ˜" class="headerlink" title="å¯ç§»æ¤æ€§è¯´æ˜"></a>å¯ç§»æ¤æ€§è¯´æ˜</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>name   <span class="token comment">#è·å–å½“å‰çš„æ“ä½œç³»ç»Ÿä¿¡æ¯</span>
os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#è·å–å½“å‰çš„å·¥ä½œç›®å½•</span>
os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#è¿”å›ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•åç§°</span>
os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">#åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶</span>
os<span class="token punctuation">.</span>linesep      <span class="token comment">#é€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ç»™å‡ºå½“å‰å¹³å°çš„æ¢è¡Œç¬¦å·</span></code></pre>

<h3 id="OSæ¨¡å—æ“ä½œæ–‡ä»¶"><a href="#OSæ¨¡å—æ“ä½œæ–‡ä»¶" class="headerlink" title="OSæ¨¡å—æ“ä½œæ–‡ä»¶"></a>OSæ¨¡å—æ“ä½œæ–‡ä»¶</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>unlink       <span class="token comment">#åˆ é™¤è·¯å¾„æ‰€æŒ‡å‘çš„æ–‡ä»¶</span>
os<span class="token punctuation">.</span>remove       <span class="token comment">#åˆ é™¤è·¯å¾„æ‰€æŒ‡å‘çš„æ–‡ä»¶</span>
os<span class="token punctuation">.</span>rmdir        <span class="token comment">#åˆ é™¤pathè·¯å¾„æŒ‡å‘çš„ç©ºæ–‡ä»¶å¤¹ï¼Œå¿…é¡»æ˜¯ç©ºçš„</span>
os<span class="token punctuation">.</span>mkdir        <span class="token comment">#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</span>
os<span class="token punctuation">.</span>rename       <span class="token comment">#é‡å‘½åä¸€ä¸ªæ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹</span></code></pre>

<h3 id="OSæ¨¡å—æ“ä½œæƒé™"><a href="#OSæ¨¡å—æ“ä½œæƒé™" class="headerlink" title="OSæ¨¡å—æ“ä½œæƒé™"></a>OSæ¨¡å—æ“ä½œæƒé™</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>access<span class="token punctuation">(</span><span class="token string">'/etc/fstab'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>R_OK<span class="token punctuation">)</span>      <span class="token comment">#accessæ˜¯åˆ¤æ–­æ˜¯å¦å…·æœ‰å¯¹æŸä¸€ä¸ªæ–‡ä»¶çš„ç›¸å…³æƒé™ï¼ŒLinuxä¸­çš„ chmod/rwx---å¯¹åº”OSæ¨¡å—ä¸­çš„R_OK,W_OKï¼ŒX_OK</span></code></pre>

<h2 id="os-pathæ¨¡å—"><a href="#os-pathæ¨¡å—" class="headerlink" title="os.pathæ¨¡å—"></a>os.pathæ¨¡å—</h2><p>os.pathæ¨¡å—ä¸»è¦æ˜¯ç”¨æ¥æ‹†åˆ†è·¯å¾„ï¼Œæ„å»ºæ–°çš„è·¯å¾„ï¼Œè·å–æ–‡ä»¶å±æ€§å’Œåˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ä½¿ç”¨ã€‚</p>
<h3 id="æ‹†åˆ†è·¯å¾„"><a href="#æ‹†åˆ†è·¯å¾„" class="headerlink" title="æ‹†åˆ†è·¯å¾„"></a>æ‹†åˆ†è·¯å¾„</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">#è¿”å›ä¸€ä¸ªäºŒå…ƒæ•°ç»„ï¼ŒåŒ…æ‹¬æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åç§°</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">#è¿”å›æ–‡ä»¶è·¯å¾„</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#è¿”å›æ–‡ä»¶çš„æ–‡ä»¶å</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#ä¸€ä¸ªæ–‡ä»¶åå’Œæ‰©å±•åç»„æˆçš„äºŒå…ƒç»„</span></code></pre>

<h3 id="æ„å»ºè·¯å¾„"><a href="#æ„å»ºè·¯å¾„" class="headerlink" title="æ„å»ºè·¯å¾„"></a>æ„å»ºè·¯å¾„</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>expanduser<span class="token punctuation">(</span><span class="token string">'~/Liarlee'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">'Liarlee.txt'</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>expanduser<span class="token punctuation">(</span><span class="token string">'~mysql'</span><span class="token punctuation">,</span> <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">'Liarlee.py'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h3 id="è·å–æ–‡ä»¶å±æ€§"><a href="#è·å–æ–‡ä»¶å±æ€§" class="headerlink" title="è·å–æ–‡ä»¶å±æ€§"></a>è·å–æ–‡ä»¶å±æ€§</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getatime<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#è·å–æ–‡ä»¶çš„è®¿é—®æ—¶é—´</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getmtime<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#è·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getctime<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">#è·å–æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>getsize<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">#è·å–æ–‡ä»¶çš„å¤§å°</span></code></pre>

<h3 id="åˆ¤æ–­æ–‡ä»¶ç±»å‹"><a href="#åˆ¤æ–­æ–‡ä»¶ç±»å‹" class="headerlink" title="åˆ¤æ–­æ–‡ä»¶ç±»å‹"></a>åˆ¤æ–­æ–‡ä»¶ç±»å‹</h3><pre class="language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists        <span class="token comment">#å‚æ•°pathæŒ‡å‘çš„è·¯å¾„æ˜¯å¦å­˜åœ¨</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile        <span class="token comment">#å‚æ•°pathæŒ‡å‘çš„è·¯å¾„å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir         <span class="token comment">#è·¯å¾„å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>islink        <span class="token comment">#è·¯å¾„å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªé“¾æ¥</span></code></pre>

<h2 id="Fnmatchæ¨¡å—"><a href="#Fnmatchæ¨¡å—" class="headerlink" title="Fnmatchæ¨¡å—"></a>Fnmatchæ¨¡å—</h2><h2 id="Globæ¨¡å—"><a href="#Globæ¨¡å—" class="headerlink" title="Globæ¨¡å—"></a>Globæ¨¡å—</h2>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>DISMçš„å¤‡ä»½ä¸è¿˜åŸ</title>
    <url>/2018/04/19/Windows/Windows_DISM%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>DISMçš„å¤‡ä»½ä¸è¿˜åŸä¸»è¦æ˜¯ç”¨äº†Win8ä¹‹åå¾®è½¯åŒæ­¥å‘è¡Œçš„ç³»ç»Ÿæ˜ åƒç®¡ç†å·¥å…·ï¼Œå…¨ç§°æ˜¯ï¼š<strong>éƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†</strong>ã€‚  </p>
<span id="more"></span>

<p>DISMå‘½ä»¤è¡Œé€‰é¡¹ï¼š</p>
<pre><code>/Append-Image      
    è¿›è¡Œæ˜ åƒçš„é™„åŠ ï¼Œæ›´æ–°ï¼Œå¯¹æ¯”åŸæœ‰çš„æ–‡ä»¶å†…å®¹è¿›è¡Œå¢é‡æ›´æ–°ã€‚
    *ç¤ºä¾‹ï¼š*
    å¯¹æ˜ åƒçš„å¢é‡æ›´æ–°	 Dism /Append-Image /ImageFile:install.wim /CaptureDir:D:\ /Name:Drive-D

/Apply-Image       
    å°†æ˜ åƒåº”ç”¨äºæŒ‡å®šçš„é©±åŠ¨å™¨ã€‚
    *ç¤ºä¾‹ï¼š*
    å•ä¸€wimæ–‡ä»¶çš„æ¢å¤	Dism /apply-image /imagefile:install.wim /index:1 /ApplyDir:D:\
    æ‹†åˆ†å¤šä¸ªæ˜ åƒæ–‡ä»¶çš„æ¢å¤	Dism /apply-image /imagefile:install.swm /swmfile:install*.swm /index:1 /applydir:D:\

/Capture-Image   
    å°†æŸä¸ªé©±åŠ¨å™¨çš„æ˜ åƒæ•æ‰åˆ°æ–°çš„ .wim æ–‡ä»¶ã€‚æ•æ‰çš„ç›®å½•åŒ…æ‹¬æ‰€æœ‰å­æ–‡ä»¶å¤¹å’Œæ•°æ®ã€‚ä¸èƒ½æ•æ‰ç©ºç›®å½•ã€‚ç›®å½•å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ–‡ä»¶ã€‚
    *ç¤ºä¾‹ï¼š*
    ç”Ÿæˆ.wimå¤‡ä»½æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹	Dism /Capture-Image /ImageFile:install.wim /CaptureDir:D:\ /Name:Drive-D

/Commit-Image
    å¯¹å·²ç»è£…è½½çš„æ˜ åƒè¿›è¡Œç¡®è®¤æäº¤ã€‚
    *ç¤ºä¾‹ï¼š*
    å¯¹å·²ç»æŒ‚è½½çš„é•œåƒæ–‡ä»¶è¿›è¡Œç¡®è®¤	Dism /Commit-Image /MountDir:C:\test\offline

/Delete-Image
    ä»åŒ…å«å¤šä¸ªæ˜ åƒå·çš„.wimæ–‡ä»¶ä¸­åˆ é™¤æŒ‡å®šçš„æ˜ åƒã€‚
    *ç¤ºä¾‹ï¼š*
    åˆ é™¤æŒ‡å®šçš„æ˜ åƒå·	Dism /Delete-Image /ImageFile:install.wim /Index:1

/List-Image
    æ˜¾ç¤ºæŒ‡å®šå·æ˜ åƒä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨ã€‚
    *ç¤ºä¾‹ï¼š*
    åˆ—å‡ºé•œåƒä¸­æ–‡ä»¶å¤¹åˆ—è¡¨	Dism /List-Image /ImageFile:install.wim /Index:1

/Split-Image
    å°†ç°æœ‰çš„ .wim æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªåªè¯»çš„æ‹†åˆ† .wim æ–‡ä»¶ã€‚
    *ç¤ºä¾‹ï¼š*
    åˆ†å‰²å¹¶æŒ‡å®šåˆ†å·å¤§å°	Dism /Split-Image /ImageFile:install.wim /SWMFile:split.swm /FileSize:650

/Mount-Image
    å°†wimæ˜ åƒæŒ‚è½½åˆ°æŸä¸ªç›®å½•ä¸‹
    *ç¤ºä¾‹ï¼š*
    å¯è¯»å†™æ¨¡å¼	Dism /Mount-Image /ImageFile:C:\test\images\myimage.wim /index:1 /MountDir:C:\test\offline
    åªè¯»æ¨¡å¼	Dism /Mount-Image /ImageFile:C:\test\images\myimage.vhd /index:1 /MountDir:C:\test\offline /ReadOnly
    åªè¯»æ›´æ”¹ä¸ºå¯è¯»å†™	Dism /Remount-Image /MountDir:C:\test\offline


å¸¸è§„å¤„ç†æµç¨‹ï¼š
1.æ•æ‰å½±åƒå¹¶ä¸”ä¿å­˜ä¸º.wimæ–‡ä»¶
2.åˆ—å‡º.wim .vhd .vhdxæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶
3.å‡†å¤‡ä¸€ä¸ªwinPE
4.è¿›è¡Œå¤‡ä»½é•œåƒçš„è¿˜åŸ
</code></pre>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>PPTè½¬æ¢WORD</title>
    <url>/2018/01/15/Windows/Windows_PPTConvertTOWORD/</url>
    <content><![CDATA[<p>å‰ä¸€æ®µæ—¶é—´èµ¶ä¸ŠæœŸæœ«è€ƒè¯•ï¼Œè€å¸ˆæ”¾å‡ºäº†ä¸€ä¸ªå­¦æœŸçš„PPTï¼Œäºæ˜¯å¤§å®¶å¼€å§‹ç–¯ç‹‚çš„å¤åˆ¶è®²ä¹‰ï¼ŒæŠŠå…³é”®çš„çŸ¥è¯†è¿›è¡Œæç‚¼ï¼Œæ–¹ä¾¿è€ƒè¯•ã€‚ä½†æ˜¯è€å¸ˆæ”¾å‡ºæ¥çš„PPTï¼Œæ–‡å­—é‡å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå¦‚æœæ‰‹åŠ¨å¤åˆ¶å°±ä¼šå¾ˆéº»çƒ¦ï¼Œæœ€åè‡ªå·±éƒ½å¿«å´©æºƒäº†</p>
<span id="more"></span>

<h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>PPTä½œä¸ºå¾®è½¯OFFCIEå¥—ä»¶ä¸­çš„ä¸€å‘˜ï¼Œåœ¨PPTå’ŒWordä¹‹é—´éƒ½ä¼šæä¾›ä¸€ä¸ªç›¸äº’è½¬æ¢çš„æ–¹å¼ï¼Œä¿è¯å†…å®¹å¯ä»¥å¿«æ·çš„åœ¨ä¸åŒçš„è½¯ä»¶ä¸­ä½¿ç”¨ã€‚ç”šè‡³æ˜¯ä¸Adobeçš„PDFä¹‹é—´ï¼Œå…¶å®éƒ½å¯ä»¥å¿«æ·çš„è¿›è¡Œè½¬æ¢ã€‚<br>æ•™ç¨‹å¼€å§‹äº†~   </p>
<h2 id="å¼€å§‹æˆ˜æ–—ï¼"><a href="#å¼€å§‹æˆ˜æ–—ï¼" class="headerlink" title="å¼€å§‹æˆ˜æ–—ï¼"></a>å¼€å§‹æˆ˜æ–—ï¼</h2><h3 id="PPTåˆ›å»ºè®²ä¹‰"><a href="#PPTåˆ›å»ºè®²ä¹‰" class="headerlink" title="PPTåˆ›å»ºè®²ä¹‰"></a>PPTåˆ›å»ºè®²ä¹‰</h3><ol>
<li>é€‰æ‹©å·¦ä¸Šè§’çš„æ–‡ä»¶é€‰é¡¹å¡<br><img src="https://i.loli.net/2018/01/15/5a5c244c177fe.png" alt="1.png"></li>
<li>é€‰æ‹©å¯¼å‡ºé€‰é¡¹<br><img src="https://i.loli.net/2018/01/15/5a5c244bd0287.png" alt="2.png"></li>
<li>ç‚¹å‡»åˆ›å»ºè®²ä¹‰</li>
<li>é€‰æ‹©åªä½¿ç”¨å¤§çº²<br><img src="https://i.loli.net/2018/01/15/5a5c244c3dc9e.png" alt="3.png"></li>
<li>æˆ‘ä»¬ä¼šç›´æ¥å¾—åˆ°ä¸€ä»½PPTçš„Wordæ–‡ä»¶ï¼Œä½†æ˜¯æ’ç‰ˆæ˜¯æ··ä¹±çš„ï¼Œæ–‡å­—çš„å¤§å°éƒ½æ˜¯ä¸åŒçš„<br><img src="https://i.loli.net/2018/01/15/5a5c244c15b3c.png" alt="4.png"></li>
</ol>
<h3 id="å»æ‰æ–‡å­—æ ¼å¼å’Œç©ºæ ¼"><a href="#å»æ‰æ–‡å­—æ ¼å¼å’Œç©ºæ ¼" class="headerlink" title="å»æ‰æ–‡å­—æ ¼å¼å’Œç©ºæ ¼"></a>å»æ‰æ–‡å­—æ ¼å¼å’Œç©ºæ ¼</h3><ol>
<li>é¦–å…ˆå…¨é€‰æ–‡æ¡£ä¸­çš„æ–‡å­—ï¼Œ<strong>å¿«æ·é”®ï¼šCtrl+A</strong>  </li>
<li>å°†æ–‡æœ¬å…¨éƒ¨å¤åˆ¶åˆ°Notepad++ä¸­</li>
<li>è¿›å…¥notepad++çš„æ–‡æœ¬å°±ä¼šè‡ªåŠ¨å˜æˆæ— æ ¼å¼æ–‡æœ¬ï¼Œè¿™æ˜¯notepad++å’ŒWordè½¯ä»¶çš„ä¸åŒã€‚notepad++æ˜¯çº¯æ–‡æœ¬ç¼–è¾‘è½¯ä»¶ï¼Œè€ŒWordæ˜¯å­—å¤„ç†è½¯ä»¶ã€‚  </li>
<li>ä¹‹åï¼Œé€‰æ‹©ç¼–è¾‘â€“&gt;è¡Œæ“ä½œâ€“&gt; ç§»é™¤ç©ºè¡Œ(åŒ…æ‹¬ç©ºç™½å­—ç¬¦)ï¼Œè¿™æ ·æ–‡æœ¬ä¸­çš„ç©ºè¡Œå’Œå¥‡æ€ªçš„ç©ºç™½å­—ç¬¦å°±å®Œå…¨å»æ‰ï¼Œå˜æˆäº†å®Œå…¨çš„çº¯æ–‡æœ¬<br><img src="https://i.loli.net/2018/01/15/5a5c244bd84ad.png" alt="5.png"></li>
<li>å†æŠŠæœ€åçš„æ–‡æœ¬å¤åˆ¶å›åˆ°Wordä¸­å°±å¥½äº†~<br><img src="https://i.loli.net/2018/01/15/5a5c244be9d2c.png" alt="6.png"></li>
</ol>
<h3 id="å»æ‰ä¸éœ€è¦çš„å†…å®¹"><a href="#å»æ‰ä¸éœ€è¦çš„å†…å®¹" class="headerlink" title="å»æ‰ä¸éœ€è¦çš„å†…å®¹"></a>å»æ‰ä¸éœ€è¦çš„å†…å®¹</h3><p>æœ€åå°±æ˜¯æ ¹æ®æ¯ä¸ªäººçš„ä¸åŒéœ€è¦è¿›è¡Œæ–‡æ¡£ä¸­å†…å®¹çš„åˆ é™¤ï¼Œç²¾ç®€ï¼Œå¤§åŠŸå‘Šæˆ~  </p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»è¿‡è¿™æ ·çš„å¤„ç†ï¼Œçœå»äº†æ¯ä¸ªPPTçš„æ–‡å­—éƒ½æ‰‹åŠ¨å¤åˆ¶çš„éº»çƒ¦ï¼Œå…¶ä¸­æœ€æœ€æ¶ˆè€—æ—¶é—´çš„éƒ¨åˆ†å°±æ˜¯æœ€åçš„å†…å®¹ç²¾ç®€ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¿…é¡»è¦è¿›è¡Œæ€è€ƒå’Œæ‰‹åŠ¨æ“ä½œçš„éƒ¨åˆ†ï¼Œåªæœ‰æˆ‘ä»¬è‡ªå·±çŸ¥é“è‡ªå·±éœ€è¦ä»€ä¹ˆå†…å®¹ã€‚  </p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows, Office</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨å¾®è½¯å®˜æ–¹é•œåƒé‡è£…ç³»ç»Ÿ</title>
    <url>/2018/01/02/Windows/Windows_%E5%A6%82%E4%BD%95%E7%BB%99%E8%87%AA%E5%B7%B1%E7%9A%84%E7%94%B5%E8%84%91%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<p>æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ä¸”è¯¦ç»†çš„æ–°æ‰‹æ•™ç¨‹ï¼</p>
<span id="more"></span>

<h1 id="ä¸€ã€å†™åœ¨æœ€å‰é¢"><a href="#ä¸€ã€å†™åœ¨æœ€å‰é¢" class="headerlink" title="ä¸€ã€å†™åœ¨æœ€å‰é¢"></a>ä¸€ã€å†™åœ¨æœ€å‰é¢</h1><p><strong>æœ‰å‡ å¥æœ‰ç”¨çš„å»ºè®®ï¼Œåœ¨è¿™é‡Œå…ˆå†™,èƒ½è®©ä½ çš„ç”µè„‘é•¿ä¹…è¿è¡Œè‰¯å¥½ï¼š</strong><br><strong>- å›½å†…çš„è½¯ä»¶æ™®ééƒ½å¸¦æœ‰å¹¿å‘Šï¼Œè¿™ä¸æ˜¯Windowsçš„é”…</strong><br><strong>- ä¸è¦ä½¿ç”¨360ç³»åˆ—çš„äº§å“</strong> ï¼Œæœ‰äººå’Œæˆ‘è¯´ä¼ä¸šç‰ˆç‰¹åˆ«è‰¯å¿ƒï¼Œä½†æ˜¯æˆ‘æ²¡ç”¨è¿‡ï¼Œæ¬¢è¿å°è¯•åç»™æˆ‘åé¦ˆ<br><strong>- æ‰€æœ‰è½¯ä»¶éƒ½ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½ï¼Œä¸è¦å›¾æ–¹ä¾¿ä½¿ç”¨è½¯ä»¶å‡çº§åŠ©æ‰‹ï¼Œæˆ–è€…ç”µè„‘ç®¡å®¶</strong><br><strong>- å®‰è£…ç¨‹åºè¯·ä»”ç»†è§‚å¯Ÿæ˜¯å¦æœ‰æ†ç»‘è½¯ä»¶ï¼Œä¸€å®šå–æ¶ˆå‹¾é€‰çš„æ†ç»‘è½¯ä»¶</strong><br><strong>- æ³¨æ„è§‚å¯Ÿå®‰è£…ç¨‹åºç•Œé¢çš„è§’è½ä½ç½®|æŠ˜å èœå•|é«˜çº§é€‰é¡¹|æ›´å¤šï¼Œå¦åˆ™ä½ çš„ç”µè„‘ä¸€å®šä¼šâ€œè‡ªåŠ¨â€å¤šå¾ˆå¤šå¥‡æ€ªçš„ä¸œè¥¿</strong><br><strong>- å¦‚æœå¯ä»¥å°½é‡ä½¿ç”¨å¾®è½¯å®˜æ–¹çš„ç³»ç»Ÿï¼Œç¬¬ä¸‰æ–¹ç³»ç»Ÿæˆ–è€…Ghostç³»ç»Ÿç¡®å®æ–¹ä¾¿äº†ä½ çš„å®‰è£…è¿‡ç¨‹ï¼Œä½†æ˜¯ä½ ä¸€å®šä¼šè¢«å¹¿å‘Šå’Œæ†ç»‘çš„è½¯ä»¶æŠ˜ç£¨çš„ä¸è¦ä¸è¦çš„ï½æœ€é‡è¦çš„æ˜¯ï¼Œä¸èƒ½ç¡®å®šæ˜¯å¦ä¼šæœ‰åé—¨ç¨‹åºï¼Œè°¨æ…ä½¿ç”¨Onekey-Ghostå’ŒYLMF</strong><br><strong>- æœ€åä¸€ç‚¹åƒä¸‡æ³¨æ„ï¼Œç³»ç»Ÿä¼˜åŒ–ç±»è½¯ä»¶é™¤éä½ æ¸…æ¥šè¿™ä¸ªè½¯ä»¶éƒ½æ›´æ”¹äº†é‚£äº›è®¾ç½®ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨ï¼Œè¯·ç›¸ä¿¡æ²¡æœ‰ä»»ä½•ä¸€ä¸ªç¬¬ä¸‰æ–¹å…¬å¸æ¯”å¾®è½¯æ›´äº†è§£è‡ªå·±çš„äº§å“</strong>  </p>
<hr>
<h1 id="äºŒã€ç¯å¢ƒåŠå·¥å…·"><a href="#äºŒã€ç¯å¢ƒåŠå·¥å…·" class="headerlink" title="äºŒã€ç¯å¢ƒåŠå·¥å…·"></a>äºŒã€ç¯å¢ƒåŠå·¥å…·</h1><ol>
<li>å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ <strong>è®¡ç®—æœºA</strong>ï¼ˆä¹Ÿå°±æ˜¯å¯ç”¨çš„ç”µè„‘ï¼‰  </li>
<li>éœ€è¦é‡è£…ç³»ç»Ÿçš„ <strong>è®¡ç®—æœºB</strong>ï¼ˆä¸€å®šè¦ä¿è¯å¼€æœºå‡ºç°Logoï¼Œå¦‚æœå¼€æœºLogoéƒ½æ²¡æœ‰ï¼Œè¯·ç¡®è®¤è®¡ç®—æœºæ˜¯å¦é€šç”µï¼›æ£€æŸ¥æ˜¾ç¤ºå™¨æ˜¯å¦æ­£å¸¸ï¼›å¦‚å…¶ä»–æƒ…å†µè¯·é€ç»´ä¿®ã€‚ï¼‰  </li>
<li><strong>4G</strong> ç©ºé—´ä»¥ä¸Šçš„ <strong>ç©ºUç›˜</strong>  </li>
<li><strong>Rufus</strong> (åé¢ä»‹ç»è¿™ä¸ªå·¥å…·çš„ç”¨é€”)<br><a href="https://rufus.akeo.ie/?locale=zh_CN">Rufus-å®˜æ–¹ç½‘ç«™</a><br><a href="https://rufus.akeo.ie/downloads/rufus-2.18.exe">Rufus-ä¸‹è½½é“¾æ¥</a>  </li>
<li><strong>å¾®è½¯å®˜æ–¹</strong> çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶<br><a href="http://msdn.itellyou.cn/">MSDNitellyou-æ¬è¿å®˜æ–¹çš„éå®˜æ–¹ä¸‹è½½ç‚¹</a><br><a href="ed2k://|file|cn_windows_10_multi-edition_version_1709_updated_dec_2017_x64_dvd_100406696.iso|5242322944|7D89E63B0C4B5881DBCDB042FF1EB8F3|/">MSDNitellyou-Windows10ä¸­æ–‡64ä½ä¸‹è½½é“¾æ¥ed2k</a>  </li>
<li>æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œæœ€å¥½æœ‰ç½‘ï¼Œæ²¡æœ‰ä¼šéº»çƒ¦äº›</li>
</ol>
<hr>
<h1 id="ä¸‰ã€åŸç†éƒ¨åˆ†"><a href="#ä¸‰ã€åŸç†éƒ¨åˆ†" class="headerlink" title="ä¸‰ã€åŸç†éƒ¨åˆ†"></a>ä¸‰ã€åŸç†éƒ¨åˆ†</h1><h2 id="ä¸ºè®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿè¿‡ç¨‹"><a href="#ä¸ºè®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿè¿‡ç¨‹" class="headerlink" title="ä¸ºè®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿè¿‡ç¨‹"></a>ä¸ºè®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿè¿‡ç¨‹</h2><ul>
<li>è®¡ç®—æœºçš„ç®€è¦å¯åŠ¨è¿‡ç¨‹ï¼š é€šç”µ - ç¡¬ä»¶è‡ªæ£€ - å¯»æ‰¾æ“ä½œç³»ç»Ÿæ‰€åœ¨ç¡¬ç›˜ - å¯åŠ¨æ“ä½œç³»ç»Ÿ  </li>
<li>å®‰è£…ç³»ç»Ÿéš¾ç†è§£çš„æ˜¯åœ¨ç¡¬ä»¶è‡ªæ£€ä¹‹åï¼Œç›´æ¥ä»Uç›˜ä¸­è¯»å–ç³»ç»Ÿå®‰è£…ç¨‹åºï¼Œç„¶åå°†ç³»ç»Ÿè¿™ä¸ªå¤§ç¨‹åºå†™å…¥ç¡¬ç›˜çš„ç›¸åº”åˆ†åŒºå†…</li>
</ul>
<hr>
<h1 id="å››ã€å¼€å§‹å®‰è£…"><a href="#å››ã€å¼€å§‹å®‰è£…" class="headerlink" title="å››ã€å¼€å§‹å®‰è£…"></a>å››ã€å¼€å§‹å®‰è£…</h1><h2 id="æ“ä½œéƒ¨åˆ†-â€“-è®¡ç®—æœºA"><a href="#æ“ä½œéƒ¨åˆ†-â€“-è®¡ç®—æœºA" class="headerlink" title="æ“ä½œéƒ¨åˆ† â€“ è®¡ç®—æœºA"></a>æ“ä½œéƒ¨åˆ† â€“ è®¡ç®—æœºA</h2><p>æ¥ä¸‹æ¥çš„æ“ä½œéƒ½æ˜¯åœ¨è®¡ç®—æœºAä¸‹å®Œæˆçš„~  </p>
<h3 id="Rufus"><a href="#Rufus" class="headerlink" title="Rufus"></a>Rufus</h3><p>rufusæ˜¯ç”¨æ¥åˆ¶ä½œå¯å¯åŠ¨Uç›˜çš„ä¸€æ¬¾ç»¿è‰²åº”ç”¨ç¨‹åº  </p>
<h3 id="ä¸‹è½½ç³»ç»Ÿé•œåƒæ–‡ä»¶"><a href="#ä¸‹è½½ç³»ç»Ÿé•œåƒæ–‡ä»¶" class="headerlink" title="ä¸‹è½½ç³»ç»Ÿé•œåƒæ–‡ä»¶"></a>ä¸‹è½½ç³»ç»Ÿé•œåƒæ–‡ä»¶</h3><p>ä¸Šé¢æåˆ°çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ä»¥Win10-1709ä¸ºä¾‹,è¿™æ˜¯å½“å‰æœ€æ–°ç‰ˆæœ¬çš„Windows,ä¸‹è½½ä¹‹ååº”è¯¥æ˜¯ä¸€ä¸ªåç¼€åä¸º.isoçš„æ–‡ä»¶<br><img src="https://i.loli.net/2018/01/03/5a4cb6ea2f54e.png" alt="ç³»ç»Ÿé•œåƒæˆªå›¾.png"></p>
<h3 id="ä½¿ç”¨Rufusåˆ¶ä½œå¯å¯åŠ¨Uç›˜"><a href="#ä½¿ç”¨Rufusåˆ¶ä½œå¯å¯åŠ¨Uç›˜" class="headerlink" title="ä½¿ç”¨Rufusåˆ¶ä½œå¯å¯åŠ¨Uç›˜"></a>ä½¿ç”¨Rufusåˆ¶ä½œå¯å¯åŠ¨Uç›˜</h3><ol>
<li>åŒå‡»æ‰“å¼€Rufusï¼Œæ’å…¥Uç›˜ï¼Œç¡®è®¤æœ€é¡¶éƒ¨è®¾å¤‡å·²ç»è¯†åˆ«ä½ çš„ç©ºUç›˜<br><img src="https://i.loli.net/2018/01/03/5a4cb75d3e226.png" alt="rufus.png">  </li>
<li>ç‚¹å‡»ç®­å¤´æŒ‡å‘çš„æŒ‰é’®ï¼Œé€‰æ‹©åˆšæ‰ä¸‹è½½çš„é•œåƒæ–‡ä»¶<br><img src="https://i.loli.net/2018/01/03/5a4cb8c55439c.png" alt="é€‰æ‹©é•œåƒ.png">  </li>
<li>åŠ è½½é•œåƒæ–‡ä»¶ï¼Œé€‰é¡¹å¦‚å›¾ï¼Œé€‰æ‹©å¼€å§‹<br><img src="https://i.loli.net/2018/01/03/5a4cbab28beaa.png" alt="ç‚¹å‡»å¼€å§‹.png">  </li>
<li>ç‚¹å‡»ç¡®è®¤<br><img src="https://i.loli.net/2018/01/03/5a4cbab2bc3b4.png" alt="ç‚¹å‡»ç¡®è®¤.png">    </li>
<li>å¼€å§‹å†™å…¥ ï¼Œ ç­‰å¾…<br><img src="https://i.loli.net/2018/01/03/5a4cbab28b960.png" alt="å†™å…¥é•œåƒ.png">  </li>
<li>Uç›˜åˆ¶ä½œæˆåŠŸ<br><img src="https://i.loli.net/2018/01/03/5a4ce0da0574e.png" alt="GG.png"></li>
</ol>
<h2 id="æ“ä½œéƒ¨åˆ†-â€“-è®¡ç®—æœºB"><a href="#æ“ä½œéƒ¨åˆ†-â€“-è®¡ç®—æœºB" class="headerlink" title="æ“ä½œéƒ¨åˆ† â€“ è®¡ç®—æœºB"></a>æ“ä½œéƒ¨åˆ† â€“ è®¡ç®—æœºB</h2><p>ä¸‹é¢çš„éƒ¨åˆ†è½¬ç§»åˆ°é‡æ–°å®‰è£…ç³»ç»Ÿçš„è®¡ç®—æœºBä¸Šé¢æ¥äº†ï½  </p>
<h3 id="ä»Uç›˜ä¸­å¯åŠ¨ç³»ç»Ÿå®‰è£…ç¨‹åº"><a href="#ä»Uç›˜ä¸­å¯åŠ¨ç³»ç»Ÿå®‰è£…ç¨‹åº" class="headerlink" title="ä»Uç›˜ä¸­å¯åŠ¨ç³»ç»Ÿå®‰è£…ç¨‹åº"></a>ä»Uç›˜ä¸­å¯åŠ¨ç³»ç»Ÿå®‰è£…ç¨‹åº</h3><ol>
<li>å¼€æœºæŒ‰ä¸‹ç”µæºæŒ‰é”®ä¹‹åï¼Œè¯·åå¤æŒ‰ä¸‹F12ï¼Œç›´åˆ°å±å¹•å˜æˆè¿™ä¸ªæ ·å­ï½<br><a href="https://i.loli.net/2018/01/03/5a4ce554b6087.jpg"><img src="https://i.loli.net/2018/01/03/5a4ce554b6087.jpg" alt="WeChat Image_20171229111936.jpg"></a>  </li>
<li>é€‰æ‹©å¼•å¯¼è®¾å¤‡èœå•ï¼Œè¯·é€‰æ‹©åˆšåˆšåˆ¶ä½œå¥½çš„Uç›˜ï¼Œä¸€èˆ¬è®¾å¤‡åç§°ä¼šæ˜¯USBâ€¦â€¦æˆ–è€…Sandiskâ€¦â€¦æˆ–è€…Kingstonâ€¦â€¦è¿™ç±»çš„åå­—ï¼Œæˆ–è€…å¦‚ä¸Šå›¾â€“é€šç”¨é—ªå­˜è®¾å¤‡ï¼Œå›è½¦é€‰æ‹©åå®‰è£…ç¨‹åºè‡ªè¡Œå¯åŠ¨<br><img src="https://i.loli.net/2018/01/04/5a4dfb5b5c97e.png" alt="1.png">  </li>
<li>é€‰æ‹©è¯­è¨€ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šè¦æ±‚å°±ä¸­æ–‡å°±å¯ä»¥äº†ï¼Œå½“ç„¶å¦‚æœéœ€è¦è¯·ä¸‹è½½ENç‰ˆæœ¬çš„é•œåƒï¼Œæˆ–è€…å¤šå›½è¯­è¨€ç‰ˆï¼Œåœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©éœ€è¦çš„è¯­è¨€<br><img src="https://i.loli.net/2018/01/04/5a4dfb5b6c842.png" alt="2.png">  </li>
<li>ç‚¹å‡»ç°åœ¨å®‰è£…â€¦<br><img src="https://i.loli.net/2018/01/04/5a4dfdae8fab5.png" alt="3.png">   </li>
<li>ç¨ç­‰<br><img src="https://i.loli.net/2018/01/04/5a4dfb5b71520.png" alt="4.png">  </li>
<li>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š</li>
</ol>
<ul>
<li>æœ‰å¯†é’¥çš„æƒ…å†µè¯·ç›´æ¥è¾“å…¥ï¼Œç³»ç»Ÿä¼šè¢«æ¿€æ´»ï¼Œå®‰è£…å®Œæˆä¹‹åå°±æ˜¯å®˜æ–¹æ­£ç‰ˆçš„ç³»ç»Ÿï¼›  </li>
<li>æ²¡æœ‰å¯†é’¥ï¼Œåªæ˜¯éœ€è¦åœ¨ç³»ç»Ÿå®‰è£…å®Œæˆä¹‹åå†æ¬¡è¾“å…¥å¯†é’¥æˆ–è€…å®‰è£…ä¸€ä¸ªè¡¥ä¸å°±å¥½ï¼›</li>
</ul>
<p>  <img src="https://i.loli.net/2018/01/04/5a4dfb5b7e555.png" alt="5.png">  </p>
<ol>
<li>è¿™ä¸ªä½ç½®å°±å¾ˆéšæ„äº†ï¼Œé€‰æ‹©ä½ éœ€è¦çš„ç‰ˆæœ¬ï¼Œæˆ‘å®‰è£…çš„æ˜¯ä¸€ä¸ªWIN10ä¸“ä¸šç‰ˆ<br><img src="https://i.loli.net/2018/01/04/5a4dfb5b86205.png" alt="6.png">  </li>
<li>åªèƒ½æ¥å—ï¼Œæ¥å—æ‰èƒ½ä¸‹ä¸€æ­¥<br><img src="https://i.loli.net/2018/01/04/5a4dfb5b8612e.png" alt="7.png">  </li>
<li>è¿™é‡Œä¹Ÿæ˜¯ä¸¤ç§æƒ…å†µï¼š</li>
</ol>
<ul>
<li>å¦‚æœä½ çš„è®¡ç®—æœºä¸­æœ¬èº«æœ‰WIN7ã€8ã€8.1ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥å‡çº§ï¼Œä½†æ˜¯å‡çº§ä¹‹åä¼šæœ‰Windows Oldæ–‡ä»¶å¤¹å ç”¨å¤§é‡Cç›˜ç©ºé—´ï¼Œæ¸…ç†ä¼šå¾ˆéº»çƒ¦ï¼›</li>
<li>å¦‚æœå°±å·²ç»æ‰“ç®—é‡æ–°å®‰è£…äº†ï¼Œ<strong>è¯·ç¡®è®¤æ•°æ®å·²ç»å¤‡ä»½æˆ–è€…æ— ç”¨</strong>ï¼Œä¹‹åè¿™é‡Œé€‰æ‹©è‡ªå®šä¹‰ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼›</li>
</ul>
<p>  <img src="https://i.loli.net/2018/01/04/5a4dfb5ba43a3.png" alt="8.png">  </p>
<ol>
<li><strong>Note:</strong> å¦‚æœä½ çš„è®¡ç®—æœºä¸­æœ‰é‡è¦æ•°æ®è¯·è‡ªè¡Œå¤‡ä»½ï¼Œ</li>
</ol>
<p>  <strong>- ä¸‹é¢å¼€å§‹è¿›è¡Œçš„æ“ä½œä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜çš„å†…å®¹ï¼ï¼ï¼</strong><br>  <strong>- ä¸‹é¢å¼€å§‹è¿›è¡Œçš„æ“ä½œä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜çš„å†…å®¹ï¼ï¼ï¼</strong><br>  <strong>- ä¸‹é¢å¼€å§‹è¿›è¡Œçš„æ“ä½œä¼šç›´æ¥ä¿®æ”¹ç¡¬ç›˜çš„å†…å®¹ï¼ï¼ï¼</strong>   </p>
<p>  ç¡¬ç›˜åˆ†åŒºå…³é”®è¯ï¼š<br>  <strong>é©±åŠ¨å™¨0</strong> æ˜¯æŒ‡ç‰©ç†ç¡¬ç›˜ç¼–å·0ï¼Œæœ‰å‡ å—ç¡¬ç›˜å°±é¡ºåºå‘ä¸‹ç¼–å·0&#x2F;1&#x2F;2&#x2F;3â€¦<br>  <strong>åˆ†åŒº1</strong> ä¸€èˆ¬æ˜¯æŒ‡ç‰©ç†ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œé€šå¸¸å¯¹åº”äº†CDEFä¸åŒçš„å­—æ¯ï¼ŒåŒæ ·æœ‰å‡ ä¸ªåˆ†åŒºå°±é¡ºåºå‘ä¸‹ç¼–å·1&#x2F;2&#x2F;3â€¦<br>  <strong>ä¸»åˆ†åŒº</strong> æ˜¯æˆ‘ä»¬åœ¨ç³»ç»Ÿå†…ä½¿ç”¨çš„ç¡¬ç›˜åˆ†åŒºï¼Œä¸»åˆ†åŒºä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ˜¯CDEFç›˜ï¼Œå›¾ä¸­åªæœ‰ä¸€ä¸ªä¸»åˆ†åŒºï¼Œæ‰€ä»¥æˆ‘çš„ç³»ç»Ÿå®‰è£…å®Œæˆä¹‹ååªæœ‰ä¸€ä¸ªCç›˜  </p>
<p>  å›¾ç¤ºæ•°å­—è¯´æ˜:<br>  1-<strong>åˆ é™¤</strong> ç¡¬ç›˜åˆ†åŒºä¼šè®©å½“å‰çš„ç¡¬ç›˜ç©ºé—´é‡Šæ”¾ä¸ºå¯ç”¨ç©ºé—´ï¼Œç”¨äºæ‰“ç ´ä¹‹å‰åˆ’åˆ†çš„åˆ†åŒºï¼Œæ¯”å¦‚å¯ä»¥å°†åˆ†åŒºCDEFçš„EFåˆ é™¤ï¼Œåˆå¹¶æˆæ–°çš„Eç›˜  </p>
<p>  2-<strong>æ ¼å¼åŒ–</strong> æ ¼å¼åŒ–æ˜¯æ¸…ç©ºå½“å‰é€‰æ‹©åˆ†åŒºå†…çš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€æœ‰åˆ†åŒºæˆ‘ä»¬éƒ½éœ€è¦æ ¼å¼åŒ–  </p>
<p>  3-<strong>æ–°å»º</strong> æ–°å»ºåˆ†åŒºéœ€è¦æˆ‘ä»¬æŒ‡å®šå¤§å°ï¼Œæ¯”å¦‚æ–°å»ºçš„Cç›˜æˆ‘å¸Œæœ›æœ‰100Gï¼Œé‚£ä¹ˆæˆ‘éœ€è¦åœ¨æ–°å»ºä¹‹åè¾“å…¥100*1024M&#x3D;102400ï¼Œè¿™æ ·å°±æ–°å»ºäº†100Gçš„æ–°åˆ†åŒº   </p>
<p>  4-<strong>ç±»å‹</strong> ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹å’Œå…³æ³¨ä¸»åˆ†åŒºå³å¯,å…¶ä»–ä¿ç•™å°±å¯ä»¥  </p>
<p>  <strong>Note:</strong> ç‚¹å‡»ä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œä¸€å®šç¡®è®¤æˆ‘ä»¬é€‰æ‹©çš„æ˜¯ <strong>ç”±ä¸Šåˆ°ä¸‹çš„ç¬¬ä¸€ä¸ªä¸»åˆ†åŒº</strong> ï¼Œå› ä¸ºç³»ç»Ÿä¼šå®‰è£…åˆ°é«˜äº®é€‰æ‹©çš„ä¸»åˆ†åŒºå†…ï¼Œè¯· <strong>æ£€æŸ¥</strong> ä¹‹ååœ¨ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://i.loli.net/2018/01/04/5a4dfb5ba4401.png" alt="9.png"></p>
<ol>
<li><p>ç‚¹äº† <strong>ä¸‹ä¸€æ­¥</strong> å°±å¼€å§‹å®‰è£…å’¯ï¼Œ <strong>ä¹‹å‰çš„å·²ç»æ²¡æœ‰åŠæ³•å†æ›´æ”¹äº†</strong> ï¼Œé™¤éä»1å¼€å§‹å†æ¥ä¸€æ¬¡â€¦..<br><img src="https://i.loli.net/2018/01/04/5a4dfb5ba43e3.png" alt="10.png">  </p>
</li>
<li><p>ç»“æŸäº†ï¼Œç­‰å¾…å®ƒè‡ªåŠ¨é‡å¯çœ‹çœ‹å…¨æ–°çš„ç³»ç»Ÿå§ï½</p>
</li>
</ol>
<hr>
<h1 id="äº”ã€é…ç½®æ–°ç³»ç»Ÿ"><a href="#äº”ã€é…ç½®æ–°ç³»ç»Ÿ" class="headerlink" title="äº”ã€é…ç½®æ–°ç³»ç»Ÿ"></a>äº”ã€é…ç½®æ–°ç³»ç»Ÿ</h1><h2 id="æ¿€æ´»"><a href="#æ¿€æ´»" class="headerlink" title="æ¿€æ´»"></a>æ¿€æ´»</h2><p> <strong>æ·˜å®</strong> æ¿€æ´»ç  å¾ˆä¾¿å®œçš„  </p>
<h2 id="å®‰è£…é©±åŠ¨"><a href="#å®‰è£…é©±åŠ¨" class="headerlink" title="å®‰è£…é©±åŠ¨"></a>å®‰è£…é©±åŠ¨</h2><p><strong>å®˜æ–¹ç½‘ç«™</strong> æˆ–è€… <strong>é©±åŠ¨ç²¾çµ</strong><br>æœ€å¥½ä¸ç”¨é²å¤§å¸ˆå’Œ360ï¼ŒçœŸçš„  </p>
<h2 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h2><p>å¾…ç»­å§â€¦.ç´¯äº†â€¦</p>
<hr>
<h1 id="å…­ã€è½¯ä»¶æ¨è"><a href="#å…­ã€è½¯ä»¶æ¨è" class="headerlink" title="å…­ã€è½¯ä»¶æ¨è"></a>å…­ã€è½¯ä»¶æ¨è</h1><p>å¾®ä¿¡QQè¿™äº›éƒ½æ˜¯å¿…å¤‡çš„ï¼Œæˆ‘å°±ä¸è¯´äº†â€¦â€¦è¯´ä¸€äº›å¥½ç”¨çš„è½¯ä»¶ä½†æ˜¯å°‘æœ‰äººçŸ¥é“çš„â€¦â€¦æˆ‘å¹³æ—¶ä¸å®‰è£…ç”µè„‘ç®¡å®¶ï¼Œæ€æ¯’è½¯ä»¶å°±ä¸€ä¸ªå°çº¢ä¼ï¼Œå¦‚æœçœŸçš„ä¸æ”¾å¿ƒä¼šåœ¨åŠ ä¸€ä¸ªç«ç»’ï¼ŒåŸºæœ¬ä¸Šå¤Ÿäº†ï¼Œå°çº¢ä¼å¯¹ç¡¬ç›˜è¦æ±‚è¿˜æŒºé«˜çš„ï¼Œå¦‚æœè§‰å¾—å®‰è£…å°çº¢ä¼å¡ï¼Œå°±å®‰è£…å°Aå§ï¼ŒAvastâ€¦â€¦  </p>
<p>è½¯ä»¶æ¸…å•å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://notepad-plus-plus.org/">Notepad++</a> æ›¿ä»£Windowsè®°äº‹æœ¬çš„æœ€ä½³æ–¹æ¡ˆï¼Œæ”¯æŒä»£ç é«˜äº®å“¦ï½  </li>
<li><a href="http://potplayer.daum.net/?lang=zh_CN">Potplayer</a> Windowsä¸‹æœ€ç®€å•å¥½ç”¨çš„æ’­æ”¾å™¨ï½  </li>
<li><a href="http://www.voidtools.com/">Everything</a> Windowsæœç´¢ç¥å™¨ï½  </li>
<li><a href="http://www.firefox.com.cn/">Firefox</a> æµè§ˆå™¨â€¦â€¦æˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆè¯´ï¼Œåˆçˆ±åˆæ¨å§ï½  </li>
<li><a href="https://www.piriform.com/CCLEANER">CCleaner</a> Windowsä¸‹çš„è€ç‰Œæ¸…ç†è½¯ä»¶â€¦.è¿˜ä¸é”™ï½</li>
<li><a href="ed2k://|file|cn_office_professional_plus_2016_x86_x64_dvd_6969182.iso|2588266496|27EEA4FE4BB13CD0ECCDFC24167F9E01|/">Office 2016 - å…¨å®¶æ¡¶ ed2k</a> Office2016 ed2ké“¾æ¥ï¼Œè¯·ç›´æ¥è¿…é›·ä¸‹è½½ï½</li>
<li><a href="http://www.bandisoft.com/bandizip/">Bandizip</a> ç¾è§‚å‹å¥½çš„è§£å‹ç¼©è½¯ä»¶ï¼Œçœå¿ƒå…è´¹ï½</li>
<li><a href="http://www.mactype.net/">Mactype</a> Windowså­—ä½“æ¸²æŸ“ä¼˜åŒ–ï¼Œè§£æ•‘windowsé»˜è®¤çš„å­—ä½“æ¸²æŸ“ï¼Œé…ç½®çœäº‹ï¼Œæ•ˆæœæ˜æ˜¾ï½</li>
</ul>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ¬åœ°æ–¹å¼å®‰è£….Net3.5ç¬”è®°</title>
    <url>/2018/01/22/Windows/Windows_%E6%9C%AC%E5%9C%B0%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-Net3-5%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>windowsæ–°ç‰ˆæœ¬æ·˜æ±°äº†.net 3.5ï¼Œé»˜è®¤ä¸å®‰è£…ã€‚ä½†æ˜¯åœ¨æ²¡æœ‰ç½‘ç»œçš„æ—¶å€™éœ€è¦å®‰è£…å°±å¾ˆå°´å°¬ï¼Œæˆ‘å¹³æ—¶ä¹Ÿæ²¡æœ‰å¤‡ä»½è¿™ç§å®‰è£…åŒ…çš„ä¹ æƒ¯ã€‚æ‰€ä»¥æ‰¾åˆ°äº†å¦‚ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨å¾®è½¯çš„æ˜ åƒéƒ¨ç½²å·¥å…·è¿›è¡Œå®‰è£…ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š  </p>
<h2 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h2><ol>
<li>æŒ‚è½½å¾®è½¯çš„å®˜æ–¹é•œåƒï¼Œæˆ–è€…æ”¾å…¥å®‰è£…å…‰ç›˜ã€‚<span id="more"></span></li>
<li>æ‰“å¼€cmdæˆ–è€…Powershell</li>
<li>è¾“å…¥å‘½ä»¤:<br> <code>dism.exe /online /enable-feature /all /featurename:NetFX3 Source:Z:\sources\sxs</code></li>
<li>ç­‰å¾…ç³»ç»Ÿå¤„ç†å‘½ä»¤ï¼Œå®Œæˆã€‚</li>
</ol>
<p><strong>Note:å‘½ä»¤ä¸­å¯ä»¥ä¸æ·»åŠ &#x2F;allï¼Œæœ€åä¸€æ¡å‚æ•°ä¸­çš„Zç›˜ç¬¦æ”¹ä¸ºé•œåƒæŒ‚è½½æ‰€åœ¨çš„ç›˜ç¬¦å³å¯</strong>  </p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>title</title>
    <url>/1980/12/08/title/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>CFS è°ƒåº¦å™¨èµ„æ–™</title>
    <url>/2023/12/22/Linux/Linux_CFS%20Schedler/</url>
    <content><![CDATA[<p><a href="https://docs.kernel.org/scheduler/sched-design-CFS.html">https://docs.kernel.org/scheduler/sched-design-CFS.html</a><br><a href="http://arthurchiao.art/blog/linux-cfs-design-and-implementation-zh/#11-cfs%E8%BF%9B%E7%A8%8Btask%E7%9A%84%E5%85%AC%E5%B9%B3%E8%B0%83%E5%BA%A6">http://arthurchiao.art/blog/linux-cfs-design-and-implementation-zh/#11-cfs%E8%BF%9B%E7%A8%8Btask%E7%9A%84%E5%85%AC%E5%B9%B3%E8%B0%83%E5%BA%A6</a><br><a href="https://danluu.com/cgroup-throttling/">https://danluu.com/cgroup-throttling/</a><br><a href="https://heapdump.cn/article/4235306">https://heapdump.cn/article/4235306</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘é€ä¸€ä¸ªNMI unknown äº‹ä»¶ç»™OS</title>
    <url>/2023/06/28/Linux/Linux_DebugLinuxCrashOnEC2/</url>
    <content><![CDATA[<h2 id="åœ¨ec2è§¦å‘linuxçš„crash"><a href="#åœ¨ec2è§¦å‘linuxçš„crash" class="headerlink" title="åœ¨ec2è§¦å‘linuxçš„crash"></a>åœ¨ec2è§¦å‘linuxçš„crash</h2><p>å‘é€ä¸€ä¸ªè¯Šæ–­è¯·æ±‚ç»™EC2ï¼Œ è§¦å‘osæœ¬èº«NMI Unknownäº‹ä»¶ï¼Œè¿™ä¸ªæ—¶é—´ä¼šè§¦å‘Kdumpè®°å½•å½“æ—¶çš„ç°åœºã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">aws ec2 send-diagnostic-interrupt <span class="token parameter variable">--region</span> cn-north-1 --instance-id i-********************</code></pre>

<p>è®°å½•ä¸‹æ¥çš„ç°åœºæ–‡ä»¶ä¿å­˜åœ¨ &#x2F;var&#x2F;crash&#x2F; </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">
<span class="token punctuation">[</span>root@mysql <span class="token number">5.14</span>.0-284.11.1.el9_2.x86_64<span class="token punctuation">]</span><span class="token comment"># ll /var/crash/</span>
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Jun  <span class="token number">6</span> 05:22 <span class="token number">127.0</span>.0.1-2023-06-06-05:22:11
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Jun  <span class="token number">6</span> 08:58 <span class="token number">127.0</span>.0.1-2023-06-06-08:58:20
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Jun  <span class="token number">9</span> 09:39 <span class="token number">127.0</span>.0.1-2023-06-09-09:39:56
</code></pre>

<p>ä½¿ç”¨Crashå‘½ä»¤è¿›è¡Œåˆ†æï¼Œ éœ€è¦å®‰è£…kernel-debug å’Œ kernel-debuginfo kernel-devel</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@mysql <span class="token number">5.14</span>.0-284.11.1.el9_2.x86_64<span class="token punctuation">]</span><span class="token comment">#  crash /usr/lib/debug/lib/modules/5.14.0-284.11.1.el9_2.x86_64/vmlinux /var/crash/127.0.0.1-2023-06-09-09\:39\:56/vmcore</span></code></pre>

<p>ç›¸å…³æ–‡æ¡£ï¼š </p>
<p><a href="https://aws.amazon.com/blogs/aws/new-trigger-a-kernel-panic-to-diagnose-unresponsive-ec2-instances/">New â€“ Trigger a Kernel Panic to Diagnose Unresponsive EC2 Instances</a></p>
<p><a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/diagnostic-interrupt.html">å‘é€è¯Šæ–­ä¸­æ–­ï¼ˆé€‚ç”¨äºé«˜çº§ç”¨æˆ·ï¼‰</a></p>
<p>ä¸»è¦çš„é—®é¢˜æ˜¯æ€ä¹ˆè§£è¯»è¿™ä¸ªç»“æœï¼Œ ç›®å‰æˆ‘çš„ç†è§£æ˜¯ æ‰¾å¤§ä½¬ã€‚</p>
<h2 id="Cscope-æŸ¥çœ‹å†…æ ¸æºä»£ç "><a href="#Cscope-æŸ¥çœ‹å†…æ ¸æºä»£ç " class="headerlink" title="Cscope æŸ¥çœ‹å†…æ ¸æºä»£ç "></a>Cscope æŸ¥çœ‹å†…æ ¸æºä»£ç </h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½æºä»£ç </span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils
yum 
yum download <span class="token parameter variable">--source</span> kernel
<span class="token comment"># è§£å‹ä»£ç åŒ…</span>
rpm2cpio ./kernel-5.14.0-284.11.1.el9_2.src.rpm <span class="token operator">|</span> cpio <span class="token parameter variable">-div</span>
<span class="token function">tar</span> xf ./linux-5.14.0-284.11.1.el9_2.tar.xz
<span class="token comment"># ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æºä»£ç </span>
<span class="token function">make</span> cscope <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>x86
<span class="token comment"># è¯»å–å¹¶æ ‡è®°tag</span>
<span class="token function">make</span> tags <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>x86
<span class="token comment"># æŸ¥çœ‹</span>
cscope <span class="token parameter variable">-d</span></code></pre>

<h2 id="Dracutçš„ä½¿ç”¨å’Œå‘½ä»¤"><a href="#Dracutçš„ä½¿ç”¨å’Œå‘½ä»¤" class="headerlink" title="Dracutçš„ä½¿ç”¨å’Œå‘½ä»¤"></a>Dracutçš„ä½¿ç”¨å’Œå‘½ä»¤</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ·»åŠ é©±åŠ¨ç¨‹åºåˆ°ramfs</span>
<span class="token punctuation">]</span>$ dracut <span class="token parameter variable">-fv</span> --add-drivers <span class="token string">"nvme ena"</span> /boot/initramfs-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>.img <span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>
<span class="token comment"># æŸ¥çœ‹æ˜¯å¦æœ‰æ¨¡å—åœ¨ramfsä¸­</span>
<span class="token punctuation">]</span>$ lsinitrd /boot/initramfs-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>.img <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">"nvme|ena"</span></code></pre>

<h2 id="å®‰å…¨è½¯ä»¶å¼•èµ·çš„ç”¨æˆ·ç©ºé—´è¿›ç¨‹å¤±å»å“åº”ï¼š"><a href="#å®‰å…¨è½¯ä»¶å¼•èµ·çš„ç”¨æˆ·ç©ºé—´è¿›ç¨‹å¤±å»å“åº”ï¼š" class="headerlink" title="å®‰å…¨è½¯ä»¶å¼•èµ·çš„ç”¨æˆ·ç©ºé—´è¿›ç¨‹å¤±å»å“åº”ï¼š"></a>å®‰å…¨è½¯ä»¶å¼•èµ·çš„ç”¨æˆ·ç©ºé—´è¿›ç¨‹å¤±å»å“åº”ï¼š</h2><p>Redhatå…³äºè¿™ä¸ªé—®é¢˜çš„æ–‡æ¡£è¯´æ˜ï¼š </p>
<ul>
<li><p><a href="https://access.redhat.com/solutions/5201171">https://access.redhat.com/solutions/5201171</a></p>
</li>
<li><p><a href="https://access.redhat.com/solutions/2838901">https://access.redhat.com/solutions/2838901</a></p>
</li>
</ul>
<p>ä½¿ç”¨Ftraceçš„æ–¹æ³•ï¼Œå’Œä¸€éƒ¨åˆ†å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-51-167 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">'func fanotify_get_response +p'</span> <span class="token operator">></span> /sys/kernel/debug/dynamic_debug/control</code></pre>

<p>è¿½è¸ªè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œ å¹¶è¾“å‡º callgraph.<br>å†…æ ¸çš„DynamicTracingï¼Œ è¿™æ˜¯ä¸€ä¸ªå¤è€çš„æ–¹å¼äº†ï¼Œ å‡ºç°åœ¨Kprobeä¹‹å‰ã€‚ä¼šç›´æ¥å°†è¿½è¸ªçš„ç»“æœè¾“å‡ºåˆ°dmesgä¸­ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-51-167 ~<span class="token punctuation">]</span>$ perf trace <span class="token parameter variable">-s</span> <span class="token parameter variable">-p</span> <span class="token number">2688</span>
<span class="token punctuation">[</span>root@ip-172-31-51-167 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /var/crash/127.0.0.1-2023-08-11-06:53:10
<span class="token punctuation">[</span>root@ip-172-31-51-167 ~<span class="token punctuation">]</span>$ crash /usr/lib/debug/lib/modules/6.1.34-59.116.amzn2023.x86_64/vmlinux  vmcore
<span class="token punctuation">[</span>root@ip-172-31-51-167 <span class="token number">127.0</span>.0.1-2023-08-11-06:53:10<span class="token punctuation">]</span>$ ll /var/crash
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Aug <span class="token number">10</span> 05:52 <span class="token number">127.0</span>.0.1-2023-08-10-05:52:16
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Aug <span class="token number">10</span> 06:13 <span class="token number">127.0</span>.0.1-2023-08-10-06:13:44
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Aug <span class="token number">11</span> 05:45 <span class="token number">127.0</span>.0.1-2023-08-10-13:03:27
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">91</span> Aug <span class="token number">12</span> <span class="token number">15</span>:05 <span class="token number">127.0</span>.0.1-2023-08-11-04:57:13
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Aug <span class="token number">11</span> 08:41 <span class="token number">127.0</span>.0.1-2023-08-11-06:53:10
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">67</span> Aug <span class="token number">11</span> <span class="token number">20</span>:56 badstop
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">41</span> Aug <span class="token number">11</span> <span class="token number">20</span>:46 crash</code></pre>

<h2 id="Grubby-å‘½ä»¤ç®€å•çš„ç”¨æ³•"><a href="#Grubby-å‘½ä»¤ç®€å•çš„ç”¨æ³•" class="headerlink" title="Grubby å‘½ä»¤ç®€å•çš„ç”¨æ³•"></a>Grubby å‘½ä»¤ç®€å•çš„ç”¨æ³•</h2><p>è®¾ç½®å†…æ ¸å‚æ•°ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å†…æ ¸çš„å‚æ•°</span>
$ grubby <span class="token parameter variable">--info</span><span class="token operator">=</span>ALL
<span class="token comment"># è®¾ç½®é»˜è®¤çš„å¯åŠ¨å†…æ ¸</span>
$ grubby --set-default-index<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># æŸ¥çœ‹å½“å‰çš„é»˜è®¤å¯åŠ¨å†…æ ¸</span>
$ grubby --default-kernel
<span class="token comment"># ç§»é™¤æ‰€æœ‰å†…æ ¸çš„å‚æ•°</span>
$ grubby --update-kernel<span class="token operator">=</span>ALL --remove-args<span class="token operator">=</span><span class="token string">"systemd.log_level=debug systemd.log_target=kmsg log_buf_len=1M loglevel=8 crashkernel=512M"</span>
<span class="token comment"># æ›´æ–°æ‰€æœ‰å†…æ ¸çš„å‚æ•°</span>
$ grubby --update-kernel<span class="token operator">=</span>ALL <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">"systemd.log_level=debug systemd.log_target=kmsg log_buf_len=1M loglevel=8 crashkernel=512M"</span>
<span class="token comment"># ä¸ºç‰¹å®šçš„å†…æ ¸æ·»åŠ å‚æ•°ã€‚</span>
$ grubby --update-kernel<span class="token operator">=</span>/boot/vmlinuz-5.9.1-1.el8.elrepo.x86_64 <span class="token parameter variable">--args</span><span class="token operator">=</span>â€œsystemd.log_level<span class="token operator">=</span>debug <span class="token assign-left variable">systemd.log_target</span><span class="token operator">=</span>kmsg <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>1M <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">crashkernel</span><span class="token operator">=</span>512Mâ€

<span class="token punctuation">[</span>root@ip-172-31-0-170 ~<span class="token punctuation">]</span><span class="token comment"># sudo kdumpctl status</span>
kdump: Kdump is operational

<span class="token punctuation">[</span>root@ip-172-31-0-170 ~<span class="token punctuation">]</span><span class="token comment"># sudo kdumpctl showmem</span>
kdump: Reserved 256MB memory <span class="token keyword">for</span> crash kernel

<span class="token punctuation">[</span>root@ip-172-31-0-170 ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/cmdline</span>
<span class="token assign-left variable">BOOT_IMAGE</span><span class="token operator">=</span><span class="token punctuation">(</span>hd0,gpt1<span class="token punctuation">)</span>/boot/vmlinuz-6.1.34-59.116.amzn2023.x86_64 <span class="token assign-left variable">root</span><span class="token operator">=</span>UUID<span class="token operator">=</span>483d7075-a0f8-4ba8-a951-a668fa079cac ro <span class="token assign-left variable">console</span><span class="token operator">=</span>tty0 <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">nvme_core.io_timeout</span><span class="token operator">=</span><span class="token number">42949672</span>
<span class="token number">95</span> <span class="token assign-left variable">rd.emergency</span><span class="token operator">=</span>poweroff <span class="token assign-left variable">rd.shell</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">selinux</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">security</span><span class="token operator">=</span>selinux quiet <span class="token assign-left variable">systemd.log_level</span><span class="token operator">=</span>debug <span class="token assign-left variable">systemd.log_target</span><span class="token operator">=</span>kmsg <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>1M <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">crashkernel</span><span class="token operator">=</span>512M
</code></pre>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, EC2</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿½è¸ªæ•°æ®åŒ…ç»è¿‡çš„iptablesè§„åˆ™</title>
    <url>/2023/12/22/Linux/Linux_Iptables-and-conntrack/</url>
    <content><![CDATA[<p><a href="https://stackoverflow.com/questions/47645859/meaning-of-modules-instances-in-proc-modules">https://stackoverflow.com/questions/47645859/meaning-of-modules-instances-in-proc-modules</a></p>
<h2 id="Lsmodå‘½ä»¤"><a href="#Lsmodå‘½ä»¤" class="headerlink" title="Lsmodå‘½ä»¤"></a>Lsmodå‘½ä»¤</h2><p>åŸºäºmanpageçš„è¯´æ˜ï¼Œ è¿™ä¸ªå‘½ä»¤çš„æ•°æ®æ¥æºæ˜¯ ï¼š &#x2F;proc&#x2F;modules</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># lsmod</span>
Module                  Size  Used by
iptable_nat            <span class="token number">12875</span>  <span class="token number">0</span>
nf_conntrack_ipv4      <span class="token number">19149</span>  <span class="token number">1</span>
nf_defrag_ipv4         <span class="token number">12729</span>  <span class="token number">1</span> nf_conntrack_ipv4
nf_nat_ipv4            <span class="token number">14115</span>  <span class="token number">1</span> iptable_nat
nf_nat                 <span class="token number">26583</span>  <span class="token number">1</span> nf_nat_ipv4
nf_conntrack          <span class="token number">143360</span>  <span class="token number">3</span> nf_nat,nf_nat_ipv4,nf_conntrack_ipv4
iptable_filter         <span class="token number">12810</span>  <span class="token number">0</span>
nfit                   <span class="token number">59735</span>  <span class="token number">0</span>
libnvdimm             <span class="token number">163620</span>  <span class="token number">1</span> nfit
iosf_mbi               <span class="token number">15582</span>  <span class="token number">0</span>
crc32_pclmul           <span class="token number">13133</span>  <span class="token number">0</span>
ghash_clmulni_intel    <span class="token number">13273</span>  <span class="token number">0</span>
aesni_intel           <span class="token number">189456</span>  <span class="token number">0</span>
ppdev                  <span class="token number">17671</span>  <span class="token number">0</span>
lrw                    <span class="token number">13286</span>  <span class="token number">1</span> aesni_intel
gf128mul               <span class="token number">15139</span>  <span class="token number">1</span> lrw
glue_helper            <span class="token number">13990</span>  <span class="token number">1</span> aesni_intel
ablk_helper            <span class="token number">13597</span>  <span class="token number">1</span> aesni_intel
cryptd                 <span class="token number">21190</span>  <span class="token number">3</span> ghash_clmulni_intel,aesni_intel,ablk_helper
parport_pc             <span class="token number">28205</span>  <span class="token number">0</span>
parport                <span class="token number">46395</span>  <span class="token number">2</span> ppdev,parport_pc
i2c_piix4              <span class="token number">22401</span>  <span class="token number">0</span>
pcspkr                 <span class="token number">12718</span>  <span class="token number">0</span>
ip_tables              <span class="token number">27126</span>  <span class="token number">2</span> iptable_filter,iptable_nat
xfs                  <span class="token number">1014152</span>  <span class="token number">1</span>
libcrc32c              <span class="token number">12644</span>  <span class="token number">3</span> xfs,nf_nat,nf_conntrack
crct10dif_pclmul       <span class="token number">14307</span>  <span class="token number">0</span>
crct10dif_common       <span class="token number">12595</span>  <span class="token number">1</span> crct10dif_pclmul
crc32c_intel           <span class="token number">22094</span>  <span class="token number">1</span>
nvme                   <span class="token number">32382</span>  <span class="token number">1</span>
serio_raw              <span class="token number">13434</span>  <span class="token number">0</span>
ena                    <span class="token number">96895</span>  <span class="token number">0</span>
nvme_core              <span class="token number">63547</span>  <span class="token number">3</span> nvme
sunrpc                <span class="token number">366617</span>  <span class="token number">1</span></code></pre>

<p>&#x2F;proc&#x2F;modules çš„è¾“å‡ºç»“æœ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/modules</span>
iptable_nat <span class="token number">12875</span> <span class="token number">0</span> - Live 0xffffffffc0661000
nf_conntrack_ipv4 <span class="token number">19149</span> <span class="token number">1</span> - Live 0xffffffffc065b000
nf_defrag_ipv4 <span class="token number">12729</span> <span class="token number">1</span> nf_conntrack_ipv4, Live 0xffffffffc05fd000
nf_nat_ipv4 <span class="token number">14115</span> <span class="token number">1</span> iptable_nat, Live 0xffffffffc05f4000
nf_nat <span class="token number">26583</span> <span class="token number">1</span> nf_nat_ipv4, Live 0xffffffffc0603000
nf_conntrack <span class="token number">143360</span> <span class="token number">3</span> nf_conntrack_ipv4,nf_nat_ipv4,nf_nat, Live 0xffffffffc0634000
iptable_filter <span class="token number">12810</span> <span class="token number">0</span> - Live 0xffffffffc05dd000
nfit <span class="token number">59735</span> <span class="token number">0</span> - Live 0xffffffffc066d000
libnvdimm <span class="token number">163620</span> <span class="token number">1</span> nfit, Live 0xffffffffc060b000
iosf_mbi <span class="token number">15582</span> <span class="token number">0</span> - Live 0xffffffffc05ed000
crc32_pclmul <span class="token number">13133</span> <span class="token number">0</span> - Live 0xffffffffc05e5000
ghash_clmulni_intel <span class="token number">13273</span> <span class="token number">0</span> - Live 0xffffffffc059e000
aesni_intel <span class="token number">189456</span> <span class="token number">0</span> - Live 0xffffffffc05ad000
ppdev <span class="token number">17671</span> <span class="token number">0</span> - Live 0xffffffffc05a4000
lrw <span class="token number">13286</span> <span class="token number">1</span> aesni_intel, Live 0xffffffffc0575000
gf128mul <span class="token number">15139</span> <span class="token number">1</span> lrw, Live 0xffffffffc0590000
glue_helper <span class="token number">13990</span> <span class="token number">1</span> aesni_intel, Live 0xffffffffc0570000
ablk_helper <span class="token number">13597</span> <span class="token number">1</span> aesni_intel, Live 0xffffffffc0418000
cryptd <span class="token number">21190</span> <span class="token number">3</span> ghash_clmulni_intel,aesni_intel,ablk_helper, Live 0xffffffffc0569000
parport_pc <span class="token number">28205</span> <span class="token number">0</span> - Live 0xffffffffc0596000
parport <span class="token number">46395</span> <span class="token number">2</span> ppdev,parport_pc, Live 0xffffffffc0583000
i2c_piix4 <span class="token number">22401</span> <span class="token number">0</span> - Live 0xffffffffc057c000
pcspkr <span class="token number">12718</span> <span class="token number">0</span> - Live 0xffffffffc0466000
ip_tables <span class="token number">27126</span> <span class="token number">2</span> iptable_nat,iptable_filter, Live 0xffffffffc045e000
xfs <span class="token number">1014152</span> <span class="token number">1</span> - Live 0xffffffffc0470000
libcrc32c <span class="token number">12644</span> <span class="token number">3</span> nf_nat,nf_conntrack,xfs, Live 0xffffffffc0459000
crct10dif_pclmul <span class="token number">14307</span> <span class="token number">0</span> - Live 0xffffffffc0438000
crct10dif_common <span class="token number">12595</span> <span class="token number">1</span> crct10dif_pclmul, Live 0xffffffffc046b000
crc32c_intel <span class="token number">22094</span> <span class="token number">1</span> - Live 0xffffffffc041d000
nvme <span class="token number">32382</span> <span class="token number">1</span> - Live 0xffffffffc040f000
serio_raw <span class="token number">13434</span> <span class="token number">0</span> - Live 0xffffffffc0407000
ena <span class="token number">96895</span> <span class="token number">0</span> - Live 0xffffffffc0440000
nvme_core <span class="token number">63547</span> <span class="token number">3</span> nvme, Live 0xffffffffc0427000
sunrpc <span class="token number">366617</span> <span class="token number">1</span> - Live 0xffffffffc03ac000</code></pre>

<h2 id="è°ƒè¯•-Iptables-çš„æ–¹æ³•"><a href="#è°ƒè¯•-Iptables-çš„æ–¹æ³•" class="headerlink" title="è°ƒè¯• Iptables çš„æ–¹æ³•"></a>è°ƒè¯• Iptables çš„æ–¹æ³•</h2><p>Kubernetes é‡Œé¢å¤§é‡çš„ä½¿ç”¨äº†iptables è§„åˆ™çš„å„ç§è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨iptablesçš„traceåŠŸèƒ½è¿›è¡Œè¿½è¸ªï¼Œ æŸ¥çœ‹å…·ä½“ç»è¿‡äº†å“ªäº›é“¾è¡¨ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-t</span> raw <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-s</span> <span class="token number">172.31</span>.47.174/32 <span class="token parameter variable">-j</span> TRACE
or
iptables <span class="token parameter variable">-t</span> raw <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-d</span> <span class="token number">172.31</span>.71.167 <span class="token parameter variable">--dport</span> <span class="token number">8090</span> <span class="token parameter variable">-j</span> TRACE

modprobe ipt_LOG ip6t_LOG nfnetlink_log
modprobe nf_log_ipv4
xtables-monitor  <span class="token parameter variable">--trace</span></code></pre>
<p>å®Œæˆä¹‹åå°±å¯ä»¥åœ¨ message é‡Œé¢çœ‹åˆ°è®°å½•äº†ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:PREROUTING:rule:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:KUBE-SERVICES:return:45 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:PREROUTING:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-PROXY-FIREWALL:return:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:return:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:24 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-SERVICES:return:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-EXTERNAL-SERVICES:return:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:policy:5 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:POSTROUTING:rule:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:KUBE-POSTROUTING:rule:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:POSTROUTING:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:AWS-SNAT-CHAIN-0:return:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: nat:POSTROUTING:policy:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26039</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415057</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">62727</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 SYN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>020423010402080ADBFD1C1B0000000001030307<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26040</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">135</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26041</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415058</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616626</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">491</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK PSH <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1E0F3D8DDFB5<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26042</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26043</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415141</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616804</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK FIN <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1EFA3D8DE09F<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: raw:PREROUTING:policy:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:PREROUTING:policy:4 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span> <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:FORWARD:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:FORWARD:rule:2 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: filter:KUBE-FORWARD:rule:3 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span>
kern  :warn  <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>Thu Sep <span class="token number">21</span> <span class="token number">15</span>:01:25 <span class="token number">2023</span><span class="token punctuation">]</span> TRACE: mangle:POSTROUTING:policy:1 <span class="token assign-left variable">IN</span><span class="token operator">=</span>eth3 <span class="token assign-left variable">OUT</span><span class="token operator">=</span>eni7b7c562198a <span class="token assign-left variable">MAC</span><span class="token operator">=</span>02:19:e6:40:fc:c8:02:55:96:c9:21:66:08:00 <span class="token assign-left variable">SRC</span><span class="token operator">=</span><span class="token number">172.31</span>.47.174 <span class="token assign-left variable">DST</span><span class="token operator">=</span><span class="token number">172.31</span>.55.27 <span class="token assign-left variable">LEN</span><span class="token operator">=</span><span class="token number">52</span> <span class="token assign-left variable">TOS</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">PREC</span><span class="token operator">=</span>0x00 <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">63</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token number">26044</span> DF <span class="token assign-left variable">PROTO</span><span class="token operator">=</span>TCP <span class="token assign-left variable">SPT</span><span class="token operator">=</span><span class="token number">22896</span> <span class="token assign-left variable">DPT</span><span class="token operator">=</span><span class="token number">8090</span> <span class="token assign-left variable">SEQ</span><span class="token operator">=</span><span class="token number">1763415142</span> <span class="token assign-left variable">ACK</span><span class="token operator">=</span><span class="token number">2994616805</span> <span class="token assign-left variable">WINDOW</span><span class="token operator">=</span><span class="token number">490</span> <span class="token assign-left variable">RES</span><span class="token operator">=</span>0x00 ACK <span class="token assign-left variable">URGP</span><span class="token operator">=</span><span class="token number">0</span> OPT <span class="token punctuation">(</span>0101080ADBFD1FE43D8DE18A<span class="token punctuation">)</span></code></pre>
<p>ç§»é™¤è§„åˆ™çš„å‘½ä»¤ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-F</span> PREROUTING <span class="token parameter variable">-t</span> raw</code></pre>

<p>è¯¦ç»†çš„å‘½ä»¤å‚è€ƒè¿™ä¸ªBlog ï¼š <a href="https://blog.csdn.net/qq_43684922/article/details/126815699">https://blog.csdn.net/qq_43684922/article/details/126815699</a></p>
<p>æ³¨ï¼š è¿™ä¸ªåŠŸèƒ½éå¸¸æ¸…æ™°ï¼Œ ä½†æ˜¯å¦‚æœç½‘ç»œæµé‡æ¯”è¾ƒå¤§ä¼šå¯¼è‡´å†…æ ¸è¾“å‡ºäº†å¤ªå¤šçš„ä¿¡æ¯ï¼Œ ä¼šå¡ï¼Œ è°¨æ…å†™ç­–ç•¥ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>CheatSheet_Kubernetes</title>
    <url>/2023/12/08/CheatSheet_Kubernetes/</url>
    <content><![CDATA[<h3 id="ç§»é™¤æ‰€æœ‰å¤±è´¥çš„pod"><a href="#ç§»é™¤æ‰€æœ‰å¤±è´¥çš„pod" class="headerlink" title="ç§»é™¤æ‰€æœ‰å¤±è´¥çš„pod"></a>ç§»é™¤æ‰€æœ‰å¤±è´¥çš„pod</h3><pre class="language-bash" data-language="bash"><code class="language-bash">kubectl delete pod --field-selector<span class="token operator">=</span><span class="token string">"status.phase==Failed"</span></code></pre>

<h2 id="æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯"><a href="#æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯"></a>æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯</h2><p>æŸ¥çœ‹ AWS LoadBalancer è¯ä¹¦çš„ä¿¡æ¯ï¼Œæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubectl get validatingwebhookconfigurations.admissionregistration.k8s.io aws-load-balancer-webhook <span class="token parameter variable">-ojsonpath</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>.webhooks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.clientConfig.caBundle<span class="token punctuation">&#125;</span>  <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>  <span class="token operator">|</span> openssl x509 <span class="token parameter variable">-noout</span> <span class="token parameter variable">-text</span></code></pre>

<h2 id="ä½¿ç”¨-Debug-å®¹å™¨"><a href="#ä½¿ç”¨-Debug-å®¹å™¨" class="headerlink" title="ä½¿ç”¨ Debug å®¹å™¨"></a>ä½¿ç”¨ Debug å®¹å™¨</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»™ç‰¹å®šçš„å®¹å™¨é™„åŠ ä¸€ä¸ªSidecarï¼Œ å¹¶å¯åŠ¨shellã€‚</span>
kubectl debug <span class="token parameter variable">-it</span> <span class="token parameter variable">--image</span><span class="token operator">=</span>public.ecr.aws/amazonlinux/amazonlinux:latest aws-node-cpmck
<span class="token comment"># netshootå®¹å™¨ï¼Œ æ¯”è¾ƒæ–¹ä¾¿çš„ç”¨æ¥è¿›è¡Œç½‘ç»œéƒ¨åˆ†çš„è°ƒè¯•ã€‚</span>
<span class="token comment"># é¡¹ç›®ä»“åº“åœ°å€ï¼š https://github.com/nicolaka/netshoot</span>
kubectl debug mypod <span class="token parameter variable">-it</span> <span class="token parameter variable">--image</span><span class="token operator">=</span>nicolaka/netshoot</code></pre>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>CheatSheet_Linux</title>
    <url>/2023/12/08/CheatSheet_Linux/</url>
    <content><![CDATA[<h3 id="PS-Command"><a href="#PS-Command" class="headerlink" title="PS Command"></a>PS Command</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Top CPU users</span>
<span class="token function">ps</span> auxwww <span class="token parameter variable">--sort</span> -%cpu <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span>

<span class="token comment"># Top memory users</span>
<span class="token function">ps</span> auxwww <span class="token parameter variable">--sort</span> <span class="token parameter variable">-rss</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-20</span>

<span class="token function">ps</span> auxf <span class="token parameter variable">--width</span><span class="token operator">=</span><span class="token number">200</span>
or 
<span class="token function">ps</span> auxwwwf</code></pre>
<h3 id="Curl-Command"><a href="#Curl-Command" class="headerlink" title="Curl Command"></a>Curl Command</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-o</span> /dev/null <span class="token parameter variable">-s</span> <span class="token parameter variable">-w</span> <span class="token string">"time_namelookup:%&#123;time_namelookup&#125;<span class="token entity" title="\n">\n</span>time_connect: %&#123;time_connect&#125;<span class="token entity" title="\n">\n</span>time_appconnect: %&#123;time_appconnect&#125;<span class="token entity" title="\n">\n</span>time_redirect:  %&#123;time_redirect&#125;<span class="token entity" title="\n">\n</span>time_pretransfer:  %&#123;time_pretransfer&#125;<span class="token entity" title="\n">\n</span>time_starttransfer: %&#123;time_starttransfer&#125;<span class="token entity" title="\n">\n</span>time_total: %&#123;time_total&#125;<span class="token entity" title="\n">\n</span>"</span>  http://nginx.liarlee.site/Fedora-Workstation-Live-x86_64-38_Beta-1.3.iso</code></pre>
<h3 id="Sysctl-Command"><a href="#Sysctl-Command" class="headerlink" title="Sysctl Command"></a>Sysctl Command</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sysctl</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">egrep</span> <span class="token string">"rmem|wmem|tcp_mem|adv_win|moderate"</span></code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>CheatSheet_awscli</title>
    <url>/2023/12/08/Cheatsheet_AWS-CLI/</url>
    <content><![CDATA[<h3 id="æŸ¥çœ‹å®ä¾‹å’Œå¯¹åº”å®ä¾‹çš„ç³»ç»Ÿå¹³å°ä¿¡æ¯"><a href="#æŸ¥çœ‹å®ä¾‹å’Œå¯¹åº”å®ä¾‹çš„ç³»ç»Ÿå¹³å°ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹å®ä¾‹å’Œå¯¹åº”å®ä¾‹çš„ç³»ç»Ÿå¹³å°ä¿¡æ¯"></a>æŸ¥çœ‹å®ä¾‹å’Œå¯¹åº”å®ä¾‹çš„ç³»ç»Ÿå¹³å°ä¿¡æ¯</h3><pre class="language-bash" data-language="bash"><code class="language-bash">aws ec2 describe-instances <span class="token parameter variable">--query</span> <span class="token string">"Reservations[*].Instances[*].&#123;InstanceId:InstanceId,PlatformDetails:Platform&#125;"</span> <span class="token parameter variable">--output</span> table</code></pre>
<h3 id="æŸ¥çœ‹å®ä¾‹å’ŒEBSçš„å…³è”å…³ç³»"><a href="#æŸ¥çœ‹å®ä¾‹å’ŒEBSçš„å…³è”å…³ç³»" class="headerlink" title="æŸ¥çœ‹å®ä¾‹å’ŒEBSçš„å…³è”å…³ç³»"></a>æŸ¥çœ‹å®ä¾‹å’ŒEBSçš„å…³è”å…³ç³»</h3><pre class="language-bash" data-language="bash"><code class="language-bash">aws ec2 describe-volumes <span class="token parameter variable">--query</span> <span class="token string">'Volumes[*].[VolumeId, Attachments[0].InstanceId, Size]'</span> <span class="token parameter variable">--output</span> table</code></pre>]]></content>
      <categories>
        <category>AWS</category>
      </categories>
      <tags>
        <tag>AWS</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·»åŠ ä¸€ä¸ªRedhatåˆ°EKSé›†ç¾¤ï¼Œ åŸºäºPackerçš„æ­¥éª¤</title>
    <url>/2023/07/11/AWS/EKS_Add-redhat-release-to-eks/</url>
    <content><![CDATA[<p>Copy From zhojiew çš„ç§æœ‰ä»“åº“æ–‡æ¡£ï¼Œ å·²ç»ç»è¿‡æˆæƒ  ~ </p>
<hr>
<p>å®˜æ–¹æä¾›äº†åŸºäºpackerå·¥å…·çš„æ„å»ºè„šæœ¬</p>
<p>è¿™é‡Œæ‰‹åŠ¨æŠŠç›¸å…³çš„æ­¥éª¤æ‰§è¡Œä¸‹ï¼ŒåŸºäºredhat9æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰amiã€‚æ®ç§°eksä¼˜åŒ–çš„amiä¹Ÿæ˜¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆçš„</p>
<h1 id="æ‰‹åŠ¨æ„å»ºami"><a href="#æ‰‹åŠ¨æ„å»ºami" class="headerlink" title="æ‰‹åŠ¨æ„å»ºami"></a>æ‰‹åŠ¨æ„å»ºami</h1><p>æ‹‰ä»“åº“</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/ec2-suer
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token function">git</span> <span class="token parameter variable">-y</span>
<span class="token function">git</span> clone https://github.com/awslabs/amazon-eks-ami.git</code></pre>

<p>é…ç½®ç¯å¢ƒå˜é‡</p>
<pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">KUBERNETES_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">1.26.4</span> 
<span class="token key attr-name">KUBERNETES_BUILD_DATE</span><span class="token punctuation">=</span><span class="token value attr-value">2023-05-11</span> 
<span class="token key attr-name">BINARY_BUCKET_NAME</span><span class="token punctuation">=</span><span class="token value attr-value">amazon-eks</span>
<span class="token key attr-name">BINARY_BUCKET_REGION</span><span class="token punctuation">=</span><span class="token value attr-value">cn-north-1</span>
<span class="token key attr-name">DOCKER_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">20.10.23-1.amzn2.0.1</span>
<span class="token key attr-name">CONTAINERD_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">1.6.*</span>
<span class="token key attr-name">RUNC_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">1.1.5-1.amzn2</span>
<span class="token key attr-name">CNI_PLUGIN_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">v0.8.6</span>
<span class="token key attr-name">PULL_CNI_FROM_GITHUB</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">SONOBUOY_E2E_REGISTRY</span><span class="token punctuation">=</span><span class="token value attr-value">""</span>
<span class="token key attr-name">PAUSE_CONTAINER_VERSION</span><span class="token punctuation">=</span><span class="token value attr-value">3.5</span>
<span class="token key attr-name">CACHE_CONTAINER_IMAGES</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">WORKING_DIR</span><span class="token punctuation">=</span><span class="token value attr-value">/tmp/worker</span>
<span class="token key attr-name">TEMPLATE_DIR</span><span class="token punctuation">=</span><span class="token value attr-value">/home/ec2-user/amazon-eks-ami</span></code></pre>

<p>å¤åˆ¶æ–‡ä»¶æ›´æ–°å†…æ ¸ï¼ˆå¯ä»¥è·³è¿‡ï¼‰</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$WORKING_DIR</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$WORKING_DIR</span>/log-collector-script
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$WORKING_DIR</span>/bin

<span class="token function">mv</span> <span class="token variable">$TEMPLATE_DIR</span>/files/* <span class="token variable">$WORKING_DIR</span>/
<span class="token function">mv</span> <span class="token variable">$TEMPLATE_DIR</span>/log-collector-script/linux/eks-log-collector.sh <span class="token variable">$WORKING_DIR</span>/log-collector-script/
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+x <span class="token variable">$WORKING_DIR</span>/bin/
<span class="token function">sudo</span> <span class="token function">mv</span> /tmp/worker/bin/* /usr/bin/

<span class="token comment"># sudo bash $TEMPLATE_DIR/scripts/upgrade_kernel.sh</span>
<span class="token assign-left variable">KERNEL_VERSION</span><span class="token operator">=</span><span class="token number">5.10</span>
<span class="token function">sudo</span> grubby <span class="token punctuation">\</span>
  --update-kernel<span class="token operator">=</span>ALL <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">"psi=1"</span>

<span class="token function">sudo</span> grubby <span class="token punctuation">\</span>
  --update-kernel<span class="token operator">=</span>ALL <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">"clocksource=tsc tsc=reliable"</span>

<span class="token function">sudo</span> <span class="token function">reboot</span></code></pre>

<p>æ„å»ºçš„ä¸»è¦é€»è¾‘åœ¨è„šæœ¬<code>install-worker.sh</code>ä¸­</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># sudo bash $TEMPLATE_DIR/scripts/install-worker.sh</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_DEFAULT_OUTPUT</span><span class="token operator">=</span><span class="token string">"json"</span>
<span class="token assign-left variable">ARCH</span><span class="token operator">=</span><span class="token string">"amd64"</span>

<span class="token function">sudo</span> yum update <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\</span>
  chrony <span class="token punctuation">\</span>
  conntrack <span class="token punctuation">\</span>
  <span class="token function">curl</span> <span class="token punctuation">\</span>
  <span class="token function">ethtool</span> <span class="token punctuation">\</span>
  ipvsadm <span class="token punctuation">\</span>
  jq <span class="token punctuation">\</span>
  nfs-utils <span class="token punctuation">\</span>
  socat <span class="token punctuation">\</span>
  <span class="token function">unzip</span> <span class="token punctuation">\</span>
  <span class="token function">wget</span> <span class="token punctuation">\</span>
  yum-utils <span class="token punctuation">\</span>
  yum-plugin-versionlock <span class="token punctuation">\</span>
  <span class="token function">mdadm</span> <span class="token punctuation">\</span>
  pigz

<span class="token comment"># Remove any old kernel versions.</span>
<span class="token function">sudo</span> package-cleanup <span class="token parameter variable">--oldkernels</span> <span class="token parameter variable">--count</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-y</span>

<span class="token comment"># Remove the ec2-net-utils package</span>
<span class="token keyword">if</span> yum list installed <span class="token operator">|</span> <span class="token function">grep</span> ec2-net-utils<span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token function">sudo</span> yum remove ec2-net-utils <span class="token parameter variable">-y</span> -q<span class="token punctuation">;</span> <span class="token keyword">fi</span>

<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/eks/
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/configure-clocksource.service /etc/eks/configure-clocksource.service

<span class="token comment"># iptables </span>
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/iptables-restore.service /etc/eks/iptables-restore.service

<span class="token comment"># awscli</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token function">less</span> <span class="token function">unzip</span> jq <span class="token parameter variable">-y</span>
<span class="token function">curl</span> <span class="token string">"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"</span> <span class="token parameter variable">-o</span> <span class="token string">"awscliv2.zip"</span>
<span class="token function">unzip</span> awscliv2.zip
<span class="token function">sudo</span> ./aws/install <span class="token parameter variable">--update</span>
complete <span class="token parameter variable">-C</span> <span class="token string">'/usr/local/bin/aws_completer'</span> aws

<span class="token comment"># systemd</span>
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token string">"<span class="token variable">$&#123;WORKING_DIR&#125;</span>/runtime.slice"</span> /etc/systemd/system/runtime.slice
</code></pre>
<p>ç¼–è¯‘å®‰è£…runc</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># install runc and lock version</span>
<span class="token comment"># sudo yum install -y runc-$&#123;RUNC_VERSION&#125;</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> libseccomp-devel.x86_64 golang <span class="token parameter variable">-y</span>
go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.io,direct
<span class="token function">git</span> clone https://github.com/opencontainers/runc
<span class="token builtin class-name">cd</span> runc
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></code></pre>

<p>å®‰è£…containerd</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># install containerd and lock version</span>

<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
<span class="token comment"># sudo yum install -y containerd-$&#123;CONTAINERD_VERSION&#125;</span>
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> containerd <span class="token comment"># 1.6.21</span></code></pre>

<p>é…ç½®containerd</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/eks/containerd
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/containerd-config.toml /etc/eks/containerd/containerd-config.toml

<span class="token comment"># containerd and related service</span>
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/kubelet-containerd.service /etc/eks/containerd/kubelet-containerd.service
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/sandbox-image.service /etc/eks/containerd/sandbox-image.service
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/pull-sandbox-image.sh /etc/eks/containerd/pull-sandbox-image.sh
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/pull-image.sh /etc/eks/containerd/pull-image.sh
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/eks/containerd/pull-sandbox-image.sh
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/eks/containerd/pull-image.sh

<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/containerd.service.d
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/containerd.service.d/10-compat-symlink.conf</span>
[Service]
ExecStartPre=/bin/ln -sf /run/containerd/containerd.sock /run/dockershim.sock
EOF</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/modules-load.d/containerd.conf</span>
overlay
br_netfilter
EOF</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.d/99-kubernetes-cri.conf</span>
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF</span>

<span class="token comment"># skip docker</span>
</code></pre>
<p>æ—¥å¿—è½®æ¢é…ç½®</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># logrotate</span>
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/logrotate-kube-proxy /etc/logrotate.d/kube-proxy
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/logrotate.conf /etc/logrotate.conf
<span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/logrotate.d/kube-proxy
<span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/logrotate.conf
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/log/journal</code></pre>

<p>ä¸‹è½½kubeletå’Œaws-iam-authenticator</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## download bin in china region</span>
<span class="token assign-left variable">S3_DOMAIN</span><span class="token operator">=</span><span class="token string">"amazonaws.com.cn"</span>

<span class="token assign-left variable">S3_PATH</span><span class="token operator">=</span><span class="token string">"s3://amazon-eks/1.26.4/2023-05-11/bin/linux/amd64"</span>

<span class="token comment"># Verify that the aws-iam-authenticator is at last v0.5.9 or greater</span>
<span class="token assign-left variable">BINARIES</span><span class="token operator">=</span><span class="token punctuation">(</span>
  kubelet
  aws-iam-authenticator
<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">binary</span> <span class="token keyword">in</span> <span class="token variable">$&#123;BINARIES<span class="token punctuation">[</span>*<span class="token punctuation">]</span>&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    aws s3 <span class="token function">cp</span> <span class="token variable">$S3_PATH</span>/<span class="token variable">$binary</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">--region</span> cn-north-1
    <span class="token function">sudo</span> <span class="token function">chmod</span> +x <span class="token variable">$binary</span>
    <span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$binary</span> /usr/bin/
<span class="token keyword">done</span></code></pre>

<p>ç»§ç»­é…ç½®æœåŠ¡</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># kubernetes</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/manifests
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/kubernetes
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/kubelet
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/cni/bin

<span class="token assign-left variable">CNI_PLUGIN_FILENAME</span><span class="token operator">=</span><span class="token string">"cni-plugins-linux-<span class="token variable">$&#123;ARCH&#125;</span>-<span class="token variable">$&#123;CNI_PLUGIN_VERSION&#125;</span>"</span>
aws s3 <span class="token function">cp</span> <span class="token parameter variable">--region</span> <span class="token variable">$BINARY_BUCKET_REGION</span> <span class="token variable">$S3_PATH</span>/<span class="token variable">$&#123;CNI_PLUGIN_FILENAME&#125;</span>.tgz <span class="token builtin class-name">.</span>
<span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xvf</span> <span class="token string">"<span class="token variable">$&#123;CNI_PLUGIN_FILENAME&#125;</span>.tgz"</span> <span class="token parameter variable">-C</span> /opt/cni/bin
<span class="token function">rm</span> <span class="token string">"<span class="token variable">$&#123;CNI_PLUGIN_FILENAME&#125;</span>.tgz"</span>

<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/kubelet
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/kubelet.service.d
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/kubelet-kubeconfig /var/lib/kubelet/kubeconfig
<span class="token function">sudo</span> <span class="token function">chown</span> root:root /var/lib/kubelet/kubeconfig

<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/kubelet.service /etc/systemd/system/kubelet.service
<span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/systemd/system/kubelet.service
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/kubelet-config.json /etc/kubernetes/kubelet/kubelet-config.json
<span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/kubernetes/kubelet/kubelet-config.json

<span class="token function">sudo</span> systemctl daemon-reload
<span class="token comment"># Disable the kubelet until the proper dropins have been configured</span>
<span class="token function">sudo</span> systemctl disable kubelet</code></pre>

<p>é…ç½®å„ç§è„šæœ¬</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/eks
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/get-ecr-uri.sh /etc/eks/get-ecr-uri.sh
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/eks/get-ecr-uri.sh
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/eni-max-pods.txt /etc/eks/eni-max-pods.txt
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/bootstrap.sh /etc/eks/bootstrap.sh
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/eks/bootstrap.sh
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/max-pods-calculator.sh /etc/eks/max-pods-calculator.sh
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/eks/max-pods-calculator.sh
</code></pre>

<p>é…ç½®ecråŠ©æ‰‹</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ECR CREDENTIAL PROVIDER</span>
<span class="token assign-left variable">ECR_CREDENTIAL_PROVIDER_BINARY</span><span class="token operator">=</span><span class="token string">"ecr-credential-provider"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"AWS cli present - using it to copy <span class="token variable">$&#123;ECR_CREDENTIAL_PROVIDER_BINARY&#125;</span> from s3."</span>
aws s3 <span class="token function">cp</span> <span class="token parameter variable">--region</span> <span class="token variable">$BINARY_BUCKET_REGION</span> <span class="token variable">$S3_PATH</span>/<span class="token variable">$ECR_CREDENTIAL_PROVIDER_BINARY</span> <span class="token builtin class-name">.</span>

<span class="token function">sudo</span> <span class="token function">chmod</span> +x <span class="token variable">$ECR_CREDENTIAL_PROVIDER_BINARY</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/eks/image-credential-provider
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$ECR_CREDENTIAL_PROVIDER_BINARY</span> /etc/eks/image-credential-provider/
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token variable">$WORKING_DIR</span>/ecr-credential-provider-config.json /etc/eks/image-credential-provider/config.json
</code></pre>

<p>å®‰è£…ssmï¼ˆå¯é€‰ï¼‰</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ssm-agent</span>
<span class="token comment"># sudo yum install -y amazon-ssm-agent</span>
<span class="token function">sudo</span> dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm</code></pre>

<p>æ ‡è®°å‘è¡Œä¿¡æ¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># AMI Metadata</span>
<span class="token assign-left variable">BASE_AMI_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>imds /latest/meta-data/ami-id<span class="token variable">)</span></span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> <span class="token string">"<span class="token variable">$&#123;WORKING_DIR&#125;</span>/release"</span></span>
BASE_AMI_ID="<span class="token variable">$BASE_AMI_ID</span>"
BUILD_TIME="<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"
BUILD_KERNEL="<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>"
ARCH="<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"
EOF</span>
<span class="token function">sudo</span> <span class="token function">mv</span> <span class="token string">"<span class="token variable">$&#123;WORKING_DIR&#125;</span>/release"</span> /etc/eks/release
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> root:root /etc/eks</code></pre>

<p>é¢å¤–é…ç½®</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Stuff required by "protectKernelDefaults=true"</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.d/99-amazon.conf</span>
vm.overcommit_memory=1
kernel.panic=10
kernel.panic_on_oops=1
EOF</span>

<span class="token comment"># Setting up sysctl properties</span>
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">fs.inotify.max_user_watches</span><span class="token operator">=</span><span class="token number">524288</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.conf
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">fs.inotify.max_user_instances</span><span class="token operator">=</span><span class="token number">8192</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.conf
<span class="token builtin class-name">echo</span> <span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">524288</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.conf

<span class="token comment"># adding log-collector-script </span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/eks/log-collector-script/
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token variable">$WORKING_DIR</span>/log-collector-script/eks-log-collector.sh /etc/eks/log-collector-script/

<span class="token comment"># Remove Yum Update from cloud-init config</span>
<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token punctuation">\</span>
  <span class="token string">'s/ - package-update-upgrade-install/# Removed so that nodes do not have version skew based on when the node was started.\n# - package-update-upgrade-install/'</span> <span class="token punctuation">\</span>
  /etc/cloud/cloud.cfg</code></pre>

<h1 id="æµ‹è¯•åŠ å…¥é›†ç¾¤"><a href="#æµ‹è¯•åŠ å…¥é›†ç¾¤" class="headerlink" title="æµ‹è¯•åŠ å…¥é›†ç¾¤"></a>æµ‹è¯•åŠ å…¥é›†ç¾¤</h1><p>é…ç½®èŠ‚ç‚¹çš„æ ‡ç­¾å’Œæƒé™ï¼Œå°†èŠ‚ç‚¹è§’è‰²æå‰åŠ å…¥auth map</p>
<p>æå‰æ‰‹åŠ¨æ‹‰å–pauseé•œåƒ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ctr <span class="token parameter variable">--namespace</span> k8s.io image pull <span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5 <span class="token parameter variable">--user</span> AWS:<span class="token variable"><span class="token variable">`</span>aws ecr get-login-password <span class="token parameter variable">--region</span> cn-north-1<span class="token variable">`</span></span></code></pre>

<p>è¿™é‡Œæ‰§è¡Œå¯åŠ¨è„šæœ¬æ¯æ¬¡åœ¨<code>systemctl start kubelet</code>æ—¶æŠ¥æ‰¾ä¸åˆ°<code>kubelet.service</code>ã€‚ä¸çŸ¥é“åŸå› </p>
<p>å¹²è„†æ‰‹åŠ¨å¯åŠ¨kubelet</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/usr/bin/kubelet <span class="token punctuation">\</span>
    <span class="token parameter variable">--config</span> /etc/kubernetes/kubelet/kubelet-config.json <span class="token punctuation">\</span>
    <span class="token parameter variable">--kubeconfig</span> /var/lib/kubelet/kubeconfig <span class="token punctuation">\</span>
    --container-runtime-endpoint unix:///run/containerd/containerd.sock <span class="token punctuation">\</span>
    --image-credential-provider-config /etc/eks/image-credential-provider/config.json <span class="token punctuation">\</span>
    --image-credential-provider-bin-dir /etc/eks/image-credential-provider <span class="token punctuation">\</span>
    --node-ip<span class="token operator">=</span><span class="token number">192.168</span>.2.174 <span class="token punctuation">\</span>
    --pod-infra-container-image<span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5 <span class="token punctuation">\</span>
    <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
    --hostname-override<span class="token operator">=</span>ip-192-168-2-174.cn-north-1.compute.internal <span class="token punctuation">\</span>
    --cloud-provider<span class="token operator">=</span>external <span class="token punctuation">\</span>
    --container-runtime<span class="token operator">=</span>remote</code></pre>

<p>åŠ å…¥æˆåŠŸ</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubectl Apply æŠ¥é”™ annotation Too long</title>
    <url>/2023/12/22/AWS/EKS_Apply%20%E6%8F%90%E7%A4%BA%20TooLong/</url>
    <content><![CDATA[<p>é‡è£…Prometheus operator çš„æ—¶å€™æŠ¥é”™ï¼Œ æç¤ºannotation å¤ªé•¿äº†ï¼Œ ä¸èƒ½ apply</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> kubectl apply <span class="token parameter variable">-f</span> ./setup
customresourcedefinition.apiextensions.k8s.io/alertmanagerconfigs.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/probes.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/scrapeconfigs.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com created
Warning: Detected changes to resource monitoring <span class="token function">which</span> is currently being deleted.
namespace/monitoring unchanged
Error from server <span class="token punctuation">(</span>Invalid<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0prometheusCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> CustomResourceDefinition.apiextensions.k8s.io <span class="token string">"prometheuses.monitoring.coreos.com"</span> is invalid: metadata.annotations: Too long: must have at <span class="token function">most</span> <span class="token number">262144</span> bytes
Error from server <span class="token punctuation">(</span>Invalid<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0prometheusagentCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> CustomResourceDefinition.apiextensions.k8s.io <span class="token string">"prometheusagents.monitoring.coreos.com"</span> is invalid: metadata.annotations: Too long: must have at <span class="token function">most</span> <span class="token number">262144</span> bytes
</code></pre>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="ä½¿ç”¨-Create-æˆ–è€…-Replace"><a href="#ä½¿ç”¨-Create-æˆ–è€…-Replace" class="headerlink" title="ä½¿ç”¨ Create æˆ–è€… Replace"></a>ä½¿ç”¨ Create æˆ–è€… Replace</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> kubectl create <span class="token parameter variable">-f</span> ./setup
customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheusagents.monitoring.coreos.com created
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0alertmanagerConfigCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"alertmanagerconfigs.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0alertmanagerCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"alertmanagers.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0podmonitorCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"podmonitors.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0probeCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"probes.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0prometheusruleCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"prometheusrules.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0scrapeconfigCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"scrapeconfigs.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0servicemonitorCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"servicemonitors.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/0thanosrulerCustomResourceDefinition.yaml"</span><span class="token builtin class-name">:</span> customresourcedefinitions.apiextensions.k8s.io <span class="token string">"thanosrulers.monitoring.coreos.com"</span> already exists
Error from server <span class="token punctuation">(</span>AlreadyExists<span class="token punctuation">)</span>: error when creating <span class="token string">"setup/namespace.yaml"</span><span class="token builtin class-name">:</span> object is being deleted: namespaces <span class="token string">"monitoring"</span> already exists
</code></pre>
<p>ä½¿ç”¨createå‘½ä»¤å»åˆ›å»ºcrd ï¼Œä½¿ç”¨replaceæ›´æ–°crdï¼Œä»–ä»¬éƒ½ä¸æ·»åŠ  <code>last-applied-configuration</code>  è¿™ä¸ªå­—æ®µï¼Œ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> kubectl replace <span class="token parameter variable">-f</span> ./setup
customresourcedefinition.apiextensions.k8s.io/alertmanagerconfigs.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/probes.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/prometheusagents.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/scrapeconfigs.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com replaced
customresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com replaced
namespace/monitoring replaced</code></pre>
<h3 id="SSA-çš„æ–¹å¼åˆ›å»º"><a href="#SSA-çš„æ–¹å¼åˆ›å»º" class="headerlink" title="SSA çš„æ–¹å¼åˆ›å»º"></a>SSA çš„æ–¹å¼åˆ›å»º</h3><p>å½“ç„¶è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨server-side applyï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> kubectl apply --server-side <span class="token parameter variable">-f</span> ./setup</code></pre>

<p><a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/">https://kubernetes.io/docs/reference/using-api/server-side-apply/</a></p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥çœ‹EKSé›†ç¾¤èŠ‚ç‚¹ä¸Šçš„å®¹å™¨å’ŒENIçš„å¯¹åº”å…³ç³»</title>
    <url>/2023/12/08/AWS/EKS_Container-Pod-ENI/</url>
    <content><![CDATA[<h2 id="ç‰ˆæœ¬ä¿¡æ¯"><a href="#ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="ç‰ˆæœ¬ä¿¡æ¯"></a>ç‰ˆæœ¬ä¿¡æ¯</h2><pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~ <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment"># containerd -v</span>
containerd github.com/containerd/containerd v1.6.16 31aa4358a36870b21a992d3ad2bef29e1d693bec.m

root@ip-172-31-35-61 ~<span class="token comment"># uname -a</span>
Linux ip-172-31-35-61.cn-north-1.compute.internal <span class="token number">6.1</span>.10-arch1-1 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Mon, 06 Feb 2023 09:28:04 +0000 x86_64 GNU/Linux</span>

root@ip-172-31-35-60 ~ <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment"># kubelet --version</span>
Kubernetes v1.24.9-eks-49d8fe8</code></pre>
<h2 id="å®¹å™¨è™šæ‹Ÿç½‘å¡å’ŒèŠ‚ç‚¹ç½‘å¡çš„å…³"><a href="#å®¹å™¨è™šæ‹Ÿç½‘å¡å’ŒèŠ‚ç‚¹ç½‘å¡çš„å…³" class="headerlink" title="å®¹å™¨è™šæ‹Ÿç½‘å¡å’ŒèŠ‚ç‚¹ç½‘å¡çš„å…³"></a>å®¹å™¨è™šæ‹Ÿç½‘å¡å’ŒèŠ‚ç‚¹ç½‘å¡çš„å…³</h2><p>ä¸»è¦çš„æ€è·¯æ˜¯é€šè¿‡vethçš„id ã€‚</p>
<p>æ‰¾åˆ° Pod çš„ Pause å®¹å™¨</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~<span class="token comment"># nerdctl -n k8s.io ps | grep -v pause</span>
CONTAINER ID    IMAGE                                                                                         COMMAND                   CREATED           STATUS    PORTS    NAMES
218279edbee1    <span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/kube-proxy:v1.24.9-minimal-eksbuild.1    <span class="token string">"kube-proxy --v=2 --â€¦"</span>    <span class="token number">14</span> hours ago      Up                 k8s://kube-system/kube-proxy-kqlj2/kube-proxy
3a8aaf963501    <span class="token number">123456123456</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/haydenarchlinux:latest                       <span class="token string">"sleep 365d"</span>              <span class="token number">8</span> minutes ago     Up                 k8s://default/haydenarch-77c4f7cff9-dxsps/haydenarch</code></pre>
<p>è¿›å…¥å®¹å™¨å†…éƒ¨æŸ¥çœ‹ç½‘å¡çš„ID</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~<span class="token comment"># nerdctl -n k8s.io exec -it 3a8aaf963501 fish</span>

root@haydenarch-77c4f7cff9-dxsps /<span class="token comment"># cat /sys/class/net/eth0/iflink</span>
<span class="token number">54</span>

root@haydenarch-77c4f7cff9-dxsps /<span class="token comment"># ip ad</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth0@if54: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">9001</span> qdisc noqueue state UP group default
    link/ether <span class="token number">66</span>:3a:fb:f2:00:b2 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.31</span>.39.84/32 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::643a:fbff:fef2:b2/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever</code></pre>
<p>åœ¨å®ä¾‹ä¸Šé¢æŸ¥çœ‹ ç½‘å¡çš„ä¿¡æ¯ï¼Œ æ‰¾åˆ°å¸¦æœ‰ id 54 çš„è™šæ‹Ÿç½‘å¡å¯¹ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~<span class="token comment"># ip ad | grep 54</span>
<span class="token number">54</span>: enid573ff579e6@if3: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">9001</span> qdisc noqueue state UP group default</code></pre>
<p>æŸ¥çœ‹è¿™ä¸ªè™šæ‹Ÿç½‘å¡çš„å…¨éƒ¨ä¿¡æ¯ï¼Œ å¯ä»¥çœ‹åˆ° link-netnsï¼Œ è¿™æ˜¯å®¹å™¨çš„Network NameSpaceã€‚ </p>
<pre class="language-none"><code class="language-none">&#96;&#96;&#96;shell
root@ip-172-31-35-61 ~ [1]# ip link show enid573ff579e6
54: enid573ff579e6@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc noqueue state UP mode DEFAULT group default
    link&#x2F;ether 36:06:dc:85:42:a4 brd ff:ff:ff:ff:ff:ff link-netns cni-bb451da7-00be-2d59-b5e0-1dd4e77565e8</code></pre>
<p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰çš„nså¹¶æ‰¾åˆ°å¯¹åº”çš„idã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~<span class="token comment"># ip netns list</span>
cni-2e29d022-09f4-6626-f416-29cfb9652e78 <span class="token punctuation">(</span>id: <span class="token number">13</span><span class="token punctuation">)</span>
cni-e5be29a1-d111-53ec-8f88-94118eb1466c <span class="token punctuation">(</span>id: <span class="token number">10</span><span class="token punctuation">)</span>
cni-bb451da7-00be-2d59-b5e0-1dd4e77565e8 <span class="token punctuation">(</span>id: <span class="token number">8</span><span class="token punctuation">)</span>  <span class="token comment"># è¿™ä¸ªå°±æ˜¯</span>
cni-673e1c4b-acd1-ab7e-b374-1a4192eea86e <span class="token punctuation">(</span>id: <span class="token number">6</span><span class="token punctuation">)</span>
cni-1207e72f-e68e-a7e7-161e-979e9e9ada7a <span class="token punctuation">(</span>id: <span class="token number">5</span><span class="token punctuation">)</span>
cni-a8b7807f-a37e-dd4e-98cb-9d3e7cd42f11 <span class="token punctuation">(</span>id: <span class="token number">4</span><span class="token punctuation">)</span>
cni-08a7a0e2-8e33-b669-83ee-75957676ffbb <span class="token punctuation">(</span>id: <span class="token number">3</span><span class="token punctuation">)</span>
cni-8a26c501-2ea9-f4be-36ae-745a5c307fbc <span class="token punctuation">(</span>id: <span class="token number">0</span><span class="token punctuation">)</span>
cni-2598e89a-d2ba-38a8-6412-92fbff32871b <span class="token punctuation">(</span>id: <span class="token number">9</span><span class="token punctuation">)</span>
cni-817961be-8d28-b32c-816f-a842b9d243fe <span class="token punctuation">(</span>id: <span class="token number">2</span><span class="token punctuation">)</span>
cni-a84561aa-8668-8b7c-4b5e-56568e14dc83 <span class="token punctuation">(</span>id: <span class="token number">12</span><span class="token punctuation">)</span>
cni-5de27d6e-c311-6ee3-4ed5-85b2a05b6943 <span class="token punctuation">(</span>id: <span class="token number">11</span><span class="token punctuation">)</span>
cni-d102a5e6-d6ea-fb90-2ac8-a97cd8df9c85 <span class="token punctuation">(</span>id: <span class="token number">7</span><span class="token punctuation">)</span>
cni-88bf7480-bdd6-e063-3103-894d29b16302 <span class="token punctuation">(</span>id: <span class="token number">1</span><span class="token punctuation">)</span></code></pre>
<p>å¯ä»¥ç›´æ¥è¿›å…¥pod çš„network ns æŸ¥çœ‹å®¹å™¨çš„ç½‘ç»œä¿¡æ¯ï¼Œ è¿™å’Œä¸Šé¢åœ¨å®¹å™¨å†…ç›´æ¥çœ‹åˆ°çš„ä¿¡æ¯æ˜¯ä¸€è‡´çš„ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-35-61 ~ <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment"># ip netns exec cni-bb451da7-00be-2d59-b5e0-1dd4e77565e8 ip ad</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth0@if54: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">9001</span> qdisc noqueue state UP group default
    link/ether <span class="token number">66</span>:3a:fb:f2:00:b2 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.31</span>.39.84/32 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::643a:fbff:fef2:b2/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever</code></pre>
<h2 id="å¦‚ä½•ç¡®å®šå®¹å™¨çš„ç½‘å¡ç»‘å®šåœ¨äº†å“ªä¸ªENIä¸Šé¢"><a href="#å¦‚ä½•ç¡®å®šå®¹å™¨çš„ç½‘å¡ç»‘å®šåœ¨äº†å“ªä¸ªENIä¸Šé¢" class="headerlink" title="å¦‚ä½•ç¡®å®šå®¹å™¨çš„ç½‘å¡ç»‘å®šåœ¨äº†å“ªä¸ªENIä¸Šé¢"></a>å¦‚ä½•ç¡®å®šå®¹å™¨çš„ç½‘å¡ç»‘å®šåœ¨äº†å“ªä¸ªENIä¸Šé¢</h2><p>ç”±äºVPC CNIæœ¬èº«çš„å®ç°ï¼Œ åœ¨EKSçš„èŠ‚ç‚¹ä¸Šé¢ä¼šå‡ºç°å¤šçš„ENIï¼Œå…·ä½“podçš„æµé‡æ˜¯æ€ä¹ˆèµ°å‘ethç½‘å¡çš„ï¼Œå»äº†eth0 è¿˜æ˜¯ eth1 æˆ–è€…å…¶ä»–çš„ç½‘å¡ï¼Œ éœ€è¦é€šè¿‡è·¯ç”±æ¡ç›®æ¥ç¡®å®šã€‚<br>å’Œä¸Šé¢çš„è®°å½•æ—¶é—´ä¸åŒï¼Œ æ‰€ä»¥è¿™ä¸ªéƒ¨åˆ†çš„è®°å½•ï¼Œæ˜¯å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å¦ä¸€ä¸ªå®¹å™¨äº†ï¼Œ ipåœ°å€ä¼šä¸ä¸€è‡´ã€‚</p>
<p>æŸ¥çœ‹å®¹å™¨çš„IPåœ°å€</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> kubectl get pods <span class="token parameter variable">-o</span> wide
NAME                          READY   STATUS    RESTARTS   AGE   IP              NODE                                          NOMINATED NODE   READINESS GATES
haydenarch-7d9ff55cbd-4b7pl   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          18h   <span class="token number">172.31</span>.55.218   ip-172-31-55-30.cn-north-1.compute.internal   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></code></pre>
<p>æŸ¥çœ‹èŠ‚ç‚¹çš„è·¯ç”±è¡¨ï¼Œ çœ‹çœ‹è¿™ä¸ªipåœ°å€çš„è·¯ç”±ä¿¡æ¯ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-55-30 ~<span class="token punctuation">]</span><span class="token comment"># ip rule list | grep 172.31.55.218</span>
<span class="token number">512</span>:	from all to <span class="token number">172.31</span>.55.218 lookup main
<span class="token number">1536</span>:	from <span class="token number">172.31</span>.55.218 lookup <span class="token number">2</span></code></pre>
<p>é‚£ä¹ˆä¸Šé¢çš„ç»“æœæ˜¾ç¤ºï¼Œ è¿™ä¸ªIPåœ°å€çš„æ•°æ®åŒ…ä¼šæŸ¥ table 2ï¼Œ æŸ¥çœ‹ table 2</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-55-30 ~<span class="token punctuation">]</span><span class="token comment"># ip r s table 2</span>
default via <span class="token number">172.31</span>.48.1 dev eth1
<span class="token number">172.31</span>.48.1 dev eth1 scope <span class="token function">link</span></code></pre>
<p>è§‚å¯Ÿçš„è¿™ä¸ªå®¹å™¨ç°åœ¨æ˜¯åœ¨ eth1 ä¸Šé¢çš„ï¼Œ æŸ¥çœ‹èŠ‚ç‚¹çš„ç½‘å¡ä¿¡æ¯ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@ip-172-31-55-30 ~<span class="token punctuation">]</span><span class="token comment"># ip ad s eth1</span>
<span class="token number">17</span>: eth1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">9001</span> qdisc mq state UP group default qlen <span class="token number">1000</span>
    link/ether 02:d1:7d:e3:9c:ca brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.31</span>.58.94/20 brd <span class="token number">172.31</span>.63.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::d1:7dff:fee3:9cca/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever</code></pre>
]]></content>
      <categories>
        <category>EKS</category>
      </categories>
      <tags>
        <tag>EKSï¼Œ Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows Core EKS èŠ‚ç‚¹ç®¡ç†å‘½ä»¤</title>
    <url>/2023/12/05/AWS/EKS_Windows%20core%20%E8%8A%82%E7%82%B9%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<p>windows æŸ¥çœ‹ç£ç›˜ç©ºé—´çš„ä½¿ç”¨æƒ…å†µ: </p>
<pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-PSDrive</span> <span class="token operator">-</span>Name C <span class="token punctuation">|</span> <span class="token function">Select-Object</span> Name<span class="token punctuation">,</span> Free</code></pre>

<p>windows å®ä¾‹çš„ç£ç›˜ç©ºé—´æ‰©å®¹</p>
<pre class="language-powershell" data-language="powershell"><code class="language-powershell">diskpart
list volume
<span class="token function">select</span> volume 0
extend</code></pre>
<p>ä»ecrä¸‹è½½é•œåƒ</p>
<pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token variable">$ecrCreds</span> = <span class="token punctuation">(</span><span class="token function">Get-ECRLoginCommand</span><span class="token punctuation">)</span><span class="token punctuation">.</span>password

<span class="token function">Write-Host</span> <span class="token variable">$ecrCreds</span>

ctr  <span class="token operator">-</span>n k8s<span class="token punctuation">.</span>io image pull <span class="token operator">-</span>u AWS:<span class="token variable">$ecrCreds</span> ecr link</code></pre>
<p>pull image éœ€è¦ä½¿ç”¨èŠ‚ç‚¹çš„Cç›˜ç©ºé—´, ã€€åœ¨èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šæŠ¥é”™ã€‚ã€€</p>
<pre class="language-powershell" data-language="powershell"><code class="language-powershell">rpc error: code = Unknown desc = failed to pull and unpack image 
failed to extract layer sha256:9ee7a25f1f619685e0c27cd1f08b34fd7a567f8f0fa789gf9aeb79c72169afa: hcsshim::ImportLayer failed in Win32: There is not enough space on the disk<span class="token punctuation">.</span> <span class="token punctuation">(</span>0x70<span class="token punctuation">)</span>: unknown</code></pre>]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes, EKS</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªç®¡ç†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</title>
    <url>/2023/12/08/AWS/EKS_%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91bootstrap%E8%84%9A%E6%9C%AC%E5%B0%86%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4/</url>
    <content><![CDATA[<h1 id="æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹"></a>æ·»åŠ ä¸€ä¸ªè‡ªç®¡ç†çš„èŠ‚ç‚¹</h1><ol>
<li><p>åˆ›å»ºé›†ç¾¤ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ EC2ï¼Œ ç™»å½•åˆ°å·²ç»å¯åŠ¨çš„ EKS ä¼˜åŒ– OS å†…ï¼Œå‡†å¤‡å¤åˆ¶ä¸€äº›è„šæœ¬è¿‡æ¥ã€‚</p>
</li>
<li><p>æ·»åŠ EC2çš„æ ‡ç­¾ï¼š kubernetes.io&#x2F;cluster&#x2F;clusterName  owned</p>
</li>
<li><p>é…ç½®EC2çš„Instance Profile</p>
</li>
<li><p>æ§åˆ¶å°è·å– Kubernetes APIServerçš„Endpoint URL</p>
</li>
<li><p>è·å– apiserver b64 CA : <code>cat ~/.kube/config</code> è¿™ä¸ªæ–‡ä»¶é‡Œé¢å¯ä»¥æ‰¾åˆ° ï¼Œæˆ–è€…æ˜¯é€šè¿‡EKSçš„æ§åˆ¶å°ä¸Šé¢ï¼Œ æ‰¾åˆ° Base64 çš„ CAã€‚</p>
</li>
<li><p>ç¼–è¾‘ userdataï¼Œ æˆ–è€… ssh ç™»å½•åˆ°ec2ä¸Šé¢åˆ›å»ºä¸€ä¸ªbashè„šæœ¬ç”¨æ¥è°ƒç”¨ bootstrap.sh</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/eks<span class="token punctuation">;</span> <span class="token function">touch</span> ~/eks/start.sh
---
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-ex</span>

<span class="token assign-left variable">B64_CLUSTER_CA</span><span class="token operator">=</span>
<span class="token assign-left variable">API_SERVER_URL</span><span class="token operator">=</span>
<span class="token assign-left variable">K8S_CLUSTER_DNS_IP</span><span class="token operator">=</span><span class="token number">10.100</span>.0.10

/etc/eks/bootstrap.sh <span class="token variable">$&#123;ClusterName&#125;</span> --b64-cluster-ca <span class="token variable">$&#123;B64_CLUSTER_CA&#125;</span> --apiserver-endpoint <span class="token variable">$&#123;API_SERVER_URL&#125;</span></code></pre>
</li>
<li><p>é›†ç¾¤é‡Œé¢<strong>æ²¡æœ‰èŠ‚ç‚¹ç»„ ï¼Œ ä¹Ÿä¸ä¼šåˆ›å»ºaws-auth configmap</strong> æ‰€ä»¥èŠ‚ç‚¹æ— æ³•æ­£å¸¸çš„åŠ å…¥é›†ç¾¤ï¼Œ éœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapRoles</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    - groups:
      - system:bootstrappers
      - system:nodes
      rolearn: [CLUSTER_ROLE]
      username: system:node:&#123;&#123;EC2PrivateDNSName&#125;&#125;</span>
  <span class="token key atrule">mapUsers</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    []</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws<span class="token punctuation">-</span>auth
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system</code></pre></li>
</ol>
<h1 id="éœ€è¦å¤åˆ¶çš„æ–‡ä»¶"><a href="#éœ€è¦å¤åˆ¶çš„æ–‡ä»¶" class="headerlink" title="éœ€è¦å¤åˆ¶çš„æ–‡ä»¶"></a>éœ€è¦å¤åˆ¶çš„æ–‡ä»¶</h1><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> containerd <span class="token comment"># å®‰è£…Containerd</span>
<span class="token function">scp</span> /etc/eks/bootstrap.sh root@54.222.253.235:/etc/eks/bootstrap.sh <span class="token comment"># å¤åˆ¶bootstrap</span>
<span class="token function">scp</span> /usr/bin/imds root@54.222.253.235:/usr/bin/imds <span class="token comment"># shell è„šæœ¬ï¼Œ ç”¨æ¥å¸®å¿™è°ƒç”¨ec2 metadata è·å–å®ä¾‹å’ŒVPCå­ç½‘çš„ä¿¡æ¯</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/eks/ root@54.222.253.235:/etc/eks/ <span class="token comment"># ç›´æ¥å¤åˆ¶äº†eksçš„ç›¸å…³è„šæœ¬å’Œé…ç½®æ¨¡æ¿</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /var/lib/kubelet/kubeconfig root@54.222.253.235:/var/lib/kubelet/kubeconfig <span class="token comment"># å¤åˆ¶kubeletconfigé…ç½®æ–‡ä»¶æ¨¡æ¿</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/kubernetes/ root@54.222.253.235:/etc/kubernetes/ <span class="token comment"># å¤åˆ¶ kubernetes çš„é…ç½®æ–‡ä»¶</span>
<span class="token function">scp</span> <span class="token parameter variable">-pr</span> /etc/kubernetes/kubelet/ root@54.222.253.235:/etc/kubernetes/kubelet/ <span class="token comment"># ä¸Šé¢çš„å‘½ä»¤æ²¡æœ‰é€’å½’å¤åˆ¶ï¼Œ æ‰€ä»¥éœ€è¦æŒ‡å®š</span>

<span class="token comment"># è®¾ç½®å¯¹åº”çš„å†…æ ¸å‚æ•°ï¼Œ å¦‚æœä¸åškubelet ä¼šæŠ¥é”™æç¤º è¿™äº›å‚æ•°ä¸ç¬¦åˆè¦æ±‚ã€‚</span>
kernel.panic <span class="token operator">=</span> <span class="token number">10</span>
kernel.panic_on_oops <span class="token operator">=</span> <span class="token number">1</span>
vm.overcommit_memory <span class="token operator">=</span> <span class="token number">1</span></code></pre>

<h1 id="Bootstrap-è„šæœ¬å†…å®¹"><a href="#Bootstrap-è„šæœ¬å†…å®¹" class="headerlink" title="Bootstrap è„šæœ¬å†…å®¹"></a>Bootstrap è„šæœ¬å†…å®¹</h1><p>è®°å½•ä¸€ä¸‹è„šæœ¬è‡ªåŠ¨é…ç½®çš„å†…å®¹ï¼Œ å¤§æ¦‚å°±æ˜¯ è·å–å˜é‡ï¼Œ awsçš„æœåŠ¡åœ°å€ï¼Œ ec2 å…ƒæ•°æ®åœ°å€ï¼Œ æ›¿æ¢æ¨¡æ¿ä¸­çš„å˜é‡ç”ŸæˆKubeleté…ç½®æ–‡ä»¶ å’Œ Containerd çš„é…ç½®æ–‡ä»¶ï¼ˆè¿™ä¸ªæ›¿æ¢æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œ bootstrapåªèƒ½å˜æ›´æ¨¡æ¿ä¸­çš„å˜é‡ä¸€æ¬¡ï¼Œ ç¬¬äºŒæ¬¡æ‰§è¡Œåªä¼šç”Ÿæˆåˆ·æ–°ä¸€æ¬¡é›†ç¾¤çš„ä¿¡æ¯ï¼Œ ä»¥åŠé‡å¯æœåŠ¡ï¼‰ã€‚</p>
<ol>
<li>è¯»å–bootstrapåé¢ç»™å‡ºçš„å‚æ•°ï¼Œè®¾ç½®å˜é‡ï¼Œ ä¾‹å¦‚ï¼š ClusterName etc.</li>
<li>æŸ¥çœ‹Kubeletçš„ç‰ˆæœ¬ï¼Œ å†³å®šRuntimeï¼Œ containerd | dockerd, åˆ¤æ–­æ¡ä»¶æ˜¯ kubelet ç‰ˆæœ¬ å¤§äº 1.24<pre class="language-bash" data-language="bash"><code class="language-bash">++ kubelet <span class="token parameter variable">--version</span>
++ <span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">'[0-9]\.[0-9]+\.[0-9]+'</span>
+ <span class="token assign-left variable">KUBELET_VERSION</span><span class="token operator">=</span><span class="token number">1.24</span>.9
---
+ <span class="token assign-left variable">IS_124_OR_GREATER</span><span class="token operator">=</span>true
+ <span class="token assign-left variable">DEFAULT_CONTAINER_RUNTIME</span><span class="token operator">=</span>containerd</code></pre></li>
<li>è®¾ç½®ECRä»¥åŠPauseå®¹å™¨åœ°å€<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è·å–regionä»¥åŠaws service domain</span>
+ <span class="token assign-left variable">AWS_DEFAULT_REGION</span><span class="token operator">=</span>cn-north-1
+ <span class="token assign-left variable">AWS_SERVICES_DOMAIN</span><span class="token operator">=</span>amazonaws.com.cn

<span class="token comment"># è°ƒç”¨è„šæœ¬ /etc/eks/get-ecr-uri.sh cn-north-1 amazonaws.com.cn ''</span>
+ <span class="token assign-left variable">ECR_URI</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn
+ <span class="token assign-left variable">PAUSE_CONTAINER_IMAGE</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause
+ <span class="token assign-left variable">PAUSE_CONTAINER</span><span class="token operator">=</span><span class="token number">918309763551</span>.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5
+ <span class="token assign-left variable">CA_CERTIFICATE_DIRECTORY</span><span class="token operator">=</span>/etc/kubernetes/pki
+ <span class="token assign-left variable">CA_CERTIFICATE_FILE_PATH</span><span class="token operator">=</span>/etc/kubernetes/pki/ca.crt</code></pre></li>
<li>åˆ›å»ºè¯ä¹¦ç›®å½•ï¼š<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/pki
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,MASTER_ENDPOINT,https://CE0253A94B6B14215AE3282580CFA5E3.yl4.cn-north-1.eks.amazonaws.com.cn,g /var/lib/kubelet/kubeconfig
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,AWS_REGION,cn-north-1,g /var/lib/kubelet/kubeconfig
+ <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,CLUSTER_NAME,NewClusterForManualJoin,g /var/lib/kubelet/kubeconfig</code></pre></li>
<li>è·å– VPC CIDR<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># imds shell script help to get metadata.</span>
imds: /usr/bin/imds
++ imds latest/meta-data/local-ipv4
++ imds latest/meta-data/network/interfaces/macs/02:66:06:2e:48:08/vpc-ipv4-cidr-blocks</code></pre></li>
<li>åˆ›å»ºkubelet é…ç½®, è®¡ç®—é¢„ç•™çš„èµ„æº å’Œ MaxPod ç­‰ç­‰å‚æ•°çš„æ•°å€¼ã€‚<pre class="language-bash" data-language="bash"><code class="language-bash">/etc/kubernetes/kubelet/kubelet-config.json
+ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/kubelet.service.d
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/containerd
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/cni/net.d
+ <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/containerd.service.d</code></pre></li>
<li>åˆ›å»ºcontainerd é…ç½®æ–‡ä»¶<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token builtin class-name">printf</span> <span class="token string">'[Service]\nSlice=runtime.slice\n'</span>
+ <span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/containerd.service.d/00-runtime-slice.conf
+ <span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> s,SANDBOX_IMAGE,918309763551.dkr.ecr.cn-north-1.amazonaws.com.cn/eks/pause:3.5,g /etc/eks/containerd/containerd-config.toml</code></pre></li>
<li>kubeleté…ç½®å’Œå¯åŠ¨ã€‚<pre class="language-bash" data-language="bash"><code class="language-bash">+ <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-v</span> /etc/eks/containerd/kubelet-containerd.service /etc/systemd/system/kubelet.service
+ <span class="token function">sudo</span> <span class="token function">chown</span> root:root /etc/systemd/system/kubelet.service
+ <span class="token function">sudo</span> containerd config dump
+ systemctl <span class="token builtin class-name">enable</span> kubelet
+ systemctl start kubelet</code></pre></li>
</ol>
]]></content>
      <categories>
        <category>EKS</category>
      </categories>
      <tags>
        <tag>EKSï¼Œ Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Filebeat è¾“å‡ºæ—¥å¿—åˆ° Opensearch</title>
    <url>/2023/12/08/AWS/Opensearch_Filebeat%20%E8%BE%93%E5%87%BA%E6%97%A5%E5%BF%97%E5%88%B0%20Opensearch/</url>
    <content><![CDATA[<p>è¿™ä¸ªæœ€ååŸºæœ¬ä¸Šå¯ä»¥ç¡®è®¤æ˜¯ä¸€ä¸ªå…¼å®¹æ€§é—®é¢˜ï¼Œæµ‹è¯•å®Œæˆå‘ç°ï¼Œ å¼€å¯å…¼å®¹æ¨¡å¼çš„Opensearch+filebeatçš„ç»„åˆï¼Œ filebeat è¿˜æ˜¯ä¼šä¸å®šæœŸé‡å¯ã€‚ </p>
<hr>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>éœ€æ±‚æ˜¯ï¼Œä½¿ç”¨ES + filebeat æ¨¡å¼åœ¨æ”¶é›†æ—¥å¿—ã€‚<br>ä½¿ç”¨Supervisorä½œä¸ºå®¹å™¨çš„ä¸»è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯åŠ¨ååˆ†åˆ«è¿è¡Œ åº”ç”¨ï¼ˆè¿™é‡Œç”¨nginxä»£æ›¿ï¼‰ + filebeat</p>
<p>ç°åœ¨æƒ³è¦ç”¨ECS Fargateï¼Œ ç„¶åä¾æ—§è¿˜æ˜¯è¿™ä¸ªæ¨¡å¼ï¼Œ å°½å¯èƒ½æ–°çš„å˜åŠ¨ä¹‹å‰çš„æ¶æ„ï¼Œ ES æ›¿æ¢æˆ OpenSearchã€‚</p>
<p>æŒ‰ç…§è¿™ä¸ªè·¯æ•°æµ‹è¯•ã€‚ </p>
<h2 id="åˆ›å»ºOpensearch"><a href="#åˆ›å»ºOpensearch" class="headerlink" title="åˆ›å»ºOpensearch"></a>åˆ›å»ºOpensearch</h2><p>ç‰ˆæœ¬ï¼š<br>OpenSearch 2.11 (latest)<br>OpenSearch_2_11_R20231113-P1 (latest)<br>Availability Zone(s)<br>1-AZ without standby</p>
<h2 id="æ„å»ºSupervisorç®¡ç†çš„å®¹å™¨"><a href="#æ„å»ºSupervisorç®¡ç†çš„å®¹å™¨" class="headerlink" title="æ„å»ºSupervisorç®¡ç†çš„å®¹å™¨"></a>æ„å»ºSupervisorç®¡ç†çš„å®¹å™¨</h2><h3 id="åˆ›å»ºdockerfile"><a href="#åˆ›å»ºdockerfile" class="headerlink" title="åˆ›å»ºdockerfile"></a>åˆ›å»ºdockerfile</h3><p>åˆ›å»ºdockerfileçš„éƒ¨åˆ†ï¼Œ æ¯”è¾ƒéš¾çš„æ˜¯ ï¼Œ éœ€è¦æ‰¾åˆ°åˆé€‚çš„filebeatç‰ˆæœ¬<br>å‚è€ƒé¡µé¢:  <a href="https://opensearch.org/docs/latest/tools/index/#agents-and-ingestion-tools">Agents and ingestion tools</a><br>å…¶ä»–çš„æ­¥éª¤å°±ä¸‹è½½å®‰è£…å°±å¯ä»¥. </p>
<pre class="language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># ä½¿ç”¨å®˜æ–¹Nginxä½œä¸ºåŸºç¡€é•œåƒ</span>
<span class="token instruction"><span class="token keyword">FROM</span> reg.liarlee.site/docker.io/nginx</span>

<span class="token comment"># å®‰è£…Supervisor</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y supervisor</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /var/log/supervisor</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /etc/filebeat/</span>
<span class="token comment">#RUN curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.11.3-amd64.deb &amp;&amp; dpkg -i filebeat-8.11.3-amd64.deb</span>
<span class="token instruction"><span class="token keyword">RUN</span> curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-oss-7.12.1-amd64.deb &amp;&amp; dpkg -i filebeat-oss-7.12.1-amd64.deb</span>


<span class="token instruction"><span class="token keyword">COPY</span> filebeat.yml /etc/filebeat/filebeat.yml</span>
<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/nginx.conf</span>

<span class="token comment"># å°†Supervisoré…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­</span>
<span class="token instruction"><span class="token keyword">COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span>

<span class="token comment"># å¯åŠ¨Supervisoræ¥ç®¡ç†Nginxè¿›ç¨‹</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">"/usr/bin/supervisord"</span>, <span class="token string">"-n"</span> ]</span></code></pre>
<h3 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h3><p>éœ€è¦å‡†å¤‡çš„é…ç½®æ–‡ä»¶ä¸€å…±3ä¸ªï¼š </p>
<ul>
<li><p>supervisord.conf  supervisorçš„ç®¡ç†é…ç½®ï¼Œ å†³å®šäº†é‚£äº›è¿›ç¨‹è¢«ç®¡ç†ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> ./supervisord.conf
<span class="token punctuation">[</span>unix_http_server<span class="token punctuation">]</span>
<span class="token assign-left variable">file</span><span class="token operator">=</span>/var/run/supervisor.sock   <span class="token punctuation">;</span> <span class="token punctuation">(</span>the path to the socket <span class="token function">file</span><span class="token punctuation">)</span>
<span class="token assign-left variable">chmod</span><span class="token operator">=</span>0700                       <span class="token punctuation">;</span> socket <span class="token function">file</span> mode <span class="token punctuation">(</span>default 0700<span class="token punctuation">)</span>
<span class="token assign-left variable">chown</span><span class="token operator">=</span>nobody:nogroup             <span class="token punctuation">;</span> socket <span class="token function">file</span> uid:gid owner

<span class="token punctuation">[</span>supervisord<span class="token punctuation">]</span>
<span class="token assign-left variable">logfile_maxbytes</span><span class="token operator">=</span>50MB                          <span class="token punctuation">;</span> æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°
<span class="token assign-left variable">logfile_backups</span><span class="token operator">=</span><span class="token number">10</span>                             <span class="token punctuation">;</span> æ—¥å¿—æ–‡ä»¶çš„å¤‡ä»½æ•°
<span class="token assign-left variable">loglevel</span><span class="token operator">=</span>info                                  <span class="token punctuation">;</span> æ—¥å¿—çº§åˆ«
<span class="token assign-left variable">nodaemon</span><span class="token operator">=</span>false                                 <span class="token punctuation">;</span> æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨Supervisor
<span class="token assign-left variable">minfds</span><span class="token operator">=</span><span class="token number">1024</span>                                    <span class="token punctuation">;</span> å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°æ•°é‡
<span class="token assign-left variable">minprocs</span><span class="token operator">=</span><span class="token number">200</span>                                   <span class="token punctuation">;</span> å¯ä»¥åˆ›å»ºçš„è¿›ç¨‹çš„æœ€å°æ•°é‡

<span class="token punctuation">[</span>program:nginx<span class="token punctuation">]</span>
<span class="token assign-left variable">command</span><span class="token operator">=</span>/usr/sbin/nginx <span class="token parameter variable">-g</span> <span class="token string">"daemon off;"</span>  <span class="token punctuation">;</span> å¯åŠ¨Nginxçš„å‘½ä»¤
<span class="token assign-left variable">autostart</span><span class="token operator">=</span>true                             <span class="token punctuation">;</span> åœ¨Supervisorå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨
<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true                           <span class="token punctuation">;</span> ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯
<span class="token assign-left variable">stderr_logfile</span><span class="token operator">=</span>/var/log/nginx/error.log    <span class="token punctuation">;</span> é”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„
<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/var/log/access.log   <span class="token punctuation">;</span> è®¿é—®æ—¥å¿—æ–‡ä»¶è·¯å¾„

<span class="token punctuation">[</span>program:filebeat<span class="token punctuation">]</span>
<span class="token assign-left variable">command</span><span class="token operator">=</span>/usr/bin/filebeat <span class="token parameter variable">-e</span> <span class="token parameter variable">-c</span> /etc/filebeat/filebeat.yml  <span class="token punctuation">;</span> å¯åŠ¨Filebeatçš„å‘½ä»¤
<span class="token assign-left variable">autostart</span><span class="token operator">=</span>true
<span class="token assign-left variable">autorestart</span><span class="token operator">=</span>true
<span class="token assign-left variable">stderr_logfile</span><span class="token operator">=</span>/var/log/filebeat.err.log
<span class="token assign-left variable">stdout_logfile</span><span class="token operator">=</span>/var/log/filebeat.out.log</code></pre></li>
<li><p>filebeat.yml   filebeatçš„é…ç½®æ–‡ä»¶ã€‚  è¿™é…ç½®æ–‡ä»¶ GPT ä¼šç›´æ¥å†™å‡ºä¸€ä¸ªå¯ä»¥ç”¨ <code>output.opensearch:</code>ï¼Œ å…¶å®è¿˜æ˜¯ä¸èƒ½çš„ï¼Œ åªèƒ½ä½¿ç”¨åŸæœ¬çš„é…ç½®æ–‡ä»¶ã€‚ (ä¹Ÿè®¸æ˜¯æˆ‘é€‰æ‹©çš„filebeatsç‰ˆæœ¬ä¸æ­£ç¡®,  æ‰€ä»¥ä¸è¡Œå§</p>
<p> filebeatæœ¬èº«æ˜¯esåºåˆ—é‡Œé¢çš„äº§å“ï¼Œ ä¸æ”¯æŒopensearchä¹Ÿåˆç†ï¼Œ å¦‚æœå†™æˆopensearch ä¼šæ‰¾ä¸åˆ°output çš„å®šä¹‰ï¼Œ ä¹Ÿè¯´æ˜å¹¶ä¸æ”¯æŒè¿™ä¸ªå­—æ®µã€‚</p>
</li>
</ul>
<p>2023-12-14T12:03:12.560Z	INFO	[publisher_pipeline_output]	pipeline&#x2F;output.go:145	Attempting to reconnect to backoff(elasticsearch(<a href="https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn/">https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn:443</a>)) with 7 reconnect attempt(s)</p>
<pre class="language-none"><code class="language-none">&#96;&#96;&#96;shell
&gt; cat .&#x2F;filebeat.yml
filebeat.inputs:
- type: filestream
  id: nginxaccesslog
  paths:
    - &#x2F;var&#x2F;log&#x2F;access.log
  fields:
    log_type: access

seccomp.enabled: false # è¿™ä¸ªä¸å…³é—­çš„è¯å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªå¹²æ‰°ã€‚
logging.level: debug # ç”±äºè°ƒè¯•æ–¹ä¾¿è®¾ç½®äº†DEBUGã€‚ 

# è¿™ä¸ªé…ç½®æ®µæ˜¯å…³é—­ xpackï¼Œ xpackåŠŸèƒ½åªåœ¨esé‡Œé¢æä¾›ï¼Œ å•†ä¸šç‰ˆæœ¬ã€‚
ilm.enabled: false
setup.ilm.enabled: false
setup.pack.security.enabled: false
setup.xpack.graph.enabled: false
setup.xpack.watcher.enabled: false
setup.xpack.monitoring.enabled: false
setup.xpack.reporting.enabled: false

# outputå°±æ˜¯è¿˜ç”¨es
output.elasticsearch:
  enable: true
  hosts: [&quot;vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn:443&quot;] # è¿™ä¸ªéƒ¨åˆ†éœ€è¦æ‰‹åŠ¨æŒ‡å®š443, å› ä¸ºæ˜¯esçš„é»˜è®¤é…ç½®, æ‰€ä»¥ç›´æ¥å» 9200,å°±ä¼šè¿æ¥ä¸ä¸Š.
  protocol: &quot;https&quot;</code></pre>

<p>  xpack æŠ¥é”™çš„æ—¥å¿—å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š </p>
<blockquote>
<p> 2023-12-14T12:03:12.560Z	ERROR	[publisher_pipeline_output]	pipeline&#x2F;output.go:154	Failed to connect to backoff(elasticsearch(<a href="https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn/">https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn:443</a>)): Connection marked as failed because the onConnect callback failed: request checking for ILM availability failed: 401 Unauthorized: {â€œMessageâ€:â€Your request: â€˜&#x2F;_xpackâ€™ is not allowed.â€}<br> 2023-12-14T12:03:12.560Z	INFO	[publisher_pipeline_output]	pipeline&#x2F;output.go:145	Attempting to reconnect to backoff(elasticsearch(<a href="https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn/">https://vpc-ecs-nginx-opensearch-qt7m5rmhddggkiuapyybcmz5oe.cn-north-1.es.amazonaws.com.cn:443</a>)) with 7 reconnect attempt(s)</p>
</blockquote>
<ul>
<li>nginx.conf   è¿™ä¸ªæ˜¯nginx åº”ç”¨æ–‡ä»¶ï¼Œ æ¨¡æ‹Ÿä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œ æä¾›webserveræœåŠ¡ã€‚é…ç½®æ–‡ä»¶å°±æ˜¯æ ‡å‡†çš„é…ç½®æ–‡ä»¶, ä¿®æ”¹ä¸€ä¸‹æ—¥å¿—è¾“å‡ºçš„è·¯å¾„. <pre class="language-bash" data-language="bash"><code class="language-bash">access_log  /var/log/access.log  main<span class="token punctuation">;</span></code></pre>
 ç”±äºbaseimageç”¨çš„æ˜¯nginxçš„ï¼Œ æ‰€ä»¥nginx çš„æ—¥å¿—è¾“å‡ºä¼šè½¯é“¾æ¥åˆ°&#x2F;dev&#x2F;stdout, filebeat ä¸æ”¶è½¯é“¾æ¥çš„æ–‡ä»¶, å¼€äº†DEBUGä¼šçœ‹åˆ°è·³è¿‡è¿™ä¸ªæ–‡ä»¶çš„æ—¥å¿—.</li>
</ul>
<h2 id="Buildstage"><a href="#Buildstage" class="headerlink" title="Buildstage"></a>Buildstage</h2><p>æ¥ä¸‹æ¥å°±å¯ä»¥Buildé•œåƒç„¶åè¿›è¡Œæµ‹è¯•äº†ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> dive build <span class="token parameter variable">-t</span> reg.liarlee.site/library/superv-nginx:v31 <span class="token builtin class-name">.</span>
<span class="token operator">></span> <span class="token function">docker</span> push reg.liarlee.site/library/superv-nginx:v31
<span class="token operator">></span> <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> superv-nginx <span class="token parameter variable">--rm</span>  reg.liarlee.site/library/superv-nginx:v31</code></pre>
<p>è¿è¡Œå¯åŠ¨ä¹‹åå¯ä»¥çœ‹åˆ°è¾“å‡ºçš„æ—¥å¿—æ˜¯ï¼š </p>
<pre class="language-log" data-language="log"><code class="language-log"><span class="token date number">2023-12-14</span> <span class="token time number">14:03:31,093</span> <span class="token level info keyword">INFO</span> <span class="token property">success:</span> filebeat entered RUNNING state<span class="token punctuation">,</span> process has stayed up for <span class="token operator">></span> than <span class="token number">1</span> seconds <span class="token operator">(</span>startsecs<span class="token operator">)</span>
<span class="token date number">2023-12-14</span> <span class="token time number">14:03:31,093</span> <span class="token level info keyword">INFO</span> <span class="token property">success:</span> nginx entered RUNNING state<span class="token punctuation">,</span> process has stayed up for <span class="token operator">></span> than <span class="token number">1</span> seconds <span class="token operator">(</span>startsecs<span class="token operator">)</span></code></pre>
<p>ç„¶åæŸ¥çœ‹Opensearch åˆ›å»ºäº†é»˜è®¤indexï¼Œ åç§°æ˜¯<code>filebeat-7.12.1-2023.12.14</code></p>
<h2 id="æ”¾åˆ°-Ecs-é‡Œé¢å»"><a href="#æ”¾åˆ°-Ecs-é‡Œé¢å»" class="headerlink" title="æ”¾åˆ° Ecs é‡Œé¢å»"></a>æ”¾åˆ° Ecs é‡Œé¢å»</h2><p>æˆ‘ç›´æ¥ä½¿ç”¨æˆ‘è‡ªå·±çš„ä»“åº“é‡Œé¢æ‹‰å–äº† ï¼Œåˆ›å»ºecs serviceç„¶åcurlè¯·æ±‚å‘é€åˆ° alb ï¼Œ è½¬ç»™ taskã€‚<br>è§‚å¯Ÿopensearchä¸­æ”¶é›†çš„è®¿é—®æ—¥å¿—ã€‚ </p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>AWS, ELK, OpenSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>TrueNas Scale è®© ZFS å ç”¨æ›´å¤šå†…å­˜ä½œä¸º ARC</title>
    <url>/2023/10/08/Other/NAS_TrueNas%20Scale%20%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E7%9A%84%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<p>è¿™ä¸ªå‘½ä»¤çš„è®°å½•åœ¨ TrueNas Scale ,ä¹Ÿå°±æ˜¯linuxåœºæ™¯ä¸‹çš„ï¼Œ Linux è¿™ä¸ªç‰ˆæœ¬åœ¨æˆ‘çš„èœ—ç‰›æ˜Ÿé™…ä¸Šé¢æˆ‘çœ‹åˆ°äº†ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œ å¯èƒ½ä¼šå¯¼è‡´ç£ç›˜çš„çŠ¶æ€å¼‚å¸¸ï¼Œ é‚å¼ƒä¹‹ã€‚ å›FreeBSDçš„ç‰ˆæœ¬å°±æ²¡äº‹äº†ï¼Œè¿˜æ²¡æœ‰é‚£ä¸ªç¢äº‹çš„é›†æˆ k3s.</p>
<p>TrueNas Scale<br>Some param can use to tunning Memory Usage : </p>
<p>Config the ARC Memory to 75% Total Memory :</p>
<p>root@haydentruenas:&#x2F;sys&#x2F;block# echo 2995556352 &gt; &#x2F;sys&#x2F;module&#x2F;zfs&#x2F;parameters&#x2F;zfs_arc_max<br>root@haydentruenas:&#x2F;sys&#x2F;block# echo 268435456 &gt; &#x2F;sys&#x2F;module&#x2F;zfs&#x2F;parameters&#x2F;zfs_arc_sys_free</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>

<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"/bin:/sbin:/usr/bin:/usr/sbin:<span class="token variable">$&#123;<span class="token environment constant">PATH</span>&#125;</span>"</span>
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span>

<span class="token assign-left variable">ARC_PCT</span><span class="token operator">=</span><span class="token string">"90"</span>
<span class="token assign-left variable">ARC_BYTES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">'^MemTotal'</span> /proc/meminfo <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">pct</span><span class="token operator">=</span>$<span class="token punctuation">&#123;</span>ARC_PCT<span class="token punctuation">&#125;</span> <span class="token string">'&#123;printf "%d", $2 * 1024 * (pct / 100.0)&#125;'</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">$&#123;ARC_BYTES&#125;</span> <span class="token operator">></span> /sys/module/zfs/parameters/zfs_arc_max

<span class="token assign-left variable">SYS_FREE_BYTES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token variable">))</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">$&#123;SYS_FREE_BYTES&#125;</span> <span class="token operator">></span> /sys/module/zfs/parameters/zfs_arc_sys_free</code></pre>]]></content>
      <categories>
        <category>Tools, Toy</category>
      </categories>
      <tags>
        <tag>TrueNasScale, NAS</tag>
      </tags>
  </entry>
  <entry>
    <title>rimeçš„é…ç½®</title>
    <url>/2023/08/13/Other/Other_InputMethodForRIME/</url>
    <content><![CDATA[<p><a href="https://github.com/iDvel/rime-ice">https://github.com/iDvel/rime-ice</a></p>
<p><a href="https://rime.im/">https://rime.im/</a></p>
<p>å°ç‹¼æ¯«è¾“å…¥æ³•ï¼Œ æˆ–è€…Fcitx5 æŒ‚è½½ rime å³å¯ã€‚ </p>
<p>åé¢å¦‚æœè¿˜æœ‰è¾“å…¥æ³•ç›¸å…³çš„å†…å®¹ä¼šæ”¾åœ¨è¿™ä¸ªé‡Œé¢ã€‚ </p>
<h2 id="å°é¹¤åŒæ‹¼"><a href="#å°é¹¤åŒæ‹¼" class="headerlink" title="å°é¹¤åŒæ‹¼"></a>å°é¹¤åŒæ‹¼</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">cat</span> ./default.custom.yaml
patch:
  schema_list:
    - schema: double_pinyin_flypy    <span class="token comment"># å°é¹¤åŒæ‹¼</span>
  ascii_composer:
    good_old_caps_lock: <span class="token boolean">true</span>  <span class="token comment"># true | false</span>
    switch_key:
      Caps_Lock: <span class="token function">clear</span>      <span class="token comment"># commit_code | commit_text | clear</span>
      Shift_L: noop  <span class="token comment"># commit_code | commit_text | inline_ascii | clear | noop</span>
      Shift_R: noop         <span class="token comment"># commit_code | commit_text | inline_ascii | clear | noop</span>
      Control_L: noop       <span class="token comment"># commit_code | commit_text | inline_ascii | clear | noop</span>
      Control_R: noop       <span class="token comment"># commit_code | commit_text | inline_ascii | clear | noop</span></code></pre>
<h2 id="è¾“å…¥æ³•é»˜è®¤ä¸åˆ‡æ¢å…¨åŠè§’"><a href="#è¾“å…¥æ³•é»˜è®¤ä¸åˆ‡æ¢å…¨åŠè§’" class="headerlink" title="è¾“å…¥æ³•é»˜è®¤ä¸åˆ‡æ¢å…¨åŠè§’"></a>è¾“å…¥æ³•é»˜è®¤ä¸åˆ‡æ¢å…¨åŠè§’</h2><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">></span> cat ./default.custom.yaml
<span class="token key atrule">patch</span><span class="token punctuation">:</span>
  <span class="token key atrule">switches</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ascii_mode
      <span class="token key atrule">states</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> ä¸­ <span class="token punctuation">]</span>
      <span class="token key atrule">reset</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ascii_punct <span class="token comment"># ä¸­è‹±æ ‡ç‚¹</span>
      <span class="token key atrule">states</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> Â¥<span class="token punctuation">,</span> $ <span class="token punctuation">]</span>
      <span class="token key atrule">reset</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> traditionalization
      <span class="token key atrule">states</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> ç®€<span class="token punctuation">,</span> ç¹ <span class="token punctuation">]</span>
      <span class="token key atrule">reset</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> emoji
      <span class="token key atrule">states</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> ğŸ’€<span class="token punctuation">,</span> ğŸ˜„ <span class="token punctuation">]</span>
      <span class="token key atrule">reset</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> full_shape
      <span class="token key atrule">states</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> åŠè§’<span class="token punctuation">,</span> å…¨è§’ <span class="token punctuation">]</span>
      <span class="token key atrule">reset</span><span class="token punctuation">:</span> <span class="token number">0</span></code></pre>]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>RIME, Linux, Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis ç¬”è®°</title>
    <url>/2023/12/22/Database/Databases_Redis-note/</url>
    <content><![CDATA[<h2 id="ElastiCacheä¸»è¦æ¦‚å¿µ"><a href="#ElastiCacheä¸»è¦æ¦‚å¿µ" class="headerlink" title="ElastiCacheä¸»è¦æ¦‚å¿µ"></a>ElastiCacheä¸»è¦æ¦‚å¿µ</h2><ol>
<li><p>ElastiCache nodes<br>A node is the smallest building block of an ElastiCache deployment.<br>node is a fixed-size chunk of secure, network-attached RAM.<br>æ€»ç»“æ¥è¯´ï¼Œ å°±æ˜¯ec2å®ä¾‹ä¸Šé¢è·‘äº†ç›¸åŒç‰ˆæœ¬çš„Engine for Redisã€‚</p>
</li>
<li><p>ElastiCache for Redis shards<br><img src="https://docs.aws.amazon.com/zh_cn/AmazonElastiCache/latest/red-ug/images/ElastiCacheClusters-CSN-RedisShards.png" alt="Explaining Shared"> </p>
<p>A Redis shard (called a node group in the API and CLI) is a grouping of one to six related nodes. A Redis (cluster mode disabled) cluster always has one shard.<br>Redis (cluster mode enabled) clusters can have up to 500 shards, with your data partitioned across the shards.</p>
<p>Shard æ˜¯å¤šä¸ª Nodes çš„é›†åˆï¼Œ æˆ–è€…å«ä½œèŠ‚ç‚¹ç»„. ä¸€ä¸ªShardåŒ…æ‹¬çš„èŠ‚ç‚¹æœ‰ä¸åŒçš„è§’è‰²ï¼Œ ä¸€ä¸ªPrimary å’Œ æœ€å¤š5ä¸ª Replica.</p>
</li>
<li><p>ElastiCache for Redis clusters<br>A Redis cluster is a logical grouping of one or more ElastiCache for Redis shards. Data is partitioned across the shards in a Redis (cluster mode enabled) cluster.<br>é›†ç¾¤æ¨¡å¼å…³é—­ï¼Œ 1 Cluster â€“ 1 Shard â€“ 1 - 6 Nodes: 1 Primary and 5 Nodes<br>é›†ç¾¤æ¨¡å¼å¼€å¯ï¼Œ 1 Cluster â€“ 500 Shard â€“ 1 - 6 Nodes: 1 Primary Per Shard</p>
</li>
<li><p>ElastiCache for Redis replication<br>Redis (cluster mode disabled) clusters support one shard (in the API and CLI, called a node group).<br>Redis (cluster mode enabled) clusters can have up to 500 shards, with your data partitioned across the shards. </p>
<p>æ¯ä¸ªReplicaéƒ½æ˜¯Primaryä¸­å…¨éƒ¨æ•°æ®çš„å¤åˆ¶ã€‚ Replicaä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œä¸Primaryçš„æ•°æ®åŒæ­¥ã€‚ </p>
<p>ç¬¬ä¸€æ¬¡ psync2 å…¨é‡å¤åˆ¶æ‰€æœ‰å†…å­˜å½“å‰å­˜å‚¨çš„æ•°æ®ï¼Œ åç»­ä½¿ç”¨redisçš„å¢é‡å¤åˆ¶ã€‚ </p>
</li>
<li><p>AWS Regions and availability zones<br>ç›®å‰ä¸­å›½åŒºä¸èƒ½ä½¿ç”¨ GlobalStoreï¼Œ å¹¶ä¸”Regionä¹‹é—´ä¹Ÿæ˜¯æ— æ³•ç›¸äº’åŒæ­¥æ•°æ®çš„ã€‚ åœ¨ä¸åŒçš„az ä¹‹é—´å¯ä»¥åšé«˜å¯ç”¨æ¥é™ä½åœæœºçš„æ—¶é—´ã€‚ </p>
</li>
<li><p>ElastiCache for Redis endpoints<br>An endpoint is the unique address your application uses to connect to an ElastiCache node or cluster.</p>
<ul>
<li><p>Redis ç¦ç”¨é›†ç¾¤æ¨¡å¼çš„å•èŠ‚ç‚¹ç«¯ç‚¹<br>å•èŠ‚ç‚¹çš„é›†ç¾¤ç«¯ç‚¹ç”¨äºè¯»å–å’Œå†™å…¥. In one word, Single Primary, read and write at one point.<br><strong>ç”¨è¿™ä¸ªèŠ‚ç‚¹çš„ Endpoint å³å¯ã€‚</strong></p>
</li>
<li><p>Redis ç¦ç”¨é›†ç¾¤æ¨¡å¼çš„å¤šèŠ‚ç‚¹ç«¯ç‚¹<br>å¤šèŠ‚ç‚¹æœ‰ä¸¤ä¸ªä¸åŒçš„ç«¯ç‚¹ï¼Œ Primary ç«¯ç‚¹æ€»æ˜¯è¿æ¥åˆ°Primary èŠ‚ç‚¹ï¼Œæ•…éšœåˆ‡æ¢ä¼šåˆ‡æ¢è¿™ä¸ªdnsæŒ‡å‘çš„åç«¯ã€‚<br>Reader Endpoint åœ¨æ‰€æœ‰çš„ ReplicaèŠ‚ç‚¹ä¹‹é—´åˆ†æµConnection ç”¨æ¥æä¾›è¯»å–è¡Œä¸ºã€‚</p>
</li>
</ul>
<p><strong>ç”¨æ§åˆ¶å°ä¸Šé¢çš„ Primary Endpoint å’Œ Reader Endpoint</strong></p>
<ul>
<li>Redis å¯ç”¨é›†ç¾¤æ¨¡å¼çš„ç«¯ç‚¹<br>é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œ åªæ˜¯é…ç½®ä¸€ä¸ªendpointï¼Œ ä½†æ˜¯è¿æ¥åˆ°Endpointä¹‹åï¼Œ å®¢æˆ·ç«¯å¯ä»¥å‘ç°æ‰€æœ‰çš„ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ã€‚</li>
</ul>
<p>** ç”¨Configuration Endpoint å¯ä»¥æ‰¾åˆ°é›†ç¾¤å†…éƒ¨çš„æ¯ä¸€ä¸ª Primary å’Œ ReplicaèŠ‚ç‚¹ **</p>
</li>
<li><p>ElastiCache parameter groups<br>Cache parameter groups are an easy way to manage runtime settings for supported engine software. Parameters are used to control memory usage, eviction policies, item sizes, and more.</p>
<p>ç®€å•æ¥è¯´ï¼Œ åˆ›å»ºæ¯ä¸€ä¸ªé…ç½®æ–‡ä»¶åœ¨awsçš„æ§åˆ¶å°ä¸Šï¼Œ å¯ä»¥è°ƒæ•´ä¸€éƒ¨åˆ†Redisçš„å‚æ•°ï¼Œ ç„¶åå¯èƒ½åœ¨é›†ç¾¤å†…å¯ä»¥å®æ—¶ç”Ÿæ•ˆï¼Œ ä¹Ÿå¯èƒ½éœ€è¦è§¦å‘ä¸€æ¬¡Failoveræ‰èƒ½ç”Ÿæ•ˆã€‚<br><a href="https://docs.aws.amazon.com/zh_cn/AmazonElastiCache/latest/red-ug/ParameterGroups.html">elasticacheçš„å‚æ•°ç®¡ç†</a> </p>
<p>é€šå¸¸æ¥è¯´ï¼Œ æ”¹åŠ¨äº†å‚æ•°ç»„ä¸­çš„å‡ ä¸ªå‚æ•°å¯èƒ½ä¼šéœ€è¦é‡å¯èŠ‚ç‚¹ï¼š </p>
<ul>
<li>activerehashing</li>
<li>databases</li>
</ul>
</li>
<li><p>ElastiCache for Redis security<br>PENDINGâ€¦ Maybe follow offical guide.</p>
</li>
<li><p>ElastiCache security groups<br>åˆ›å»ºé›†ç¾¤çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€ä¸ªå®‰å…¨ç»„ï¼Œ éœ€è¦æ”¾è¡Œ 6379 portï¼Œ DONEã€‚</p>
</li>
<li><p>ElastiCache subnet groups<br>å­ç½‘ç»„æ˜¯è¿è¡Œ Redis çš„æ‰€æœ‰å­ç½‘çš„é›†åˆï¼Œ åˆ›å»ºä¸€ä¸ªå­ç½‘ï¼Œ è®©æ‰˜ç®¡çš„èŠ‚ç‚¹çš„æŠŠENIæ”¾åœ¨è¿™ä¸ªå­ç½‘é‡Œé¢ï¼Œ ç§æœ‰å­ç½‘ã€‚ </p>
</li>
<li><p>ElastiCache for Redis backups<br>å¤‡ä»½ç‰¹å®šæ—¶é—´çš„æ•°æ®ï¼Œ å¯ä»¥ä½¿ç”¨è¿™ä¸ªç”¨æ¥è¿˜åŸæˆæ–°çš„é›†ç¾¤ï¼Œ æˆ–è€…æ˜¯åˆ›å»ºä¸€ä¸ªé›†ç¾¤çš„ç§å­ï¼Œ å¤‡ä»½ä¸­åŒ…æ‹¬æ‰€æœ‰çš„dataï¼Œ å’Œä¸€éƒ¨åˆ†é›†ç¾¤çš„metadataã€‚<br>bgsave æˆ–è€… forkless save, è¿™ä¸¤ä¸ªå–å†³äºæ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œ å½“ç©ºé—´å……è¶³çš„æ—¶å€™ä½¿ç”¨çš„é»˜è®¤çš„ bgsaveï¼Œ ä½†æ˜¯è‚¯å®šçš„æ˜¯ï¼Œ bhsave ä¼šæœ‰æ€§èƒ½çš„å¼€é”€ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ä½¿ç”¨å‰¯æœ¬èŠ‚ç‚¹æ¥åˆ›å»ºå¤‡ä»½æˆ–è€…å¿«ç…§ã€‚<br>å¯¹äºforklessæœ¬èº«æ˜¯å¦ä¸€ä¸ªæœºåˆ¶ï¼Œä½†æ˜¯forklessä¼šå°è¯•delay å†™å…¥çš„å»¶è¿Ÿï¼Œä»è€Œç¡®ä¿ä¸ä¼šç§¯ç´¯è¿‡å¤šçš„change å¯¼è‡´å†…å­˜å‹åŠ›è¿‡å¤§å¤±è´¥ã€‚ </p>
</li>
<li><p>ElastiCache events<br>PENDINGâ€¦ Maybe follow offical guide.</p>
</li>
</ol>
<h2 id="Redis-ç¼“å­˜ç©¿é€ï¼Œ-å‡»ç©¿-å’Œ-é›ªå´©"><a href="#Redis-ç¼“å­˜ç©¿é€ï¼Œ-å‡»ç©¿-å’Œ-é›ªå´©" class="headerlink" title="Redis ç¼“å­˜ç©¿é€ï¼Œ å‡»ç©¿ å’Œ é›ªå´©"></a>Redis ç¼“å­˜ç©¿é€ï¼Œ å‡»ç©¿ å’Œ é›ªå´©</h2><h3 id="ç©¿é€"><a href="#ç©¿é€" class="headerlink" title="ç©¿é€"></a>ç©¿é€</h3><p>ä¸»è¦æ˜¯æŒ‡å¼‚å¸¸çš„æŸ¥è¯¢è¯·æ±‚ï¼Œ ç¼“å­˜æœªå‘½ä¸­çš„åœºæ™¯ä¸‹ç›´æ¥è®¿é—®åç«¯ï¼Œ åç«¯æ‰¿è½½äº†å¤§é‡è¯·æ±‚å¯¼è‡´çš„å´©æºƒã€‚<br>ç›®å‰çœ‹åˆ°éœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š </p>
<ul>
<li>æ•°æ®åœ¨ç¼“å­˜å±‚æœªå‘½ä¸­ã€‚ </li>
<li>å¤§é‡çš„è¯·æ±‚è½¬ç§»åˆ°äº†åç«¯ã€‚</li>
<li>è¯·æ±‚çš„æ•°æ®å¯èƒ½åœ¨ç¼“å­˜å±‚ ä»¥åŠ åç«¯éƒ½ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>é¿å…çš„æ–¹æ³•å¯èƒ½æœ‰ï¼š</p>
<ul>
<li>åœ¨redis å‰é¢æ·»åŠ ä¸€ä¸ª BloomFilterï¼Œ åœ¨è¯·æ±‚è¿›æ¥çš„æ—¶å€™è¿›è¡Œè¿‡æ»¤ï¼Œ å¯¹äºå¼‚å¸¸çš„è¯·æ±‚ç›´æ¥æ‹’ç»æˆ–è€…è¿”å›ä¸€ä¸ªNULLã€‚</li>
<li>æå‰ç¼“å­˜ä¸€éƒ¨åˆ†æ•°å€¼ä¸º NULL çš„æ•°æ®ï¼Œ åœ¨ç¼“å­˜å±‚ç›´æ¥æ¥ä¸‹è¿™äº›è¯·æ±‚ã€‚è¿™ä¸ªæœ¬èº«æ˜¯æœ‰ç‚¹é—®é¢˜çš„ã€‚</li>
</ul>
<h3 id="å‡»ç©¿"><a href="#å‡»ç©¿" class="headerlink" title="å‡»ç©¿"></a>å‡»ç©¿</h3><p>è¿™ä¸ªæ¦‚å¿µæ˜¯æŒ‡çš„ <strong>å°‘éƒ¨åˆ†çƒ­ç‚¹æ•°æ®</strong>è¢«å¤§é‡çš„æŸ¥è¯¢æ—¶å€™ï¼Œ  æ•°æ®çªç„¶ä»ç¼“å­˜ä¸­æ¶ˆå¤±ï¼Œ å¯èƒ½æ˜¯è¿‡æœŸä¹Ÿå¯èƒ½åˆ é™¤ç­‰ç­‰ï¼Œ è¿™æ ·æœ‰å¤§é‡çš„<strong>ç›¸åŒè¯·æ±‚</strong>å‘é€åˆ°åç«¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š </p>
<ul>
<li>è®¾ç½®éƒ¨åˆ†æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚ </li>
<li>åç«¯è¿›è¡ŒåŠ åˆ†å¸ƒå¼é”ã€‚</li>
</ul>
<h3 id="é›ªå´©"><a href="#é›ªå´©" class="headerlink" title="é›ªå´©"></a>é›ªå´©</h3><p><strong>æ‰¹é‡çš„çƒ­æ•°æ®è¿‡æœŸ</strong>ï¼Œ è¿™æ—¶å€™å¤§éƒ¨åˆ†çš„è¯·æ±‚å¯èƒ½è¿˜åœ¨ç»§ç»­å°è¯•æŸ¥è¯¢ä¸åŒçš„æ•°æ®ï¼Œç›´æ¥å°†è¿™äº›è¯·æ±‚å‘é€åˆ°äº†åç«¯çš„æ•°æ®åº“ï¼Œ æ•°æ®åº“å´©äº†ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š </p>
<ul>
<li>åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œ å’Œå‰¯æœ¬æ¥æé«˜å¯ç”¨æ€§ã€‚ </li>
<li>åç«¯åŠ é”é™æµã€‚</li>
<li>è°ƒæ•´è¿‡æœŸæ—¶é—´ï¼Œ è®©ä¸åŒçš„æ•°æ®è¿‡æœŸçš„æ—¶é—´é”™å¼€ï¼Œé˜²æ­¢æ‰¹é‡çš„key ç›¸åŒçš„æ—¶é—´è¿‡æœŸã€‚</li>
</ul>
<blockquote>
<p>æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œ é¿å…ç¼“å­˜åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹å¤±æ•ˆï¼Œ æƒ³å„ç§æ–¹æ³•ä¿æŠ¤ç¼“å­˜çš„å¯ç”¨æ€§ã€‚ </p>
</blockquote>
<h2 id="More-Note"><a href="#More-Note" class="headerlink" title="More Note"></a>More Note</h2><p>COB: Client Output Buffer,   Primary å‘ Replica åŒæ­¥æ•°æ®ä½¿ç”¨ï¼Œ Max Memory æ²¡æœ‰è®¡ç®—è¿™éƒ¨åˆ†çš„å†…å­˜ï¼Œ ä½¿ç”¨çš„æ˜¯Rediså¼•æ“ä¹‹å¤–çš„å†…å­˜ï¼ˆosç®¡ç†çš„å†…å­˜ï¼‰ã€‚ </p>
<p>Policy ï¼š LRU ä¸ä¸¥æ ¼ï¼Œ éšæœºé€‰æ‹©ä¸‰ä¸ªã€‚maxmemory-sample: 3ï¼Œ å¯ä»¥è°ƒå¤§ã€‚ sampleè¶Šå¤§ï¼Œ ä¿¡å·çš„æ—¶é—´è¶Šé•¿ã€‚ </p>
<p>Reclaimç­–ç•¥é‡Œé¢ï¼Œ æ¯ç§’æ‰«æ200ä¸ªkeyï¼Œ å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§çš„è¯ï¼Œ Redisä¼šè¿›å…¥loopé˜¶æ®µï¼Œ åå¤å°è¯•Reclaimåˆ°25% ä»¥ä¸‹ã€‚ </p>
<p>å¯ä»¥å°è¯•ä½¿ç”¨ scan å‘½ä»¤æ‰«æå…¨éƒ¨çš„æ•°æ®ï¼Œ éå†æ‰€æœ‰çš„keyï¼Œè¿™æ ·ä¼šè§¦å‘lazywayä¸»åŠ¨è¿›è¡Œå›æ”¶ã€‚<br>æ‰«æçš„æŒ‡ä»¤ï¼š </p>
<pre class="language-none"><code class="language-none">scan 0 match * count 20000</code></pre>

<p>LRU vs LFU</p>
<hr>
<p>ä¸ºäº†ä¿æŒä¸»ä»ä¸€è‡´ï¼Œ primary ä¸Šè¿‡æœŸæˆ–è€…åˆ é™¤çš„keyï¼Œ ä¼šåŒæ­¥å‘é€ä¸€ä¸ªæ˜¾å¼çš„ delete æŒ‡ä»¤ï¼Œ  è¿™ä¸ªä¼šç»Ÿè®¡åœ¨replicaçš„settypecmdã€‚</p>
<p>snapshoté‡Œé¢çš„æ•°æ®åœ¨æ¢å¤çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥key çš„ttl ï¼Œ å¦‚æœè¶…è¿‡ä¼šç›´æ¥åˆ é™¤ã€‚<br>åœ¨Rediså†…å­˜ä¸ç‰©ç†å†…å­˜mappingç”±æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨ å’Œ æŒ‡å®šçš„å†…å­˜åˆ†é…å™¨è¿›è¡Œå¤„ç†ã€‚</p>
<p>å…³äºInfoæŒ‡ä»¤çš„æ‰€æœ‰å‚æ•°çš„è§£é‡Šï¼š<br><a href="https://redis.io/commands/info/">https://redis.io/commands/info/</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">localhost:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info memory
<span class="token comment"># Memory</span>
used_memory:938464
used_memory_human:916.47K <span class="token comment"># Redis å­˜å‚¨æ•°æ®çš„ä½¿ç”¨é‡</span>
used_memory_rss:10747904
used_memory_rss_human:10.25M <span class="token comment"># Redis å¸¸ä½å†…å­˜é›†çš„ç”¨é‡</span>
used_memory_peak:1134048
used_memory_peak_human:1.08M <span class="token comment"># Redis çš„å†…å­˜å³°å€¼</span>
used_memory_peak_perc:82.75% 
used_memory_overhead:888488
used_memory_startup:865904
used_memory_dataset:49976
used_memory_dataset_perc:68.88%
allocator_allocated:1479168  <span class="token comment"># å†…å­˜åˆ†é…å™¨å·²ç»åˆ†é…çš„é‡</span>
allocator_active:1601536
allocator_resident:4575232 
total_system_memory:8182751232
total_system_memory_human:7.62G <span class="token comment"># ç³»ç»Ÿå†…å­˜çš„æ€»é‡</span>
used_memory_lua:31744
used_memory_vm_eval:31744
used_memory_lua_human:31.00K <span class="token comment"># Lua å¼•æ“çš„å†…å­˜ä½¿ç”¨é‡</span>
used_memory_scripts_eval:0
number_of_cached_scripts:0
number_of_functions:0
number_of_libraries:0
used_memory_vm_functions:32768
used_memory_vm_total:64512
used_memory_vm_total_human:63.00K
used_memory_functions:184
used_memory_scripts:184
used_memory_scripts_human:184B
maxmemory:0  <span class="token comment"># Max Memory å½“å‰çš„é…ç½®</span>
maxmemory_human:0B
maxmemory_policy:noeviction
allocator_frag_ratio:1.08
allocator_frag_bytes:122368
allocator_rss_ratio:2.86
allocator_rss_bytes:2973696
rss_overhead_ratio:2.35
rss_overhead_bytes:6172672
mem_fragmentation_ratio:11.46
mem_fragmentation_bytes:9809640
mem_not_counted_for_evict:0
mem_replication_backlog:0
mem_total_replication_buffers:0
mem_clients_slaves:0
mem_clients_normal:22400
mem_cluster_links:0
mem_aof_buffer:0
mem_allocator:jemalloc-5.3.0
active_defrag_running:0
lazyfree_pending_objects:0
lazyfreed_objects:0
localhost:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">exit</span></code></pre>
<h2 id="å†…å­˜ç»“æ„"><a href="#å†…å­˜ç»“æ„" class="headerlink" title="å†…å­˜ç»“æ„"></a>å†…å­˜ç»“æ„</h2><p>Redisçš„å†…å­˜ä¸­ä¸»è¦æ˜¯å¦‚ä¸‹æ•°æ®ï¼š </p>
<h3 id="ç”¨æˆ·æ•°æ®"><a href="#ç”¨æˆ·æ•°æ®" class="headerlink" title="ç”¨æˆ·æ•°æ®"></a>ç”¨æˆ·æ•°æ®</h3><pre><code>ç”¨æˆ·æ•°æ®æ˜¯ä½œä¸ºå†…å­˜çš„æ•°æ®åº“çš„å…³é”®ï¼Œä¹Ÿæ˜¯å ç”¨Memæœ€å¤šçš„éƒ¨åˆ†ï¼Œ è®¡ç®—åœ¨ used_memory  ä¸­ã€‚ æ•°æ® å’Œ æ•°æ®ç»“æ„ã€‚
</code></pre>
<h3 id="è‡ªèº«è¿›ç¨‹çš„å†…å­˜"><a href="#è‡ªèº«è¿›ç¨‹çš„å†…å­˜" class="headerlink" title="è‡ªèº«è¿›ç¨‹çš„å†…å­˜"></a>è‡ªèº«è¿›ç¨‹çš„å†…å­˜</h3><pre><code>  è¿™éƒ¨åˆ†æ˜¯Redisè‡ªå·±å ç”¨çš„å†…å­˜ï¼Œ ä»£ç ï¼Œ å¸¸é‡æ± ç­‰ç­‰ã€‚
</code></pre>
<h3 id="ç¼“å†²åŒº"><a href="#ç¼“å†²åŒº" class="headerlink" title="ç¼“å†²åŒº"></a>ç¼“å†²åŒº</h3><p><a href="https://www.cnblogs.com/mainwoods/p/15064949.html">ä¸‰å¤§ç¼“å†²åŒº</a><br>    1. å®¢æˆ·ç«¯ç¼“å†²åŒº<br>        1. è¾“å…¥ç¼“å†²åŒº: å®¢æˆ·ç«¯è¾“å…¥æŒ‡ä»¤Bufferï¼Œ è¾“å…¥ç¼“å†²åŒºé»˜è®¤æ˜¯æ¯å®¢æˆ·ç«¯ 1GBï¼Œ ä¸è®¡å…¥maxmemory,  æ— æ³•é…ç½®ã€‚<br>        2. è¾“å‡ºç¼“å†²åŒº: è¿”å›å“åº”ç»“æœçš„Bufferï¼Œ å¯ä»¥è°ƒæ•´è¾“å‡ºç¼“å†²åŒºçš„å¤§å°ã€‚ é€šè¿‡ <code>client-output-buffer-limit</code> é…ç½®<br>        <pre class="language-bash" data-language="bash"><code class="language-bash">client-output-buffer-limit <span class="token operator">&lt;</span>class<span class="token operator">></span> <span class="token operator">&lt;</span>hard limit<span class="token operator">></span> <span class="token operator">&lt;</span>soft limit<span class="token operator">></span> <span class="token operator">&lt;</span>soft seconds<span class="token operator">></span>
client-output-buffer-limit normal <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token comment"># ä¼šè¢«é™åˆ¶åœ¨maxmemoryä¸­</span>
client-output-buffer-limit slave 256mb 64mb <span class="token number">60</span>  <span class="token comment"># ä¸ä¼šé™åˆ¶åœ¨maxmemory</span>
client-output-buffer-limit pubsub 32mb 8mb <span class="token number">60</span>  <span class="token comment"># å®¢æˆ·ä½¿ç”¨Pub/Sub Channel çš„æ—¶å€™ä¼šç”¨ï¼Œ æ¯”è¾ƒå°‘çœ‹åˆ°å®¢æˆ·ä½¿ç”¨</span></code></pre><br>         Usedmemory å¤§äº Maxmemory   åŸå› æ˜¯ SlaveCOB ä¸è®¡ç®— Maxmemoryï¼Œ ä¸ä¼šè§¦å‘Evcationã€‚<br>    2. å¤åˆ¶ç¼“å†²åŒº<br>        1. å¤åˆ¶ç¼“å†²åŒº: ä¸»è¦æ˜¯å…¨é‡å¤åˆ¶çš„æ—¶å€™ä½¿ç”¨çš„ç©ºé—´. ä¸»ä»åŒæ­¥çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ COB ç¼“å†²åŒºã€‚<br>        2. å¤åˆ¶ç§¯å‹ç¼“å†²åŒº:  å¢é‡åŒæ­¥çš„ç¼“å†²åŒºï¼Œ ä½¿ç”¨å‚æ•° <code>repl-backlog-size</code> é…ç½®ï¼Œ æ§åˆ¶æ˜¯å¦æ˜¯å¢é‡æˆ–è€…å…¨é‡åŒæ­¥ã€‚ backlog è¶Šå¤§ï¼Œ è¶Šå®¹æ˜“è¿›è¡Œå¢é‡ã€‚<br>    3. AOF ç¼“å†²åŒºï¼ˆè¿™ç©æ„å„¿å¥½åƒEcacheé‡Œé¢æ²¡æœ‰.<br>        1. AOFç¼“å†²åŒºï¼š å†™AOFæ—¥å¿—å¼‚æ­¥è½åˆ°ç£ç›˜çš„Buffer<br>        3. AOFé‡å†™ç¼“å†²åŒº: AOFé‡å†™æµç¨‹ä¸­ä½¿ç”¨çš„Buffer<br><a href="https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20210621_e018a38e-d26a-11eb-b77e-00163e068ecd.png">https://oss-emcsprod-public.modb.pro/wechatSpider/modb_20210621_e018a38e-d26a-11eb-b77e-00163e068ecd.png</a></p>
<h2 id="å†…å­˜ç¢ç‰‡"><a href="#å†…å­˜ç¢ç‰‡" class="headerlink" title="å†…å­˜ç¢ç‰‡"></a>å†…å­˜ç¢ç‰‡</h2><p>å†…å­˜ç¢ç‰‡æœ‰å¤–éƒ¨ç¢ç‰‡ å’Œ å†…éƒ¨ç¢ç‰‡ï¼š </p>
<ul>
<li>å¤–éƒ¨ç¢ç‰‡æŒ‡osåˆ†é…å†…å­˜çš„æ—¶å€™é€ æˆçš„ç¢ç‰‡ï¼Œ è¿™ä¸ªéƒ¨åˆ†çš„ç¢ç‰‡ä¸»è¦æ˜¯å’Œosç”³è¯·çš„æ—¶å€™æ‰ä¼šå‡ºç°ã€‚ ï¼ˆ æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œ å¦‚æœKeyè¿‡æœŸäº†ï¼Œ é‚£ä¹ˆredisæ˜¯ä¼šå°†å†…å­˜å½’è¿˜ç»™osçš„ï¼Œ é‚£ä¹ˆä¸‹æ¬¡å†ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰æ–°çš„ç¢ç‰‡ã€‚ï¼‰</li>
<li>å†…éƒ¨ç¢ç‰‡æ˜¯ redis ä½¿ç”¨çš„Memory Allocator åˆ†é…é€ æˆçš„ç¢ç‰‡ã€‚ </li>
<li>å‚æ•°ç»„ä¸­å¯ä»¥æœ‰autodefragå‚æ•°å¯ä»¥è§¦å‘Redis ä¸»è¿›ç¨‹çš„å†…å­˜è§„æ•´ã€‚</li>
</ul>
<h1 id="ä¸€äº›å‚æ•°"><a href="#ä¸€äº›å‚æ•°" class="headerlink" title="ä¸€äº›å‚æ•°"></a>ä¸€äº›å‚æ•°</h1><h2 id="Used-Memory"><a href="#Used-Memory" class="headerlink" title="Used Memory"></a>Used Memory</h2><pre class="language-bash" data-language="bash"><code class="language-bash">used_memory:938464
used_memory_human:916.47K</code></pre>

<p>è¿™é‡Œé¢çš„æŒ‡æ ‡åŒ…æ‹¬äº†å¦‚ä¸‹çš„æ•°æ®ï¼š<br>  KeyValue çš„å­˜å‚¨ï¼Œç”¨æˆ·æ•°æ®ã€‚<br>  InternalOverload: å†…éƒ¨å¼€é”€ï¼Œ è¡¨ç¤ºRedisæ”¯æŒçš„æ•°æ®ç±»å‹çš„ä¿¡æ¯ã€‚</p>
<h2 id="RSS"><a href="#RSS" class="headerlink" title="RSS"></a>RSS</h2><pre class="language-bash" data-language="bash"><code class="language-bash">used_memory_rss:10747904
used_memory_rss_human:10.25M

From OS: RSS KB
<span class="token environment constant">USER</span>         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<span class="token number">999</span>         <span class="token number">9694</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>  <span class="token number">55588</span> <span class="token number">10496</span> pts/0    Ssl+ <span class="token number">14</span>:48   <span class="token number">0</span>:00 redis-server *:6379</code></pre>
<p>RSSæŒ‡æ ‡è®°å½•çš„æ˜¯æ“ä½œç³»ç»Ÿå·²ç»åˆ†é…ç»™ RedisInstance çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œ rssçš„è¿™ä¸ªæŒ‡æ ‡è¿˜åŒ…æ‹¬äº†å†…éƒ¨ç¢ç‰‡ã€‚<br>é€ æˆå†…å­˜ç¢ç‰‡çš„åŸå› æ˜¯ï¼šæ“ä½œç³»ç»Ÿä½æ•ˆçš„å†…å­˜åˆ†é…è¡Œä¸ºã€‚</p>
<h2 id="Max-Memory"><a href="#Max-Memory" class="headerlink" title="Max Memory"></a>Max Memory</h2><pre class="language-bash" data-language="bash"><code class="language-bash">maxmemory:1103269725
maxmemory_human:1.03G</code></pre>

<p>Max Memory åŒ…æ‹¬å“ªäº›éƒ¨åˆ†<br>æ ¹æ®Redisçš„æ–‡æ¡£ï¼ŒMaxMemoryçš„é™åˆ¶ä¸»è¦å½±å“ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„å†…å­˜ï¼š</p>
<ul>
<li>Redisä¸­å­˜å‚¨çš„é”®å€¼å¯¹æ•°æ®ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œè¡¨ã€æœ‰åºé›†åˆç­‰ç±»å‹ã€‚</li>
<li>Redisä¸­ä½¿ç”¨çš„æ•°æ®ç»“æ„å’Œå¯¹è±¡ï¼Œä¾‹å¦‚å­—å…¸ã€è·³è·ƒè¡¨ã€å‹ç¼©åˆ—è¡¨ã€æ•´æ•°é›†åˆç­‰ã€‚</li>
</ul>
<p>Ecache çš„MaxMemory æ˜¯åŸºäºèŠ‚ç‚¹ç±»å‹çš„å›ºå®šæ•°å€¼ï¼Œ æ— æ³•ä¿®æ”¹ã€‚</p>
<p>è®¾ç½®MaxMemoryçš„æ–¹æ³•</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">localhost:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> CONFIG GET maxmemory
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"maxmemory"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"100000000"</span>
localhost:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> CONFIG SET maxmemory 2G
OK
localhost:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> CONFIG GET maxmemory
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"maxmemory"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2000000000"</span></code></pre>

<p>åº•å±‚çš„ç‰©ç†å†…å­˜ä¸èƒ½å¾ˆå®¹æ˜“çš„è¢«æ“ä½œç³»ç»Ÿé‡Šæ”¾ï¼Œ å› ä¸ºå¯èƒ½éœ€è¦åˆ é™¤çš„æ•°æ® ä¸ ä¾æ—§æœ‰æ•ˆå¹¶ä½¿ç”¨ä¸­çš„æ•°æ® åœ¨ç›¸åŒçš„ç‰©ç†å†…å­˜é¡µä¸­ã€‚<br>å› æ­¤redisä¼šåœ¨éœ€è¦çš„æ—¶å€™åˆ†é…å†…å­˜ï¼Œ åœ¨å›æ”¶çš„æ—¶å€™è¿›è¡Œç¨‹åºä¾§çš„å›æ”¶ï¼Œ å¹¶ä¸å°†å†…å­˜å®Œå…¨freeç»™æ“ä½œç³»ç»Ÿã€‚å†…å­˜åˆ†é…å™¨ä¼šå°½å¯èƒ½çš„ä½¿ç”¨RSSå·²ç»åˆ†é…ç»™ç¨‹åºçš„å†…å­˜ã€‚<br>å¦‚æœéœ€è¦åšå†…å­˜é¢„ç•™ï¼Œ é‚£ä¹ˆåº”è¯¥åŸºäºå†å²çš„å³°å€¼æ¥è¿›è¡Œè°ƒæ•´ã€‚ </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">used_memory_peak:1134048
used_memory_peak_human:1.08M
used_memory_peak_perc:82.75%</code></pre>

<h2 id="mem-fragmentation-ratio"><a href="#mem-fragmentation-ratio" class="headerlink" title="mem_fragmentation_ratio"></a>mem_fragmentation_ratio</h2><pre class="language-bash" data-language="bash"><code class="language-bash">mem_fragmentation_ratio:11.46
mem_fragmentation_bytes:9809640</code></pre>
<p>Memory Fragmentation Ratio &#x3D; Used Memory RSS &#x2F; Used Memory<br>å†…å­˜ç¢ç‰‡æ¯”ç‡ï¼š<br>Memory Fragmentation Ratio &lt; 1   # è¡¨ç¤ºå·²ç»æœ‰æ•°æ®è¢«å†™å…¥äº¤æ¢åˆ†åŒºï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„æŒ‡æ ‡ã€‚<br>Memory Fragmentation Ratio &gt; 1  # normal<br>Memory Fragmentation Ratio &gt; 1.5   # normal</p>
<p>æŒ‡æ ‡è®¡ç®—çš„æ–¹å¼å¯¼è‡´å¯èƒ½å¹¶ä¸èƒ½å‡†ç¡®çš„ä½“ç°å‘ç”Ÿçš„é—®é¢˜ï¼Œ ç°åœ¨æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬æ›´åŠ æ¨èæŸ¥çœ‹ä¸‹é¢çš„æŒ‡æ ‡ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">allocator_frag_ratio:1.08
allocator_frag_bytes:122368
allocator_rss_ratio:2.86
allocator_rss_bytes:2973696</code></pre>

<h3 id="è§£å†³å†…å­˜ç¢ç‰‡çš„æ–¹æ³•"><a href="#è§£å†³å†…å­˜ç¢ç‰‡çš„æ–¹æ³•" class="headerlink" title="è§£å†³å†…å­˜ç¢ç‰‡çš„æ–¹æ³•"></a>è§£å†³å†…å­˜ç¢ç‰‡çš„æ–¹æ³•</h3><ol>
<li>Restart Redis. </li>
<li>ä¿®æ”¹å‚æ•°ï¼Œ æ¿€æ´»Redisçš„è‡ªåŠ¨ç¢ç‰‡æ•´ç†åœ¨å‚æ•°ç»„ä¸­å¼€å¯ã€‚<strong>activedefrag</strong> å¼€å¯è¿™ä¸ªå‚æ•°å¯èƒ½ä¼šé€ æˆå»¶è¿Ÿå˜é«˜ï¼Œ ç”±äºå†…å­˜çš„æ•´ç†ä¹Ÿæ˜¯éœ€è¦åœ¨å†…å­˜ä¸­è¿›è¡Œæ•°æ®è¿ç§»å’Œè°ƒæ•´çš„ã€‚<br><em>3.  Limit memory swapping( è¿™ä¸ªæ²¡çœ‹æ‡‚ã€‚</em></li>
<li>æ”¹å˜å†…å­˜åˆ†é…å™¨ï¼ˆ æŒ‡å‡çº§Redisçš„ç‰ˆæœ¬</li>
</ol>
<p>æˆ–è€…<br>å½“å­˜å‚¨çš„æ•°æ®é•¿çŸ­å·®å¼‚è¾ƒå¤§æ—¶ï¼Œ ä»¥ä¸‹åœºæ™¯å®¹æ˜“å‡ºç°é«˜å†…å­˜ç¢ç‰‡é—®é¢˜ï¼š</p>
<ul>
<li>é¢‘ç¹åšæ›´æ–°æ“ä½œï¼Œ ä¾‹å¦‚é¢‘ç¹å¯¹å·²å­˜åœ¨çš„é”®æ‰§è¡Œappendã€ setrangeç­‰æ›´æ–°æ“ä½œã€‚</li>
<li>å¤§é‡è¿‡æœŸé”®åˆ é™¤ï¼Œ é”®å¯¹è±¡è¿‡æœŸåˆ é™¤åï¼Œ é‡Šæ”¾çš„ç©ºé—´æ— æ³•å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œ å¯¼è‡´ç¢ç‰‡ç‡ä¸Šå‡ã€‚</li>
</ul>
<p>å‡ºç°é«˜å†…å­˜ç¢ç‰‡é—®é¢˜æ—¶å¸¸è§çš„è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ•°æ®å¯¹é½ï¼š åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹å°½é‡åšæ•°æ®å¯¹é½ï¼Œ æ¯”å¦‚æ•°æ®å°½é‡é‡‡ç”¨æ•°å­—ç±»å‹æˆ–è€…å›ºå®šé•¿åº¦å­—ç¬¦ä¸²ç­‰ï¼Œ ä½†æ˜¯è¿™è¦è§†å…·ä½“çš„ä¸šåŠ¡è€Œå®šï¼Œ æœ‰äº›åœºæ™¯æ— æ³•åšåˆ°ã€‚</li>
<li>å®‰å…¨é‡å¯ï¼š é‡å¯èŠ‚ç‚¹å¯ä»¥åšåˆ°å†…å­˜ç¢ç‰‡é‡æ–°æ•´ç†ï¼Œ å› æ­¤å¯ä»¥åˆ©ç”¨é«˜å¯ç”¨æ¶æ„ï¼Œ å¦‚Sentinelæˆ–Clusterï¼Œ å°†ç¢ç‰‡ç‡è¿‡é«˜çš„ä¸»èŠ‚ç‚¹è½¬æ¢ä¸ºä»èŠ‚ç‚¹ï¼Œ è¿›è¡Œå®‰å…¨é‡å¯ã€‚</li>
</ul>
<h1 id="å†…å­˜é©±é€"><a href="#å†…å­˜é©±é€" class="headerlink" title="å†…å­˜é©±é€"></a>å†…å­˜é©±é€</h1><p>å½“ Redis å†…å­˜ä½¿ç”¨è¾¾åˆ°Â <code>maxmemory</code> æ—¶ï¼Œéœ€è¦é€‰æ‹©è®¾ç½®å¥½çš„Â <code>maxmemory-policy</code>Â è¿›è¡Œå¯¹è€æ•°æ®çš„ç½®æ¢ã€‚</p>
<p>ä¸‹é¢æ˜¯å¯ä»¥é€‰æ‹©çš„ç½®æ¢ç­–ç•¥ï¼š<br>The following policies are available:<br>    noevictionï¼š è¾¾åˆ°å†…å­˜é™åˆ¶æ—¶ä¸ä¿å­˜æ–°å€¼ã€‚å½“æ•°æ®åº“ä½¿ç”¨å¤åˆ¶æ—¶ï¼Œè¿™é€‚ç”¨äºä¸»æ•°æ®åº“<br>    allkeys-lruï¼š ä¿ç•™æœ€è¿‘ä½¿ç”¨çš„é”®å€¼ï¼›åˆ é™¤æœ€è¿‘ä½¿ç”¨æœ€å°‘ï¼ˆLRUï¼‰çš„é”®å€¼<br>    allkeys-lfuï¼š ä¿ç•™ç»å¸¸ä½¿ç”¨çš„keyï¼›åˆ é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨ï¼ˆLFUï¼‰çš„key<br>    volatile-lruï¼š åˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸º true çš„æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚<br>    volatile-lfuï¼š åˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸º true çš„æœ€ä¸å¸¸ç”¨keyã€‚<br>    allkeys-randomï¼š éšæœºåˆ é™¤keyï¼Œä¸ºæ–°æ·»åŠ çš„æ•°æ®è…¾å‡ºç©ºé—´ã€‚<br>    volatile-randomï¼š éšæœºåˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸º true çš„keyã€‚<br>    volatile-ttlï¼š åˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸º true ä¸”å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰å€¼æœ€çŸ­çš„keyã€‚</p>
<p>å¦‚æœæ²¡æœ‰æŒ‡å®šTTLï¼Œ é‚£ä¹ˆvolatileçš„é©±é€è§„åˆ™å°±ç›¸å½“äº noeviction.</p>
<p>keyè¿‡æœŸå›æ”¶<br>Redisæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>Lazy Wayï¼š å½“è¯·æ±‚è¿™ä¸ªkey å‘ç°ä»–å·²ç»è¿‡æœŸçš„æ—¶å€™ï¼Œ æ¸…ç†ã€‚</li>
<li>Active Way:  æ¯100msè¿‡æœŸä¸€å°éƒ¨åˆ†keyã€‚</li>
</ol>
<p>ä¸»åŠ¨è¿‡æœŸçš„æ–¹å¼æ¯100msæ‰«æ20ä¸ªkeyï¼ˆå¸¦æœ‰ TTL çš„ï¼‰ï¼Œ ä¹Ÿå°±æ˜¯æ¯ç§’å¯ä»¥æ‰«æ200ä¸ªkeyæ ‡è®°ä¸ºè¿‡æœŸã€‚å¦‚æœä¾æ—§æœ‰è¶…è¿‡25%çš„keyè¢«æ ‡è®°ä¸ºè¿‡æœŸï¼Œé‚£ä¹ˆå°±å†æ¥ä¸€æ¬¡ã€‚</p>
<p>å¦‚æœè¿‡æœŸçš„æ—¶é—´æ¯”è¾ƒåˆç†ï¼Œ é‚£ä¹ˆå¤§çº¦ä¼šæœ‰25% å·¦å³çš„keyå¤„äºè¿‡æœŸçš„çŠ¶æ€ã€‚ </p>
<p>å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤æ¥å°è¯•è®¿é—®keyï¼Œscanåˆ°çš„keyå¦‚æœå·²ç»è¿‡æœŸä¼šè¢«å›æ”¶ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">SCAN <span class="token number">0</span> MATCH *example* COUNT <span class="token number">20000</span></code></pre>

<p>é¢„ç•™å†…å­˜ï¼š é€šå¸¸æ˜¯ 25% ï¼Œ ä¿ç•™ç”¨æ¥è¿›è¡Œå¤‡ä»½ï¼Œ bgsave æ¥ä½¿ç”¨ã€‚ </p>
<h1 id="äº¤æ¢"><a href="#äº¤æ¢" class="headerlink" title="äº¤æ¢"></a>äº¤æ¢</h1><p>å†…æ ¸ä½¿ç”¨äº¤æ¢ç©ºé—´çš„ä¸¤ä¸ªæƒ…å†µï¼š</p>
<ol>
<li>ç³»ç»Ÿå¤„äºå†…å­˜å‹åŠ›ä¸‹ã€‚</li>
<li>æœ‰äº›å†…å­˜é¡µé¢å·²ç»å¾ˆé•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®äº†ï¼Œ å†…æ ¸ä¼šå°†è¿™äº›é¡µé¢æ”¾å…¥äº¤æ¢ä¸­ï¼Œé€šå¸¸åœ¨Redisä¸Šä¸ä¼šå‘ç”Ÿã€‚</li>
</ol>
<p>å¯èƒ½å¯¼è‡´ä½¿ç”¨swapçš„åœºæ™¯ï¼š </p>
<ol>
<li>éœ€è¦å­˜å‚¨çš„æ•°æ®è¶…è¿‡ç‰©ç†å†…å­˜çš„æ€»é‡ï¼Œ æˆ–è€…ç”±äºCOBçš„ä½¿ç”¨ç‡è¿‡é«˜ã€‚</li>
<li>é«˜å†…å­˜ç¢ç‰‡ã€‚</li>
<li>è¾ƒé«˜çš„è¿æ¥æ•°ã€‚</li>
<li>ç³»ç»Ÿè¿›ç¨‹æˆ–è€…RBD AOFå†™å…¥å¤§æ–‡ä»¶ï¼Œ ç»™ç³»ç»Ÿå¢åŠ äº†å‹åŠ›ï¼Œ å¯¼è‡´ä½¿ç”¨äº†äº¤æ¢åˆ†åŒºã€‚</li>
</ol>
<p>é€šå¸¸æƒ…å†µä½¿ç”¨äº¤æ¢æ˜¯ä¸€å®šä¼šå‘ç”Ÿçš„ï¼Œ å¹¶ä¸”æ˜¯æ­£å¸¸çš„ï¼Œ ä¸ä¼šå¯¼è‡´æ€§èƒ½çš„ä¸‹é™ï¼Œ å› ä¸ºswapæŒ‡æ ‡æ”¶é›†çš„æ˜¯æ“ä½œç³»ç»ŸæŒ‡æ ‡ï¼Œ åŒ…æ‹¬éRediså†…çš„æ•°æ®è¢«æ¢å‡ºçš„æƒ…å†µï¼Œ é€šå¸¸å¯ä»¥ä½¿ç”¨ maxmemory_human  å¤§äº used_memory_rss_human  æ¥è¿›è¡Œåˆ¤æ–­ï¼Œ æˆ–è€…æ˜¯ å†…å­˜ç¢ç‰‡ mem_fragmentation_ratio å°äº 1. </p>
<p>Refer:</p>
<ol>
<li><a href="https://www.jianshu.com/p/d39f087850c9">https://www.jianshu.com/p/d39f087850c9</a></li>
<li>Understand VMM: <a href="https://www.kernel.org/doc/gorman/html/understand/">https://www.kernel.org/doc/gorman/html/understand/</a></li>
<li>Understand Memory Fragmention: <a href="https://jacktang816.github.io/post/memoryfragmentation/">https://jacktang816.github.io/post/memoryfragmentation/</a></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Database, Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>EBSæ€§èƒ½ä¼˜åŒ–</title>
    <url>/2023/08/16/Linux/EBS_performance-tuning-advise/</url>
    <content><![CDATA[<h2 id="EBSæ€§èƒ½ä¼˜åŒ–"><a href="#EBSæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="EBSæ€§èƒ½ä¼˜åŒ–"></a>EBSæ€§èƒ½ä¼˜åŒ–</h2><p>Agenda</p>
<ol>
<li>ç£ç›˜è°ƒä¼˜æ–¹æ³•è®º</li>
<li>å¸¸ç”¨çš„ç£ç›˜è°ƒä¼˜æ–¹æ³•</li>
<li>ç£ç›˜å‹æµ‹å·¥å…·</li>
<li>ç£ç›˜æ€§èƒ½æ£€æµ‹å·¥å…·</li>
</ol>
<p>ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ GP3ã€‚ </p>
<h2 id="æ–¹æ³•è®º"><a href="#æ–¹æ³•è®º" class="headerlink" title="æ–¹æ³•è®º"></a>æ–¹æ³•è®º</h2><p>åº”ç”¨ç¨‹åº â€“ã€‹ æ“ä½œç³»ç»Ÿ â€“ã€‹ è™šæ‹Ÿæœº â€“ã€‹ EBS æœåŠ¡å™¨</p>
<p>åº”ç”¨ç¨‹åºIOè¯·æ±‚ä¸‹å‘çš„è·¯å¾„ã€‚</p>
<p>ä¸‰ä¸ªæ–¹å‘ï¼Œ iopsï¼Œ å¸¦å®½ï¼Œ å»¶è¿Ÿï¼ŒæŒ‰ç…§è¿™ä¸‰ä¸ªæ–¹é¢æ¥è§‚å¯Ÿè¿™ä¸ªEBSæœ¬èº«çš„æ€§èƒ½ã€‚ </p>
<h3 id="ä½¿ç”¨æ–°ç‰ˆæœ¬çš„å†…æ ¸ï¼š"><a href="#ä½¿ç”¨æ–°ç‰ˆæœ¬çš„å†…æ ¸ï¼š" class="headerlink" title="ä½¿ç”¨æ–°ç‰ˆæœ¬çš„å†…æ ¸ï¼š"></a>ä½¿ç”¨æ–°ç‰ˆæœ¬çš„å†…æ ¸ï¼š</h3><ol>
<li>3.8 ä»¥ä¸Šå†…æ ¸ä½¿ç”¨çš„Indirect descriptors</li>
<li>çªç ´ I&#x2F;O size 44kiBé™åˆ¶ï¼Œ å¯ä»¥ä¸€æ¬¡è¯·æ±‚ä¸‹å‘ 128KiBçš„IOå¤§å°ã€‚</li>
<li>å»ºè®®ä½¿ç”¨ amazonlinux 2023 ï¼ˆæ‚²</li>
<li>uname -r æŸ¥çœ‹å†…æ ¸çš„ç‰ˆæœ¬ã€‚</li>
</ol>
<h3 id="ä½¿ç”¨-Raid0"><a href="#ä½¿ç”¨-Raid0" class="headerlink" title="ä½¿ç”¨ Raid0"></a>ä½¿ç”¨ Raid0</h3><p>ä½¿ç”¨ Raid0 å¯ä»¥æé«˜å¸¦å®½ï¼Œ å¹¶ä¸”èŠ‚çœæˆæœ¬ã€‚</p>
<ol>
<li>èƒ½æ›´æ¢ç£ç›˜ç±»å‹è¾¾åˆ°æ€§èƒ½ï¼Œ å¯ä»¥ä½¿ç”¨Raid0 </li>
<li>ä¸å»ºè®®åœ¨EBS åš Raid1 5 6 ä¸‰ç§ï¼Œ æ ¡éªŒçš„æ–¹å¼ä¼šé™ä½æ€§èƒ½ã€‚</li>
<li>æ¨èä½¿ç”¨ mdadm ï¼Œ ä¸ä¸€å®šè¦ç”¨LVMã€‚</li>
</ol>
<h3 id="å…³æ³¨é˜Ÿåˆ—é•¿åº¦"><a href="#å…³æ³¨é˜Ÿåˆ—é•¿åº¦" class="headerlink" title="å…³æ³¨é˜Ÿåˆ—é•¿åº¦"></a>å…³æ³¨é˜Ÿåˆ—é•¿åº¦</h3><p>SSDï¼š æ¯ 1000iops é˜Ÿåˆ—é•¿åº¦æ˜¯ 1 ï¼Œ SSDæ˜¯åˆé€‚çš„å§</p>
<p>â€‹      è§‚å¯Ÿé˜Ÿåˆ—é•¿åº¦ï¼Œ å¦‚æœèƒ½è¾¾åˆ° IOPS çš„æƒ…å†µä¸‹ï¼Œ é˜Ÿåˆ—è¶Šä½è¶Šå¥½ã€‚</p>
<p>HDDï¼š 1MiBçš„IOsize ï¼Œ å»ºè®®çš„é˜Ÿåˆ—é•¿åº¦ 4</p>
<p>â€‹      é™ä½ioé˜Ÿåˆ—çš„æ–¹æ³•,å–å†³äºå‘é€IOçš„é€Ÿåº¦å’Œçº¿ç¨‹æ•°é‡ã€‚ æˆ–è€…æé«˜ç£ç›˜çš„IOPS</p>
<h3 id="HDDååé‡è®¾è®¡å¢åŠ é¢„è¯»å–å¤§å°"><a href="#HDDååé‡è®¾è®¡å¢åŠ é¢„è¯»å–å¤§å°" class="headerlink" title="HDDååé‡è®¾è®¡å¢åŠ é¢„è¯»å–å¤§å°"></a>HDDååé‡è®¾è®¡å¢åŠ é¢„è¯»å–å¤§å°</h3><p>For st1&#x2F;sc1. </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">blockdev <span class="token parameter variable">--report</span> /dev/nvme1n1 <span class="token comment"># æŸ¥çœ‹å—è®¾å¤‡çš„å‚æ•°</span>
blockdev <span class="token parameter variable">--setra</span> <span class="token number">2048</span> /dev/nvme1n1  <span class="token comment"># è®¾ç½®å—è®¾å¤‡é¢„è¯»å–æ•°æ®é‡çš„å¤§å°</span>
blockdev <span class="token parameter variable">--getra</span> /dev/nvme1n1 <span class="token comment"># æŸ¥çœ‹å‚æ•°æ˜¯å¦ç”Ÿæ•ˆã€‚</span></code></pre>

<p>è¿™ä¸ªéƒ¨åˆ†æ˜¯ä¸ºäº†å¢åŠ ååé‡è€Œåœ¨Readçš„åŒæ—¶å°†åé¢çš„ä¸€éƒ¨åˆ†æ•°æ®è¯»å–è¿›å…¥å†…å­˜ï¼Œ è¿™æ ·å¯ä»¥æé«˜é¡ºåºè¯»å–çš„æ•ˆç‡ï¼Œ æé«˜è¯»å–çš„æ•ˆç‡ï¼Œ è®©é¡ºåºè¯»å–çš„ä¸šåŠ¡æ•°æ®æå‰è¿›å…¥å†…å­˜ã€‚</p>
<h3 id="ä½¿ç”¨-Nitro-æ¶æ„å®ä¾‹"><a href="#ä½¿ç”¨-Nitro-æ¶æ„å®ä¾‹" class="headerlink" title="ä½¿ç”¨ Nitro æ¶æ„å®ä¾‹"></a>ä½¿ç”¨ Nitro æ¶æ„å®ä¾‹</h3><ul>
<li><p>ä¹‹å‰ä½¿ç”¨zençš„æ—¶å€™æœ‰ä¸€ä¸ªDom0æ¥è¿›è¡Œå®ä¾‹çš„ç®¡ç†ã€‚ nitro åšæˆ Hardwareï¼Œ nitro ç®¡ç†VPCç­‰ç­‰ç­‰ï¼Œ å°½å¯èƒ½æŠŠ X86 è¿‡åº¦ç»™å®¢æˆ·æ¥ä½¿ç”¨ã€‚</p>
<p>Refer toï¼š <a href="https://zhuanlan.zhihu.com/p/270522703">https://zhuanlan.zhihu.com/p/270522703</a></p>
</li>
<li><p>å¼€å¯EBSä¼˜åŒ–é€‰é¡¹ã€‚ éä¼˜åŒ–çš„åœºæ™¯ä¸‹ï¼Œä¼šä¸ç½‘ç»œè¯·æ±‚å…±äº«å¸¦å®½ï¼Œ EBSä¼˜åŒ–è¿™ä¸ªåŠŸèƒ½å•ç‹¬éš”ç¦»äº†EBSçš„ç½‘ç»œè¯·æ±‚ã€‚</p>
</li>
</ul>
<h3 id="ä½¿ç”¨æ­£ç¡®çš„å®ä¾‹ç±»å‹"><a href="#ä½¿ç”¨æ­£ç¡®çš„å®ä¾‹ç±»å‹" class="headerlink" title="ä½¿ç”¨æ­£ç¡®çš„å®ä¾‹ç±»å‹"></a>ä½¿ç”¨æ­£ç¡®çš„å®ä¾‹ç±»å‹</h3><p>å…³æ³¨å®ä¾‹çš„é™åˆ¶ï¼Œ ä¾‹å¦‚å®ä¾‹çš„ä¸Šé™æ˜¯ 14000 ï¼Œ é‚£ä¹ˆå®ä¾‹ä½¿ç”¨EBSçš„ç“¶é¢ˆä¸åœ¨ç£ç›˜æœ¬èº«ï¼Œ åœ¨å®ä¾‹çš„æ€§èƒ½ä¸Šé™ã€‚</p>
<h2 id="å‹æµ‹å·¥å…·"><a href="#å‹æµ‹å·¥å…·" class="headerlink" title="å‹æµ‹å·¥å…·"></a>å‹æµ‹å·¥å…·</h2><ul>
<li><p>dd </p>
</li>
<li><p>hdparm </p>
</li>
<li><p>sysbench</p>
</li>
<li><p>iometer</p>
</li>
<li><p>iozone</p>
</li>
</ul>
<p>æ¨èfio </p>
<p><a href="https://fio.readthedocs.io/en/latest/fio_doc.html">https://fio.readthedocs.io/en/latest/fio_doc.html</a></p>
<p>ebsè®¾ç½®é»˜è®¤çš„ Block Sizeæ˜¯ 16k ï¼Œ å…¶ä»–å‚å•†å¯èƒ½æ˜¯ 4kçš„ã€‚ è¿™ä¸ªéƒ¨åˆ†å¯èƒ½ä¼šåœ¨æµ‹è¯•çš„æ—¶å€™é€ æˆå·®å¼‚ã€‚ </p>
<h3 id="æµ‹è¯•å‘½ä»¤"><a href="#æµ‹è¯•å‘½ä»¤" class="headerlink" title="æµ‹è¯•å‘½ä»¤"></a>æµ‹è¯•å‘½ä»¤</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># è¿™ä¸ªå‘½ä»¤çš„è¿è¡Œç»“æœæ˜¯ï¼Œ ä¸€ä¸ª job åœ¨ iodepth ä¸º 1 çš„æ—¶å€™ï¼Œ å†™å…¥ä¸åº•å±‚ä¸€æ ·çš„å—å¤§å°ï¼Œåœ¨iostat ä¸­å¯ä»¥çœ‹åˆ°  avgqu-zs çš„å¤§å°æ˜¯ 1ã€‚</span>
<span class="token comment"># æ·»åŠ ä¸€ä¸ªprocessä¹‹åï¼Œ é˜Ÿåˆ—çš„size å˜æˆäº†2 ï¼› æ·»åŠ ä¸€ä¸ª iodepth ä¹‹åï¼Œ é˜Ÿåˆ—çš„å¤§å°ä¸º 1 ~ 2 ä¹‹é—´ã€‚ </span>
<span class="token comment"># å¤§ä½¬è®¤ä¸ºå†…æ ¸çš„è“„æµå°†è¯·æ±‚åˆå¹¶äº†ï¼Œ æ‰€ä»¥æ²¡æœ‰é€ æˆå¯¹åº”çš„å‹åŠ›ã€‚ </span>

fio <span class="token parameter variable">--directory</span><span class="token operator">=</span>/mnt <span class="token parameter variable">--name</span> fio_test_file <span class="token parameter variable">--ioengine</span><span class="token operator">=</span>libaio <span class="token parameter variable">--direct</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--rw</span><span class="token operator">=</span>read <span class="token parameter variable">--rate_iops</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--bs</span><span class="token operator">=</span>16k <span class="token parameter variable">--size</span><span class="token operator">=</span>200M <span class="token parameter variable">--iodepth</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--numjobs</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--time_based</span> <span class="token parameter variable">--runtime</span><span class="token operator">=</span><span class="token number">600</span> <span class="token parameter variable">--group_reporting</span> <span class="token parameter variable">--norandommap</span>
</code></pre>

<p>perf record -g result (libaio):</p>
<pre class="language-ini" data-language="ini"><code class="language-ini">fio 319375 86964.196578:     250000 cpu-clock:pppH:
        ffffffff88355470 put_dec+0x0 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff8835584b number+0x33b (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff8835ac9d vsnprintf+0x44d (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff8835afe2 sprintf+0x62 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87efc94c dev_show+0x2c (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87efbc6c dev_attr_show+0x1c (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87abac9b sysfs_kf_seq_show+0xab (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87a2a7a3 seq_read_iter+0x123 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff879f4c06 vfs_read+0x1f6 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff879f59ff ksys_read+0x6f (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff88364360 do_syscall_64+0x60 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff884000f3 entry_SYSCALL_64+0xb3 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
                  103fdc read+0x4c (/usr/lib/libc.so.6)
                       0 [unknown] ([unknown])</code></pre>

<p>perf record -g result (psync):</p>
<pre class="language-ini" data-language="ini"><code class="language-ini">fio 324148 87167.271746:     250000 cpu-clock:pppH:
        ffffffff8835480c strlen+0xc (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87a2990b seq_puts+0x1b (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87aa94ee render_sigset_t+0x1e (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87aa9c96 proc_pid_status+0x716 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87aa1e34 proc_single_show+0x54 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87a2a7a3 seq_read_iter+0x123 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff87a2abe4 seq_read+0xd4 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff879f4abc vfs_read+0xac (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff879f59ff ksys_read+0x6f (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff88364360 do_syscall_64+0x60 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
        ffffffff884000f3 entry_SYSCALL_64+0xb3 (/lib/modules/6.4.10-arch1-1/build/vmlinux)
                  103fa1 read+0x11 (/usr/lib/libc.so.6)
                       0 [unknown] ([unknown])</code></pre>

<h2 id="è§‚æµ‹"><a href="#è§‚æµ‹" class="headerlink" title="è§‚æµ‹"></a>è§‚æµ‹</h2><p>[[Linux_iostat|Linux_iostat]]<br>å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥è§‚å¯Ÿç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼Œ ç£ç›˜çš„ä½¿ç”¨ç‡å…¶å®å¹¶ä¸å¤ªå‡†ç¡®ï¼Œè¿™ä¸ªè¡¨ç¤ºå•ä½æ—¶é—´å†…cpuæ—¶é—´è¢«ioè¯·æ±‚å ç”¨çš„æ—¶é—´ã€‚ </p>
<p>ä¸ªåˆ«çš„ 10ms ä¹‹ä¸Šçš„IOè¯·æ±‚çš„é•¿å°¾ç°è±¡æ˜¯æ­£å¸¸çš„ï¼Œ è¿™ä¸ªæ— æ³•é¿å…ã€‚</p>
<p>å…³äºé•¿å°¾ç°è±¡çš„è¯´æ˜ï¼š </p>
<blockquote>
<p>é•¿å°¾è¯·æ±‚ä¸€èˆ¬æ˜¯æŒ‡æ˜æ˜¾é«˜äºå‡å€¼çš„é‚£éƒ¨åˆ†å æ¯”è¾ƒå°çš„è¯·æ±‚ã€‚  ä¸šç•Œå…³äºå»¶è¿Ÿæœ‰ä¸€ä¸ªå¸¸ç”¨çš„P99æ ‡å‡†ï¼Œ ä¹Ÿå°±æ˜¯99%çš„è¯·æ±‚å»¶è¿Ÿè¦æ»¡è¶³åœ¨ä¸€å®šè€—æ—¶ä»¥å†…ï¼Œ 1%çš„è¯·æ±‚ä¼šå¤§äºè¿™ä¸ªè€—æ—¶ï¼Œ è€Œè¿™1%å°±å¯ä»¥è®¤ä¸ºæ˜¯é•¿å°¾è¯·æ±‚ã€‚  </p>
<p>Refer to:  <a href="https://zhuanlan.zhihu.com/p/35516682">https://zhuanlan.zhihu.com/p/35516682</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, EBS, IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux_Kuberneteså¸¸ç”¨debugå‘½ä»¤</title>
    <url>/2023/09/04/Linux/Linux_Kubernetes%E5%B8%B8%E7%94%A8debug%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>æŸ¥çœ‹ AWS LoadBalancer è¯ä¹¦çš„ä¿¡æ¯ï¼Œæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubectl get validatingwebhookconfigurations.admissionregistration.k8s.io aws-load-balancer-webhook <span class="token parameter variable">-ojsonpath</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>.webhooks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.clientConfig.caBundle<span class="token punctuation">&#125;</span>  <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>  <span class="token operator">|</span> openssl x509 <span class="token parameter variable">-noout</span> <span class="token parameter variable">-text</span></code></pre>

<p>ä½¿ç”¨ debug å®¹å™¨ï¼š </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»™ç‰¹å®šçš„å®¹å™¨é™„åŠ ä¸€ä¸ªSidecarï¼Œ å¹¶å¯åŠ¨shellã€‚</span>
kubectl debug <span class="token parameter variable">-it</span> <span class="token parameter variable">--image</span><span class="token operator">=</span>public.ecr.aws/amazonlinux/amazonlinux:latest aws-node-cpmck
<span class="token comment"># netshootå®¹å™¨ï¼Œ æ¯”è¾ƒæ–¹ä¾¿çš„ç”¨æ¥è¿›è¡Œç½‘ç»œéƒ¨åˆ†çš„è°ƒè¯•ã€‚</span>
<span class="token comment"># é¡¹ç›®ä»“åº“åœ°å€ï¼š https://github.com/nicolaka/netshoot</span>
kubectl debug mypod <span class="token parameter variable">-it</span> <span class="token parameter variable">--image</span><span class="token operator">=</span>nicolaka/netshoot</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux, Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Iostat å‚æ•°è¯´æ˜</title>
    <url>/2023/12/22/Linux/Linux_iostat/</url>
    <content><![CDATA[<blockquote>
<p>ä»manpage é‡Œé¢ç›´æ¥è·å–çš„å‘½ä»¤è¯´æ˜ï¼Œ æ±‡æŠ¥CPUæŒ‡æ ‡ å’Œ è®¾å¤‡ æˆ–è€… åˆ†åŒº çš„ I&#x2F;OæŒ‡æ ‡ã€‚<br>       iostat - Report Central Processing Unit (CPU) statistics and input&#x2F;output statistics for devices and partitions.</p>
</blockquote>
<p>æŒ‡æ ‡çš„è§£é‡Šè¯´æ˜å¦‚ä¸‹ï¼š<br><strong>rrqm&#x2F;s - wrqm&#x2F;s</strong>  ä¸¤ä¸ªçœ‹çš„æ˜¯çš„mergeçš„è¯·æ±‚æ•°é‡ï¼Œ è¡¨ç¤ºå‘é€ç»™é©±åŠ¨ç¨‹åºå¹¶è¢«é©±åŠ¨ç¨‹åºåˆå¹¶çš„è¯·æ±‚æ•°é‡ï¼Œè¡¨ç¤ºæœ‰æ²¡æœ‰è¿›è¡Œåˆå¹¶ï¼Œè¿™ä¹Ÿè¡¨ç¤ºç³»ç»Ÿå°†éšæœºIOè¯·æ±‚åˆå¹¶æˆè¿ç»­ä»¥æé«˜æ€§èƒ½ã€‚<br><strong>r&#x2F;s - w&#x2F;s</strong>  IOè¯»å†™çš„è¯·æ±‚æ•°é‡IOPSï¼Œ å‘é€ç»™ç£ç›˜è®¾å¤‡çš„è¯·æ±‚æ•°ã€‚<br><strong>rKB&#x2F;s - wKB&#x2F;s</strong> ååé‡ï¼Œ å¯ä»¥ä½¿ç”¨ -m è½¬æ¢æˆMB&#x2F;sï¼Œ è®¾å¤‡çš„ä¼ è¾“æ•°æ®é‡çš„ååé‡ä¿¡æ¯ã€‚<br><strong>avgrq-sz</strong>  å¹³å‡è¯·æ±‚å¤§å°ï¼Œ ä¹Ÿå°±æ˜¯IOsize çš„å¤§å°ã€‚å•ä½æ˜¯æ‰‡åŒºï¼ˆ512Bï¼‰ã€‚<br><strong>rareq-sz -  wareq-sz</strong> æ–°ç‰ˆæœ¬çš„iostatå·²ç»æ˜¯è¿™ä¸¤ä¸ªæŒ‡æ ‡äº†ï¼Œ è¿™ä¸¤ä¸ªæŒ‡æ ‡å•ä½æ˜¯ KB.<br><strong>avgqu-sz</strong>  åœ¨é©±åŠ¨é˜Ÿåˆ—å’Œè®¾å¤‡é˜Ÿåˆ—ä¸­æˆ–æ´»è·ƒçš„å¹³å‡è¯·æ±‚æ•°é‡ã€‚ å•ä½æ˜¯ ä¸ªã€‚<br><strong>await</strong> è¿™ä¸ªæŒ‡æ ‡è®°å½•çš„æ€»çš„å»¶è¿Ÿï¼Œ æ–°çš„ç‰ˆæœ¬ä¹ŸåŒ…æ‹¬ rw ä¸¤ç±»è¯·æ±‚çš„å»¶è¿Ÿã€‚ å»¶è¿Ÿå•ä½æ˜¯ ms ï¼Œé€šå¸¸ä¸åº”è¯¥è¶…è¿‡10ms.</p>
<p>å‘½ä»¤è¾“å‡ºç»“æœï¼š</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iostat <span class="token parameter variable">-dx</span> <span class="token number">3</span>

Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1       <span class="token number">2147.33</span>  <span class="token number">34842.67</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.46</span>    <span class="token number">16.23</span>    <span class="token number">0.33</span>      <span class="token number">1.33</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">1.00</span>     <span class="token number">4.00</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">1.00</span> <span class="token number">100.00</span>

Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1       <span class="token number">2128.33</span>  <span class="token number">34248.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.46</span>    <span class="token number">16.09</span>    <span class="token number">5.33</span>     <span class="token number">49.83</span>     <span class="token number">1.33</span>  <span class="token number">20.00</span>    <span class="token number">0.94</span>     <span class="token number">9.34</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.99</span>  <span class="token number">99.87</span>

iostat <span class="token parameter variable">-dcpx</span> <span class="token number">5</span>
Linux <span class="token number">6.4</span>.10-arch1-1 <span class="token punctuation">(</span>arch.liarlee.site<span class="token punctuation">)</span> 	08/22/2023 	_x86_64_	<span class="token punctuation">(</span><span class="token number">4</span> CPU<span class="token punctuation">)</span>

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           <span class="token number">5.23</span>    <span class="token number">0.00</span>    <span class="token number">2.05</span>    <span class="token number">0.01</span>    <span class="token number">0.01</span>   <span class="token number">92.71</span>

Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1          <span class="token number">1.00</span>     <span class="token number">32.72</span>     <span class="token number">0.00</span>   <span class="token number">0.04</span>    <span class="token number">0.66</span>    <span class="token number">32.86</span>    <span class="token number">1.24</span>     <span class="token number">23.27</span>     <span class="token number">0.18</span>  <span class="token number">12.62</span>    <span class="token number">0.99</span>    <span class="token number">18.79</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">0.18</span>
nvme0n1p1        <span class="token number">1.00</span>     <span class="token number">32.72</span>     <span class="token number">0.00</span>   <span class="token number">0.04</span>    <span class="token number">0.66</span>    <span class="token number">32.86</span>    <span class="token number">1.24</span>     <span class="token number">23.27</span>     <span class="token number">0.18</span>  <span class="token number">12.62</span>    <span class="token number">0.99</span>    <span class="token number">18.79</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">0.18</span>


avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           <span class="token number">1.80</span>    <span class="token number">0.00</span>    <span class="token number">0.95</span>    <span class="token number">0.05</span>    <span class="token number">0.00</span>   <span class="token number">97.20</span>

Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1          <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">1.60</span>     <span class="token number">10.40</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.62</span>     <span class="token number">6.50</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">0.32</span>
nvme0n1p1        <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">1.60</span>     <span class="token number">10.40</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.62</span>     <span class="token number">6.50</span>    <span class="token number">0.00</span>      <span class="token number">0.00</span>     <span class="token number">0.00</span>   <span class="token number">0.00</span>    <span class="token number">0.00</span>     <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>    <span class="token number">0.00</span>   <span class="token number">0.34</span></code></pre>

<p>ç›‘æ§æ•°æ®æ¥æºï¼š <code>cat /proc/diskstats</code><br>è¿™äº›æ‰€æœ‰çš„æŒ‡æ ‡éƒ½æ˜¯By Deviceçš„ï¼Œ ä¸è¿›ç¨‹çš„éƒ¨åˆ†æ— å…³ï¼Œç»Ÿè®¡çš„æ˜¯å‘é€åˆ°è®¾å¤‡æˆ–è€…å‘é€åˆ°è®¾å¤‡åˆ†åŒºçš„è¯·æ±‚ã€‚<br>åŸºäºman page ä¸­çš„æè¿°ï¼Œ è¿™å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š<br>     r&#x2F;s    The number (after merges) of read requests completed per second for the device.<br>     w&#x2F;s    The number (after merges) of write requests completed per second for the device.<br>     d&#x2F;s    The number (after merges) of discard requests completed per second for the device.<br>     f&#x2F;s    The number (after merges) of flush requests completed per second for the device.  This counts flush requests executed by disks. Flush requests are not tracked for partitions.  Before being merged, flush operations are counted as writes.</p>
<p>å‘½ä»¤è¡Œå‚æ•°çš„ä¸€éƒ¨åˆ†è§£é‡Š<br><strong>-d</strong> å±•ç¤ºç£ç›˜è®¾å¤‡ä½¿ç”¨ç‡çš„ä¿¡æ¯ã€‚<br><strong>-x</strong> æ‰©å±•æ˜¾ç¤ºæ›´å¤šçš„æŒ‡æ ‡æ•°æ®ï¼Œ ä¸æ·»åŠ è¿™ä¸ªå‚æ•°ä¸åŒºåˆ†è®¾å¤‡ è¯»&#x2F;å†™&#x2F;ç£ç›˜&#x2F;æ–‡ä»¶ç³»ç»Ÿ è¿™å››ä¸ªç»´åº¦ã€‚<br><strong>-c</strong> æŸ¥çœ‹CPUç»Ÿè®¡çš„ä½¿ç”¨ç‡æŒ‡æ ‡ã€‚<br><strong>-p</strong> ç£ç›˜åˆ†åŒºçš„æŒ‡æ ‡ã€‚<br><strong>-z</strong> åªæ˜¯è¾“å‡ºä¸€äº›æœ‰IOçš„è®¾å¤‡çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ æ€§èƒ½ä¹‹å·…é‡Œé¢æœ‰å†™å‡ºè¿™ä¸ªå‚æ•°ã€‚ </p>
<p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„æ€è·¯ï¼š </p>
<ol>
<li>çœ‹è®¾å¤‡ï¼Œ å…·ä½“æ˜¯é‚£ä¸ªè®¾å¤‡ä¸Šé¢æœ‰IOè¯·æ±‚ã€‚</li>
<li>çœ‹awaitï¼Œç­‰å¾…çš„æ—¶é—´é•¿ä¸é•¿ï¼Œ è¿™é‡Œé¢çš„ç­‰å¾…æ—¶é—´æ˜¯ä»è¯·æ±‚è¿›å…¥è®¾å¤‡é˜Ÿåˆ—åˆ°è¯·æ±‚è¿”å›æˆåŠŸçš„æ—¶é—´ ï¼Œ é€šå¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯åœ¨10msä»¥å†…ï¼Œ å°¤å…¶æ˜¯ ssdã€‚</li>
<li>çœ‹ q-szï¼Œ æŒ‰ç…§EBSçš„è§„åˆ™ï¼Œè¯´æ³•ï¼Œ åº”è¯¥æ˜¯æ¯ 1000 IOPS é˜Ÿåˆ—æ•°ä¸º 1ã€‚ </li>
<li>ç»¼åˆçœ‹ IOPSï¼Œ å—å¤§å°ï¼Œ ååé‡ï¼Œ  ä½¿ç”¨ç‡ï¼Œ ç¡®è®¤è®¾å¤‡æ˜¯ä¸æ˜¯è¾¾åˆ°äº†ç“¶é¢ˆã€‚ </li>
<li>æœ€ååˆ‡æ¢å·¥å…·å®šä½å…·ä½“æ˜¯é‚£ä¸ªè¿›ç¨‹åœ¨å¤§é‡çš„å‘é€IOè¯·æ±‚ ï¼Œå¤§æ¦‚å¯èƒ½çš„å·¥å…·æ˜¯ pidstatï¼Œ htop ï¼Œ atop ï¼Œ sar ç­‰ç­‰ï¼Œ æ„Ÿè§‰å·¥å…·è¿˜å¯èƒ½æœ‰ pm çš„è¿™éƒ¨åˆ†å·¥å…·ã€‚</li>
</ol>
<p>é€šå¸¸å¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤ ï¼š <code>iostat -xz 1</code> </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>vmstat å‚æ•°è¯´æ˜</title>
    <url>/2023/12/22/Linux/Linux_vmstat/</url>
    <content><![CDATA[<h3 id="å‘½ä»¤è¯´æ˜"><a href="#å‘½ä»¤è¯´æ˜" class="headerlink" title="å‘½ä»¤è¯´æ˜"></a>å‘½ä»¤è¯´æ˜</h3><p>vmstat æä¾›çš„ä¿¡æ¯æ˜¯ä»ç¡¬ä»¶å’Œç‰©ç†å‚æ•°çš„è§’åº¦ã€‚<strong>vmstat ç¬¬ä¸€æ¬¡çš„æ•°æ®æ˜¾ç¤ºçš„æ˜¯ä»ä¸Šä¸€æ¬¡é‡å¯åˆ°ç°åœ¨çš„å¹³å‡å€¼ï¼Œæ‰€ä»¥åªèƒ½ç”¨æ¥å‚è€ƒã€‚</strong><br>æ ‡é¢˜å†…å®¹å°±ä¸åœ¨è§£é‡Šäº†ï¼Œåˆ†åˆ«æ˜¯ <strong>è¿›ç¨‹ ï¼Œ å†…å­˜ï¼Œ äº¤æ¢ ï¼Œ IOï¼Œ ç³»ç»Ÿ ï¼Œ å’Œ CPU</strong>ã€‚</p>
<p>è¯¦ç»†å‚æ•°å¦‚ä¸‹ï¼š<br>  r - ç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•°é‡,  å¤šå°‘ä¸ªè¿›ç¨‹åœ¨RçŠ¶æ€ï¼Œ å¹¶ä¸€ç›´å–å¾—å¹¶å ç”¨CPUæ—¶é—´ç‰‡ã€‚<br>  b - Uninterreptable Sleepçš„è¿›ç¨‹æ•°é‡ï¼Œ æœ‰å¤šå°‘ä¸ªå¤„äºDçŠ¶æ€æ˜¾ç¤ºçš„è¿›ç¨‹ï¼Œ é€šå¸¸ä»£è¡¨æœ‰å¤šå°‘ä¸ªè¿›ç¨‹æ­£å¸¸ç­‰å¾…IOèµ„æºã€‚<br>  swpdï¼š VirtualMemoryçš„å€¼ ï¼ˆKBï¼‰, äº¤æ¢çš„ä½¿ç”¨é‡ï¼Œå¦‚æœæœªå¼€å¯äº¤æ¢åˆ†åŒºå°±ä¼šæ˜¾ç¤ºæ˜¯ 0ã€‚ è¿™ä¸ªæŒ‡æ ‡å’Œåé¢çš„ si so æ˜¯æ•´ä½“çš„ï¼Œ swpd æœ‰ç”¨é‡ï¼Œ é‚£ä¹ˆsi&#x2F;so å°±æœ‰æ•°æ®ï¼Œ swpd æ˜¯ 0ï¼Œ é‚£ä¹ˆæ°¸è¿œä¸ä¼šæœ‰ si&#x2F;soã€‚<br>  freeï¼š IdleMemoryçš„å€¼ï¼ˆKB), å®Œå…¨å¯ç”¨çš„å†…å­˜ï¼Œ  è¿™é‡Œfreeçš„å†…å­˜æ˜¯ å®Œå…¨æ²¡æœ‰è¢«åˆ†é…çš„ã€‚total - buffer - cache - used è®¡ç®—å®Œäº†ä¹‹åå‰©ä¸‹çš„, ä¸ free å‘½ä»¤ä¸­çš„ free å­—æ®µæ˜¯åŒæ ·çš„å«ä¹‰ã€‚<br>  buffï¼š è¢«bufferä½¿ç”¨çš„å†…å­˜é‡ï¼ˆKBï¼‰ï¼Œè¢« buff ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚<br>  cacheï¼š è¢«cacheä½¿ç”¨çš„å†…å­˜é‡ï¼ˆKBï¼‰ï¼Œ è¢« cache å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œ è¿™éƒ¨åˆ†å’Œbuffer ä¸€æ ·ï¼Œ æ˜¯ä¸´æ—¶æ•°æ®ï¼Œåœ¨è½ç›˜åbuffer ä¼šè¢«é‡Šæ”¾ï¼Œ cacheå¯ä»¥ç›´æ¥è¢«é‡Šæ”¾ã€‚<br>  siï¼š Swapin å†…å­˜ä»ç¡¬ç›˜æ¢å…¥çš„æ•°æ®é‡ ï¼ˆKB&#x2F;s)ï¼Œ <strong>è¯»å–äº¤æ¢åˆ†åŒºï¼ˆdiskï¼‰åˆ° å†…å­˜</strong> çš„æ•°æ®é‡ ã€‚<br>  soï¼šSwapout å†…å­˜äº¤æ¢åˆ°ç¡¬ç›˜çš„æ•°æ®é‡ ï¼ˆKB&#x2F;sï¼‰ï¼Œ <strong>å†™å…¥ç£ç›˜äº¤æ¢åˆ†åŒº</strong>çš„æ•°æ®é‡ã€‚<br>  biï¼š blockinï¼Œ å‘é€åˆ°å—è®¾å¤‡çš„å—æ•°é‡ï¼ˆblocks&#x2F;s),   ç³»ç»Ÿæ”¶åˆ°diskå‘é€æ¥çš„æ•°æ®é‡ï¼Œ ä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„<strong>è¯»ç£ç›˜æ•°æ®ã€‚</strong><br>  boï¼š blockout ï¼Œ ä»å—è®¾å¤‡æ¥æ”¶çš„å—æ•°é‡ï¼ˆblocks&#x2F;sï¼‰ï¼Œ ç³»ç»Ÿå†™å…¥diskçš„æ•°æ®é‡ï¼Œ ä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„<strong>å†™ç£ç›˜æ•°æ®</strong>ã€‚<br>  inï¼š åŒ…æ‹¬æ—¶é’Ÿåœ¨å†…çš„é‚£<strong>æ¯ç§’ä¸­æ–­æ•°</strong>ã€‚<br>  csï¼š <strong>è¿›ç¨‹ä¸Šä¸‹æ–‡æ¯ç§’åˆ‡æ¢</strong>çš„æ¬¡æ•°ã€‚<br>  usï¼šéå†…æ ¸ä»£ç ä½¿ç”¨çš„CPUç™¾åˆ†æ¯”ï¼Œ åŒ…æ‹¬<strong>ç”¨æˆ·æ—¶é—´å’ŒNiceæ—¶é—´</strong>ã€‚<br>  syï¼š<strong>å†…æ ¸ä»£ç </strong>ä½¿ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚<br>  idï¼š CPUçš„<strong>ç©ºé—²æ—¶é—´</strong>ç™¾åˆ†æ¯”ã€‚<br>  waï¼š<strong>ç­‰å¾…IOæ“ä½œ</strong>èŠ±è´¹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚ è¿™ä¸ªå®¹æ˜“è¯¯è§£çš„æ˜¯ï¼Œ wa å…¶å®cpu æ˜¯ç©ºé—²çš„ï¼Œ ç»Ÿè®¡çš„æ–¹å¼æ˜¯ï¼Œ åœ¨æ”¶é›†æ•°æ®çš„æ—¶å€™æœ‰å¤šå°‘ä¸ªè¿›ç¨‹å¤„äºéœ€è¦å¤„ç†ioæˆ–è€…ç­‰å¾…å¤„ç†ioçš„çŠ¶æ€ï¼Œ å½“æ—¶é‚£ä¸ªæ—¶åˆ»çš„ç™¾åˆ†æ¯”ï¼Œ è€Œå®é™…ä¸Šç­‰å¾…ioçš„æ—¶é—´å…¶å®CPUæ²¡æœ‰åšäº‹ï¼Œ æ‰€ä»¥åœ¨CPUçš„åº¦é‡ä¸Šï¼Œ è¿™ä¸ªæ—¶é—´çš„CPUæ˜¯å¯ä»¥åšå…¶ä»–äº‹æƒ…çš„ï¼Œ å¯ä»¥è¢«å…¶ä»–éœ€è¦è¿›è¡Œè®¡ç®—çš„è¿›ç¨‹ä½¿ç”¨æ‰è¿™éƒ¨åˆ†æ—¶é—´ã€‚<br>  stï¼š<strong>è™šæ‹ŸåŒ–å±‚</strong>æ“ä½œèŠ±è´¹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚è¿™ä¸ªé€šå¸¸æ˜¯æŒ‡è™šæ‹ŸåŒ–å±‚çš„é™åˆ¶ã€‚ è¿™ä¸ªæŒ‡æ ‡å¦‚æœæœ‰ï¼Œ é‚£ä¹ˆè¡¨ç¤ºè™šæ‹ŸåŒ–å±‚å¯¹cpuçš„ä½¿ç”¨è¿›è¡Œäº†é™åˆ¶ï¼ˆEC2 Tç³»åˆ—å®ä¾‹ï¼‰ æˆ–è€…æ˜¯ åº•å±‚çš„èµ„æºå¹¶ä¸å®Œå…¨æ»¡è¶³éœ€æ±‚è€Œå¯¼è‡´çš„äº‰æŠ¢ã€‚<br>  guï¼š Time spent running KVM guest code (guest time, including guest nice). ï¼Œ è¿™ä¸ªæ˜¯æ–°æ·»åŠ çš„æŒ‡æ ‡ï¼Œ ä¹‹å‰æ²¡æœ‰è§è¿‡ã€‚ å¦‚æœæ˜¯KVM host os ä¸Šé¢è¿™ä¸ªæŒ‡æ ‡è¿˜æ˜¯æ¯”è¾ƒæœ‰ç”¨çš„ã€‚  </p>
<h2 id="è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š"><a href="#è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š" class="headerlink" title="è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š   "></a>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š<br>   <pre class="language-bash" data-language="bash"><code class="language-bash">~ <span class="token function">vmstat</span> <span class="token parameter variable">-w</span> <span class="token number">1</span>
--procs-- -----------------------memory---------------------- ---swap-- -----io---- -system-- ----------cpu----------
   r    b         swpd         <span class="token function">free</span>         buff        cache   si   so    bi    bo   <span class="token keyword">in</span>   cs  us  sy  <span class="token function">id</span>  wa  st  gu
   <span class="token number">2</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">42600</span>         <span class="token number">1328</span>      <span class="token number">1973356</span>    <span class="token number">4</span>    <span class="token number">7</span>    <span class="token number">77</span>   <span class="token number">312</span> <span class="token number">1767</span>    <span class="token number">6</span>   <span class="token number">2</span>   <span class="token number">2</span>  <span class="token number">95</span>   <span class="token number">1</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">42652</span>         <span class="token number">1328</span>      <span class="token number">1973360</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">2519</span> <span class="token number">3373</span>   <span class="token number">1</span>   <span class="token number">2</span>  <span class="token number">97</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">42652</span>         <span class="token number">1328</span>      <span class="token number">1973360</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span> <span class="token number">1001</span> <span class="token number">1844</span>   <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">42652</span>         <span class="token number">1328</span>      <span class="token number">1973360</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">12</span> <span class="token number">1056</span> <span class="token number">1822</span>   <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">42652</span>         <span class="token number">1328</span>      <span class="token number">1973368</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">1308</span> <span class="token number">2150</span>   <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">98</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">43156</span>         <span class="token number">1328</span>      <span class="token number">1973376</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">1394</span> <span class="token number">2245</span>   <span class="token number">3</span>   <span class="token number">1</span>  <span class="token number">97</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">43156</span>         <span class="token number">1328</span>      <span class="token number">1973376</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">1125</span> <span class="token number">1898</span>   <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">43408</span>         <span class="token number">1328</span>      <span class="token number">1973376</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">55</span> <span class="token number">1229</span> <span class="token number">2218</span>   <span class="token number">1</span>   <span class="token number">1</span>  <span class="token number">99</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">44948</span>         <span class="token number">1328</span>      <span class="token number">1973392</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">3544</span> <span class="token number">5490</span>   <span class="token number">7</span>   <span class="token number">4</span>  <span class="token number">89</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span>
   <span class="token number">1</span>    <span class="token number">0</span>      <span class="token number">1005492</span>        <span class="token number">45228</span>         <span class="token number">1328</span>      <span class="token number">1973428</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span> <span class="token number">1410</span> <span class="token number">2082</span>   <span class="token number">3</span>   <span class="token number">4</span>  <span class="token number">93</span>   <span class="token number">0</span>   <span class="token number">0</span>   <span class="token number">0</span></code></pre></h2><h3 id="åˆ†ææŒ‡æ ‡çš„é€»è¾‘"><a href="#åˆ†ææŒ‡æ ‡çš„é€»è¾‘" class="headerlink" title="åˆ†ææŒ‡æ ‡çš„é€»è¾‘"></a>åˆ†ææŒ‡æ ‡çš„é€»è¾‘</h3><p>è¾“å‡ºä¹‹å å…ˆçœ‹å‰å‡ æ¬¡è¾“å‡ºçš„ r å’Œ bã€‚<br>  r æœ‰æ²¡æœ‰è¶…è¿‡æ ¸å¿ƒæ•°ï¼›<br>  b è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰æ•°æ®ï¼Œ æ•°æ®åœ¨è¿è¡Œå‘½ä»¤çš„å‘¨æœŸæ˜¯ä¸æ˜¯ä¸€ç›´å­˜åœ¨ï¼Œ æ•°é‡æœ‰æ²¡æœ‰è¶…è¿‡CPUæ ¸å¿ƒæ•°ã€‚å˜åŒ–çš„é¢‘ç‡çš„å¹…åº¦æ˜¯ä»€ä¹ˆæ ·çš„ã€‚<br>    ä¾‹å­ï¼š<br>    æ€»å…±è§‚å¯Ÿ10s ï¼Œ æ¯ç§’è¾“å‡ºä¸€æ¬¡æ•°æ®ï¼Œ æ¯ç§’éƒ½æœ‰ è¶…è¿‡cpu æ ¸å¿ƒæ•°çš„ ä¸å¯ä¸­æ–­è¿›ç¨‹ï¼Œ é‚£ä¹ˆè¿™ä»£è¡¨å½“å‰çš„æ“ä½œç³»ç»Ÿå¯èƒ½å­˜åœ¨å¤§é‡ioè¿›ç¨‹ï¼Œè¢«é˜»å¡çš„IOè¿›ç¨‹æ¯”è¾ƒå¤š ã€‚ </p>
<p>ç„¶åçœ‹æœ€åä¸€åˆ—çš„CPUæƒ…å†µï¼Œ idçš„æ•°æ®æ˜¯å¤šå°‘ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™id æ¯”è¾ƒå°ï¼Œ çœ‹ us&#x2F;sy&#x2F;wa ï¼Œcpu æŠŠæ—¶é—´èŠ±è´¹åœ¨äº†ä»€ä¹ˆåœ°æ–¹ã€‚<br>é€šå¸¸çš„åœºæ™¯ä¸‹ï¼Œ cpu åº”è¯¥æŠŠæ—¶é—´å°½å¯èƒ½çš„ä½¿ç”¨åœ¨ us è¿™ä¸ªéƒ¨åˆ†ã€‚ å¦‚æœå…¶ä»–è€Œéƒ¨åˆ†æ¯”è¾ƒå¤šçš„å°±éœ€è¦å…³æ³¨è¾ƒå¤šçš„é‚£ä¸ªéƒ¨åˆ†äº†ã€‚ </p>
<p>æœ‰äº¤æ¢å°±çœ‹çœ‹äº¤æ¢ï¼Œ æ²¡æœ‰äº¤æ¢ç›´æ¥çœ‹å†…å­˜ç›¸å…³ï¼Œ cache + free æ€»å…±æœ‰å¤šå°‘ã€‚å¦‚æœå†…å­˜ç”¨é‡æ˜¯ä¸æ˜¯åœ¨oom çš„è¾¹ç¼˜ ï¼Œç„¶åå†çœ‹ in&#x2F;csï¼Œ  ä¸€ä¸ªæ˜¯ç¡¬ä¸­æ–­æ¬¡æ•°ï¼Œ ä¸€ä¸ªæ˜¯è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œ è¿™ä¸¤ä¸ªä¸€ä¸ªå¯èƒ½ä»£è¡¨æ½œåœ¨çš„cpuè¢«ç¡¬ä»¶äº‹ä»¶ç»ˆæ­¢ï¼Œ å¦ä¸€ä¸ªcpuå¿™äºåœ¨è¿›ç¨‹ä¹‹é—´åå¤æ¨ªè·³ã€‚ è¿™äº›éƒ½å¯èƒ½æŒ‡å‘å½“å‰ç³»ç»Ÿçš„æ•ˆç‡å¹¶ä¸é«˜ï¼Œ æˆ–è€…æ½œåœ¨çš„é—®é¢˜ã€‚ </p>
<h3 id="å‘½ä»¤ç¤ºä¾‹"><a href="#å‘½ä»¤ç¤ºä¾‹" class="headerlink" title="å‘½ä»¤ç¤ºä¾‹"></a>å‘½ä»¤ç¤ºä¾‹</h3><p>   vmstat -m â€“ æ˜¾ç¤ºå†…æ ¸å ç”¨å†…å­˜çš„åˆ†é…æƒ…å†µã€‚<br>   vmstat -a â€“ å°†å†…å­˜çš„ä½¿ç”¨é‡åˆ†ä¸º<strong>æ´»åŠ¨å†…å­˜</strong>å’Œ<strong>éæ´»åŠ¨å†…å­˜</strong>ã€‚<br>   vmstat -n 2 10 â€“ å±•ç¤ºvmstatçš„ç»“æœ10æ¬¡ï¼Œ æ¯ä¸¤ç§’ä¸€æ¬¡ã€‚</p>
<h3 id="æ›´å¤šå‚è€ƒ"><a href="#æ›´å¤šå‚è€ƒ" class="headerlink" title="æ›´å¤šå‚è€ƒ"></a>æ›´å¤šå‚è€ƒ</h3><p><a href="https://docs.oracle.com/cd/E19455-01/805-7229/6j6q8svh5/index.html">https://docs.oracle.com/cd/E19455-01/805-7229/6j6q8svh5/index.html</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
</search>
