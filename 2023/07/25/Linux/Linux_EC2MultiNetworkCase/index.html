<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>EC2 路由表以及多网卡相关问题 | Liarlee's Notebook</title><meta name="author" content="Liarlee"><meta name="copyright" content="Liarlee"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="在EC2实例中， 可以使用多个不同的网卡， 但是虚拟网卡其实是共享实例整体带宽的。 假如EC2实例本身有10Gbps的带宽， 那么无论多少个网卡都应该只能有10Gbps的带宽， 其实添加了多个也不会扩展网络上限。  但是某些大规格的实例会有这种情况， 需要添加多个网卡，并且底层其实提供了多个NetworkCard。 这种情况少见， 但是确实有。  如果是物理的机器， 那么最好的办法就是链路聚合，">
<meta property="og:type" content="article">
<meta property="og:title" content="EC2 路由表以及多网卡相关问题">
<meta property="og:url" content="https://liarlee.site/2023/07/25/Linux/Linux_EC2MultiNetworkCase/index.html">
<meta property="og:site_name" content="Liarlee&#39;s Notebook">
<meta property="og:description" content="在EC2实例中， 可以使用多个不同的网卡， 但是虚拟网卡其实是共享实例整体带宽的。 假如EC2实例本身有10Gbps的带宽， 那么无论多少个网卡都应该只能有10Gbps的带宽， 其实添加了多个也不会扩展网络上限。  但是某些大规格的实例会有这种情况， 需要添加多个网卡，并且底层其实提供了多个NetworkCard。 这种情况少见， 但是确实有。  如果是物理的机器， 那么最好的办法就是链路聚合，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/j3/wallhaven-j3m8y5.png">
<meta property="article:published_time" content="2023-07-25T14:00:04.000Z">
<meta property="article:modified_time" content="2023-08-20T15:01:42.467Z">
<meta property="article:author" content="Liarlee">
<meta property="article:tag" content="Linux, Network, EC2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/j3/wallhaven-j3m8y5.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://liarlee.site/2023/07/25/Linux/Linux_EC2MultiNetworkCase/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'EC2 路由表以及多网卡相关问题',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-20 23:01:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Liarlee's Notebook"><img class="site-icon" src="/img/logo.png"/><span class="site-name">Liarlee's Notebook</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">EC2 路由表以及多网卡相关问题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-25T14:00:04.000Z" title="发表于 2023-07-25 22:00:04">2023-07-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-20T15:01:42.467Z" title="更新于 2023-08-20 23:01:42">2023-08-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="EC2 路由表以及多网卡相关问题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p>在EC2实例中， 可以使用多个不同的网卡， 但是虚拟网卡其实是共享实例整体带宽的。 假如EC2实例本身有10Gbps的带宽， 那么无论多少个网卡都应该只能有10Gbps的带宽， 其实添加了多个也不会扩展网络上限。 </p>
<p>但是某些大规格的实例会有这种情况， 需要添加多个网卡，并且底层其实提供了多个NetworkCard。 这种情况少见， 但是确实有。 </p>
<p>如果是物理的机器， 那么最好的办法就是链路聚合， 将多个网卡合并使用来扩充这个物理服务器的网络能力。 </p>
<p>这样的实例添加网卡之后其实会有一定的难度，描述一下这个场景： </p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>一台ec2 ， 三张网卡， OS是 Ubuntu 18.04 ， 三张网卡分别是 ens5 ens6 ens7 , 实例中命令展示网卡如下 ： </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip ad
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1&#x2F;8 scope host lo
       valid_lft forever preferred_lft forever
2: ens5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:4d:73:35:16:8a brd ff:ff:ff:ff:ff:ff
    inet 172.31.43.121&#x2F;20 brd 172.31.47.255 scope global dynamic ens5
       valid_lft 1957sec preferred_lft 1957sec
3: ens6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:5d:02:b4:37:fa brd ff:ff:ff:ff:ff:ff
    inet 172.31.37.95&#x2F;20 brd 172.31.47.255 scope global dynamic ens6
       valid_lft 1955sec preferred_lft 1955sec
4: ens7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000
    link&#x2F;ether 02:cf:10:d8:12:80 brd ff:ff:ff:ff:ff:ff
    inet 172.31.40.130&#x2F;20 brd 172.31.47.255 scope global dynamic ens7
       valid_lft 1956sec preferred_lft 1956sec</code></pre>

<p>三张网卡中， ens5上面有一个公网ip地址的绑定， elastic ip , 操作系统看不到， 但是ens5 能找到公网IP地址， 其他网卡都不能。</p>
<h2 id="多网卡路由策略配置"><a href="#多网卡路由策略配置" class="headerlink" title="多网卡路由策略配置"></a>多网卡路由策略配置</h2><p>多网卡的情况下，<strong>手动配置了所有网卡的路由策略之后</strong>，公网访问没了， 看看 ip route show： </p>
<h3 id="看路由表"><a href="#看路由表" class="headerlink" title="看路由表"></a>看路由表</h3><pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip r s
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100

ip route show 命令显示的是系统路由表，也就是记录了目的网络和下一跳地址的信息的路由表。它的每个字段的含义是：

default 表示这个路由项是一个默认路由，也就是当没有匹配目的地址的路由项时，就使用这个路由项来发送数据包。
via 表示这个路由项的下一跳地址，也就是数据包要经过的网关地址。
dev 表示这个路由项对应的网卡设备名称，例如 lo, eth0, ens5 等。
proto 表示这个路由项的协议来源，例如 kernel, static, dhcp 等。
src 表示这个路由项的源地址，也就是本机发送数据包时使用的IP地址。
metric 表示这个路由项的度量值，也就是到达目的网络所需的跳数或开销。</code></pre>

<p>这里面显示 我有三个默认路由， 他们的权重是一样的， 那么按照通常的逻辑， 哪个条目在靠前就会把数据包交给谁， 这时候问题出现了。 </p>
<blockquote>
<p>如果我的主网卡上面有公网IP地址， 这时候我去访问公网例如baidu， 会发现这个数据是出不去的， 因为默认匹配了第一个条目之后， 从 ens7 这个没有公网ip地址绑定的网卡走了。</p>
</blockquote>
<h3 id="看抓包"><a href="#看抓包" class="headerlink" title="看抓包"></a>看抓包</h3><p>测试一下， 直接开一个Ping命令在后台， <code>ping www.baidu.com </code> ， 另一个窗口开 <code>tcpdump -i any icmp</code>看结果。</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# tcpdump -i any icmp -nn
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes
14:49:31.480896 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 12, length 64
14:49:32.504867 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 13, length 64
14:49:33.528873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 14, length 64
14:49:34.552872 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 15, length 64
14:49:35.576877 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 16, length 64
14:49:36.600873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 17, length 64
14:49:37.624863 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 18, length 64
14:49:38.648871 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 19, length 64
14:49:39.672865 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 20, length 64
14:49:40.696876 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 21, length 64
14:49:41.720872 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 22, length 64
14:49:42.744873 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 23, length 64
14:49:43.768868 IP 172.31.40.130 &gt; 39.156.66.14: ICMP echo request, id 15074, seq 24, length 64
</code></pre>

<p>能直接看到这个数据包是从 ens7 的网卡出去的， 确实匹配到了默认的路由条目， 第一条直接发走， 这本来是正确的逻辑， 但是一旦我需要访问公网且该实例的ens5才是公网ip的指定网卡， 那么这个数据包就只有出去， 没有回来的了。</p>
<p>这确实避免了VPC内部访问的网络限制问题， 但是公网的访问也没有了。 这是一个路由条目的优先级问题， 基于这个问题应该如何修复呢？ </p>
<h3 id="调整路由条目的优先级"><a href="#调整路由条目的优先级" class="headerlink" title="调整路由条目的优先级"></a>调整路由条目的优先级</h3><p>调整默认路由的优先级， 让数据匹配默认路由的时候优先匹配ens5的条目。 </p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">150</span>  <span class="token function">ip</span> route del default via <span class="token number">172.31</span>.32.1 dev ens5 proto dhcp src <span class="token number">172.31</span>.43.121 metric <span class="token number">100</span>
<span class="token number">151</span>  <span class="token function">ip</span> route <span class="token function">add</span> default via <span class="token number">172.31</span>.32.1 dev ens5 proto dhcp src <span class="token number">172.31</span>.43.121 metric <span class="token number">10</span></code></pre>

<p>上面的命令可以将ens5 的默认路由metric 设置成 10 ，整体的路由表会变成这样： </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;netplan# ip r s
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>这时候再ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 的结果就正常了。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-43-121:/etc/netplan<span class="token comment"># ping www.baidu.com</span>
PING www.a.shifen.com <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.59</span> ms
<span class="token number">64</span> bytes from <span class="token number">39.156</span>.66.18 <span class="token punctuation">(</span><span class="token number">39.156</span>.66.18<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">44</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">5.60</span> ms
^C
--- www.a.shifen.com <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3004ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">5.590</span>/5.596/5.608/0.091 ms</code></pre>

<p>这时候如果重启网络服务就会发现， 这三个默认条目路由的 metric 又恢复了 100 ， 并不能持久生效。</p>
<h3 id="持久化配置"><a href="#持久化配置" class="headerlink" title="持久化配置"></a>持久化配置</h3><p>更改这个网卡的配置文件<code>/etc/netplan/50-cloud-init.yaml</code></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">root@ip<span class="token punctuation">-</span>172<span class="token punctuation">-</span>31<span class="token punctuation">-</span>43<span class="token punctuation">-</span>121<span class="token punctuation">:</span>/etc/netplan<span class="token comment"># cat /etc/netplan/50-cloud-init.yaml</span>
<span class="token comment"># This file is generated from information provided by the datasource.  Changes</span>
<span class="token comment"># to it will not persist across an instance reboot.  To disable cloud-init's</span>
<span class="token comment"># network configuration capabilities, write a file</span>
<span class="token comment"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:</span>
<span class="token comment"># network: &#123;config: disabled&#125;</span>
<span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
        <span class="token key atrule">ens5</span><span class="token punctuation">:</span>
            <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">match</span><span class="token punctuation">:</span>
                <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>4d<span class="token punctuation">:</span>73<span class="token punctuation">:</span>35<span class="token punctuation">:</span>16<span class="token punctuation">:</span>8a
            <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens5
            <span class="token key atrule">routes</span><span class="token punctuation">:</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0 <span class="token comment"># 主路由表默认路由条目权重</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.32.1
               <span class="token key atrule">metric</span><span class="token punctuation">:</span> <span class="token number">10</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0  <span class="token comment"># 策略路由</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.32.1
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
             <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.43.121 <span class="token comment"># 策略路由</span>
               <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
               <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
               <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span>
            <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.43.121
                <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1000</span></code></pre>

<p>执行 <code>netplan try</code>测试</p>
<p>执行 <code>netplan apply</code> 确认生效</p>
<hr>
<p>这个时候再看路由表， 输出结果： </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;netplan# ip r s
default via 172.31.32.1 dev ens5 proto static metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>这时候这个实例的内外网络都是通的了。</p>
<h3 id="最优配置"><a href="#最优配置" class="headerlink" title="最优配置"></a>最优配置</h3><p>对于Ubuntu最佳的配置是： </p>
<p>ens5 设置为 dhcp。</p>
<p>ens6， ens7 设置为 static ip ， 不从DHCP学习路由条目。这样默认的路由条目只有一条， 就是指向ens5的条目， 所有去往公网的流量会匹配到这个default条目， 然后走 ens5. </p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ens6</span><span class="token punctuation">:</span>
    <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">dhcp4-overrides</span><span class="token punctuation">:</span> <span class="token comment"># 这个参数没尝试， 感觉是需要的，调整一下学习来的路由的优先级</span>
        <span class="token key atrule">route-metric</span><span class="token punctuation">:</span> <span class="token number">100</span>
        <span class="token comment"># 不指定metric也可以指定         use-routes: false 来关闭学习默认路由。</span>
    <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 172.31.59.199/20
    <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">match</span><span class="token punctuation">:</span>
        <span class="token key atrule">macaddress</span><span class="token punctuation">:</span> 02<span class="token punctuation">:</span>64<span class="token punctuation">:</span>69<span class="token punctuation">:</span>51<span class="token punctuation">:</span>00<span class="token punctuation">:</span>f2
    <span class="token key atrule">set-name</span><span class="token punctuation">:</span> ens6
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 0.0.0.0/0
       <span class="token key atrule">via</span><span class="token punctuation">:</span> 172.31.48.1
       <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
     <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> 172.31.59.199
       <span class="token key atrule">via</span><span class="token punctuation">:</span> 0.0.0.0
       <span class="token key atrule">scope</span><span class="token punctuation">:</span> link
       <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
    <span class="token key atrule">routing-policy</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">from</span><span class="token punctuation">:</span> 172.31.59.199
        <span class="token key atrule">table</span><span class="token punctuation">:</span> <span class="token number">1001</span>
<span class="token key atrule">ens7</span><span class="token punctuation">:</span>   <span class="token comment"># 同上</span>
</code></pre>

<p>但是就像之前的描述， 这已经可以达成最终的目标了， 这还是感觉不是最好的方法， 最好的方法是bonding， 直接将多个网卡链路聚合， 才能更好的利用好底层多个物理网卡的特性。</p>
<h2 id="配置Bonding"><a href="#配置Bonding" class="headerlink" title="配置Bonding"></a>配置Bonding</h2><p>待补充。</p>
<h2 id="如何排查路由表条目"><a href="#如何排查路由表条目" class="headerlink" title="如何排查路由表条目"></a>如何排查路由表条目</h2><ol>
<li><p>首先应该查看的是 ip rule list , 这里面定义的是 所有路由表的优先级。 </p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;iproute2# ip rule list
0:	from all lookup local
0:	from 172.31.40.130 lookup 1002
0:	from 172.31.37.95 lookup 1001
0:	from 172.31.43.121 lookup 1000
32766:	from all lookup main
32767:	from all lookup default
</code></pre>

<p>查看tcp数据包中的<strong>目的地址</strong>， 按照优先级顺序匹配条目，依次查。</p>
<p>local table 是内核维护本地网络， 无法更改， 并且所有的条目都先匹配local。</p>
</li>
<li><p>查看 local table 中的条目。</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:~# ip route show table local
broadcast 127.0.0.0 dev lo proto kernel scope link src 127.0.0.1
local 127.0.0.0&#x2F;8 dev lo proto kernel scope host src 127.0.0.1
local 127.0.0.1 dev lo proto kernel scope host src 127.0.0.1
broadcast 127.255.255.255 dev lo proto kernel scope link src 127.0.0.1
broadcast 172.31.32.0 dev ens7 proto kernel scope link src 172.31.40.130
broadcast 172.31.32.0 dev ens6 proto kernel scope link src 172.31.37.95
broadcast 172.31.32.0 dev ens5 proto kernel scope link src 172.31.43.121
local 172.31.37.95 dev ens6 proto kernel scope host src 172.31.37.95
local 172.31.40.130 dev ens7 proto kernel scope host src 172.31.40.130
local 172.31.43.121 dev ens5 proto kernel scope host src 172.31.43.121
broadcast 172.31.47.255 dev ens7 proto kernel scope link src 172.31.40.130
broadcast 172.31.47.255 dev ens6 proto kernel scope link src 172.31.37.95
broadcast 172.31.47.255 dev ens5 proto kernel scope link src 172.31.43.121

ip route show table local 命令显示的是本地路由表，也就是保存本地接口地址，广播地址，NAT地址等信息的路由表。它的每一个字段的含义是：
 
broadcast 表示这个路由项是一个广播地址，也就是可以向同一网段内的所有主机发送数据包的地址。
local 表示这个路由项是一个本地地址，也就是本机自身的IP地址。
 
dev 表示这个路由项对应的网卡设备名称，例如 lo, eth0, ens5 等。
 
proto 表示这个路由项的协议来源，例如 kernel, static, dhcp 等。
 
scope 表示这个路由项的作用范围，例如 host, link, global 等。

src 表示这个路由项的源地址，也就是本机发送数据包时使用的IP地址。
</code></pre>

<p>这个表格中， 例如 </p>
<blockquote>
<p>local 172.31.37.95 dev ens6 proto kernel scope host src 172.31.37.95 </p>
</blockquote>
<p>如果匹配到了目的地址是  172.31.37.95  那么就由 dev ens6 来处理这个数据， 是通过kernel记录的， 是一个操作系统范围内的链路， 这个条目表示， 匹配到这个路由条目的数据报文会被交给dev dns6 来进行处理。 </p>
<p>如果想知道具体这个地址会匹配到哪个路由条目， 可以使用命令：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">root@ip-172-31-43-121:/etc/iproute2<span class="token comment"># ip route get 39.156.66.14</span>
<span class="token number">39.156</span>.66.14 via <span class="token number">172.31</span>.32.1 dev ens5 src <span class="token number">172.31</span>.43.121 uid <span class="token number">0</span>
    cache
root@ip-172-31-43-121:/etc/iproute2<span class="token comment"># ip route get 172.31.40.130</span>
<span class="token builtin class-name">local</span> <span class="token number">172.31</span>.40.130 dev lo table <span class="token builtin class-name">local</span> src <span class="token number">172.31</span>.40.130 uid <span class="token number">0</span>
    cache <span class="token operator">&lt;</span>local<span class="token operator">></span>
</code></pre>
</li>
<li><p>如果local没有匹配到， 例如 访问百度的地址， 会跳转到 策略路由表， 当然我配置的策略路由表其实也没有匹配到这些条目， 因此开始查 main</p>
<pre class="language-none"><code class="language-none">root@ip-172-31-43-121:&#x2F;etc&#x2F;iproute2# ip r s t main
default via 172.31.32.1 dev ens5 proto static metric 10
default via 172.31.32.1 dev ens7 proto dhcp src 172.31.40.130 metric 100
default via 172.31.32.1 dev ens6 proto dhcp src 172.31.37.95 metric 100
default via 172.31.32.1 dev ens5 proto dhcp src 172.31.43.121 metric 100
172.31.32.0&#x2F;20 dev ens7 proto kernel scope link src 172.31.40.130
172.31.32.0&#x2F;20 dev ens6 proto kernel scope link src 172.31.37.95
172.31.32.0&#x2F;20 dev ens5 proto kernel scope link src 172.31.43.121
172.31.32.1 dev ens7 proto dhcp scope link src 172.31.40.130 metric 100
172.31.32.1 dev ens6 proto dhcp scope link src 172.31.37.95 metric 100
172.31.32.1 dev ens5 proto dhcp scope link src 172.31.43.121 metric 100
</code></pre>

<p>由上面的查询结果可以看出， 匹配到了main表的第一条。直接给了ens5 ， 数据出去了。</p>
</li>
</ol>
<h2 id="额外的问题"><a href="#额外的问题" class="headerlink" title="额外的问题"></a>额外的问题</h2><ol>
<li><p>具体匹配的规则是怎么实现的， src 地址到底是匹配规则还是 匹配后报文的源地址。</p>
<blockquote>
<p>src 后面的地址是发出报文的src ip， 表示匹配这个路由条目的报文都是这个地址发出去的。</p>
</blockquote>
</li>
<li><p>三个条目的权重相同的时候， 也不是全部的报文都匹配了默认的第一个规则， 而是周期的匹配到ens6并且尝试访问几次百度， 然后失败， 不知道为啥。</p>
<p>如图： </p>
<p>待</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://liarlee.site">Liarlee</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://liarlee.site/2023/07/25/Linux/Linux_EC2MultiNetworkCase/">https://liarlee.site/2023/07/25/Linux/Linux_EC2MultiNetworkCase/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://liarlee.site" target="_blank">Liarlee's Notebook</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux-Network-EC2/">Linux, Network, EC2</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/j3/wallhaven-j3m8y5.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/05/Linux/Linux_VIM_Neovim-Lua-from-scratch/" title="Neovim 全 Lua 配置"><img class="cover" src="https://w.wallhaven.cc/full/j3/wallhaven-j3m8y5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Neovim 全 Lua 配置</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/25/Linux/Linux_MultiNetworkCard-RoutePolicy/" title="Linux配置网卡策略路由"><img class="cover" src="https://w.wallhaven.cc/full/zx/wallhaven-zx12wj.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux配置网卡策略路由</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Liarlee</div><div class="author-info__description">Archlinux User, Support Engineer</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">67</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Liarlee"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LiarLee" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">都道无人愁似我，今夜雪，有梅花，似我愁。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BD%91%E5%8D%A1%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">多网卡路由策略配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">2.1.</span> <span class="toc-text">看路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E6%8A%93%E5%8C%85"><span class="toc-number">2.2.</span> <span class="toc-text">看抓包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E8%B7%AF%E7%94%B1%E6%9D%A1%E7%9B%AE%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.3.</span> <span class="toc-text">调整路由条目的优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">持久化配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E4%BC%98%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.</span> <span class="toc-text">最优配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEBonding"><span class="toc-number">3.</span> <span class="toc-text">配置Bonding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E8%B7%AF%E7%94%B1%E8%A1%A8%E6%9D%A1%E7%9B%AE"><span class="toc-number">4.</span> <span class="toc-text">如何排查路由表条目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">额外的问题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/22/%E6%9C%AA%E5%91%BD%E5%90%8D/" title="无题">无题</a><time datetime="2023-12-21T16:34:33.195Z" title="发表于 2023-12-22 00:34:33">2023-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/22/Other/Other-TrueNas%20Scale%20%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E7%9A%84%E5%8F%82%E6%95%B0/" title="无题">无题</a><time datetime="2023-12-21T16:34:33.194Z" title="发表于 2023-12-22 00:34:33">2023-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/22/Linux/iostat/" title="无题">无题</a><time datetime="2023-12-21T16:34:33.193Z" title="发表于 2023-12-22 00:34:33">2023-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/22/Linux/vmstat/" title="无题">无题</a><time datetime="2023-12-21T16:34:33.193Z" title="发表于 2023-12-22 00:34:33">2023-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/12/22/Linux/Linux_Iptables-and-conntrack/" title="无题">无题</a><time datetime="2023-12-21T16:34:33.189Z" title="发表于 2023-12-22 00:34:33">2023-12-22</time></div></div></div></div></div></div></main><footer id="footer" style="background: rgb(105,105,105)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Liarlee</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="255,250,240" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>